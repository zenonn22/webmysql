<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Chapter 14 The InnoDB Storage Engine</title>
<link rel="stylesheet" href="mvl.css" type="text/css" />
<meta name="generator" content="DocBook XSL Stylesheets + chunker.py v1.9.2" />
<link rel="start" href="index.html" title="{book-title}" />
<link rel="up" href="" title="" />
<link rel="prev" href="sql-syntax.html" title="Chapter 13 SQL Statement Syntax" />
<link rel="next" href="storage-engines.html" title="Chapter 15 Alternative Storage Engines" />
<script language="javascript" type="text/javascript">
  function addOnload(theFunc)
  {
    var previous = window.onload;
    if (typeof window.onload != 'function')
    {
      window.onload = theFunc;
    }
    else
    {
      window.onload = function()
      {
        previous();
        theFunc();
      }
    }
  }

  addOnload(function()
  {
    var base = new Date(1458020663*1000);
    var now = new Date();
    var diff = ((now-base)/1000)/(24*3600);

    if (diff > 90) {
      var nodes = document.getElementsByClassName('titlepage');
      nodes[0].innerHTML = '<p style="border: 5px #ff0000 solid; padding: 5px; margin 5px">' +
        'This copy of the manual is more than 90 days old. We encourage you to download a ' +
        'new version from <a href="http://dev.mysql.com">dev.mysql.com/doc</a>.</p>' + nodes[0].innerHTML;
    }
  });
</script>
<noscript></noscript>
</head>
<body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF">
<div class="navheader">
<table width="100%" summary="Navigation header">
<tr>
<th colspan="3" align="center">Chapter 14 The InnoDB Storage Engine</th>
</tr>
<tr>
<td width="20%" align="left"><a accesskey="p" href="sql-syntax.html">Prev</a> </td>
<th width="60%" align="center"></th>
<td width="20%" align="right"> <a accesskey="n" href="storage-engines.html">Next</a></td>
</tr>
</table>
<hr>
</div>
<div class="chapter">
<div class="titlepage">
<div>
<div>
<h1 class="title"><a name="innodb-storage-engine"></a>Chapter 14 The InnoDB Storage Engine</h1>

</div>

</div>

</div>
<div class="toc">
<p><b>Table of Contents</b></p><dl class="toc"><dt><span class="section"><a href="innodb-storage-engine.html#innodb-introduction">14.1 Introduction to InnoDB</a></span></dt><dd><dl><dt><span class="section"><a href="innodb-storage-engine.html#innodb-default-se">14.1.1 InnoDB as the Default MySQL Storage Engine</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-check-availability">14.1.2 Checking InnoDB Availability</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-turning-off">14.1.3 Turning Off InnoDB</a></span></dt></dl></dd><dt><span class="section"><a href="innodb-storage-engine.html#innodb-concepts">14.2 InnoDB Concepts and Architecture</a></span></dt><dd><dl><dt><span class="section"><a href="innodb-storage-engine.html#mysql-acid">14.2.1 MySQL and the ACID Model</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-transaction-model">14.2.2 The InnoDB Transaction Model and Locking</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-multi-versioning">14.2.3 InnoDB Multi-Versioning</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-redo-log">14.2.4 InnoDB Redo Log</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-undo-logs">14.2.5 InnoDB Undo Logs</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-temporary-table-undo-logs">14.2.6 InnoDB Temporary Table Undo Logs</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-table-and-index">14.2.7 InnoDB Table and Index Structures</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-performance-latching">14.2.8 InnoDB Mutex and Read/Write Lock Implementation</a></span></dt></dl></dd><dt><span class="section"><a href="innodb-storage-engine.html#innodb-configuration">14.3 InnoDB Configuration</a></span></dt><dd><dl><dt><span class="section"><a href="innodb-storage-engine.html#innodb-init-startup-configuration">14.3.1 InnoDB Initialization and Startup Configuration</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-read-only-instance">14.3.2 Configuring InnoDB for Read-Only Operation</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-performance-buffer-pool">14.3.3 InnoDB Buffer Pool Configuration</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-performance-use_sys_malloc">14.3.4 Configuring the Memory Allocator for InnoDB</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-performance-change_buffering">14.3.5 Configuring InnoDB Change Buffering</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-performance-thread_concurrency">14.3.6 Configuring Thread Concurrency for InnoDB</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-performance-multiple_io_threads">14.3.7 Configuring the Number of Background InnoDB I/O Threads</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-performance-thread_io_rate">14.3.8 Configuring the InnoDB Master Thread I/O Rate</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-performance-spin_lock_polling">14.3.9 Configuring Spin Lock Polling</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-improved-purge-scheduling">14.3.10 Configuring InnoDB Purge Scheduling</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-performance-optimizer-statistics">14.3.11 Configuring Optimizer Statistics for InnoDB</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#index-page-merge-threshold">14.3.12 Configuring the Merge Threshold for Index Pages</a></span></dt></dl></dd><dt><span class="section"><a href="innodb-storage-engine.html#innodb-tablespace">14.4 InnoDB Tablespace Management</a></span></dt><dd><dl><dt><span class="section"><a href="innodb-storage-engine.html#innodb-resize-system-tablespace">14.4.1 Resizing the InnoDB System Tablespace</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-data-log-reconfiguration">14.4.2 Changing the Number or Size of InnoDB Redo Log Files</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-raw-devices">14.4.3 Using Raw Disk Partitions for the System Tablespace</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-multiple-tablespaces">14.4.4 InnoDB File-Per-Table Tablespaces</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#tablespace-placing">14.4.5 Creating a File-Per-Table Tablespace Outside the Data Directory</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#tablespace-copying">14.4.6 Copying File-Per-Table Tablespaces to Another Server</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-undo-tablespace">14.4.7 Storing InnoDB Undo Logs in Separate Tablespaces</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#truncate-undo-tablespace">14.4.8 Truncating Undo Logs That Reside in Undo Tablespaces</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#general-tablespaces">14.4.9 InnoDB General Tablespaces</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-tablespace-encryption">14.4.10 InnoDB Tablespace Encryption</a></span></dt></dl></dd><dt><span class="section"><a href="innodb-storage-engine.html#innodb-tables">14.5 InnoDB Table Management</a></span></dt><dd><dl><dt><span class="section"><a href="innodb-storage-engine.html#using-innodb-tables">14.5.1 Creating InnoDB Tables</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-migration">14.5.2 Moving or Copying InnoDB Tables to Another Machine</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-transactions-with-different-apis">14.5.3 Grouping DML Operations with Transactions</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#converting-tables-to-innodb">14.5.4 Converting Tables from MyISAM to InnoDB</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-auto-increment-handling">14.5.5 AUTO_INCREMENT Handling in InnoDB</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-foreign-key-constraints">14.5.6 InnoDB and FOREIGN KEY Constraints</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-restrictions">14.5.7 Limits on InnoDB Tables</a></span></dt></dl></dd><dt><span class="section"><a href="innodb-storage-engine.html#innodb-compression">14.6 InnoDB Table and Page Compression</a></span></dt><dd><dl><dt><span class="section"><a href="innodb-storage-engine.html#innodb-table-compression">14.6.1 InnoDB Table Compression</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-page-compression">14.6.2 InnoDB Page Compression</a></span></dt></dl></dd><dt><span class="section"><a href="innodb-storage-engine.html#innodb-file-format">14.7 InnoDB File-Format Management</a></span></dt><dd><dl><dt><span class="section"><a href="innodb-storage-engine.html#innodb-file-format-enabling">14.7.1 Enabling File Formats</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-file-format-compatibility">14.7.2 Verifying File Format Compatibility</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-file-format-identifying">14.7.3 Identifying the File Format in Use</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-file-format-downgrading">14.7.4 Modifying the File Format</a></span></dt></dl></dd><dt><span class="section"><a href="innodb-storage-engine.html#innodb-row-format">14.8 InnoDB Row Storage and Row Formats</a></span></dt><dd><dl><dt><span class="section"><a href="innodb-storage-engine.html#innodb-row-format-overview">14.8.1 Overview of InnoDB Row Storage</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-row-format-specification">14.8.2 Specifying the Row Format for a Table</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-row-format-dynamic">14.8.3 DYNAMIC and COMPRESSED Row Formats</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-row-format-antelope">14.8.4 COMPACT and REDUNDANT Row Formats</a></span></dt></dl></dd><dt><span class="section"><a href="innodb-storage-engine.html#innodb-disk-management">14.9 InnoDB Disk I/O and File Space Management</a></span></dt><dd><dl><dt><span class="section"><a href="innodb-storage-engine.html#innodb-disk-io">14.9.1 InnoDB Disk I/O</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-file-space">14.9.2 File Space Management</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-checkpoints">14.9.3 InnoDB Checkpoints</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-file-defragmenting">14.9.4 Defragmenting a Table</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-truncate-table-reclaim-space">14.9.5 Reclaiming Disk Space with TRUNCATE TABLE</a></span></dt></dl></dd><dt><span class="section"><a href="innodb-storage-engine.html#innodb-online-ddl">14.10 InnoDB and Online DDL</a></span></dt><dd><dl><dt><span class="section"><a href="innodb-storage-engine.html#innodb-create-index-overview">14.10.1 Overview of Online DDL</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-create-index-concurrency">14.10.2 Performance and Concurrency Considerations for Online DDL</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-online-ddl-syntax">14.10.3 SQL Syntax for Online DDL</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-online-ddl-single-multi">14.10.4 Combining or Separating DDL Statements</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-create-index-examples">14.10.5 Examples of Online DDL</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-create-index-implementation">14.10.6 Implementation Details of Online DDL</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-create-index-recovery">14.10.7 How Crash Recovery Works with Online DDL</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#online-ddl-partitioning">14.10.8 Online DDL for Partitioned InnoDB Tables</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-create-index-limitations">14.10.9 Limitations of Online DDL</a></span></dt></dl></dd><dt><span class="section"><a href="innodb-storage-engine.html#innodb-parameters">14.11 InnoDB Startup Options and System Variables</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-information-schema">14.12 InnoDB INFORMATION_SCHEMA Tables</a></span></dt><dd><dl><dt><span class="section"><a href="innodb-storage-engine.html#innodb-information-schema-compression-tables">14.12.1 InnoDB INFORMATION_SCHEMA Tables about Compression</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-information-schema-transactions">14.12.2 InnoDB INFORMATION_SCHEMA Transaction and Locking Tables</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-information-schema-system-tables">14.12.3 InnoDB INFORMATION_SCHEMA System Tables</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-information-schema-fulltext_index-tables">14.12.4 InnoDB INFORMATION_SCHEMA FULLTEXT Index Tables</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-information-schema-buffer-pool-tables">14.12.5 InnoDB INFORMATION_SCHEMA Buffer Pool Tables</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-information-schema-metrics-table">14.12.6 InnoDB INFORMATION_SCHEMA Metrics Table</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-information-schema-temp-table-info">14.12.7 InnoDB INFORMATION_SCHEMA Temporary Table Information Table</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-information-schema-files-table">14.12.8 Retrieving InnoDB Tablespace Metadata from INFORMATION_SCHEMA.FILES</a></span></dt></dl></dd><dt><span class="section"><a href="innodb-storage-engine.html#innodb-performance-schema">14.13 InnoDB Integration with MySQL Performance Schema</a></span></dt><dd><dl><dt><span class="section"><a href="innodb-storage-engine.html#monitor-alter-table-performance-schema">14.13.1 Monitoring ALTER TABLE Progress for InnoDB Tables Using Performance
Schema</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#monitor-innodb-mutex-waits-performance-schema">14.13.2 Monitoring InnoDB Mutex Waits Using Performance Schema</a></span></dt></dl></dd><dt><span class="section"><a href="innodb-storage-engine.html#innodb-monitors">14.14 InnoDB Monitors</a></span></dt><dd><dl><dt><span class="section"><a href="innodb-storage-engine.html#innodb-monitor-types">14.14.1 InnoDB Monitor Types</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-enabling-monitors">14.14.2 Enabling InnoDB Monitors</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-standard-monitor">14.14.3 InnoDB Standard Monitor and Lock Monitor Output</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-tablespace-monitor">14.14.4 InnoDB Tablespace Monitor Output</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-table-monitor">14.14.5 InnoDB Table Monitor Output</a></span></dt></dl></dd><dt><span class="section"><a href="innodb-storage-engine.html#innodb-backup">14.15 InnoDB Backup and Recovery</a></span></dt><dd><dl><dt><span class="section"><a href="innodb-storage-engine.html#innodb-recovery">14.15.1 The InnoDB Recovery Process</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-recovery-tablespace-discovery">14.15.2 Tablespace Discovery During Crash Recovery</a></span></dt></dl></dd><dt><span class="section"><a href="innodb-storage-engine.html#innodb-and-mysql-replication">14.16 InnoDB and MySQL Replication</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-memcached">14.17 InnoDB memcached Plugin</a></span></dt><dd><dl><dt><span class="section"><a href="innodb-storage-engine.html#innodb-memcached-benefits">14.17.1 Benefits of the InnoDB memcached Plugin</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-memcached-intro">14.17.2 InnoDB memcached Architecture</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-memcached-setup">14.17.3 Setting Up the InnoDB memcached Plugin</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-memcached-security">14.17.4 Security Considerations for the InnoDB memcached Plugin</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-memcached-developing">14.17.5 Writing Applications for the InnoDB memcached Plugin</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-memcached-replication">14.17.6 The InnoDB memcached Plugin and Replication</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-memcached-internals">14.17.7 InnoDB memcached Plugin Internals</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-memcached-troubleshoot">14.17.8 Troubleshooting the InnoDB memcached Plugin</a></span></dt></dl></dd><dt><span class="section"><a href="innodb-storage-engine.html#innodb-troubleshooting">14.18 InnoDB Troubleshooting</a></span></dt><dd><dl><dt><span class="section"><a href="innodb-storage-engine.html#error-creating-innodb">14.18.1 Troubleshooting InnoDB I/O Problems</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#forcing-innodb-recovery">14.18.2 Forcing InnoDB Recovery</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-troubleshooting-datadict">14.18.3 Troubleshooting InnoDB Data Dictionary Operations</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-error-handling">14.18.4 InnoDB Error Handling</a></span></dt></dl></dd></dl>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="innodb-introduction"></a>14.1 Introduction to InnoDB</h2>

</div>

</div>

</div>
<div class="toc">
<dl class="toc"><dt><span class="section"><a href="innodb-storage-engine.html#innodb-default-se">14.1.1 InnoDB as the Default MySQL Storage Engine</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-check-availability">14.1.2 Checking InnoDB Availability</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-turning-off">14.1.3 Turning Off InnoDB</a></span></dt></dl>
</div>
<a class="indexterm" name="idm140644117347568"></a><a class="indexterm" name="idm140644117346080"></a><a class="indexterm" name="idm140644117345008"></a><a class="indexterm" name="idm140644117343520"></a><a class="indexterm" name="idm140644117342448"></a><a class="indexterm" name="idm140644117340960"></a><a class="indexterm" name="idm140644117339888"></a><a class="indexterm" name="idm140644117338816"></a><a class="indexterm" name="idm140644117337744"></a><p>
    <code class="literal">InnoDB</code> is a general-purpose storage engine that
    balances high reliability and high performance. In MySQL
    5.7, <code class="literal">InnoDB</code> is the default MySQL
    storage engine. Issuing the <a class="link" href="sql-syntax.html#create-table" title="13.1.18 CREATE TABLE Syntax"><code class="literal">CREATE
    TABLE</code></a> statement without an <code class="literal">ENGINE=</code>
    clause creates an <code class="literal">InnoDB</code> table.
</p>
<h3><a name="idm140644117332048"></a>Key Advantages of InnoDB</h3>
<p>
    Key advantages of <code class="literal">InnoDB</code> tables include:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
        Its <a class="link" href="glossary.html#glos_dml" title="DML">DML</a> operations follow the
        <a class="link" href="glossary.html#glos_acid" title="ACID">ACID</a> model, with
        <a class="link" href="glossary.html#glos_transaction" title="transaction">transactions</a> featuring
        <a class="link" href="glossary.html#glos_commit" title="commit">commit</a>,
        <a class="link" href="glossary.html#glos_rollback" title="rollback">rollback</a>, and
        <a class="link" href="glossary.html#glos_crash_recovery" title="crash recovery">crash-recovery</a>
        capabilities to protect user data.
      </p></li><li class="listitem"><p>
        Row-level <a class="link" href="glossary.html#glos_locking" title="locking">locking</a> and
        Oracle-style <a class="link" href="glossary.html#glos_consistent_read" title="consistent read">consistent
        reads</a> increase multi-user concurrency and performance.
      </p></li><li class="listitem"><p>
        <code class="literal">InnoDB</code> tables arrange your data on disk to
        optimize queries based on
        <a class="link" href="glossary.html#glos_primary_key" title="primary key">primary keys</a>.
      </p></li><li class="listitem"><p>
        To maintain data
        <a class="link" href="glossary.html#glos_referential_integrity" title="referential integrity">integrity</a>,
        <code class="literal">InnoDB</code> also supports
        <a class="link" href="glossary.html#glos_foreign_key" title="foreign key"><code class="literal">FOREIGN
        KEY</code></a> constraints. With foreign keys, inserts,
        updates, and deletes are checked to ensure they do not result in
        inconsistencies across different tables.
      </p></li><li class="listitem"><p>
        You can freely mix <code class="literal">InnoDB</code> tables with tables
        from other MySQL storage engines, even within the same
        statement. For example, you can use a
        <a class="link" href="glossary.html#glos_join" title="join">join</a> operation to combine data
        from <code class="literal">InnoDB</code> and
        <a class="link" href="storage-engines.html#memory-storage-engine" title="15.3 The MEMORY Storage Engine"><code class="literal">MEMORY</code></a> tables in a single query.
      </p></li><li class="listitem"><p>
        <code class="literal">InnoDB</code> has been designed for CPU efficiency
        and maximum performance when processing large data volumes.
</p></li></ul>
</div>

<div class="table">
<a name="idm140644117309024"></a><p class="title"><b>Table 14.1 InnoDB Storage Engine Features</b></p>
<div class="table-contents">
<table summary="InnoDB Storage Engine Features" border="1"><colgroup><col class="featurev0"><col class="featurevalue0"><col class="featurev1"><col class="featurevalue1"><col class="featurev2"><col class="featurevalue2"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Storage limits</strong></span></td><td>64TB</td><td><span class="bold"><strong>Transactions</strong></span></td><td>Yes</td><td><span class="bold"><strong>Locking granularity</strong></span></td><td>Row</td></tr><tr><td scope="row"><span class="bold"><strong>MVCC</strong></span></td><td>Yes</td><td><span class="bold"><strong>Geospatial data type support</strong></span></td><td>Yes</td><td><span class="bold"><strong>Geospatial indexing support</strong></span></td><td>Yes<a href="#ftn.idm140644117296640" class="footnote" name="idm140644117296640"><sup class="footnote">[a]</sup></a></td></tr><tr><td scope="row"><span class="bold"><strong>B-tree indexes</strong></span></td><td>Yes</td><td><span class="bold"><strong>T-tree indexes</strong></span></td><td>No</td><td><span class="bold"><strong>Hash indexes</strong></span></td><td>No<a href="#ftn.idm140644117292432" class="footnote" name="idm140644117292432"><sup class="footnote">[b]</sup></a></td></tr><tr><td scope="row"><span class="bold"><strong>Full-text search indexes</strong></span></td><td>Yes<a href="#ftn.idm140644117290608" class="footnote" name="idm140644117290608"><sup class="footnote">[c]</sup></a></td><td><span class="bold"><strong>Clustered indexes</strong></span></td><td>Yes</td><td><span class="bold"><strong>Data caches</strong></span></td><td>Yes</td></tr><tr><td scope="row"><span class="bold"><strong>Index caches</strong></span></td><td>Yes</td><td><span class="bold"><strong>Compressed data</strong></span></td><td>Yes<a href="#ftn.idm140644117285200" class="footnote" name="idm140644117285200"><sup class="footnote">[d]</sup></a></td><td><span class="bold"><strong>Encrypted data<a href="#ftn.idm140644117283920" class="footnote" name="idm140644117283920"><sup class="footnote">[e]</sup></a></strong></span></td><td>Yes</td></tr><tr><td scope="row"><span class="bold"><strong>Cluster database support</strong></span></td><td>No</td><td><span class="bold"><strong>Replication support<a href="#ftn.idm140644117280880" class="footnote" name="idm140644117280880"><sup class="footnote">[f]</sup></a></strong></span></td><td>Yes</td><td><span class="bold"><strong>Foreign key support</strong></span></td><td>Yes</td></tr><tr><td scope="row"><span class="bold"><strong>Backup / point-in-time recovery<a href="#ftn.idm140644117277872" class="footnote" name="idm140644117277872"><sup class="footnote">[g]</sup></a></strong></span></td><td>Yes</td><td><span class="bold"><strong>Query cache support</strong></span></td><td>Yes</td><td><span class="bold"><strong>Update statistics for data dictionary</strong></span></td><td>Yes</td></tr></tbody><tbody class="footnotes"><tr><td colspan="6">
<div id="ftn.idm140644117296640" class="footnote">
<p><a href="#idm140644117296640" class="para"><sup class="para">[a] </sup></a>InnoDB support for geospatial indexing is available in MySQL 5.7.5 and higher.</p>
</div>

<div id="ftn.idm140644117292432" class="footnote">
<p><a href="#idm140644117292432" class="para"><sup class="para">[b] </sup></a>InnoDB utilizes hash indexes internally for its Adaptive Hash Index feature.</p>
</div>

<div id="ftn.idm140644117290608" class="footnote">
<p><a href="#idm140644117290608" class="para"><sup class="para">[c] </sup></a>InnoDB support for FULLTEXT indexes is available in MySQL 5.6.4 and higher.</p>
</div>

<div id="ftn.idm140644117285200" class="footnote">
<p><a href="#idm140644117285200" class="para"><sup class="para">[d] </sup></a>Compressed InnoDB tables require the InnoDB Barracuda file format.</p>
</div>

<div id="ftn.idm140644117283920" class="footnote">
<p><a href="#idm140644117283920" class="para"><sup class="para">[e] </sup></a>Implemented in the server (via encryption functions), rather than in the storage engine.</p>
</div>

<div id="ftn.idm140644117280880" class="footnote">
<p><a href="#idm140644117280880" class="para"><sup class="para">[f] </sup></a>Implemented in the server, rather than in the storage engine.</p>
</div>

<div id="ftn.idm140644117277872" class="footnote">
<p><a href="#idm140644117277872" class="para"><sup class="para">[g] </sup></a>Implemented in the server, rather than in the storage engine.</p>
</div>
</td></tr></tbody></table>
</div>

</div>
<br class="table-break"><p>
    The <code class="literal">InnoDB</code> storage engine maintains its own
    <a class="link" href="glossary.html#glos_buffer_pool" title="buffer pool">buffer pool</a> for caching data
    and indexes in main memory. By default, with the
    <a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_per_table"><code class="literal">innodb_file_per_table</code></a> setting
    enabled, each new <code class="literal">InnoDB</code> table and its associated
    indexes are stored in a separate file. When the
    <a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_per_table"><code class="literal">innodb_file_per_table</code></a> option is
    disabled, <code class="literal">InnoDB</code> stores tables and indexes in the
    single <a class="link" href="glossary.html#glos_tablespace" title="tablespace">system tablespace</a>,
    which may consist of several files (or raw disk partitions). As of
    MySQL 5.7.6, <code class="literal">InnoDB</code> tables can also be stored in
    <a class="link" href="glossary.html#glos_general_tablespace" title="general tablespace">general tablespaces</a>,
    which are shared tablespaces that can store data for multiple
    tables. <code class="literal">InnoDB</code> tables can handle large quantities
    of data, even on operating systems where file size is limited to
    2GB.
  </p><p>
    To compare the features of <code class="literal">InnoDB</code> with other
    storage engines provided with MySQL, see the <span class="emphasis"><em>Storage
    Engine Features</em></span> table in
    <a class="xref" href="storage-engines.html" title="Chapter 15 Alternative Storage Engines">Chapter 15, <i>Alternative Storage Engines</i></a>.
</p>
<h3><a name="idm140644117262336"></a>InnoDB Enhancements and New Features</h3>
<p>
    For information about <code class="literal">InnoDB</code> enhancements and new
    features in MySQL 5.7, refer to:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
        The <code class="literal">InnoDB</code> enhancements list in
        <a class="xref" href="introduction.html#mysql-nutshell" title="1.4 What Is New in MySQL 5.7">Section 1.4, “What Is New in MySQL 5.7”</a>, which provides an overview of
        the features added in MySQL 5.7.
      </p></li><li class="listitem"><p>
        The
        <a class="ulink" href="http://dev.mysql.com/doc/relnotes/mysql/5.7/en/" target="_top">Release
        Notes</a>, which provide information about changes in each
        version.
</p></li></ul>
</div>
<h3><a name="idm140644117256144"></a>Additional Resources</h3>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
        For <code class="literal">InnoDB</code>-related terms and definitions, see
        <a class="xref" href="glossary.html" title="MySQL Glossary">MySQL Glossary</a>.
      </p></li><li class="listitem"><p>
        A forum dedicated to the <code class="literal">InnoDB</code> storage
        engine is available here:
        <a class="ulink" href="http://forums.mysql.com/list.php?22" target="_top">MySQL
        Forums::InnoDB</a>.
      </p></li><li class="listitem"><p>
        <code class="literal">InnoDB</code> is published under the same GNU GPL
        License Version 2 (of June 1991) as MySQL. For more information
        on MySQL licensing, see
        <a class="ulink" href="http://www.mysql.com/company/legal/licensing/" target="_top">http://www.mysql.com/company/legal/licensing/</a>.
</p></li></ul>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="innodb-default-se"></a>14.1.1 InnoDB as the Default MySQL Storage Engine</h3>

</div>

</div>

</div>
<a class="indexterm" name="idm140644117247024"></a><a class="indexterm" name="idm140644117245568"></a><a class="indexterm" name="idm140644117244048"></a><p>
    <a class="link" href="innodb-storage-engine.html" title="Chapter 14 The InnoDB Storage Engine"><code class="literal">InnoDB</code></a> is the default storage engine in
    MySQL 5.7. <code class="literal">InnoDB</code> is a
    transaction-safe (ACID compliant) storage engine for MySQL that has
    commit, rollback, and crash-recovery capabilities to protect user
    data. <code class="literal">InnoDB</code> row-level locking (without
    escalation to coarser granularity locks) and Oracle-style consistent
    nonlocking reads increase multi-user concurrency and performance.
    <code class="literal">InnoDB</code> stores user data in clustered indexes to
    reduce I/O for common queries based on primary keys. To maintain
    data integrity, <code class="literal">InnoDB</code> also supports
    <code class="literal">FOREIGN KEY</code> referential-integrity constraints.
  </p><p>
    Unless you have configured a different default storage engine,
    issuing the <a class="link" href="sql-syntax.html#create-table" title="13.1.18 CREATE TABLE Syntax"><code class="literal">CREATE TABLE</code></a> statement
    without an <code class="literal">ENGINE=</code> clause creates an
    <code class="literal">InnoDB</code> table.
</p>
<h4><a name="idm140644117234128"></a>Benefits of InnoDB Tables</h4>
<p>
    If you use <a class="link" href="storage-engines.html#myisam-storage-engine" title="15.2 The MyISAM Storage Engine"><code class="literal">MyISAM</code></a> tables but are not
    committed to them for technical reasons, you may find
    <code class="literal">InnoDB</code> tables beneficial for the following
    reasons:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
        If your server crashes because of a hardware or software issue,
        regardless of what was happening in the database at the time,
        you don't need to do anything special after restarting the
        database. <code class="literal">InnoDB</code>
        <a class="link" href="glossary.html#glos_crash_recovery" title="crash recovery">crash recovery</a>
        automatically finalizes any changes that were committed before
        the time of the crash, and undoes any changes that were in
        process but not committed. Just restart and continue where you
        left off.
      </p></li><li class="listitem"><p>
        The <code class="literal">InnoDB</code>
        <a class="link" href="glossary.html#glos_buffer_pool" title="buffer pool">buffer pool</a> caches table
        and index data as the data is accessed. Frequently used data is
        processed directly from memory. This cache applies to many types
        of information, and speeds up processing.
      </p></li><li class="listitem"><p>
        If you split up related data into different tables, you can set
        up <a class="link" href="glossary.html#glos_foreign_key" title="foreign key">foreign keys</a> that
        enforce <a class="link" href="glossary.html#glos_referential_integrity" title="referential integrity">referential
        integrity</a>. Update or delete data, and the related data in
        other tables is updated or deleted automatically. Try to insert
        data into a secondary table without corresponding data in the
        primary table, and the bad data gets kicked out automatically.
      </p></li><li class="listitem"><p>
        If data becomes corrupted on disk or in memory, a
        <a class="link" href="glossary.html#glos_checksum" title="checksum">checksum</a> mechanism alerts
        you to the bogus data before you use it.
      </p></li><li class="listitem"><p>
        When you design your database with appropriate
        <a class="link" href="glossary.html#glos_primary_key" title="primary key">primary key</a> columns for
        each table, operations involving those columns are automatically
        optimized. It is very fast to reference the primary key columns
        in <a class="link" href="sql-syntax.html#select" title="13.2.9 SELECT Syntax"><code class="literal">WHERE</code></a>
        clauses, <a class="link" href="sql-syntax.html#select" title="13.2.9 SELECT Syntax"><code class="literal">ORDER
        BY</code></a> clauses,
        <a class="link" href="sql-syntax.html#select" title="13.2.9 SELECT Syntax"><code class="literal">GROUP BY</code></a>
        clauses, and <a class="link" href="glossary.html#glos_join" title="join">join</a> operations.
      </p></li><li class="listitem"><p>
        Inserts, updates, and deletes are optimized by an automatic
        mechanism called <a class="link" href="glossary.html#glos_change_buffering" title="change buffering">change
        buffering</a>. <code class="literal">InnoDB</code> not only allows
        concurrent read and write access to the same table, it caches
        changed data to streamline disk I/O.
      </p></li><li class="listitem"><p>
        Performance benefits are not limited to giant tables with
        long-running queries. When the same rows are accessed over and
        over from a table, a feature called the
        <a class="link" href="glossary.html#glos_adaptive_hash_index" title="adaptive hash index">Adaptive Hash
        Index</a> takes over to make these lookups even faster, as if
        they came out of a hash table.
      </p></li><li class="listitem"><p>
        You can compress tables and associated indexes.
      </p></li><li class="listitem"><p>
        You can create and drop indexes with much less impact on
        performance and availability.
      </p></li><li class="listitem"><p>
        Truncating a
        <a class="link" href="glossary.html#glos_file_per_table" title="file-per-table">file_per_table</a>
        tablespace is very fast, and can free up disk space for the
        operating system to reuse, rather than freeing up space within
        the <a class="link" href="glossary.html#glos_system_tablespace" title="system tablespace">system
        tablespace</a> that only <code class="literal">InnoDB</code> could
        reuse.
      </p></li><li class="listitem"><p>
        The storage layout for table data is more efficient for
        <a class="link" href="data-types.html#blob" title="11.4.3 The BLOB and TEXT Types"><code class="literal">BLOB</code></a> and long text fields, with
        the <a class="link" href="glossary.html#glos_dynamic_row_format" title="dynamic row format">DYNAMIC</a> row
        format.
      </p></li><li class="listitem"><p>
        You can monitor the internal workings of the storage engine by
        querying
        <a class="link" href="glossary.html#glos_information_schema" title="INFORMATION_SCHEMA">INFORMATION_SCHEMA</a>
        tables.
      </p></li><li class="listitem"><p>
        You can monitor the performance details of the storage engine by
        querying <a class="link" href="glossary.html#glos_performance_schema" title="Performance Schema">Performance
        Schema</a> tables.
</p></li></ul>
</div>
<p>
    For <code class="literal">InnoDB</code>-specific tuning techniques you can
    apply in your application code, see
    <a class="xref" href="optimization.html#optimizing-innodb" title="8.5 Optimizing for InnoDB Tables">Section 8.5, “Optimizing for InnoDB Tables”</a>.
</p>
<h4><a name="idm140644117196112"></a>Recent Improvements for InnoDB Tables</h4>
<p>
    MySQL continues to work on addressing use cases that formerly
    required <code class="literal">MyISAM</code> tables. In MySQL 5.6 and higher:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
        <code class="literal">InnoDB</code> can perform full-text search using the
        <code class="literal">FULLTEXT</code> index type. See
        <a class="xref" href="innodb-storage-engine.html#innodb-fulltext-index" title="14.2.7.3 InnoDB FULLTEXT Indexes">Section 14.2.7.3, “InnoDB FULLTEXT Indexes”</a> for details.
      </p></li><li class="listitem"><p>
        <code class="literal">InnoDB</code> now performs better with read-only or
        read-mostly workloads. Automatic optimizations apply to
        <code class="literal">InnoDB</code> queries in
        <a class="link" href="glossary.html#glos_autocommit" title="autocommit">autocommit</a> mode, and you
        can explicitly mark transactions as read-only with the syntax
        <code class="literal">START TRANSACTION READ ONLY</code>. See
        <a class="xref" href="optimization.html#innodb-performance-ro-txn" title="8.5.3 Optimizing InnoDB Read-Only Transactions">Section 8.5.3, “Optimizing InnoDB Read-Only Transactions”</a> for details.
      </p></li><li class="listitem"><p>
        Applications distributed on read-only media can now use
        <code class="literal">InnoDB</code> tables. See
        <a class="xref" href="innodb-storage-engine.html#innodb-read-only-instance" title="14.3.2 Configuring InnoDB for Read-Only Operation">Section 14.3.2, “Configuring InnoDB for Read-Only Operation”</a> for details.
</p></li></ul>
</div>
<h4><a name="idm140644117183696"></a>Best Practices for InnoDB Tables</h4>
<p>
    Some general best practices for <code class="literal">InnoDB</code> tables
    include:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
        Specifying a <a class="link" href="glossary.html#glos_primary_key" title="primary key">primary key</a>
        for every table using the most frequently queried column or
        columns, or an
        <a class="link" href="glossary.html#glos_auto_increment" title="auto-increment">auto-increment</a> value
        if there is no obvious primary key.
      </p></li><li class="listitem"><p>
        Using <a class="link" href="glossary.html#glos_join" title="join">joins</a> wherever data is
        pulled from multiple tables based on identical ID values from
        those tables. For fast join performance, define
        <a class="link" href="glossary.html#glos_foreign_key" title="foreign key">foreign keys</a> on the join
        columns, and declare those columns with the same data type in
        each table. Adding foreign keys ensures that referenced columns
        are indexed, which can improve performance. Foreign keys also
        propagate deletes or updates to all affected tables, and prevent
        insertion of data in a child table if the corresponding IDs are
        not present in the parent table.
      </p></li><li class="listitem"><p>
        Turning off <a class="link" href="glossary.html#glos_autocommit" title="autocommit">autocommit</a>.
        Committing hundreds of times a second puts a cap on performance
        (limited by the write speed of your storage device).
      </p></li><li class="listitem"><p>
        Grouping sets of related <a class="link" href="glossary.html#glos_dml" title="DML">DML</a>
        operations into
        <a class="link" href="glossary.html#glos_transaction" title="transaction">transactions</a>, by
        bracketing them with <code class="literal">START TRANSACTION</code> and
        <code class="literal">COMMIT</code> statements. While you don't want to
        commit too often, you also don't want to issue huge batches of
        <a class="link" href="sql-syntax.html#insert" title="13.2.5 INSERT Syntax"><code class="literal">INSERT</code></a>,
        <a class="link" href="sql-syntax.html#update" title="13.2.11 UPDATE Syntax"><code class="literal">UPDATE</code></a>, or
        <a class="link" href="sql-syntax.html#delete" title="13.2.2 DELETE Syntax"><code class="literal">DELETE</code></a> statements that run for
        hours without committing.
      </p></li><li class="listitem"><p>
        Not using <a class="link" href="sql-syntax.html#lock-tables" title="13.3.5 LOCK TABLES and UNLOCK TABLES Syntax"><code class="literal">LOCK TABLES</code></a> statements.
        <code class="literal">InnoDB</code> can handle multiple sessions all
        reading and writing to the same table at once, without
        sacrificing reliability or high performance. To get exclusive
        write access to a set of rows, use the
        <a class="link" href="innodb-storage-engine.html#innodb-locking-reads" title="14.2.2.5 Locking Reads (SELECT ... FOR UPDATE and SELECT ... LOCK IN SHARE MODE)"><code class="literal">SELECT ...
        FOR UPDATE</code></a> syntax to lock just the rows you intend to
        update.
      </p></li><li class="listitem"><p>
        Enabling the
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_per_table"><code class="literal">innodb_file_per_table</code></a> option to
        put the data and indexes for individual tables into separate
        files, instead of in a single giant
        <a class="link" href="glossary.html#glos_system_tablespace" title="system tablespace">system tablespace</a>.
        This setting is required to use some of the other features, such
        as table <a class="link" href="glossary.html#glos_compression" title="compression">compression</a> and
        fast <a class="link" href="glossary.html#glos_truncate" title="truncate">truncation</a>.
      </p><p>
        The <a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_per_table"><code class="literal">innodb_file_per_table</code></a>
        option is enabled by default as of MySQL 5.6.6.
      </p></li><li class="listitem"><p>
        Evaluating whether your data and access patterns benefit from
        the <code class="literal">InnoDB</code> table
        <a class="link" href="glossary.html#glos_compression" title="compression">compression</a> feature
        (<code class="literal">ROW_FORMAT=COMPRESSED</code>) on the
        <a class="link" href="sql-syntax.html#create-table" title="13.1.18 CREATE TABLE Syntax"><code class="literal">CREATE TABLE</code></a> statement. You can
        compress <code class="literal">InnoDB</code> tables without sacrificing
        read/write capability.
      </p></li><li class="listitem"><p>
        Running your server with the option
        <a class="link" href="server-administration.html#sysvar_sql_mode"><code class="literal">--sql_mode=NO_ENGINE_SUBSTITUTION</code></a>
        to prevent tables being created with a different storage engine
        if there is an issue with the engine specified in the
        <code class="literal">ENGINE=</code> clause of <a class="link" href="sql-syntax.html#create-table" title="13.1.18 CREATE TABLE Syntax"><code class="literal">CREATE
        TABLE</code></a>.
</p></li></ul>
</div>
<h4><a name="idm140644117146016"></a>Testing and Benchmarking with InnoDB as Default Storage Engine</h4>
<p>
    If <code class="literal">InnoDB</code> is not your default storage engine, you
    can determine if your database server or applications work correctly
    with <code class="literal">InnoDB</code> by restarting the server with
    <a class="link" href="server-administration.html#sysvar_default_storage_engine"><code class="literal">--default-storage-engine=InnoDB</code></a>
    defined on the command line or with
    <a class="link" href="server-administration.html#sysvar_default_storage_engine"><code class="literal">default-storage-engine=innodb</code></a>
    defined in the <code class="literal">[mysqld]</code> section of the
    <code class="filename">my.cnf</code> configuration file.
  </p><p>
    Since changing the default storage engine only affects new tables as
    they are created, run all your application installation and setup
    steps to confirm that everything installs properly. Then exercise
    all the application features to make sure all the data loading,
    editing, and querying features work. If a table relies on some
    <code class="literal">MyISAM</code>-specific feature, you'll receive an error;
    add the <code class="literal">ENGINE=MyISAM</code> clause to the
    <a class="link" href="sql-syntax.html#create-table" title="13.1.18 CREATE TABLE Syntax"><code class="literal">CREATE TABLE</code></a> statement to avoid the
    error.
  </p><p>
    If you did not make a deliberate decision about the storage engine,
    and you just want to preview how certain tables work when they're
    created under <code class="literal">InnoDB</code>, issue the command
    <a class="link" href="sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE Syntax"><code class="literal">ALTER TABLE table_name
    ENGINE=InnoDB;</code></a> for each table. Or, to run test queries and
    other statements without disturbing the original table, make a copy
    like so:
  </p><pre class="programlisting">
CREATE TABLE InnoDB_Table (...) ENGINE=InnoDB AS SELECT * FROM MyISAM_Table;</pre><p>
    To get a true idea of the performance with a full application under
    a realistic workload, install the latest MySQL server and run
    benchmarks.
  </p><p>
    Test the full application lifecycle, from installation, through
    heavy usage, and server restart. Kill the server process while the
    database is busy to simulate a power failure, and verify that the
    data is recovered successfully when you restart the server.
  </p><p>
    Test any replication configurations, especially if you use different
    MySQL versions and options on the master and the slaves.
</p>
<h4><a name="idm140644117130176"></a>Verifying that InnoDB is the Default Storage Engine</h4>
<p>
    To verify that <code class="literal">InnoDB</code> is the default storage
    engine:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
        Issue the <a class="link" href="sql-syntax.html#show-engines" title="13.7.5.16 SHOW ENGINES Syntax"><code class="literal">SHOW ENGINES</code></a> command to
        view the different MySQL storage engines. Look for
        <code class="literal">DEFAULT</code> in the <code class="literal">InnoDB</code>
        line. Alternatively, query the
        <code class="literal">INFORMATION_SCHEMA</code>
        <a class="link" href="information-schema.html#engines-table" title="21.6 The INFORMATION_SCHEMA ENGINES Table"><code class="literal">ENGINES</code></a> table.
      </p></li><li class="listitem"><p>
        If <code class="literal">InnoDB</code> is not present, you have a
        <code class="literal">mysqld</code> binary that was compiled without
        <code class="literal">InnoDB</code> support and you need to get a
        different one.
      </p></li><li class="listitem"><p>
        If <code class="literal">InnoDB</code> is present but disabled, go back
        through your startup options and configuration file and get rid
        of any <code class="literal">skip-innodb</code> option.
</p></li></ul>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="innodb-check-availability"></a>14.1.2 Checking InnoDB Availability</h3>

</div>

</div>

</div>
<p>
      To determine whether your server supports
      <code class="literal">InnoDB</code>, use the <a class="link" href="sql-syntax.html#show-engines" title="13.7.5.16 SHOW ENGINES Syntax"><code class="literal">SHOW
      ENGINES</code></a> statement. (Now that <code class="literal">InnoDB</code>
      is the default MySQL storage engine, only very specialized
      environments might not support it.)
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="innodb-turning-off"></a>14.1.3 Turning Off InnoDB</h3>

</div>

</div>

</div>
<p>
      Oracle recommends <code class="literal">InnoDB</code> as the preferred
      storage engine for typical database applications, from single-user
      wikis and blogs running on a local system, to high-end
      applications pushing the limits of performance. In MySQL
      5.7, <code class="literal">InnoDB</code> is the default storage
      engine for new tables.
    </p><p>
      As of MySQL 5.7.5, <code class="literal">InnoDB</code> cannot be disabled.
      The
      <a class="link" href="innodb-storage-engine.html#option_mysqld_innodb"><code class="option">--skip-innodb</code></a>
      option is deprecated and has no effect, and its use results in a
      warning. It will be removed in a future MySQL release. This also
      applies to its synonyms (<code class="option">--innodb=OFF</code>,
      <code class="option">--disable-innodb</code>, and so forth). Before 5.7.5, if
      you do not want to use <code class="literal">InnoDB</code> tables:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          Start the server with the
          <a class="link" href="innodb-storage-engine.html#option_mysqld_innodb"><code class="option">--innodb=OFF</code></a>
          or
          <a class="link" href="innodb-storage-engine.html#option_mysqld_innodb"><code class="option">--skip-innodb</code></a>
          option to disable the <code class="literal">InnoDB</code> storage
          engine.
        </p></li><li class="listitem"><p>
          Because the default storage engine is
          <code class="literal">InnoDB</code>, the server will not start unless
          you also use
          <a class="link" href="server-administration.html#sysvar_default_storage_engine"><code class="option">--default-storage-engine</code></a> and
          <a class="link" href="server-administration.html#sysvar_default_tmp_storage_engine"><code class="option">--default-tmp-storage-engine</code></a> to
          set the default to some other engine for both permanent and
          <code class="literal">TEMPORARY</code> tables.
        </p></li><li class="listitem"><p>
          To prevent the server from crashing when the
          <a class="link" href="information-schema.html#innodb-i_s-tables" title="21.31 INFORMATION_SCHEMA Tables for InnoDB"><code class="literal">InnoDB</code>-related
          <code class="literal">information_schema</code> tables</a> are
          queried, also disable the plugins associated with those
          tables. Specify in the <code class="literal">[mysqld]</code> section of
          the MySQL configuration file:
        </p><pre class="programlisting">
loose-innodb-trx=0 
loose-innodb-locks=0 
loose-innodb-lock-waits=0 
loose-innodb-cmp=0 
loose-innodb-cmp-per-index=0
loose-innodb-cmp-per-index-reset=0
loose-innodb-cmp-reset=0 
loose-innodb-cmpmem=0 
loose-innodb-cmpmem-reset=0 
loose-innodb-buffer-page=0 
loose-innodb-buffer-page-lru=0 
loose-innodb-buffer-pool-stats=0 
loose-innodb-metrics=0 
loose-innodb-ft-default-stopword=0 
loose-innodb-ft-inserted=0 
loose-innodb-ft-deleted=0 
loose-innodb-ft-being-deleted=0 
loose-innodb-ft-config=0 
loose-innodb-ft-index-cache=0 
loose-innodb-ft-index-table=0 
loose-innodb-sys-tables=0 
loose-innodb-sys-tablestats=0 
loose-innodb-sys-indexes=0 
loose-innodb-sys-columns=0 
loose-innodb-sys-fields=0 
loose-innodb-sys-foreign=0 
loose-innodb-sys-foreign-cols=0 
</pre></li></ul>
</div>

</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="innodb-concepts"></a>14.2 InnoDB Concepts and Architecture</h2>

</div>

</div>

</div>
<div class="toc">
<dl class="toc"><dt><span class="section"><a href="innodb-storage-engine.html#mysql-acid">14.2.1 MySQL and the ACID Model</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-transaction-model">14.2.2 The InnoDB Transaction Model and Locking</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-multi-versioning">14.2.3 InnoDB Multi-Versioning</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-redo-log">14.2.4 InnoDB Redo Log</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-undo-logs">14.2.5 InnoDB Undo Logs</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-temporary-table-undo-logs">14.2.6 InnoDB Temporary Table Undo Logs</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-table-and-index">14.2.7 InnoDB Table and Index Structures</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-performance-latching">14.2.8 InnoDB Mutex and Read/Write Lock Implementation</a></span></dt></dl>
</div>
<p>
    The information in this section provides background to help you get
    the most performance and functionality from using
    <code class="literal">InnoDB</code> tables. It is intended for:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
        Anyone switching to MySQL from another database system, to
        explain what things might seem familiar and which might be
        all-new.
      </p></li><li class="listitem"><p>
        Anyone moving from <code class="literal">MyISAM</code> tables to
        <code class="literal">InnoDB</code>, now that <code class="literal">InnoDB</code> is
        the default MySQL storage engine.
      </p></li><li class="listitem"><p>
        Anyone considering their application architecture or software
        stack, to understand the design considerations, performance
        characteristics, and scalability of <code class="literal">InnoDB</code>
        tables at a detailed level.
</p></li></ul>
</div>
<p>
    In this section, you will learn:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
        How <code class="literal">InnoDB</code> closely adheres to
        <a class="link" href="glossary.html#glos_acid" title="ACID">ACID</a> principles.
      </p></li><li class="listitem"><p>
        How <code class="literal">InnoDB</code> implements
        <a class="link" href="glossary.html#glos_transaction" title="transaction">transactions</a>, and how
        the inner workings of transactions compare with other database
        systems you might be familiar with.
      </p></li><li class="listitem"><p>
        How <code class="literal">InnoDB</code> implements
        <a class="link" href="glossary.html#glos_row_level_locking" title="row-level locking">row-level locking</a>
        to allow queries and DML statements to read and write the same
        table simultaneously.
      </p></li><li class="listitem"><p>
        How multi-version concurrency control
        (<a class="link" href="glossary.html#glos_mvcc" title="MVCC">MVCC</a>) keeps transactions from
        viewing or modifying each others' data before the appropriate
        time.
      </p></li><li class="listitem"><p>
        The physical layout of <code class="literal">InnoDB</code>-related objects
        on disk, such as <a class="link" href="glossary.html#glos_table" title="table">tables</a>,
        <a class="link" href="glossary.html#glos_index" title="index">indexes</a>,
        <a class="link" href="glossary.html#glos_tablespace" title="tablespace">tablespaces</a>,
        <a class="link" href="glossary.html#glos_undo_log" title="undo log">undo logs</a>, and the
        <a class="link" href="glossary.html#glos_redo_log" title="redo log">redo log</a>.
</p></li></ul>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="mysql-acid"></a>14.2.1 MySQL and the ACID Model</h3>

</div>

</div>

</div>
<a class="indexterm" name="idm140644117065536"></a><p>
      The <a class="link" href="glossary.html#glos_acid" title="ACID">ACID</a> model is a set of
      database design principles that emphasize aspects of reliability
      that are important for business data and mission-critical
      applications. MySQL includes components such as the
      <code class="literal">InnoDB</code> storage engine that adhere closely to
      the ACID model, so that data is not corrupted and results are not
      distorted by exceptional conditions such as software crashes and
      hardware malfunctions. When you rely on ACID-compliant features,
      you do not need to reinvent the wheel of consistency checking and
      crash recovery mechanisms. In cases where you have additional
      software safeguards, ultra-reliable hardware, or an application
      that can tolerate a small amount of data loss or inconsistency,
      you can adjust MySQL settings to trade some of the ACID
      reliability for greater performance or throughput.
    </p><p>
      The following sections discuss how MySQL features, in particular
      the <code class="literal">InnoDB</code> storage engine, interact with the
      categories of the ACID model:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          <span class="bold"><strong>A</strong></span>: atomicity.
        </p></li><li class="listitem"><p>
          <span class="bold"><strong>C</strong></span>: consistency.
        </p></li><li class="listitem"><p>
          <span class="bold"><strong>I:</strong></span>: isolation.
        </p></li><li class="listitem"><p>
          <span class="bold"><strong>D</strong></span>: durability.
</p></li></ul>
</div>
<h4><a name="idm140644117054160"></a>Atomicity</h4>
<p>
      The <span class="bold"><strong>atomicity</strong></span> aspect of the ACID
      model mainly involves <code class="literal">InnoDB</code>
      <a class="link" href="glossary.html#glos_transaction" title="transaction">transactions</a>. Related
      MySQL features include:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          Autocommit setting.
        </p></li><li class="listitem"><p>
          <a class="link" href="sql-syntax.html#commit" title="13.3.1 START TRANSACTION, COMMIT, and ROLLBACK Syntax"><code class="literal">COMMIT</code></a> statement.
        </p></li><li class="listitem"><p>
          <a class="link" href="sql-syntax.html#commit" title="13.3.1 START TRANSACTION, COMMIT, and ROLLBACK Syntax"><code class="literal">ROLLBACK</code></a>
          statement.
        </p></li><li class="listitem"><p>
          Operational data from the
          <code class="literal">INFORMATION_SCHEMA</code> tables.
</p></li></ul>
</div>
<h4><a name="idm140644117043984"></a>Consistency</h4>
<p>
      The <span class="bold"><strong>consistency</strong></span> aspect of the
      ACID model mainly involves internal <code class="literal">InnoDB</code>
      processing to protect data from crashes. Related MySQL features
      include:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          <code class="literal">InnoDB</code>
          <a class="link" href="glossary.html#glos_doublewrite_buffer" title="doublewrite buffer">doublewrite
          buffer</a>.
        </p></li><li class="listitem"><p>
          <code class="literal">InnoDB</code>
          <a class="link" href="glossary.html#glos_crash_recovery" title="crash recovery">crash recovery</a>.
</p></li></ul>
</div>
<h4><a name="idm140644117036336"></a>Isolation</h4>
<p>
      The <span class="bold"><strong>isolation</strong></span> aspect of the ACID
      model mainly involves <code class="literal">InnoDB</code>
      <a class="link" href="glossary.html#glos_transaction" title="transaction">transactions</a>, in
      particular the <a class="link" href="glossary.html#glos_isolation_level" title="isolation level">isolation
      level</a> that applies to each transaction. Related MySQL
      features include:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          <a class="link" href="glossary.html#glos_autocommit" title="autocommit">Autocommit</a> setting.
        </p></li><li class="listitem"><p>
          <code class="literal">SET ISOLATION LEVEL</code> statement.
        </p></li><li class="listitem"><p>
          The low-level details of <code class="literal">InnoDB</code>
          <a class="link" href="glossary.html#glos_locking" title="locking">locking</a>. During
          performance tuning, you see these details through
          <code class="literal">INFORMATION_SCHEMA</code> tables.
</p></li></ul>
</div>
<h4><a name="idm140644117025456"></a>Durability</h4>
<p>
      The <span class="bold"><strong>durability</strong></span> aspect of the ACID
      model involves MySQL software features interacting with your
      particular hardware configuration. Because of the many
      possibilities depending on the capabilities of your CPU, network,
      and storage devices, this aspect is the most complicated to
      provide concrete guidelines for. (And those guidelines might take
      the form of buy <span class="quote">“<span class="quote">new hardware</span>”</span>.) Related MySQL
      features include:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          <code class="literal">InnoDB</code>
          <a class="link" href="glossary.html#glos_doublewrite_buffer" title="doublewrite buffer">doublewrite
          buffer</a>, turned on and off by the
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_doublewrite"><code class="literal">innodb_doublewrite</code></a>
          configuration option.
        </p></li><li class="listitem"><p>
          Configuration option
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_flush_log_at_trx_commit"><code class="literal">innodb_flush_log_at_trx_commit</code></a>.
        </p></li><li class="listitem"><p>
          Configuration option
          <a class="link" href="replication.html#sysvar_sync_binlog"><code class="literal">sync_binlog</code></a>.
        </p></li><li class="listitem"><p>
          Configuration option
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_per_table"><code class="literal">innodb_file_per_table</code></a>.
        </p></li><li class="listitem"><p>
          Write buffer in a storage device, such as a disk drive, SSD,
          or RAID array.
        </p></li><li class="listitem"><p>
          Battery-backed cache in a storage device.
        </p></li><li class="listitem"><p>
          The operating system used to run MySQL, in particular its
          support for the <code class="literal">fsync()</code> system call.
        </p></li><li class="listitem"><p>
          Uninterruptible power supply (UPS) protecting the electrical
          power to all computer servers and storage devices that run
          MySQL servers and store MySQL data.
        </p></li><li class="listitem"><p>
          Your backup strategy, such as frequency and types of backups,
          and backup retention periods.
        </p></li><li class="listitem"><p>
          For distributed or hosted data applications, the particular
          characteristics of the data centers where the hardware for the
          MySQL servers is located, and network connections between the
          data centers.
</p></li></ul>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="innodb-transaction-model"></a>14.2.2 The InnoDB Transaction Model and Locking</h3>

</div>

</div>

</div>
<div class="toc">
<dl class="toc"><dt><span class="section"><a href="innodb-storage-engine.html#innodb-lock-modes">14.2.2.1 InnoDB Lock Modes</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-record-level-locks">14.2.2.2 InnoDB Record, Gap, and Next-Key Locks</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-next-key-locking">14.2.2.3 Avoiding the Phantom Problem Using Next-Key Locking</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-consistent-read">14.2.2.4 Consistent Nonlocking Reads</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-locking-reads">14.2.2.5 Locking Reads (SELECT ... FOR UPDATE and SELECT ... LOCK IN SHARE MODE)</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-predicate-locks">14.2.2.6 Predicate Locking for Spatial Indexes</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-locks-set">14.2.2.7 Locks Set by Different SQL Statements in InnoDB</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-implicit-commit">14.2.2.8 Implicit Transaction Commit and Rollback</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-deadlock-detection">14.2.2.9 Deadlock Detection and Rollback</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-deadlocks">14.2.2.10 How to Cope with Deadlocks</a></span></dt></dl>
</div>
<a class="indexterm" name="idm140644117004896"></a><a class="indexterm" name="idm140644117003408"></a><a class="indexterm" name="idm140644117001920"></a><a class="indexterm" name="idm140644117000432"></a><a class="indexterm" name="idm140644116999360"></a><p>
      To implement a large-scale, busy, or highly reliable database
      application, to port substantial code from a different database
      system, or to tune MySQL performance, you must understand the
      notions of <a class="link" href="glossary.html#glos_transaction" title="transaction">transactions</a>
      and <a class="link" href="glossary.html#glos_locking" title="locking">locking</a> as they relate to
      the InnoDB storage engine.
    </p><p>
      In the <code class="literal">InnoDB</code> transaction model, the goal is to
      combine the best properties of a multi-versioning database with
      traditional two-phase locking. <code class="literal">InnoDB</code> does
      locking on the row level and runs queries as nonlocking consistent
      reads by default, in the style of Oracle. The lock information in
      <code class="literal">InnoDB</code> is stored so space-efficiently that lock
      escalation is not needed: Typically, several users are permitted
      to lock every row in <code class="literal">InnoDB</code> tables, or any
      random subset of the rows, without causing
      <code class="literal">InnoDB</code> memory exhaustion.
    </p><p>
      In <code class="literal">InnoDB</code>, all user activity occurs inside a
      transaction. If autocommit mode is enabled, each SQL statement
      forms a single transaction on its own. By default, MySQL starts
      the session for each new connection with autocommit enabled, so
      MySQL does a commit after each SQL statement if that statement did
      not return an error. If a statement returns an error, the commit
      or rollback behavior depends on the error. See
      <a class="xref" href="innodb-storage-engine.html#innodb-error-handling" title="14.18.4 InnoDB Error Handling">Section 14.18.4, “InnoDB Error Handling”</a>.
    </p><p>
      A session that has autocommit enabled can perform a
      multiple-statement transaction by starting it with an explicit
      <a class="link" href="sql-syntax.html#commit" title="13.3.1 START TRANSACTION, COMMIT, and ROLLBACK Syntax"><code class="literal">START
      TRANSACTION</code></a> or
      <a class="link" href="sql-syntax.html#commit" title="13.3.1 START TRANSACTION, COMMIT, and ROLLBACK Syntax"><code class="literal">BEGIN</code></a> statement
      and ending it with a <a class="link" href="sql-syntax.html#commit" title="13.3.1 START TRANSACTION, COMMIT, and ROLLBACK Syntax"><code class="literal">COMMIT</code></a> or
      <a class="link" href="sql-syntax.html#commit" title="13.3.1 START TRANSACTION, COMMIT, and ROLLBACK Syntax"><code class="literal">ROLLBACK</code></a>
      statement. See <a class="xref" href="sql-syntax.html#commit" title="13.3.1 START TRANSACTION, COMMIT, and ROLLBACK Syntax">Section 13.3.1, “START TRANSACTION, COMMIT, and ROLLBACK Syntax”</a>.
    </p><p>
      If autocommit mode is disabled within a session with <code class="literal">SET
      autocommit = 0</code>, the session always has a transaction
      open. A <a class="link" href="sql-syntax.html#commit" title="13.3.1 START TRANSACTION, COMMIT, and ROLLBACK Syntax"><code class="literal">COMMIT</code></a> or
      <a class="link" href="sql-syntax.html#commit" title="13.3.1 START TRANSACTION, COMMIT, and ROLLBACK Syntax"><code class="literal">ROLLBACK</code></a>
      statement ends the current transaction and a new one starts.
    </p><p>
      A <a class="link" href="sql-syntax.html#commit" title="13.3.1 START TRANSACTION, COMMIT, and ROLLBACK Syntax"><code class="literal">COMMIT</code></a> means that the changes
      made in the current transaction are made permanent and become
      visible to other sessions. A
      <a class="link" href="sql-syntax.html#commit" title="13.3.1 START TRANSACTION, COMMIT, and ROLLBACK Syntax"><code class="literal">ROLLBACK</code></a>
      statement, on the other hand, cancels all modifications made by
      the current transaction. Both
      <a class="link" href="sql-syntax.html#commit" title="13.3.1 START TRANSACTION, COMMIT, and ROLLBACK Syntax"><code class="literal">COMMIT</code></a> and
      <a class="link" href="sql-syntax.html#commit" title="13.3.1 START TRANSACTION, COMMIT, and ROLLBACK Syntax"><code class="literal">ROLLBACK</code></a> release
      all <code class="literal">InnoDB</code> locks that were set during the
      current transaction.
    </p><p>
      In terms of the SQL:1992 transaction
      <a class="link" href="glossary.html#glos_isolation_level" title="isolation level">isolation levels</a>, the
      default <code class="literal">InnoDB</code> level is
      <a class="link" href="sql-syntax.html#isolevel_repeatable-read"><code class="literal">REPEATABLE READ</code></a>.
      <code class="literal">InnoDB</code> offers all four transaction isolation
      levels described by the SQL standard:
      <a class="link" href="sql-syntax.html#isolevel_read-uncommitted"><code class="literal">READ UNCOMMITTED</code></a>,
      <a class="link" href="sql-syntax.html#isolevel_read-committed"><code class="literal">READ COMMITTED</code></a>,
      <a class="link" href="sql-syntax.html#isolevel_repeatable-read"><code class="literal">REPEATABLE READ</code></a>, and
      <a class="link" href="sql-syntax.html#isolevel_serializable"><code class="literal">SERIALIZABLE</code></a>.
    </p><p>
      A user can change the isolation level for a single session or for
      all subsequent connections with the <a class="link" href="sql-syntax.html#set-transaction" title="13.3.6 SET TRANSACTION Syntax"><code class="literal">SET
      TRANSACTION</code></a> statement. To set the server's default
      isolation level for all connections, use the
      <a class="link" href="server-administration.html#option_mysqld_transaction-isolation"><code class="option">--transaction-isolation</code></a> option on
      the command line or in an option file. For detailed information
      about isolation levels and level-setting syntax, see
      <a class="xref" href="sql-syntax.html#set-transaction" title="13.3.6 SET TRANSACTION Syntax">Section 13.3.6, “SET TRANSACTION Syntax”</a>.
    </p><a class="indexterm" name="idm140644116960272"></a><a class="indexterm" name="idm140644116958784"></a><a class="indexterm" name="idm140644116957296"></a><a class="indexterm" name="idm140644116955808"></a><a class="indexterm" name="idm140644116954320"></a><a class="indexterm" name="idm140644116952832"></a><a class="indexterm" name="idm140644116951344"></a><a class="indexterm" name="idm140644116949856"></a><p>
      In <a class="link" href="glossary.html#glos_row_level_locking" title="row-level locking">row-level
      locking</a>, <code class="literal">InnoDB</code> normally uses next-key
      locking. That means that besides index records,
      <code class="literal">InnoDB</code> can also lock the
      <a class="link" href="glossary.html#glos_gap" title="gap">gap</a> preceding an index record to
      block insertions by other sessions where the indexed values would
      be inserted in that gap within the tree data structure. A next-key
      lock refers to a lock that locks an index record and the gap
      before it. A gap lock refers to a lock that locks only the gap
      before some index record.
    </p><p>
      For more information about row-level locking, and the
      circumstances under which gap locking is disabled, see
      <a class="xref" href="innodb-storage-engine.html#innodb-record-level-locks" title="14.2.2.2 InnoDB Record, Gap, and Next-Key Locks">Section 14.2.2.2, “InnoDB Record, Gap, and Next-Key Locks”</a>.
    </p><p>
      To handle locking for operations involving
      <code class="literal">SPATIAL</code> indexes, next-key locking does not work
      well to support <a class="link" href="sql-syntax.html#isolevel_repeatable-read"><code class="literal">REPEATABLE READ</code></a>
      or <a class="link" href="sql-syntax.html#isolevel_serializable"><code class="literal">SERIALIZABLE</code></a> transaction
      isolation levels. In this case, <code class="literal">InnoDB</code> uses
      predicate locking. See <a class="xref" href="innodb-storage-engine.html#innodb-predicate-locks" title="14.2.2.6 Predicate Locking for Spatial Indexes">Section 14.2.2.6, “Predicate Locking for Spatial Indexes”</a>.
</p>
<div class="section">

<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="innodb-lock-modes"></a>14.2.2.1 InnoDB Lock Modes</h4>
</div>
</div>
</div>
<a class="indexterm" name="idm140644116936768"></a><a class="indexterm" name="idm140644116935280"></a><p>
        <code class="literal">InnoDB</code> implements standard row-level locking
        where there are two types of locks,
        <a class="link" href="glossary.html#glos_shared_lock" title="shared lock">shared
        (<em class="replaceable"><code>S</code></em>) locks</a> and
        <a class="link" href="glossary.html#glos_exclusive_lock" title="exclusive lock">exclusive
        (<em class="replaceable"><code>X</code></em>) locks</a>. For information
        about record, gap, and next-key lock types, see
        <a class="xref" href="innodb-storage-engine.html#innodb-record-level-locks" title="14.2.2.2 InnoDB Record, Gap, and Next-Key Locks">Section 14.2.2.2, “InnoDB Record, Gap, and Next-Key Locks”</a>.
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            A <a class="link" href="glossary.html#glos_shared_lock" title="shared lock">shared
            (<em class="replaceable"><code>S</code></em>) lock</a> permits the
            transaction that holds the lock to read a row.
          </p></li><li class="listitem"><p>
            An <a class="link" href="glossary.html#glos_exclusive_lock" title="exclusive lock">exclusive
            (<em class="replaceable"><code>X</code></em>) lock</a> permits the
            transaction that holds the lock to update or delete a row.
</p></li></ul>
</div>
<p>
        If transaction <code class="literal">T1</code> holds a shared
        (<em class="replaceable"><code>S</code></em>) lock on row <code class="literal">r</code>,
        then requests from some distinct transaction
        <code class="literal">T2</code> for a lock on row <code class="literal">r</code> are
        handled as follows:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            A request by <code class="literal">T2</code> for an
            <em class="replaceable"><code>S</code></em> lock can be granted
            immediately. As a result, both <code class="literal">T1</code> and
            <code class="literal">T2</code> hold an <em class="replaceable"><code>S</code></em>
            lock on <code class="literal">r</code>.
          </p></li><li class="listitem"><p>
            A request by <code class="literal">T2</code> for an
            <em class="replaceable"><code>X</code></em> lock cannot be granted
            immediately.
</p></li></ul>
</div>
<p>
        If a transaction <code class="literal">T1</code> holds an exclusive
        (<em class="replaceable"><code>X</code></em>) lock on row <code class="literal">r</code>,
        a request from some distinct transaction <code class="literal">T2</code>
        for a lock of either type on <code class="literal">r</code> cannot be
        granted immediately. Instead, transaction <code class="literal">T2</code>
        has to wait for transaction <code class="literal">T1</code> to release its
        lock on row <code class="literal">r</code>.
</p>
<h5><a name="idm140644116908544"></a>Intention Locks</h5>
<p>
        Additionally, <code class="literal">InnoDB</code> supports
        <span class="emphasis"><em>multiple granularity locking</em></span> which permits
        coexistence of record locks and locks on entire tables. To make
        locking at multiple granularity levels practical, additional
        types of locks called
        <a class="link" href="glossary.html#glos_intention_lock" title="intention lock">intention locks</a> are
        used. Intention locks are table locks in
        <code class="literal">InnoDB</code> that indicate which type of lock
        (shared or exclusive) a transaction will require later for a row
        in that table. There are two types of intention locks used in
        <code class="literal">InnoDB</code> (assume that transaction
        <code class="literal">T</code> has requested a lock of the indicated type
        on table <code class="literal">t</code>):
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <a class="link" href="glossary.html#glos_intention_shared_lock" title="intention shared lock">Intention
            shared</a> (<em class="replaceable"><code>IS</code></em>): Transaction
            <code class="literal">T</code> intends to set
            <em class="replaceable"><code>S</code></em> locks on individual rows in
            table <code class="literal">t</code>.
          </p></li><li class="listitem"><p>
            <a class="link" href="glossary.html#glos_intention_exclusive_lock" title="intention exclusive lock">Intention
            exclusive</a> (<em class="replaceable"><code>IX</code></em>):
            Transaction <code class="literal">T</code> intends to set
            <em class="replaceable"><code>X</code></em> locks on those rows.
</p></li></ul>
</div>
<p>
        For example, <a class="link" href="sql-syntax.html#select" title="13.2.9 SELECT Syntax"><code class="literal">SELECT ...
        LOCK IN SHARE MODE</code></a> sets an
        <em class="replaceable"><code>IS</code></em> lock and
        <a class="link" href="sql-syntax.html#select" title="13.2.9 SELECT Syntax"><code class="literal">SELECT ... FOR
        UPDATE</code></a> sets an <em class="replaceable"><code>IX</code></em> lock.
      </p><p>
        The intention locking protocol is as follows:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            Before a transaction can acquire an
            <em class="replaceable"><code>S</code></em> lock on a row in table
            <code class="literal">t</code>, it must first acquire an
            <em class="replaceable"><code>IS</code></em> or stronger lock on
            <code class="literal">t</code>.
          </p></li><li class="listitem"><p>
            Before a transaction can acquire an
            <em class="replaceable"><code>X</code></em> lock on a row, it must first
            acquire an <em class="replaceable"><code>IX</code></em> lock on
            <code class="literal">t</code>.
</p></li></ul>
</div>
<p>
        These rules can be conveniently summarized by means of the
        following <span class="emphasis"><em>lock type compatibility matrix</em></span>.
</p>
<div class="informaltable">
<table summary=' Compatibility matrix showing which combinations of
          lock types X, IX, S, and IS are allowed. Each cell in the
          matrix is marked as either "Compatible" or "Conflict".
' border="1"><colgroup><col><col><col><col><col></colgroup><thead><tr><th scope="col"> </th><th scope="col"><em class="replaceable"><code>X</code></em></th><th scope="col"><em class="replaceable"><code>IX</code></em></th><th scope="col"><em class="replaceable"><code>S</code></em></th><th scope="col"><em class="replaceable"><code>IS</code></em></th></tr></thead><tbody><tr><td scope="row"><em class="replaceable"><code>X</code></em></td><td>Conflict</td><td>Conflict</td><td>Conflict</td><td>Conflict</td></tr><tr><td scope="row"><em class="replaceable"><code>IX</code></em></td><td>Conflict</td><td>Compatible</td><td>Conflict</td><td>Compatible</td></tr><tr><td scope="row"><em class="replaceable"><code>S</code></em></td><td>Conflict</td><td>Conflict</td><td>Compatible</td><td>Compatible</td></tr><tr><td scope="row"><em class="replaceable"><code>IS</code></em></td><td>Conflict</td><td>Compatible</td><td>Compatible</td><td>Compatible</td></tr></tbody></table>
</div>
<p>
        A lock is granted to a requesting transaction if it is
        compatible with existing locks, but not if it conflicts with
        existing locks. A transaction waits until the conflicting
        existing lock is released. If a lock request conflicts with an
        existing lock and cannot be granted because it would cause
        <a class="link" href="glossary.html#glos_deadlock" title="deadlock">deadlock</a>, an error occurs.
      </p><p>
        Thus, intention locks do not block anything except full table
        requests (for example, <code class="literal">LOCK TABLES ...
        WRITE</code>). The main purpose of
        <em class="replaceable"><code>IX</code></em> and <em class="replaceable"><code>IS</code></em>
        locks is to show that someone is locking a row, or going to lock
        a row in the table.
</p>
<h5><a name="idm140644116861184"></a>Deadlock Example</h5>
<p>
        The following example illustrates how an error can occur when a
        lock request would cause a deadlock. The example involves two
        clients, A and B.
      </p><p>
        First, client A creates a table containing one row, and then
        begins a transaction. Within the transaction, A obtains an
        <em class="replaceable"><code>S</code></em> lock on the row by selecting it in
        share mode:
      </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>CREATE TABLE t (i INT) ENGINE = InnoDB;</code></strong>
Query OK, 0 rows affected (1.07 sec)

mysql&gt; <strong class="userinput"><code>INSERT INTO t (i) VALUES(1);</code></strong>
Query OK, 1 row affected (0.09 sec)

mysql&gt; <strong class="userinput"><code>START TRANSACTION;</code></strong>
Query OK, 0 rows affected (0.00 sec)

mysql&gt; <strong class="userinput"><code>SELECT * FROM t WHERE i = 1 LOCK IN SHARE MODE;</code></strong>
+------+
| i    |
+------+
|    1 |
+------+</pre><p>
        Next, client B begins a transaction and attempts to delete the
        row from the table:
      </p><pre class="programlisting">
mysql&gt; <strong class="userinput"><code>START TRANSACTION;</code></strong>
Query OK, 0 rows affected (0.00 sec)

mysql&gt; <strong class="userinput"><code>DELETE FROM t WHERE i = 1;</code></strong>
</pre><p>
        The delete operation requires an <em class="replaceable"><code>X</code></em>
        lock. The lock cannot be granted because it is incompatible with
        the <em class="replaceable"><code>S</code></em> lock that client A holds, so
        the request goes on the queue of lock requests for the row and
        client B blocks.
      </p><p>
        Finally, client A also attempts to delete the row from the
        table:
      </p><pre class="programlisting">
mysql&gt; <strong class="userinput"><code>DELETE FROM t WHERE i = 1;</code></strong>
ERROR 1213 (40001): Deadlock found when trying to get lock;
try restarting transaction
</pre><p>
        Deadlock occurs here because client A needs an
        <em class="replaceable"><code>X</code></em> lock to delete the row. However,
        that lock request cannot be granted because client B already has
        a request for an <em class="replaceable"><code>X</code></em> lock and is
        waiting for client A to release its <em class="replaceable"><code>S</code></em>
        lock. Nor can the <em class="replaceable"><code>S</code></em> lock held by A be
        upgraded to an <em class="replaceable"><code>X</code></em> lock because of the
        prior request by B for an <em class="replaceable"><code>X</code></em> lock. As
        a result, <code class="literal">InnoDB</code> generates an error for one
        of the clients and releases its locks. The client returns this
        error:
      </p><pre class="programlisting">
ERROR 1213 (40001): Deadlock found when trying to get lock;
try restarting transaction
</pre><p>
        At that point, the lock request for the other client can be
        granted and it deletes the row from the table.
</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
          If the <code class="literal">LATEST DETECTED DEADLOCK</code> section of
          InnoDB Monitor output includes a message stating,
          <span class="quote">“<span class="quote"><span class="errortext">TOO DEEP OR LONG SEARCH IN THE LOCK TABLE
          WAITS-FOR GRAPH, WE WILL ROLL BACK FOLLOWING
          TRANSACTION</span>,</span>”</span> this indicates that the
          number of transactions on the wait-for list has reached a
          limit of 200, which is defined by
          <code class="literal">LOCK_MAX_DEPTH_IN_DEADLOCK_CHECK</code>. A
          wait-for list that exceeds 200 transactions is treated as a
          deadlock and the transaction attempting to check the wait-for
          list is rolled back.
        </p><p>
          The same error may also occur if the locking thread must look
          at more than 1,000,000 locks owned by the transactions on the
          wait-for list. The limit of 1,000,000 locks is defined by
          <code class="literal">LOCK_MAX_N_STEPS_IN_DEADLOCK_CHECK</code>.
</p>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="innodb-record-level-locks"></a>14.2.2.2 InnoDB Record, Gap, and Next-Key Locks</h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140644116837424"></a><a class="indexterm" name="idm140644116835936"></a><a class="indexterm" name="idm140644116834448"></a><a class="indexterm" name="idm140644116832960"></a><a class="indexterm" name="idm140644116831472"></a><a class="indexterm" name="idm140644116829984"></a><a class="indexterm" name="idm140644116828496"></a><a class="indexterm" name="idm140644116827008"></a><p>
        <code class="literal">InnoDB</code> has several types of record-level
        locks including record locks, gap locks, and next-key locks. For
        information about shared locks, exclusive locks, and intention
        locks, see <a class="xref" href="innodb-storage-engine.html#innodb-lock-modes" title="14.2.2.1 InnoDB Lock Modes">Section 14.2.2.1, “InnoDB Lock Modes”</a>.
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            Record lock: This is a lock on an index record.
          </p></li><li class="listitem"><p>
            Gap lock: This is a lock on a gap between index records, or
            a lock on the gap before the first or after the last index
            record.
          </p></li><li class="listitem"><p>
            Next-key lock: This is a combination of a record lock on the
            index record and a gap lock on the gap before the index
            record.
</p></li></ul>
</div>
<h5><a name="idm140644116820288"></a>Record Locks</h5>
<p>
        Record locks always lock index records, even if a table is
        defined with no indexes. For such cases,
        <code class="literal">InnoDB</code> creates a hidden clustered index and
        uses this index for record locking. See
        <a class="xref" href="innodb-storage-engine.html#innodb-index-types" title="14.2.7.2 Clustered and Secondary Indexes">Section 14.2.7.2, “Clustered and Secondary Indexes”</a>.
</p>
<h5><a name="idm140644116817424"></a>Next-key Locks</h5>
<p>
        By default, <code class="literal">InnoDB</code> operates in
        <a class="link" href="sql-syntax.html#isolevel_repeatable-read"><code class="literal">REPEATABLE READ</code></a> transaction
        isolation level. In this case, <code class="literal">InnoDB</code> uses
        next-key locks for searches and index scans, which prevents
        phantom rows (see <a class="xref" href="innodb-storage-engine.html#innodb-next-key-locking" title="14.2.2.3 Avoiding the Phantom Problem Using Next-Key Locking">Section 14.2.2.3, “Avoiding the Phantom Problem Using Next-Key Locking”</a>).
      </p><p>
        Next-key locking combines index-row locking with gap locking.
        <code class="literal">InnoDB</code> performs row-level locking in such a
        way that when it searches or scans a table index, it sets shared
        or exclusive locks on the index records it encounters. Thus, the
        row-level locks are actually index-record locks. In addition, a
        next-key lock on an index record also affects the
        <span class="quote">“<span class="quote">gap</span>”</span> before that index record. That is, a next-key
        lock is an index-record lock plus a gap lock on the gap
        preceding the index record. If one session has a shared or
        exclusive lock on record <code class="literal">R</code> in an index,
        another session cannot insert a new index record in the gap
        immediately before <code class="literal">R</code> in the index order.
      </p><p>
        Suppose that an index contains the values 10, 11, 13, and 20.
        The possible next-key locks for this index cover the following
        intervals, where a round bracket denotes exclusion of the
        interval endpoint and a square bracket denotes inclusion of the
        endpoint:
      </p><pre class="programlisting">
(negative infinity, 10]
(10, 11]
(11, 13]
(13, 20]
(20, positive infinity)
</pre><p>
        For the last interval, the next-key lock locks the gap above the
        largest value in the index and the <span class="quote">“<span class="quote">supremum</span>”</span>
        pseudo-record having a value higher than any value actually in
        the index. The supremum is not a real index record, so, in
        effect, this next-key lock locks only the gap following the
        largest index value.
</p>
<h5><a name="idm140644116806416"></a>Gap Locks</h5>
<p>
        The next-key locking example in the previous section shows that
        a gap might span a single index value, multiple index values, or
        even be empty.
      </p><p>
        Gap locking is not needed for statements that lock rows using a
        unique index to search for a unique row. (This does not include
        the case that the search condition includes only some columns of
        a multiple-column unique index; in that case, gap locking does
        occur.) For example, if the <code class="literal">id</code> column has a
        unique index, the following statement uses only an index-record
        lock for the row having <code class="literal">id</code> value 100 and it
        does not matter whether other sessions insert rows in the
        preceding gap:
      </p><pre class="programlisting">
SELECT * FROM child WHERE id = 100;
</pre><p>
        If <code class="literal">id</code> is not indexed or has a nonunique
        index, the statement does lock the preceding gap.
      </p><p>
        It is also worth noting here that conflicting locks can be held
        on a gap by different transactions. For example, transaction A
        can hold a shared gap lock (gap S-lock) on a gap while
        transaction B holds an exclusive gap lock (gap X-lock) on the
        same gap. The reason conflicting gap locks are allowed is that
        if a record is purged from an index, the gap locks held on the
        record by different transactions must be merged.
      </p><p>
        Gap locks in <code class="literal">InnoDB</code> are <span class="quote">“<span class="quote">purely
        inhibitive</span>”</span>, which means they only stop other
        transactions from inserting to the gap. They do not prevent
        different transactions from taking gap locks on the same gap.
        Thus, a gap X-lock has the same effect as a gap S-lock.
      </p><p>
        A type of gap lock called an <span class="bold"><strong>insert
        intention</strong></span> gap lock is set by
        <a class="link" href="sql-syntax.html#insert" title="13.2.5 INSERT Syntax"><code class="literal">INSERT</code></a> operations prior to row
        insertion. This lock signals the intent to insert in such a way
        that multiple transactions inserting into the same index gap
        need not wait for each other if they are not inserting at the
        same position within the gap. Suppose that there are index
        records with values of 4 and 7. Separate transactions that
        attempt to insert values of 5 and 6, respectively, each lock the
        gap between 4 and 7 with insert intention locks prior to
        obtaining the exclusive lock on the inserted row, but do not
        block each other because the rows are nonconflicting.
      </p><p>
        The following example demonstrates a transaction taking an
        insert intention lock prior to obtaining an exclusive lock on
        the inserted record. The example involves two clients, A and B.
      </p><p>
        Client A creates a table containing two index records (90 and
        102) and then starts a transaction that places an exclusive lock
        on index records with an ID greater than 100. The exclusive lock
        includes a gap lock before record 102:
      </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>CREATE TABLE child (id int(11) NOT NULL, PRIMARY KEY(id)) ENGINE=InnoDB;</code></strong>
mysql&gt; <strong class="userinput"><code>INSERT INTO child (id) values (90),(102);</code></strong>

mysql&gt; <strong class="userinput"><code>START TRANSACTION;</code></strong>
mysql&gt; <strong class="userinput"><code>SELECT * FROM child WHERE id &gt; 100 FOR UPDATE;</code></strong>
+-----+
| id  |
+-----+
| 102 |
+-----+</pre><p>
        Client B begins a transaction to insert a record into the gap.
        The transaction takes an insert intention lock while it waits to
        obtain an exclusive lock.
      </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>START TRANSACTION;</code></strong>
mysql&gt; <strong class="userinput"><code>INSERT INTO child (id) VALUES (101);</code></strong></pre><p>
        To view data about the insert intention lock, run
        <a class="link" href="sql-syntax.html#show-engine" title="13.7.5.15 SHOW ENGINE Syntax"><code class="literal">SHOW ENGINE INNODB
        STATUS</code></a>. Data similar to the following appears under
        the <code class="literal">TRANSACTIONS</code> heading:
      </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SHOW ENGINE INNODB STATUS\G</code></strong>  
...
SHOW ENGINE INNODB STATUS
---TRANSACTION 8731, ACTIVE 7 sec inserting
mysql tables in use 1, locked 1
LOCK WAIT 2 lock struct(s), heap size 360, 1 row lock(s)
MySQL thread id 3, OS thread handle 0x7f996beac700, query id 30 localhost root update
INSERT INTO child (id) VALUES (101)
------- TRX HAS BEEN WAITING 7 SEC FOR THIS LOCK TO BE GRANTED:
RECORD LOCKS space id 31 page no 3 n bits 72 index `PRIMARY` of table `test`.`child` 
trx id 8731 lock_mode X locks gap before rec <span class="bold"><strong>insert intention</strong></span> waiting
Record lock, heap no 3 PHYSICAL RECORD: n_fields 3; compact format; info bits 0
 0: len 4; hex 80000066; asc    f;;
 1: len 6; hex 000000002215; asc     " ;;
2: len 7; hex 9000000172011c; asc     r  ;;...</pre>
<h5><a name="idm140644116781856"></a>Disabling Gap Locking</h5>
<p>
        Gap locking can be disabled explicitly. This occurs if you
        change the transaction isolation level to
        <a class="link" href="sql-syntax.html#isolevel_read-committed"><code class="literal">READ COMMITTED</code></a> or enable the
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_locks_unsafe_for_binlog"><code class="literal">innodb_locks_unsafe_for_binlog</code></a>
        system variable (which is now deprecated). Under these
        circumstances, gap locking is disabled for searches and index
        scans and is used only for foreign-key constraint checking and
        duplicate-key checking.
      </p><p>
        There are also other effects of using the
        <a class="link" href="sql-syntax.html#isolevel_read-committed"><code class="literal">READ COMMITTED</code></a> isolation
        level or enabling
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_locks_unsafe_for_binlog"><code class="literal">innodb_locks_unsafe_for_binlog</code></a>:
        Record locks for nonmatching rows are released after MySQL has
        evaluated the <code class="literal">WHERE</code> condition. For
        <code class="literal">UPDATE</code> statements, <code class="literal">InnoDB</code>
        does a <span class="quote">“<span class="quote">semi-consistent</span>”</span> read, such that it returns
        the latest committed version to MySQL so that MySQL can
        determine whether the row matches the <code class="literal">WHERE</code>
        condition of the <a class="link" href="sql-syntax.html#update" title="13.2.11 UPDATE Syntax"><code class="literal">UPDATE</code></a>.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="innodb-next-key-locking"></a>14.2.2.3 Avoiding the Phantom Problem Using Next-Key Locking</h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140644116768800"></a><a class="indexterm" name="idm140644116767760"></a><a class="indexterm" name="idm140644116766272"></a><a class="indexterm" name="idm140644116764784"></a><a class="indexterm" name="idm140644116763296"></a><a class="indexterm" name="idm140644116761808"></a><a class="indexterm" name="idm140644116760320"></a><a class="indexterm" name="idm140644116758832"></a><a class="indexterm" name="idm140644116757344"></a><p>
        The so-called <span class="firstterm">phantom</span>
        problem occurs within a transaction when the same query produces
        different sets of rows at different times. For example, if a
        <a class="link" href="sql-syntax.html#select" title="13.2.9 SELECT Syntax"><code class="literal">SELECT</code></a> is executed twice, but
        returns a row the second time that was not returned the first
        time, the row is a <span class="quote">“<span class="quote">phantom</span>”</span> row.
      </p><p>
        Suppose that there is an index on the <code class="literal">id</code>
        column of the <code class="literal">child</code> table and that you want
        to read and lock all rows from the table having an identifier
        value larger than 100, with the intention of updating some
        column in the selected rows later:
      </p><pre class="programlisting">
SELECT * FROM child WHERE id &gt; 100 FOR UPDATE;
</pre><p>
        The query scans the index starting from the first record where
        <code class="literal">id</code> is bigger than 100. Let the table contain
        rows having <code class="literal">id</code> values of 90 and 102. If the
        locks set on the index records in the scanned range do not lock
        out inserts made in the gaps (in this case, the gap between 90
        and 102), another session can insert a new row into the table
        with an <code class="literal">id</code> of 101. If you were to execute the
        same <a class="link" href="sql-syntax.html#select" title="13.2.9 SELECT Syntax"><code class="literal">SELECT</code></a> within the same
        transaction, you would see a new row with an
        <code class="literal">id</code> of 101 (a <span class="quote">“<span class="quote">phantom</span>”</span>) in the
        result set returned by the query. If we regard a set of rows as
        a data item, the new phantom child would violate the isolation
        principle of transactions that a transaction should be able to
        run so that the data it has read does not change during the
        transaction.
      </p><p>
        To prevent phantoms, <code class="literal">InnoDB</code> uses an algorithm
        called <span class="firstterm">next-key locking</span>
        that combines index-row locking with gap locking.
        <code class="literal">InnoDB</code> performs row-level locking in such a
        way that when it searches or scans a table index, it sets shared
        or exclusive locks on the index records it encounters. Thus, the
        row-level locks are actually index-record locks. In addition, a
        next-key lock on an index record also affects the
        <span class="quote">“<span class="quote">gap</span>”</span> before that index record. That is, a next-key
        lock is an index-record lock plus a gap lock on the gap
        preceding the index record. If one session has a shared or
        exclusive lock on record <code class="literal">R</code> in an index,
        another session cannot insert a new index record in the gap
        immediately before <code class="literal">R</code> in the index order.
      </p><p>
        When <code class="literal">InnoDB</code> scans an index, it can also lock
        the gap after the last record in the index. Just that happens in
        the preceding example: To prevent any insert into the table
        where <code class="literal">id</code> would be bigger than 100, the locks
        set by <code class="literal">InnoDB</code> include a lock on the gap
        following <code class="literal">id</code> value 102.
      </p><p>
        You can use next-key locking to implement a uniqueness check in
        your application: If you read your data in share mode and do not
        see a duplicate for a row you are going to insert, then you can
        safely insert your row and know that the next-key lock set on
        the successor of your row during the read prevents anyone
        meanwhile inserting a duplicate for your row. Thus, the next-key
        locking enables you to <span class="quote">“<span class="quote">lock</span>”</span> the nonexistence of
        something in your table.
      </p><p>
        Gap locking can be disabled as discussed in
        <a class="xref" href="innodb-storage-engine.html#innodb-record-level-locks" title="14.2.2.2 InnoDB Record, Gap, and Next-Key Locks">Section 14.2.2.2, “InnoDB Record, Gap, and Next-Key Locks”</a>. This may cause
        phantom problems because other sessions can insert new rows into
        the gaps when gap locking is disabled.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="innodb-consistent-read"></a>14.2.2.4 Consistent Nonlocking Reads</h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140644116731952"></a><a class="indexterm" name="idm140644116730496"></a><p>
        A <a class="link" href="glossary.html#glos_consistent_read" title="consistent read">consistent read</a>
        means that <code class="literal">InnoDB</code> uses multi-versioning to
        present to a query a snapshot of the database at a point in
        time. The query sees the changes made by transactions that
        committed before that point of time, and no changes made by
        later or uncommitted transactions. The exception to this rule is
        that the query sees the changes made by earlier statements
        within the same transaction. This exception causes the following
        anomaly: If you update some rows in a table, a
        <a class="link" href="sql-syntax.html#select" title="13.2.9 SELECT Syntax"><code class="literal">SELECT</code></a> sees the latest version of
        the updated rows, but it might also see older versions of any
        rows. If other sessions simultaneously update the same table,
        the anomaly means that you might see the table in a state that
        never existed in the database.
      </p><p>
        If the transaction
        <a class="link" href="glossary.html#glos_isolation_level" title="isolation level">isolation level</a> is
        <a class="link" href="sql-syntax.html#isolevel_repeatable-read"><code class="literal">REPEATABLE READ</code></a> (the default
        level), all consistent reads within the same transaction read
        the snapshot established by the first such read in that
        transaction. You can get a fresher snapshot for your queries by
        committing the current transaction and after that issuing new
        queries.
      </p><p>
        With <a class="link" href="sql-syntax.html#isolevel_read-committed"><code class="literal">READ COMMITTED</code></a> isolation
        level, each consistent read within a transaction sets and reads
        its own fresh snapshot.
      </p><p>
        Consistent read is the default mode in which
        <code class="literal">InnoDB</code> processes
        <a class="link" href="sql-syntax.html#select" title="13.2.9 SELECT Syntax"><code class="literal">SELECT</code></a> statements in
        <a class="link" href="sql-syntax.html#isolevel_read-committed"><code class="literal">READ COMMITTED</code></a> and
        <a class="link" href="sql-syntax.html#isolevel_repeatable-read"><code class="literal">REPEATABLE READ</code></a> isolation
        levels. A consistent read does not set any locks on the tables
        it accesses, and therefore other sessions are free to modify
        those tables at the same time a consistent read is being
        performed on the table.
      </p><p>
        Suppose that you are running in the default
        <a class="link" href="sql-syntax.html#isolevel_repeatable-read"><code class="literal">REPEATABLE READ</code></a> isolation
        level. When you issue a consistent read (that is, an ordinary
        <a class="link" href="sql-syntax.html#select" title="13.2.9 SELECT Syntax"><code class="literal">SELECT</code></a> statement),
        <code class="literal">InnoDB</code> gives your transaction a timepoint
        according to which your query sees the database. If another
        transaction deletes a row and commits after your timepoint was
        assigned, you do not see the row as having been deleted. Inserts
        and updates are treated similarly.
</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
          The snapshot of the database state applies to
          <a class="link" href="sql-syntax.html#select" title="13.2.9 SELECT Syntax"><code class="literal">SELECT</code></a> statements within a
          transaction, not necessarily to
          <a class="link" href="glossary.html#glos_dml" title="DML">DML</a> statements. If you insert
          or modify some rows and then commit that transaction, a
          <a class="link" href="sql-syntax.html#delete" title="13.2.2 DELETE Syntax"><code class="literal">DELETE</code></a> or
          <a class="link" href="sql-syntax.html#update" title="13.2.11 UPDATE Syntax"><code class="literal">UPDATE</code></a> statement issued from
          another concurrent <code class="literal">REPEATABLE READ</code>
          transaction could affect those just-committed rows, even
          though the session could not query them. If a transaction does
          update or delete rows committed by a different transaction,
          those changes do become visible to the current transaction.
          For example, you might encounter a situation like the
          following:
        </p><pre class="programlisting">
SELECT COUNT(c1) FROM t1 WHERE c1 = 'xyz'; -- Returns 0: no rows match.
DELETE FROM t1 WHERE c1 = 'xyz'; -- Deletes several rows recently committed by other transaction.

SELECT COUNT(c2) FROM t1 WHERE c2 = 'abc'; -- Returns 0: no rows match.
UPDATE t1 SET c2 = 'cba' WHERE c2 = 'abc'; -- Affects 10 rows: another txn just committed 10 rows with 'abc' values.
SELECT COUNT(c2) FROM t1 WHERE c2 = 'cba'; -- Returns 10: this txn can now see the rows it just updated.
</pre>
</div>
<p>
        You can advance your timepoint by committing your transaction
        and then doing another <a class="link" href="sql-syntax.html#select" title="13.2.9 SELECT Syntax"><code class="literal">SELECT</code></a> or
        <a class="link" href="sql-syntax.html#commit" title="13.3.1 START TRANSACTION, COMMIT, and ROLLBACK Syntax"><code class="literal">START TRANSACTION WITH
        CONSISTENT SNAPSHOT</code></a>.
      </p><p>
        This is called <span class="firstterm">multi-versioned
        concurrency control</span>.
      </p><p>
        In the following example, session A sees the row inserted by B
        only when B has committed the insert and A has committed as
        well, so that the timepoint is advanced past the commit of B.
      </p><pre class="programlisting">
             Session A              Session B

           SET autocommit=0;      SET autocommit=0;
time
|          SELECT * FROM t;
|          empty set
|                                 INSERT INTO t VALUES (1, 2);
|
v          SELECT * FROM t;
           empty set
                                  COMMIT;

           SELECT * FROM t;
           empty set

           COMMIT;

           SELECT * FROM t;
           ---------------------
           |    1    |    2    |
           ---------------------</pre><p>
        If you want to see the <span class="quote">“<span class="quote">freshest</span>”</span> state of the
        database, use either the <a class="link" href="sql-syntax.html#isolevel_read-committed"><code class="literal">READ
        COMMITTED</code></a> isolation level or a
        <a class="link" href="glossary.html#glos_locking_read" title="locking read">locking read</a>:
      </p><pre class="programlisting">
SELECT * FROM t LOCK IN SHARE MODE;
</pre><p>
        With <a class="link" href="sql-syntax.html#isolevel_read-committed"><code class="literal">READ COMMITTED</code></a> isolation
        level, each consistent read within a transaction sets and reads
        its own fresh snapshot. With <code class="literal">LOCK IN SHARE
        MODE</code>, a locking read occurs instead: A
        <code class="literal">SELECT</code> blocks until the transaction
        containing the freshest rows ends (see
        <a class="xref" href="innodb-storage-engine.html#innodb-locking-reads" title="14.2.2.5 Locking Reads (SELECT ... FOR UPDATE and SELECT ... LOCK IN SHARE MODE)">Section 14.2.2.5, “Locking Reads (SELECT ... FOR UPDATE and SELECT ... LOCK IN SHARE MODE)”</a>).
      </p><p>
        Consistent read does not work over certain DDL statements:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            Consistent read does not work over <a class="link" href="sql-syntax.html#drop-table" title="13.1.29 DROP TABLE Syntax"><code class="literal">DROP
            TABLE</code></a>, because MySQL cannot use a table that has
            been dropped and <code class="literal">InnoDB</code> destroys the
            table.
          </p></li><li class="listitem"><p>
            Consistent read does not work over
            <a class="link" href="sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a>, because that
            statement makes a temporary copy of the original table and
            deletes the original table when the temporary copy is built.
            When you reissue a consistent read within a transaction,
            rows in the new table are not visible because those rows did
            not exist when the transaction's snapshot was taken. In this
            case, the transaction returns an error:
            <a class="link" href="error-handling.html#error_er_table_def_changed"><code class="literal">ER_TABLE_DEF_CHANGED</code></a>,
            <span class="quote">“<span class="quote">Table definition has changed, please retry
            transaction</span>”</span>.
</p></li></ul>
</div>
<p>
        The type of read varies for selects in clauses like
        <a class="link" href="sql-syntax.html#insert" title="13.2.5 INSERT Syntax"><code class="literal">INSERT INTO ...
        SELECT</code></a>, <a class="link" href="sql-syntax.html#update" title="13.2.11 UPDATE Syntax"><code class="literal">UPDATE
        ... (SELECT)</code></a>, and
        <a class="link" href="sql-syntax.html#create-table" title="13.1.18 CREATE TABLE Syntax"><code class="literal">CREATE TABLE ...
        SELECT</code></a> that do not specify <code class="literal">FOR
        UPDATE</code> or <code class="literal">LOCK IN SHARE MODE</code>:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            By default, <code class="literal">InnoDB</code> uses stronger locks
            and the <a class="link" href="sql-syntax.html#select" title="13.2.9 SELECT Syntax"><code class="literal">SELECT</code></a> part acts like
            <a class="link" href="sql-syntax.html#isolevel_read-committed"><code class="literal">READ COMMITTED</code></a>, where
            each consistent read, even within the same transaction, sets
            and reads its own fresh snapshot.
          </p></li><li class="listitem"><p>
            To use a consistent read in such cases, enable the
            <a class="link" href="innodb-storage-engine.html#sysvar_innodb_locks_unsafe_for_binlog"><code class="literal">innodb_locks_unsafe_for_binlog</code></a>
            option and set the isolation level of the transaction to
            <a class="link" href="sql-syntax.html#isolevel_read-uncommitted"><code class="literal">READ UNCOMMITTED</code></a>,
            <a class="link" href="sql-syntax.html#isolevel_read-committed"><code class="literal">READ COMMITTED</code></a>, or
            <a class="link" href="sql-syntax.html#isolevel_repeatable-read"><code class="literal">REPEATABLE READ</code></a> (that is,
            anything other than
            <a class="link" href="sql-syntax.html#isolevel_serializable"><code class="literal">SERIALIZABLE</code></a>). In this
            case, no locks are set on rows read from the selected table.
</p></li></ul>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="innodb-locking-reads"></a>14.2.2.5 Locking Reads (SELECT ... FOR UPDATE and SELECT ... LOCK IN SHARE MODE)</h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140644116663296"></a><p>
        If you query data and then insert or update related data within
        the same transaction, the regular <code class="literal">SELECT</code>
        statement does not give enough protection. Other transactions
        can update or delete the same rows you just queried.
        <code class="literal">InnoDB</code> supports two types of
        <a class="link" href="glossary.html#glos_locking_read" title="locking read">locking reads</a> that
        offer extra safety:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <a class="link" href="sql-syntax.html#select" title="13.2.9 SELECT Syntax"><code class="literal">SELECT ... LOCK IN
            SHARE MODE</code></a> sets a shared mode lock on any rows
            that are read. Other sessions can read the rows, but cannot
            modify them until your transaction commits. If any of these
            rows were changed by another transaction that has not yet
            committed, your query waits until that transaction ends and
            then uses the latest values.
          </p></li><li class="listitem"><p>
            For index records the search encounters,
            <a class="link" href="sql-syntax.html#select" title="13.2.9 SELECT Syntax"><code class="literal">SELECT ... FOR
            UPDATE</code></a> locks the rows and any associated index
            entries, the same as if you issued an
            <code class="literal">UPDATE</code> statement for those rows. Other
            transactions are blocked from updating those rows, from
            doing <a class="link" href="sql-syntax.html#select" title="13.2.9 SELECT Syntax"><code class="literal">SELECT ...
            LOCK IN SHARE MODE</code></a>, or from reading the data in
            certain transaction isolation levels. Consistent reads
            ignore any locks set on the records that exist in the read
            view. (Old versions of a record cannot be locked; they are
            reconstructed by applying <a class="link" href="glossary.html#glos_undo_log" title="undo log">undo
            logs</a> on an in-memory copy of the record.)
</p></li></ul>
</div>
<p>
        These clauses are primarily useful when dealing with
        tree-structured or graph-structured data, either in a single
        table or split across multiple tables. You traverse edges or
        tree branches from one place to another, while reserving the
        right to come back and change any of these
        <span class="quote">“<span class="quote">pointer</span>”</span> values.
      </p><p>
        All locks set by <code class="literal">LOCK IN SHARE MODE</code> and
        <code class="literal">FOR UPDATE</code> queries are released when the
        transaction is committed or rolled back.
</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
          Locking of rows for update using <code class="literal">SELECT FOR
          UPDATE</code> only applies when autocommit is disabled
          (either by beginning transaction with
          <a class="link" href="sql-syntax.html#commit" title="13.3.1 START TRANSACTION, COMMIT, and ROLLBACK Syntax"><code class="literal">START
          TRANSACTION</code></a> or by setting
          <a class="link" href="server-administration.html#sysvar_autocommit"><code class="literal">autocommit</code></a> to 0. If
          autocommit is enabled, the rows matching the specification are
          not locked.
</p>
</div>
<h5><a name="idm140644116643376"></a>Usage Examples</h5>
<p>
        Suppose that you want to insert a new row into a table
        <code class="literal">child</code>, and make sure that the child row has a
        parent row in table <code class="literal">parent</code>. Your application
        code can ensure referential integrity throughout this sequence
        of operations.
      </p><p>
        First, use a consistent read to query the table
        <code class="literal">PARENT</code> and verify that the parent row exists.
        Can you safely insert the child row to table
        <code class="literal">CHILD</code>? No, because some other session could
        delete the parent row in the moment between your
        <code class="literal">SELECT</code> and your <code class="literal">INSERT</code>,
        without you being aware of it.
      </p><p>
        To avoid this potential issue, perform the
        <a class="link" href="sql-syntax.html#select" title="13.2.9 SELECT Syntax"><code class="literal">SELECT</code></a> using <code class="literal">LOCK IN
        SHARE MODE</code>:
      </p><pre class="programlisting">
SELECT * FROM parent WHERE NAME = 'Jones' LOCK IN SHARE MODE;
</pre><p>
        After the <code class="literal">LOCK IN SHARE MODE</code> query returns
        the parent <code class="literal">'Jones'</code>, you can safely add the
        child record to the <code class="literal">CHILD</code> table and commit
        the transaction. Any transaction that tries to read or write to
        the applicable row in the <code class="literal">PARENT</code> table waits
        until you are finished, that is, the data in all tables is in a
        consistent state.
      </p><p>
        For another example, consider an integer counter field in a
        table <code class="literal">CHILD_CODES</code>, used to assign a unique
        identifier to each child added to table
        <code class="literal">CHILD</code>. Do not use either consistent read or a
        shared mode read to read the present value of the counter,
        because two users of the database could see the same value for
        the counter, and a duplicate-key error occurs if two
        transactions attempt to add rows with the same identifier to the
        <code class="literal">CHILD</code> table.
      </p><p>
        Here, <code class="literal">LOCK IN SHARE MODE</code> is not a good
        solution because if two users read the counter at the same time,
        at least one of them ends up in deadlock when it attempts to
        update the counter.
      </p><p>
        To implement reading and incrementing the counter, first perform
        a locking read of the counter using <code class="literal">FOR
        UPDATE</code>, and then increment the counter. For example:
      </p><pre class="programlisting">
SELECT counter_field FROM child_codes FOR UPDATE;
UPDATE child_codes SET counter_field = counter_field + 1;
</pre><p>
        A <a class="link" href="sql-syntax.html#select" title="13.2.9 SELECT Syntax"><code class="literal">SELECT ... FOR
        UPDATE</code></a> reads the latest available data, setting
        exclusive locks on each row it reads. Thus, it sets the same
        locks a searched SQL <a class="link" href="sql-syntax.html#update" title="13.2.11 UPDATE Syntax"><code class="literal">UPDATE</code></a> would
        set on the rows.
      </p><p>
        The preceding description is merely an example of how
        <a class="link" href="sql-syntax.html#select" title="13.2.9 SELECT Syntax"><code class="literal">SELECT ... FOR
        UPDATE</code></a> works. In MySQL, the specific task of
        generating a unique identifier actually can be accomplished
        using only a single access to the table:
      </p><pre class="programlisting">
UPDATE child_codes SET counter_field = LAST_INSERT_ID(counter_field + 1);
SELECT LAST_INSERT_ID();
</pre><p>
        The <a class="link" href="sql-syntax.html#select" title="13.2.9 SELECT Syntax"><code class="literal">SELECT</code></a> statement merely
        retrieves the identifier information (specific to the current
        connection). It does not access any table.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="innodb-predicate-locks"></a>14.2.2.6 Predicate Locking for Spatial Indexes</h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140644116615264"></a><a class="indexterm" name="idm140644116614224"></a><p>
        As of MySQL 5.7.5, <code class="literal">InnoDB</code> supports
        <code class="literal">SPATIAL</code> indexing of columns containing
        spatial columns (see
        <a class="xref" href="data-types.html#optimizing-spatial-analysis" title="11.5.3.5 Optimizing Spatial Analysis">Section 11.5.3.5, “Optimizing Spatial Analysis”</a>).
      </p><p>
        To handle locking for operations involving
        <code class="literal">SPATIAL</code> indexes, next-key locking does not
        work well to support <a class="link" href="sql-syntax.html#isolevel_repeatable-read"><code class="literal">REPEATABLE
        READ</code></a> or
        <a class="link" href="sql-syntax.html#isolevel_serializable"><code class="literal">SERIALIZABLE</code></a> transaction
        isolation levels. There is no absolute ordering concept in
        multidimensional data, so it is not clear which is the
        <span class="quote">“<span class="quote">next</span>”</span> key.
      </p><p>
        To enable support of isolation levels for tables with
        <code class="literal">SPATIAL</code> indexes, <code class="literal">InnoDB</code>
        uses predicate locks. A <code class="literal">SPATIAL</code> index
        contains minimum bounding rectangle (MBR) values, so
        <code class="literal">InnoDB</code> enforces consistent read on the index
        by setting a predicate lock on the MBR value used for a query.
        Other transactions cannot insert or modify a row that would
        match the query condition.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="innodb-locks-set"></a>14.2.2.7 Locks Set by Different SQL Statements in InnoDB</h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140644116600752"></a><p>
        A <a class="link" href="glossary.html#glos_locking_read" title="locking read">locking read</a>, an
        <a class="link" href="sql-syntax.html#update" title="13.2.11 UPDATE Syntax"><code class="literal">UPDATE</code></a>, or a
        <a class="link" href="sql-syntax.html#delete" title="13.2.2 DELETE Syntax"><code class="literal">DELETE</code></a> generally set record locks
        on every index record that is scanned in the processing of the
        SQL statement. It does not matter whether there are
        <code class="literal">WHERE</code> conditions in the statement that would
        exclude the row. <code class="literal">InnoDB</code> does not remember the
        exact <code class="literal">WHERE</code> condition, but only knows which
        index ranges were scanned. The locks are normally
        <a class="link" href="glossary.html#glos_next_key_lock" title="next-key lock">next-key locks</a> that
        also block inserts into the <span class="quote">“<span class="quote">gap</span>”</span> immediately
        before the record. However, <a class="link" href="glossary.html#glos_gap_lock" title="gap lock">gap
        locking</a> can be disabled explicitly, which causes next-key
        locking not to be used. For more information, see
        <a class="xref" href="innodb-storage-engine.html#innodb-record-level-locks" title="14.2.2.2 InnoDB Record, Gap, and Next-Key Locks">Section 14.2.2.2, “InnoDB Record, Gap, and Next-Key Locks”</a>. The transaction
        isolation level also can affect which locks are set; see
        <a class="xref" href="sql-syntax.html#set-transaction" title="13.3.6 SET TRANSACTION Syntax">Section 13.3.6, “SET TRANSACTION Syntax”</a>.
      </p><p>
        If a secondary index is used in a search and index record locks
        to be set are exclusive, <code class="literal">InnoDB</code> also
        retrieves the corresponding clustered index records and sets
        locks on them.
      </p><p>
        Differences between shared and exclusive locks are described in
        <a class="xref" href="innodb-storage-engine.html#innodb-lock-modes" title="14.2.2.1 InnoDB Lock Modes">Section 14.2.2.1, “InnoDB Lock Modes”</a>.
      </p><p>
        If you have no indexes suitable for your statement and MySQL
        must scan the entire table to process the statement, every row
        of the table becomes locked, which in turn blocks all inserts by
        other users to the table. It is important to create good indexes
        so that your queries do not unnecessarily scan many rows.
      </p><p>
        For <a class="link" href="sql-syntax.html#select" title="13.2.9 SELECT Syntax"><code class="literal">SELECT ... FOR
        UPDATE</code></a> or
        <a class="link" href="sql-syntax.html#select" title="13.2.9 SELECT Syntax"><code class="literal">SELECT ... LOCK IN SHARE
        MODE</code></a>, locks are acquired for scanned rows, and
        expected to be released for rows that do not qualify for
        inclusion in the result set (for example, if they do not meet
        the criteria given in the <code class="literal">WHERE</code> clause).
        However, in some cases, rows might not be unlocked immediately
        because the relationship between a result row and its original
        source is lost during query execution. For example, in a
        <a class="link" href="sql-syntax.html#union" title="13.2.9.3 UNION Syntax"><code class="literal">UNION</code></a>, scanned (and locked) rows
        from a table might be inserted into a temporary table before
        evaluation whether they qualify for the result set. In this
        circumstance, the relationship of the rows in the temporary
        table to the rows in the original table is lost and the latter
        rows are not unlocked until the end of query execution.
      </p><p>
        <code class="literal">InnoDB</code> sets specific types of locks as
        follows.
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <a class="link" href="sql-syntax.html#select" title="13.2.9 SELECT Syntax"><code class="literal">SELECT ...
            FROM</code></a> is a consistent read, reading a snapshot of
            the database and setting no locks unless the transaction
            isolation level is set to
            <a class="link" href="sql-syntax.html#isolevel_serializable"><code class="literal">SERIALIZABLE</code></a>. For
            <a class="link" href="sql-syntax.html#isolevel_serializable"><code class="literal">SERIALIZABLE</code></a> level, the
            search sets shared next-key locks on the index records it
            encounters.
          </p></li><li class="listitem"><p>
            <a class="link" href="sql-syntax.html#select" title="13.2.9 SELECT Syntax"><code class="literal">SELECT ... FROM ...
            LOCK IN SHARE MODE</code></a> sets shared next-key locks on
            all index records the search encounters.
          </p></li><li class="listitem"><p>
            For index records the search encounters,
            <a class="link" href="sql-syntax.html#select" title="13.2.9 SELECT Syntax"><code class="literal">SELECT ... FROM ...
            FOR UPDATE</code></a> blocks other sessions from doing
            <a class="link" href="sql-syntax.html#select" title="13.2.9 SELECT Syntax"><code class="literal">SELECT ... FROM ...
            LOCK IN SHARE MODE</code></a> or from reading in certain
            transaction isolation levels. Consistent reads will ignore
            any locks set on the records that exist in the read view.
          </p></li><li class="listitem"><p>
            <a class="link" href="sql-syntax.html#update" title="13.2.11 UPDATE Syntax"><code class="literal">UPDATE ... WHERE
            ...</code></a> sets an exclusive next-key lock on every
            record the search encounters.
          </p></li><li class="listitem"><p>
            <a class="link" href="sql-syntax.html#delete" title="13.2.2 DELETE Syntax"><code class="literal">DELETE FROM ...
            WHERE ...</code></a> sets an exclusive next-key lock on every
            record the search encounters.
          </p></li><li class="listitem"><p>
            <a class="link" href="sql-syntax.html#insert" title="13.2.5 INSERT Syntax"><code class="literal">INSERT</code></a> sets an exclusive lock
            on the inserted row. This lock is an index-record lock, not
            a next-key lock (that is, there is no gap lock) and does not
            prevent other sessions from inserting into the gap before
            the inserted row.
          </p><p>
            Prior to inserting the row, a type of gap lock called an
            insertion intention gap lock is set. This lock signals the
            intent to insert in such a way that multiple transactions
            inserting into the same index gap need not wait for each
            other if they are not inserting at the same position within
            the gap. Suppose that there are index records with values of
            4 and 7. Separate transactions that attempt to insert values
            of 5 and 6 each lock the gap between 4 and 7 with insert
            intention locks prior to obtaining the exclusive lock on the
            inserted row, but do not block each other because the rows
            are nonconflicting.
          </p><p>
            If a duplicate-key error occurs, a shared lock on the
            duplicate index record is set. This use of a shared lock can
            result in deadlock should there be multiple sessions trying
            to insert the same row if another session already has an
            exclusive lock. This can occur if another session deletes
            the row. Suppose that an <code class="literal">InnoDB</code> table
            <code class="literal">t1</code> has the following structure:
          </p><pre class="programlisting">
CREATE TABLE t1 (i INT, PRIMARY KEY (i)) ENGINE = InnoDB;
</pre><p>
            Now suppose that three sessions perform the following
            operations in order:
          </p><p>
            Session 1:
          </p><pre class="programlisting">
START TRANSACTION;
INSERT INTO t1 VALUES(1);
</pre><p>
            Session 2:
          </p><pre class="programlisting">
START TRANSACTION;
INSERT INTO t1 VALUES(1);
</pre><p>
            Session 3:
          </p><pre class="programlisting">
START TRANSACTION;
INSERT INTO t1 VALUES(1);
</pre><p>
            Session 1:
          </p><pre class="programlisting">
ROLLBACK;
</pre><p>
            The first operation by session 1 acquires an exclusive lock
            for the row. The operations by sessions 2 and 3 both result
            in a duplicate-key error and they both request a shared lock
            for the row. When session 1 rolls back, it releases its
            exclusive lock on the row and the queued shared lock
            requests for sessions 2 and 3 are granted. At this point,
            sessions 2 and 3 deadlock: Neither can acquire an exclusive
            lock for the row because of the shared lock held by the
            other.
          </p><p>
            A similar situation occurs if the table already contains a
            row with key value 1 and three sessions perform the
            following operations in order:
          </p><p>
            Session 1:
          </p><pre class="programlisting">
START TRANSACTION;
DELETE FROM t1 WHERE i = 1;
</pre><p>
            Session 2:
          </p><pre class="programlisting">
START TRANSACTION;
INSERT INTO t1 VALUES(1);
</pre><p>
            Session 3:
          </p><pre class="programlisting">
START TRANSACTION;
INSERT INTO t1 VALUES(1);
</pre><p>
            Session 1:
          </p><pre class="programlisting">
COMMIT;
</pre><p>
            The first operation by session 1 acquires an exclusive lock
            for the row. The operations by sessions 2 and 3 both result
            in a duplicate-key error and they both request a shared lock
            for the row. When session 1 commits, it releases its
            exclusive lock on the row and the queued shared lock
            requests for sessions 2 and 3 are granted. At this point,
            sessions 2 and 3 deadlock: Neither can acquire an exclusive
            lock for the row because of the shared lock held by the
            other.
          </p></li><li class="listitem"><p>
            <a class="link" href="sql-syntax.html#insert-on-duplicate" title="13.2.5.3 INSERT ... ON DUPLICATE KEY UPDATE Syntax"><code class="literal">INSERT
            ... ON DUPLICATE KEY UPDATE</code></a> differs from a simple
            <a class="link" href="sql-syntax.html#insert" title="13.2.5 INSERT Syntax"><code class="literal">INSERT</code></a> in that an exclusive
            next-key lock rather than a shared lock is placed on the row
            to be updated when a duplicate-key error occurs.
          </p></li><li class="listitem"><p>
            <a class="link" href="sql-syntax.html#replace" title="13.2.8 REPLACE Syntax"><code class="literal">REPLACE</code></a> is done like an
            <a class="link" href="sql-syntax.html#insert" title="13.2.5 INSERT Syntax"><code class="literal">INSERT</code></a> if there is no
            collision on a unique key. Otherwise, an exclusive next-key
            lock is placed on the row to be replaced.
          </p></li><li class="listitem"><p>
            <code class="literal">INSERT INTO T SELECT ... FROM S WHERE ...</code>
            sets an exclusive index record lock (without a gap lock) on
            each row inserted into <code class="literal">T</code>. If the
            transaction isolation level is <a class="link" href="sql-syntax.html#isolevel_read-committed"><code class="literal">READ
            COMMITTED</code></a>, or
            <a class="link" href="innodb-storage-engine.html#sysvar_innodb_locks_unsafe_for_binlog"><code class="literal">innodb_locks_unsafe_for_binlog</code></a>
            is enabled and the transaction isolation level is not
            <a class="link" href="sql-syntax.html#isolevel_serializable"><code class="literal">SERIALIZABLE</code></a>,
            <code class="literal">InnoDB</code> does the search on
            <code class="literal">S</code> as a consistent read (no locks).
            Otherwise, <code class="literal">InnoDB</code> sets shared next-key
            locks on rows from <code class="literal">S</code>.
            <code class="literal">InnoDB</code> has to set locks in the latter
            case: In roll-forward recovery from a backup, every SQL
            statement must be executed in exactly the same way it was
            done originally.
          </p><p>
            <a class="link" href="sql-syntax.html#create-table" title="13.1.18 CREATE TABLE Syntax"><code class="literal">CREATE TABLE
            ... SELECT ...</code></a> performs the
            <a class="link" href="sql-syntax.html#select" title="13.2.9 SELECT Syntax"><code class="literal">SELECT</code></a> with shared next-key
            locks or as a consistent read, as for
            <a class="link" href="sql-syntax.html#insert-select" title="13.2.5.1 INSERT ... SELECT Syntax"><code class="literal">INSERT ...
            SELECT</code></a>.
          </p><p>
            When a <code class="literal">SELECT</code> is used in the constructs
            <code class="literal">REPLACE INTO t SELECT ... FROM s WHERE
            ...</code> or <code class="literal">UPDATE t ... WHERE col IN (SELECT
            ... FROM s ...)</code>, <code class="literal">InnoDB</code> sets
            shared next-key locks on rows from table
            <code class="literal">s</code>.
          </p></li><li class="listitem"><p>
            While initializing a previously specified
            <code class="literal">AUTO_INCREMENT</code> column on a table,
            <code class="literal">InnoDB</code> sets an exclusive lock on the end
            of the index associated with the
            <code class="literal">AUTO_INCREMENT</code> column. In accessing the
            auto-increment counter, <code class="literal">InnoDB</code> uses a
            specific <code class="literal">AUTO-INC</code> table lock mode where
            the lock lasts only to the end of the current SQL statement,
            not to the end of the entire transaction. Other sessions
            cannot insert into the table while the
            <code class="literal">AUTO-INC</code> table lock is held; see
            <a class="xref" href="innodb-storage-engine.html#innodb-transaction-model" title="14.2.2 The InnoDB Transaction Model and Locking">Section 14.2.2, “The InnoDB Transaction Model and Locking”</a>.
          </p><p>
            <code class="literal">InnoDB</code> fetches the value of a previously
            initialized <code class="literal">AUTO_INCREMENT</code> column without
            setting any locks.
          </p></li><li class="listitem"><p>
            If a <code class="literal">FOREIGN KEY</code> constraint is defined on
            a table, any insert, update, or delete that requires the
            constraint condition to be checked sets shared record-level
            locks on the records that it looks at to check the
            constraint. <code class="literal">InnoDB</code> also sets these locks
            in the case where the constraint fails.
          </p></li><li class="listitem"><p>
            <a class="link" href="sql-syntax.html#lock-tables" title="13.3.5 LOCK TABLES and UNLOCK TABLES Syntax"><code class="literal">LOCK TABLES</code></a> sets table locks,
            but it is the higher MySQL layer above the
            <code class="literal">InnoDB</code> layer that sets these locks.
            <code class="literal">InnoDB</code> is aware of table locks if
            <code class="literal">innodb_table_locks = 1</code> (the default) and
            <a class="link" href="server-administration.html#sysvar_autocommit"><code class="literal">autocommit = 0</code></a>, and the
            MySQL layer above <code class="literal">InnoDB</code> knows about
            row-level locks.
          </p><p>
            Otherwise, <code class="literal">InnoDB</code>'s automatic deadlock
            detection cannot detect deadlocks where such table locks are
            involved. Also, because in this case the higher MySQL layer
            does not know about row-level locks, it is possible to get a
            table lock on a table where another session currently has
            row-level locks. However, this does not endanger transaction
            integrity, as discussed in
            <a class="xref" href="innodb-storage-engine.html#innodb-deadlock-detection" title="14.2.2.9 Deadlock Detection and Rollback">Section 14.2.2.9, “Deadlock Detection and Rollback”</a>. See also
            <a class="xref" href="innodb-storage-engine.html#innodb-restrictions" title="14.5.7 Limits on InnoDB Tables">Section 14.5.7, “Limits on InnoDB Tables”</a>.
</p></li></ul>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="innodb-implicit-commit"></a>14.2.2.8 Implicit Transaction Commit and Rollback</h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140644116499088"></a><p>
        By default, MySQL starts the session for each new connection
        with autocommit mode enabled, so MySQL does a commit after each
        SQL statement if that statement did not return an error. If a
        statement returns an error, the commit or rollback behavior
        depends on the error. See
        <a class="xref" href="innodb-storage-engine.html#innodb-error-handling" title="14.18.4 InnoDB Error Handling">Section 14.18.4, “InnoDB Error Handling”</a>.
      </p><p>
        If a session that has autocommit disabled ends without
        explicitly committing the final transaction, MySQL rolls back
        that transaction.
      </p><p>
        Some statements implicitly end a transaction, as if you had done
        a <a class="link" href="sql-syntax.html#commit" title="13.3.1 START TRANSACTION, COMMIT, and ROLLBACK Syntax"><code class="literal">COMMIT</code></a> before executing the
        statement. For details, see <a class="xref" href="sql-syntax.html#implicit-commit" title="13.3.3 Statements That Cause an Implicit Commit">Section 13.3.3, “Statements That Cause an Implicit Commit”</a>.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="innodb-deadlock-detection"></a>14.2.2.9 Deadlock Detection and Rollback</h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140644116491968"></a><a class="indexterm" name="idm140644116490480"></a><a class="indexterm" name="idm140644116488576"></a><a class="indexterm" name="idm140644116487088"></a><p>
        <code class="literal">InnoDB</code> automatically detects transaction
        <a class="link" href="glossary.html#glos_deadlock" title="deadlock">deadlocks</a> and rolls back a
        transaction or transactions to break the deadlock.
        <code class="literal">InnoDB</code> tries to pick small transactions to
        roll back, where the size of a transaction is determined by the
        number of rows inserted, updated, or deleted.
      </p><p>
        <code class="literal">InnoDB</code> is aware of table locks if
        <code class="literal">innodb_table_locks = 1</code> (the default) and
        <a class="link" href="server-administration.html#sysvar_autocommit"><code class="literal">autocommit = 0</code></a>, and the MySQL
        layer above it knows about row-level locks. Otherwise,
        <code class="literal">InnoDB</code> cannot detect deadlocks where a table
        lock set by a MySQL <a class="link" href="sql-syntax.html#lock-tables" title="13.3.5 LOCK TABLES and UNLOCK TABLES Syntax"><code class="literal">LOCK TABLES</code></a>
        statement or a lock set by a storage engine other than
        <code class="literal">InnoDB</code> is involved. Resolve these situations
        by setting the value of the
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_lock_wait_timeout"><code class="literal">innodb_lock_wait_timeout</code></a> system
        variable.
      </p><p>
        When <code class="literal">InnoDB</code> performs a complete rollback of a
        transaction, all locks set by the transaction are released.
        However, if just a single SQL statement is rolled back as a
        result of an error, some of the locks set by the statement may
        be preserved. This happens because <code class="literal">InnoDB</code>
        stores row locks in a format such that it cannot know afterward
        which lock was set by which statement.
      </p><p>
        If a <a class="link" href="sql-syntax.html#select" title="13.2.9 SELECT Syntax"><code class="literal">SELECT</code></a> calls a stored
        function in a transaction, and a statement within the function
        fails, that statement rolls back. Furthermore, if
        <a class="link" href="sql-syntax.html#commit" title="13.3.1 START TRANSACTION, COMMIT, and ROLLBACK Syntax"><code class="literal">ROLLBACK</code></a> is
        executed after that, the entire transaction rolls back.
      </p><p>
        For techniques to organize database operations to avoid
        deadlocks, see <a class="xref" href="innodb-storage-engine.html#innodb-deadlocks" title="14.2.2.10 How to Cope with Deadlocks">Section 14.2.2.10, “How to Cope with Deadlocks”</a>.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="innodb-deadlocks"></a>14.2.2.10 How to Cope with Deadlocks</h4>

</div>

</div>

</div>
<p>
        This section builds on the conceptual information about
        deadlocks in <a class="xref" href="innodb-storage-engine.html#innodb-deadlock-detection" title="14.2.2.9 Deadlock Detection and Rollback">Section 14.2.2.9, “Deadlock Detection and Rollback”</a>. It
        explains how to organize database operations to minimize
        deadlocks and the subsequent error handling required in
        applications.
      </p><p>
        <a class="link" href="glossary.html#glos_deadlock" title="deadlock">Deadlocks</a> are a classic
        problem in transactional databases, but they are not dangerous
        unless they are so frequent that you cannot run certain
        transactions at all. Normally, you must write your applications
        so that they are always prepared to re-issue a transaction if it
        gets rolled back because of a deadlock.
      </p><p>
        <code class="literal">InnoDB</code> uses automatic row-level locking. You
        can get deadlocks even in the case of transactions that just
        insert or delete a single row. That is because these operations
        are not really <span class="quote">“<span class="quote">atomic</span>”</span>; they automatically set
        locks on the (possibly several) index records of the row
        inserted or deleted.
      </p><p>
        You can cope with deadlocks and reduce the likelihood of their
        occurrence with the following techniques:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            At any time, issue the
            <a class="link" href="sql-syntax.html#show-engine" title="13.7.5.15 SHOW ENGINE Syntax"><code class="literal">SHOW ENGINE
            INNODB STATUS</code></a> command to determine the cause of
            the most recent deadlock. That can help you to tune your
            application to avoid deadlocks.
          </p></li><li class="listitem"><p>
            If frequent deadlock warnings cause concern, collect more
            extensive debugging information by enabling the
            <a class="link" href="innodb-storage-engine.html#sysvar_innodb_print_all_deadlocks"><code class="literal">innodb_print_all_deadlocks</code></a>
            configuration option. Information about each deadlock, not
            just the latest one, is recorded in the MySQL
            <a class="link" href="glossary.html#glos_error_log" title="error log">error log</a>. Disable
            this option when you are finished debugging.
          </p></li><li class="listitem"><p>
            Always be prepared to re-issue a transaction if it fails due
            to deadlock. Deadlocks are not dangerous. Just try again.
          </p></li><li class="listitem"><p>
            Keep transactions small and short in duration to make them
            less prone to collision.
          </p></li><li class="listitem"><p>
            Commit transactions immediately after making a set of
            related changes to make them less prone to collision. In
            particular, do not leave an interactive
            <a class="link" href="programs.html#mysql" title="4.5.1 mysql — The MySQL Command-Line Tool"><span class="command"><strong>mysql</strong></span></a> session open for a long time with
            an uncommitted transaction.
          </p></li><li class="listitem"><p>
            If you use <a class="link" href="glossary.html#glos_locking_read" title="locking read">locking
            reads</a> (<a class="link" href="sql-syntax.html#select" title="13.2.9 SELECT Syntax"><code class="literal">SELECT
            ... FOR UPDATE</code></a> or
            <code class="literal">SELECT ... LOCK IN SHARE
            MODE</code>), try using a lower isolation level such as
            <a class="link" href="sql-syntax.html#isolevel_read-committed"><code class="literal">READ COMMITTED</code></a>.
          </p></li><li class="listitem"><p>
            When modifying multiple tables within a transaction, or
            different sets of rows in the same table, do those
            operations in a consistent order each time. Then
            transactions form well-defined queues and do not deadlock.
            For example, organize database operations into functions
            within your application, or call stored routines, rather
            than coding multiple similar sequences of
            <code class="literal">INSERT</code>, <code class="literal">UPDATE</code>, and
            <code class="literal">DELETE</code> statements in different places.
          </p></li><li class="listitem"><p>
            Add well-chosen indexes to your tables. Then your queries
            need to scan fewer index records and consequently set fewer
            locks. Use <a class="link" href="sql-syntax.html#explain" title="13.8.2 EXPLAIN Syntax"><code class="literal">EXPLAIN
            SELECT</code></a> to determine which indexes the MySQL server
            regards as the most appropriate for your queries.
          </p></li><li class="listitem"><p>
            Use less locking. If you can afford to permit a
            <a class="link" href="sql-syntax.html#select" title="13.2.9 SELECT Syntax"><code class="literal">SELECT</code></a> to return data from an
            old snapshot, do not add the clause <code class="literal">FOR
            UPDATE</code> or <code class="literal">LOCK IN SHARE MODE</code> to
            it. Using the <a class="link" href="sql-syntax.html#isolevel_read-committed"><code class="literal">READ
            COMMITTED</code></a> isolation level is good here, because
            each consistent read within the same transaction reads from
            its own fresh snapshot.
          </p></li><li class="listitem"><p>
            If nothing else helps, serialize your transactions with
            table-level locks. The correct way to use
            <a class="link" href="sql-syntax.html#lock-tables" title="13.3.5 LOCK TABLES and UNLOCK TABLES Syntax"><code class="literal">LOCK TABLES</code></a> with
            transactional tables, such as <code class="literal">InnoDB</code>
            tables, is to begin a transaction with <code class="literal">SET
            autocommit = 0</code> (not
            <a class="link" href="sql-syntax.html#commit" title="13.3.1 START TRANSACTION, COMMIT, and ROLLBACK Syntax"><code class="literal">START
            TRANSACTION</code></a>) followed by <a class="link" href="sql-syntax.html#lock-tables" title="13.3.5 LOCK TABLES and UNLOCK TABLES Syntax"><code class="literal">LOCK
            TABLES</code></a>, and to not call
            <a class="link" href="sql-syntax.html#lock-tables" title="13.3.5 LOCK TABLES and UNLOCK TABLES Syntax"><code class="literal">UNLOCK
            TABLES</code></a> until you commit the transaction
            explicitly. For example, if you need to write to table
            <code class="literal">t1</code> and read from table
            <code class="literal">t2</code>, you can do this:
          </p><pre class="programlisting">
SET autocommit=0;
LOCK TABLES t1 WRITE, t2 READ, ...;
<em class="replaceable"><code>... do something with tables t1 and t2 here ...</code></em>
COMMIT;
UNLOCK TABLES;
</pre><p>
            Table-level locks prevent concurrent updates to the table,
            avoiding deadlocks at the expense of less responsiveness for
            a busy system.
          </p></li><li class="listitem"><p>
            Another way to serialize transactions is to create an
            auxiliary <span class="quote">“<span class="quote">semaphore</span>”</span> table that contains just
            a single row. Have each transaction update that row before
            accessing other tables. In that way, all transactions happen
            in a serial fashion. Note that the <code class="literal">InnoDB</code>
            instant deadlock detection algorithm also works in this
            case, because the serializing lock is a row-level lock. With
            MySQL table-level locks, the timeout method must be used to
            resolve deadlocks.
</p></li></ul>
</div>

</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="innodb-multi-versioning"></a>14.2.3 InnoDB Multi-Versioning</h3>

</div>

</div>

</div>
<a class="indexterm" name="idm140644116422336"></a><a class="indexterm" name="idm140644116420848"></a><p>
      <code class="literal">InnoDB</code> is a
      <a class="link" href="glossary.html#glos_mvcc" title="MVCC">multi-versioned storage engine</a>:
      it keeps information about old versions of changed rows, to
      support transactional features such as concurrency and
      <a class="link" href="glossary.html#glos_rollback" title="rollback">rollback</a>. This information is
      stored in the tablespace in a data structure called a
      <a class="link" href="glossary.html#glos_rollback_segment" title="rollback segment">rollback segment</a>
      (after an analogous data structure in Oracle).
      <code class="literal">InnoDB</code> uses the information in the rollback
      segment to perform the undo operations needed in a transaction
      rollback. It also uses the information to build earlier versions
      of a row for a <a class="link" href="glossary.html#glos_consistent_read" title="consistent read">consistent
      read</a>.
    </p><p>
      Internally, <code class="literal">InnoDB</code> adds three fields to each
      row stored in the database. A 6-byte <code class="literal">DB_TRX_ID</code>
      field indicates the transaction identifier for the last
      transaction that inserted or updated the row. Also, a deletion is
      treated internally as an update where a special bit in the row is
      set to mark it as deleted. Each row also contains a 7-byte
      <code class="literal">DB_ROLL_PTR</code> field called the roll pointer. The
      roll pointer points to an undo log record written to the rollback
      segment. If the row was updated, the undo log record contains the
      information necessary to rebuild the content of the row before it
      was updated. A 6-byte <code class="literal">DB_ROW_ID</code> field contains
      a row ID that increases monotonically as new rows are inserted. If
      <code class="literal">InnoDB</code> generates a clustered index
      automatically, the index contains row ID values. Otherwise, the
      <code class="literal">DB_ROW_ID</code> column does not appear in any index.
    </p><p>
      Undo logs in the rollback segment are divided into insert and
      update undo logs. Insert undo logs are needed only in transaction
      rollback and can be discarded as soon as the transaction commits.
      Update undo logs are used also in consistent reads, but they can
      be discarded only after there is no transaction present for which
      <code class="literal">InnoDB</code> has assigned a snapshot that in a
      consistent read could need the information in the update undo log
      to build an earlier version of a database row.
    </p><p>
      Commit your transactions regularly, including those transactions
      that issue only consistent reads. Otherwise,
      <code class="literal">InnoDB</code> cannot discard data from the update undo
      logs, and the rollback segment may grow too big, filling up your
      tablespace.
    </p><p>
      The physical size of an undo log record in the rollback segment is
      typically smaller than the corresponding inserted or updated row.
      You can use this information to calculate the space needed for
      your rollback segment.
    </p><p>
      In the <code class="literal">InnoDB</code> multi-versioning scheme, a row is
      not physically removed from the database immediately when you
      delete it with an SQL statement. <code class="literal">InnoDB</code> only
      physically removes the corresponding row and its index records
      when it discards the update undo log record written for the
      deletion. This removal operation is called a
      <a class="link" href="glossary.html#glos_purge" title="purge">purge</a>, and it is quite fast,
      usually taking the same order of time as the SQL statement that
      did the deletion.
    </p><p>
      If you insert and delete rows in smallish batches at about the
      same rate in the table, the purge thread can start to lag behind
      and the table can grow bigger and bigger because of all the
      <span class="quote">“<span class="quote">dead</span>”</span> rows, making everything disk-bound and very
      slow. In such a case, throttle new row operations, and allocate
      more resources to the purge thread by tuning the
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_max_purge_lag"><code class="literal">innodb_max_purge_lag</code></a> system
      variable. See <a class="xref" href="innodb-storage-engine.html#innodb-parameters" title="14.11 InnoDB Startup Options and System Variables">Section 14.11, “InnoDB Startup Options and System Variables”</a> for more
      information.
</p>
<div class="simplesect">

<div class="titlepage">
<div>

<div class="simple">
<h4 class="title"><a name="innodb-multi-versioning-secondary-indexes"></a>Multi-Versioning and Secondary Indexes</h4>
</div>
</div>
</div>
<p>
        <code class="literal">InnoDB</code> multiversion concurrency control
        (MVCC) treats secondary indexes differently than clustered
        indexes. Records in a clustered index are updated in-place, and
        their hidden system columns point undo log entries from which
        earlier versions of records can be reconstructed. Unlike
        clustered index records, secondary index records do not contain
        hidden system columns nor are they updated in-place.
      </p><p>
        When a secondary index column is updated, old secondary index
        records are delete-marked, new records are inserted, and
        delete-marked records are eventually purged. When a secondary
        index record is delete-marked or the secondary index page is
        updated by a newer transaction, <code class="literal">InnoDB</code> looks
        up the database record in the clustered index. In the clustered
        index, the record's <code class="literal">DB_TRX_ID</code> is checked, and
        the correct version of the record is retrieved from the undo log
        if the record was modified after the reading transaction was
        initiated.
      </p><p>
        If a secondary index record is marked for deletion or the
        secondary index page is updated by a newer transaction, the
        <a class="link" href="glossary.html#glos_covering_index" title="covering index">covering index</a>
        technique is not used. Instead of returning values from the
        index structure, <code class="literal">InnoDB</code> looks up the record
        in the clustered index.
      </p><p>
        However, if the
        <a class="link" href="optimization.html#index-condition-pushdown-optimization" title="8.2.1.6 Index Condition Pushdown Optimization">index
        condition pushdown (ICP)</a> optimization is enabled, and
        parts of the <code class="literal">WHERE</code> condition can be evaluated
        using only fields from the index, the MySQL server still pushes
        this part of the <code class="literal">WHERE</code> condition down to the
        storage engine where it is evaluated using the index. If no
        matching records are found, the clustered index lookup is
        avoided. If matching records are found, even among delete-marked
        records, <code class="literal">InnoDB</code> looks up the record in the
        clustered index.
</p>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="innodb-redo-log"></a>14.2.4 InnoDB Redo Log</h3>

</div>

</div>

</div>
<div class="toc">
<dl class="toc"><dt><span class="section"><a href="innodb-storage-engine.html#innodb-performance-group_commit">14.2.4.1 Group Commit for Redo Log Flushing</a></span></dt></dl>
</div>
<p>
      The redo log is a disk-based data structure used during crash
      recovery to correct data written by incomplete transactions.
      During normal operations, the redo log encodes requests to change
      <code class="literal">InnoDB</code> table data, which result from SQL
      statements or low-level API calls. Modifications that did not
      finish updating the data files before an unexpected shutdown are
      replayed automatically during initialization, and before the
      connections are accepted. For information about the role of the
      redo log in crash recovery, see <a class="xref" href="innodb-storage-engine.html#innodb-recovery" title="14.15.1 The InnoDB Recovery Process">Section 14.15.1, “The InnoDB Recovery Process”</a>.
    </p><p>
      By default, the redo log is physically represented on disk as a
      set of files, named <code class="filename">ib_logfile0</code> and
      <code class="filename">ib_logfile1</code>. MySQL writes to the redo log
      files in a circular fashion. Data in the redo log is encoded in
      terms of records affected; this data is collectively referred to
      as redo. The passage of data through the redo log is represented
      by an ever-increasing <a class="link" href="glossary.html#glos_lsn" title="LSN">LSN</a> value.
    </p><p>
      Disk layout for the redo log is configured using the following
      options:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_log_file_size"><code class="literal">innodb_log_file_size</code></a>: Defines
          the size of each redo log file in bytes. By default, redo log
          files are 50331648 bytes (48MB) in size. The combined size of
          log files
          (<a class="link" href="innodb-storage-engine.html#sysvar_innodb_log_file_size"><code class="literal">innodb_log_file_size</code></a> *
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_log_files_in_group"><code class="literal">innodb_log_files_in_group</code></a>)
          cannot exceed a maximum value that is slightly less than
          512GB.
        </p></li><li class="listitem"><p>
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_log_files_in_group"><code class="literal">innodb_log_files_in_group</code></a>:
          The number of log files in the log group. The default is to
          create two files named <code class="filename">ib_logfile0</code> and
          <code class="filename">ib_logfile1</code>.
        </p></li><li class="listitem"><p>
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_log_group_home_dir"><code class="literal">innodb_log_group_home_dir</code></a>:
          The directory path to the <code class="literal">InnoDB</code> log files.
          If you do not specify a value, the log files are created in
          the MySQL data directory
          (<a class="link" href="server-administration.html#sysvar_datadir"><code class="literal">datadir</code></a>).
</p></li></ul>
</div>
<p>
      To change your initial redo log configuration, refer to
      <a class="xref" href="innodb-storage-engine.html#innodb-data-log-reconfiguration" title="14.4.2 Changing the Number or Size of InnoDB Redo Log Files">Section 14.4.2, “Changing the Number or Size of InnoDB Redo Log Files”</a>. For information
      about optimizing redo logging, see
      <a class="xref" href="optimization.html#optimizing-innodb-logging" title="8.5.4 Optimizing InnoDB Redo Logging">Section 8.5.4, “Optimizing InnoDB Redo Logging”</a>.
</p>
<div class="section">

<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="innodb-performance-group_commit"></a>14.2.4.1 Group Commit for Redo Log Flushing</h4>
</div>
</div>
</div>
<a class="indexterm" name="idm140644116363472"></a><p>
        InnoDB, like any other
        <a class="link" href="glossary.html#glos_acid" title="ACID">ACID</a>-compliant database engine,
        flushes the <a class="link" href="glossary.html#glos_redo_log" title="redo log">redo log</a> of a
        transaction before it is committed. InnoDB uses
        <a class="link" href="glossary.html#glos_group_commit" title="group commit">group commit</a>
        functionality to group multiple such flush requests together to
        avoid one flush for each commit. With group commit, InnoDB
        issues a single write to the log file to perform the commit
        action for multiple user transactions that commit at about the
        same time, significantly improving throughput.
      </p><p>
        For more information about performance of
        <code class="literal">COMMIT</code> and other transactional operations,
        see <a class="xref" href="optimization.html#optimizing-innodb-transaction-management" title="8.5.2 Optimizing InnoDB Transaction Management">Section 8.5.2, “Optimizing InnoDB Transaction Management”</a>.
</p>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="innodb-undo-logs"></a>14.2.5 InnoDB Undo Logs</h3>

</div>

</div>

</div>
<p>
      An undo log (or rollback segment) is a storage area that holds
      copies of data modified by active transactions. If another
      transaction needs to see the original data (as part of a
      consistent read operation), the unmodified data is retrieved from
      this storage area. By default, this area is physically part of the
      system tablespace. However, as of MySQL 5.6.3, undo logs can
      reside in separate undo tablespaces. For more information, see
      <a class="xref" href="innodb-storage-engine.html#innodb-undo-tablespace" title="14.4.7 Storing InnoDB Undo Logs in Separate Tablespaces">Section 14.4.7, “Storing InnoDB Undo Logs in Separate Tablespaces”</a>. For more information
      about undo logs and multi-versioning, see
      <a class="xref" href="innodb-storage-engine.html#innodb-multi-versioning" title="14.2.3 InnoDB Multi-Versioning">Section 14.2.3, “InnoDB Multi-Versioning”</a>.
    </p><p>
      InnoDB supports 128 undo logs. As of MySQL 5.7.2, 32 of 128 undo
      logs were reserved as non-redo undo logs for temporary table
      transactions. Each transaction that updates a temporary table
      (excluding read-only transactions) is assigned two undo logs, one
      redo-enabled undo log and one non-redo undo log. Read-only
      transactions are only assigned non-redo undo logs, as read-only
      transactions are only permitted to modify temporary tables.
    </p><p>
      This leaves 96 available undo logs, each of which supports up to
      1023 concurrent data-modifying transactions, for a total limit of
      approximately 96K concurrent data-modifying transactions. The 96K
      limit assumes that transactions do not modify temporary tables. If
      all data-modifying transactions also modify temporary tables, the
      total limit would be approximately 32K concurrent data modifying
      transactions. For more information about undo logs that are
      reserved for temporary table transactions, see
      <a class="xref" href="innodb-storage-engine.html#innodb-temporary-table-undo-logs" title="14.2.6 InnoDB Temporary Table Undo Logs">Section 14.2.6, “InnoDB Temporary Table Undo Logs”</a>.
    </p><p>
      The <a class="link" href="innodb-storage-engine.html#sysvar_innodb_undo_logs"><code class="literal">innodb_undo_logs</code></a> option
      defines the number of undo logs used by <code class="literal">InnoDB</code>.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="innodb-temporary-table-undo-logs"></a>14.2.6 InnoDB Temporary Table Undo Logs</h3>

</div>

</div>

</div>
<a class="indexterm" name="idm140644116346432"></a><a class="indexterm" name="idm140644116344928"></a><p>
      MySQL 5.7.2 introduces a new type of undo log for both normal and
      compressed temporary tables and related objects. This type of
      <a class="link" href="glossary.html#glos_undo_log" title="undo log">undo log</a> is not a redo log,
      as temporary tables are not recovered during crash recovery and do
      not require redo logs. Temporary table undo logs are, however,
      used for rollback while the server is running. This special type
      of non-redo undo log benefits performance by avoiding redo logging
      I/O for temporary tables and related objects. Temporary table undo
      logs reside in the temporary tablespace. The default temporary
      tablespace file, <code class="filename">ibtmp1</code>, is located in the
      data directory by default and is always recreated on server
      startup. A user defined location for the temporary tablespace file
      can be specified by setting
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_temp_data_file_path"><code class="literal">innodb_temp_data_file_path</code></a>.
    </p><p>
      With this change, 32
      <a class="link" href="glossary.html#glos_rollback_segment" title="rollback segment">rollback segments</a> are
      now reserved for temporary table
      <a class="link" href="glossary.html#glos_undo_log" title="undo log">undo logs</a> for transactions
      that modify temporary tables and related objects. This reduces the
      maximum number of rollback segments available for data-modifying
      transactions that generate undo records from 128 to 96, which
      reduces the limit on concurrent data-modifying transactions from
      128K to 96K. For more information see
      <a class="xref" href="innodb-storage-engine.html#innodb-multi-versioning" title="14.2.3 InnoDB Multi-Versioning">Section 14.2.3, “InnoDB Multi-Versioning”</a> and
      <a class="xref" href="innodb-storage-engine.html#innodb-restrictions" title="14.5.7 Limits on InnoDB Tables">Section 14.5.7, “Limits on InnoDB Tables”</a>.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="innodb-table-and-index"></a>14.2.7 InnoDB Table and Index Structures</h3>

</div>

</div>

</div>
<div class="toc">
<dl class="toc"><dt><span class="section"><a href="innodb-storage-engine.html#innodb-frm-file">14.2.7.1 Role of the .frm File for InnoDB Tables</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-index-types">14.2.7.2 Clustered and Secondary Indexes</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-fulltext-index">14.2.7.3 InnoDB FULLTEXT Indexes</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-physical-structure">14.2.7.4 Physical Structure of an InnoDB Index</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-insert-buffering">14.2.7.5 Change Buffer</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-adaptive-hash">14.2.7.6 Adaptive Hash Indexes</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-physical-record">14.2.7.7 Physical Row Structure</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#sorted-index-builds">14.2.7.8 Sorted Index Builds</a></span></dt></dl>
</div>
<a class="indexterm" name="idm140644116334352"></a><a class="indexterm" name="idm140644116332896"></a><p>
      This section describes how <code class="literal">InnoDB</code> tables,
      indexes, and their associated metadata is represented at the
      physical level. This information is primarily useful for
      performance tuning and troubleshooting.
</p>
<div class="section">

<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="innodb-frm-file"></a>14.2.7.1 Role of the .frm File for InnoDB Tables</h4>
</div>
</div>
</div>
<p>
        MySQL stores its data dictionary information for tables in
        <a class="link" href="glossary.html#glos_frm_file" title=".frm file">.frm files</a> in database
        directories. Unlike other MySQL storage engines,
        <code class="literal">InnoDB</code> also encodes information about the
        table in its own internal data dictionary inside the tablespace.
        When MySQL drops a table or a database, it deletes one or more
        <code class="filename">.frm</code> files as well as the corresponding
        entries inside the <code class="literal">InnoDB</code> data dictionary.
        You cannot move <code class="literal">InnoDB</code> tables between
        databases simply by moving the <code class="filename">.frm</code> files.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="innodb-index-types"></a>14.2.7.2 Clustered and Secondary Indexes</h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140644116322256"></a><a class="indexterm" name="idm140644116320800"></a><a class="indexterm" name="idm140644116319312"></a><a class="indexterm" name="idm140644116317824"></a><p>
        Every <code class="literal">InnoDB</code> table has a special index called
        the <a class="link" href="glossary.html#glos_clustered_index" title="clustered index">clustered index</a>
        where the data for the rows is stored. Typically, the clustered
        index is synonymous with the
        <a class="link" href="glossary.html#glos_primary_key" title="primary key">primary key</a>. To get the
        best performance from queries, inserts, and other database
        operations, you must understand how InnoDB uses the clustered
        index to optimize the most common lookup and DML operations for
        each table.
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            When you define a <code class="literal">PRIMARY KEY</code> on your
            table, <code class="literal">InnoDB</code> uses it as the clustered
            index. Define a primary key for each table that you create.
            If there is no logical unique and non-null column or set of
            columns, add a new
            <a class="link" href="glossary.html#glos_auto_increment" title="auto-increment">auto-increment</a>
            column, whose values are filled in automatically.
          </p></li><li class="listitem"><p>
            If you do not define a <code class="literal">PRIMARY KEY</code> for
            your table, MySQL locates the first
            <code class="literal">UNIQUE</code> index where all the key columns
            are <code class="literal">NOT NULL</code> and
            <code class="literal">InnoDB</code> uses it as the clustered index.
          </p></li><li class="listitem"><p>
            If the table has no <code class="literal">PRIMARY KEY</code> or
            suitable <code class="literal">UNIQUE</code> index,
            <code class="literal">InnoDB</code> internally generates a hidden
            clustered index on a synthetic column containing row ID
            values. The rows are ordered by the ID that
            <code class="literal">InnoDB</code> assigns to the rows in such a
            table. The row ID is a 6-byte field that increases
            monotonically as new rows are inserted. Thus, the rows
            ordered by the row ID are physically in insertion order.
</p></li></ul>
</div>
<h5><a name="idm140644116301536"></a>How the Clustered Index Speeds Up Queries</h5>
<p>
        Accessing a row through the clustered index is fast because the
        index search leads directly to the page with all the row data.
        If a table is large, the clustered index architecture often
        saves a disk I/O operation when compared to storage
        organizations that store row data using a different page from
        the index record. (For example, <code class="literal">MyISAM</code> uses
        one file for data rows and another for index records.)
</p>
<h5><a name="idm140644116299216"></a>How Secondary Indexes Relate to the Clustered Index</h5>
<p>
        All indexes other than the clustered index are known as
        <a class="link" href="glossary.html#glos_secondary_index" title="secondary index">secondary indexes</a>.
        In <code class="literal">InnoDB</code>, each record in a secondary index
        contains the primary key columns for the row, as well as the
        columns specified for the secondary index.
        <code class="literal">InnoDB</code> uses this primary key value to search
        for the row in the clustered index.
      </p><p>
        If the primary key is long, the secondary indexes use more
        space, so it is advantageous to have a short primary key.
      </p><p>
        For coding guidelines to take advantage of
        <code class="literal">InnoDB</code> clustered and secondary indexes, see
        <a class="xref" href="optimization.html#optimizing-primary-keys" title="8.3.2 Using Primary Keys">Section 8.3.2, “Using Primary Keys”</a>
        <a class="xref" href="optimization.html#optimization-indexes" title="8.3 Optimization and Indexes">Section 8.3, “Optimization and Indexes”</a>
        <a class="xref" href="optimization.html#optimizing-innodb" title="8.5 Optimizing for InnoDB Tables">Section 8.5, “Optimizing for InnoDB Tables”</a>
        <a class="xref" href="optimization.html#optimizing-primary-keys" title="8.3.2 Using Primary Keys">Section 8.3.2, “Using Primary Keys”</a>.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="innodb-fulltext-index"></a>14.2.7.3 InnoDB FULLTEXT Indexes</h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140644116289904"></a><a class="indexterm" name="idm140644116288416"></a><p>
        <code class="literal">FULLTEXT</code> indexes are created on text-based
        columns (<a class="link" href="data-types.html#char" title="11.4.1 The CHAR and VARCHAR Types"><code class="literal">CHAR</code></a>,
        <a class="link" href="data-types.html#char" title="11.4.1 The CHAR and VARCHAR Types"><code class="literal">VARCHAR</code></a>, or
        <a class="link" href="data-types.html#blob" title="11.4.3 The BLOB and TEXT Types"><code class="literal">TEXT</code></a> columns) to help speed up
        queries and DML operations on data contained within those
        columns, omitting any words that are defined as stopwords.
      </p><p>
        A <code class="literal">FULLTEXT</code> index can be defined as part of a
        <a class="link" href="sql-syntax.html#create-table" title="13.1.18 CREATE TABLE Syntax"><code class="literal">CREATE TABLE</code></a> statement, or added
        later using <a class="link" href="sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a> or
        <a class="link" href="sql-syntax.html#create-index" title="13.1.14 CREATE INDEX Syntax"><code class="literal">CREATE INDEX</code></a>.
      </p><p>
        Full-text searching is performed using
        <a class="link" href="functions.html#function_match"><code class="literal">MATCH() ... AGAINST</code></a> syntax. For
        usage information, see <a class="xref" href="functions.html#fulltext-search" title="12.9 Full-Text Search Functions">Section 12.9, “Full-Text Search Functions”</a>.
</p>
<h5><a name="idm140644116274656"></a>Full-Text Index Design</h5>
<p>
        <code class="literal">InnoDB</code> <code class="literal">FULLTEXT</code> indexes
        have an inverted index design. Inverted indexes store a list of
        words, and for each word, a list of documents that the word
        appears in. To support proximity search, position information
        for each word is also stored, as a byte offset.
</p>
<h5><a name="idm140644116271904"></a>Full-text Index Tables</h5>
<p>
        For each <code class="literal">InnoDB</code> <code class="literal">FULLTEXT</code>
        index, a set of index tables is created, as shown in the
        following example:
      </p><pre class="programlisting">CREATE TABLE opening_lines (
id INT UNSIGNED AUTO_INCREMENT NOT NULL PRIMARY KEY,
opening_line TEXT(500),
author VARCHAR(200),
title VARCHAR(200),
FULLTEXT idx (opening_line)
) ENGINE=InnoDB;

mysql&gt; SELECT table_id, name, space from INFORMATION_SCHEMA.INNODB_SYS_TABLES 
WHERE name LIKE 'test/%';
+----------+----------------------------------------------------+-------+
| table_id | name                                               | space |
+----------+----------------------------------------------------+-------+
|      333 | test/FTS_0000000000000147_00000000000001c9_INDEX_1 |   289 |
|      334 | test/FTS_0000000000000147_00000000000001c9_INDEX_2 |   290 |
|      335 | test/FTS_0000000000000147_00000000000001c9_INDEX_3 |   291 |
|      336 | test/FTS_0000000000000147_00000000000001c9_INDEX_4 |   292 |
|      337 | test/FTS_0000000000000147_00000000000001c9_INDEX_5 |   293 |
|      338 | test/FTS_0000000000000147_00000000000001c9_INDEX_6 |   294 |
|      330 | test/FTS_0000000000000147_BEING_DELETED            |   286 |
|      331 | test/FTS_0000000000000147_BEING_DELETED_CACHE      |   287 |
|      332 | test/FTS_0000000000000147_CONFIG                   |   288 |
|      328 | test/FTS_0000000000000147_DELETED                  |   284 |
|      329 | test/FTS_0000000000000147_DELETED_CACHE            |   285 |
|      327 | test/opening_lines                                 |   283 |
+----------+----------------------------------------------------+-------+ </pre><p>
        The first six tables represent the inverted index and are
        referred to as auxiliary index tables. When incoming documents
        are tokenized, the individual words (also referred to as
        <span class="quote">“<span class="quote">tokens</span>”</span>) are inserted into the index tables along
        with position information and the associated Document ID
        (<code class="literal">DOC_ID</code>). The words are fully sorted and
        partitioned among the six index tables based on the character
        set sort weight of the word's first character.
      </p><p>
        The inverted index is partitioned into six auxiliary index
        tables to support parallel index creation. By default, two
        threads tokenize, sort, and insert words and associated data
        into the index tables. The number of threads is configurable
        using the
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_ft_sort_pll_degree"><code class="literal">innodb_ft_sort_pll_degree</code></a>
        option. When creating <code class="literal">FULLTEXT</code> indexes on
        large tables, consider increasing the number of threads.
      </p><p>
        Auxiliary index table names are prefixed with
        <code class="literal">FTS_</code> and postfixed with
        <code class="literal">INDEX_*</code>. Each index table is associated with
        the indexed table by a hex value in the index table name that
        matches the <code class="literal">table_id</code> of the indexed table.
        For example, the <code class="literal">table_id</code> of the
        <code class="literal">test/opening_lines</code> table is
        <code class="literal">327</code>, for which the hex value is 0x147. As
        shown in the preceding example, the <span class="quote">“<span class="quote">147</span>”</span> hex value
        appears in the names of index tables that are associated with
        the <code class="literal">test/opening_lines</code> table.
      </p><p>
        A hex value representing the <code class="literal">index_id</code> of the
        <code class="literal">FULLTEXT</code> index also appears in auxiliary
        index table names. For example, in the auxiliary table name
        <code class="literal">test/FTS_0000000000000147_00000000000001c9_INDEX_1</code>,
        the hex value <code class="literal">1c9</code> has a decimal value of 457.
        The index defined on the <code class="literal">opening_lines</code> table
        (<code class="literal">idx</code>) can be identified by querying the
        <a class="link" href="information-schema.html#innodb-sys-indexes-table" title="21.31.8 The INFORMATION_SCHEMA INNODB_SYS_INDEXES Table"><code class="literal">INFORMATION_SCHEMA.INNODB_SYS_INDEXES</code></a>
        table for this value (457).
      </p><pre class="programlisting">mysql&gt; SELECT index_id, name, table_id, space from INFORMATION_SCHEMA.INNODB_SYS_INDEXES 
  WHERE index_id=457;
+----------+------+----------+-------+
| index_id | name | table_id | space |
+----------+------+----------+-------+
|      457 | idx  |      327 |   283 |
+----------+------+----------+-------+</pre><p>
        Index tables are stored in their own tablespace if the primary
        table is created in a file-per-table tablespace.
</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
          Due to a bug introduced in MySQL 5.6.5, index tables were
          created in the <code class="literal">InnoDB</code> system tablespace
          (space 0) even though the primary table was created in a
          file-per-table tablespace. The bug is fixed in MySQL 5.6.20
          and MySQL 5.7.5 (Bug#18635485). As of MySQL 5.7.8, auxiliary
          index tables are always stored in the same tablespace as the
          primary table and have the same row format as the primary
          table (MySQL Bug #75869).
</p>
</div>
<p>
        The other index tables shown in the preceding example are used
        for deletion handling and for storing the internal state of the
        <code class="literal">FULLTEXT</code> index.
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <code class="literal">FTS_*_DELETED</code> and
            <code class="literal">FTS_*_DELETED_CACHE</code>: Contain the document
            IDs (DOC_ID) for documents that are deleted but whose data
            is not yet removed from the full-text index. The
            <code class="literal">FTS_*_DELETED_CACHE</code> is the in-memory
            version of the <code class="literal">FTS_*_DELETED</code> table.
          </p></li><li class="listitem"><p>
            <code class="literal">FTS_*_BEING_DELETED</code> and
            <code class="literal">FTS_*_BEING_DELETED_CACHE</code>: Contain the
            document IDs (DOC_ID) for documents that are deleted and
            whose data is currently in the process of being removed from
            the full-text index. The
            <code class="literal">FTS_*_BEING_DELETED_CACHE</code> table is the
            in-memory version of the
            <code class="literal">FTS_*_BEING_DELETED</code> table.
          </p></li><li class="listitem"><p>
            <code class="literal">FTS_*_CONFIG</code>: Stores information about
            the internal state of the <code class="literal">FULLTEXT</code> index.
            Most importantly, it stores the
            <code class="literal">FTS_SYNCED_DOC_ID</code>, which identifies
            documents that have been parsed and flushed to disk. In case
            of crash recovery, <code class="literal">FTS_SYNCED_DOC_ID</code>
            values are used to identify documents that have not been
            flushed to disk so that the documents can be re-parsed and
            added back to the <code class="literal">FULLTEXT</code> index cache.
            To view the data in this table, query the
            <a class="link" href="information-schema.html#innodb-ft-config-table" title="21.31.21 The INFORMATION_SCHEMA INNODB_FT_CONFIG Table"><code class="literal">INFORMATION_SCHEMA.INNODB_FT_CONFIG</code></a>
            table.
</p></li></ul>
</div>
<h5><a name="idm140644116228224"></a>Full-Text Index Cache</h5>
<p>
        When a document is inserted, it is tokenized, and the individual
        words and associated data are inserted into the
        <code class="literal">FULLTEXT</code> index. This process, even for small
        documents, could result in numerous small insertions into the
        auxiliary index tables, making concurrent access to these tables
        a point of contention. To avoid this problem,
        <code class="literal">InnoDB</code> uses a <code class="literal">FULLTEXT</code>
        index cache to temporarily cache index table insertions for
        recently inserted rows. This in-memory cache structure holds
        insertions until the cache is full and then batch flushes them
        to disk (to the auxiliary index tables). You can query the
        <a class="link" href="information-schema.html#innodb-ft-index-cache-table" title="21.31.24 The INFORMATION_SCHEMA INNODB_FT_INDEX_CACHE Table"><code class="literal">INFORMATION_SCHEMA.INNODB_FT_INDEX_CACHE</code></a>
        table to view tokenized data for recently inserted rows.
      </p><p>
        The caching and batch flushing behavior avoids frequent updates
        to auxiliary index tables, which could result in concurrent
        access issues during busy insert and update times. The batching
        technique also avoids multiple insertions for the same word, and
        minimizes duplicate entries. Instead of flushing each word
        individually, insertions for the same word are merged and
        flushed to disk as a single entry, improving insertion
        efficiency while keeping auxiliary index tables as small as
        possible.
      </p><p>
        The <a class="link" href="innodb-storage-engine.html#sysvar_innodb_ft_cache_size"><code class="literal">innodb_ft_cache_size</code></a>
        variable is used to configure the full-text index cache size (on
        a per-table basis), which affects how often the full-text index
        cache is flushed. You can also define a global full-text index
        cache size limit for all tables in a given instance using the
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_ft_total_cache_size"><code class="literal">innodb_ft_total_cache_size</code></a>
        option.
      </p><p>
        The full-text index cache stores the same information as
        auxiliary index tables. However, the full-text index cache only
        caches tokenized data for recently inserted rows. The data that
        is already flushed to disk (to the full-text auxiliary tables)
        is not brought back into the full-text index cache when queried.
        The data in auxiliary index tables is queried directly, and
        results from the auxiliary index tables are merged with results
        from the full-text index cache before being returned.
</p>
<h5><a name="idm140644116217808"></a>InnoDB Full-Text Document ID and FTS_DOC_ID Column</h5>
<p>
        <code class="literal">InnoDB</code> uses a unique document identifier
        referred to as a Document ID (<code class="literal">DOC_ID</code>) to map
        words in the full-text index to document records where the word
        appears. The mapping requires an <code class="literal">FTS_DOC_ID</code>
        column on the indexed table. If an <code class="literal">FTS_DOC_ID</code>
        column is not defined, <code class="literal">InnoDB</code> automatically
        adds a hidden <code class="literal">FTS_DOC_ID</code> column when the
        full-text index is created. The following example demonstrates
        this behavior.
      </p><p>
        The following table definition does not include an
        <code class="literal">FTS_DOC_ID</code> column:
      </p><pre class="programlisting">CREATE TABLE opening_lines (
id INT UNSIGNED AUTO_INCREMENT NOT NULL PRIMARY KEY,
opening_line TEXT(500),
author VARCHAR(200),
title VARCHAR(200)
) ENGINE=InnoDB;    </pre><p>
        When you create a full-text index on the table using
        <code class="literal">CREATE FULLTEXT INDEX</code> syntax, a warning is
        returned which reports that <code class="literal">InnoDB</code> is
        rebuilding the table to add the <code class="literal">FTS_DOC_ID</code>
        column.
      </p><pre class="programlisting">mysql&gt; CREATE FULLTEXT INDEX idx ON opening_lines(opening_line);
Query OK, 0 rows affected, 1 warning (0.19 sec)
Records: 0  Duplicates: 0  Warnings: 1

mysql&gt; SHOW WARNINGS;
+---------+------+--------------------------------------------------+
| Level   | Code | Message                                          |
+---------+------+--------------------------------------------------+
| Warning |  124 | InnoDB rebuilding table to add column FTS_DOC_ID |
+---------+------+--------------------------------------------------+</pre><p>
        The same warning is returned when using
        <a class="link" href="sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a> to add a full-text
        index to a table that does not have an
        <code class="literal">FTS_DOC_ID</code> column. If you create a full-text
        index at <a class="link" href="sql-syntax.html#create-table" title="13.1.18 CREATE TABLE Syntax"><code class="literal">CREATE TABLE</code></a> time and do
        not specify an <code class="literal">FTS_DOC_ID</code> column,
        <code class="literal">InnoDB</code> adds a hidden
        <code class="literal">FTS_DOC_ID</code> column, without warning.
      </p><p>
        Defining an <code class="literal">FTS_DOC_ID</code> column at
        <a class="link" href="sql-syntax.html#create-table" title="13.1.18 CREATE TABLE Syntax"><code class="literal">CREATE TABLE</code></a> time reduces the
        time required to create a full-text index on a table that is
        already loaded with data. If an <code class="literal">FTS_DOC_ID</code>
        column is defined on a table prior to loading data, the table
        and its indexes do not have to be rebuilt to add the new column.
        If you are not concerned with <code class="literal">CREATE FULLTEXT
        INDEX</code> performance, leave out the
        <code class="literal">FTS_DOC_ID</code> column to have
        <code class="literal">InnoDB</code> create it for you.
        <code class="literal">InnoDB</code> creates a hidden
        <code class="literal">FTS_DOC_ID</code> column along with a unique index
        (<code class="literal">FTS_DOC_ID_INDEX</code>) on the
        <code class="literal">FTS_DOC_ID</code> column. If you want to create your
        own <code class="literal">FTS_DOC_ID</code> column, the column must be
        defined as <code class="literal">BIGINT UNSIGNED NOT NULL</code> and named
        <code class="literal">FTS_DOC_ID</code> (all upper case), as in the
        following example:
</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
          The <code class="literal">FTS_DOC_ID</code> column does not need to be
          defined as an <code class="literal">AUTO_INCREMENT</code> column but
          <code class="literal">AUTO_INCREMENT</code> could make loading data
          easier.
</p>
</div>
<pre class="programlisting">CREATE TABLE opening_lines (
FTS_DOC_ID BIGINT UNSIGNED AUTO_INCREMENT NOT NULL PRIMARY KEY,
opening_line TEXT(500),
author VARCHAR(200),
title VARCHAR(200)
) ENGINE=InnoDB;    </pre><p>
        If you choose to define the <code class="literal">FTS_DOC_ID</code> column
        yourself, you are responsible for managing the column to avoid
        empty or duplicate values. <code class="literal">FTS_DOC_ID</code> values
        cannot be reused, which means <code class="literal">FTS_DOC_ID</code>
        values must be ever increasing.
      </p><p>
        Optionally, you can create the required unique
        <code class="literal">FTS_DOC_ID_INDEX</code> (all upper case) on the
        <code class="literal">FTS_DOC_ID</code> column.
      </p><pre class="programlisting">CREATE UNIQUE INDEX FTS_DOC_ID_INDEX on opening_lines(FTS_DOC_ID);</pre><p>
        If you do not create the <code class="literal">FTS_DOC_ID_INDEX</code>,
        <code class="literal">InnoDB</code> creates it automatically.
</p>
<h5><a name="idm140644116177328"></a>InnoDB Full-Text Index Deletion Handling</h5>
<p>
        Deleting a record that has a full-text index column could result
        in numerous small deletions in the auxiliary index tables,
        making concurrent access to these tables a point of contention.
        To avoid this problem, the Document ID
        (<code class="literal">DOC_ID</code>) of a deleted document is logged in a
        special <code class="literal">FTS_*_DELETED</code> table whenever a record
        is deleted from an indexed table, and the indexed record remains
        in the full-text index. Before returning query results,
        information in the <code class="literal">FTS_*_DELETED</code> table is
        used to filter out deleted Document IDs. The benefit of this
        design is that deletions are fast and inexpensive. The drawback
        is that the size of the index is not immediately reduced after
        deleting records. To remove full-text index entries for deleted
        records, you must run <code class="literal">OPTIMIZE TABLE</code> on the
        indexed table with
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_optimize_fulltext_only"><code class="literal">innodb_optimize_fulltext_only=ON</code></a>
        to rebuild the full-text index. For more information, see
        <a class="xref" href="functions.html#fulltext-optimize" title="Optimizing InnoDB Full-Text Indexes">Optimizing InnoDB Full-Text Indexes</a>.
</p>
<h5><a name="idm140644116170336"></a>InnoDB Full-Text Index Transaction Handling</h5>
<p>
        <code class="literal">InnoDB</code> <code class="literal">FULLTEXT</code> indexes
        have special transaction handling characteristics due its
        caching and batch processing behavior. Specifically, updates and
        insertions on a <code class="literal">FULLTEXT</code> index are processed
        at transaction commit time, which means that a
        <code class="literal">FULLTEXT</code> search can only see committed data.
        The following example demonstrates this behavior. The
        <code class="literal">FULLTEXT</code> search only returns a result after
        the inserted lines are committed.
      </p><pre class="programlisting">mysql&gt; CREATE TABLE opening_lines (
id INT UNSIGNED AUTO_INCREMENT NOT NULL PRIMARY KEY,
opening_line TEXT(500),
author VARCHAR(200),
title VARCHAR(200),
FULLTEXT idx (opening_line)
) ENGINE=InnoDB;

mysql&gt; BEGIN;
Query OK, 0 rows affected (0.00 sec)

mysql&gt; INSERT INTO opening_lines(opening_line,author,title) VALUES
('Call me Ishmael.','Herman Melville','Moby-Dick'),
('A screaming comes across the sky.','Thomas Pynchon','Gravity\'s Rainbow'),
('I am an invisible man.','Ralph Ellison','Invisible Man'),
('Where now? Who now? When now?','Samuel Beckett','The Unnamable'),
('It was love at first sight.','Joseph Heller','Catch-22'),
('All this happened, more or less.','Kurt Vonnegut','Slaughterhouse-Five'),
('Mrs. Dalloway said she would buy the flowers herself.','Virginia Woolf','Mrs. Dalloway'),
('It was a pleasure to burn.','Ray Bradbury','Fahrenheit 451');
Query OK, 8 rows affected (0.00 sec)
Records: 8  Duplicates: 0  Warnings: 0

mysql&gt; SELECT COUNT(*) FROM opening_lines WHERE MATCH(opening_line) AGAINST('Ishmael');
+----------+
| COUNT(*) |
+----------+
|        0 |
+----------+

mysql&gt; COMMIT;
Query OK, 0 rows affected (0.00 sec)

mysql&gt; SELECT COUNT(*) FROM opening_lines WHERE MATCH(opening_line) AGAINST('Ishmael');
+----------+
| COUNT(*) |
+----------+
|        1 |
+----------+</pre>
<h5><a name="idm140644116162336"></a>Monitoring InnoDB Full-Text Indexes</h5>
<p>
        You can monitor and examine the special text-processing aspects
        of <code class="literal">InnoDB</code> <code class="literal">FULLTEXT</code> indexes
        by querying the following <code class="literal">INFORMATION_SCHEMA</code>
        tables:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <a class="link" href="information-schema.html#innodb-ft-config-table" title="21.31.21 The INFORMATION_SCHEMA INNODB_FT_CONFIG Table"><code class="literal">INNODB_FT_CONFIG</code></a>
          </p></li><li class="listitem"><p>
            <a class="link" href="information-schema.html#innodb-ft-index-table-table" title="21.31.23 The INFORMATION_SCHEMA INNODB_FT_INDEX_TABLE Table"><code class="literal">INNODB_FT_INDEX_TABLE</code></a>
          </p></li><li class="listitem"><p>
            <a class="link" href="information-schema.html#innodb-ft-index-cache-table" title="21.31.24 The INFORMATION_SCHEMA INNODB_FT_INDEX_CACHE Table"><code class="literal">INNODB_FT_INDEX_CACHE</code></a>
          </p></li><li class="listitem"><p>
            <a class="link" href="information-schema.html#innodb-ft-default-stopword-table" title="21.31.22 The INFORMATION_SCHEMA INNODB_FT_DEFAULT_STOPWORD Table"><code class="literal">INNODB_FT_DEFAULT_STOPWORD</code></a>
          </p></li><li class="listitem"><p>
            <a class="link" href="information-schema.html#innodb-ft-deleted-table" title="21.31.25 The INFORMATION_SCHEMA INNODB_FT_DELETED Table"><code class="literal">INNODB_FT_DELETED</code></a>
          </p></li><li class="listitem"><p>
            <a class="link" href="information-schema.html#innodb-ft-being-deleted-table" title="21.31.26 The INFORMATION_SCHEMA INNODB_FT_BEING_DELETED Table"><code class="literal">INNODB_FT_BEING_DELETED</code></a>
</p></li></ul>
</div>
<p>
        You can also view basic information for
        <code class="literal">FULLTEXT</code> indexes and tables by querying
        <a class="link" href="information-schema.html#innodb-sys-indexes-table" title="21.31.8 The INFORMATION_SCHEMA INNODB_SYS_INDEXES Table"><code class="literal">INNODB_SYS_INDEXES</code></a> and
        <a class="link" href="information-schema.html#innodb-sys-tables-table" title="21.31.7 The INFORMATION_SCHEMA INNODB_SYS_TABLES Table"><code class="literal">INNODB_SYS_TABLES</code></a>.
      </p><p>
        See
        <a class="xref" href="innodb-storage-engine.html#innodb-information-schema-fulltext_index-tables" title="14.12.4 InnoDB INFORMATION_SCHEMA FULLTEXT Index Tables">Section 14.12.4, “InnoDB INFORMATION_SCHEMA FULLTEXT Index Tables”</a>
        for more information.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="innodb-physical-structure"></a>14.2.7.4 Physical Structure of an InnoDB Index</h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140644116139728"></a><a class="indexterm" name="idm140644116138240"></a><a class="indexterm" name="idm140644116136752"></a><a class="indexterm" name="idm140644116135680"></a><p>
        With the exception of spatial indexes, <code class="literal">InnoDB</code>
        indexes are <a class="link" href="glossary.html#glos_b_tree" title="B-tree">B-tree</a> data
        structures. Spatial indexes use
        <a class="link" href="glossary.html#glos_r_tree" title="R-tree">R-trees</a>, which are
        specialized data structures for indexing multi-dimensional data.
        Index records are stored in the leaf pages of their B-tree or
        R-tree data structure. The default size of an index page is
        16KB.
      </p><p>
        When new records are inserted into an <code class="literal">InnoDB</code>
        <a class="link" href="glossary.html#glos_clustered_index" title="clustered index">clustered index</a>,
        <code class="literal">InnoDB</code> tries to leave 1/16 of the page free
        for future insertions and updates of the index records. If index
        records are inserted in a sequential order (ascending or
        descending), the resulting index pages are about 15/16 full. If
        records are inserted in a random order, the pages are from 1/2
        to 15/16 full.
      </p><p>
        As of MySQL 5.7.5, <code class="literal">InnoDB</code> performs a bulk
        load when creating or rebuilding B-tree indexes. This method of
        index creation is known as a sorted index build.
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_fill_factor"><code class="literal">innodb_fill_factor</code></a> defines the
        percentage of space on each B-tree page that is filled during a
        sorted index build, with the remaining space reserved for future
        index growth. Sorted index builds are not supported for spatial
        indexes. For more information, see
        <a class="xref" href="innodb-storage-engine.html#sorted-index-builds" title="14.2.7.8 Sorted Index Builds">Section 14.2.7.8, “Sorted Index Builds”</a>. As of MySQL 5.7.8, an
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_fill_factor"><code class="literal">innodb_fill_factor</code></a> setting of
        100 leaves 1/16 of the space in clustered index pages free for
        future index growth.
      </p><p>
        If the fill factor of an <code class="literal">InnoDB</code> index page
        drops below the <code class="literal">MERGE_THRESHOLD</code>, which is 50%
        by default if not specified, <code class="literal">InnoDB</code> tries to
        contract the index tree to free the page. The
        <code class="literal">MERGE_THRESHOLD</code> setting applies to both
        B-tree and R-tree indexes. For more information, see
        <a class="xref" href="innodb-storage-engine.html#index-page-merge-threshold" title="14.3.12 Configuring the Merge Threshold for Index Pages">Section 14.3.12, “Configuring the Merge Threshold for Index Pages”</a>.
      </p><p>
        You can configure the <a class="link" href="glossary.html#glos_page_size" title="page size">page
        size</a> for all <code class="literal">InnoDB</code> tablespaces in a
        MySQL instance by setting the
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_page_size"><code class="literal">innodb_page_size</code></a> configuration
        option before creating the instance. Once the page size for an
        instance is set, you cannot change it. Supported sizes are 64KB,
        32KB, 16KB (default), 8KB, and 4KB, corresponding to the option
        values <code class="literal">64k</code>, <code class="literal">32k</code>,
        <code class="literal">16k</code>, <code class="literal">8k</code>, and
        <code class="literal">4k</code>.
      </p><p>
        Support for 32KB and 64KB pages sizes was added in MySQL 5.7.6.
        For more information, refer to the
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_page_size"><code class="literal">innodb_page_size</code></a> documentation.
      </p><p>
        A MySQL instance using a particular <code class="literal">InnoDB</code>
        page size cannot use data files or log files from an instance
        that uses a different page size.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="innodb-insert-buffering"></a>14.2.7.5 Change Buffer</h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140644116107584"></a><a class="indexterm" name="idm140644116106096"></a><p>
        The change buffer is a special data structure that caches
        changes to <a class="link" href="glossary.html#glos_secondary_index" title="secondary index">secondary
        index</a> pages when affected pages are not in the
        <a class="link" href="glossary.html#glos_buffer_pool" title="buffer pool">buffer pool</a>. The
        buffered changes, which may result from
        <a class="link" href="sql-syntax.html#insert" title="13.2.5 INSERT Syntax"><code class="literal">INSERT</code></a>,
        <a class="link" href="sql-syntax.html#update" title="13.2.11 UPDATE Syntax"><code class="literal">UPDATE</code></a>, or
        <a class="link" href="sql-syntax.html#delete" title="13.2.2 DELETE Syntax"><code class="literal">DELETE</code></a> operations (DML), are
        merged later when the pages are loaded into the buffer pool by
        other read operations.
      </p><p>
        Unlike <a class="link" href="glossary.html#glos_clustered_index" title="clustered index">clustered
        indexes</a>, secondary indexes are usually non-unique, and
        inserts into secondary indexes happen in a relatively random
        order. Similarly, deletes and updates may affect secondary index
        pages that are not adjacently located in an index tree. Merging
        cached changes at a later time, when affected pages are read
        into the buffer pool by other operations, avoids substantial
        random access I/O that would be required to read-in secondary
        index pages from disk.
      </p><p>
        Periodically, the purge operation that runs when the system is
        mostly idle, or during a slow shutdown, writes the updated index
        pages to disk. The purge operation can write disk blocks for a
        series of index values more efficiently than if each value were
        written to disk immediately.
      </p><p>
        Change buffer merging may take several hours when there are
        numerous secondary indexes to update and many affected rows.
        During this time, disk I/O is increased, which can cause a
        significant slowdown for disk-bound queries. Change buffer
        merging may also continue to occur after a transaction is
        committed. In fact, change buffer merging may continue to occur
        after a server shutdown and restart (see
        <a class="xref" href="innodb-storage-engine.html#forcing-innodb-recovery" title="14.18.2 Forcing InnoDB Recovery">Section 14.18.2, “Forcing InnoDB Recovery”</a> for more information).
      </p><p>
        In memory, the change buffer occupies part of the
        <code class="literal">InnoDB</code> buffer pool. On disk, the change
        buffer is part of the system tablespace, so that index changes
        remain buffered across database restarts.
      </p><p>
        The type of data cached in the change buffer is governed by the
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_change_buffering"><code class="literal">innodb_change_buffering</code></a>
        configuration option. For more information see,
        <a class="xref" href="innodb-storage-engine.html#innodb-performance-change_buffering" title="14.3.5 Configuring InnoDB Change Buffering">Section 14.3.5, “Configuring InnoDB Change Buffering”</a>. You can
        also configure the maximum change buffer size. For more
        information, see
        <a class="xref" href="innodb-storage-engine.html#innodb-change-buffer-maximum-size" title="14.3.5.1 Configuring the Change Buffer Maximum Size">Section 14.3.5.1, “Configuring the Change Buffer Maximum Size”</a>.
</p>
<h5><a name="idm140644116089776"></a>Monitoring the Change Buffer</h5>
<p>
        The following options are available for change buffer
        monitoring:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <code class="literal">InnoDB</code> Standard Monitor output includes
            status information for the change buffer. To view monitor
            data, issue the <code class="literal">SHOW ENGINE INNODB STATUS</code>
            command.
          </p><pre class="programlisting">mysql&gt; SHOW ENGINE INNODB STATUS\G</pre><p>
            Change buffer status information is located under the
            <code class="literal">INSERT BUFFER AND ADAPTIVE HASH INDEX</code>
            heading and appears similar to the following:
          </p><pre class="programlisting">-------------------------------------
INSERT BUFFER AND ADAPTIVE HASH INDEX
-------------------------------------
Ibuf: size 1, free list len 0, seg size 2, 0 merges
merged operations:
 insert 0, delete mark 0, delete 0
discarded operations:
 insert 0, delete mark 0, delete 0
Hash table size 4425293, used cells 32, node heap has 1 buffer(s)
13577.57 hash searches/s, 202.47 non-hash searches/s</pre><p>
            For a description of each data point, see
            <a class="xref" href="innodb-storage-engine.html#innodb-standard-monitor" title="14.14.3 InnoDB Standard Monitor and Lock Monitor Output">Section 14.14.3, “InnoDB Standard Monitor and Lock Monitor Output”</a>.
          </p></li><li class="listitem"><p>
            The
            <a class="link" href="information-schema.html#innodb-metrics-table" title="21.31.20 The INFORMATION_SCHEMA INNODB_METRICS Table"><code class="literal">INFORMATION_SCHEMA.INNODB_METRICS</code></a>
            table provides most of the data points found in
            <code class="literal">InnoDB</code> Standard Monitor output, plus
            other data points. To view change buffer metrics and a
            description of each, issue the following query:
          </p><pre class="programlisting">mysql&gt; SELECT NAME, COMMENT FROM INFORMATION_SCHEMA.INNODB_METRICS WHERE NAME LIKE '%ibuf%'\G</pre><p>
            For <a class="link" href="information-schema.html#innodb-metrics-table" title="21.31.20 The INFORMATION_SCHEMA INNODB_METRICS Table"><code class="literal">INNODB_METRICS</code></a> table usage
            information, see
            <a class="xref" href="innodb-storage-engine.html#innodb-information-schema-metrics-table" title="14.12.6 InnoDB INFORMATION_SCHEMA Metrics Table">Section 14.12.6, “InnoDB INFORMATION_SCHEMA Metrics Table”</a>.
          </p></li><li class="listitem"><p>
            The
            <a class="link" href="information-schema.html#innodb-buffer-page-table" title="21.31.17 The INFORMATION_SCHEMA INNODB_BUFFER_PAGE Table"><code class="literal">INFORMATION_SCHEMA.INNODB_BUFFER_PAGE</code></a>
            table provides metadata about each page in the buffer pool,
            including change buffer index and change buffer bitmap
            pages. Change buffer pages are identified by
            <code class="literal">PAGE_TYPE</code>. <code class="literal">IBUF_INDEX</code>
            is the page type for change buffer index pages, and
            <code class="literal">IBUF_BITMAP</code> is the page type for change
            buffer bitmap pages.
</p>
<div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Warning
</div>
<p>
              Querying the
              <a class="link" href="information-schema.html#innodb-buffer-page-table" title="21.31.17 The INFORMATION_SCHEMA INNODB_BUFFER_PAGE Table"><code class="literal">INNODB_BUFFER_PAGE</code></a> table can
              introduce significant performance overhead. To avoid
              impacting performance, reproduce the issue you want to
              investigate on a test instance and run your queries on the
              test instance.
</p>
</div>
<p>
            For example, you can query the
            <a class="link" href="information-schema.html#innodb-buffer-page-table" title="21.31.17 The INFORMATION_SCHEMA INNODB_BUFFER_PAGE Table"><code class="literal">INNODB_BUFFER_PAGE</code></a> table to
            determine the approximate number of
            <code class="literal">IBUF_INDEX</code> and
            <code class="literal">IBUF_BITMAP</code> pages as a percentage of
            total buffer pool pages.
          </p><pre class="programlisting">SELECT  
(SELECT COUNT(*) FROM INFORMATION_SCHEMA.INNODB_BUFFER_PAGE 
WHERE PAGE_TYPE LIKE 'IBUF%'
) AS change_buffer_pages,
(
SELECT COUNT(*)
FROM INFORMATION_SCHEMA.INNODB_BUFFER_PAGE
) AS total_pages,
(
SELECT ((change_buffer_pages/total_pages)*100)
) AS change_buffer_page_percentage;
+---------------------+-------------+-------------------------------+
| change_buffer_pages | total_pages | change_buffer_page_percentage |
+---------------------+-------------+-------------------------------+
|                  25 |        8192 |                        0.3052 |
+---------------------+-------------+-------------------------------+</pre><p>
            For information about other data provided by the
            <a class="link" href="information-schema.html#innodb-buffer-page-table" title="21.31.17 The INFORMATION_SCHEMA INNODB_BUFFER_PAGE Table"><code class="literal">INNODB_BUFFER_PAGE</code></a> table, see
            <a class="xref" href="information-schema.html#innodb-buffer-page-table" title="21.31.17 The INFORMATION_SCHEMA INNODB_BUFFER_PAGE Table">Section 21.31.17, “The INFORMATION_SCHEMA INNODB_BUFFER_PAGE Table”</a>. For related
            usage information, see
            <a class="xref" href="innodb-storage-engine.html#innodb-information-schema-buffer-pool-tables" title="14.12.5 InnoDB INFORMATION_SCHEMA Buffer Pool Tables">Section 14.12.5, “InnoDB INFORMATION_SCHEMA Buffer Pool Tables”</a>.
          </p></li><li class="listitem"><p>
            <a class="link" href="performance-schema.html" title="Chapter 22 MySQL Performance Schema">Performance Schema</a>
            provides change buffer mutex wait instrumentation for
            advanced performance monitoring. To view change buffer
            instrumentation, issue the following query:
          </p><pre class="programlisting">mysql&gt; SELECT * FROM performance_schema.setup_instruments 
WHERE NAME LIKE '%wait/synch/mutex/innodb/ibuf%';
+-------------------------------------------------------+---------+-------+
| NAME                                                  | ENABLED | TIMED |
+-------------------------------------------------------+---------+-------+
| wait/synch/mutex/innodb/ibuf_bitmap_mutex             | YES     | YES   |
| wait/synch/mutex/innodb/ibuf_mutex                    | YES     | YES   |
| wait/synch/mutex/innodb/ibuf_pessimistic_insert_mutex | YES     | YES   |
+-------------------------------------------------------+---------+-------+</pre><p>
            For information about monitoring <code class="literal">InnoDB</code>
            mutex waits, see
            <a class="xref" href="innodb-storage-engine.html#monitor-innodb-mutex-waits-performance-schema" title="14.13.2 Monitoring InnoDB Mutex Waits Using Performance Schema">Section 14.13.2, “Monitoring InnoDB Mutex Waits Using Performance Schema”</a>.
</p></li></ul>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="innodb-adaptive-hash"></a>14.2.7.6 Adaptive Hash Indexes</h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140644116053008"></a><a class="indexterm" name="idm140644116051520"></a><p>
        The <a class="link" href="glossary.html#glos_adaptive_hash_index" title="adaptive hash index">adaptive hash
        index</a> (AHI) lets <code class="literal">InnoDB</code> perform more
        like an in-memory database on systems with appropriate
        combinations of workload and ample memory for the
        <a class="link" href="glossary.html#glos_buffer_pool" title="buffer pool">buffer pool</a>, without
        sacrificing any transactional features or reliability. This
        feature is enabled by the
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_adaptive_hash_index"><code class="literal">innodb_adaptive_hash_index</code></a>
        option, or turned off by
        <code class="literal">--skip-innodb_adaptive_hash_index</code> at server
        startup.
      </p><p>
        Based on the observed pattern of searches, MySQL builds a hash
        index using a prefix of the index key. The prefix of the key can
        be any length, and it may be that only some of the values in the
        B-tree appear in the hash index. Hash indexes are built on
        demand for those pages of the index that are often accessed.
      </p><p>
        If a table fits almost entirely in main memory, a hash index can
        speed up queries by enabling direct lookup of any element,
        turning the index value into a sort of pointer.
        <code class="literal">InnoDB</code> has a mechanism that monitors index
        searches. If <code class="literal">InnoDB</code> notices that queries
        could benefit from building a hash index, it does so
        automatically.
      </p><p>
        With some <a class="link" href="glossary.html#glos_workload" title="workload">workloads</a>, the
        speedup from hash index lookups greatly outweighs the extra work
        to monitor index lookups and maintain the hash index structure.
        Sometimes, the read/write lock that guards access to the
        adaptive hash index can become a source of contention under
        heavy workloads, such as multiple concurrent joins. Queries with
        <code class="literal">LIKE</code> operators and <code class="literal">%</code>
        wildcards also tend not to benefit from the AHI. For workloads
        where the adaptive hash index is not needed, turning it off
        reduces unnecessary performance overhead. Because it is
        difficult to predict in advance whether this feature is
        appropriate for a particular system, consider running benchmarks
        with it both enabled and disabled, using a realistic workload.
        The architectural changes in MySQL 5.6 and higher make more
        workloads suitable for disabling the adaptive hash index than in
        earlier releases, although it is still enabled by default.
      </p><p>
        As of MySQL 5.7.8, the adaptive hash index search system is
        partitioned. Each index is bound to a specific partition, and
        each partition is protected by a separate latch. Partitioning is
        controlled by the
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_adaptive_hash_index_parts"><code class="literal">innodb_adaptive_hash_index_parts</code></a>
        configuration option. Prior to MySQL 5.7.8, the adaptive hash
        index search system was protected by a single latch which could
        become a point of contention under heavy workloads. The
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_adaptive_hash_index_parts"><code class="literal">innodb_adaptive_hash_index_parts</code></a>
        option is set to 8 by default. The maximum setting is 512.
      </p><p>
        The hash index is always built based on an existing
        <a class="link" href="glossary.html#glos_b_tree" title="B-tree">B-tree</a> index on the table.
        <code class="literal">InnoDB</code> can build a hash index on a prefix of
        any length of the key defined for the B-tree, depending on the
        pattern of searches that <code class="literal">InnoDB</code> observes for
        the B-tree index. A hash index can be partial, covering only
        those pages of the index that are often accessed.
      </p><p>
        You can monitor the use of the adaptive hash index and the
        contention for its use in the <code class="literal">SEMAPHORES</code>
        section of the output of the
        <a class="link" href="sql-syntax.html#show-engine" title="13.7.5.15 SHOW ENGINE Syntax"><code class="literal">SHOW ENGINE INNODB
        STATUS</code></a> command. If you see many threads waiting on an
        RW-latch created in <code class="filename">btr0sea.c</code>, then it
        might be useful to disable adaptive hash indexing.
      </p><p>
        For more information about the performance characteristics of
        hash indexes, see <a class="xref" href="optimization.html#index-btree-hash" title="8.3.8 Comparison of B-Tree and Hash Indexes">Section 8.3.8, “Comparison of B-Tree and Hash Indexes”</a>.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="innodb-physical-record"></a>14.2.7.7 Physical Row Structure</h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140644116026320"></a><p>
        The physical row structure of an <code class="literal">InnoDB</code> table
        depends on the row format specified when the table is created.
        If a row format is not specified, the default row format is
        used. In MySQL 5.7.6 and earlier, <code class="literal">InnoDB</code> uses
        the <a class="link" href="glossary.html#glos_antelope" title="Antelope">Antelope</a> file format
        and its <code class="literal">COMPACT</code> row format by default. In
        MySQL 5.7.7, the
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_format"><code class="literal">innodb_file_format</code></a> default was
        changed to <code class="literal">Barracuda</code>, and in In MySQL 5.7.9,
        the default row format is defined by the
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_default_row_format"><code class="literal">innodb_default_row_format</code></a>
        configuration option, which has a default value of
        <code class="literal">DYNAMIC</code>.
      </p><p>
        The <code class="literal">REDUNDANT</code> format is available to retain
        compatibility with older versions of MySQL.
      </p><p>
        To check the row format of an <code class="literal">InnoDB</code> table,
        you can use <a class="link" href="sql-syntax.html#show-table-status" title="13.7.5.36 SHOW TABLE STATUS Syntax"><code class="literal">SHOW TABLE STATUS</code></a>.
        For example:
      </p><pre class="programlisting">mysql&gt; SHOW TABLE STATUS IN test1\G
*************************** 1. row ***************************
           Name: t1
         Engine: InnoDB
        Version: 10
     Row_format: Compact
           Rows: 0
 Avg_row_length: 0
    Data_length: 16384
Max_data_length: 0
   Index_length: 16384
      Data_free: 0
 Auto_increment: 1
    Create_time: 2014-10-31 16:02:01
    Update_time: NULL
     Check_time: NULL
      Collation: latin1_swedish_ci
       Checksum: NULL
 Create_options: 
        Comment:</pre><p>
        You can also check the row format of an
        <code class="literal">InnoDB</code> table by querying
        <a class="link" href="information-schema.html#innodb-sys-tables-table" title="21.31.7 The INFORMATION_SCHEMA INNODB_SYS_TABLES Table"><code class="literal">INFORMATION_SCHEMA.INNODB_SYS_TABLES</code></a>.
      </p><pre class="programlisting">mysql&gt; SELECT NAME, ROW_FORMAT FROM INFORMATION_SCHEMA.INNODB_SYS_TABLES WHERE NAME='test1/t1';
+----------+------------+
| NAME     | ROW_FORMAT |
+----------+------------+
| test1/t1 | Compact    |
+----------+------------+</pre><p>
        The <code class="literal">COMPACT</code> row format decreases row storage
        space by about 20% at the cost of increasing CPU use for some
        operations. If your workload is a typical one that is limited by
        cache hit rates and disk speed, <code class="literal">COMPACT</code>
        format is likely to be faster. If the workload is a rare case
        that is limited by CPU speed, <code class="literal">COMPACT</code> format
        might be slower.
      </p><p>
        Rows in <code class="literal">InnoDB</code> tables that use
        <code class="literal">REDUNDANT</code> row format have the following
        characteristics:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            Each index record contains a 6-byte header. The header is
            used to link together consecutive records, and also in
            row-level locking.
          </p></li><li class="listitem"><p>
            Records in the clustered index contain fields for all
            user-defined columns. In addition, there is a 6-byte
            transaction ID field and a 7-byte roll pointer field.
          </p></li><li class="listitem"><p>
            If no primary key was defined for a table, each clustered
            index record also contains a 6-byte row ID field.
          </p></li><li class="listitem"><p>
            Each secondary index record also contains all the primary
            key fields defined for the clustered index key that are not
            in the secondary index.
          </p></li><li class="listitem"><p>
            A record contains a pointer to each field of the record. If
            the total length of the fields in a record is less than 128
            bytes, the pointer is one byte; otherwise, two bytes. The
            array of these pointers is called the record directory. The
            area where these pointers point is called the data part of
            the record.
          </p></li><li class="listitem"><p>
            Internally, <code class="literal">InnoDB</code> stores fixed-length
            character columns such as
            <a class="link" href="data-types.html#char" title="11.4.1 The CHAR and VARCHAR Types"><code class="literal">CHAR(10)</code></a> in a fixed-length
            format. <code class="literal">InnoDB</code> does not truncate trailing
            spaces from <a class="link" href="data-types.html#char" title="11.4.1 The CHAR and VARCHAR Types"><code class="literal">VARCHAR</code></a> columns.
          </p></li><li class="listitem"><p>
            An SQL <code class="literal">NULL</code> value reserves one or two
            bytes in the record directory. Besides that, an SQL
            <code class="literal">NULL</code> value reserves zero bytes in the
            data part of the record if stored in a variable length
            column. In a fixed-length column, it reserves the fixed
            length of the column in the data part of the record.
            Reserving the fixed space for <code class="literal">NULL</code> values
            enables an update of the column from <code class="literal">NULL</code>
            to a non-<code class="literal">NULL</code> value to be done in place
            without causing fragmentation of the index page.
</p></li></ul>
</div>
<p>
        Rows in <code class="literal">InnoDB</code> tables that use
        <code class="literal">COMPACT</code> row format have the following
        characteristics:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            Each index record contains a 5-byte header that may be
            preceded by a variable-length header. The header is used to
            link together consecutive records, and also in row-level
            locking.
          </p></li><li class="listitem"><p>
            The variable-length part of the record header contains a bit
            vector for indicating <code class="literal">NULL</code> columns. If
            the number of columns in the index that can be
            <code class="literal">NULL</code> is <em class="replaceable"><code>N</code></em>, the
            bit vector occupies
            <code class="literal">CEILING(<em class="replaceable"><code>N</code></em>/8)</code>
            bytes. (For example, if there are anywhere from 9 to 15
            columns that can be <code class="literal">NULL</code>, the bit vector
            uses two bytes.) Columns that are <code class="literal">NULL</code> do
            not occupy space other than the bit in this vector. The
            variable-length part of the header also contains the lengths
            of variable-length columns. Each length takes one or two
            bytes, depending on the maximum length of the column. If all
            columns in the index are <code class="literal">NOT NULL</code> and
            have a fixed length, the record header has no
            variable-length part.
          </p></li><li class="listitem"><p>
            For each non-<code class="literal">NULL</code> variable-length field,
            the record header contains the length of the column in one
            or two bytes. Two bytes will only be needed if part of the
            column is stored externally in overflow pages or the maximum
            length exceeds 255 bytes and the actual length exceeds 127
            bytes. For an externally stored column, the 2-byte length
            indicates the length of the internally stored part plus the
            20-byte pointer to the externally stored part. The internal
            part is 768 bytes, so the length is 768+20. The 20-byte
            pointer stores the true length of the column.
          </p></li><li class="listitem"><p>
            The record header is followed by the data contents of the
            non-<code class="literal">NULL</code> columns.
          </p></li><li class="listitem"><p>
            Records in the clustered index contain fields for all
            user-defined columns. In addition, there is a 6-byte
            transaction ID field and a 7-byte roll pointer field.
          </p></li><li class="listitem"><p>
            If no primary key was defined for a table, each clustered
            index record also contains a 6-byte row ID field.
          </p></li><li class="listitem"><p>
            Each secondary index record also contains all the primary
            key fields defined for the clustered index key that are not
            in the secondary index. If any of these primary key fields
            are variable length, the record header for each secondary
            index will have a variable-length part to record their
            lengths, even if the secondary index is defined on
            fixed-length columns.
          </p></li><li class="listitem"><p>
            Internally, <code class="literal">InnoDB</code> stores fixed-length
            character columns such as
            <a class="link" href="data-types.html#char" title="11.4.1 The CHAR and VARCHAR Types"><code class="literal">CHAR(10)</code></a> in a fixed-length
            format. <code class="literal">InnoDB</code> does not truncate trailing
            spaces from <a class="link" href="data-types.html#char" title="11.4.1 The CHAR and VARCHAR Types"><code class="literal">VARCHAR</code></a> columns.
          </p></li><li class="listitem"><p>
            An SQL <code class="literal">NULL</code> value reserves one or two
            bytes in the record directory. Besides that, an SQL
            <code class="literal">NULL</code> value reserves zero bytes in the
            data part of the record if stored in a variable length
            column. In a fixed-length column, it reserves the fixed
            length of the column in the data part of the record.
            Reserving the fixed space for <code class="literal">NULL</code> values
            enables an update of the column from <code class="literal">NULL</code>
            to a non-<code class="literal">NULL</code> value to be done in place
            without causing fragmentation of the index page.
          </p></li><li class="listitem"><p>
            Internally, <code class="literal">InnoDB</code> attempts to store
            <code class="literal">utf8</code>
            <a class="link" href="data-types.html#char" title="11.4.1 The CHAR and VARCHAR Types"><code class="literal">CHAR(<em class="replaceable"><code>N</code></em>)</code></a>
            and <code class="literal">utf8mb4</code>
            <a class="link" href="data-types.html#char" title="11.4.1 The CHAR and VARCHAR Types"><code class="literal">CHAR(<em class="replaceable"><code>N</code></em>)</code></a>
            columns in <em class="replaceable"><code>N</code></em> bytes by trimming
            trailing spaces. If the byte length of a
            <a class="link" href="data-types.html#char" title="11.4.1 The CHAR and VARCHAR Types"><code class="literal">CHAR(<em class="replaceable"><code>N</code></em>)</code></a>
            column value exceeds <em class="replaceable"><code>N</code></em> bytes,
            <code class="literal">InnoDB</code> trims trailing spaces to a minimum
            of the column value byte length. The maximum length of a
            <a class="link" href="data-types.html#char" title="11.4.1 The CHAR and VARCHAR Types"><code class="literal">CHAR(<em class="replaceable"><code>N</code></em>)</code></a>
            column is the maximum character byte length ×
            <em class="replaceable"><code>N</code></em>, as reported by the
            <code class="literal">CHARACTER_OCTET_LENGTH</code> column of the
            <a class="link" href="information-schema.html#columns-table" title="21.4 The INFORMATION_SCHEMA COLUMNS Table"><code class="literal">INFORMATION_SCHEMA.COLUMNS</code></a>
            table.
          </p><p>
            <code class="literal">InnoDB</code> reserves a minimum of
            <em class="replaceable"><code>N</code></em> bytes for
            <a class="link" href="data-types.html#char" title="11.4.1 The CHAR and VARCHAR Types"><code class="literal">CHAR(<em class="replaceable"><code>N</code></em>)</code></a>.
            Reserving the minimum space <em class="replaceable"><code>N</code></em> in
            many cases enables column updates to be done in place
            without causing fragmentation of the index page.
          </p><p>
            By comparison, for <code class="literal">ROW_FORMAT=REDUNDANT</code>,
            <code class="literal">utf8</code> and <code class="literal">uft8mb4</code>
            columns occupy the maximum character byte length ×
            <em class="replaceable"><code>N</code></em>.
            <code class="literal">ROW_FORMAT=DYNAMIC</code> and
            <code class="literal">ROW_FORMAT=COMPRESSED</code> handle
            <a class="link" href="data-types.html#char" title="11.4.1 The CHAR and VARCHAR Types"><code class="literal">CHAR</code></a> storage in the same way
            as <code class="literal">ROW_FORMAT=COMPACT</code>.
</p></li></ul>
</div>
<p>
        <code class="literal">DYNAMIC</code> and <code class="literal">COMPRESSED</code> row
        formats are variations of the <code class="literal">COMPACT</code> row
        format. For information about these row formats, see
        <a class="xref" href="innodb-storage-engine.html#innodb-row-format-dynamic" title="14.8.3 DYNAMIC and COMPRESSED Row Formats">Section 14.8.3, “DYNAMIC and COMPRESSED Row Formats”</a>.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="sorted-index-builds"></a>14.2.7.8 Sorted Index Builds</h4>

</div>

</div>

</div>
<p>
        As of MySQL 5.7.5, <code class="literal">InnoDB</code> performs a bulk
        load instead of inserting one index record at a time when
        creating or rebuilding indexes. This method of index creation is
        also known as a sorted index build. Sorted index builds are not
        supported for spatial indexes.
      </p><p>
        There are three phases to an index build. In the first phase,
        the <a class="link" href="glossary.html#glos_clustered_index" title="clustered index">clustered index</a>
        is scanned, and index entries are generated and added to the
        sort buffer. When the <a class="link" href="glossary.html#glos_sort_buffer" title="sort buffer">sort
        buffer</a> becomes full, entries are sorted and written out
        to a temporary intermediate file. This process is also known as
        a <span class="quote">“<span class="quote">run</span>”</span>. In the second phase, with one or more runs
        written to the temporary intermediate file, a merge sort is
        performed on all entries in the file. In the third and final
        phase, the sorted entries are inserted into the
        <a class="link" href="glossary.html#glos_b_tree" title="B-tree">B-tree</a>.
      </p><p>
        Prior to the introduction of sorted index builds, index entries
        were inserted into the B-tree one record at a time using insert
        APIs. This method involved opening a B-tree
        <a class="link" href="glossary.html#glos_cursor" title="cursor">cursor</a> to find the insert
        position and then inserting entries into a B-tree page using an
        <a class="link" href="glossary.html#glos_optimistic" title="optimistic">optimistic</a> insert. If an
        insert failed due to a page being full, a
        <a class="link" href="glossary.html#glos_pessimistic" title="pessimistic">pessimistic</a> insert would
        be performed, which involves opening a B-tree cursor and
        splitting and merging B-tree nodes as necessary to find space
        for the entry. The drawbacks of this <span class="quote">“<span class="quote">top-down</span>”</span>
        method of building an index are the cost of searching for an
        insert position and the constant splitting and merging of B-tree
        nodes.
      </p><p>
        Sorted index builds use a bottom up approach to building an
        index. With this approach, a reference to the right-most leaf
        page is held at all levels of the B-tree. The right-most leaf
        page at the necessary B-tree depth is allocated and entries are
        inserted according to their sorted order. Once a leaf page is
        full, a node pointer is appended to the parent page and a
        sibling leaf page is allocated for the next insert. This process
        continues until all entries are inserted, which may result in
        inserts up to the root level. When a sibling page is allocated,
        the reference to the previously pinned leaf page is released,
        and the newly allocated leaf page becomes the right-most leaf
        page and new default insert location.
</p>
<h5><a name="idm140644115921664"></a>Reserving B-tree Page Space for Future Index Growth</h5>
<p>
        To set aside space for future index growth, you can use the
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_fill_factor"><code class="literal">innodb_fill_factor</code></a>
        configuration option to reserve a percentage of B-tree page
        space. For example, setting
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_fill_factor"><code class="literal">innodb_fill_factor</code></a> to 80 will
        reserve 20 percent of the space in B-tree pages during a sorted
        index build. This setting applies to both B-tree leaf and
        non-leaf pages. It does not apply to external pages used for
        <a class="link" href="data-types.html#blob" title="11.4.3 The BLOB and TEXT Types"><code class="literal">TEXT</code></a> or
        <a class="link" href="data-types.html#blob" title="11.4.3 The BLOB and TEXT Types"><code class="literal">BLOB</code></a> entries. The amount of space
        that is reserved may not be exactly as configured, as the
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_fill_factor"><code class="literal">innodb_fill_factor</code></a> value is
        interpreted as a hint rather than a hard limit.
</p>
<h5><a name="idm140644115913664"></a>Sorted Index Builds and Fulltext Index Support</h5>
<p>
        Sorted index builds are supported for
        <a class="link" href="glossary.html#glos_fulltext_index" title="FULLTEXT index">fulltext indexes</a>.
        Previously, SQL was used to insert entries into a fulltext
        index.
</p>
<h5><a name="idm140644115911424"></a>Sorted Index Builds and Compressed Tables</h5>
<p>
        For <a class="link" href="glossary.html#glos_compression" title="compression">compressed tables</a>,
        the previous index creation method appended entries to both
        compressed and uncompressed pages. When the modification log
        (representing free space on the compressed page) became full,
        the compressed page would be recompressed. If compression failed
        due to a lack of space, the page would be split. With sorted
        index builds, entries are only appended to uncompressed pages.
        When an uncompressed page becomes full, it is compressed.
        Adaptive padding is used to ensure that compression succeeds in
        most cases, but if compression fails, the page is split and
        compression is attempted again. This process continues until
        compression is successful. For additional information about
        compression of B-Tree pages, see
        <a class="xref" href="innodb-storage-engine.html#innodb-compression-internals" title="14.6.1.5 How Compression Works for InnoDB Tables">Section 14.6.1.5, “How Compression Works for InnoDB Tables”</a>.
</p>
<h5><a name="idm140644115907056"></a>Sorted Index Builds and Redo Logging</h5>
<p>
        <a class="link" href="glossary.html#glos_redo_log" title="redo log">Redo logging</a> is turned off
        during a sorted index build. Instead, there is a
        <a class="link" href="glossary.html#glos_checkpoint" title="checkpoint">checkpoint</a> to ensure that
        the index build can withstand a crash or failure. The checkpoint
        forces a write of all dirty pages to disk. During a sorted index
        build, the <a class="link" href="glossary.html#glos_page_cleaner" title="page cleaner">page cleaner</a>
        thread is signaled periodically to flush
        <a class="link" href="glossary.html#glos_dirty_page" title="dirty page">dirty pages</a> to ensure
        that the checkpoint operation can be processed quickly.
        Normally, the page cleaner thread flushes dirty pages when the
        number of clean pages falls below a set threshold. For sorted
        index builds, dirty pages are flushed promptly to reduce
        checkpoint overhead and to parallelize IO and CPU activity.
</p>
<h5><a name="idm140644115901952"></a>Sorted Index Builds and Optimizer Statistics</h5>
<p>
        Sorted index builds may result in
        <a class="link" href="glossary.html#glos_optimizer" title="optimizer">optimizer</a> statistics that
        differ from those generated by the previous method of index
        creation. The difference in statistics, which is not expected to
        affect workload performance, is due to the different algorithm
        that is used to populate the index.
</p>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="innodb-performance-latching"></a>14.2.8 InnoDB Mutex and Read/Write Lock Implementation</h3>

</div>

</div>

</div>
<p>
      In MySQL and <code class="literal">InnoDB</code>, multiple threads of
      execution access shared data structures. <code class="literal">InnoDB</code>
      synchronizes these accesses with its own implementation of
      <a class="link" href="glossary.html#glos_mutex" title="mutex">mutexes</a> and
      <a class="link" href="glossary.html#glos_rw_lock" title="rw-lock">read/write locks</a>.
      Historically, <code class="literal">InnoDB</code> protected the internal
      state of a read/write lock with an <code class="literal">InnoDB</code>
      mutex, and the the internal state of an <code class="literal">InnoDB</code>
      mutex was protected by a
      <a class="link" href="glossary.html#glos_pthreads" title="Pthreads">Pthreads</a> mutex, as in
      IEEE Std 1003.1c (POSIX.1c).
    </p><p>
      On many platforms, <a class="link" href="glossary.html#glos_atomic" title="atomic">Atomic</a>
      operations can often be used to synchronize the actions of
      multiple threads more efficiently than Pthreads. Each operation to
      acquire or release a lock can be done in fewer CPU instructions,
      wasting less time when threads contend for access to shared data
      structures. This in turn means greater scalability on multi-core
      platforms.
    </p><p>
      On platforms that support
      <a class="link" href="glossary.html#glos_atomic" title="atomic">Atomic</a> operations,
      <code class="literal">InnoDB</code> now implements mutexes and read/write
      locks with the
      <a class="ulink" href="http://gcc.gnu.org/onlinedocs/gcc-4.1.2/gcc/Atomic-Builtins.html" target="_top">built-in
      functions provided by the GNU Compiler Collection (GCC) for atomic
      memory access</a> instead of using the Pthreads approach. More
      specifically, <code class="literal">InnoDB</code> compiled with GCC version
      4.1.2 or later uses the atomic builtins instead of a
      <code class="literal">pthread_mutex_t</code> to implement
      <code class="literal">InnoDB</code> mutexes and read/write locks.
    </p><p>
      On 32-bit Microsoft Windows, <code class="literal">InnoDB</code> implements
      mutexes (but not read/write locks) with hand-written assembler
      instructions. Beginning with Microsoft Windows 2000, functions for
      <a class="ulink" href="http://msdn.microsoft.com/en-us/library/ms684122(VS.85).aspx" target="_top">Interlocked
      Variable Access</a> are available that are similar to the
      built-in functions provided by GCC. On Windows 2000 and higher,
      <code class="literal">InnoDB</code> makes use of the Interlocked functions,
      which support read/write locks and 64-bit platforms.
    </p><p>
      Solaris 10 introduced library functions for atomic operations, and
      InnoDB uses these functions by default. When MySQL is compiled on
      Solaris 10 or later with a compiler that does not support the
      <a class="ulink" href="http://gcc.gnu.org/onlinedocs/gcc-4.1.2/gcc/Atomic-Builtins.html" target="_top">built-in
      functions provided by the GNU Compiler Collection (GCC) for atomic
      memory access</a>, <code class="literal">InnoDB</code> uses the library
      functions.
    </p><p>
      On platforms where the GCC, Windows, or Solaris functions for
      atomic memory access are not available, <code class="literal">InnoDB</code>
      uses the traditional Pthreads method of implementing mutexes and
      read/write locks.
    </p><p>
      When MySQL starts, <code class="literal">InnoDB</code> writes a message to
      the log file indicating whether atomic memory access is used for
      mutexes, for mutexes and read/write locks, or neither. If suitable
      tools are used to build <code class="literal">InnoDB</code> and the target
      CPU supports the atomic operations required,
      <code class="literal">InnoDB</code> uses the built-in functions for
      mutexing. If, in addition, the compare-and-swap operation can be
      used on thread identifiers (<code class="literal">pthread_t</code>), then
      <code class="literal">InnoDB</code> uses the instructions for read-write
      locks as well.
    </p><p>
      If you are building from source, ensure that the build process
      properly takes advantage of your platform capabilities.
    </p><p>
      For more information about the performance implications of
      locking, see <a class="xref" href="optimization.html#locking-issues" title="8.11 Optimizing Locking Operations">Section 8.11, “Optimizing Locking Operations”</a>.
</p>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="innodb-configuration"></a>14.3 InnoDB Configuration</h2>

</div>

</div>

</div>
<div class="toc">
<dl class="toc"><dt><span class="section"><a href="innodb-storage-engine.html#innodb-init-startup-configuration">14.3.1 InnoDB Initialization and Startup Configuration</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-read-only-instance">14.3.2 Configuring InnoDB for Read-Only Operation</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-performance-buffer-pool">14.3.3 InnoDB Buffer Pool Configuration</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-performance-use_sys_malloc">14.3.4 Configuring the Memory Allocator for InnoDB</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-performance-change_buffering">14.3.5 Configuring InnoDB Change Buffering</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-performance-thread_concurrency">14.3.6 Configuring Thread Concurrency for InnoDB</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-performance-multiple_io_threads">14.3.7 Configuring the Number of Background InnoDB I/O Threads</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-performance-thread_io_rate">14.3.8 Configuring the InnoDB Master Thread I/O Rate</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-performance-spin_lock_polling">14.3.9 Configuring Spin Lock Polling</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-improved-purge-scheduling">14.3.10 Configuring InnoDB Purge Scheduling</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-performance-optimizer-statistics">14.3.11 Configuring Optimizer Statistics for InnoDB</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#index-page-merge-threshold">14.3.12 Configuring the Merge Threshold for Index Pages</a></span></dt></dl>
</div>
<p>
    This section provides configuration information and procedures for
    <code class="literal">InnoDB</code> initialization, startup, and various
    components and features of the <code class="literal">InnoDB</code> storage
    engine. For information about optimizing database operations for
    <code class="literal">InnoDB</code> tables, see
    <a class="xref" href="optimization.html#optimizing-innodb" title="8.5 Optimizing for InnoDB Tables">Section 8.5, “Optimizing for InnoDB Tables”</a>.
</p>
<div class="section">

<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="innodb-init-startup-configuration"></a>14.3.1 InnoDB Initialization and Startup Configuration</h3>
</div>
</div>
</div>
<a class="indexterm" name="idm140644115865840"></a><p>
      The first decisions to make about InnoDB configuration involve how
      to lay out InnoDB data files, and how much memory to allocate for
      the InnoDB storage engine. You record these choices either by
      recording them in a configuration file that MySQL reads at
      startup, or by specifying them as command-line options in a
      startup script. The full list of options, descriptions, and
      allowed parameter values is at
      <a class="xref" href="innodb-storage-engine.html#innodb-parameters" title="14.11 InnoDB Startup Options and System Variables">Section 14.11, “InnoDB Startup Options and System Variables”</a>.
</p>
<h4><a name="idm140644115862848"></a>Overview of InnoDB Tablespace and Log Files</h4>
<p>
      Two important disk-based resources managed by the
      <code class="literal">InnoDB</code> storage engine are its tablespace data
      files and its log files. If you specify no
      <code class="literal">InnoDB</code> configuration options, MySQL creates an
      auto-extending data file, slightly larger than 12MB, named
      <code class="filename">ibdata1</code> and two log files named
      <code class="filename">ib_logfile0</code> and
      <code class="filename">ib_logfile1</code> in the MySQL data directory.
      Their size is given by the size of the
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_log_file_size"><code class="literal">innodb_log_file_size</code></a> system
      variable. To get good performance, explicitly provide
      <code class="literal">InnoDB</code> parameters as discussed in the following
      examples. Naturally, edit the settings to suit your hardware and
      requirements.
    </p><p>
      The examples shown here are representative. See
      <a class="xref" href="innodb-storage-engine.html#innodb-parameters" title="14.11 InnoDB Startup Options and System Variables">Section 14.11, “InnoDB Startup Options and System Variables”</a> for additional information
      about <code class="literal">InnoDB</code>-related configuration parameters.
</p>
<h4><a name="idm140644115853696"></a>Considerations for Storage Devices</h4>
<p>
      In some cases, database performance improves if the data is not
      all placed on the same physical disk. Putting log files on a
      different disk from data is very often beneficial for performance.
      The example illustrates how to do this. It places the two data
      files on different disks and places the log files on the third
      disk. <code class="literal">InnoDB</code> fills the tablespace beginning
      with the first data file. You can also use raw disk partitions
      (raw devices) as <code class="literal">InnoDB</code> data files, which may
      speed up I/O. See <a class="xref" href="innodb-storage-engine.html#innodb-raw-devices" title="14.4.3 Using Raw Disk Partitions for the System Tablespace">Section 14.4.3, “Using Raw Disk Partitions for the System Tablespace”</a>.
</p>
<div class="caution" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Caution
</div>
<p>
        <code class="literal">InnoDB</code> is a transaction-safe (ACID compliant)
        storage engine for MySQL that has commit, rollback, and
        crash-recovery capabilities to protect user data.
        <span class="bold"><strong>However, it cannot do so</strong></span> if the
        underlying operating system or hardware does not work as
        advertised. Many operating systems or disk subsystems may delay
        or reorder write operations to improve performance. On some
        operating systems, the very <code class="literal">fsync()</code> system
        call that should wait until all unwritten data for a file has
        been flushed might actually return before the data has been
        flushed to stable storage. Because of this, an operating system
        crash or a power outage may destroy recently committed data, or
        in the worst case, even corrupt the database because of write
        operations having been reordered. If data integrity is important
        to you, perform some <span class="quote">“<span class="quote">pull-the-plug</span>”</span> tests before
        using anything in production. On OS X 10.3 and higher,
        <code class="literal">InnoDB</code> uses a special
        <code class="literal">fcntl()</code> file flush method. Under Linux, it is
        advisable to <span class="bold"><strong>disable the write-back
        cache</strong></span>.
      </p><p>
        On ATA/SATA disk drives, a command such <code class="literal">hdparm -W0
        /dev/hda</code> may work to disable the write-back cache.
        <span class="bold"><strong>Beware that some drives or disk
        controllers may be unable to disable the write-back
        cache.</strong></span>
      </p><p>
        With regard to <code class="literal">InnoDB</code> recovery capabilities
        that protect user data, <code class="literal">InnoDB</code> uses a file
        flush technique involving a structure called the
        <a class="link" href="glossary.html#glos_doublewrite_buffer" title="doublewrite buffer">doublewrite
        buffer</a>, which is enabled by default
        (<a class="link" href="innodb-storage-engine.html#sysvar_innodb_doublewrite"><code class="literal">innodb_doublewrite=ON</code></a>). The
        doublewrite buffer adds safety to recovery following a crash or
        power outage, and improves performance on most varieties of Unix
        by reducing the need for <code class="literal">fsync()</code> operations.
        It is recommended that the
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_doublewrite"><code class="literal">innodb_doublewrite</code></a> option
        remains enabled if you are concerned with data integrity or
        possible failures. For additional information about the
        doublewrite buffer, see
        <a class="xref" href="innodb-storage-engine.html#innodb-disk-management" title="14.9 InnoDB Disk I/O and File Space Management">Section 14.9, “InnoDB Disk I/O and File Space Management”</a>.
</p>
</div>
<div class="caution" style="margin-left: 0.5in; margin-right: 0.5in;">
<div class="admon-title">
Caution
</div>
<a class="indexterm" name="idm140644115833728"></a><a class="indexterm" name="idm140644115832224"></a><p>
        If reliability is a consideration for your data, do not
        configure <code class="literal">InnoDB</code> to use data files or log
        files on NFS volumes. Potential problems vary according to OS
        and version of NFS, and include such issues as lack of
        protection from conflicting writes, and limitations on maximum
        file sizes.
</p>
</div>
<h4><a name="idm140644115829200"></a>Specifying the Location and Size for InnoDB Tablespace Files</h4>
<p>
      To set up the <code class="literal">InnoDB</code> tablespace files, use the
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_data_file_path"><code class="literal">innodb_data_file_path</code></a> option in
      the <code class="literal">[mysqld]</code> section of the
      <code class="filename">my.cnf</code> option file. On Windows, you can use
      <code class="filename">my.ini</code> instead. The value of
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_data_file_path"><code class="literal">innodb_data_file_path</code></a> should be a
      list of one or more data file specifications. If you name more
      than one data file, separate them by semicolon
      (<span class="quote">“<span class="quote"><code class="literal">;</code></span>”</span>) characters:
    </p><pre class="programlisting">
innodb_data_file_path=<em class="replaceable"><code>datafile_spec1</code></em>[;<em class="replaceable"><code>datafile_spec2</code></em>]...
</pre><p>
      For example, the following setting explicitly creates a minimally
      sized system tablespace:
    </p><pre class="programlisting">
[mysqld]
innodb_data_file_path=ibdata1:12M:autoextend
</pre><p>
      This setting configures a single 12MB data file named
      <code class="filename">ibdata1</code> that is auto-extending. No location
      for the file is given, so by default, <code class="literal">InnoDB</code>
      creates it in the MySQL data directory.
    </p><p>
      Sizes are specified using <code class="literal">K</code>,
      <code class="literal">M</code>, or <code class="literal">G</code> suffix letters to
      indicate units of KB, MB, or GB.
    </p><p>
      A tablespace containing a fixed-size 50MB data file named
      <code class="filename">ibdata1</code> and a 50MB auto-extending file named
      <code class="filename">ibdata2</code> in the data directory can be
      configured like this:
    </p><pre class="programlisting">
[mysqld]
innodb_data_file_path=ibdata1:50M;ibdata2:50M:autoextend
</pre><p>
      The full syntax for a data file specification includes the file
      name, its size, and several optional attributes:
    </p><pre class="programlisting">
<em class="replaceable"><code>file_name</code></em>:<em class="replaceable"><code>file_size</code></em>[:autoextend[:max:<em class="replaceable"><code>max_file_size</code></em>]]
</pre><p>
      The <code class="literal">autoextend</code> and <code class="literal">max</code>
      attributes can be used only for the last data file in the
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_data_file_path"><code class="literal">innodb_data_file_path</code></a> line.
    </p><p>
      If you specify the <code class="literal">autoextend</code> option for the
      last data file, <code class="literal">InnoDB</code> extends the data file if
      it runs out of free space in the tablespace. The increment is 8MB
      at a time by default. To modify the increment, change the
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_autoextend_increment"><code class="literal">innodb_autoextend_increment</code></a>
      system variable.
    </p><p>
      If the disk becomes full, you might want to add another data file
      on another disk. For tablespace reconfiguration instructions, see
      <a class="xref" href="innodb-storage-engine.html#innodb-resize-system-tablespace" title="14.4.1 Resizing the InnoDB System Tablespace">Section 14.4.1, “Resizing the InnoDB System Tablespace”</a>.
    </p><p>
      <code class="literal">InnoDB</code> is not aware of the file system maximum
      file size, so be cautious on file systems where the maximum file
      size is a small value such as 2GB. To specify a maximum size for
      an auto-extending data file, use the <code class="literal">max</code>
      attribute following the <code class="literal">autoextend</code> attribute.
      Use the <code class="literal">max</code> attribute only in cases where
      constraining disk usage is of critical importance, because
      exceeding the maximum size causes a fatal error, possibly
      including a crash. The following configuration permits
      <code class="filename">ibdata1</code> to grow up to a limit of 500MB:
    </p><pre class="programlisting">
[mysqld]
innodb_data_file_path=ibdata1:12M:autoextend:max:500M
</pre><p>
      <code class="literal">InnoDB</code> creates tablespace files in the MySQL
      data directory by default. To specify a location explicitly, use
      the <a class="link" href="innodb-storage-engine.html#sysvar_innodb_data_home_dir"><code class="literal">innodb_data_home_dir</code></a> option.
      For example, to use two files named <code class="filename">ibdata1</code>
      and <code class="filename">ibdata2</code> but create them in the
      <code class="filename">/ibdata</code> directory, configure
      <code class="literal">InnoDB</code> like this:
    </p><pre class="programlisting">
[mysqld]
innodb_data_home_dir = /ibdata
innodb_data_file_path=ibdata1:50M;ibdata2:50M:autoextend
</pre>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
        <code class="literal">InnoDB</code> does not create directories, so make
        sure that the <code class="filename">/ibdata</code> directory exists
        before you start the server. This is also true of any log file
        directories that you configure. Use the Unix or DOS
        <code class="literal">mkdir</code> command to create any necessary
        directories.
      </p><p>
        Make sure that the MySQL server has the proper access rights to
        create files in the data directory. More generally, the server
        must have access rights in any directory where it needs to
        create data files or log files.
</p>
</div>
<p>
      <code class="literal">InnoDB</code> forms the directory path for each data
      file by textually concatenating the value of
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_data_home_dir"><code class="literal">innodb_data_home_dir</code></a> to the data
      file name, adding a path name separator (slash or backslash)
      between values if necessary. If the
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_data_home_dir"><code class="literal">innodb_data_home_dir</code></a> option is
      not specified in <code class="filename">my.cnf</code> at all, the default
      value is the <span class="quote">“<span class="quote">dot</span>”</span> directory <code class="filename">./</code>,
      which means the MySQL data directory. (The MySQL server changes
      its current working directory to its data directory when it begins
      executing.)
    </p><p>
      If you specify
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_data_home_dir"><code class="literal">innodb_data_home_dir</code></a> as an empty
      string, you can specify absolute paths for the data files listed
      in the <a class="link" href="innodb-storage-engine.html#sysvar_innodb_data_file_path"><code class="literal">innodb_data_file_path</code></a>
      value. The following example is equivalent to the preceding one:
    </p><pre class="programlisting">
[mysqld]
innodb_data_home_dir =
innodb_data_file_path=/ibdata/ibdata1:50M;/ibdata/ibdata2:50M:autoextend
</pre>
<h4><a name="idm140644115776160"></a>Specifying InnoDB Configuration Options</h4>
<p>
      <span class="bold"><strong>Sample <code class="filename">my.cnf</code> file for
      small systems.</strong></span> Suppose that you have a computer with
      512MB RAM and one hard disk. The following example shows possible
      configuration parameters in <code class="filename">my.cnf</code> or
      <code class="filename">my.ini</code> for <code class="literal">InnoDB</code>,
      including the <code class="literal">autoextend</code> attribute. The example
      suits most users, both on Unix and Windows, who do not want to
      distribute <code class="literal">InnoDB</code> data files and log files onto
      several disks. It creates an auto-extending data file
      <code class="filename">ibdata1</code> and two <code class="literal">InnoDB</code> log
      files <code class="filename">ib_logfile0</code> and
      <code class="filename">ib_logfile1</code> in the MySQL data directory.
    </p><pre class="programlisting">
[mysqld]
# You can write your other MySQL server options here
# ...
# Data files must be able to hold your data and indexes.
# Make sure that you have enough free disk space.
innodb_data_file_path = ibdata1:12M:autoextend
#
# Set buffer pool size to 50-80% of your computer's memory
innodb_buffer_pool_size=256M
#
# Set the log file size to about 25% of the buffer pool size
innodb_log_file_size=64M
innodb_log_buffer_size=8M
#
innodb_flush_log_at_trx_commit=1
</pre><p>
      Note that data files must be less than 2GB in some file systems.
      The combined size of the log files can be up to 512GB. The
      combined size of data files must be slightly larger than 10MB.
</p>
<h4><a name="idm140644115765104"></a>Setting Up the InnoDB System Tablespace</h4>
<p>
      When you create an <code class="literal">InnoDB</code> system tablespace for
      the first time, it is best that you start the MySQL server from
      the command prompt. <code class="literal">InnoDB</code> then prints the
      information about the database creation to the screen, so you can
      see what is happening. For example, on Windows, if
      <a class="link" href="programs.html#mysqld" title="4.3.1 mysqld — The MySQL Server"><span class="command"><strong>mysqld</strong></span></a> is located in <code class="filename">C:\Program
      Files\MySQL\MySQL Server 5.7\bin</code>, you can
      start it like this:
    </p><pre class="programlisting">
C:\&gt; <strong class="userinput"><code>"C:\Program Files\MySQL\MySQL Server 5.7\bin\mysqld" --console</code></strong>
</pre><p>
      If you do not send server output to the screen, check the server's
      error log to see what <code class="literal">InnoDB</code> prints during the
      startup process.
</p>
<h4><a name="idm140644115757584"></a>Editing the MySQL Configuration File</h4>
<p>
      You can place <code class="literal">InnoDB</code> options in the
      <code class="literal">[mysqld]</code> group of any option file that your
      server reads when it starts. The locations for option files are
      described in <a class="xref" href="programs.html#option-files" title="4.2.6 Using Option Files">Section 4.2.6, “Using Option Files”</a>.
    </p><p>
      If you installed MySQL on Windows using the installation and
      configuration wizards, the option file will be the
      <code class="filename">my.ini</code> file located in your MySQL
      installation directory. See <a class="xref" href="installing.html#mysql-installer" title="2.3.3 Installing MySQL on Microsoft Windows Using MySQL Installer">Section 2.3.3, “Installing MySQL on Microsoft Windows Using MySQL Installer”</a>.
    </p><p>
      If your PC uses a boot loader where the <code class="filename">C:</code>
      drive is not the boot drive, your only option is to use the
      <code class="filename">my.ini</code> file in your Windows directory
      (typically <code class="filename">C:\WINDOWS</code>). You can use the
      <code class="literal">SET</code> command at the command prompt in a console
      window to print the value of <code class="literal">WINDIR</code>:
    </p><pre class="programlisting">
C:\&gt; <strong class="userinput"><code>SET WINDIR</code></strong>
windir=C:\WINDOWS
</pre><p>
      To make sure that <a class="link" href="programs.html#mysqld" title="4.3.1 mysqld — The MySQL Server"><span class="command"><strong>mysqld</strong></span></a> reads options only
      from a specific file, use the
      <a class="link" href="programs.html#option_general_defaults-file"><code class="option">--defaults-file</code></a> option as the
      first option on the command line when starting the server:
    </p><pre class="programlisting">
mysqld --defaults-file=<em class="replaceable"><code>your_path_to_my_cnf</code></em>
</pre><p>
      <span class="bold"><strong>Sample <code class="filename">my.cnf</code> file for
      large systems.</strong></span> Suppose that you have a Linux computer
      with 2GB RAM and three 60GB hard disks at directory paths
      <code class="filename">/</code>, <code class="filename">/dr2</code> and
      <code class="filename">/dr3</code>. The following example shows possible
      configuration parameters in <code class="filename">my.cnf</code> for
      <code class="literal">InnoDB</code>.
    </p><pre class="programlisting">
[mysqld]
# You can write your other MySQL server options here
# ...
innodb_data_home_dir =
#
# Data files must be able to hold your data and indexes
innodb_data_file_path = /db/ibdata1:2000M;/dr2/db/ibdata2:2000M:autoextend
#
# Set buffer pool size to 50-80% of your computer's memory,
# but make sure on Linux x86 total memory usage is &lt; 2GB
innodb_buffer_pool_size=1G
innodb_log_group_home_dir = /dr3/iblogs
#
# Set the log file size to about 25% of the buffer pool size
innodb_log_file_size=250M
innodb_log_buffer_size=8M
#
innodb_flush_log_at_trx_commit=1
innodb_lock_wait_timeout=50
#
# Uncomment the next line if you want to use it
#innodb_thread_concurrency=5
</pre>
<h4><a name="idm140644115735920"></a>Determining the Maximum Memory Allocation for InnoDB</h4>
<div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;">
<div class="admon-title">
Warning
</div>
<p>
        On 32-bit GNU/Linux x86, be careful not to set memory usage too
        high. <code class="literal">glibc</code> may permit the process heap to
        grow over thread stacks, which crashes your server. It is a risk
        if the value of the following expression is close to or exceeds
        2GB:
      </p><pre class="programlisting">
innodb_buffer_pool_size
+ key_buffer_size
+ max_connections*(sort_buffer_size+read_buffer_size+binlog_cache_size)
+ max_connections*2MB
</pre><p>
        Each thread uses a stack (often 2MB, but only 256KB in MySQL
        binaries provided by Oracle Corporation.) and in the worst case
        also uses <code class="literal">sort_buffer_size + read_buffer_size</code>
        additional memory.
</p>
</div>
<p>
      <span class="bold"><strong>Tuning other <a class="link" href="programs.html#mysqld" title="4.3.1 mysqld — The MySQL Server"><span class="command"><strong>mysqld</strong></span></a>
      server parameters.</strong></span> The following values are typical and
      suit most users:
    </p><pre class="programlisting">
[mysqld]
skip-external-locking
max_connections=200
read_buffer_size=1M
sort_buffer_size=1M
#
# Set key_buffer to 5 - 50% of your RAM depending on how much
# you use MyISAM tables, but keep key_buffer_size + InnoDB
# buffer pool size &lt; 80% of your RAM
key_buffer_size=<em class="replaceable"><code>value</code></em>
</pre><p>
      On Linux, if the kernel is enabled for large page support,
      <code class="literal">InnoDB</code> can use large pages to allocate memory
      for its buffer pool and additional memory pool. See
      <a class="xref" href="optimization.html#large-page-support" title="8.12.5.2 Enabling Large Page Support">Section 8.12.5.2, “Enabling Large Page Support”</a>.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="innodb-read-only-instance"></a>14.3.2 Configuring InnoDB for Read-Only Operation</h3>

</div>

</div>

</div>
<p>
      You can now query <code class="literal">InnoDB</code> tables where the MySQL
      data directory is on read-only media, by enabling the
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_read_only"><code class="literal">--innodb-read-only</code></a> configuration
      option at server startup.
</p>
<h4><a name="idm140644115721568"></a>How to Enable</h4>
<p>
      To prepare an instance for read-only operation, make sure all the
      necessary information is <a class="link" href="glossary.html#glos_flush" title="flush">flushed</a>
      to the data files before storing it on the read-only medium. Run
      the server with change buffering disabled
      (<a class="link" href="innodb-storage-engine.html#sysvar_innodb_change_buffering"><code class="literal">innodb_change_buffering=0</code></a>) and
      do a <a class="link" href="glossary.html#glos_slow_shutdown" title="slow shutdown">slow shutdown</a>.
    </p><p>
      To enable read-only mode for an entire MySQL instance, specify the
      following configuration options at server startup:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_read_only"><code class="literal">--innodb-read-only=1</code></a>
        </p></li><li class="listitem"><p>
          If the instance is on read-only media such as a DVD or CD, or
          the <code class="filename">/var</code> directory is not writeable by
          all:
          <code class="literal">--pid-file=<em class="replaceable"><code>path_on_writeable_media</code></em></code>
          and <code class="literal">--event-scheduler=disabled</code>
</p></li></ul>
</div>
<h4><a name="idm140644115710912"></a>Usage Scenarios</h4>
<p>
      This mode of operation is appropriate in situations such as:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          Distributing a MySQL application, or a set of MySQL data, on a
          read-only storage medium such as a DVD or CD.
        </p></li><li class="listitem"><p>
          Multiple MySQL instances querying the same data directory
          simultaneously, typically in a data warehousing configuration.
          You might use this technique to avoid
          <a class="link" href="glossary.html#glos_bottleneck" title="bottleneck">bottlenecks</a> that can
          occur with a heavily loaded MySQL instance, or you might use
          different configuration options for the various instances to
          tune each one for particular kinds of queries.
        </p></li><li class="listitem"><p>
          Querying data that has been put into a read-only state for
          security or data integrity reasons, such as archived backup
          data.
</p></li></ul>
</div>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">
<div class="admon-title">
Note
</div>
<p>
        This feature is mainly intended for flexibility in distribution
        and deployment, rather than raw performance based on the
        read-only aspect. See
        <a class="xref" href="optimization.html#innodb-performance-ro-txn" title="8.5.3 Optimizing InnoDB Read-Only Transactions">Section 8.5.3, “Optimizing InnoDB Read-Only Transactions”</a> for ways to tune the
        performance of read-only queries, which do not require making
        the entire server read-only.
</p>
</div>
<h4><a name="idm140644115703632"></a>How It Works</h4>
<p>
      When the server is run in read-only mode through the
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_read_only"><code class="literal">--innodb-read-only</code></a> option,
      certain <code class="literal">InnoDB</code> features and components are
      reduced or turned off entirely:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          No <a class="link" href="glossary.html#glos_change_buffering" title="change buffering">change
          buffering</a> is done, in particular no merges from the
          change buffer. To make sure the change buffer is empty when
          you prepare the instance for read-only operation, disable
          change buffering
          (<a class="link" href="innodb-storage-engine.html#sysvar_innodb_change_buffering"><code class="literal">innodb_change_buffering=0</code></a>)
          and do a <a class="link" href="glossary.html#glos_slow_shutdown" title="slow shutdown">slow
          shutdown</a> first.
        </p></li><li class="listitem"><p>
          There is no <a class="link" href="glossary.html#glos_crash_recovery" title="crash recovery">crash
          recovery</a> phase at startup. The instance must have
          performed a <a class="link" href="glossary.html#glos_slow_shutdown" title="slow shutdown">slow
          shutdown</a> before being put into the read-only state.
        </p></li><li class="listitem"><p>
          Because the <a class="link" href="glossary.html#glos_redo_log" title="redo log">redo log</a> is
          not used in read-only operation, you can set
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_log_file_size"><code class="literal">innodb_log_file_size</code></a> to the
          smallest size possible (1 MB) before making the instance
          read-only.
        </p></li><li class="listitem"><p>
          All background threads other than I/O read threads are turned
          off. As a consequence, a read-only instance cannot encounter
          any <a class="link" href="glossary.html#glos_deadlock" title="deadlock">deadlocks</a>.
        </p></li><li class="listitem"><p>
          Information about deadlocks, monitor output, and so on is not
          written to temporary files. As a consequence,
          <a class="link" href="sql-syntax.html#show-engine" title="13.7.5.15 SHOW ENGINE Syntax"><code class="literal">SHOW ENGINE
          INNODB STATUS</code></a> does not produce any output.
        </p></li><li class="listitem"><p>
          If the MySQL server is started with
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_read_only"><code class="literal">--innodb-read-only</code></a> but the
          data directory is still on writeable media, the root user can
          still perform <a class="link" href="glossary.html#glos_dcl" title="DCL">DCL</a> operations
          such as <a class="link" href="sql-syntax.html#grant" title="13.7.1.4 GRANT Syntax"><code class="literal">GRANT</code></a> and
          <a class="link" href="sql-syntax.html#revoke" title="13.7.1.6 REVOKE Syntax"><code class="literal">REVOKE</code></a>.
        </p></li><li class="listitem"><p>
          Changes to configuration option settings that would normally
          change the behavior of write operations, have no effect when
          the server is in read-only mode.
        </p></li><li class="listitem"><p>
          The <a class="link" href="glossary.html#glos_mvcc" title="MVCC">MVCC</a> processing to
          enforce <a class="link" href="glossary.html#glos_isolation_level" title="isolation level">isolation
          levels</a> is turned off. All queries read the latest
          version of a record, because update and deletes are not
          possible.
        </p></li><li class="listitem"><p>
          The <a class="link" href="glossary.html#glos_undo_log" title="undo log">undo log</a> is not used.
          Disable any settings for the
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_undo_tablespaces"><code class="literal">innodb_undo_tablespaces</code></a> and
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_undo_directory"><code class="literal">innodb_undo_directory</code></a>
          configuration options.
</p></li></ul>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="innodb-performance-buffer-pool"></a>14.3.3 InnoDB Buffer Pool Configuration</h3>

</div>

</div>

</div>
<div class="toc">
<dl class="toc"><dt><span class="section"><a href="innodb-storage-engine.html#innodb-performance-read_ahead">14.3.3.1 Configuring InnoDB Buffer Pool Prefetching (Read-Ahead)</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-performance-adaptive_flushing">14.3.3.2 Configuring the Rate of InnoDB Buffer Pool Flushing</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-performance-midpoint_insertion">14.3.3.3 Making the Buffer Pool Scan Resistant</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-multiple-buffer-pools">14.3.3.4 Using Multiple Buffer Pool Instances</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-preload-buffer-pool">14.3.3.5 Preloading the InnoDB Buffer Pool for Faster Restart</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-lru-background-flushing">14.3.3.6 Tuning InnoDB Buffer Pool Flushing</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-buffer-pool-resize">14.3.3.7 Configuring InnoDB Buffer Pool Size</a></span></dt></dl>
</div>
<p>
      This section provides configuration information and procedures for
      the <code class="literal">InnoDB</code> buffer pool. For additional
      information, see <a class="xref" href="optimization.html#innodb-buffer-pool" title="8.10.1 The InnoDB Buffer Pool">Section 8.10.1, “The InnoDB Buffer Pool”</a>.
</p>
<div class="section">

<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="innodb-performance-read_ahead"></a>14.3.3.1 Configuring InnoDB Buffer Pool Prefetching (Read-Ahead)</h4>
</div>
</div>
</div>
<a class="indexterm" name="idm140644115668736"></a><a class="indexterm" name="idm140644115667696"></a><a class="indexterm" name="idm140644115666192"></a><a class="indexterm" name="idm140644115664704"></a><p>
        A <a class="link" href="glossary.html#glos_read_ahead" title="read-ahead">read-ahead</a> request is
        an I/O request to prefetch multiple pages in the
        <a class="link" href="glossary.html#glos_buffer_pool" title="buffer pool">buffer pool</a>
        asynchronously, in anticipation that these pages will be needed
        soon. The requests bring in all the pages in one
        <a class="link" href="glossary.html#glos_extent" title="extent">extent</a>. InnoDB uses two
        read-ahead algorithms to improve I/O performance:
      </p><p>
        <span class="strong"><strong>Linear</strong></span> read-ahead is a
        technique that predicts what pages might be needed soon based on
        pages in the buffer pool being accessed sequentially. You
        control when InnoDB performs a read-ahead operation by adjusting
        the number of sequential page accesses required to trigger an
        asynchronous read request, using the configuration parameter
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_read_ahead_threshold"><code class="literal">innodb_read_ahead_threshold</code></a>.
        Before this parameter was added, <code class="literal">InnoDB</code> would
        only calculate whether to issue an asynchronous prefetch request
        for the entire next extent when it read in the last page of the
        current extent.
      </p><p>
        The configuration parameter
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_read_ahead_threshold"><code class="literal">innodb_read_ahead_threshold</code></a>
        controls how sensitive <code class="literal">InnoDB</code> is in detecting
        patterns of sequential page access. If the number of pages read
        sequentially from an extent is greater than or equal to
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_read_ahead_threshold"><code class="literal">innodb_read_ahead_threshold</code></a>,
        <code class="literal">InnoDB</code> initiates an asynchronous read-ahead
        operation of the entire following extent. It can be set to any
        value from 0-64. The default value is 56. The higher the value,
        the more strict the access pattern check. For example, if you
        set the value to 48, <code class="literal">InnoDB</code> triggers a linear
        read-ahead request only when 48 pages in the current extent have
        been accessed sequentially. If the value is 8,
        <code class="literal">InnoDB</code> would trigger an asynchronous
        read-ahead even if as few as 8 pages in the extent were accessed
        sequentially. You can set the value of this parameter in the
        MySQL <a class="link" href="glossary.html#glos_configuration_file" title="configuration file">configuration
        file</a>, or change it dynamically with the <code class="literal">SET
        GLOBAL</code> command, which requires the
        <code class="literal">SUPER</code> privilege.
      </p><p>
        <span class="strong"><strong>Random</strong></span> read-ahead is a
        technique that predicts when pages might be needed soon based on
        pages already in the buffer pool, regardless of the order in
        which those pages were read. If 13 consecutive pages from the
        same extent are found in the buffer pool, InnoDB asynchronously
        issues a request to prefetch the remaining pages of the extent.
        To enable this feature, set the configuration variable
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_random_read_ahead"><code class="literal">innodb_random_read_ahead</code></a> to
        <code class="literal">ON</code>.
      </p><p>
        The <code class="literal">SHOW ENGINE INNODB STATUS</code> command
        displays statistics to help you evaluate the effectiveness of
        the read-ahead algorithm. Statistics include counter information
        for the
        <a class="link" href="server-administration.html#statvar_Innodb_buffer_pool_read_ahead"><code class="literal">Innodb_buffer_pool_read_ahead</code></a>,
        <a class="link" href="server-administration.html#statvar_Innodb_buffer_pool_read_ahead_evicted"><code class="literal">Innodb_buffer_pool_read_ahead_evicted</code></a>,
        and <code class="literal">Innodb_buffer_pool_read_ahead_rnd</code> global
        status variables. This information can be useful when
        fine-tuning the
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_random_read_ahead"><code class="literal">innodb_random_read_ahead</code></a>
        setting.
      </p><p>
        For more information about I/O performance, see
        <a class="xref" href="optimization.html#optimizing-innodb-diskio" title="8.5.8 Optimizing InnoDB Disk I/O">Section 8.5.8, “Optimizing InnoDB Disk I/O”</a> and
        <a class="xref" href="optimization.html#disk-issues" title="8.12.3 Optimizing Disk I/O">Section 8.12.3, “Optimizing Disk I/O”</a>.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="innodb-performance-adaptive_flushing"></a>14.3.3.2 Configuring the Rate of InnoDB Buffer Pool Flushing</h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140644115634544"></a><a class="indexterm" name="idm140644115633504"></a><a class="indexterm" name="idm140644115632000"></a><a class="indexterm" name="idm140644115630912"></a><a class="indexterm" name="idm140644115629392"></a><a class="indexterm" name="idm140644115627904"></a><p>
        InnoDB performs certain tasks in the background, including
        <a class="link" href="glossary.html#glos_flush" title="flush">flushing</a> of
        <a class="link" href="glossary.html#glos_dirty_page" title="dirty page">dirty pages</a>
        (those pages that have been changed but are not yet written to
        the database files) from the
        <a class="link" href="glossary.html#glos_buffer_pool" title="buffer pool">buffer pool</a>.
        InnoDB flushes buffer pool pages if the percentage of dirty
        pages in the buffer pool exceeds
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_max_dirty_pages_pct"><code class="literal">innodb_max_dirty_pages_pct</code></a>. As
        of MySQL 5.7.5, InnoDB flushes buffer pool pages if the
        percentage of dirty pages in the buffer pool is greater than or
        equal to
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_max_dirty_pages_pct"><code class="literal">innodb_max_dirty_pages_pct</code></a>
        (Bug#13029450).
      </p><p>
        InnoDB uses an algorithm to estimate the required rate of
        flushing, based on the speed of redo log generation and the
        current rate of flushing. The intent is to smooth overall
        performance by ensuring that buffer flush activity keeps up with
        the need to keep the buffer pool <span class="quote">“<span class="quote">clean</span>”</span>.
        Automatically adjusting the rate of flushing can help to avoid
        sudden dips in throughput, when excessive buffer pool flushing
        limits the I/O capacity available for ordinary read and write
        activity.
      </p><p>
        InnoDB uses its log files in a circular fashion. Before reusing
        a portion of a log file, InnoDB flushes to disk all dirty buffer
        pool pages whose redo entries are contained in that portion of
        the log file, a process known as a
        <a class="link" href="glossary.html#glos_sharp_checkpoint" title="sharp checkpoint">sharp checkpoint</a>.
        If a workload is write-intensive, it generates a lot of redo
        information, all written to the log file. If all available space
        in the log files is used up, a sharp checkpoint occurs, causing
        a temporary reduction in throughput. This situation can happen
        even though
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_max_dirty_pages_pct"><code class="literal">innodb_max_dirty_pages_pct</code></a> is
        not reached.
      </p><p>
        InnoDB uses a heuristic-based algorithm to avoid such a
        scenario, by measuring the number of dirty pages in the buffer
        pool and the rate at which redo is being generated. Based on
        these numbers, InnoDB decides how many dirty pages to flush from
        the buffer pool each second. This self-adapting algorithm is
        able to deal with sudden changes in the workload.
      </p><p>
        Internal benchmarking has also shown that this algorithm not
        only maintains throughput over time, but can also improve
        overall throughput significantly.
      </p><p>
        Because adaptive flushing can significantly affect the I/O
        pattern of a workload, the
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_adaptive_flushing"><code class="literal">innodb_adaptive_flushing</code></a>
        configuration parameter lets you turn off this feature. The
        default value for
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_adaptive_flushing"><code class="literal">innodb_adaptive_flushing</code></a>
        is <code class="literal">TRUE</code>, enabling the adaptive flushing
        algorithm. You can set the value of this parameter in the MySQL
        option file (<code class="literal">my.cnf</code> or
        <code class="literal">my.ini</code>) or change it dynamically with the
        <code class="literal">SET GLOBAL</code> command, which requires the
        <code class="literal">SUPER</code> privilege.
      </p><p>
        For more information about InnoDB I/O performance, see
        <a class="xref" href="optimization.html#optimizing-innodb-diskio" title="8.5.8 Optimizing InnoDB Disk I/O">Section 8.5.8, “Optimizing InnoDB Disk I/O”</a>.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="innodb-performance-midpoint_insertion"></a>14.3.3.3 Making the Buffer Pool Scan Resistant</h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140644115605552"></a><a class="indexterm" name="idm140644115604480"></a><a class="indexterm" name="idm140644115603408"></a><a class="indexterm" name="idm140644115602336"></a><a class="indexterm" name="idm140644115601264"></a><a class="indexterm" name="idm140644115600192"></a><p>
        Rather than using a strictly <a class="link" href="glossary.html#glos_lru" title="LRU">LRU</a>
        algorithm, InnoDB uses a technique to minimize the amount of
        data that is brought into the
        <a class="link" href="glossary.html#glos_buffer_pool" title="buffer pool">buffer pool</a> and never
        accessed again. The goal is to make sure that frequently
        accessed (<span class="quote">“<span class="quote">hot</span>”</span>) pages remain in the buffer pool,
        even as <a class="link" href="glossary.html#glos_read_ahead" title="read-ahead">read-ahead</a> and
        <a class="link" href="glossary.html#glos_full_table_scan" title="full table scan">full table
        scans</a> bring in new blocks that might or might not be
        accessed afterward.
      </p><p>
        Newly read blocks are inserted into the middle of the LRU list.
        All newly read pages are inserted at a location that by default
        is <code class="literal">3/8</code> from the tail of the LRU list. The
        pages are moved to the front of the list (the most-recently used
        end) when they are accessed in the buffer pool for the first
        time. Thus pages that are never accessed never make it to the
        front portion of the LRU list, and <span class="quote">“<span class="quote">age out</span>”</span> sooner
        than with a strict LRU approach. This arrangement divides the
        LRU list into two segments, where the pages downstream of the
        insertion point are considered <span class="quote">“<span class="quote">old</span>”</span> and are
        desirable victims for LRU eviction.
      </p><p>
        For an explanation of the inner workings of the InnoDB buffer
        pool and the specifics of its LRU replacement algorithm, see
        <a class="xref" href="optimization.html#innodb-buffer-pool" title="8.10.1 The InnoDB Buffer Pool">Section 8.10.1, “The InnoDB Buffer Pool”</a>.
      </p><p>
        You can control the insertion point in the LRU list, and choose
        whether InnoDB applies the same optimization to blocks brought
        into the buffer pool by table or index scans. The configuration
        parameter
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_old_blocks_pct"><code class="literal">innodb_old_blocks_pct</code></a>
        controls the percentage of <span class="quote">“<span class="quote">old</span>”</span> blocks in the LRU
        list. The default value of
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_old_blocks_pct"><code class="literal">innodb_old_blocks_pct</code></a>
        is <code class="literal">37</code>, corresponding to the original fixed
        ratio of 3/8. The value range is <code class="literal">5</code> (new pages
        in the buffer pool age out very quickly) to
        <code class="literal">95</code> (only 5% of the buffer pool is reserved
        for hot pages, making the algorithm close to the familiar LRU
        strategy).
      </p><p>
        The optimization that keeps the buffer pool from being churned
        by read-ahead can avoid similar problems due to table or index
        scans. In these scans, a data page is typically accessed a few
        times in quick succession and is never touched again. The
        configuration parameter
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_old_blocks_time"><code class="literal">innodb_old_blocks_time</code></a>
        specifies the time window (in milliseconds) after the first
        access to a page during which it can be accessed without being
        moved to the front (most-recently used end) of the LRU list. The
        default value of
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_old_blocks_time"><code class="literal">innodb_old_blocks_time</code></a> is
        <code class="literal">1000</code>. Increasing this value makes more and
        more blocks likely to age out faster from the buffer pool.
      </p><p>
        Both <a class="link" href="innodb-storage-engine.html#sysvar_innodb_old_blocks_pct"><code class="literal">innodb_old_blocks_pct</code></a> and
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_old_blocks_time"><code class="literal">innodb_old_blocks_time</code></a> are
        dynamic, global and can be specified in the MySQL option file
        (<code class="literal">my.cnf</code> or <code class="literal">my.ini</code>) or
        changed at runtime with the <code class="literal">SET GLOBAL</code>
        command. Changing the setting requires the
        <code class="literal">SUPER</code> privilege.
      </p><p>
        To help you gauge the effect of setting these parameters, the
        <code class="literal">SHOW ENGINE INNODB STATUS</code> command reports
        additional statistics. The <code class="literal">BUFFER POOL AND
        MEMORY</code> section looks like:
      </p><pre class="programlisting">
Total memory allocated 1107296256; in additional pool allocated 0
Dictionary memory allocated 80360
Buffer pool size   65535
Free buffers       0
Database pages     63920
Old database pages 23600
Modified db pages  34969
Pending reads 32
Pending writes: LRU 0, flush list 0, single page 0
Pages made young 414946, not young 2930673
1274.75 youngs/s, 16521.90 non-youngs/s
Pages read 486005, created 3178, written 160585
2132.37 reads/s, 3.40 creates/s, 323.74 writes/s
Buffer pool hit rate 950 / 1000, young-making rate 30 / 1000 not 392 / 1000
Pages read ahead 1510.10/s, evicted without access 0.00/s
LRU len: 63920, unzip_LRU len: 0
I/O sum[43690]:cur[221], unzip sum[0]:cur[0]
</pre>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <code class="literal">Old database pages</code> is the number of pages
            in the <span class="quote">“<span class="quote">old</span>”</span> segment of the LRU list.
          </p></li><li class="listitem"><p>
            <code class="literal">Pages made young</code> and <code class="literal">not
            young</code> is the total number of <span class="quote">“<span class="quote">old</span>”</span>
            pages that have been made young or not respectively.
          </p></li><li class="listitem"><p>
            <code class="literal">youngs/s</code> and
            <code class="literal">non-young/s</code> is the rate at which page
            accesses to the <span class="quote">“<span class="quote">old</span>”</span> pages have resulted in
            making such pages young or otherwise respectively since the
            last invocation of the command.
          </p></li><li class="listitem"><p>
            <code class="literal">young-making rate</code> and
            <code class="literal">not</code> provides the same rate but in terms
            of overall buffer pool accesses instead of accesses just to
            the <span class="quote">“<span class="quote">old</span>”</span> pages.
</p></li></ul>
</div>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">
<div class="admon-title">
Note
</div>
<p>
          Per second averages provided in <code class="literal">InnoDB</code>
          Monitor output are based on the elapsed time between the
          current time and the last time <code class="literal">InnoDB</code>
          Monitor output was printed.
</p>
</div>
<p>
        Because the effects of these parameters can vary widely based on
        your hardware configuration, your data, and the details of your
        workload, always benchmark to verify the effectiveness before
        changing these settings in any performance-critical or
        production environment.
      </p><p>
        In mixed workloads where most of the activity is OLTP type with
        periodic batch reporting queries which result in large scans,
        setting the value of
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_old_blocks_time"><code class="literal">innodb_old_blocks_time</code></a>
        during the batch runs can help keep the working set of the
        normal workload in the buffer pool.
      </p><p>
        When scanning large tables that cannot fit entirely in the
        buffer pool, setting
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_old_blocks_pct"><code class="literal">innodb_old_blocks_pct</code></a>
        to a small value keeps the data that is only read once from
        consuming a significant portion of the buffer pool. For example,
        setting <code class="literal">innodb_old_blocks_pct=5</code> restricts
        this data that is only read once to 5% of the buffer pool.
      </p><p>
        When scanning small tables that do fit into memory, there is
        less overhead for moving pages around within the buffer pool, so
        you can leave
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_old_blocks_pct"><code class="literal">innodb_old_blocks_pct</code></a> at its
        default value, or even higher, such as
        <code class="literal">innodb_old_blocks_pct=50</code>.
      </p><p>
        The effect of the
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_old_blocks_time"><code class="literal">innodb_old_blocks_time</code></a>
        parameter is harder to predict than the
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_old_blocks_pct"><code class="literal">innodb_old_blocks_pct</code></a>
        parameter, is relatively small, and varies more with the
        workload. To arrive at an optimal value, conduct your own
        benchmarks if the performance improvement from adjusting
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_old_blocks_pct"><code class="literal">innodb_old_blocks_pct</code></a>
        is not sufficient.
      </p><p>
        For more information about the InnoDB buffer pool, see
        <a class="xref" href="optimization.html#innodb-buffer-pool" title="8.10.1 The InnoDB Buffer Pool">Section 8.10.1, “The InnoDB Buffer Pool”</a>.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="innodb-multiple-buffer-pools"></a>14.3.3.4 Using Multiple Buffer Pool Instances</h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140644115542592"></a><p>
        For systems with buffer pools in the multi-gigabyte range,
        dividing the buffer pool into separate instances can improve
        concurrency, by reducing contention as different threads read
        and write to cached pages. This feature is typically intended
        for systems with a <a class="link" href="glossary.html#glos_buffer_pool" title="buffer pool">buffer
        pool</a> size in the multi-gigabyte range. Multiple buffer
        pool instances are configured using the
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_instances"><code class="literal">innodb_buffer_pool_instances</code></a>
        configuration option, and you might also adjust the
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_size"><code class="literal">innodb_buffer_pool_size</code></a> value.
      </p><p>
        When the InnoDB buffer pool is large, many data requests can be
        satisfied by retrieving from memory. You might encounter
        bottlenecks from multiple threads trying to access the buffer
        pool at once. You can enable multiple buffer pools to minimize
        this contention. Each page that is stored in or read from the
        buffer pool is assigned to one of the buffer pools randomly,
        using a hashing function. Each buffer pool manages its own free
        lists, flush lists, LRUs, and all other data structures
        connected to a buffer pool, and is protected by its own buffer
        pool mutex.
      </p><p>
        To enable multiple buffer pool instances, set the
        <code class="literal">innodb_buffer_pool_instances</code> configuration
        option to a value greater than 1 (the default) up to 64 (the
        maximum). This option takes effect only when you set the
        <code class="literal">innodb_buffer_pool_size</code> to a size of 1
        gigabyte or more. The total size you specify is divided among
        all the buffer pools. For best efficiency, specify a combination
        of <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_instances"><code class="literal">innodb_buffer_pool_instances</code></a>
        and <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_size"><code class="literal">innodb_buffer_pool_size</code></a> so
        that each buffer pool instance is at least 1 gigabyte.
      </p><p>
        For more information about the InnoDB buffer pool, see
        <a class="xref" href="optimization.html#innodb-buffer-pool" title="8.10.1 The InnoDB Buffer Pool">Section 8.10.1, “The InnoDB Buffer Pool”</a>.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="innodb-preload-buffer-pool"></a>14.3.3.5 Preloading the InnoDB Buffer Pool for Faster Restart</h4>

</div>

</div>

</div>
<p>
        To avoid a lengthy <a class="link" href="glossary.html#glos_warm_up" title="warm up">warmup</a>
        period after restarting the server, particularly for instances
        with large <code class="literal">InnoDB</code>
        <a class="link" href="glossary.html#glos_buffer_pool" title="buffer pool">buffer pools</a>, you can
        save the <code class="literal">InnoDB</code> buffer pool state at server
        shutdown and restore the buffer pool to the same state at server
        startup.
</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
          The
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_dump_at_shutdown"><code class="literal">innodb_buffer_pool_dump_at_shutdown</code></a>
          and
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_load_at_startup"><code class="literal">innodb_buffer_pool_load_at_startup</code></a>
          configuration options are enabled by default as of MySQL
          5.7.7, and the default value for
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_dump_pct"><code class="literal">innodb_buffer_pool_dump_pct</code></a>
          is reduced from 100 to 25.
</p>
</div>
<p>
        After you restart a busy server, there is typically a warmup
        period with steadily increasing throughput, as disk pages that
        were in the <code class="literal">InnoDB</code> buffer pool are brought
        back into memory (as the same data is queried, updated, and so
        on). The ability to restore the buffer pool to the pre-shutdown
        state shortens the warmup period as it allows you to immediately
        reload disk pages that were in the buffer pool before the
        restart, rather than waiting for DML operations to access the
        corresponding rows. The I/O requests can be performed in large
        batches, making the overall I/O faster. The page loading happens
        in the background, and does not delay the database startup.
      </p><p>
        In addition to saving the buffer pool state at shutdown and
        restoring it at startup, you can also save and restore the
        buffer pool state at any time, while the server is running. For
        example, you might save the state of the buffer pool after
        reaching a stable throughput under a steady workload. You might
        restore the previous buffer pool state after running reports or
        maintenance jobs that bring data pages into the buffer pool that
        are only needed during the time period for those operations, or
        after some other period with a non-typical workload.
      </p><p>
        Although the buffer pool itself could be many gigabytes in size,
        the data that <code class="literal">InnoDB</code> saves on disk is tiny by
        comparison. Only tablespace IDs and page IDs necessary to locate
        the appropriate pages are saved to disk. This information is
        derived from the
        <a class="link" href="information-schema.html#innodb-buffer-page-lru-table" title="21.31.18 The INFORMATION_SCHEMA INNODB_BUFFER_PAGE_LRU Table"><code class="literal">INNODB_BUFFER_PAGE_LRU</code></a>
        <code class="literal">INFORMATION_SCHEMA</code> table. By default,
        tablespace ID and page ID data is saved in a file named
        <code class="filename">ib_buffer_pool</code>, which is saved to the
        <code class="literal">InnoDB</code> data directory. The file name can be
        modified using the
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_filename"><code class="literal">innodb_buffer_pool_filename</code></a>
        configuration parameter.
      </p><p>
        Because the data is cached in and aged out of the buffer pool as
        it is with regular database operations, there is no problem if
        the disk pages are recently updated, or if a DML operation
        involves data that has not yet been loaded. The loading
        mechanism skips requested pages that no longer exist.
      </p><p>
        The underlying mechanism involves a background thread that is
        dispatched to perform the dump and load operations.
      </p><p>
        Disk pages from compressed tables are loaded into the buffer
        pool in their compressed form. Uncompression happens as usual
        when the page contents are accessed during the course of DML
        operations. Because decompression is a CPU-intensive process, it
        is more efficient for concurrency to perform the operation in
        one of the connection threads rather than in the single thread
        that performs the buffer pool restore operation.
</p>
<h5><a name="idm140644115508864"></a>Configuring the Dump Percentage for Buffer Pool Pages</h5>
<p>
        Before you dump pages from the buffer pool, configure the
        percentage of most-recently-used buffer pool pages that you want
        to dump by setting the
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_dump_pct"><code class="literal">innodb_buffer_pool_dump_pct</code></a>
        option. If you plan to dump buffer pool pages while the server
        is running, you can configure the option dynamically:
      </p><pre class="programlisting">SET GLOBAL innodb_buffer_dump_pct=40;</pre><p>
        If you plan to dump buffer pool pages at server shutdown, set
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_dump_pct"><code class="literal">innodb_buffer_pool_dump_pct</code></a> in
        your configuration file.
      </p><pre class="programlisting">[mysqld] 
      innodb_buffer_dump_pct=40</pre><p>
        The <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_dump_pct"><code class="literal">innodb_buffer_pool_dump_pct</code></a>
        default value was changed from 100 (dump all pages) to 25 (dump
        25% of most-recently-used pages) in MySQL 5.7.7 when
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_dump_at_shutdown"><code class="literal">innodb_buffer_pool_dump_at_shutdown</code></a>
        and
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_load_at_startup"><code class="literal">innodb_buffer_pool_load_at_startup</code></a>
        were enabled by default.
</p>
<h5><a name="idm140644115498432"></a>Saving the Buffer Pool State</h5>
<p>
        To save the state of the <code class="literal">InnoDB</code> buffer pool
        at server shutdown, issue the statement:
      </p><pre class="programlisting">SET GLOBAL innodb_buffer_pool_dump_at_shutdown=ON;</pre><p>
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_dump_at_shutdown"><code class="literal">innodb_buffer_pool_dump_at_shutdown</code></a>
        is enabled by default in MySQL 5.7.7.
      </p><p>
        To save the state of the <code class="literal">InnoDB</code> buffer pool
        while MySQL server is running, issue the statement:
</p><pre class="programlisting">SET GLOBAL innodb_buffer_pool_dump_now=ON;</pre>
<h5><a name="idm140644115492128"></a>Restoring the Buffer Pool State</h5>
<p>
        To restore the <code class="literal">InnoDB</code> buffer pool state at
        server startup, specify the
        <code class="literal">--innodb_buffer_pool_load_at_startup</code> option
        when starting the server:
      </p><pre class="programlisting">mysqld --innodb_buffer_pool_load_at_startup=ON;</pre><p>
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_load_at_startup"><code class="literal">innodb_buffer_pool_load_at_startup</code></a>
        is enabled by default in MySQL 5.7.7.
      </p><p>
        To restore the <code class="literal">InnoDB</code> buffer pool state while
        MySQL is running, issue the statement:
</p><pre class="programlisting">SET GLOBAL innodb_buffer_pool_load_now=ON;</pre>
<h5><a name="idm140644115485056"></a>Displaying Buffer Pool Dump Progress</h5>
<p>
        To display progress when saving the <code class="literal">InnoDB</code>
        buffer pool state to disk, use one of the following options:
      </p><pre class="programlisting">SHOW STATUS LIKE 'Innodb_buffer_pool_dump_status';</pre><p>
        or:
      </p><pre class="programlisting">SELECT variable_value FROM information_schema.global_status WHERE
variable_name = 'INNODB_BUFFER_POOL_DUMP_STATUS';</pre><p>
        If the operation has not yet started, <span class="quote">“<span class="quote">not started</span>”</span>
        is returned. If the operation is complete, the completion time
        is printed (e.g. Finished at 110505 12:18:02). If the operation
        is in progress, status information is provided (e.g. Dumping
        buffer pool 5/7, page 237/2873).
</p>
<h5><a name="idm140644115480048"></a>Displaying Buffer Pool Load Progress</h5>
<p>
        To display progress when loading the <code class="literal">InnoDB</code>
        buffer pool, use one of the following options:
      </p><pre class="programlisting">SHOW STATUS LIKE 'Innodb_buffer_pool_load_status';</pre><p>
        or:
      </p><pre class="programlisting">SELECT variable_value FROM information_schema.global_status WHERE
variable_name = 'INNODB_BUFFER_POOL_LOAD_STATUS';</pre><p>
        If the operation has not yet started, <span class="quote">“<span class="quote">not started</span>”</span>
        is returned. If the operation is complete, the completion time
        is printed (e.g. Finished at 110505 12:23:24). If the operation
        is in progress, status information is provided (e.g. Loaded
        123/22301 pages).
</p>
<h5><a name="idm140644115475072"></a>Aborting a Buffer Pool Load</h5>
<p>
        To abort a buffer pool load operation, issue the statement:
</p><pre class="programlisting">SET GLOBAL innodb_buffer_pool_load_abort=ON;</pre>
<div class="section">

<div class="titlepage">
<div>
<div>
<h5 class="title"><a name="monitor-buffer-pool-load-performance-schema"></a>14.3.3.5.1 Monitoring Buffer Pool Load Progress Using Performance Schema</h5>
</div>
</div>
</div>
<p>
          As of MySQL 5.7.6, you can monitor buffer pool load progress
          using <a class="link" href="performance-schema.html" title="Chapter 22 MySQL Performance Schema">Performance
          Schema</a>.
        </p><p>
          The following example demonstrates how to enable the
          <code class="literal">stage/innodb/buffer pool load</code> stage event
          instrument and related consumer tables to monitor buffer pool
          load progress.
        </p><p>
          For information about buffer pool dump and load procedures
          used in this example, see
          <a class="xref" href="innodb-storage-engine.html#innodb-preload-buffer-pool" title="14.3.3.5 Preloading the InnoDB Buffer Pool for Faster Restart">Section 14.3.3.5, “Preloading the InnoDB Buffer Pool for Faster Restart”</a>. For information
          about Performance Schema stage event instruments and related
          consumers, see
          <a class="xref" href="performance-schema.html#performance-schema-stage-tables" title="22.9.5 Performance Schema Stage Event Tables">Section 22.9.5, “Performance Schema Stage Event Tables”</a>.
</p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p>
              Enable the <code class="literal">stage/innodb/buffer pool
              load</code> instrument:
            </p><pre class="programlisting">mysql&gt; UPDATE setup_instruments SET ENABLED = 'YES' WHERE NAME LIKE 'stage/innodb/buffer%';
Query OK, 1 row affected (0.00 sec)
Rows matched: 1  Changed: 1  Warnings: 0</pre></li><li class="listitem"><p>
              Enable the stage event consumer tables, which include
              <a class="link" href="performance-schema.html#events-stages-current-table" title="22.9.5.1 The events_stages_current Table"><code class="literal">events_stages_current</code></a>,
              <a class="link" href="performance-schema.html#events-stages-history-table" title="22.9.5.2 The events_stages_history Table"><code class="literal">events_stages_history</code></a>, and
              <a class="link" href="performance-schema.html#events-stages-history-long-table" title="22.9.5.3 The events_stages_history_long Table"><code class="literal">events_stages_history_long</code></a>.
            </p><pre class="programlisting">mysql&gt; UPDATE setup_consumers SET ENABLED = 'YES' WHERE NAME LIKE '%stages%';
Query OK, 3 rows affected (0.00 sec)
Rows matched: 3  Changed: 3  Warnings: 0</pre></li><li class="listitem"><p>
              Dump the current buffer pool state by enabling
              <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_dump_now"><code class="literal">innodb_buffer_pool_dump_now</code></a>.
            </p><pre class="programlisting">mysql&gt; SET GLOBAL innodb_buffer_pool_dump_now=ON;
Query OK, 0 rows affected (0.00 sec)</pre></li><li class="listitem"><p>
              Check the buffer pool dump status to ensure that the
              operation has completed.
            </p><pre class="programlisting">mysql&gt; SHOW STATUS LIKE 'Innodb_buffer_pool_dump_status'\G
*************************** 1. row ***************************
Variable_name: Innodb_buffer_pool_dump_status
        Value: Buffer pool(s) dump completed at 150202 16:38:58</pre></li><li class="listitem"><p>
              Load the buffer pool by enabling
              <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_load_now"><code class="literal">innodb_buffer_pool_load_now</code></a>:
            </p><pre class="programlisting">mysql&gt; SET GLOBAL innodb_buffer_pool_load_now=ON;
Query OK, 0 rows affected (0.01 sec)</pre></li><li class="listitem"><p>
              Check the current status of the buffer pool load operation
              by querying the Performance Schema
              <a class="link" href="performance-schema.html#events-stages-current-table" title="22.9.5.1 The events_stages_current Table"><code class="literal">events_stages_current</code></a> table.
              The <code class="literal">WORK_COMPLETED</code> column shows the
              number of buffer pool pages loaded. The
              <code class="literal">WORK_ESTIMATED</code> column provides an
              estimate of the remaining work, in pages.
            </p><pre class="programlisting">mysql&gt; SELECT EVENT_NAME, WORK_COMPLETED, WORK_ESTIMATED FROM events_stages_current;
+-------------------------------+----------------+----------------+
| EVENT_NAME                    | WORK_COMPLETED | WORK_ESTIMATED |
+-------------------------------+----------------+----------------+
| stage/innodb/buffer pool load |           5353 |           7167 |
+-------------------------------+----------------+----------------+</pre><p>
              The <a class="link" href="performance-schema.html#events-stages-current-table" title="22.9.5.1 The events_stages_current Table"><code class="literal">events_stages_current</code></a>
              table returns an empty set if the buffer pool load
              operation has completed. In this case, you can check the
              <a class="link" href="performance-schema.html#events-stages-history-table" title="22.9.5.2 The events_stages_history Table"><code class="literal">events_stages_history</code></a> table
              to view data for the completed event. For example:
            </p><pre class="programlisting">mysql&gt; SELECT EVENT_NAME, WORK_COMPLETED, WORK_ESTIMATED FROM events_stages_history;
+-------------------------------+----------------+----------------+
| EVENT_NAME                    | WORK_COMPLETED | WORK_ESTIMATED |
+-------------------------------+----------------+----------------+
| stage/innodb/buffer pool load |           7167 |           7167 |
+-------------------------------+----------------+----------------+</pre></li></ol>
</div>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">
<div class="admon-title">
Note
</div>
<p>
            You can also monitor buffer pool load progress using
            Performance Schema when loading the buffer pool at startup
            using
            <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_load_at_startup"><code class="literal">innodb_buffer_pool_load_at_startup</code></a>.
            In this case, the <code class="literal">stage/innodb/buffer pool
            load</code> instrument and related consumers must also be
            enabled at startup. For more information, see
            <a class="xref" href="performance-schema.html#performance-schema-startup-configuration" title="22.2.2 Performance Schema Startup Configuration">Section 22.2.2, “Performance Schema Startup Configuration”</a>.
</p>
</div>

</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="innodb-lru-background-flushing"></a>14.3.3.6 Tuning InnoDB Buffer Pool Flushing</h4>

</div>

</div>

</div>
<p>
        The configuration options
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_flush_neighbors"><code class="literal">innodb_flush_neighbors</code></a> and
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_lru_scan_depth"><code class="literal">innodb_lru_scan_depth</code></a> let you
        fine-tune certain aspects of the
        <a class="link" href="glossary.html#glos_flush" title="flush">flushing</a> process for the
        <code class="literal">InnoDB</code>
        <a class="link" href="glossary.html#glos_buffer_pool" title="buffer pool">buffer pool</a>. These
        options primarily help write-intensive
        <a class="link" href="glossary.html#glos_workload" title="workload">workloads</a>. With heavy
        <a class="link" href="glossary.html#glos_dml" title="DML">DML</a> activity, flushing can fall
        behind if it is not aggressive enough, resulting in excessive
        memory use in the buffer pool; or, disk writes due to flushing
        can saturate your I/O capacity if that mechanism is too
        aggressive. The ideal settings depend on your workload, data
        access patterns, and storage configuration (for example, whether
        data is stored on <a class="link" href="glossary.html#glos_hdd" title="HDD">HDD</a> or
        <a class="link" href="glossary.html#glos_ssd" title="SSD">SSD</a> devices).
      </p><p>
        For systems with constant heavy
        <a class="link" href="glossary.html#glos_workload" title="workload">workloads</a>, or workloads
        that fluctuate widely, several configuration options let you
        fine-tune the <a class="link" href="glossary.html#glos_flush" title="flush">flushing</a>
        behavior for <code class="literal">InnoDB</code> tables:
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_adaptive_flushing_lwm"><code class="literal">innodb_adaptive_flushing_lwm</code></a>,
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_max_dirty_pages_pct_lwm"><code class="literal">innodb_max_dirty_pages_pct_lwm</code></a>,
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_io_capacity_max"><code class="literal">innodb_io_capacity_max</code></a>, and
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_flushing_avg_loops"><code class="literal">innodb_flushing_avg_loops</code></a>.
        These options feed into the formula used by the
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_adaptive_flushing"><code class="literal">innodb_adaptive_flushing</code></a>
        option.
      </p><p>
        The <a class="link" href="innodb-storage-engine.html#sysvar_innodb_adaptive_flushing"><code class="literal">innodb_adaptive_flushing</code></a>,
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_io_capacity"><code class="literal">innodb_io_capacity</code></a> and
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_max_dirty_pages_pct"><code class="literal">innodb_max_dirty_pages_pct</code></a>
        options are limited or extended by the following options:
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_adaptive_flushing_lwm"><code class="literal">innodb_adaptive_flushing_lwm</code></a>,
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_io_capacity_max"><code class="literal">innodb_io_capacity_max</code></a> and
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_max_dirty_pages_pct_lwm"><code class="literal">innodb_max_dirty_pages_pct_lwm</code></a>:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            The <code class="literal">InnoDB</code>
            <a class="link" href="glossary.html#glos_adaptive_flushing" title="adaptive flushing">adaptive
            flushing</a> mechanism is not appropriate in all cases.
            It gives the most benefit when the
            <a class="link" href="glossary.html#glos_redo_log" title="redo log">redo log</a> is in danger
            of filling up. The
            <a class="link" href="innodb-storage-engine.html#sysvar_innodb_adaptive_flushing_lwm"><code class="literal">innodb_adaptive_flushing_lwm</code></a>
            option specifies a <span class="quote">“<span class="quote">low water mark</span>”</span> percentage
            of redo log capacity; when that threshold is crossed,
            <code class="literal">InnoDB</code> turns on adaptive flushing even if
            not specified by the
            <a class="link" href="innodb-storage-engine.html#sysvar_innodb_adaptive_flushing"><code class="literal">innodb_adaptive_flushing</code></a>
            option.
          </p></li><li class="listitem"><p>
            If flushing activity falls far behind,
            <code class="literal">InnoDB</code> can flush more aggressively than
            specified by
            <a class="link" href="innodb-storage-engine.html#sysvar_innodb_io_capacity"><code class="literal">innodb_io_capacity</code></a>.
            <a class="link" href="innodb-storage-engine.html#sysvar_innodb_io_capacity_max"><code class="literal">innodb_io_capacity_max</code></a>
            represents an upper limit on the I/O capacity used in such
            emergency situations, so that the spike in I/O does not
            consume all the capacity of the server.
          </p></li><li class="listitem"><p>
            <code class="literal">InnoDB</code> tries to flush data from the
            buffer pool so that the percentage of dirty pages does not
            exceed the value of
            <a class="link" href="innodb-storage-engine.html#sysvar_innodb_max_dirty_pages_pct"><code class="literal">innodb_max_dirty_pages_pct</code></a>.
            The default value for
            <a class="link" href="innodb-storage-engine.html#sysvar_innodb_max_dirty_pages_pct"><code class="literal">innodb_max_dirty_pages_pct</code></a>
            is 75.
</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
              The
              <a class="link" href="innodb-storage-engine.html#sysvar_innodb_max_dirty_pages_pct"><code class="literal">innodb_max_dirty_pages_pct</code></a>
              setting establishes a target for flushing activity. It
              does not affect the rate of flushing. For information
              about managing the rate of flushing, see
              <a class="xref" href="innodb-storage-engine.html#innodb-performance-adaptive_flushing" title="14.3.3.2 Configuring the Rate of InnoDB Buffer Pool Flushing">Section 14.3.3.2, “Configuring the Rate of InnoDB Buffer Pool Flushing”</a>.
</p>
</div>
<p>
            The
            <a class="link" href="innodb-storage-engine.html#sysvar_innodb_max_dirty_pages_pct_lwm"><code class="literal">innodb_max_dirty_pages_pct_lwm</code></a>
            option specifies a <span class="quote">“<span class="quote">low water mark</span>”</span> value that
            represents the percentage of dirty pages where pre-flushing
            is enabled to control the dirty page ratio and ideally
            prevent the percentage of dirty pages from reaching
            <a class="link" href="innodb-storage-engine.html#sysvar_innodb_max_dirty_pages_pct"><code class="literal">innodb_max_dirty_pages_pct</code></a>.
            A value of
            <a class="link" href="innodb-storage-engine.html#sysvar_innodb_max_dirty_pages_pct_lwm"><code class="literal">innodb_max_dirty_pages_pct_lwm=0</code></a>
            disables the <span class="quote">“<span class="quote">pre-flushing</span>”</span> behavior.
</p></li></ul>
</div>
<p>
        Most of the options referenced above are most applicable to
        servers that run write-heavy workloads for long periods of time
        and have little reduced load time to catch up with changes
        waiting to be written to disk.
      </p><p>
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_flushing_avg_loops"><code class="literal">innodb_flushing_avg_loops</code></a>
        defines the number of iterations for which
        <code class="literal">InnoDB</code> keeps the previously calculated
        snapshot of the flushing state, which controls how quickly
        adaptive flushing responds to foreground load changes. Setting a
        high value for
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_flushing_avg_loops"><code class="literal">innodb_flushing_avg_loops</code></a> means
        that <code class="literal">InnoDB</code> keeps the previously calculated
        snapshot longer, so adaptive flushing responds more slowly. A
        high value also reduces positive feedback between foreground and
        background work, but when setting a high value it is important
        to ensure that <code class="literal">InnoDB</code> redo log utilization
        does not reach 75% (the hardcoded limit at which async flushing
        starts) and that the
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_max_dirty_pages_pct"><code class="literal">innodb_max_dirty_pages_pct</code></a>
        setting keeps the number of dirty pages to a level that is
        appropriate for the workload.
      </p><p>
        Systems with consistent workloads, a large
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_log_file_size"><code class="literal">innodb_log_file_size</code></a>, and small
        spikes that do not reach 75% redo log space utilization should
        use a high
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_flushing_avg_loops"><code class="literal">innodb_flushing_avg_loops</code></a> value
        to keep flushing as smooth as possible. For systems with extreme
        load spikes or log files that do not provide a lot of space,
        consider a smaller
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_flushing_avg_loops"><code class="literal">innodb_flushing_avg_loops</code></a>
        value. The smaller value will allow flushing to closely track
        the load and help avoid reaching 75% redo log space utilization.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="innodb-buffer-pool-resize"></a>14.3.3.7 Configuring InnoDB Buffer Pool Size</h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140644115367216"></a><a class="indexterm" name="idm140644115366144"></a><a class="indexterm" name="idm140644115365072"></a><p>
        You can configure <code class="literal">InnoDB</code> buffer pool size
        offline (at startup) or online, while the server is running.
        Behavior described in this section applies to both configuration
        methods. For additional information about configuring buffer
        pool size online, see
        <a class="xref" href="innodb-storage-engine.html#innodb-buffer-pool-online-resize" title="Configuring InnoDB Buffer Pool Size Online">Configuring InnoDB Buffer Pool Size Online</a>.
      </p><p>
        When increasing or decreasing
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_size"><code class="literal">innodb_buffer_pool_size</code></a>, the
        operation is performed in chunks. Chunk size is defined by the
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_chunk_size"><code class="literal">innodb_buffer_pool_chunk_size</code></a>
        configuration option, which has a default of
        <code class="literal">128M</code>. For more information, see
        <a class="xref" href="innodb-storage-engine.html#innodb-buffer-pool-chunk-size" title="Configuring InnoDB Buffer Pool Chunk Size">Configuring InnoDB Buffer Pool Chunk Size</a>.
      </p><p>
        Buffer pool size must always be a multiple of
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_chunk_size"><code class="literal">innodb_buffer_pool_chunk_size</code></a> *
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_instances"><code class="literal">innodb_buffer_pool_instances</code></a>.
        If you configure
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_size"><code class="literal">innodb_buffer_pool_size</code></a> to a
        value that is not a multiple of
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_chunk_size"><code class="literal">innodb_buffer_pool_chunk_size</code></a> *
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_instances"><code class="literal">innodb_buffer_pool_instances</code></a>,
        buffer pool size is automatically adjusted to a multiple of
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_chunk_size"><code class="literal">innodb_buffer_pool_chunk_size</code></a> *
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_instances"><code class="literal">innodb_buffer_pool_instances</code></a>
        that is not less than the specified buffer pool size.
      </p><p>
        In the following example,
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_size"><code class="literal">innodb_buffer_pool_size</code></a> is set
        to <code class="literal">8G</code> and
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_instances"><code class="literal">innodb_buffer_pool_instances</code></a> is
        set to <code class="literal">16</code>.
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_chunk_size"><code class="literal">innodb_buffer_pool_chunk_size</code></a>
        is <code class="literal">128M</code>, which is the default value.
      </p><p>
        <code class="literal">8G</code> is a valid
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_size"><code class="literal">innodb_buffer_pool_size</code></a> value
        because <code class="literal">8G</code> is a multiple of
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_instances"><code class="literal">innodb_buffer_pool_instances=16</code></a>
        *
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_chunk_size"><code class="literal">innodb_buffer_pool_chunk_size=128M</code></a>,
        which is <code class="literal">2G</code>.
      </p><pre class="programlisting">shell&gt; <strong class="userinput"><code>mysqld --innodb_buffer_pool_size=8G --innodb_buffer_pool_instances=16</code></strong> 

mysql&gt; <strong class="userinput"><code>SELECT @@innodb_buffer_pool_size/1024/1024/1024;</code></strong>
+------------------------------------------+
| @@innodb_buffer_pool_size/1024/1024/1024 |
+------------------------------------------+
|                           8.000000000000 |
+------------------------------------------+</pre><p>
        In this example,
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_size"><code class="literal">innodb_buffer_pool_size</code></a> is set
        to <code class="literal">9G</code> and
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_instances"><code class="literal">innodb_buffer_pool_instances</code></a> is
        set to <code class="literal">16</code>.
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_chunk_size"><code class="literal">innodb_buffer_pool_chunk_size</code></a>
        is <code class="literal">128M</code>, which is the default value. In this
        case, <code class="literal">9G</code> is not a multiple of
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_instances"><code class="literal">innodb_buffer_pool_instances=16</code></a>
        *
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_chunk_size"><code class="literal">innodb_buffer_pool_chunk_size=128M</code></a>,
        so <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_size"><code class="literal">innodb_buffer_pool_size</code></a> is
        adjusted to <code class="literal">10G</code>, which is the next multiple
        of
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_chunk_size"><code class="literal">innodb_buffer_pool_chunk_size</code></a> *
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_instances"><code class="literal">innodb_buffer_pool_instances</code></a>
        that is not less than the specified buffer pool size.
      </p><pre class="programlisting">shell&gt; <strong class="userinput"><code>mysqld --innodb_buffer_pool_size=9G --innodb_buffer_pool_instances=16</code></strong> 

mysql&gt; <strong class="userinput"><code>SELECT @@innodb_buffer_pool_size/1024/1024/1024;</code></strong>
+------------------------------------------+
| @@innodb_buffer_pool_size/1024/1024/1024 |
+------------------------------------------+
|                          10.000000000000 |
+------------------------------------------+</pre>
<div class="simplesect">

<div class="titlepage">
<div>

<div class="simple">
<h5 class="title"><a name="innodb-buffer-pool-chunk-size"></a>Configuring InnoDB Buffer Pool Chunk Size</h5>
</div>
</div>
</div>
<p>
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_chunk_size"><code class="literal">innodb_buffer_pool_chunk_size</code></a>
          can be increased or decreased in 1MB (1048576 byte) units but
          can only be modified at startup, in a command line string or
          in a MySQL configuration file.
        </p><p>
          Command line:
        </p><pre class="programlisting">./mysqld --innodb_buffer_pool_chunk_size=134217728</pre><p>
          Configuration file:
        </p><pre class="programlisting">[mysqld]
innodb_buffer_pool_chunk_size=134217728</pre><p>
          The following conditions apply when altering
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_chunk_size"><code class="literal">innodb_buffer_pool_chunk_size</code></a>:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              If the new <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_chunk_size"><code class="literal">
              innodb_buffer_pool_chunk_size</code></a> value *
              <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_instances"><code class="literal">innodb_buffer_pool_instances</code></a>
              is larger than the current buffer pool size when the
              buffer pool is initialized,
              <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_chunk_size"><code class="literal">innodb_buffer_pool_chunk_size</code></a>
              is truncated to
              <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_size"><code class="literal">innodb_buffer_pool_size</code></a> /
              <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_instances"><code class="literal">innodb_buffer_pool_instances</code></a>.
            </p><p>
              For example, if the buffer pool is initialized with a size
              of 2GB (2147483648 bytes), 4 buffer pool instances, and a
              chunk size of 1GB (1073741824 bytes), chunk size will be
              truncated to a value equal to
              <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_size"><code class="literal">innodb_buffer_pool_size</code></a> /
              <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_instances"><code class="literal">innodb_buffer_pool_instances</code></a>,
              as shown below:
            </p><pre class="programlisting">./mysqld --innodb_buffer_pool_size=2147483648 --innodb_buffer_pool_instances=4 
--innodb_buffer_pool_chunk_size=1073741824;

mysql&gt; SELECT @@innodb_buffer_pool_size;
+---------------------------+
| @@innodb_buffer_pool_size |
+---------------------------+
|                2147483648 |
+---------------------------+

mysql&gt; SELECT @@innodb_buffer_pool_instances;
+--------------------------------+
| @@innodb_buffer_pool_instances |
+--------------------------------+
|                              4 |
+--------------------------------+

# Chunk size was set to 1GB (1073741824 bytes) on startup but was
# truncated to innodb_buffer_pool_size / innodb_buffer_pool_instances

mysql&gt; SELECT @@innodb_buffer_pool_chunk_size;
+---------------------------------+
| @@innodb_buffer_pool_chunk_size |
+---------------------------------+
|                       536870912 |
+---------------------------------+</pre></li><li class="listitem"><p>
              Buffer pool size must always be a multiple of
              <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_chunk_size"><code class="literal">innodb_buffer_pool_chunk_size</code></a>
              *
              <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_instances"><code class="literal">innodb_buffer_pool_instances</code></a>.
              If you alter
              <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_chunk_size"><code class="literal">innodb_buffer_pool_chunk_size</code></a>,
              <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_size"><code class="literal">innodb_buffer_pool_size</code></a>
              is automatically adjusted to a multiple of
              <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_chunk_size"><code class="literal">innodb_buffer_pool_chunk_size</code></a>
              *
              <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_instances"><code class="literal">innodb_buffer_pool_instances</code></a>
              that is not less than current buffer pool size. The
              adjustment occurs when the buffer pool is initialized.
              This behavior is demonstrated in the following example:
            </p><pre class="programlisting"># The buffer pool has a default size of 128MB (134217728 bytes)

mysql&gt; SELECT @@innodb_buffer_pool_size;
+---------------------------+
| @@innodb_buffer_pool_size |
+---------------------------+
|                 134217728 |
+---------------------------+

# The chunk size is also 128MB (134217728 bytes) 

mysql&gt; SELECT @@innodb_buffer_pool_chunk_size;
+---------------------------------+
| @@innodb_buffer_pool_chunk_size |
+---------------------------------+
|                       134217728 |
+---------------------------------+

# There is a single buffer pool instance

mysql&gt; SELECT @@innodb_buffer_pool_instances;
+--------------------------------+
| @@innodb_buffer_pool_instances |
+--------------------------------+
|                              1 |
+--------------------------------+

# Chunk size is decreased by 1MB (1048576 bytes) at startup 
# (134217728 - 1048576 = 133169152):

shell$ ./mysqld --innodb_buffer_pool_chunk_size=133169152

mysql&gt; select @@innodb_buffer_pool_chunk_size;
+---------------------------------+
| @@innodb_buffer_pool_chunk_size |
+---------------------------------+
|                       133169152 |
+---------------------------------+

# Buffer pool size increases from 134217728 to 266338304
# Buffer pool size is automatically adjusted to a multiple of
# the innodb_buffer_pool_chunk_size * innodb_buffer_pool_instances that 
# is not less than current buffer pool size

mysql&gt; select @@innodb_buffer_pool_size;
+---------------------------+
| @@innodb_buffer_pool_size |
+---------------------------+
|                 266338304 |
+---------------------------+</pre><p>
              This example demonstrates the same behavior but with
              multiple buffer pool instances:
            </p><pre class="programlisting">
# The buffer pool has a default size of 2GB (2147483648 bytes)

mysql&gt; SELECT @@innodb_buffer_pool_size;
+---------------------------+
| @@innodb_buffer_pool_size |
+---------------------------+
|                2147483648 |
+---------------------------+

# The chunk size is .5 GB (536870912 bytes) 

mysql&gt; SELECT @@innodb_buffer_pool_chunk_size;
+---------------------------------+
| @@innodb_buffer_pool_chunk_size |
+---------------------------------+
|                       536870912 |
+---------------------------------+

# There are 4 buffer pool instances

mysql&gt; SELECT @@innodb_buffer_pool_instances;
+--------------------------------+
| @@innodb_buffer_pool_instances |
+--------------------------------+
|                              4 |
+--------------------------------+

# Chunk size is decreased by 1MB (1048576 bytes) at startup 
# (536870912 - 1048576 = 535822336):

shell$ ./mysqld --innodb_buffer_pool_chunk_size=535822336

mysql&gt; select @@innodb_buffer_pool_chunk_size;
+---------------------------------+
| @@innodb_buffer_pool_chunk_size |
+---------------------------------+
|                       535822336 |
+---------------------------------+

# Buffer pool size increases from 2147483648 to 4286578688
# Buffer pool size is automatically adjusted to a multiple of
# the innodb_buffer_pool_chunk_size * innodb_buffer_pool_instances that 
# is not less than current buffer pool size of 2147483648

mysql&gt; select @@innodb_buffer_pool_size;
+---------------------------+
| @@innodb_buffer_pool_size |
+---------------------------+
|                4286578688 |
+---------------------------+</pre><p>
              Care should be taken when changing
              <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_chunk_size"><code class="literal">innodb_buffer_pool_chunk_size</code></a>,
              as changing this value can increase the size of the buffer
              pool, as shown in the examples above. Before you change
              <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_chunk_size"><code class="literal">innodb_buffer_pool_chunk_size</code></a>,
              calculate the effect it will have on
              <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_size"><code class="literal">innodb_buffer_pool_size</code></a>
              to ensure that the resulting buffer pool size is
              acceptable.
</p></li></ul>
</div>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">
<div class="admon-title">
Note
</div>
<p>
            To avoid potential performance issues, the number of chunks
            (<a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_size"><code class="literal">innodb_buffer_pool_size</code></a> /
            <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_chunk_size"><code class="literal">innodb_buffer_pool_chunk_size</code></a>)
            should not exceed 1000.
</p>
</div>

</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h5 class="title"><a name="innodb-buffer-pool-online-resize"></a>Configuring InnoDB Buffer Pool Size Online</h5>

</div>

</div>

</div>
<p>
          As of MySQL 5.7.5,
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_size"><code class="literal">innodb_buffer_pool_size</code></a>
          configuration option can be set dynamically using a
          <a class="link" href="data-types.html#set" title="11.4.5 The SET Type"><code class="literal">SET</code></a> statement, allowing you to
          resize the buffer pool without restarting the server. For
          example:
        </p><pre class="programlisting">mysql&gt; SET GLOBAL innodb_buffer_pool_size=402653184;</pre><p>
          Active transactions, and operations performed through
          <code class="literal">InnoDB</code> APIs, should be completed before
          resizing the buffer pool. When initiating a resizing
          operation, the operation does not start until all active
          transactions are completed. Once the resizing operation is in
          progress, new transactions and operations that require access
          to the buffer pool must wait until the resizing operation
          finishes. The exception to this rule is that concurrent access
          to the buffer pool is permitted while the buffer pool is
          defragmented and pages are withdrawn during an operation to
          decrease buffer pool size. A drawback of allowing concurrent
          access is that it could result in a temporary shortage of
          available pages while pages are being withdrawn.
</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
            Nested transactions could fail if initiated after the buffer
            pool resizing operation begins.
</p>
</div>

</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h5 class="title"><a name="innodb-buffer-pool-online-resize-monitoring"></a>Monitoring Online Buffer Pool Resizing Progress</h5>

</div>

</div>

</div>
<p>
          The
          <a class="link" href="server-administration.html#statvar_Innodb_buffer_pool_resize_status"><code class="literal">Innodb_buffer_pool_resize_status</code></a>
          variable reports the progress of the buffer pool resizing
          operation. For example:
        </p><pre class="programlisting">mysql&gt; SHOW STATUS WHERE Variable_name='InnoDB_buffer_pool_resize_status';
+----------------------------------+----------------------------------+
| Variable_name                    | Value                            |
+----------------------------------+----------------------------------+
| Innodb_buffer_pool_resize_status | Resizing also other hash tables. |
+----------------------------------+----------------------------------+</pre><p>
          The progress of the resizing operation is also logged in the
          server error log file. This example shows notes that are
          logged when increasing the size of the buffer pool:
        </p><pre class="programlisting">[Note] InnoDB: Resizing buffer pool from 134217728 to 4294967296. (unit=134217728)
[Note] InnoDB: disabled adaptive hash index.
[Note] InnoDB: buffer pool 0 : 31 chunks (253952 blocks) was added.
[Note] InnoDB: buffer pool 0 : hash tables were resized.
[Note] InnoDB: Resized hash tables at lock_sys, adaptive hash index, dictionary.
[Note] InnoDB: completed to resize buffer pool from 134217728 to 4294967296.
[Note] InnoDB: re-enabled adaptive hash index.</pre><p>
          This example shows notes that are logged when decreasing the
          size of the buffer pool:
        </p><pre class="programlisting">[Note] InnoDB: Resizing buffer pool from 4294967296 to 134217728. (unit=134217728)
[Note] InnoDB: disabled adaptive hash index.
[Note] InnoDB: buffer pool 0 : start to withdraw the last 253952 blocks.
[Note] InnoDB: buffer pool 0 : withdrew 253952 blocks from free list. tried to relocate 0 pages. (253952/253952)
[Note] InnoDB: buffer pool 0 : withdrawn target 253952 blocks.
[Note] InnoDB: buffer pool 0 : 31 chunks (253952 blocks) was freed.
[Note] InnoDB: buffer pool 0 : hash tables were resized.
[Note] InnoDB: Resized hash tables at lock_sys, adaptive hash index, dictionary.
[Note] InnoDB: completed to resize buffer pool from 4294967296 to 134217728.
[Note] InnoDB: re-enabled adaptive hash index.</pre>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h5 class="title"><a name="innodb-buffer-pool-online-resize-internals"></a>Online Buffer Pool Resizing Internals</h5>

</div>

</div>

</div>
<p>
          The resizing operation is performed by a background thread.
          When increasing the size of the buffer pool, the resizing
          operation:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              Adds pages in <code class="literal">chunks</code> (chunk size is
              defined by
              <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_chunk_size"><code class="literal">innodb_buffer_pool_chunk_size</code></a>)
            </p></li><li class="listitem"><p>
              Coverts hash tables, lists, and pointers to use new
              addresses in memory
            </p></li><li class="listitem"><p>
              Adds new pages to the free list
</p></li></ul>
</div>
<p>
          While these operations are in progress, other threads are
          blocked from accessing the buffer pool.
        </p><p>
          When decreasing the size of the buffer pool, the resizing
          operation:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              Defragments the buffer pool and withdraws (frees) pages
            </p></li><li class="listitem"><p>
              Removes pages in <code class="literal">chunks</code> (chunk size is
              defined by
              <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_chunk_size"><code class="literal">innodb_buffer_pool_chunk_size</code></a>)
            </p></li><li class="listitem"><p>
              Converts hash tables, lists, and pointers to use new
              addresses in memory
</p></li></ul>
</div>
<p>
          Of these operations, only defragmenting the buffer pool and
          withdrawing pages allow other threads to access to the buffer
          pool concurrently.
</p>
</div>

</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="innodb-performance-use_sys_malloc"></a>14.3.4 Configuring the Memory Allocator for InnoDB</h3>

</div>

</div>

</div>
<a class="indexterm" name="idm140644115240640"></a><a class="indexterm" name="idm140644115239600"></a><a class="indexterm" name="idm140644115238112"></a><a class="indexterm" name="idm140644115236608"></a><a class="indexterm" name="idm140644115235120"></a><a class="indexterm" name="idm140644115233584"></a><p>
      When <code class="literal">InnoDB</code> was developed, the memory
      allocators supplied with operating systems and run-time libraries
      were often lacking in performance and scalability. At that time,
      there were no memory allocator libraries tuned for multi-core
      CPUs. Therefore, <code class="literal">InnoDB</code> implemented its own
      memory allocator in the <code class="literal">mem</code> subsystem. This
      allocator is guarded by a single mutex, which may become a
      <a class="link" href="glossary.html#glos_bottleneck" title="bottleneck">bottleneck</a>.
      <code class="literal">InnoDB</code> also implements a wrapper interface
      around the system allocator (<code class="literal">malloc</code> and
      <code class="literal">free</code>) that is likewise guarded by a single
      mutex.
    </p><p>
      Today, as multi-core systems have become more widely available,
      and as operating systems have matured, significant improvements
      have been made in the memory allocators provided with operating
      systems. New memory allocators perform better and are more
      scalable than they were in the past. The leading high-performance
      memory allocators include <code class="literal">Hoard</code>,
      <code class="literal">libumem</code>, <code class="literal">mtmalloc</code>,
      <code class="literal">ptmalloc</code>, <code class="literal">tbbmalloc</code>, and
      <code class="literal">TCMalloc</code>. Most workloads, especially those
      where memory is frequently allocated and released (such as
      multi-table joins), benefit from using a more highly tuned memory
      allocator as opposed to the internal,
      <code class="literal">InnoDB</code>-specific memory allocator.
    </p><p>
      You can control whether <code class="literal">InnoDB</code> uses its own
      memory allocator or an allocator of the operating system, by
      setting the value of the system configuration parameter
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_use_sys_malloc"><code class="literal">innodb_use_sys_malloc</code></a> in the
      MySQL option file (<code class="literal">my.cnf</code> or
      <code class="literal">my.ini</code>). If set to <code class="literal">ON</code> or
      <code class="literal">1</code> (the default), <code class="literal">InnoDB</code> uses
      the <code class="literal">malloc</code> and <code class="literal">free</code>
      functions of the underlying system rather than manage memory pools
      itself. This parameter is not dynamic, and takes effect only when
      the system is started. To continue to use the
      <code class="literal">InnoDB</code> memory allocator, set
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_use_sys_malloc"><code class="literal">innodb_use_sys_malloc</code></a> to
      <code class="literal">0</code>.
    </p><p>
      When the <code class="literal">InnoDB</code> memory allocator is disabled,
      <code class="literal">InnoDB</code> ignores the value of the parameter
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_additional_mem_pool_size"><code class="literal">innodb_additional_mem_pool_size</code></a>.
      The <code class="literal">InnoDB</code> memory allocator uses an additional
      memory pool for satisfying allocation requests without having to
      fall back to the system memory allocator. When the
      <code class="literal">InnoDB</code> memory allocator is disabled, all such
      allocation requests are fulfilled by the system memory allocator.
    </p><p>
      On Unix-like systems that use dynamic linking, replacing the
      memory allocator may be as easy as making the environment variable
      <code class="literal">LD_PRELOAD</code> or
      <code class="literal">LD_LIBRARY_PATH</code> point to the dynamic library
      that implements the allocator. On other systems, some relinking
      may be necessary. Please refer to the documentation of the memory
      allocator library of your choice.
    </p><p>
      Since <code class="literal">InnoDB</code> cannot track all memory use when
      the system memory allocator is used
      (<a class="link" href="innodb-storage-engine.html#sysvar_innodb_use_sys_malloc"><code class="literal">innodb_use_sys_malloc</code></a> is
      <code class="literal">ON</code>), the section <span class="quote">“<span class="quote">BUFFER POOL AND
      MEMORY</span>”</span> in the output of the <code class="literal">SHOW ENGINE INNODB
      STATUS</code> command only includes the buffer pool statistics
      in the <span class="quote">“<span class="quote">Total memory allocated</span>”</span>. Any memory allocated
      using the <code class="literal">mem</code> subsystem or using
      <code class="literal">ut_malloc</code> is excluded.
</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_use_sys_malloc"><code class="literal">innodb_use_sys_malloc</code></a> and
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_additional_mem_pool_size"><code class="literal">innodb_additional_mem_pool_size</code></a>
        were deprecated in MySQL 5.6.3 and are removed in MySQL 5.7.4.
</p>
</div>
<p>
      For more information about the performance implications of
      <code class="literal">InnoDB</code> memory usage, see
      <a class="xref" href="optimization.html#buffering-caching" title="8.10 Buffering and Caching">Section 8.10, “Buffering and Caching”</a>.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="innodb-performance-change_buffering"></a>14.3.5 Configuring InnoDB Change Buffering</h3>

</div>

</div>

</div>
<div class="toc">
<dl class="toc"><dt><span class="section"><a href="innodb-storage-engine.html#innodb-change-buffer-maximum-size">14.3.5.1 Configuring the Change Buffer Maximum Size</a></span></dt></dl>
</div>
<a class="indexterm" name="idm140644115189712"></a><a class="indexterm" name="idm140644115188640"></a><a class="indexterm" name="idm140644115187152"></a><a class="indexterm" name="idm140644115185664"></a><p>
      When <a class="link" href="sql-syntax.html#insert" title="13.2.5 INSERT Syntax"><code class="literal">INSERT</code></a>,
      <a class="link" href="sql-syntax.html#update" title="13.2.11 UPDATE Syntax"><code class="literal">UPDATE</code></a>, and
      <a class="link" href="sql-syntax.html#delete" title="13.2.2 DELETE Syntax"><code class="literal">DELETE</code></a> operations are performed on
      a table, the values of indexed columns (particularly the values of
      secondary keys) are often in an unsorted order, requiring
      substantial I/O to bring secondary indexes up to date.
      <code class="literal">InnoDB</code> has a
      <a class="link" href="glossary.html#glos_change_buffer" title="change buffer">change buffer</a> that
      caches changes to secondary index entries when the relevant
      <a class="link" href="glossary.html#glos_page" title="page">page</a> is not in the
      <a class="link" href="glossary.html#glos_buffer_pool" title="buffer pool">buffer pool</a>, thus
      avoiding expensive I/O operations by not immediately reading in
      the page from disk. The buffered changes are merged when the page
      is loaded to the buffer pool, and the updated page is later
      flushed to disk. The <code class="literal">InnoDB</code> main thread merges
      buffered changes when the server is nearly idle, and during a
      <a class="link" href="glossary.html#glos_slow_shutdown" title="slow shutdown">slow shutdown</a>.
    </p><p>
      Because it can result in fewer disk reads and writes, the change
      buffer feature is most valuable for workloads that are I/O-bound,
      for example applications with a high volume of DML operations such
      as bulk inserts.
    </p><p>
      However, the change buffer occupies a part of the buffer pool,
      reducing the memory available to cache data pages. If the working
      set almost fits in the buffer pool, or if your tables have
      relatively few secondary indexes, it may be useful to disable
      change buffering. If the working set fits entirely within the
      buffer, change buffering does not impose extra overhead, because
      it only applies to pages that are not in the buffer pool.
    </p><p>
      You can control the extent to which <code class="literal">InnoDB</code>
      performs change buffering using the
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_change_buffering"><code class="literal">innodb_change_buffering</code></a>
      configuration parameter. You can enable or disable buffering for
      inserts, delete operations (when index records are initially
      marked for deletion) and purge operations (when index records are
      physically deleted). An update operation is a combination of an
      insert and a delete. The default
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_change_buffering"><code class="literal">innodb_change_buffering</code></a> value is
      <code class="literal">all</code>.
    </p><p>
      Permitted <a class="link" href="innodb-storage-engine.html#sysvar_innodb_change_buffering"><code class="literal">innodb_change_buffering</code></a>
      values include:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          <span class="bold"><strong><code class="literal">all</code></strong></span>
        </p><p>
          The default value: buffer inserts, delete-marking operations,
          and purges.
        </p></li><li class="listitem"><p>
          <span class="bold"><strong><code class="literal">none</code></strong></span>
        </p><p>
          Do not buffer any operations.
        </p></li><li class="listitem"><p>
          <span class="bold"><strong><code class="literal">inserts</code></strong></span>
        </p><p>
          Buffer insert operations.
        </p></li><li class="listitem"><p>
          <span class="bold"><strong><code class="literal">deletes</code></strong></span>
        </p><p>
          Buffer delete-marking operations.
        </p></li><li class="listitem"><p>
          <span class="bold"><strong><code class="literal">changes</code></strong></span>
        </p><p>
          Buffer both inserts and delete-marking operations.
        </p></li><li class="listitem"><p>
          <span class="bold"><strong><code class="literal">purges</code></strong></span>
        </p><p>
          Buffer the physical deletion operations that happen in the
          background.
</p></li></ul>
</div>
<p>
      You can set the
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_change_buffering"><code class="literal">innodb_change_buffering</code></a> parameter
      in the MySQL option file (<code class="literal">my.cnf</code> or
      <code class="literal">my.ini</code>) or change it dynamically with the
      <a class="link" href="sql-syntax.html#set-statement" title="13.7.4 SET Syntax"><code class="literal">SET
      GLOBAL</code></a> command, which requires the
      <code class="literal">SUPER</code> privilege. Changing the setting affects
      the buffering of new operations; the merging of existing buffered
      entries is not affected.
    </p><p>
      For related information, see
      <a class="xref" href="innodb-storage-engine.html#innodb-insert-buffering" title="14.2.7.5 Change Buffer">Section 14.2.7.5, “Change Buffer”</a>. For information about
      configuring change buffer size, see
      <a class="xref" href="innodb-storage-engine.html#innodb-change-buffer-maximum-size" title="14.3.5.1 Configuring the Change Buffer Maximum Size">Section 14.3.5.1, “Configuring the Change Buffer Maximum Size”</a>.
</p>
<div class="section">

<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="innodb-change-buffer-maximum-size"></a>14.3.5.1 Configuring the Change Buffer Maximum Size</h4>
</div>
</div>
</div>
<p>
        As of MySQL 5.6.2, the
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_change_buffer_max_size"><code class="literal">innodb_change_buffer_max_size</code></a>
        configuration option allows you to configure the maximum size of
        the change buffer as a percentage of the total size of the
        buffer pool. By default,
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_change_buffer_max_size"><code class="literal">innodb_change_buffer_max_size</code></a>
        is set to 25. The maximum setting is 50.
      </p><p>
        You might consider increasing
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_change_buffer_max_size"><code class="literal">innodb_change_buffer_max_size</code></a>
        on a MySQL server with heavy insert, update, and delete
        activity, where change buffer merging does not keep pace with
        new change buffer entries, causing the change buffer to reach
        its maximum size limit.
      </p><p>
        You might consider decreasing
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_change_buffer_max_size"><code class="literal">innodb_change_buffer_max_size</code></a>
        on a MySQL server with static data used for reporting, or if the
        change buffer consumes too much of the memory space that is
        shared with the buffer pool, causing pages to age out of the
        buffer pool sooner than desired.
      </p><p>
        Test different settings with a representative workload to
        determine an optimal configuration. The
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_change_buffer_max_size"><code class="literal">innodb_change_buffer_max_size</code></a>
        setting is dynamic, which allows you modify the setting without
        restarting the server.
</p>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="innodb-performance-thread_concurrency"></a>14.3.6 Configuring Thread Concurrency for InnoDB</h3>

</div>

</div>

</div>
<a class="indexterm" name="idm140644115133552"></a><a class="indexterm" name="idm140644115132512"></a><a class="indexterm" name="idm140644115131424"></a><a class="indexterm" name="idm140644115130336"></a><a class="indexterm" name="idm140644115128832"></a><p>
      <code class="literal">InnoDB</code> uses operating system
      <a class="link" href="glossary.html#glos_thread" title="thread">threads</a> to process requests
      from user transactions. (Transactions may issue many requests to
      <code class="literal">InnoDB</code> before they commit or roll back.) On
      modern operating systems and servers with multi-core processors,
      where context switching is efficient, most workloads run well
      without any limit on the number of concurrent threads. Scalability
      improvements in MySQL 5.5 and up reduce the need to limit the
      number of concurrently executing threads inside
      <code class="literal">InnoDB</code>.
    </p><p>
      In situations where it is helpful to minimize context switching
      between threads, <code class="literal">InnoDB</code> can use a number of
      techniques to limit the number of concurrently executing operating
      system threads (and thus the number of requests that are processed
      at any one time). When <code class="literal">InnoDB</code> receives a new
      request from a user session, if the number of threads concurrently
      executing is at a pre-defined limit, the new request sleeps for a
      short time before it tries again. A request that cannot be
      rescheduled after the sleep is put in a first-in/first-out queue
      and eventually is processed. Threads waiting for locks are not
      counted in the number of concurrently executing threads.
    </p><p>
      You can limit the number of concurrent threads by setting the
      configuration parameter
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_thread_concurrency"><code class="literal">innodb_thread_concurrency</code></a>.
      Once the number of executing threads reaches this limit,
      additional threads sleep for a number of microseconds, set by the
      configuration parameter
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_thread_sleep_delay"><code class="literal">innodb_thread_sleep_delay</code></a>,
      before being placed into the queue.
    </p><p>
      Previously, it required experimentation to find the optimal value
      for <a class="link" href="innodb-storage-engine.html#sysvar_innodb_thread_sleep_delay"><code class="literal">innodb_thread_sleep_delay</code></a>,
      and the optimal value could change depending on the workload. In
      MySQL 5.6.3 and higher, you can set the configuration option
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_adaptive_max_sleep_delay"><code class="literal">innodb_adaptive_max_sleep_delay</code></a>
      to the highest value you would allow for
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_thread_sleep_delay"><code class="literal">innodb_thread_sleep_delay</code></a>, and
      <code class="literal">InnoDB</code> automatically adjusts
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_thread_sleep_delay"><code class="literal">innodb_thread_sleep_delay</code></a> up or
      down depending on the current thread-scheduling activity. This
      dynamic adjustment helps the thread scheduling mechanism to work
      smoothly during times when the system is lightly loaded and when
      it is operating near full capacity.
    </p><p>
      The default value for
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_thread_concurrency"><code class="literal">innodb_thread_concurrency</code></a> and the
      implied default limit on the number of concurrent threads has been
      changed in various releases of MySQL and
      <code class="literal">InnoDB</code>. The default value of
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_thread_concurrency"><code class="literal">innodb_thread_concurrency</code></a> is
      <code class="literal">0</code>, so that by default there is no limit on the
      number of concurrently executing threads.
    </p><p>
      <code class="literal">InnoDB</code> causes threads to sleep only when the
      number of concurrent threads is limited. When there is no limit on
      the number of threads, all contend equally to be scheduled. That
      is, if <a class="link" href="innodb-storage-engine.html#sysvar_innodb_thread_concurrency"><code class="literal">innodb_thread_concurrency</code></a>
      is <code class="literal">0</code>, the value of
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_thread_sleep_delay"><code class="literal">innodb_thread_sleep_delay</code></a> is
      ignored.
    </p><p>
      When there is a limit on the number of threads (when
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_thread_concurrency"><code class="literal">innodb_thread_concurrency</code></a> is &gt;
      0), <code class="literal">InnoDB</code> reduces context switching overhead
      by permitting multiple requests made during the execution of a
      <span class="emphasis"><em>single SQL statement</em></span> to enter
      <code class="literal">InnoDB</code> without observing the limit set by
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_thread_concurrency"><code class="literal">innodb_thread_concurrency</code></a>.
      Since an SQL statement (such as a join) may comprise multiple row
      operations within <code class="literal">InnoDB</code>,
      <code class="literal">InnoDB</code> assigns a specified number of
      <span class="quote">“<span class="quote">tickets</span>”</span> that allow a thread to be scheduled
      repeatedly with minimal overhead.
    </p><p>
      When a new SQL statement starts, a thread has no tickets, and it
      must observe
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_thread_concurrency"><code class="literal">innodb_thread_concurrency</code></a>.
      Once the thread is entitled to enter <code class="literal">InnoDB</code>, it
      is assigned a number of tickets that it can use for subsequently
      entering <code class="literal">InnoDB</code> to perform row operations. If
      the tickets run out, the thread is evicted, and
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_thread_concurrency"><code class="literal">innodb_thread_concurrency</code></a>
      is observed again which may place the thread back into the
      first-in/first-out queue of waiting threads. When the thread is
      once again entitled to enter <code class="literal">InnoDB</code>, tickets
      are assigned again. The number of tickets assigned is specified by
      the global option
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_concurrency_tickets"><code class="literal">innodb_concurrency_tickets</code></a>,
      which is 5000 by default. A thread that is waiting for a lock is
      given one ticket once the lock becomes available.
    </p><p>
      The correct values of these variables depend on your environment
      and workload. Try a range of different values to determine what
      value works for your applications. Before limiting the number of
      concurrently executing threads, review configuration options that
      may improve the performance of <code class="literal">InnoDB</code> on
      multi-core and multi-processor computers, such as
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_adaptive_hash_index"><code class="literal">innodb_adaptive_hash_index</code></a>.
    </p><p>
      For general performance information about MySQL thread handling,
      see <a class="xref" href="optimization.html#connection-threads" title="8.12.6.1 How MySQL Uses Threads for Client Connections">Section 8.12.6.1, “How MySQL Uses Threads for Client Connections”</a>.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="innodb-performance-multiple_io_threads"></a>14.3.7 Configuring the Number of Background InnoDB I/O Threads</h3>

</div>

</div>

</div>
<a class="indexterm" name="idm140644115081728"></a><a class="indexterm" name="idm140644115080656"></a><a class="indexterm" name="idm140644115079168"></a><a class="indexterm" name="idm140644115078096"></a><a class="indexterm" name="idm140644115076608"></a><a class="indexterm" name="idm140644115075120"></a><p>
      InnoDB uses background <a class="link" href="glossary.html#glos_thread" title="thread">threads</a>
      to service various types of I/O requests. You can configure the
      number of background threads that service read and write I/O on
      data pages, using the configuration parameters
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_read_io_threads"><code class="literal">innodb_read_io_threads</code></a> and
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_write_io_threads"><code class="literal">innodb_write_io_threads</code></a>. These
      parameters signify the number of background threads used for read
      and write requests respectively. They are effective on all
      supported platforms. You can set the value of these parameters in
      the MySQL option file (<code class="literal">my.cnf</code> or
      <code class="literal">my.ini</code>); you cannot change them dynamically.
      The default value for these parameters is <code class="literal">4</code> and
      the permissible values range from <code class="literal">1-64</code>.
    </p><p>
      The purpose of this change is to make InnoDB more scalable on high
      end systems. Each background thread can handle up to 256 pending
      I/O requests. A major source of background I/O is the
      <a class="link" href="glossary.html#glos_read_ahead" title="read-ahead">read-ahead</a> requests. InnoDB
      tries to balance the load of incoming requests in such way that
      most of the background threads share work equally. InnoDB also
      attempts to allocate read requests from the same extent to the
      same thread to increase the chances of coalescing the requests
      together. If you have a high end I/O subsystem and you see more
      than 64 ×
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_read_io_threads"><code class="literal">innodb_read_io_threads</code></a> pending
      read requests in <code class="literal">SHOW ENGINE INNODB STATUS</code>, you
      might gain by increasing the value of
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_read_io_threads"><code class="literal">innodb_read_io_threads</code></a>.
    </p><p>
      For more information about InnoDB I/O performance, see
      <a class="xref" href="optimization.html#optimizing-innodb-diskio" title="8.5.8 Optimizing InnoDB Disk I/O">Section 8.5.8, “Optimizing InnoDB Disk I/O”</a>.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="innodb-performance-thread_io_rate"></a>14.3.8 Configuring the InnoDB Master Thread I/O Rate</h3>

</div>

</div>

</div>
<a class="indexterm" name="idm140644115058464"></a><a class="indexterm" name="idm140644115057392"></a><a class="indexterm" name="idm140644115055904"></a><p>
      The <a class="link" href="glossary.html#glos_master_thread" title="master thread">master thread</a> in
      InnoDB is a thread that performs various tasks in the background.
      Most of these tasks are I/O related, such as flushing dirty pages
      from the buffer pool or writing changes from the insert buffer to
      the appropriate secondary indexes. The master thread attempts to
      perform these tasks in a way that does not adversely affect the
      normal working of the server. It tries to estimate the free I/O
      bandwidth available and tune its activities to take advantage of
      this free capacity. Historically, InnoDB has used a hard coded
      value of 100 IOPs (input/output operations per second) as the
      total I/O capacity of the server.
    </p><p>
      The parameter <a class="link" href="innodb-storage-engine.html#sysvar_innodb_io_capacity"><code class="literal">innodb_io_capacity</code></a>
      indicates the overall I/O capacity available to InnoDB. This
      parameter should be set to approximately the number of I/O
      operations that the system can perform per second. The value
      depends on your system configuration. When
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_io_capacity"><code class="literal">innodb_io_capacity</code></a> is set,
      the master threads estimates the I/O bandwidth available for
      background tasks based on the set value. Setting the value to
      <code class="literal">100</code> reverts to the old behavior.
    </p><p>
      You can set the value of
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_io_capacity"><code class="literal">innodb_io_capacity</code></a> to any
      number 100 or greater. The default value is
      <code class="literal">200</code>, reflecting that the performance of typical
      modern I/O devices is higher than in the early days of MySQL.
      Typically, values around the previous default of 100 are
      appropriate for consumer-level storage devices, such as hard
      drives up to 7200 RPMs. Faster hard drives, RAID configurations,
      and SSDs benefit from higher values.
    </p><p>
      The <a class="link" href="innodb-storage-engine.html#sysvar_innodb_io_capacity"><code class="literal">innodb_io_capacity</code></a> setting is
      a total limit for all buffer pool instances. When dirty pages are
      flushed, the <a class="link" href="innodb-storage-engine.html#sysvar_innodb_io_capacity"><code class="literal">innodb_io_capacity</code></a>
      limit is divided equally among buffer pool instances. For more
      information, see the
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_io_capacity"><code class="literal">innodb_io_capacity</code></a> system
      variable description.
    </p><p>
      You can set the value of this parameter in the MySQL option file
      (<code class="literal">my.cnf</code> or <code class="literal">my.ini</code>) or change
      it dynamically with the <code class="literal">SET GLOBAL</code> command,
      which requires the <code class="literal">SUPER</code> privilege.
    </p><p>
      The <a class="link" href="innodb-storage-engine.html#sysvar_innodb_flush_sync"><code class="literal">innodb_flush_sync</code></a>
      configuration option, introduced in MySQL 5.7.8, causes the
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_io_capacity"><code class="literal">innodb_io_capacity</code></a> setting to be
      ignored during bursts of I/O activity that occur at checkpoints.
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_flush_sync"><code class="literal">innodb_flush_sync</code></a> is enabled by
      default.
    </p><p>
      Formerly, the <code class="literal">InnoDB</code> master thread also
      performed any needed <a class="link" href="glossary.html#glos_purge" title="purge">purge</a>
      operations. In MySQL 5.6.5 and higher, those I/O operations are
      moved to other background threads, whose number is controlled by
      the <a class="link" href="innodb-storage-engine.html#sysvar_innodb_purge_threads"><code class="literal">innodb_purge_threads</code></a>
      configuration option.
    </p><p>
      For more information about InnoDB I/O performance, see
      <a class="xref" href="optimization.html#optimizing-innodb-diskio" title="8.5.8 Optimizing InnoDB Disk I/O">Section 8.5.8, “Optimizing InnoDB Disk I/O”</a>.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="innodb-performance-spin_lock_polling"></a>14.3.9 Configuring Spin Lock Polling</h3>

</div>

</div>

</div>
<a class="indexterm" name="idm140644115026896"></a><a class="indexterm" name="idm140644115025824"></a><p>
      Many InnoDB <a class="link" href="glossary.html#glos_mutex" title="mutex">mutexes</a> and
      <a class="link" href="glossary.html#glos_rw_lock" title="rw-lock">rw-locks</a> are reserved for a
      short time. On a multi-core system, it can be more efficient for a
      thread to continuously check if it can acquire a mutex or rw-lock
      for a while before sleeping. If the mutex or rw-lock becomes
      available during this polling period, the thread can continue
      immediately, in the same time slice. However, too-frequent polling
      by multiple threads of a shared object can cause <span class="quote">“<span class="quote">cache ping
      pong</span>”</span>, different processors invalidating portions of each
      others' cache. InnoDB minimizes this issue by waiting a random
      time between subsequent polls. The delay is implemented as a busy
      loop.
    </p><p>
      You can control the maximum delay between testing a mutex or
      rw-lock using the parameter
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_spin_wait_delay"><code class="literal">innodb_spin_wait_delay</code></a>. The
      duration of the delay loop depends on the C compiler and the
      target processor. (In the 100MHz Pentium era, the unit of delay
      was one microsecond.) On a system where all processor cores share
      a fast cache memory, you might reduce the maximum delay or disable
      the busy loop altogether by setting
      <code class="literal">innodb_spin_wait_delay=0</code>. On a system with
      multiple processor chips, the effect of cache invalidation can be
      more significant and you might increase the maximum delay.
    </p><p>
      The default value of
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_spin_wait_delay"><code class="literal">innodb_spin_wait_delay</code></a> is
      <code class="literal">6</code>. The spin wait delay is a dynamic global
      parameter that you can specify in the MySQL option file
      (<code class="literal">my.cnf</code> or <code class="literal">my.ini</code>) or change
      at runtime with the command <code class="literal">SET GLOBAL
      innodb_spin_wait_delay=<em class="replaceable"><code>delay</code></em></code>,
      where <code class="literal"><em class="replaceable"><code>delay</code></em></code> is the
      desired maximum delay. Changing the setting requires the
      <code class="literal">SUPER</code> privilege.
    </p><p>
      For performance considerations for InnoDB locking operations, see
      <a class="xref" href="optimization.html#locking-issues" title="8.11 Optimizing Locking Operations">Section 8.11, “Optimizing Locking Operations”</a>.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="innodb-improved-purge-scheduling"></a>14.3.10 Configuring InnoDB Purge Scheduling</h3>

</div>

</div>

</div>
<a class="indexterm" name="idm140644115009168"></a><p>
      The <a class="link" href="glossary.html#glos_purge" title="purge">purge</a> operations (a type of
      garbage collection) that InnoDB performs automatically is now done
      in one or more separate threads, rather than as part of the
      <a class="link" href="glossary.html#glos_master_thread" title="master thread">master thread</a>. This
      change improves scalability, because the main database operations
      run independently from maintenance work happening in the
      background.
    </p><p>
      To control this feature, increase the value of the configuration
      option <a class="link" href="innodb-storage-engine.html#sysvar_innodb_purge_threads"><code class="literal">innodb_purge_threads</code></a>. If
      DML action is concentrated on a single table or a few tables, keep
      the setting low so that the threads do not contend with each other
      for access to the busy tables. If DML operations are spread across
      many tables, increase the setting. Its maximum is 32.
    </p><p>
      There is another related configuration option,
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_purge_batch_size"><code class="literal">innodb_purge_batch_size</code></a> with a
      default value of 300 and maximum value of 5000. This option is
      mainly intended for experimentation and tuning of purge
      operations, and should not be interesting to typical users.
    </p><p>
      For more information about InnoDB I/O performance, see
      <a class="xref" href="optimization.html#optimizing-innodb-diskio" title="8.5.8 Optimizing InnoDB Disk I/O">Section 8.5.8, “Optimizing InnoDB Disk I/O”</a>.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="innodb-performance-optimizer-statistics"></a>14.3.11 Configuring Optimizer Statistics for InnoDB</h3>

</div>

</div>

</div>
<div class="toc">
<dl class="toc"><dt><span class="section"><a href="innodb-storage-engine.html#innodb-persistent-stats">14.3.11.1 Configuring Persistent Optimizer Statistics Parameters</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-statistics-estimation">14.3.11.2 Configuring Non-Persistent Optimizer Statistics Parameters</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-analyze-table-complexity">14.3.11.3 Estimating ANALYZE TABLE Complexity for InnoDB Tables</a></span></dt></dl>
</div>
<p>
      This section describes how to configure persistent and
      non-persistent optimizer statistics for <code class="literal">InnoDB</code>
      tables.
    </p><p>
      Persistent optimizer statistics are persisted across server
      restarts, allowing for greater
      <a class="link" href="glossary.html#glos_plan_stability" title="plan stability">plan stability</a> and more
      consistent query performance. Persistent optimizer statistics also
      provide control and flexibility with these additional benefits:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          You can use the
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_stats_auto_recalc"><code class="literal">innodb_stats_auto_recalc</code></a>
          configuration option to control whether statistics are updated
          automatically after substantial changes to a table.
        </p></li><li class="listitem"><p>
          You can use the <code class="literal">STATS_PERSISTENT</code>,
          <code class="literal">STATS_AUTO_RECALC</code>, and
          <code class="literal">STATS_SAMPLE_PAGES</code> clauses with
          <a class="link" href="sql-syntax.html#create-table" title="13.1.18 CREATE TABLE Syntax"><code class="literal">CREATE TABLE</code></a> and
          <a class="link" href="sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a> statements to
          configure optimizer statistics for individual tables.
        </p></li><li class="listitem"><p>
          You can query optimizer statistics data in the
          <code class="literal">mysql.innodb_table_stats</code> and
          <code class="literal">mysql.innodb_index_stats</code> tables.
        </p></li><li class="listitem"><p>
          You can view the <code class="literal">last_update</code> column of the
          <code class="literal">mysql.innodb_table_stats</code> and
          <code class="literal">mysql.innodb_index_stats</code> tables to see when
          statistics were last updated.
        </p></li><li class="listitem"><p>
          You can manually modify the
          <code class="literal">mysql.innodb_table_stats</code> and
          <code class="literal">mysql.innodb_index_stats</code> tables to force a
          specific query optimization plan or to test alternative plans
          without modifying the database.
</p></li></ul>
</div>
<p>
      The persistent optimizer statistics feature is enabled by default
      (<a class="link" href="innodb-storage-engine.html#sysvar_innodb_stats_persistent"><code class="literal">innodb_stats_persistent=ON</code></a>).
    </p><p>
      Non-persistent optimizer statistics are cleared on each server
      restart and after some other operations, and recomputed on the
      next table access. As a result, different estimates could be
      produced when recomputing statistics, leading to different choices
      in execution plans and variations in query performance.
    </p><p>
      This section also provides information about estimating
      <a class="link" href="sql-syntax.html#analyze-table" title="13.7.2.1 ANALYZE TABLE Syntax"><code class="literal">ANALYZE TABLE</code></a> complexity, which may
      be useful when attempting to achieve a balance between accurate
      statistics and <a class="link" href="sql-syntax.html#analyze-table" title="13.7.2.1 ANALYZE TABLE Syntax"><code class="literal">ANALYZE TABLE</code></a>
      execution time.
</p>
<div class="section">

<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="innodb-persistent-stats"></a>14.3.11.1 Configuring Persistent Optimizer Statistics Parameters</h4>
</div>
</div>
</div>
<a class="indexterm" name="idm140644114973824"></a><a class="indexterm" name="idm140644114972352"></a><a class="indexterm" name="idm140644114970848"></a><a class="indexterm" name="idm140644114969344"></a><a class="indexterm" name="idm140644114967840"></a><p>
        The persistent optimizer statistics feature improves
        <a class="link" href="glossary.html#glos_plan_stability" title="plan stability">plan stability</a> by
        storing statistics to disk and making them persistent across
        server restarts so that the
        <a class="link" href="glossary.html#glos_optimizer" title="optimizer">optimizer</a> is more likely
        to make consistent choices each time for a given query.
      </p><p>
        Optimizer statistics are persisted to disk when
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_stats_persistent"><code class="literal">innodb_stats_persistent=ON</code></a> or
        when individual tables are created or altered with
        <a class="link" href="sql-syntax.html#create-table" title="13.1.18 CREATE TABLE Syntax"><code class="literal">STATS_PERSISTENT=1</code></a>.
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_stats_persistent"><code class="literal">innodb_stats_persistent</code></a> is
        enabled by default.
      </p><p>
        Formerly, optimizer statistics were cleared on each server
        restart and after some other operations, and recomputed on the
        next table access. Consequently, different estimates could be
        produced when recalculating statistics, leading to different
        choices in query execution plans and thus variations in query
        performance.
      </p><p>
        Persistent statistics are stored in the
        <code class="literal">mysql.innodb_table_stats</code> and
        <code class="literal">mysql.innodb_index_stats</code> tables, as described
        in <a class="xref" href="innodb-storage-engine.html#innodb-persistent-stats-tables" title="14.3.11.1.4 InnoDB Persistent Statistics Tables">Section 14.3.11.1.4, “InnoDB Persistent Statistics Tables”</a>.
      </p><p>
        To revert to using non-persistent optimizer statistics, you can
        modify tables using an <code class="literal">ALTER TABLE
        <em class="replaceable"><code>tbl_name</code></em> STATS_PERSISTENT=0</code>
        statement. For related information, see
        <a class="xref" href="innodb-storage-engine.html#innodb-statistics-estimation" title="14.3.11.2 Configuring Non-Persistent Optimizer Statistics Parameters">Section 14.3.11.2, “Configuring Non-Persistent Optimizer Statistics Parameters”</a>
</p>
<div class="section">

<div class="titlepage">
<div>
<div>
<h5 class="title"><a name="innodb-persistent-stats-auto-recalc"></a>14.3.11.1.1 Configuring Automatic Statistics Calculation for Persistent Optimizer
Statistics</h5>
</div>
</div>
</div>
<p>
          The <a class="link" href="innodb-storage-engine.html#sysvar_innodb_stats_auto_recalc"><code class="literal">innodb_stats_auto_recalc</code></a>
          configuration option, which is enabled by default, determines
          whether statistics are calculated automatically whenever a
          table undergoes substantial changes (to more than 10% of the
          rows). You can also configure automatic statistics
          recalculation for individual tables using a
          <code class="literal">STATS_AUTO_RECALC</code> clause in a
          <a class="link" href="sql-syntax.html#create-table" title="13.1.18 CREATE TABLE Syntax"><code class="literal">CREATE TABLE</code></a> or
          <a class="link" href="sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a> statement.
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_stats_auto_recalc"><code class="literal">innodb_stats_auto_recalc</code></a> is
          enabled by default.
        </p><p>
          Because of the asynchronous nature of automatic statistics
          recalculation (which occurs in the background), statistics may
          not be recalculated instantly after running a DML operation
          that affects more than 10% of a table, even when
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_stats_auto_recalc"><code class="literal">innodb_stats_auto_recalc</code></a> is
          enabled. In some cases, statistics recalculation may be
          delayed by a few seconds. If up-to-date statistics are
          required immediately after changing significant portions of a
          table, run <a class="link" href="sql-syntax.html#analyze-table" title="13.7.2.1 ANALYZE TABLE Syntax"><code class="literal">ANALYZE
          TABLE</code></a> to initiate a synchronous (foreground)
          recalculation of statistics.
        </p><p>
          If <a class="link" href="innodb-storage-engine.html#sysvar_innodb_stats_auto_recalc"><code class="literal">innodb_stats_auto_recalc</code></a>
          is disabled, ensure the accuracy of optimizer statistics by
          issuing the <a class="link" href="sql-syntax.html#analyze-table" title="13.7.2.1 ANALYZE TABLE Syntax"><code class="literal">ANALYZE TABLE</code></a>
          statement for each applicable table after making substantial
          changes to indexed columns. You might run this statement in
          your setup scripts after representative data has been loaded
          into the table, and run it periodically after DML operations
          significantly change the contents of indexed columns, or on a
          schedule at times of low activity. When a new index is added
          to an existing table, index statistics are calculated and
          added to the <code class="literal">innodb_index_stats</code> table
          regardless of the value of
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_stats_auto_recalc"><code class="literal">innodb_stats_auto_recalc</code></a>.
</p>
<div class="caution" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Caution
</div>
<p>
            To ensure statistics are gathered when a new index is
            created, either enable the
            <a class="link" href="innodb-storage-engine.html#sysvar_innodb_stats_auto_recalc"><code class="literal">innodb_stats_auto_recalc</code></a>
            option, or run <a class="link" href="sql-syntax.html#analyze-table" title="13.7.2.1 ANALYZE TABLE Syntax"><code class="literal">ANALYZE TABLE</code></a>
            after creating each new index when the persistent statistics
            mode is enabled.
</p>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h5 class="title"><a name="innodb-persistent-stats-table-configuration"></a>14.3.11.1.2 Configuring Optimizer Statistics Parameters for Individual Tables</h5>

</div>

</div>

</div>
<p>
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_stats_persistent"><code class="literal">innodb_stats_persistent</code></a>,
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_stats_auto_recalc"><code class="literal">innodb_stats_auto_recalc</code></a>, and
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_stats_persistent_sample_pages"><code class="literal">innodb_stats_persistent_sample_pages</code></a>
          are global configuration options. To override these
          system-wide settings and configure optimizer statistics
          parameters for individual tables, you can define
          <code class="literal">STATS_PERSISTENT</code>,
          <code class="literal">STATS_AUTO_RECALC</code>, and
          <code class="literal">STATS_SAMPLE_PAGES</code> clauses in
          <a class="link" href="sql-syntax.html#create-table" title="13.1.18 CREATE TABLE Syntax"><code class="literal">CREATE TABLE</code></a> or
          <a class="link" href="sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a> statements.
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              <code class="literal">STATS_PERSISTENT</code> specifies whether to
              enable
              <a class="link" href="glossary.html#glos_persistent_statistics" title="persistent statistics">persistent
              statistics</a> for an <code class="literal">InnoDB</code> table.
              The value <code class="literal">DEFAULT</code> causes the persistent
              statistics setting for the table to be determined by the
              <a class="link" href="innodb-storage-engine.html#sysvar_innodb_stats_persistent"><code class="literal">innodb_stats_persistent</code></a>
              configuration option. The value <code class="literal">1</code>
              enables persistent statistics for the table, while the
              value <code class="literal">0</code> turns off this feature. After
              enabling persistent statistics through a <code class="literal">CREATE
              TABLE</code> or <code class="literal">ALTER TABLE</code>
              statement, issue an <a class="link" href="sql-syntax.html#analyze-table" title="13.7.2.1 ANALYZE TABLE Syntax"><code class="literal">ANALYZE
              TABLE</code></a> statement to calculate the statistics,
              after loading representative data into the table.
            </p></li><li class="listitem"><p>
              <code class="literal">STATS_AUTO_RECALC</code> specifies whether to
              automatically recalculate
              <a class="link" href="glossary.html#glos_persistent_statistics" title="persistent statistics">persistent
              statistics</a> for an <code class="literal">InnoDB</code> table.
              The value <code class="literal">DEFAULT</code> causes the persistent
              statistics setting for the table to be determined by the
              <a class="link" href="innodb-storage-engine.html#sysvar_innodb_stats_auto_recalc"><code class="literal">innodb_stats_auto_recalc</code></a>
              configuration option. The value <code class="literal">1</code>
              causes statistics to be recalculated when 10% of the data
              in the table has changed. The value <code class="literal">0</code>
              prevents automatic recalculation for this table; with this
              setting, issue an <a class="link" href="sql-syntax.html#analyze-table" title="13.7.2.1 ANALYZE TABLE Syntax"><code class="literal">ANALYZE
              TABLE</code></a> statement to recalculate the statistics
              after making substantial changes to the table.
            </p></li><li class="listitem"><p>
              <code class="literal">STATS_SAMPLE_PAGES</code> specifies the number
              of index pages to sample when estimating cardinality and
              other statistics for an indexed column, such as those
              calculated by <a class="link" href="sql-syntax.html#analyze-table" title="13.7.2.1 ANALYZE TABLE Syntax"><code class="literal">ANALYZE
              TABLE</code></a>.
</p></li></ul>
</div>
<p>
          All three clauses are specified in the following
          <a class="link" href="sql-syntax.html#create-table" title="13.1.18 CREATE TABLE Syntax"><code class="literal">CREATE TABLE</code></a> example:
        </p><pre class="programlisting">CREATE TABLE `t1` (
`id` int(8) NOT NULL auto_increment,
`data` varchar(255),
`date` datetime,
PRIMARY KEY  (`id`),
INDEX `DATE_IX` (`date`)
) ENGINE=InnoDB, 
  STATS_PERSISTENT=1, 
  STATS_AUTO_RECALC=1,
STATS_SAMPLE_PAGES=25;</pre>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h5 class="title"><a name="innodb-persistent-stats-pages-sampled"></a>14.3.11.1.3 Configuring the Number of Sampled Pages for InnoDB Optimizer Statistics</h5>

</div>

</div>

</div>
<p>
          The MySQL query optimizer uses estimated
          <a class="link" href="glossary.html#glos_statistics" title="statistics">statistics</a> about key
          distributions to choose the indexes for an execution plan,
          based on the relative
          <a class="link" href="glossary.html#glos_selectivity" title="selectivity">selectivity</a> of the
          index. Operations such as <a class="link" href="sql-syntax.html#analyze-table" title="13.7.2.1 ANALYZE TABLE Syntax"><code class="literal">ANALYZE
          TABLE</code></a> cause <code class="literal">InnoDB</code> to sample
          random pages from each index on a table to estimate the
          <a class="link" href="glossary.html#glos_cardinality" title="cardinality">cardinality</a> of the
          index. (This technique is known as
          <a class="link" href="glossary.html#glos_random_dive" title="random dive">random dives</a>.)
        </p><p>
          To give you control over the quality of the statistics
          estimate (and thus better information for the query
          optimizer), you can change the number of sampled pages using
          the parameter
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_stats_persistent_sample_pages"><code class="literal">innodb_stats_persistent_sample_pages</code></a>,
          which can be set at runtime.
        </p><p>
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_stats_persistent_sample_pages"><code class="literal">innodb_stats_persistent_sample_pages</code></a>
          has a default value of 20. As a general guideline, consider
          modifying this parameter when encountering the following
          issues:
</p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p>
              <span class="emphasis"><em>Statistics are not accurate enough and the
              optimizer chooses suboptimal plans</em></span>, as shown by
              <a class="link" href="sql-syntax.html#explain" title="13.8.2 EXPLAIN Syntax"><code class="literal">EXPLAIN</code></a> output. The
              accuracy of statistics can be checked by comparing the
              actual cardinality of an index (as returned by running
              <a class="link" href="sql-syntax.html#select" title="13.2.9 SELECT Syntax"><code class="literal">SELECT
              DISTINCT</code></a> on the index columns) with the
              estimates provided in the
              <code class="literal">mysql.innodb_index_stats</code> persistent
              statistics table.
            </p><p>
              If it is determined that statistics are not accurate
              enough, the value of
              <a class="link" href="innodb-storage-engine.html#sysvar_innodb_stats_persistent_sample_pages"><code class="literal">innodb_stats_persistent_sample_pages</code></a>
              should be increased until the statistics estimates are
              sufficiently accurate. Increasing
              <a class="link" href="innodb-storage-engine.html#sysvar_innodb_stats_persistent_sample_pages"><code class="literal">innodb_stats_persistent_sample_pages</code></a>
              too much, however, could cause
              <a class="link" href="sql-syntax.html#analyze-table" title="13.7.2.1 ANALYZE TABLE Syntax"><code class="literal">ANALYZE TABLE</code></a> to run
              slowly.
            </p></li><li class="listitem"><p>
              <span class="emphasis"><em><a class="link" href="sql-syntax.html#analyze-table" title="13.7.2.1 ANALYZE TABLE Syntax"><code class="literal">ANALYZE TABLE</code></a> is
              too slow</em></span>. In this case
              <a class="link" href="innodb-storage-engine.html#sysvar_innodb_stats_persistent_sample_pages"><code class="literal">innodb_stats_persistent_sample_pages</code></a>
              should be decreased until <a class="link" href="sql-syntax.html#analyze-table" title="13.7.2.1 ANALYZE TABLE Syntax"><code class="literal">ANALYZE
              TABLE</code></a> execution time is acceptable. Decreasing
              the value too much, however, could lead to the first
              problem of inaccurate statistics and suboptimal query
              execution plans.
            </p><p>
              If a balance cannot be achieved between accurate
              statistics and <a class="link" href="sql-syntax.html#analyze-table" title="13.7.2.1 ANALYZE TABLE Syntax"><code class="literal">ANALYZE
              TABLE</code></a> execution time, consider decreasing the
              number of indexed columns in the table or limiting the
              number of partitions to reduce
              <a class="link" href="sql-syntax.html#analyze-table" title="13.7.2.1 ANALYZE TABLE Syntax"><code class="literal">ANALYZE TABLE</code></a> complexity.
              The number of columns in the table's primary key is also
              important to consider, as primary key columns are appended
              to each non-unique index.
            </p><p>
              For related information, see
              <a class="xref" href="innodb-storage-engine.html#innodb-analyze-table-complexity" title="14.3.11.3 Estimating ANALYZE TABLE Complexity for InnoDB Tables">Section 14.3.11.3, “Estimating ANALYZE TABLE Complexity for InnoDB Tables”</a>.
</p></li></ol>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h5 class="title"><a name="innodb-persistent-stats-tables"></a>14.3.11.1.4 InnoDB Persistent Statistics Tables</h5>

</div>

</div>

</div>
<p>
          The persistent statistics feature relies on the internally
          managed tables in the <code class="literal">mysql</code> database, named
          <code class="literal">innodb_table_stats</code> and
          <code class="literal">innodb_index_stats</code>. These tables are set up
          automatically in all install, upgrade, and build-from-source
          procedures.
</p>
<div class="table">
<a name="innodb-table-stats-table"></a><p class="title"><b>Table 14.2 Columns of innodb_table_stats</b></p>
<div class="table-contents">
<table summary="Columns of innodb_table_stats" border="1"><colgroup><col><col></colgroup><thead><tr><th scope="col">Column name</th><th scope="col">Description</th></tr></thead><tbody><tr><td scope="row"><code class="literal">database_name</code></td><td>Database name</td></tr><tr><td scope="row"><code class="literal">table_name</code></td><td>Table name, partition name, or subpartition name</td></tr><tr><td scope="row"><code class="literal">last_update</code></td><td>A timestamp indicating the last time that <code class="literal">InnoDB</code>
updated this row</td></tr><tr><td scope="row"><code class="literal">n_rows</code></td><td>The number of rows in the table</td></tr><tr><td scope="row"><code class="literal">clustered_index_size</code></td><td>The size of the primary index, in pages</td></tr><tr><td scope="row"><code class="literal">sum_of_other_index_sizes</code></td><td>The total size of other (non-primary) indexes, in pages</td></tr></tbody></table>
</div>

</div>
<br class="table-break">
<div class="table">
<a name="innodb-index-stats-table"></a><p class="title"><b>Table 14.3 Columns of innodb_index_stats</b></p>
<div class="table-contents">
<table summary="Columns of innodb_index_stats" border="1"><colgroup><col><col></colgroup><thead><tr><th scope="col">Column name</th><th scope="col">Description</th></tr></thead><tbody><tr><td scope="row"><code class="literal">database_name</code></td><td>Database name</td></tr><tr><td scope="row"><code class="literal">table_name</code></td><td>Table name, partition name, or subpartition name</td></tr><tr><td scope="row"><code class="literal">index_name</code></td><td>Index name</td></tr><tr><td scope="row"><code class="literal">last_update</code></td><td>A timestamp indicating the last time that <code class="literal">InnoDB</code>
                  updated this row</td></tr><tr><td scope="row"><code class="literal">stat_name</code></td><td>The name of the statistic, whose value is reported in the
                  <code class="literal">stat_value</code> column</td></tr><tr><td scope="row"><code class="literal">stat_value</code></td><td>The value of the statistic that is named in <code class="literal">stat_name</code>
                  column</td></tr><tr><td scope="row"><code class="literal">sample_size</code></td><td>The number of pages sampled for the estimate provided in the
                  <code class="literal">stat_value</code> column</td></tr><tr><td scope="row"><code class="literal">stat_description</code></td><td>Description of the statistic that is named in the
<code class="literal">stat_name</code> column</td></tr></tbody></table>
</div>

</div>
<br class="table-break"><p>
          Both the <code class="literal">innodb_table_stats</code> and
          <code class="literal">innodb_index_stats</code> tables include a
          <code class="literal">last_update</code> column showing when
          <code class="literal">InnoDB</code> last updated index statistics, as
          shown in the following example:
        </p><pre class="programlisting">mysql&gt; select * from innodb_table_stats \G
*************************** 1. row ***************************
           database_name: sakila
              table_name: actor
             last_update: 2014-05-28 16:16:44
                  n_rows: 200
    clustered_index_size: 1
sum_of_other_index_sizes: 1
...</pre><pre class="programlisting">mysql&gt; select * from innodb_index_stats \G
*************************** 1. row ***************************
   database_name: sakila
      table_name: actor
      index_name: PRIMARY
     last_update: 2014-05-28 16:16:44
       stat_name: n_diff_pfx01
      stat_value: 200
     sample_size: 1
     ...</pre><p>
          The <code class="literal">innodb_table_stats</code> and
          <code class="literal">innodb_index_stats</code> tables are ordinary
          tables and can be updated manually. The ability to update
          statistics manually makes it possible to force a specific
          query optimization plan or test alternative plans without
          modifying the database. If you manually update statistics,
          issue the <code class="literal">FLUSH TABLE
          <em class="replaceable"><code>tbl_name</code></em></code> command to make
          MySQL reload the updated statistics.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h5 class="title"><a name="innodb-persistent-stats-tables-example"></a>14.3.11.1.5 InnoDB Persistent Statistics Tables Example</h5>

</div>

</div>

</div>
<p>
          The <code class="literal">innodb_table_stats</code> table contains one
          row per table. The data collected is demonstrated in the
          following example.
        </p><p>
          Table <code class="literal">t1</code> contains a primary index (columns
          <code class="literal">a</code>, <code class="literal">b</code>) secondary index
          (columns <code class="literal">c</code>, <code class="literal">d</code>), and
          unique index (columns <code class="literal">e</code>,<code class="literal">
          f</code>):
        </p><pre class="programlisting">CREATE TABLE t1 (
a INT, b INT, c INT, d INT, e INT, f INT,
PRIMARY KEY (a, b), KEY i1 (c, d), UNIQUE KEY i2uniq (e, f)
) ENGINE=INNODB;</pre><p>
          After inserting five rows of sample data, the table appears as
          follows:
        </p><pre class="programlisting">mysql&gt; SELECT * FROM t1;
+---+---+------+------+------+------+
| a | b | c    | d    | e    | f    |
+---+---+------+------+------+------+
| 1 | 1 |   10 |   11 |  100 |  101 |
| 1 | 2 |   10 |   11 |  200 |  102 |
| 1 | 3 |   10 |   11 |  100 |  103 |
| 1 | 4 |   10 |   12 |  200 |  104 |
| 1 | 5 |   10 |   12 |  100 |  105 |
+---+---+------+------+------+------+</pre><p>
          To immediately update statistics, run
          <a class="link" href="sql-syntax.html#analyze-table" title="13.7.2.1 ANALYZE TABLE Syntax"><code class="literal">ANALYZE TABLE</code></a> (if
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_stats_auto_recalc"><code class="literal">innodb_stats_auto_recalc</code></a> is
          enabled, statistics are updated automatically within a few
          seconds assuming that the 10% threshold for changed table rows
          is reached):
        </p><pre class="programlisting">mysql&gt; ANALYZE TABLE t1;
+---------+---------+----------+----------+
| Table   | Op      | Msg_type | Msg_text |
+---------+---------+----------+----------+
| test.t1 | analyze | status   | OK       |
+---------+---------+----------+----------+</pre><p>
          Table statistics for table <code class="literal">t1</code> show the last
          time <code class="literal">InnoDB</code> updated the table statistics
          (<code class="literal">2014-03-14 14:36:34</code>), the number of rows
          in the table (<code class="literal">5</code>), the clustered index size
          (<code class="literal">1</code> page), and the combined size of the
          other indexes (<code class="literal">2</code> pages).
        </p><pre class="programlisting">mysql&gt; SELECT * FROM mysql.innodb_table_stats WHERE table_name like 't1'\G
*************************** 1. row ***************************
           database_name: test
              table_name: t1
             last_update: 2014-03-14 14:36:34
                  n_rows: 5
    clustered_index_size: 1
sum_of_other_index_sizes: 2</pre><p>
          The <code class="literal">innodb_index_stats</code> table contains
          multiple rows for each index. Each row in the
          <code class="literal">innodb_index_stats</code> table provides data
          related to a particular index statistic which is named in the
          <code class="literal">stat_name</code> column and described in the
          <code class="literal">stat_description</code> column. For example:
        </p><pre class="programlisting">mysql&gt; SELECT index_name, stat_name, stat_value, stat_description
    -&gt; FROM mysql.innodb_index_stats WHERE table_name like 't1';
+------------+--------------+------------+-----------------------------------+
| index_name | stat_name    | stat_value | stat_description                  |
+------------+--------------+------------+-----------------------------------+
| PRIMARY    | n_diff_pfx01 |          1 | a                                 |
| PRIMARY    | n_diff_pfx02 |          5 | a,b                               |
| PRIMARY    | n_leaf_pages |          1 | Number of leaf pages in the index |
| PRIMARY    | size         |          1 | Number of pages in the index      |
| i1         | n_diff_pfx01 |          1 | c                                 |
| i1         | n_diff_pfx02 |          2 | c,d                               |
| i1         | n_diff_pfx03 |          2 | c,d,a                             |
| i1         | n_diff_pfx04 |          5 | c,d,a,b                           |
| i1         | n_leaf_pages |          1 | Number of leaf pages in the index |
| i1         | size         |          1 | Number of pages in the index      |
| i2uniq     | n_diff_pfx01 |          2 | e                                 |
| i2uniq     | n_diff_pfx02 |          5 | e,f                               |
| i2uniq     | n_leaf_pages |          1 | Number of leaf pages in the index |
| i2uniq     | size         |          1 | Number of pages in the index      |
+------------+--------------+------------+-----------------------------------+</pre><p>
          The <code class="literal">stat_name</code> column shows the following
          types of statistics:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              <code class="literal">size</code>: Where
              <code class="literal">stat_name</code>=<code class="literal">size</code>, the
              <code class="literal">stat_value</code> column displays the total
              number of pages in the index.
            </p></li><li class="listitem"><p>
              <code class="literal">n_leaf_pages</code>: Where
              <code class="literal">stat_name</code>=<code class="literal">n_leaf_pages</code>,
              the <code class="literal">stat_value</code> column displays the
              number of leaf pages in the index.
            </p></li><li class="listitem"><p>
              <code class="literal">n_diff_pfx<em class="replaceable"><code>NN</code></em></code>:
              Where
              <code class="literal">stat_name</code>=<code class="literal">n_diff_pfx01</code>,
              the <code class="literal">stat_value</code> column displays the
              number of distinct values in the first column of the
              index. Where
              <code class="literal">stat_name</code>=<code class="literal">n_diff_pfx02</code>,
              the <code class="literal">stat_value</code> column displays the
              number of distinct values in the first two columns of the
              index, and so on. Additionally, where
              <code class="literal">stat_name</code>=<code class="literal">n_diff_pfx<em class="replaceable"><code>NN</code></em></code>,
              the <code class="literal">stat_description</code> column shows a
              comma separated list of the index columns that are
              counted.
</p></li></ul>
</div>
<p>
          To further illustrate the
          <code class="literal">n_diff_pfx<em class="replaceable"><code>NN</code></em></code>
          statistic, which provides cardinality data, consider the
          <code class="literal">t1</code> table example. As shown below, the
          <code class="literal">t1</code> table is created with a primary index
          (columns <code class="literal">a</code>, <code class="literal">b</code>), a
          secondary index (columns <code class="literal">c</code>,
          <code class="literal">d</code>), and a unique index (columns
          <code class="literal">e</code>, <code class="literal">f</code>):
        </p><pre class="programlisting">CREATE TABLE t1 (
  a INT, b INT, c INT, d INT, e INT, f INT,
  PRIMARY KEY (a, b), KEY i1 (c, d), UNIQUE KEY i2uniq (e, f)
) ENGINE=INNODB;</pre><p>
          After inserting five rows of sample data, the table appears as
          follows:
        </p><pre class="programlisting">mysql&gt; SELECT * FROM t1;
+---+---+------+------+------+------+
| a | b | c    | d    | e    | f    |
+---+---+------+------+------+------+
| 1 | 1 |   10 |   11 |  100 |  101 |
| 1 | 2 |   10 |   11 |  200 |  102 |
| 1 | 3 |   10 |   11 |  100 |  103 |
| 1 | 4 |   10 |   12 |  200 |  104 |
| 1 | 5 |   10 |   12 |  100 |  105 |
+---+---+------+------+------+------+</pre><p>
          When you query the <code class="literal">index_name</code>,
          <code class="literal">stat_name</code>, <code class="literal">stat_value</code>,
          and <code class="literal">stat_description</code> where
          <code class="literal">stat_name LIKE 'n_diff%'</code>, the following
          result set is returned:
        </p><pre class="programlisting">mysql&gt; SELECT index_name, stat_name, stat_value, stat_description 
    -&gt; FROM mysql.innodb_index_stats
    -&gt; WHERE table_name like 't1' AND stat_name LIKE 'n_diff%';
+------------+--------------+------------+------------------+
| index_name | stat_name    | stat_value | stat_description |
+------------+--------------+------------+------------------+
| PRIMARY    | n_diff_pfx01 |          1 | a                |
| PRIMARY    | n_diff_pfx02 |          5 | a,b              |
| i1         | n_diff_pfx01 |          1 | c                |
| i1         | n_diff_pfx02 |          2 | c,d              |
| i1         | n_diff_pfx03 |          2 | c,d,a            |
| i1         | n_diff_pfx04 |          5 | c,d,a,b          |
| i2uniq     | n_diff_pfx01 |          2 | e                |
| i2uniq     | n_diff_pfx02 |          5 | e,f              |
+------------+--------------+------------+------------------+</pre><p>
          For the <code class="literal">PRIMARY</code> index, there are two
          <code class="literal">n_diff%</code> rows. The number of rows is equal
          to the number of columns in the index.
</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
            For non-unique indexes, <code class="literal">InnoDB</code> appends
            the columns of the primary key.
</p>
</div>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              Where
              <code class="literal">index_name</code>=<code class="literal">PRIMARY</code>
              and
              <code class="literal">stat_name</code>=<code class="literal">n_diff_pfx01</code>,
              the <code class="literal">stat_value</code> is <code class="literal">1</code>,
              which indicates that there is a single distinct value in
              the first column of the index (column
              <code class="literal">a</code>). The number of distinct values in
              column <code class="literal">a</code> is confirmed by viewing the
              data in column <code class="literal">a</code> in table
              <code class="literal">t1</code>, in which there is a single distinct
              value (<code class="literal">1</code>). The counted column
              (<code class="literal">a</code>) is shown in the
              <code class="literal">stat_description</code> column of the result
              set.
            </p></li><li class="listitem"><p>
              Where
              <code class="literal">index_name</code>=<code class="literal">PRIMARY</code>
              and
              <code class="literal">stat_name</code>=<code class="literal">n_diff_pfx02</code>,
              the <code class="literal">stat_value</code> is <code class="literal">5</code>,
              which indicates that there are five distinct values in the
              two columns of the index (<code class="literal">a,b</code>). The
              number of distinct values in columns <code class="literal">a</code>
              and <code class="literal">b</code> is confirmed by viewing the data
              in columns <code class="literal">a</code> and <code class="literal">b</code>
              in table <code class="literal">t1</code>, in which there are five
              distinct values: (<code class="literal">1,1</code>),
              (<code class="literal">1,2</code>), (<code class="literal">1,3</code>),
              (<code class="literal">1,4</code>) and (<code class="literal">1,5</code>). The
              counted columns (<code class="literal">a,b</code>) are shown in the
              <code class="literal">stat_description</code> column of the result
              set.
</p></li></ul>
</div>
<p>
          For the secondary index (<code class="literal">i1</code>), there are
          four <code class="literal">n_diff%</code> rows. Only two columns are
          defined for the secondary index (<code class="literal">c,d</code>) but
          there are four <code class="literal">n_diff%</code> rows for the
          secondary index because <code class="literal">InnoDB</code> suffixes all
          non-unique indexes with the primary key. As a result, there
          are four <code class="literal">n_diff%</code> rows instead of two to
          account for the both the secondary index columns
          (<code class="literal">c,d</code>) and the primary key columns
          (<code class="literal">a,b</code>).
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              Where <code class="literal">index_name</code>=<code class="literal">i1</code>
              and
              <code class="literal">stat_name</code>=<code class="literal">n_diff_pfx01</code>,
              the <code class="literal">stat_value</code> is <code class="literal">1</code>,
              which indicates that there is a single distinct value in
              the first column of the index (column
              <code class="literal">c</code>). The number of distinct values in
              column <code class="literal">c</code> is confirmed by viewing the
              data in column <code class="literal">c</code> in table
              <code class="literal">t1</code>, in which there is a single distinct
              value: (<code class="literal">10</code>). The counted column
              (<code class="literal">c</code>) is shown in the
              <code class="literal">stat_description</code> column of the result
              set.
            </p></li><li class="listitem"><p>
              Where <code class="literal">index_name</code>=<code class="literal">i1</code>
              and
              <code class="literal">stat_name</code>=<code class="literal">n_diff_pfx02</code>,
              the <code class="literal">stat_value</code> is <code class="literal">2</code>,
              which indicates that there are two distinct values in the
              first two columns of the index (<code class="literal">c,d</code>).
              The number of distinct values in columns
              <code class="literal">c</code> an <code class="literal">d</code> is confirmed
              by viewing the data in columns <code class="literal">c</code> and
              <code class="literal">d</code> in table <code class="literal">t1</code>, in
              which there are two distinct values:
              (<code class="literal">10,11</code>) and (<code class="literal">10,12</code>).
              The counted columns (<code class="literal">c,d</code>) are shown in
              the <code class="literal">stat_description</code> column of the
              result set.
            </p></li><li class="listitem"><p>
              Where <code class="literal">index_name</code>=<code class="literal">i1</code>
              and
              <code class="literal">stat_name</code>=<code class="literal">n_diff_pfx03</code>,
              the <code class="literal">stat_value</code> is <code class="literal">2</code>,
              which indicates that there are two distinct values in the
              first three columns of the index
              (<code class="literal">c,d,a</code>). The number of distinct values
              in columns <code class="literal">c</code>, <code class="literal">d</code>, and
              <code class="literal">a</code> is confirmed by viewing the data in
              column <code class="literal">c</code>, <code class="literal">d</code>, and
              <code class="literal">a</code> in table <code class="literal">t1</code>, in
              which there are two distinct values:
              (<code class="literal">10,11,1</code>) and
              (<code class="literal">10,12,1</code>). The counted columns
              (<code class="literal">c,d,a</code>) are shown in the
              <code class="literal">stat_description</code> column of the result
              set.
            </p></li><li class="listitem"><p>
              Where <code class="literal">index_name</code>=<code class="literal">i1</code>
              and
              <code class="literal">stat_name</code>=<code class="literal">n_diff_pfx04</code>,
              the <code class="literal">stat_value</code> is <code class="literal">5</code>,
              which indicates that there are five distinct values in the
              four columns of the index (<code class="literal">c,d,a,b</code>).
              The number of distinct values in columns
              <code class="literal">c</code>, <code class="literal">d</code>,
              <code class="literal">a</code> and <code class="literal">b</code> is confirmed
              by viewing the data in columns <code class="literal">c</code>,
              <code class="literal">d</code>, <code class="literal">a</code>, and
              <code class="literal">b</code> in table <code class="literal">t1</code>, in
              which there are five distinct values:
              (<code class="literal">10,11,1,1</code>),
              (<code class="literal">10,11,1,2</code>),
              (<code class="literal">10,11,1,3</code>),
              (<code class="literal">10,12,1,4</code>) and
              (<code class="literal">10,12,1,5</code>). The counted columns
              (<code class="literal">c,d,a,b</code>) are shown in the
              <code class="literal">stat_description</code> column of the result
              set.
</p></li></ul>
</div>
<p>
          For the unique index (<code class="literal">i2uniq</code>), there are
          two <code class="literal">n_diff%</code> rows.
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              Where
              <code class="literal">index_name</code>=<code class="literal">i2uniq</code>
              and
              <code class="literal">stat_name</code>=<code class="literal">n_diff_pfx01</code>,
              the <code class="literal">stat_value</code> is <code class="literal">2</code>,
              which indicates that there are two distinct values in the
              first column of the index (column <code class="literal">e</code>).
              The number of distinct values in column
              <code class="literal">e</code> is confirmed by viewing the data in
              column <code class="literal">e</code> in table
              <code class="literal">t1</code>, in which there are two distinct
              values: (<code class="literal">100</code>) and
              (<code class="literal">200</code>). The counted column
              (<code class="literal">e</code>) is shown in the
              <code class="literal">stat_description</code> column of the result
              set.
            </p></li><li class="listitem"><p>
              Where
              <code class="literal">index_name</code>=<code class="literal">i2uniq</code>
              and
              <code class="literal">stat_name</code>=<code class="literal">n_diff_pfx02</code>,
              the <code class="literal">stat_value</code> is <code class="literal">5</code>,
              which indicates that there are five distinct values in the
              two columns of the index (<code class="literal">e,f</code>). The
              number of distinct values in columns <code class="literal">e</code>
              and <code class="literal">f</code> is confirmed by viewing the data
              in columns <code class="literal">e</code> and <code class="literal">f</code>
              in table <code class="literal">t1</code>, in which there are five
              distinct values: (<code class="literal">100,101</code>),
              (<code class="literal">200,102</code>),
              (<code class="literal">100,103</code>), (<code class="literal">200,104</code>)
              and (<code class="literal">100,105</code>). The counted columns
              (<code class="literal">e,f</code>) are shown in the
              <code class="literal">stat_description</code> column of the result
              set.
</p></li></ul>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h5 class="title"><a name="innodb-persistent-stats-tables-index-size"></a>14.3.11.1.6 Retrieving Index Size Using the innodb_index_stats Table</h5>

</div>

</div>

</div>
<p>
          The size of indexes for tables, partitions, or subpartitions
          can be retrieved using the
          <code class="literal">innodb_index_stats</code> table. In the following
          example, index sizes are retrieved for table
          <code class="literal">t1</code>. For a definition of table
          <code class="literal">t1</code> and corresponding index statistics, see
          <a class="xref" href="innodb-storage-engine.html#innodb-persistent-stats-tables-example" title="14.3.11.1.5 InnoDB Persistent Statistics Tables Example">Section 14.3.11.1.5, “InnoDB Persistent Statistics Tables Example”</a>.
        </p><pre class="programlisting">mysql&gt; SELECT SUM(stat_value) pages, index_name,
    -&gt; SUM(stat_value)*@@innodb_page_size size
    -&gt; FROM mysql.innodb_index_stats WHERE table_name='t1'
    -&gt; AND stat_name = 'size' GROUP BY index_name;
+-------+------------+-------+
| pages | index_name | size  |
+-------+------------+-------+
|     1 | PRIMARY    | 16384 |
|     1 | i1         | 16384 |
|     1 | i2uniq     | 16384 |
+-------+------------+-------+</pre><p>
          For partitions or subpartitions, the same query with a
          modified <code class="literal">WHERE</code> clause can be used to
          retrieve index sizes. For example, the following query
          retrieves index sizes for partitions of table
          <code class="literal">t1</code>:
        </p><pre class="programlisting">mysql&gt; SELECT SUM(stat_value) pages, index_name,
    -&gt; SUM(stat_value)*@@innodb_page_size size
    -&gt; FROM mysql.innodb_index_stats WHERE table_name like 't1#P%'
-&gt; AND stat_name = 'size' GROUP BY index_name;     </pre>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="innodb-statistics-estimation"></a>14.3.11.2 Configuring Non-Persistent Optimizer Statistics Parameters</h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140644114625696"></a><a class="indexterm" name="idm140644114624624"></a><a class="indexterm" name="idm140644114623584"></a><a class="indexterm" name="idm140644114622080"></a><p>
        This section describes how to configure non-persistent optimizer
        statistics. Optimizer statistics are not persisted to disk when
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_stats_persistent"><code class="literal">innodb_stats_persistent=OFF</code></a> or
        when individual tables are created or altered with
        <a class="link" href="sql-syntax.html#create-table" title="13.1.18 CREATE TABLE Syntax"><code class="literal">STATS_PERSISTENT=0</code></a>.
        Instead, statistics are stored in memory, and are lost when the
        server is shut down. Statistics are also updated periodically by
        certain operations and under certain conditions.
      </p><p>
        As of MySQL 5.6.6, optimizer statistics are persisted to disk by
        default, enabled by the
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_stats_persistent"><code class="literal">innodb_stats_persistent</code></a>
        configuration option. For information about persistent optimizer
        statistics, see <a class="xref" href="innodb-storage-engine.html#innodb-persistent-stats" title="14.3.11.1 Configuring Persistent Optimizer Statistics Parameters">Section 14.3.11.1, “Configuring Persistent Optimizer Statistics Parameters”</a>.
</p>
<h5><a name="innodb-statistics-estimation-update"></a>Optimizer Statistics Updates</h5>
<p>
        Optimizer statistics are updated when:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            Running <a class="link" href="sql-syntax.html#analyze-table" title="13.7.2.1 ANALYZE TABLE Syntax"><code class="literal">ANALYZE TABLE</code></a>.
          </p></li><li class="listitem"><p>
            Running <a class="link" href="sql-syntax.html#show-table-status" title="13.7.5.36 SHOW TABLE STATUS Syntax"><code class="literal">SHOW TABLE STATUS</code></a>,
            <a class="link" href="sql-syntax.html#show-index" title="13.7.5.22 SHOW INDEX Syntax"><code class="literal">SHOW INDEX</code></a>, or querying the
            <a class="link" href="information-schema.html#tables-table" title="21.24 The INFORMATION_SCHEMA TABLES Table"><code class="literal">INFORMATION_SCHEMA.TABLES</code></a> or
            <a class="link" href="information-schema.html#statistics-table" title="21.23 The INFORMATION_SCHEMA STATISTICS Table"><code class="literal">INFORMATION_SCHEMA.STATISTICS</code></a>
            tables with the
            <a class="link" href="innodb-storage-engine.html#sysvar_innodb_stats_on_metadata"><code class="literal">innodb_stats_on_metadata</code></a>
            option enabled.
          </p><p>
            The default setting for
            <a class="link" href="innodb-storage-engine.html#sysvar_innodb_stats_on_metadata"><code class="literal">innodb_stats_on_metadata</code></a>
            was changed to <code class="literal">OFF</code> when persistent
            optimizer statistics were enabled by default in MySQL 5.6.6.
            Enabling
            <a class="link" href="innodb-storage-engine.html#sysvar_innodb_stats_on_metadata"><code class="literal">innodb_stats_on_metadata</code></a>
            may reduce access speed for schemas that have a large number
            of tables or indexes, and reduce stability of execution
            plans for queries that involve <code class="literal">InnoDB</code>
            tables.
            <a class="link" href="innodb-storage-engine.html#sysvar_innodb_stats_on_metadata"><code class="literal">innodb_stats_on_metadata</code></a> is
            configured globally using a
            <a class="link" href="data-types.html#set" title="11.4.5 The SET Type"><code class="literal">SET</code></a> statement.
          </p><pre class="programlisting">SET GLOBAL innodb_stats_on_metadata=ON</pre></li><li class="listitem"><p>
            Starting a <a class="link" href="programs.html#mysql" title="4.5.1 mysql — The MySQL Command-Line Tool"><span class="command"><strong>mysql</strong></span></a> client with the
            <a class="link" href="programs.html#option_mysql_auto-rehash"><code class="option">--auto-rehash</code></a> option enabled,
            which is the default. The
            <a class="link" href="programs.html#option_mysql_auto-rehash"><code class="option">auto-rehash</code></a> option causes all
            <code class="literal">InnoDB</code> tables to be opened, and the open
            table operations cause statistics to be recalculated.
          </p><p>
            To improve the start up time of the <a class="link" href="programs.html#mysql" title="4.5.1 mysql — The MySQL Command-Line Tool"><span class="command"><strong>mysql</strong></span></a>
            client and to updating statistics, you can turn off
            <a class="link" href="programs.html#option_mysql_auto-rehash"><code class="option">auto-rehash</code></a> using the
            <a class="link" href="programs.html#option_mysql_auto-rehash"><code class="option">--disable-auto-rehash</code></a>
            option. The <a class="link" href="programs.html#option_mysql_auto-rehash"><code class="option">auto-rehash</code></a>
            feature enables automatic name completion of database,
            table, and column names for interactive users.
          </p></li><li class="listitem"><p>
            A table is first opened.
          </p></li><li class="listitem"><p>
            <code class="literal">InnoDB</code> detects that 1 / 16 of table has
            been modified since the last time statistics were updated.
</p></li></ul>
</div>
<h5><a name="idm140644114583808"></a>Configuring the Number of Sampled Pages</h5>
<p>
        The MySQL query optimizer uses estimated
        <a class="link" href="glossary.html#glos_statistics" title="statistics">statistics</a> about key
        distributions to choose the indexes for an execution plan, based
        on the relative
        <a class="link" href="glossary.html#glos_selectivity" title="selectivity">selectivity</a> of the
        index. When <code class="literal">InnoDB</code> updates optimizer
        statistics, it samples random pages from each index on a table
        to estimate the
        <a class="link" href="glossary.html#glos_cardinality" title="cardinality">cardinality</a> of the
        index. (This technique is known as
        <a class="link" href="glossary.html#glos_random_dive" title="random dive">random dives</a>.)
      </p><p>
        To give you control over the quality of the statistics estimate
        (and thus better information for the query optimizer), you can
        change the number of sampled pages using the parameter
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_stats_transient_sample_pages"><code class="literal">innodb_stats_transient_sample_pages</code></a>.
        The default number of sampled pages is 8, which could be
        insufficient to produce an accurate estimate, leading to poor
        index choices by the query optimizer. This technique is
        especially important for large tables and tables used in
        <a class="link" href="glossary.html#glos_join" title="join">joins</a>. Unnecessary
        <a class="link" href="glossary.html#glos_full_table_scan" title="full table scan">full table scans</a> for
        such tables can be a substantial performance issue. See
        <a class="xref" href="optimization.html#how-to-avoid-table-scan" title="8.2.1.20 How to Avoid Full Table Scans">Section 8.2.1.20, “How to Avoid Full Table Scans”</a> for tips on tuning
        such queries.
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_stats_transient_sample_pages"><code class="literal">innodb_stats_transient_sample_pages</code></a>
        is a global parameter that can be set at runtime.
      </p><p>
        The value of
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_stats_transient_sample_pages"><code class="literal">innodb_stats_transient_sample_pages</code></a>
        affects the index sampling for all <code class="literal">InnoDB</code>
        tables and indexes when
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_stats_persistent"><code class="literal">innodb_stats_persistent=0</code></a>. Be
        aware of the following potentially significant impacts when you
        change the index sample size:

</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              Small values like 1 or 2 can result in inaccurate
              estimates of cardinality.
            </p></li><li class="listitem"><p>
              Increasing the
              <a class="link" href="innodb-storage-engine.html#sysvar_innodb_stats_transient_sample_pages"><code class="literal">innodb_stats_transient_sample_pages</code></a>
              value might require more disk reads. Values much larger
              than 8 (say, 100), can cause a significant slowdown in the
              time it takes to open a table or execute <code class="literal">SHOW
              TABLE STATUS</code>.
            </p></li><li class="listitem"><p>
              The optimizer might choose very different query plans
              based on different estimates of index selectivity.
</p></li></ul>
</div>
<p>
      </p><p>
        Whatever value of
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_stats_transient_sample_pages"><code class="literal">innodb_stats_transient_sample_pages</code></a>
        works best for a system, set the option and leave it at that
        value. Choose a value that results in reasonably accurate
        estimates for all tables in your database without requiring
        excessive I/O. Because the statistics are automatically
        recalculated at various times other than on execution of
        <a class="link" href="sql-syntax.html#analyze-table" title="13.7.2.1 ANALYZE TABLE Syntax"><code class="literal">ANALYZE TABLE</code></a>, it does not make
        sense to increase the index sample size, run
        <a class="link" href="sql-syntax.html#analyze-table" title="13.7.2.1 ANALYZE TABLE Syntax"><code class="literal">ANALYZE TABLE</code></a>, then decrease
        sample size again.
      </p><p>
        Smaller tables generally require fewer index samples than larger
        tables. If your database has many large tables, consider using a
        higher value for
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_stats_transient_sample_pages"><code class="literal">innodb_stats_transient_sample_pages</code></a>
        than if you have mostly smaller tables.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="innodb-analyze-table-complexity"></a>14.3.11.3 Estimating ANALYZE TABLE Complexity for InnoDB Tables</h4>

</div>

</div>

</div>
<p>
        <a class="link" href="sql-syntax.html#analyze-table" title="13.7.2.1 ANALYZE TABLE Syntax"><code class="literal">ANALYZE TABLE</code></a> complexity for
        <code class="literal">InnoDB</code> tables is dependent on:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            The number of pages sampled, as defined by
            <a class="link" href="innodb-storage-engine.html#sysvar_innodb_stats_persistent_sample_pages"><code class="literal">innodb_stats_persistent_sample_pages</code></a>.
          </p></li><li class="listitem"><p>
            The number of indexed columns in a table
          </p></li><li class="listitem"><p>
            The number of partitions. If a table has no partitions, the
            number of partitions is considered to be 1.
</p></li></ul>
</div>
<p>
        Using these parameters, an approximate formula for estimating
        <a class="link" href="sql-syntax.html#analyze-table" title="13.7.2.1 ANALYZE TABLE Syntax"><code class="literal">ANALYZE TABLE</code></a> complexity would
        be:
      </p><p>
        The value of
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_stats_persistent_sample_pages"><code class="literal">innodb_stats_persistent_sample_pages</code></a>
        * number of indexed columns in a table * the number of
        partitions
      </p><p>
        Typically, the greater the resulting value, the greater the
        execution time for <a class="link" href="sql-syntax.html#analyze-table" title="13.7.2.1 ANALYZE TABLE Syntax"><code class="literal">ANALYZE TABLE</code></a>.
</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_stats_persistent_sample_pages"><code class="literal">innodb_stats_persistent_sample_pages</code></a>
          defines the number of pages sampled at a global level. To set
          the number of pages sampled for an individual table, use the
          <code class="literal">STATS_SAMPLE_PAGES</code> option with
          <a class="link" href="sql-syntax.html#create-table" title="13.1.18 CREATE TABLE Syntax"><code class="literal">CREATE TABLE</code></a> or
          <a class="link" href="sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a>. For more
          information, see <a class="xref" href="innodb-storage-engine.html#innodb-persistent-stats" title="14.3.11.1 Configuring Persistent Optimizer Statistics Parameters">Section 14.3.11.1, “Configuring Persistent Optimizer Statistics Parameters”</a>.
        </p><p>
          If
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_stats_persistent"><code class="literal">innodb_stats_persistent=OFF</code></a>,
          the number of pages sampled is defined by
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_stats_transient_sample_pages"><code class="literal">innodb_stats_transient_sample_pages</code></a>.
          See <a class="xref" href="innodb-storage-engine.html#innodb-statistics-estimation" title="14.3.11.2 Configuring Non-Persistent Optimizer Statistics Parameters">Section 14.3.11.2, “Configuring Non-Persistent Optimizer Statistics Parameters”</a> for
          additional information.
</p>
</div>
<p>
        For a more in-depth approach to estimating <code class="literal">ANALYZE
        TABLE</code> complexity, consider the following example.
      </p><p>
        In <a class="ulink" href="http://en.wikipedia.org/wiki/Big_O_notation" target="_top">Big
        O notation</a>, <a class="link" href="sql-syntax.html#analyze-table" title="13.7.2.1 ANALYZE TABLE Syntax"><code class="literal">ANALYZE TABLE</code></a>
        complexity is described as:
      </p><pre class="programlisting"> O(n_sample
  * (n_cols_in_uniq_i
     + n_cols_in_non_uniq_i
     + n_cols_in_pk * (1 + n_non_uniq_i))
  * n_part)          </pre><p>
        where:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <code class="literal">n_sample</code> is the number of pages sampled
            (defined by
            <a class="link" href="innodb-storage-engine.html#sysvar_innodb_stats_persistent_sample_pages"><code class="literal">innodb_stats_persistent_sample_pages</code></a>)
          </p></li><li class="listitem"><p>
            <code class="literal">n_cols_in_uniq_i</code> is total number of all
            columns in all unique indexes (not counting the primary key
            columns)
          </p></li><li class="listitem"><p>
            <code class="literal">n_cols_in_non_uniq_i</code> is the total number
            of all columns in all non-unique indexes
          </p></li><li class="listitem"><p>
            <code class="literal">n_cols_in_pk</code> is the number of columns in
            the primary key (if a primary key is not defined,
            <code class="literal">InnoDB</code> creates a single column primary
            key internally)
          </p></li><li class="listitem"><p>
            <code class="literal">n_non_uniq_i</code> is the number of non-unique
            indexes in the table
          </p></li><li class="listitem"><p>
            <code class="literal">n_part</code> is the number of partitions. If no
            partitions are defined, the table is considered to be a
            single partition.
</p></li></ul>
</div>
<p>
        Now, consider the following table (table <code class="literal">t</code>),
        which has a primary key (2 columns), a unique index (2 columns),
        and two non-unique indexes (two columns each):
      </p><pre class="programlisting"> CREATE TABLE t (
  a INT,
  b INT,
  c INT,
  d INT,
  e INT,
  f INT,
  g INT,
  h INT,
  PRIMARY KEY (a, b),
  UNIQUE KEY i1uniq (c, d),
  KEY i2nonuniq (e, f),
  KEY i3nonuniq (g, h)
);    </pre><p>
        For the column and index data required by the algorithm
        described above, query the
        <code class="literal">mysql.innodb_index_stats</code> persistent index
        statistics table for table <code class="literal">t</code>. The
        <code class="literal">n_diff_pfx%</code> statistics show the columns that
        are counted for each index. For example, columns
        <code class="literal">a</code> and <code class="literal">b</code> are counted for
        the primary key index. For the non-unique indexes, the primary
        key columns (a,b) are counted in addition to the user defined
        columns.
</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
          For additional information about the <code class="literal">InnoDB</code>
          persistent statistics tables, see
          <a class="xref" href="innodb-storage-engine.html#innodb-persistent-stats" title="14.3.11.1 Configuring Persistent Optimizer Statistics Parameters">Section 14.3.11.1, “Configuring Persistent Optimizer Statistics Parameters”</a>
</p>
</div>
<pre class="programlisting">  SELECT index_name, stat_name, stat_description
  FROM mysql.innodb_index_stats
  WHERE
  database_name='test' AND
  table_name='t' AND
  stat_name like 'n_diff_pfx%';

  +------------+--------------+------------------+
  | index_name | stat_name    | stat_description |
  +------------+--------------+------------------+
  | PRIMARY    | n_diff_pfx01 | a                |
  | PRIMARY    | n_diff_pfx02 | a,b              |
  | i1uniq     | n_diff_pfx01 | c                |
  | i1uniq     | n_diff_pfx02 | c,d              |
  | i2nonuniq  | n_diff_pfx01 | e                |
  | i2nonuniq  | n_diff_pfx02 | e,f              |
  | i2nonuniq  | n_diff_pfx03 | e,f,a            | 
  | i2nonuniq  | n_diff_pfx04 | e,f,a,b          |
  | i3nonuniq  | n_diff_pfx01 | g                |
  | i3nonuniq  | n_diff_pfx02 | g,h              |
  | i3nonuniq  | n_diff_pfx03 | g,h,a            |
  | i3nonuniq  | n_diff_pfx04 | g,h,a,b          |
  +------------+--------------+------------------+   </pre><p>
        Based on the index statistics data shown above and the table
        definition, the following values can be determined:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <code class="literal">n_cols_in_uniq_i</code>, the total number of all
            columns in all unique indexes not counting the primary key
            columns, is 2 (<code class="literal">c</code> and
            <code class="literal">d</code>)
          </p></li><li class="listitem"><p>
            <code class="literal">n_cols_in_non_uniq_i</code>, the total number of
            all columns in all non-unique indexes, is 4
            (<code class="literal">e</code>, <code class="literal">f</code>,
            <code class="literal">g</code> and <code class="literal">h</code>)
          </p></li><li class="listitem"><p>
            <code class="literal">n_cols_in_pk</code>, the number of columns in
            the primary key, is 2 (<code class="literal">a</code> and
            <code class="literal">b</code>)
          </p></li><li class="listitem"><p>
            <code class="literal">n_non_uniq_i</code>, the number of non-unique
            indexes in the table, is 2 (<code class="literal">i2nonuniq</code> and
            <code class="literal">i3nonuniq</code>))
          </p></li><li class="listitem"><p>
            <code class="literal">n_part</code>, the number of partitions, is 1.
</p></li></ul>
</div>
<p>
        You can now calculate
        <code class="literal">innodb_stats_persistent_sample_pages</code> * (2 + 4
        + 2 * (1 + 2)) * 1 to determine the number of leaf pages that
        are scanned. With
        <code class="literal">innodb_stats_persistent_sample_pages</code> set to
        the default value of <code class="literal">20</code>, and with a default
        page size of 16 <code class="literal">KiB</code>
        (<a class="link" href="innodb-storage-engine.html#sysvar_innodb_page_size"><code class="literal">innodb_page_size</code></a>=16384), you
        can then estimate that 20 * 12 * 16384 <code class="literal">bytes</code>
        are read for table <code class="literal">t</code>, or about 4
        <code class="literal">MiB</code>.
</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
          All 4 <code class="literal">MiB</code> may not be read from disk, as
          some leaf pages may already be cached in the buffer pool.
</p>
</div>

</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="index-page-merge-threshold"></a>14.3.12 Configuring the Merge Threshold for Index Pages</h3>

</div>

</div>

</div>
<p>
      Staring in MySQL 5.7.6, you can configure the
      <code class="literal">MERGE_THRESHOLD</code> value for index pages. If the
      <span class="quote">“<span class="quote">page-full</span>”</span> percentage for an index page falls below
      the <code class="literal">MERGE_THRESHOLD</code> value when a row is deleted
      or when a row is shortened by an
      <a class="link" href="sql-syntax.html#update" title="13.2.11 UPDATE Syntax"><code class="literal">UPDATE</code></a> operation,
      <code class="literal">InnoDB</code> attempts to merge the index page with a
      neighboring index page. The default
      <code class="literal">MERGE_THRESHOLD</code> value is 50, which is the
      previously hardcoded value. The minimum
      <code class="literal">MERGE_THRESHOLD</code> value is 1 and the maximum
      value is 50.
    </p><p>
      When the <span class="quote">“<span class="quote">page-full</span>”</span> percentage for an index page
      falls below 50%, which is the default
      <code class="literal">MERGE_THRESHOLD</code> setting,
      <code class="literal">InnoDB</code> attempts to merge the index page with a
      neighboring page. If both pages are close to 50% full, a page
      split can occur soon after the pages are merged. If this
      merge-split behavior occurs frequently, it can have an adverse
      affect on performance. To avoid frequent merge-splits, you can
      lower the <code class="literal">MERGE_THRESHOLD</code> value so that
      <code class="literal">InnoDB</code> attempts page merges at a lower
      <span class="quote">“<span class="quote">page-full</span>”</span> percentage. Merging pages at a lower
      page-full percentage leaves more room in index pages and helps
      reduce merge-split behavior.
    </p><p>
      The <code class="literal">MERGE_THRESHOLD</code> for index pages can be
      defined for a table or for individual indexes. A
      <code class="literal">MERGE_THRESHOLD</code> value defined for an individual
      index takes priority over a <code class="literal">MERGE_THRESHOLD</code>
      value defined for the table. If undefined, the
      <code class="literal">MERGE_THRESHOLD</code> value defaults to 50.
</p>
<h4><a name="idm140644114466736"></a>Setting MERGE_THRESHOLD for a Table</h4>
<p>
      You can set the <code class="literal">MERGE_THRESHOLD</code> value for a
      table using the <em class="replaceable"><code>table_option</code></em>
      <code class="literal">COMMENT</code> clause of the
      <a class="link" href="sql-syntax.html#create-table" title="13.1.18 CREATE TABLE Syntax"><code class="literal">CREATE TABLE</code></a> statement. For
      example:
    </p><pre class="programlisting">CREATE TABLE t1 (
   id INT,
  KEY id_index (id)
) COMMENT='MERGE_THRESHOLD=45';</pre><p>
      You can also set the <code class="literal">MERGE_THRESHOLD</code> value for
      an existing table using the
      <em class="replaceable"><code>table_option</code></em> <code class="literal">COMMENT</code>
      clause with <a class="link" href="sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a>:
    </p><pre class="programlisting">CREATE TABLE t1 (
   id INT,
  KEY id_index (id)
);

ALTER TABLE t1 COMMENT='MERGE_THRESHOLD=40';    </pre>
<h4><a name="idm140644114457408"></a>Setting MERGE_THRESHOLD for Individual Indexes</h4>
<p>
      To set the <code class="literal">MERGE_THRESHOLD</code> value for an
      individual index, you can use the
      <em class="replaceable"><code>index_option</code></em> <code class="literal">COMMENT</code>
      clause with <a class="link" href="sql-syntax.html#create-table" title="13.1.18 CREATE TABLE Syntax"><code class="literal">CREATE TABLE</code></a>,
      <a class="link" href="sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a>, or
      <a class="link" href="sql-syntax.html#create-index" title="13.1.14 CREATE INDEX Syntax"><code class="literal">CREATE INDEX</code></a>, as shown in the
      following examples:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          Setting <code class="literal">MERGE_THRESHOLD</code> for an individual
          index using <a class="link" href="sql-syntax.html#create-table" title="13.1.18 CREATE TABLE Syntax"><code class="literal">CREATE TABLE</code></a>:
        </p><pre class="programlisting">CREATE TABLE t1 (
   id INT,
  KEY id_index (id) COMMENT 'MERGE_THRESHOLD=40'
);</pre></li><li class="listitem"><p>
          Setting <code class="literal">MERGE_THRESHOLD</code> for an individual
          index using <a class="link" href="sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a>:
        </p><pre class="programlisting">CREATE TABLE t1 (
   id INT,
  KEY id_index (id)
);

ALTER TABLE t1 DROP KEY id_index;
ALTER TABLE t1 ADD KEY id_index (id) COMMENT 'MERGE_THRESHOLD=40';</pre></li><li class="listitem"><p>
          Setting <code class="literal">MERGE_THRESHOLD</code> for an individual
          index using <a class="link" href="sql-syntax.html#create-index" title="13.1.14 CREATE INDEX Syntax"><code class="literal">CREATE INDEX</code></a>:
        </p><pre class="programlisting">CREATE TABLE t1 (id INT);
CREATE INDEX id_index ON t1 (id) COMMENT 'MERGE_THRESHOLD=40';</pre></li></ul>
</div>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">
<div class="admon-title">
Note
</div>
<p>
        You cannot modify the <code class="literal">MERGE_THRESHOLD</code> value
        at the index level for <code class="literal">GEN_CLUST_INDEX</code>, which
        is the clustered index created by <code class="literal">InnoDB</code> when
        an <code class="literal">InnoDB</code> table is created without a primary
        key or unique key index. You can only modify the
        <code class="literal">MERGE_THRESHOLD</code> value for
        <code class="literal">GEN_CLUST_INDEX</code> by setting
        <code class="literal">MERGE_THRESHOLD</code> for the table.
</p>
</div>
<h4><a name="idm140644114433536"></a>Querying the MERGE_THRESHOLD Value for an Index</h4>
<p>
      The current <code class="literal">MERGE_THRESHOLD</code> value for an index
      can be obtained by querying the
      <a class="link" href="information-schema.html#innodb-sys-indexes-table" title="21.31.8 The INFORMATION_SCHEMA INNODB_SYS_INDEXES Table"><code class="literal">INNODB_SYS_INDEXES</code></a> table. For
      example:
    </p><pre class="programlisting">mysql&gt; SELECT * FROM INFORMATION_SCHEMA.INNODB_SYS_INDEXES WHERE NAME='id_index' \G
*************************** 1. row ***************************
       INDEX_ID: 91
           NAME: id_index
       TABLE_ID: 68
           TYPE: 0
       N_FIELDS: 1
        PAGE_NO: 4
          SPACE: 57
MERGE_THRESHOLD: 40</pre><p>
      You can use <a class="link" href="sql-syntax.html#show-create-table" title="13.7.5.10 SHOW CREATE TABLE Syntax"><code class="literal">SHOW CREATE TABLE</code></a> to
      view the <code class="literal">MERGE_THRESHOLD</code> value for a table, if
      explicitly defined using the
      <em class="replaceable"><code>table_option</code></em> <code class="literal">COMMENT</code>
      clause:
    </p><pre class="programlisting">mysql&gt; SHOW CREATE TABLE t2 \G
*************************** 1. row ***************************
       Table: t2
Create Table: CREATE TABLE `t2` (
  `id` int(11) DEFAULT NULL,
  KEY `id_index` (`id`) COMMENT 'MERGE_THRESHOLD=40'
) ENGINE=InnoDB DEFAULT CHARSET=latin1</pre>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
        A <code class="literal">MERGE_THRESHOLD</code> value defined at the index
        level takes priority over a <code class="literal">MERGE_THRESHOLD</code>
        value defined for the table. If undefined,
        <code class="literal">MERGE_THRESHOLD</code> defaults to 50%
        (<code class="literal">MERGE_THRESHOLD=50</code>, which is the previously
        hardcoded value.
</p>
</div>
<p>
      Likewise, you can use <a class="link" href="sql-syntax.html#show-index" title="13.7.5.22 SHOW INDEX Syntax"><code class="literal">SHOW INDEX</code></a> to
      view the <code class="literal">MERGE_THRESHOLD</code> value for an index, if
      explicitly defined using the
      <em class="replaceable"><code>index_option</code></em> <code class="literal">COMMENT</code>
      clause:
    </p><pre class="programlisting">mysql&gt; SHOW INDEX FROM t2 \G
*************************** 1. row ***************************
        Table: t2
   Non_unique: 1
     Key_name: id_index
 Seq_in_index: 1
  Column_name: id
    Collation: A
  Cardinality: 0
     Sub_part: NULL
       Packed: NULL
         Null: YES
   Index_type: BTREE
      Comment: 
Index_comment: MERGE_THRESHOLD=40</pre>
<h4><a name="idm140644114415440"></a>Measuring the Effect of MERGE_THRESHOLD Settings</h4>
<p>
      The <a class="link" href="information-schema.html#innodb-metrics-table" title="21.31.20 The INFORMATION_SCHEMA INNODB_METRICS Table"><code class="literal">INNODB_METRICS</code></a> table provides two
      counters that can be used to measure the effect of a
      <code class="literal">MERGE_THRESHOLD</code> setting on index page merges.
    </p><pre class="programlisting">mysql&gt; SELECT NAME, COMMENT FROM INFORMATION_SCHEMA.INNODB_METRICS 
WHERE NAME like '%index_page_merge%';
+-----------------------------+----------------------------------------+
| NAME                        | COMMENT                                |
+-----------------------------+----------------------------------------+
| index_page_merge_attempts   | Number of index page merge attempts    |
| index_page_merge_successful | Number of successful index page merges |
+-----------------------------+----------------------------------------+</pre><p>
      When lowering the <code class="literal">MERGE_THRESHOLD</code> value, the
      objectives are:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          A smaller number of page merge attempts and successful page
          merges
        </p></li><li class="listitem"><p>
          A similar number of page merge attempts and successful page
          merges
</p></li></ul>
</div>
<p>
      A <code class="literal">MERGE_THRESHOLD</code> setting that is too small
      could result in large data files due to an excessive amount of
      empty page space.
    </p><p>
      For information about using
      <a class="link" href="information-schema.html#innodb-metrics-table" title="21.31.20 The INFORMATION_SCHEMA INNODB_METRICS Table"><code class="literal">INNODB_METRICS</code></a> counters, see
      <a class="xref" href="innodb-storage-engine.html#innodb-information-schema-metrics-table" title="14.12.6 InnoDB INFORMATION_SCHEMA Metrics Table">Section 14.12.6, “InnoDB INFORMATION_SCHEMA Metrics Table”</a>.
</p>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="innodb-tablespace"></a>14.4 InnoDB Tablespace Management</h2>

</div>

</div>

</div>
<div class="toc">
<dl class="toc"><dt><span class="section"><a href="innodb-storage-engine.html#innodb-resize-system-tablespace">14.4.1 Resizing the InnoDB System Tablespace</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-data-log-reconfiguration">14.4.2 Changing the Number or Size of InnoDB Redo Log Files</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-raw-devices">14.4.3 Using Raw Disk Partitions for the System Tablespace</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-multiple-tablespaces">14.4.4 InnoDB File-Per-Table Tablespaces</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#tablespace-placing">14.4.5 Creating a File-Per-Table Tablespace Outside the Data Directory</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#tablespace-copying">14.4.6 Copying File-Per-Table Tablespaces to Another Server</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-undo-tablespace">14.4.7 Storing InnoDB Undo Logs in Separate Tablespaces</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#truncate-undo-tablespace">14.4.8 Truncating Undo Logs That Reside in Undo Tablespaces</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#general-tablespaces">14.4.9 InnoDB General Tablespaces</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-tablespace-encryption">14.4.10 InnoDB Tablespace Encryption</a></span></dt></dl>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="innodb-resize-system-tablespace"></a>14.4.1 Resizing the InnoDB System Tablespace</h3>

</div>

</div>

</div>
<a class="indexterm" name="idm140644114400912"></a><p>
      This section describes how to increase or decrease the size of the
      <code class="literal">InnoDB</code> system tablespace.
</p>
<h4><a name="idm140644114398240"></a>Increasing the Size of the InnoDB System Tablespace</h4>
<p>
      The easiest way to increase the size of the
      <code class="literal">InnoDB</code> system tablespace is to configure it
      from the beginning to be auto-extending. Specify the
      <code class="literal">autoextend</code> attribute for the last data file in
      the tablespace definition. Then <code class="literal">InnoDB</code>
      increases the size of that file automatically in 8MB increments
      when it runs out of space. The increment size can be changed by
      setting the value of the
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_autoextend_increment"><code class="literal">innodb_autoextend_increment</code></a>
      system variable, which is measured in megabytes.
    </p><p>
      You can expand the system tablespace by a defined amount by adding
      another data file:
</p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p>
          Shut down the MySQL server.
        </p></li><li class="listitem"><p>
          If the previous last data file is defined with the keyword
          <code class="literal">autoextend</code>, change its definition to use a
          fixed size, based on how large it has actually grown. Check
          the size of the data file, round it down to the closest
          multiple of 1024 × 1024 bytes (= 1MB), and specify this
          rounded size explicitly in
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_data_file_path"><code class="literal">innodb_data_file_path</code></a>.
        </p></li><li class="listitem"><p>
          Add a new data file to the end of
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_data_file_path"><code class="literal">innodb_data_file_path</code></a>,
          optionally making that file auto-extending. Only the last data
          file in the
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_data_file_path"><code class="literal">innodb_data_file_path</code></a> can be
          specified as auto-extending.
        </p></li><li class="listitem"><p>
          Start the MySQL server again.
</p></li></ol>
</div>
<p>
      For example, this tablespace has just one auto-extending data file
      <code class="filename">ibdata1</code>:
    </p><pre class="programlisting">
innodb_data_home_dir =
innodb_data_file_path = /ibdata/ibdata1:10M:autoextend
</pre><p>
      Suppose that this data file, over time, has grown to 988MB. Here
      is the configuration line after modifying the original data file
      to use a fixed size and adding a new auto-extending data file:
    </p><pre class="programlisting">
innodb_data_home_dir =
innodb_data_file_path = /ibdata/ibdata1:988M;/disk2/ibdata2:50M:autoextend
</pre><p>
      When you add a new data file to the system tablespace
      configuration, make sure that the filename does not refer to an
      existing file. <code class="literal">InnoDB</code> creates and initializes
      the file when you restart the server.
</p>
<h4><a name="idm140644114378528"></a>Decreasing the Size of the InnoDB System Tablespace</h4>
<p>
      You cannot remove a data file from the system tablespace. To
      decrease the system tablespace size, use this procedure:
</p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p>
          Use <a class="link" href="programs.html#mysqldump" title="4.5.4 mysqldump — A Database Backup Program"><span class="command"><strong>mysqldump</strong></span></a> to dump all your
          <code class="literal">InnoDB</code> tables, including
          <code class="literal">InnoDB</code> tables located in the MySQL
          database. As of 5.6, there are five <code class="literal">InnoDB</code>
          tables included in the MySQL database:
        </p><pre class="programlisting">
mysql&gt; select table_name from information_schema.tables where table_schema='mysql' and engine='InnoDB';
+----------------------+
| table_name           |
+----------------------+
| innodb_index_stats   |
| innodb_table_stats   |
| slave_master_info    |
| slave_relay_log_info |
| slave_worker_info    |
+----------------------+
5 rows in set (0.00 sec)
      </pre></li><li class="listitem"><p>
          Stop the server.
        </p></li><li class="listitem"><p>
          Remove all the existing tablespace files
          (<code class="filename">*.ibd</code>), including the
          <code class="filename">ibdata</code> and <code class="filename">ib_log</code>
          files. Do not forget to remove <code class="filename">*.ibd</code>
          files for tables located in the MySQL database.
        </p></li><li class="listitem"><p>
          Remove any <code class="filename">.frm</code> files for
          <code class="literal">InnoDB</code> tables.
        </p></li><li class="listitem"><p>
          Configure a new tablespace.
        </p></li><li class="listitem"><p>
          Restart the server.
        </p></li><li class="listitem"><p>
          Import the dump files.
</p></li></ol>
</div>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">
<div class="admon-title">
Note
</div>
<p>
        If your databases only use the <code class="literal">InnoDB</code> engine,
        it may be simpler to dump <span class="bold"><strong>all</strong></span>
        databases, stop the server, remove all databases and
        <code class="literal">InnoDB</code> log files, restart the server, and
        import the dump files.
</p>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="innodb-data-log-reconfiguration"></a>14.4.2 Changing the Number or Size of InnoDB Redo Log Files</h3>

</div>

</div>

</div>
<a class="indexterm" name="idm140644114356816"></a><a class="indexterm" name="idm140644114355328"></a><p>
      To change the number or the size of your <code class="literal">InnoDB</code>
      <a class="link" href="glossary.html#glos_redo_log" title="redo log">redo log</a> files, perform the
      following steps:
</p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p>
          Stop the MySQL server and make sure that it shuts down without
          errors.
        </p></li><li class="listitem"><p>
          Edit <code class="filename">my.cnf</code> to change the log file
          configuration. To change the log file size, configure
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_log_file_size"><code class="literal">innodb_log_file_size</code></a>. To
          increase the number of log files, configure
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_log_files_in_group"><code class="literal">innodb_log_files_in_group</code></a>.
        </p></li><li class="listitem"><p>
          Start the MySQL server again.
</p></li></ol>
</div>
<p>
      If <code class="literal">InnoDB</code> detects that the
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_log_file_size"><code class="literal">innodb_log_file_size</code></a> differs from
      the redo log file size, it will write a log checkpoint, close and
      remove the old log files, create new log files at the requested
      size, and open the new log files.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="innodb-raw-devices"></a>14.4.3 Using Raw Disk Partitions for the System Tablespace</h3>

</div>

</div>

</div>
<a class="indexterm" name="idm140644114341520"></a><a class="indexterm" name="idm140644114340064"></a><p>
      You can use raw disk partitions as data files in the
      <code class="literal">InnoDB</code>
      <a class="link" href="glossary.html#glos_system_tablespace" title="system tablespace">system tablespace</a>.
      This technique enables nonbuffered I/O on Windows and on some
      Linux and Unix systems without file system overhead. Perform tests
      with and without raw partitions to verify whether this change
      actually improves performance on your system.
    </p><p>
      When you use a raw disk partition, ensure that the user ID that
      runs the MySQL server has read and write privileges for that
      partition. For example, if you run the server as the
      <code class="literal">mysql</code> user, the partition must be readable and
      writeable by <code class="literal">mysql</code>. If you run the server with
      the <a class="link" href="server-administration.html#option_mysqld_memlock"><code class="option">--memlock</code></a> option, the server
      must be run as <code class="literal">root</code>, so the partition must be
      readable and writeable by <code class="literal">root</code>.
    </p><p>
      The procedures described below involve option file modification.
      For additional information, see <a class="xref" href="programs.html#option-files" title="4.2.6 Using Option Files">Section 4.2.6, “Using Option Files”</a>.
</p>
<h4><a name="idm140644114331024"></a>Allocating a Raw Disk Partition on Linux and Unix Systems</h4>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p>
          When you create a new data file, specify the keyword
          <code class="literal">newraw</code> immediately after the data file size
          for the <a class="link" href="innodb-storage-engine.html#sysvar_innodb_data_file_path"><code class="literal">innodb_data_file_path</code></a>
          option. The partition must be at least as large as the size
          that you specify. Note that 1MB in <code class="literal">InnoDB</code>
          is 1024 × 1024 bytes, whereas 1MB in disk specifications
          usually means 1,000,000 bytes.
        </p><pre class="programlisting">
[mysqld]
innodb_data_home_dir=
innodb_data_file_path=/dev/hdd1:3Gnewraw;/dev/hdd2:2Gnewraw
</pre></li><li class="listitem"><p>
          Restart the server. <code class="literal">InnoDB</code> notices the
          <code class="literal">newraw</code> keyword and initializes the new
          partition. However, do not create or change any
          <code class="literal">InnoDB</code> tables yet. Otherwise, when you next
          restart the server, <code class="literal">InnoDB</code> reinitializes
          the partition and your changes are lost. (As a safety measure
          <code class="literal">InnoDB</code> prevents users from modifying data
          when any partition with <code class="literal">newraw</code> is
          specified.)
        </p></li><li class="listitem"><p>
          After <code class="literal">InnoDB</code> has initialized the new
          partition, stop the server, change <code class="literal">newraw</code>
          in the data file specification to <code class="literal">raw</code>:
        </p><pre class="programlisting">
[mysqld]
innodb_data_home_dir=
innodb_data_file_path=/dev/hdd1:3Graw;/dev/hdd2:2Graw
</pre></li><li class="listitem"><p>
          Restart the server. <code class="literal">InnoDB</code> now permits
          changes to be made.
</p></li></ol>
</div>
<h4><a name="idm140644114313824"></a>Allocating a Raw Disk Partition on Windows</h4>
<p>
      On Windows systems, the same steps and accompanying guidelines
      described for Linux and Unix systems apply except that the
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_data_file_path"><code class="literal">innodb_data_file_path</code></a> setting
      differs slightly on Windows.
</p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p>
          When you create a new data file, specify the keyword
          <code class="literal">newraw</code> immediately after the data file size
          for the <a class="link" href="innodb-storage-engine.html#sysvar_innodb_data_file_path"><code class="literal">innodb_data_file_path</code></a>
          option:
        </p><pre class="programlisting">
[mysqld]
innodb_data_home_dir=
innodb_data_file_path=//./D::10Gnewraw
</pre><p>
          The <code class="filename">//./</code> corresponds to the Windows
          syntax of <code class="filename">\\.\</code> for accessing physical
          drives. In the example above, <code class="literal">D:</code> is the
          drive letter of the partition.
        </p></li><li class="listitem"><p>
          Restart the server. <code class="literal">InnoDB</code> notices the
          <code class="literal">newraw</code> keyword and initializes the new
          partition.
        </p></li><li class="listitem"><p>
          After <code class="literal">InnoDB</code> has initialized the new
          partition, stop the server, change <code class="literal">newraw</code>
          in the data file specification to <code class="literal">raw</code>:
        </p><pre class="programlisting">
[mysqld]
innodb_data_home_dir=
innodb_data_file_path=//./D::10Graw
</pre></li><li class="listitem"><p>
          Restart the server. <code class="literal">InnoDB</code> now permits
          changes to be made.
</p></li></ol>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="innodb-multiple-tablespaces"></a>14.4.4 InnoDB File-Per-Table Tablespaces</h3>

</div>

</div>

</div>
<div class="toc">
<dl class="toc"><dt><span class="section"><a href="innodb-storage-engine.html#tablespace-enabling">14.4.4.1 Enabling and Disabling File-Per-Table Tablespaces</a></span></dt></dl>
</div>
<a class="indexterm" name="idm140644114295088"></a><a class="indexterm" name="idm140644114293600"></a><a class="indexterm" name="idm140644114292528"></a><p>
      Historically, all <code class="literal">InnoDB</code> tables and indexes
      were stored in the <a class="link" href="glossary.html#glos_system_tablespace" title="system tablespace">system
      tablespace</a>. This monolithic approach was targeted at
      machines dedicated entirely to database processing, with carefully
      planned data growth, where any disk storage allocated to MySQL
      would never be needed for other purposes.
      <code class="literal">InnoDB</code>'s
      <a class="link" href="glossary.html#glos_file_per_table" title="file-per-table">file-per-table
      tablespace</a> feature provides a more flexible alternative,
      where each <code class="literal">InnoDB</code> table and its indexes are
      stored in a separate
      <a class="link" href="glossary.html#glos_ibd_file" title=".ibd file"><code class="literal">.ibd</code></a> data
      file. Each such
      <a class="link" href="glossary.html#glos_ibd_file" title=".ibd file"><code class="literal">.ibd</code></a> data
      file represents an individual
      <a class="link" href="glossary.html#glos_tablespace" title="tablespace">tablespace</a>. This feature is
      controlled by the
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_per_table"><code class="literal">innodb_file_per_table</code></a>
      configuration option, which is enabled by default in MySQL 5.6.6
      and higher.
</p>
<h4><a name="idm140644114282064"></a>Advantages of File-Per-Table Tablespaces</h4>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          You can reclaim disk space when truncating or dropping a table
          stored in a file-per-table tablepace. Truncating or dropping
          tables stored in the system tablespace creates free space
          internally in the system tablespace data files
          (<a class="link" href="glossary.html#glos_ibdata_file" title="ibdata file">ibdata files</a>) which
          can only be used for new <code class="literal">InnoDB</code> data.
        </p></li><li class="listitem"><p>
          The <a class="link" href="sql-syntax.html#truncate-table" title="13.1.34 TRUNCATE TABLE Syntax"><code class="literal">TRUNCATE TABLE</code></a> operation is
          faster when run on tables stored in file-per-table tablepaces.
        </p></li><li class="listitem"><p>
          You can store specific tables on separate storage devices, for
          I/O optimization, space management, or backup purposes. In
          previous releases, you had to move entire database directories
          to other drives and create symbolic links in the MySQL data
          directory, as described in <a class="xref" href="optimization.html#symbolic-links" title="8.12.4 Using Symbolic Links">Section 8.12.4, “Using Symbolic Links”</a>.
          In MySQL 5.6.6 and higher, you can specify the location of
          each table using the syntax <code class="literal">CREATE TABLE ... DATA
          DIRECTORY =
          <em class="replaceable"><code>absolute_path_to_directory</code></em></code>,
          as explained in <a class="xref" href="innodb-storage-engine.html#tablespace-placing" title="14.4.5 Creating a File-Per-Table Tablespace Outside the Data Directory">Section 14.4.5, “Creating a File-Per-Table Tablespace Outside the Data Directory”</a>.
        </p></li><li class="listitem"><p>
          You can run <a class="link" href="sql-syntax.html#optimize-table" title="13.7.2.4 OPTIMIZE TABLE Syntax"><code class="literal">OPTIMIZE TABLE</code></a> to
          compact or recreate a file-per-table tablespace. When you run
          an <a class="link" href="sql-syntax.html#optimize-table" title="13.7.2.4 OPTIMIZE TABLE Syntax"><code class="literal">OPTIMIZE TABLE</code></a>,
          <code class="literal">InnoDB</code> creates a new
          <code class="filename">.ibd</code> file with a temporary name, using
          only the space required to store actual data. When the
          optimization is complete, <code class="literal">InnoDB</code> removes
          the old <code class="filename">.ibd</code> file and replaces it with
          the new one. If the previous <code class="filename">.ibd</code> file
          grew significantly but the actual data only accounted for a
          portion of its size, running <a class="link" href="sql-syntax.html#optimize-table" title="13.7.2.4 OPTIMIZE TABLE Syntax"><code class="literal">OPTIMIZE
          TABLE</code></a> can reclaim the unused space.
        </p></li><li class="listitem"><p>
          You can move individual <code class="literal">InnoDB</code> tables
          rather than entire databases.
        </p></li><li class="listitem"><p>
          You can copy individual <code class="literal">InnoDB</code> tables from
          one MySQL instance to another (known as the
          <a class="link" href="glossary.html#glos_transportable_tablespace" title="transportable tablespace">transportable
          tablespace</a> feature).
        </p></li><li class="listitem"><p>
          Tables created in file-per-table tablespaces use the
          <a class="link" href="glossary.html#glos_barracuda" title="Barracuda">Barracuda</a> file format.
          The Barracuda file format enables features such as
          <a class="link" href="glossary.html#glos_compressed_row_format" title="compressed row format">compressed</a>
          and <a class="link" href="glossary.html#glos_dynamic_row_format" title="dynamic row format">dynamic</a> row
          formats.
        </p></li><li class="listitem"><p>
          You can enable more efficient storage for tables with large
          <code class="literal">BLOB</code> or <code class="literal">TEXT</code> columns
          using the <a class="link" href="glossary.html#glos_dynamic_row_format" title="dynamic row format">dynamic row
          format</a>.
        </p></li><li class="listitem"><p>
          File-per-table tablespaces may improve chances for a
          successful recovery and save time when a corruption occurs,
          when a server cannot be restarted, or when backup and binary
          logs are unavailable.
        </p></li><li class="listitem"><p>
          File-per-table tablespaces are convenient for per-table status
          reporting when copying or backing up tables.
        </p></li><li class="listitem"><p>
          You can monitor table size at a file system level, without
          accessing MySQL.
        </p></li><li class="listitem"><p>
          Common Linux file systems do not permit concurrent writes to a
          single file when
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_flush_method"><code class="literal">innodb_flush_method</code></a> is set to
          <code class="literal">O_DIRECT</code>. As a result, there are possible
          performance improvements when using file-per-table tablespaces
          in conjunction with
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_flush_method"><code class="literal">innodb_flush_method</code></a>.
        </p></li><li class="listitem"><p>
          The system tablespace stores the data dictionary and undo
          logs, and has a 64TB size limit. By comparison, each
          file-per-table tablespace has a 64TB size limit, which
          provides you with room for growth. See
          <a class="xref" href="restrictions.html#table-size-limit" title="C.10.3 Limits on Table Size">Section C.10.3, “Limits on Table Size”</a> for related information.
</p></li></ul>
</div>
<h4><a name="idm140644114243296"></a>Potential Disadvantages of File-Per-Table Tablespaces</h4>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          With file-per-table tablespaces, each table may have unused
          space, which can only be utilized by rows of the same table.
          This could lead to wasted space if not properly managed.
        </p></li><li class="listitem"><p>
          <code class="literal">fsync</code> operations must run on each open
          table rather than on a single file. Because there is a
          separate <code class="literal">fsync</code> operation for each file,
          write operations on multiple tables cannot be combined into a
          single I/O operation. This may require
          <code class="literal">InnoDB</code> to perform a higher total number of
          <code class="literal">fsync</code> operations.
        </p></li><li class="listitem"><p>
          <a class="link" href="programs.html#mysqld" title="4.3.1 mysqld — The MySQL Server"><span class="command"><strong>mysqld</strong></span></a> must keep one open file handle per
          table, which may impact performance if you have numerous
          tables in file-per-table tablespaces.
        </p></li><li class="listitem"><p>
          More file descriptors are used.
        </p></li><li class="listitem"><p>
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_per_table"><code class="literal">innodb_file_per_table</code></a> is
          enabled by default in MySQL 5.6.6 and higher. You may consider
          disabling it if backward compatibility with MySQL 5.5 or 5.1
          is a concern. Disabling
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_per_table"><code class="literal">innodb_file_per_table</code></a>
          prevents <a class="link" href="sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a> from
          moving an <code class="literal">InnoDB</code> table from the system
          tablespace to an individual <code class="filename">.ibd</code> file in
          cases where <a class="link" href="sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a>
          recreates the table (<code class="literal">ALGORITHM=COPY</code>).
        </p><p>
          For example, when restructuring the clustered index for an
          <code class="literal">InnoDB</code> table, the table is re-created using
          the current setting for
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_per_table"><code class="literal">innodb_file_per_table</code></a>. This
          behavior does not apply when adding or dropping
          <code class="literal">InnoDB</code> secondary indexes. When a secondary
          index is created without rebuilding the table, the index is
          stored in the same file as the table data, regardless of the
          current <a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_per_table"><code class="literal">innodb_file_per_table</code></a>
          setting. This behavior also does not apply to tables added to
          the system tablespace using
          <a class="link" href="sql-syntax.html#create-table" title="13.1.18 CREATE TABLE Syntax"><code class="literal">CREATE TABLE ...
          TABLESPACE</code></a> or
          <a class="link" href="sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE Syntax"><code class="literal">ALTER TABLE ...
          TABLESPACE</code></a> syntax. These tables are not affected by
          the <a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_per_table"><code class="literal">innodb_file_per_table</code></a>
          setting.
        </p></li><li class="listitem"><p>
          If many tables are growing there is potential for more
          fragmentation which can impede <a class="link" href="sql-syntax.html#drop-table" title="13.1.29 DROP TABLE Syntax"><code class="literal">DROP
          TABLE</code></a> and table scan performance. However, when
          fragmentation is managed, having files in their own tablespace
          can improve performance.
        </p></li><li class="listitem"><p>
          The buffer pool is scanned when dropping a file-per-table
          tablespace, which can take several seconds for buffer pools
          that are tens of gigabytes in size. The scan is performed with
          a broad internal lock, which may delay other operations.
          Tables in the system tablespace are not affected.
        </p></li><li class="listitem"><p>
          The
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_autoextend_increment"><code class="literal">innodb_autoextend_increment</code></a>
          variable, which defines increment size (in MB) for extending
          the size of an auto-extending shared tablespace file when it
          becomes full, does not apply to file-per-table tablespace
          files, which are auto-extending regardless of the
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_autoextend_increment"><code class="literal">innodb_autoextend_increment</code></a>
          setting. The initial extensions are by small amounts, after
          which extensions occur in increments of 4MB.
</p></li></ul>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="tablespace-enabling"></a>14.4.4.1 Enabling and Disabling File-Per-Table Tablespaces</h4>

</div>

</div>

</div>
<p>
        The <a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_per_table"><code class="literal">innodb_file_per_table</code></a>
        option is enabled by default as of MySQL 5.6.6.
      </p><p>
        To set the
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_per_table"><code class="literal">innodb_file_per_table</code></a> option at
        startup, start the server with the
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_per_table"><code class="option">--innodb_file_per_table</code></a>
        command-line option, or add this line to the
        <code class="literal">[mysqld]</code> section of
        <code class="filename">my.cnf</code>:
      </p><pre class="programlisting">
[mysqld]
innodb_file_per_table=1
</pre><p>
        You can also set
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_per_table"><code class="literal">innodb_file_per_table</code></a>
        dynamically, while the server is running:
      </p><pre class="programlisting">
SET GLOBAL innodb_file_per_table=1;
</pre><p>
        With <a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_per_table"><code class="literal">innodb_file_per_table</code></a>
        enabled, you can store <code class="literal">InnoDB</code> tables in a
        <code class="filename"><em class="replaceable"><code>tbl_name</code></em>.ibd</code>
        file. Unlike the <code class="literal">MyISAM</code> storage engine, with
        its separate
        <code class="filename"><em class="replaceable"><code>tbl_name</code></em>.MYD</code> and
        <code class="filename"><em class="replaceable"><code>tbl_name</code></em>.MYI</code>
        files for indexes and data, <code class="literal">InnoDB</code> stores the
        data and the indexes together in a single
        <code class="filename">.ibd</code> file. The
        <code class="filename"><em class="replaceable"><code>tbl_name</code></em>.frm</code>
        file is still created as usual.
      </p><p>
        If you disable
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_per_table"><code class="literal">innodb_file_per_table</code></a> in your
        startup options and restart the server, or disable it with the
        <code class="literal">SET GLOBAL</code> command, <code class="literal">InnoDB</code>
        creates new tables inside the system tablespace unless you have
        explicitly placed the table in file-per-table tablespace or
        general tablespace using the
        <a class="link" href="sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE Syntax"><code class="literal">CREATE TABLE ...
        TABLESPACE</code></a> option, introduced in MySQL 5.7.6.
      </p><p>
        You can always read and write any <code class="literal">InnoDB</code>
        tables, regardless of the file-per-table setting.
      </p><p>
        To move a table from the system tablespace to its own
        tablespace, change the
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_per_table"><code class="literal">innodb_file_per_table</code></a> setting
        and rebuild the table:
      </p><pre class="programlisting">SET GLOBAL innodb_file_per_table=1;
ALTER TABLE <em class="replaceable"><code>table_name</code></em> ENGINE=InnoDB;</pre><p>
        Tables added to the system tablespace using
        <a class="link" href="sql-syntax.html#create-table" title="13.1.18 CREATE TABLE Syntax"><code class="literal">CREATE TABLE ...
        TABLESPACE</code></a> or
        <a class="link" href="sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE Syntax"><code class="literal">ALTER TABLE ...
        TABLESPACE</code></a> syntax are not affected by the
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_per_table"><code class="literal">innodb_file_per_table</code></a> setting.
        To move these tables from the system tablespace to a
        file-per-table tablespace, they must be moved explicitly using
        <a class="link" href="sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE Syntax"><code class="literal">ALTER TABLE ...
        TABLESPACE</code></a> syntax.
</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
          <code class="literal">InnoDB</code> always needs the system tablespace
          because it puts its internal
          <a class="link" href="glossary.html#glos_data_dictionary" title="data dictionary">data dictionary</a>
          and <a class="link" href="glossary.html#glos_undo_log" title="undo log">undo logs</a> there. The
          <code class="filename">.ibd</code> files are not sufficient for
          <code class="literal">InnoDB</code> to operate.
        </p><p>
          When a table is moved out of the system tablespace into its
          own <code class="filename">.ibd</code> file, the data files that make
          up the system tablespace remain the same size. The space
          formerly occupied by the table can be reused for new
          <code class="literal">InnoDB</code> data, but is not reclaimed for use
          by the operating system. When moving large
          <code class="literal">InnoDB</code> tables out of the system tablespace,
          where disk space is limited, you may prefer to enable
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_per_table"><code class="literal">innodb_file_per_table</code></a> and
          recreate the entire instance using the
          <a class="link" href="programs.html#mysqldump" title="4.5.4 mysqldump — A Database Backup Program"><span class="command"><strong>mysqldump</strong></span></a> command. As mentioned above,
          tables added to the system tablespace using
          <a class="link" href="sql-syntax.html#create-table" title="13.1.18 CREATE TABLE Syntax"><code class="literal">CREATE TABLE ...
          TABLESPACE</code></a> or
          <a class="link" href="sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE Syntax"><code class="literal">ALTER TABLE ...
          TABLESPACE</code></a> syntax are not affected by the
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_per_table"><code class="literal">innodb_file_per_table</code></a>
          setting. These tables must be moved individually.
</p>
</div>

</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="tablespace-placing"></a>14.4.5 Creating a File-Per-Table Tablespace Outside the Data Directory</h3>

</div>

</div>

</div>
<p>
      To create a new <code class="literal">InnoDB</code>
      <a class="link" href="glossary.html#glos_file_per_table" title="file-per-table">file-per-table</a>
      tablespace in a specific location outside the MySQL data
      directory, use the <code class="literal">DATA DIRECTORY =
      <em class="replaceable"><code>absolute_path_to_directory</code></em></code>
      clause of the <a class="link" href="sql-syntax.html#create-table" title="13.1.18 CREATE TABLE Syntax"><code class="literal">CREATE TABLE</code></a>
      statement.
    </p><p>
      Plan the location in advance, because you cannot use the
      <code class="literal">DATA DIRECTORY</code> clause with the
      <a class="link" href="sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a> statement. The
      directory you specify could be on another storage device with
      particular performance or capacity characteristics, such as a fast
      <a class="link" href="glossary.html#glos_ssd" title="SSD">SSD</a> or a high-capacity
      <a class="link" href="glossary.html#glos_hdd" title="HDD">HDD</a>.
    </p><p>
      Within the destination directory, MySQL creates a subdirectory
      corresponding to the database name, and within that a
      <a class="link" href="glossary.html#glos_ibd_file" title=".ibd file">.ibd file</a> for the new table.
      In the database directory beneath the MySQL
      <a class="link" href="server-administration.html#sysvar_datadir"><code class="literal">DATADIR</code></a> directory, MySQL creates
      a <code class="filename"><em class="replaceable"><code>table_name</code></em>.isl</code>
      file containing the path name for the table. The
      <a class="link" href="glossary.html#glos_isl_file" title=".isl file">.isl file</a> is treated by MySQL
      like a symbolic link. (<a class="link" href="optimization.html#symbolic-links" title="8.12.4 Using Symbolic Links">Using actual
      symbolic links</a> has never been supported for
      <code class="literal">InnoDB</code> tables.)
    </p><p>
      The following example demonstrates creating a file-per-table
      tablespace outside the MySQL data directory. It shows the
      <code class="filename">.ibd</code> created in the specified directory, and
      the <code class="filename">.isl</code> created in the database directory
      beneath the MySQL data directory.
    </p><pre class="programlisting">mysql&gt; USE test;
Database changed

mysql&gt; SHOW VARIABLES LIKE 'innodb_file_per_table';
+-----------------------+-------+
| Variable_name         | Value |
+-----------------------+-------+
| innodb_file_per_table | ON    |
+-----------------------+-------+
1 row in set (0.00 sec)

mysql&gt; CREATE TABLE t1 (c1 INT PRIMARY KEY) DATA DIRECTORY = '/alternative/directory';
Query OK, 0 rows affected (0.03 sec)

# MySQL creates a .ibd file for the new table in a subdirectory that corresponding  
# to the database name

db_user@ubuntu:~/alternative/directory/test$ ls
t1.ibd

# MySQL creates a .isl file containing the path name for the table in a directory 
# beneath the MySQL data directory

db_user@ubuntu:~/mysql/data/test$ ls
db.opt  t1.frm  t1.isl</pre><p>
      As of MySQL 5.7.6, you can also use
      <a class="link" href="sql-syntax.html#create-table" title="13.1.18 CREATE TABLE Syntax"><code class="literal">CREATE TABLE ...
      TABLESPACE</code></a> in combination with the <code class="literal">DATA
      DIRECTORY</code> clause to create a file-per-table tablespace
      outside the MySQL data directory. To do so, you must specify
      <code class="literal">innodb_file_per_table</code> as the tablespace name.
    </p><pre class="programlisting">CREATE TABLE t2 (c1 INT PRIMARY KEY) TABLESPACE = innodb_file_per_table 
  DATA DIRECTORY = '/alternative/directory';</pre><p>
      You do not have to enable
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_per_table"><code class="literal">innodb_file_per_table</code></a> when using
      this method.
</p>
<h4><a name="idm140644114135632"></a>Usage Notes:</h4>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          MySQL initially holds the <code class="literal">.ibd</code> file open,
          preventing you from dismounting the device, but might
          eventually close the table if the server is busy. Be careful
          not to accidentally dismount an external device while MySQL is
          running, or to start MySQL while the device is disconnected.
          Attempting to access a table when the associated
          <code class="literal">.ibd</code> file is missing causes a serious error
          that requires a server restart.
        </p><p>
          A server restart might fail if the <code class="literal">.ibd</code>
          file is still not at the expected path. In this case, manually
          remove the
          <code class="literal"><em class="replaceable"><code>table_name</code></em>.isl</code>
          file in the database directory, and after restarting perform a
          <a class="link" href="sql-syntax.html#drop-table" title="13.1.29 DROP TABLE Syntax"><code class="literal">DROP TABLE</code></a> to delete the
          <code class="literal">.frm</code> file and remove the information about
          the table from the <a class="link" href="glossary.html#glos_data_dictionary" title="data dictionary">data
          dictionary</a>.
        </p></li><li class="listitem"><p>
          Do not put MySQL tables on an NFS-mounted volume. NFS uses a
          message-passing protocol to write to files, which could cause
          data inconsistency if network messages are lost or received
          out of order.
        </p></li><li class="listitem"><p>
          If you use an LVM snapshot, file copy, or other file-based
          mechanism to back up the <code class="literal">.ibd</code> file, always
          use the <a class="link" href="sql-syntax.html#flush" title="13.7.6.3 FLUSH Syntax"><code class="literal">FLUSH TABLES
          ... FOR EXPORT</code></a> statement first to make sure all
          changes that were buffered in memory are
          <a class="link" href="glossary.html#glos_flush" title="flush">flushed</a> to disk before the
          backup occurs.
        </p></li><li class="listitem"><p>
          The <code class="literal">DATA DIRECTORY</code> clause is a supported
          alternative to <a class="link" href="optimization.html#symbolic-links" title="8.12.4 Using Symbolic Links">using symbolic
          links</a>, which has always been problematic and was never
          supported for individual <code class="literal">InnoDB</code> tables.
</p></li></ul>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="tablespace-copying"></a>14.4.6 Copying File-Per-Table Tablespaces to Another Server</h3>

</div>

</div>

</div>
<div class="toc">
<dl class="toc"><dt><span class="section"><a href="innodb-storage-engine.html#innodb-transportable-tablespace-examples">14.4.6.1 Transportable Tablespace Examples</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-transportable-tablespace-internals">14.4.6.2 Transportable Tablespace Internals</a></span></dt></dl>
</div>
<a class="indexterm" name="idm140644114117344"></a><p>
      This section describes how to copy
      <a class="link" href="glossary.html#glos_file_per_table" title="file-per-table">file-per-table</a>
      tablespaces from one database server to another, otherwise known
      as the <a class="link" href="glossary.html#glos_transportable_tablespace" title="transportable tablespace">Transportable
      Tablespaces</a> feature. Prior to MySQL 5.7.4, only
      non-partitioned <code class="literal">InnoDB</code> tables are supported. As
      of MySQL 5.7.4, partitioned <code class="literal">InnoDB</code> tables and
      individual <code class="literal">InnoDB</code> table partitions and
      subpartitions are also supported.
    </p><p>
      For information about other <code class="literal">InnoDB</code> table
      copying methods, see <a class="xref" href="innodb-storage-engine.html#innodb-migration" title="14.5.2 Moving or Copying InnoDB Tables to Another Machine">Section 14.5.2, “Moving or Copying InnoDB Tables to Another Machine”</a>.
    </p><p>
      There are many reasons why you might copy an
      <code class="literal">InnoDB</code>
      <a class="link" href="glossary.html#glos_file_per_table" title="file-per-table">file-per-table</a>
      tablespace to a different database server:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          To run reports without putting extra load on a production
          server.
        </p></li><li class="listitem"><p>
          To set up identical data for a table on a new
          <a class="link" href="glossary.html#glos_slave_server" title="slave server">slave server</a>.
        </p></li><li class="listitem"><p>
          To restore a backed-up version of a table or partition after a
          problem or mistake.
        </p></li><li class="listitem"><p>
          As a faster way of moving data around than importing the
          results of a <a class="link" href="programs.html#mysqldump" title="4.5.4 mysqldump — A Database Backup Program"><span class="command"><strong>mysqldump</strong></span></a> command. The data is
          available immediately, rather than having to be re-inserted
          and the indexes rebuilt.
        </p></li><li class="listitem"><p>
          To move a
          <a class="link" href="glossary.html#glos_file_per_table" title="file-per-table">file-per-table</a>
          tablespace to a server with storage medium that better suits
          system requirements. For example, you may want to have busy
          tables on an <a class="link" href="glossary.html#glos_ssd" title="SSD">SSD</a> device, or
          large tables on a high-capacity
          <a class="link" href="glossary.html#glos_hdd" title="HDD">HDD</a> device.
</p></li></ul>
</div>
<h4><a name="innodb-transportable-tablespace-limitations"></a>Limitations and Usage Notes</h4>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          The tablespace copy procedure is only possible when
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_per_table"><code class="literal">innodb_file_per_table</code></a> is set
          to <code class="literal">ON</code>, which is the default setting as of
          MySQL 5.6.6. Tables residing in the shared system tablespace
          cannot be quiesced.
        </p></li><li class="listitem"><p>
          When a table is quiesced, only read-only transactions are
          allowed on the affected table.
        </p></li><li class="listitem"><p>
          When importing a tablespace, the page size must match the page
          size of the importing instance.
        </p></li><li class="listitem"><p>
          Prior to MySQL 5.7.4, <code class="literal">DISCARD TABLESPACE</code> is
          not supported for partitioned tables meaning that
          transportable tablespaces is also unsupported. If you run
          <a class="link" href="sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE Syntax"><code class="literal">ALTER
          TABLE ... DISCARD TABLESPACE</code></a> on a partitioned table,
          the following error is returned: <span class="errortext">ERROR 1031
          (HY000): Table storage engine for 'part' doesn't have this
          option</span>. As of MySQL 5.7.4,
          <a class="link" href="sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE Syntax"><code class="literal">ALTER
          TABLE ... DISCARD TABLESPACE</code></a> is supported for
          partitioned <code class="literal">InnoDB</code> tables, and
          <a class="link" href="sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE Syntax"><code class="literal">ALTER
          TABLE ... DISCARD PARTITION ... TABLESPACE</code></a> is
          supported for <code class="literal">InnoDB</code> table partitions.
        </p></li><li class="listitem"><p>
          <code class="literal">DISCARD TABLESPACE</code> is not supported for
          tablespaces with a parent-child (primary key-foreign key)
          relationship when
          <a class="link" href="server-administration.html#sysvar_foreign_key_checks"><code class="literal">foreign_key_checks</code></a> is set to
          <code class="literal">1</code>. Before discarding a tablespace for
          parent-child tables, set
          <code class="literal">foreign_key_checks=0</code>. Partitioned
          <code class="literal">InnoDB</code> tables do not support foreign keys.
        </p></li><li class="listitem"><p>
          <a class="link" href="sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE Syntax"><code class="literal">ALTER TABLE ...
          IMPORT TABLESPACE</code></a> does not enforce foreign key
          constraints on imported data. If there are foreign key
          constraints between tables, all tables should be exported at
          the same (logical) point in time. Partitioned
          <code class="literal">InnoDB</code> tables do not support foreign keys.
        </p></li><li class="listitem"><p>
          <a class="link" href="sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE Syntax"><code class="literal">ALTER TABLE ...
          IMPORT TABLESPACE</code></a> and
          <a class="link" href="sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE Syntax"><code class="literal">ALTER
          TABLE ... IMPORT PARTITION ... TABLESPACE</code></a> do not
          require a <code class="filename">.cfg</code> metadata file to import a
          tablespace. However, metadata checks are not performed when
          importing without a <code class="filename">.cfg</code> file, and a
          warning similar to the following will be issued:
        </p><pre class="programlisting">
Message: InnoDB: IO Read error: (2, No such file or directory) Error opening '.\
test\t.cfg', will attempt to import without schema verification
1 row in set (0.00 sec) 
</pre><p>
          The ability to import without a <code class="filename">.cfg</code> file
          may be more convenient when no schema mismatches are expected.
          Additionally, the ability to import without a
          <code class="filename">.cfg</code> file could be useful in crash
          recovery scenarios in which metadata cannot be collected from
          an <code class="filename">.ibd</code> file.
        </p></li><li class="listitem"><p>
          Due to a <code class="literal">.cfg</code> metadata file limitation,
          schema mismatches are not reported for partition type or
          partition definition differences when importing tablespace
          files for partitioned tables. Column differences are reported.
        </p></li><li class="listitem"><p>
          When running
          <a class="link" href="sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE Syntax"><code class="literal">ALTER TABLE ...
          DISCARD PARTITION ... TABLESPACE</code></a> and
          <a class="link" href="sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE Syntax"><code class="literal">ALTER TABLE ...
          IMPORT PARTITION ... TABLESPACE</code></a> on subpartitioned
          tables, both partition and subpartition table names are
          allowed. When a partition name is specified, subpartitions of
          that partition are included in the operation.
        </p></li><li class="listitem"><p>
          In MySQL 5.6 or later, importing a tablespace file from
          another server works if both servers have GA (General
          Availability) status and their versions are within the same
          series. Otherwise, the file must have been created on the
          server into which it is imported.
        </p></li><li class="listitem"><p>
          In replication scenarios,
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_per_table"><code class="literal">innodb_file_per_table</code></a> must be
          set to <code class="literal">ON</code> on both the master and slave.
        </p></li><li class="listitem"><p>
          On Windows, <code class="literal">InnoDB</code> stores database,
          tablespace, and table names internally in lowercase. To avoid
          import problems on case-sensitive operating systems such as
          Linux and UNIX, create all databases, tablespaces, and tables
          using lowercase names. A convenient way to accomplish this is
          to add the following line to the <code class="literal">[mysqld]</code>
          section of your <code class="filename">my.cnf</code> or
          <code class="filename">my.ini</code> file before creating databases,
          tablespaces, or tables:
        </p><pre class="programlisting">
[mysqld]
lower_case_table_names=1
</pre></li><li class="listitem"><p>
          <a class="link" href="sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE Syntax"><code class="literal">ALTER TABLE ...
          DISCARD TABLESPACE</code></a> and
          <a class="link" href="sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE Syntax"><code class="literal">ALTER TABLE
          ...IMPORT TABLESPACE</code></a> are not supported with tables
          that belong to an <code class="literal">InnoDB</code> general
          tablespace. For more information, see
          <a class="link" href="sql-syntax.html#create-tablespace" title="13.1.19 CREATE TABLESPACE Syntax"><code class="literal">CREATE TABLESPACE</code></a>.
        </p></li><li class="listitem"><p>
          As of MySQL 5.7.9, the default row format for
          <code class="literal">InnoDB</code> tables is configurable using the
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_default_row_format"><code class="literal">innodb_default_row_format</code></a>
          configuration option. Attempting to import a table that does
          not explicitly define a row format
          (<code class="literal">ROW_FORMAT</code>), or that uses
          <code class="literal">ROW_FORMAT=DEFAULT</code>, could result in a
          schema mismatch error if the
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_default_row_format"><code class="literal">innodb_default_row_format</code></a>
          setting on the source server differs from the setting on the
          destination server. For related information, see
          <a class="xref" href="innodb-storage-engine.html#innodb-row-format-specification" title="14.8.2 Specifying the Row Format for a Table">Section 14.8.2, “Specifying the Row Format for a Table”</a>.
        </p></li><li class="listitem"><p>
          When exporting a tablespace that is encrypted using the
          <code class="literal">InnoDB</code> tablespace encryption feature,
          <code class="literal">InnoDB</code> generates a
          <code class="filename">.cfp</code> file in addition to a
          <code class="filename">.cfg</code> metadata file. The
          <code class="filename">.cfp</code> file must be copied to the
          destination server together with the <code class="filename">.cfg</code>
          file and tablespace file before performing the
          <a class="link" href="sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE Syntax"><code class="literal">ALTER TABLE ...
          IMPORT TABLESPACE</code></a> operation on the destination
          server. The <code class="filename">.cfp</code> file contains a transfer
          key and an encrypted tablespace key. On import,
          <code class="literal">InnoDB</code> uses the transfer key to decrypt the
          tablespace key. For related information, see
          <a class="xref" href="innodb-storage-engine.html#innodb-tablespace-encryption" title="14.4.10 InnoDB Tablespace Encryption">Section 14.4.10, “InnoDB Tablespace Encryption”</a>.
</p></li></ul>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="innodb-transportable-tablespace-examples"></a>14.4.6.1 Transportable Tablespace Examples</h4>

</div>

</div>

</div>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">
<div class="admon-title">
Note
</div>
<p>
          If you are transporting tables that are encrypted using the
          <code class="literal">InnoDB</code> tablespace encryption, see
          <a class="xref" href="innodb-storage-engine.html#innodb-transportable-tablespace-limitations" title="Limitations and Usage Notes">Limitations and Usage Notes</a>
          before you begin for additional procedural information.
</p>
</div>
<h5><a name="idm140644114028720"></a>Example 1: Copying an InnoDB Table From One Server To Another</h5>
<p>
        This procedure demonstrates how to copy a regular
        <code class="literal">InnoDB</code> table from a running MySQL server
        instance to another running instance. The same procedure with
        minor adjustments can be used to perform a full table restore on
        the same instance.
</p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p>
            On the source server, create a table if one does not exist:
          </p><pre class="programlisting">
mysql&gt; use test;
mysql&gt; CREATE TABLE t(c1 INT) engine=InnoDB;
</pre></li><li class="listitem"><p>
            On the destination server, create a table if one does not
            exist:
          </p><pre class="programlisting">
mysql&gt; use test;
mysql&gt; CREATE TABLE t(c1 INT) engine=InnoDB;
</pre></li><li class="listitem"><p>
            On the destination server, discard the existing tablespace.
            (Before a tablespace can be imported,
            <code class="literal">InnoDB</code> must discard the tablespace that
            is attached to the receiving table.)
          </p><pre class="programlisting">
mysql&gt; ALTER TABLE t DISCARD TABLESPACE;
</pre></li><li class="listitem"><p>
            On the source server, run
            <a class="link" href="sql-syntax.html#flush" title="13.7.6.3 FLUSH Syntax"><code class="literal">FLUSH
            TABLES ... FOR EXPORT</code></a> to quiesce the table and
            create the <code class="filename">.cfg</code> metadata file:
          </p><pre class="programlisting">
mysql&gt; use test;
mysql&gt; FLUSH TABLES t FOR EXPORT;
</pre><p>
            The metadata (<code class="filename">.cfg</code>) is created in the
            <code class="literal">InnoDB</code> data directory.
</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
              <a class="link" href="sql-syntax.html#flush" title="13.7.6.3 FLUSH Syntax"><code class="literal">FLUSH TABLES ...
              FOR EXPORT</code></a> is available as of MySQL 5.6.6. The
              statement ensures that changes to the named table have
              been flushed to disk so that a binary table copy can be
              made while the server is running. When
              <a class="link" href="sql-syntax.html#flush" title="13.7.6.3 FLUSH Syntax"><code class="literal">FLUSH
              TABLES ... FOR EXPORT</code></a> is run,
              <code class="literal">InnoDB</code> produces a
              <code class="filename">.cfg</code> file in the same database
              directory as the table. The <code class="filename">.cfg</code> file
              contains metadata used for schema verification when
              importing the tablespace file.
</p>
</div>
</li><li class="listitem"><p>
            Copy the <code class="filename">.ibd</code> file and
            <code class="filename">.cfg</code> metadata file from the source
            server to the destination server. For example:
          </p><pre class="programlisting">
shell&gt; scp <em class="replaceable"><code>/path/to/datadir</code></em>/test/t.{ibd,cfg} destination-server:<em class="replaceable"><code>/path/to/datadir</code></em>/test
</pre>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
              The <code class="filename">.ibd</code> file and
              <code class="filename">.cfg</code> file must be copied before
              releasing the shared locks, as described in the next step.
</p>
</div>
</li><li class="listitem"><p>
            On the source server, use
            <a class="link" href="sql-syntax.html#lock-tables" title="13.3.5 LOCK TABLES and UNLOCK TABLES Syntax"><code class="literal">UNLOCK
            TABLES</code></a> to release the locks acquired by
            <a class="link" href="sql-syntax.html#flush" title="13.7.6.3 FLUSH Syntax"><code class="literal">FLUSH
            TABLES ... FOR EXPORT</code></a>:
          </p><pre class="programlisting">
mysql&gt; use test;
mysql&gt; UNLOCK TABLES;
</pre></li><li class="listitem"><p>
            On the destination server, import the tablespace:
          </p><pre class="programlisting">
mysql&gt; use test;
mysql&gt; ALTER TABLE t IMPORT TABLESPACE;
</pre>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
              The <a class="link" href="sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE Syntax"><code class="literal">ALTER
              TABLE ... IMPORT TABLESPACE</code></a> feature does not
              enforce foreign key constraints on imported data. If there
              are foreign key constraints between tables, all tables
              should be exported at the same (logical) point in time. In
              this case you would stop updating the tables, commit all
              transactions, acquire shared locks on the tables, and then
              perform the export operation.
</p>
</div>
</li></ol>
</div>
<h5><a name="idm140644113994208"></a>Example 2: Copying an InnoDB Partitioned Table From One Server To
Another</h5>
<p>
        This procedure demonstrates how to copy a partitioned
        <code class="literal">InnoDB</code> table from a running MySQL server
        instance to another running instance. The same procedure with
        minor adjustments can be used to perform a full restore of a
        partitioned <code class="literal">InnoDB</code> table on the same
        instance.
</p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p>
            On the source server, create a partitioned table if one does
            not exist. In the following example, a table with three
            partitions (p0, p1, p2) is created:
          </p><pre class="programlisting">
mysql&gt; use test;
mysql&gt; CREATE TABLE t1 (i int) ENGINE = InnoDB PARTITION BY KEY (i) PARTITIONS 3;
</pre><p>
            In the
            <code class="literal">/<em class="replaceable"><code>datadir</code></em>/test</code>
            directory, you will see a separate tablespace
            (<code class="filename">.ibd</code>) file for each of the three
            partitions.
          </p><pre class="programlisting">
mysql&gt; \! ls <em class="replaceable"><code>/path/to/datadir</code></em>/test/
db.opt  t1.frm  t1#P#p0.ibd  t1#P#p1.ibd  t1#P#p2.ibd
</pre></li><li class="listitem"><p>
            On the destination server, create the same partitioned
            table:
          </p><pre class="programlisting">
mysql&gt; use test;
mysql&gt; CREATE TABLE t1 (i int) ENGINE = InnoDB PARTITION BY KEY (i) PARTITIONS 3;
</pre><p>
            In the
            <code class="literal">/<em class="replaceable"><code>datadir</code></em>/test</code>
            directory, you will see a separate tablespace
            (<code class="filename">.ibd</code>) file for each of the three
            partitions.
          </p><pre class="programlisting">
mysql&gt; \! ls <em class="replaceable"><code>/path/to/datadir</code></em>/test/
db.opt  t1.frm  t1#P#p0.ibd  t1#P#p1.ibd  t1#P#p2.ibd
</pre></li><li class="listitem"><p>
            On the destination server, discard the tablespace for the
            partitioned table. (Before the tablespace can be imported on
            the destination server, the tablespace that is attached to
            the receiving table must be discarded.)
          </p><pre class="programlisting">
mysql&gt; ALTER TABLE t1 DISCARD TABLESPACE;
</pre><p>
            The three <code class="filename">.ibd</code> files that make up the
            tablespace for the partitioned table are discarded from the
            <code class="literal">/<em class="replaceable"><code>datadir</code></em>/test</code>
            directory, leaving the following files:
          </p><pre class="programlisting">
mysql&gt; \! ls <em class="replaceable"><code>/path/to/datadir</code></em>/test/
db.opt  t1.frm  
</pre></li><li class="listitem"><p>
            On the source server, run
            <a class="link" href="sql-syntax.html#flush" title="13.7.6.3 FLUSH Syntax"><code class="literal">FLUSH TABLES ... FOR
            EXPORT</code></a> to quiesce the partitioned table and create
            the <code class="filename">.cfg</code> metadata files:
          </p><pre class="programlisting">
mysql&gt; use test;
mysql&gt; FLUSH TABLES t1 FOR EXPORT;
</pre><p>
            Metadata (<code class="filename">.cfg</code>) files, one for each
            tablespace (<code class="filename">.ibd</code>) file, are created in
            the
            <code class="literal">/<em class="replaceable"><code>datadir</code></em>/test</code>
            directory on the source server:
          </p><pre class="programlisting">
mysql&gt; \! ls <em class="replaceable"><code>/path/to/datadir</code></em>/test/
db.opt t1#P#p0.ibd  t1#P#p1.ibd  t1#P#p2.ibd
t1.frm  t1#P#p0.cfg  t1#P#p1.cfg  t1#P#p2.cfg
</pre>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
              <a class="link" href="sql-syntax.html#flush" title="13.7.6.3 FLUSH Syntax"><code class="literal">FLUSH TABLES ...
              FOR EXPORT</code></a> statement ensures that changes to the
              named table have been flushed to disk so that binary table
              copy can be made while the server is running. When
              <a class="link" href="sql-syntax.html#flush" title="13.7.6.3 FLUSH Syntax"><code class="literal">FLUSH TABLES ...
              FOR EXPORT</code></a> is run, <code class="literal">InnoDB</code>
              produces a <code class="filename">.cfg</code> metadata file for the
              table's tablespace files in the same database directory as
              the table. The <code class="filename">.cfg</code> files contain
              metadata used for schema verification when importing
              tablespace files.
              <a class="link" href="sql-syntax.html#flush" title="13.7.6.3 FLUSH Syntax"><code class="literal">FLUSH TABLES ...
              FOR EXPORT</code></a> can only be run on the table, not on
              individual table partitions.
</p>
</div>
</li><li class="listitem"><p>
            Copy the <code class="filename">.ibd</code> and
            <code class="filename">.cfg</code> files from the source server
            database directory to the destination server database
            directory. For example:
          </p><pre class="programlisting">
shell&gt; scp <em class="replaceable"><code>/path/to/datadir</code></em>/test/t1*.{ibd,cfg} destination-server:<em class="replaceable"><code>/path/to/datadir</code></em>/test
</pre>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
              The <code class="filename">.ibd</code> and
              <code class="filename">.cfg</code> files must be copied before
              releasing the shared locks, as described in the next step.
</p>
</div>
</li><li class="listitem"><p>
            On the source server, use
            <a class="link" href="sql-syntax.html#lock-tables" title="13.3.5 LOCK TABLES and UNLOCK TABLES Syntax"><code class="literal">UNLOCK
            TABLES</code></a> to release the locks acquired by
            <a class="link" href="sql-syntax.html#flush" title="13.7.6.3 FLUSH Syntax"><code class="literal">FLUSH
            TABLES ... FOR EXPORT</code></a>:
          </p><pre class="programlisting">
mysql&gt; use test;
mysql&gt; UNLOCK TABLES;
</pre></li><li class="listitem"><p>
            On the destination server, import the tablespace for the
            partitioned table:
          </p><pre class="programlisting">
mysql&gt; use test;
mysql&gt; ALTER TABLE t1 IMPORT TABLESPACE;
</pre></li></ol>
</div>
<h5><a name="idm140644113946864"></a>Example 3: Copying InnoDB Table Partitions From One Server To Another</h5>
<p>
        This procedure demonstrates how to copy
        <code class="literal">InnoDB</code> table partitions from a running MySQL
        server instance to another running instance. The same procedure
        with minor adjustments can be used to perform a restore of
        <code class="literal">InnoDB</code> table partitions on the same instance.
        In the following example, a partitioned table with four
        partitions (p0, p1, p2, p3) is created on the source server. Two
        of the partitions (p2 and p3) are copied to the destination
        server.
</p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p>
            On the source server, create a partitioned table if one does
            not exist. In the following example, a table with four
            partitions (p0, p1, p2, p3) is created:
          </p><pre class="programlisting">
mysql&gt; use test;
mysql&gt; CREATE TABLE t1 (i int) ENGINE = InnoDB PARTITION BY KEY (i) PARTITIONS 4;
</pre><p>
            In the
            <code class="literal">/<em class="replaceable"><code>datadir</code></em>/test</code>
            directory, you will see a separate tablespace
            (<code class="filename">.ibd</code>) file for each of the four
            partitions.
          </p><pre class="programlisting">
mysql&gt; \! ls <em class="replaceable"><code>/path/to/datadir</code></em>/test/
db.opt  t1.frm  t1#P#p0.ibd  t1#P#p1.ibd  t1#P#p2.ibd t1#P#p3.ibd
</pre></li><li class="listitem"><p>
            On the destination server, create the same partitioned
            table:
          </p><pre class="programlisting">
mysql&gt; use test;
mysql&gt; CREATE TABLE t1 (i int) ENGINE = InnoDB PARTITION BY KEY (i) PARTITIONS 4;
</pre><p>
            In the
            <code class="literal">/<em class="replaceable"><code>datadir</code></em>/test</code>
            directory, you will see a separate tablespace
            (<code class="filename">.ibd</code>) file for each of the four
            partitions.
          </p><pre class="programlisting">
mysql&gt; \! ls <em class="replaceable"><code>/path/to/datadir</code></em>/test/
db.opt  t1.frm  t1#P#p0.ibd  t1#P#p1.ibd  t1#P#p2.ibd t1#P#p3.ibd
</pre></li><li class="listitem"><p>
            On the destination server, discard the tablespace partitions
            that you plan to import from the source server. (Before
            tablespace partitions can be imported on the destination
            server, the corresponding partitions that are attached to
            the receiving table must be discarded.)
          </p><pre class="programlisting">
mysql&gt; ALTER TABLE t1 DISCARD PARTITION p2, p3 TABLESPACE;
</pre><p>
            The <code class="literal">.ibd</code> files for the two discarded
            partitions are removed from the
            <code class="literal">/<em class="replaceable"><code>datadir</code></em>/test</code>
            directory on the destination server, leaving the following
            files:
          </p><pre class="programlisting">
mysql&gt; \! ls <em class="replaceable"><code>/path/to/datadir</code></em>/test/
db.opt  t1.frm  t1#P#p0.ibd  t1#P#p1.ibd
</pre>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
              When <a class="link" href="sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE Syntax"><code class="literal">ALTER
              TABLE ... DISCARD PARTITION ... TABLESPACE</code></a> is
              run on subpartitioned tables, both partition and
              subpartition table names are allowed. When a partition
              name is specified, subpartitions of that partition are
              included in the operation.
</p>
</div>
</li><li class="listitem"><p>
            On the source server, run
            <a class="link" href="sql-syntax.html#flush" title="13.7.6.3 FLUSH Syntax"><code class="literal">FLUSH TABLES ... FOR
            EXPORT</code></a> to quiesce the partitioned table and create
            the <code class="filename">.cfg</code> metadata files.
          </p><pre class="programlisting">
mysql&gt; use test;
mysql&gt; FLUSH TABLES t1 FOR EXPORT;
</pre><p>
            The metadata files (<code class="filename">.cfg</code> files) are
            created in the
            <code class="literal">/<em class="replaceable"><code>datadir</code></em>/test</code>
            directory on the source server. There is a
            <code class="filename">.cfg</code> file for each tablespace
            (<code class="filename">.ibd</code>) file.
          </p><pre class="programlisting">
mysql&gt; \! ls <em class="replaceable"><code>/path/to/datadir</code></em>/test/
db.opt  t1#P#p0.ibd  t1#P#p1.ibd  t1#P#p2.ibd t1#P#p3.ibd
t1.frm  t1#P#p0.cfg  t1#P#p1.cfg  t1#P#p2.cfg t1#P#p3.cfg
</pre>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
              <a class="link" href="sql-syntax.html#flush" title="13.7.6.3 FLUSH Syntax"><code class="literal">FLUSH TABLES ...
              FOR EXPORT</code></a> statement ensures that changes to the
              named table have been flushed to disk so that binary table
              copy can be made while the server is running. When
              <a class="link" href="sql-syntax.html#flush" title="13.7.6.3 FLUSH Syntax"><code class="literal">FLUSH TABLES ...
              FOR EXPORT</code></a> is run, <code class="literal">InnoDB</code>
              produces a <code class="filename">.cfg</code> metadata file for the
              table's tablespace files in the same database directory as
              the table. The <code class="filename">.cfg</code> files contain
              metadata used for schema verification when importing
              tablespace files.
              <a class="link" href="sql-syntax.html#flush" title="13.7.6.3 FLUSH Syntax"><code class="literal">FLUSH TABLES ...
              FOR EXPORT</code></a> can only be run on the table, not on
              individual table partitions.
</p>
</div>
</li><li class="listitem"><p>
            Copy the <code class="filename">.ibd</code> and
            <code class="filename">.cfg</code> files from the source server
            database directory to the destination server database
            directory. In this example, only the
            <code class="filename">.ibd</code> and <code class="filename">.cfg</code>
            files for partition 2 (p2) and partition 3 (p3) are copied
            to the <code class="filename">data</code> directory on the
            destination server. Partition 0 (p0) and partition 1 (p1)
            remain on the source server.
          </p><pre class="programlisting">
shell&gt; scp t1#P#p2.ibd  t1#P#p2.cfg t1#P#p3.ibd t1#P#p3.cfg destination-server:<em class="replaceable"><code>/path/to/datadir</code></em>/test
</pre>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
              The <code class="filename">.ibd</code> files and
              <code class="filename">.cfg</code> files must be copied before
              releasing the shared locks, as described in the next step.
</p>
</div>
</li><li class="listitem"><p>
            On the source server, use
            <a class="link" href="sql-syntax.html#lock-tables" title="13.3.5 LOCK TABLES and UNLOCK TABLES Syntax"><code class="literal">UNLOCK
            TABLES</code></a> to release the locks acquired by
            <a class="link" href="sql-syntax.html#flush" title="13.7.6.3 FLUSH Syntax"><code class="literal">FLUSH
            TABLES ... FOR EXPORT</code></a>:
          </p><pre class="programlisting">
mysql&gt; use test;
mysql&gt; UNLOCK TABLES;
</pre></li><li class="listitem"><p>
            On the destination server, import the tablespace partitions
            (p2 and p3):
          </p><pre class="programlisting">
mysql&gt; use test;
mysql&gt; ALTER TABLE t1 IMPORT PARTITION p2, p3 TABLESPACE;
</pre>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
              When <a class="link" href="sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE Syntax"><code class="literal">ALTER
              TABLE ... IMPORT PARTITION ... TABLESPACE</code></a> is run
              on subpartitioned tables, both partition and subpartition
              table names are allowed. When a partition name is
              specified, subpartitions of that partition are included in
              the operation.
</p>
</div>
</li></ol>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="innodb-transportable-tablespace-internals"></a>14.4.6.2 Transportable Tablespace Internals</h4>

</div>

</div>

</div>
<p>
        The following information describes internals and error log
        messaging for the transportable tablespaces copy procedure for a
        regular <code class="literal">InnoDB</code> table.
      </p><p>
        When <a class="link" href="sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE Syntax"><code class="literal">ALTER TABLE
        ... DISCARD TABLESPACE</code></a> is run on the destination
        instance:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            The table is locked in X mode.
          </p></li><li class="listitem"><p>
            The tablespace is detached from the table.
</p></li></ul>
</div>
<p>
        When <a class="link" href="sql-syntax.html#flush" title="13.7.6.3 FLUSH Syntax"><code class="literal">FLUSH TABLES ... FOR
        EXPORT</code></a> is run on the source instance:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            The table being flushed for export is locked in shared mode.
          </p></li><li class="listitem"><p>
            The purge coordinator thread is stopped.
          </p></li><li class="listitem"><p>
            Dirty pages are synchronized to disk.
          </p></li><li class="listitem"><p>
            Table metadata is written to the binary
            <code class="filename">.cfg</code> file.
</p></li></ul>
</div>
<p>
        Expected error log messages for this operation:
      </p><pre class="programlisting">
2013-09-24T13:10:19.903526Z 2 [Note] InnoDB: Sync to disk of '"test"."t"' started.
2013-09-24T13:10:19.903586Z 2 [Note] InnoDB: Stopping purge
2013-09-24T13:10:19.903725Z 2 [Note] InnoDB: Writing table metadata to './test/t.cfg'
2013-09-24T13:10:19.904014Z 2 [Note] InnoDB: Table '"test"."t"' flushed to disk
 </pre><p>
        When <a class="link" href="sql-syntax.html#lock-tables" title="13.3.5 LOCK TABLES and UNLOCK TABLES Syntax"><code class="literal">UNLOCK
        TABLES</code></a> is run on the source instance:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            The binary .cfg file is deleted.
          </p></li><li class="listitem"><p>
            The shared lock on the table or tables being imported is
            released and the purge coordinator thread is restarted.
</p></li></ul>
</div>
<p>
        Expected error log messages for this operation:
      </p><pre class="programlisting">
2013-09-24T13:10:21.181104Z 2 [Note] InnoDB: Deleting the meta-data file './test/t.cfg'
2013-09-24T13:10:21.181180Z 2 [Note] InnoDB: Resuming purge
</pre><p>
        When <a class="link" href="sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE Syntax"><code class="literal">ALTER TABLE
        ... IMPORT TABLESPACE</code></a> is run on the destination
        instance, the import algorithm performs the following operations
        for each tablespace being imported:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            Each tablespace page is checked for corruption.
          </p></li><li class="listitem"><p>
            The space ID and log sequence numbers (LSNs) on each page
            are updated
          </p></li><li class="listitem"><p>
            Flags are validated and LSN updated for the header page.
          </p></li><li class="listitem"><p>
            Btree pages are updated.
          </p></li><li class="listitem"><p>
            The page state is set to dirty so that it will be written to
            disk.
</p></li></ul>
</div>
<p>
        Expected error log messages for this operation:
      </p><pre class="programlisting">
2013-07-18 15:15:01 34960 [Note] InnoDB: Importing tablespace for table 'test/t' that was exported from host 'ubuntu'
2013-07-18 15:15:01 34960 [Note] InnoDB: Phase I - Update all pages
2013-07-18 15:15:01 34960 [Note] InnoDB: Sync to disk
2013-07-18 15:15:01 34960 [Note] InnoDB: Sync to disk - done!
2013-07-18 15:15:01 34960 [Note] InnoDB: Phase III - Flush changes to disk
2013-07-18 15:15:01 34960 [Note] InnoDB: Phase IV - Flush complete</pre>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
          You may also receive a warning that a tablespace is discarded
          (if you discarded the tablespace for the destination table)
          and a message stating that statistics could not be calculated
          due to a missing <code class="filename">.ibd</code> file:
        </p><pre class="programlisting">
2013-07-18 15:14:38 34960 [Warning] InnoDB: Table "test"."t" tablespace is set as discarded.
2013-07-18 15:14:38 7f34d9a37700 InnoDB: cannot calculate statistics for table "test"."t" because the .ibd file is missing. For help, please refer to 
http://dev.mysql.com/doc/refman/5.7/en/innodb-troubleshooting.html
</pre>
</div>

</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="innodb-undo-tablespace"></a>14.4.7 Storing InnoDB Undo Logs in Separate Tablespaces</h3>

</div>

</div>

</div>
<a class="indexterm" name="idm140644113860112"></a><a class="indexterm" name="idm140644113859072"></a><a class="indexterm" name="idm140644113858000"></a><p>
      You can store <code class="literal">InnoDB</code>
      <a class="link" href="glossary.html#glos_undo_log" title="undo log">undo logs</a> in one or more
      separate <a class="link" href="glossary.html#glos_undo_tablespace" title="undo tablespace">undo
      tablespaces</a> outside of the
      <a class="link" href="glossary.html#glos_system_tablespace" title="system tablespace">system tablespace</a>.
      This layout is different from the default configuration where the
      undo log is part of the
      <a class="link" href="glossary.html#glos_system_tablespace" title="system tablespace">system tablespace</a>.
      The I/O patterns for the undo log make these tablespaces good
      candidates to move to <a class="link" href="glossary.html#glos_ssd" title="SSD">SSD</a> storage,
      while keeping the system tablespace on hard disk storage. Users
      cannot drop the separate tablespaces created to hold
      <code class="literal">InnoDB</code> undo logs, or the individual
      <a class="link" href="glossary.html#glos_segment" title="segment">segments</a> inside those
      tablespaces. However, as of MySQL 5.7.5, undo logs stored in undo
      tablespaces can be truncated. For more information, see
      <a class="xref" href="innodb-storage-engine.html#truncate-undo-tablespace" title="14.4.8 Truncating Undo Logs That Reside in Undo Tablespaces">Section 14.4.8, “Truncating Undo Logs That Reside in Undo Tablespaces”</a>.
    </p><p>
      Because these files handle I/O operations formerly done inside the
      system tablespace, we broaden the definition of system tablespace
      to include these new files.
    </p><p>
      Undo logs are also referred to as
      <a class="link" href="glossary.html#glos_rollback_segment" title="rollback segment">rollback segments</a>.
    </p><p>
      This feature involves the following new or renamed configuration
      options:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_undo_tablespaces"><code class="literal">innodb_undo_tablespaces</code></a>
        </p></li><li class="listitem"><p>
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_undo_directory"><code class="literal">innodb_undo_directory</code></a>
        </p></li><li class="listitem"><p>
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_rollback_segments"><code class="literal">innodb_rollback_segments</code></a>
          becomes <a class="link" href="innodb-storage-engine.html#sysvar_innodb_undo_logs"><code class="literal">innodb_undo_logs</code></a>. The
          old name is still available for compatibility.
</p></li></ul>
</div>
<p>
      Because the <code class="literal">InnoDB</code>
      <a class="link" href="glossary.html#glos_undo_log" title="undo log">undo log</a> feature involves
      setting two non-dynamic startup variables
      (<a class="link" href="innodb-storage-engine.html#sysvar_innodb_undo_tablespaces"><code class="literal">innodb_undo_tablespaces</code></a> and
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_undo_directory"><code class="literal">innodb_undo_directory</code></a>), this
      feature can only be enabled when initializing a MySQL instance.
</p>
<h4><a name="idm140644113833888"></a>Usage Notes</h4>
<p>
      To use this feature, follow these steps:
</p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p>
          Decide on a path to hold the undo logs. You will specify that
          path as the argument to the
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_undo_directory"><code class="literal">innodb_undo_directory</code></a> option
          in your MySQL configuration file or startup script. If no path
          is specified, undo tablespaces are created in the MySQL data
          directory, as defined by
          <a class="link" href="server-administration.html#sysvar_datadir"><code class="literal">datadir</code></a>.
        </p></li><li class="listitem"><p>
          Decide on a starting value for the
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_undo_logs"><code class="literal">innodb_undo_logs</code></a> option. You
          can start with a relatively low value and increase it over
          time to examine the effect on performance.
        </p><p>
          As of MySQL 5.7.2, 32 of 128 undo logs were reserved as
          non-redo undo logs (rollback segments) for temporary table
          transactions. To allocate undo logs to undo tablespaces,
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_undo_logs"><code class="literal">innodb_undo_logs</code></a> must be set
          to a value greater than 33. For example, if you have two undo
          tablespaces
          (<a class="link" href="innodb-storage-engine.html#sysvar_innodb_undo_tablespaces"><code class="literal">innodb_undo_tablespaces=2</code></a>),
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_undo_logs"><code class="literal">innodb_undo_logs</code></a> must be set
          to 35 to assign one undo log to each of the two undo
          tablespaces.
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              The first undo log (rollback segment) always resides in
              the system tablespace (when undo tablespaces are present,
              this undo log is inactive).
</p></li></ul>
</div>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              Undo logs 2 to 33 reside in the shared temporary
              tablespace (<code class="filename">ibtmp1</code>).
</p></li></ul>
</div>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              The 34th undo log resides in the first undo tablespace.
</p></li></ul>
</div>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              The 35th undo log resides in the second undo tablespace.
</p></li></ul>
</div>
</li><li class="listitem"><p>
          Decide on a non-zero value for the
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_undo_tablespaces"><code class="literal">innodb_undo_tablespaces</code></a>
          option. The multiple undo logs specified by the
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_undo_logs"><code class="literal">innodb_undo_logs</code></a> value are
          divided between this number of separate tablespaces
          (represented by
          <a class="link" href="glossary.html#glos_ibd_file" title=".ibd file"><code class="filename">.ibd</code></a>
          files). This value is fixed for the life of the MySQL
          instance, so if you are uncertain about the optimal value,
          estimate on the high side.
        </p></li><li class="listitem"><p>
          Create a new MySQL instance, using the values you chose in the
          configuration file or in your MySQL startup script. Use a
          realistic workload with data volume similar to your production
          servers. Alternatively, use the transportable tablespaces
          feature to copy existing database tables to your newly
          configured MySQL instance. See
          <a class="xref" href="innodb-storage-engine.html#tablespace-copying" title="14.4.6 Copying File-Per-Table Tablespaces to Another Server">Section 14.4.6, “Copying File-Per-Table Tablespaces to Another Server”</a> for more information.
        </p></li><li class="listitem"><p>
          Benchmark the performance of I/O intensive workloads.
        </p></li><li class="listitem"><p>
          Periodically increase the value of
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_undo_logs"><code class="literal">innodb_undo_logs</code></a> and rerun
          performance tests. Find the value where you stop experiencing
          gains in I/O performance.
        </p></li><li class="listitem"><p>
          Deploy a new production instance using the ideal settings for
          these options. Set it up as a
          <a class="link" href="glossary.html#glos_slave_server" title="slave server">slave server</a> in a
          <a class="link" href="glossary.html#glos_replication" title="replication">replication</a>
          configuration, or transfer data from an earlier production
          instance.
</p></li></ol>
</div>
<h4><a name="idm140644113803056"></a>Performance and Scalability Considerations</h4>
<p>
      Keeping the undo logs in separate files allows the MySQL team to
      implement I/O and memory optimizations related to this
      transactional data. For example, because the undo data is written
      to disk and then rarely used (only in case of crash recovery), it
      does not need to be kept in the file system memory cache, in turn
      allowing a higher percentage of system memory to be devoted to the
      <code class="literal">InnoDB</code> <a class="link" href="glossary.html#glos_buffer_pool" title="buffer pool">buffer
      pool</a>.
    </p><p>
      The typical SSD best practice of keeping the
      <code class="literal">InnoDB</code> system tablespace on a hard drive and
      moving the per-table tablespaces to SSD, is assisted by moving the
      undo information into separate tablespace files.
</p>
<h4><a name="idm140644113798608"></a>Internals</h4>
<p>
      The physical tablespace files are named
      <code class="filename">undo<em class="replaceable"><code>N</code></em></code>, where
      <em class="replaceable"><code>N</code></em> is the space ID, including leading
      zeros.
    </p><p>
      MySQL instances containing separate undo tablespaces cannot be
      downgraded to earlier releases such as MySQL 5.5 or 5.1.
</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
        As of MySQL 5.7.5, you can truncate undo logs that reside in
        undo tablespaces. For more information, see
        <a class="xref" href="innodb-storage-engine.html#truncate-undo-tablespace" title="14.4.8 Truncating Undo Logs That Reside in Undo Tablespaces">Section 14.4.8, “Truncating Undo Logs That Reside in Undo Tablespaces”</a>.
</p>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="truncate-undo-tablespace"></a>14.4.8 Truncating Undo Logs That Reside in Undo Tablespaces</h3>

</div>

</div>

</div>
<a class="indexterm" name="idm140644113792544"></a><a class="indexterm" name="idm140644113791472"></a><a class="indexterm" name="idm140644113790400"></a><p>
      As of MySQL 5.7.5, you can truncate
      <a class="link" href="glossary.html#glos_undo_log" title="undo log">undo logs</a> that reside in
      <a class="link" href="glossary.html#glos_undo_tablespace" title="undo tablespace">undo tablespaces</a>,
      provided that the following conditions are true:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          Your MySQL instance is configured with a minimum of two undo
          tablespaces
          (<a class="link" href="innodb-storage-engine.html#sysvar_innodb_undo_tablespaces"><code class="literal">innodb_undo_tablespaces=2</code></a>).
          When an undo tablespace is truncated, it is temporarily taken
          offline. For the server to function, there must be at least
          one other active undo tablespace. The number of undo
          tablespaces is defined by the
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_undo_tablespaces"><code class="literal">innodb_undo_tablespaces</code></a>
          option, which can only be set when the MySQL instance is
          initialized. The default value is 0. To check the value of
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_undo_tablespaces"><code class="literal">innodb_undo_tablespaces</code></a>,
          submit the following query:
        </p><pre class="programlisting">mysql&gt; SELECT @@innodb_undo_tablespaces;
+---------------------------+
| @@innodb_undo_tablespaces |
+---------------------------+
|                         2 |
+---------------------------+
1 row in set (0.00 sec)</pre></li><li class="listitem"><p>
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_undo_logs"><code class="literal">innodb_undo_logs</code></a>, which
          defines the number of
          <a class="link" href="glossary.html#glos_rollback_segment" title="rollback segment">rollback segments</a>
          used by <code class="literal">InnoDB</code>, must be set to 35 or
          greater. A setting of 35 or greater ensures that a
          redo-enabled undo log is assigned to each of the two undo
          tablespaces. With an
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_undo_logs"><code class="literal">innodb_undo_logs</code></a> setting of
          35:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
              The first rollback segment always resides in the
              <a class="link" href="glossary.html#glos_system_tablespace" title="system tablespace">system
              tablespace</a> (when undo tablespaces are present, this
              rollback segment is inactive)
            </p></li><li class="listitem"><p>
              Rollback segments 2 to 33 reside in the shared temporary
              tablespace (<code class="filename">ibtmp1</code>)
            </p></li><li class="listitem"><p>
              The 34th rollback segment resides in the first undo
              tablespace (if present)
            </p></li><li class="listitem"><p>
              The 35th rollback segment resides in the second undo
              tablespace (if present)
</p></li></ul>
</div>
<p>
          There is a many-to-one relationship between rollback segments
          and undo tablespaces. If the number of allocated rollback
          segments is greater than 35, the <span class="quote">“<span class="quote">additional</span>”</span>
          rollback segments are assigned to undo tablespaces in a
          round-robin fashion. For example, if you have 2 undo
          tablespaces (undo tablespace 1 and undo-tablespace 2) and
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_undo_logs"><code class="literal">innodb_undo_logs=37</code></a>,
          undo-tablespace 1 and undo-tablespace 2 would each be assigned
          a second rollback segment.
        </p><p>
          By default, <a class="link" href="innodb-storage-engine.html#sysvar_innodb_undo_logs"><code class="literal">innodb_undo_logs</code></a>
          is set to 128, which is also the maximum value. To check the
          value of <a class="link" href="innodb-storage-engine.html#sysvar_innodb_undo_logs"><code class="literal">innodb_undo_logs</code></a>,
          submit the following query:
        </p><pre class="programlisting">mysql&gt; SELECT @@innodb_undo_logs;
+--------------------+
| @@innodb_undo_logs |
+--------------------+
|                128 |
+--------------------+
1 row in set (0.00 sec)</pre><p>
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_undo_logs"><code class="literal">innodb_undo_logs</code></a> is a dynamic
          global variable and can be configured using a <code class="literal">SET
          GLOBAL</code> statement:
</p><pre class="programlisting">mysql&gt; SET GLOBAL innodb_undo_logs=128;</pre></li></ul>
</div>
<h4><a name="idm140644113760288"></a>Enabling Truncation of Undo Tablespaces</h4>
<p>
      To truncate undo logs that reside in undo tablespaces, you must
      first enable
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_undo_log_truncate"><code class="literal">innodb_undo_log_truncate</code></a>.
    </p><pre class="programlisting">mysql&gt; SET GLOBAL innodb_undo_log_truncate=ON;</pre><p>
      When you enable
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_undo_log_truncate"><code class="literal">innodb_undo_log_truncate</code></a>, undo
      tablespace files that exceed the size limit defined by
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_max_undo_log_size"><code class="literal">innodb_max_undo_log_size</code></a> are
      marked for truncation.
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_max_undo_log_size"><code class="literal">innodb_max_undo_log_size</code></a> is a
      dynamic global variable with a default value of 1024 MiB
      (1073741824 bytes).
    </p><pre class="programlisting">mysql&gt; SELECT @@innodb_max_undo_log_size;
+----------------------------+
| @@innodb_max_undo_log_size |
+----------------------------+
|                 1073741824 |
+----------------------------+
1 row in set (0.00 sec)</pre><p>
      You can configure
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_max_undo_log_size"><code class="literal">innodb_max_undo_log_size</code></a> using a
      <code class="literal">SET GLOBAL</code> statement:
    </p><pre class="programlisting">mysql&gt; SET GLOBAL innodb_max_undo_log_size=2147483648;
Query OK, 0 rows affected (0.00 sec)</pre><p>
      When <a class="link" href="innodb-storage-engine.html#sysvar_innodb_undo_log_truncate"><code class="literal">innodb_undo_log_truncate</code></a> is
      enabled:
</p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p>
          Undo tablespaces that exceed the
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_max_undo_log_size"><code class="literal">innodb_max_undo_log_size</code></a>
          setting are marked for truncation. Selection of an undo
          tablespace for truncation is performed in a round-robin
          fashion to avoid truncating the same undo tablespace each
          time.
        </p></li><li class="listitem"><p>
          Rollback segments residing in the selected undo tablespace are
          made inactive so that they are not allocated to new
          transactions. Existing transactions that are currently using
          rollback segments are allowed to complete.
        </p></li><li class="listitem"><p>
          The <a class="link" href="glossary.html#glos_purge" title="purge">purge</a> system frees
          rollback segments that are no longer needed.
        </p></li><li class="listitem"><p>
          After all rollback segments in the undo tablespace are freed,
          the truncate operation runs and the undo tablespace is
          truncated to its initial size. The initial size of an undo
          tablespace file is 10MB.
</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
            If you check the size of an undo tablespace after a
            truncation operation, the file size may be larger than 10MB
            due to immediate use following the completion of the
            truncation operation. The
            <a class="link" href="innodb-storage-engine.html#sysvar_innodb_undo_directory"><code class="literal">innodb_undo_directory</code></a>
            option defines the location of undo tablespace files. The
            default value of <span class="quote">“<span class="quote">.</span>”</span> represents directory where
            <code class="literal">InnoDB</code> creates its other log files by
            default.
          </p><pre class="programlisting">mysql&gt; select @@innodb_undo_directory;
+-------------------------+
| @@innodb_undo_directory |
+-------------------------+
| .                       |
+-------------------------+
1 row in set (0.00 sec)</pre>
</div>
</li><li class="listitem"><p>
          The rollback segments are reactivated so that they can be
          allocated to new transactions.
</p></li></ol>
</div>
<h4><a name="idm140644113733776"></a>Expediting Truncation of Undo Tablespace Files</h4>
<p>
      An undo tablespace cannot be truncated until its rollback segments
      are freed. Normally, the purge system frees rollback segments once
      every 128 times that purge is invoked. To expedite the truncation
      of undo tablespaces, you can use the
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_purge_rseg_truncate_frequency"><code class="literal">innodb_purge_rseg_truncate_frequency</code></a>
      option to temporarily increase the frequency with which the purge
      system frees rollback segments. By default,
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_purge_rseg_truncate_frequency"><code class="literal">innodb_purge_rseg_truncate_frequency</code></a>
      is 128, which is also the maximum value.
    </p><pre class="programlisting">mysql&gt; select @@innodb_purge_rseg_truncate_frequency;
+----------------------------------------+
| @@innodb_purge_rseg_truncate_frequency |
+----------------------------------------+
|                                    128 |
+----------------------------------------+
1 row in set (0.00 sec)</pre><p>
      To increase the frequency with which the purge thread frees
      rollback segments, decrease the value of
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_purge_rseg_truncate_frequency"><code class="literal">innodb_purge_rseg_truncate_frequency</code></a>.
      For example:
    </p><pre class="programlisting">mysql&gt; SET GLOBAL innodb_purge_rseg_truncate_frequency=32;
Query OK, 0 rows affected (0.00 sec)
</pre>
<h4><a name="idm140644113725568"></a>Performance Impact of Truncating Undo Tablespace Files Online</h4>
<p>
      While an undo tablespace truncation operation is in progress,
      rollback segments in one undo tablespace are temporarily
      deactivated. For example, if you have 2 undo tablespaces
      (<a class="link" href="innodb-storage-engine.html#sysvar_innodb_undo_tablespaces"><code class="literal">innodb_undo_tablespaces=2</code></a>) and
      128 allocated undo logs
      (<a class="link" href="innodb-storage-engine.html#sysvar_innodb_undo_logs"><code class="literal">innodb_undo_logs=128</code></a>), 95 of the
      undo logs reside in the two undo tablespaces (48 rollback segments
      in one undo tablespace and 47 in the other). If the first undo
      tablespace is taken offline, 48 undo logs are made inactive,
      reducing the undo log resource by slightly more than half. While
      the truncation operation is in progress, the remaining undo logs
      assume responsibility for the entire system load, which may result
      in a slight performance degradation. The degree of performance
      degradation depends on a number of factors including:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          Number of undo tablespaces
        </p></li><li class="listitem"><p>
          Number of undo logs
        </p></li><li class="listitem"><p>
          Undo tablespace size
        </p></li><li class="listitem"><p>
          Speed of the I/O susbsystem
        </p></li><li class="listitem"><p>
          Existing long running transactions
        </p></li><li class="listitem"><p>
          System load
</p></li></ul>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="general-tablespaces"></a>14.4.9 InnoDB General Tablespaces</h3>

</div>

</div>

</div>
<p>
      A <span class="emphasis"><em>general tablespace</em></span> is a new type of
      <code class="literal">InnoDB</code> tablespace, introduced in MySQL 5.7.6.
      The general tablespace feature provides the following
      capabilities:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          Similar to the system tablespace, general tablespaces are
          shared tablespaces that can store data for multiple tables.
        </p></li><li class="listitem"><p>
          General tablespaces have a potential memory advantage over
          <a class="link" href="innodb-storage-engine.html#innodb-multiple-tablespaces" title="14.4.4 InnoDB File-Per-Table Tablespaces">file-per-table
          tablespaces</a>. The server keeps tablespace metadata in
          memory for the lifetime of a tablespace. Multiple tables in
          fewer general tablespaces consume less memory for tablespace
          metadata than the same number of tables in separate
          file-per-table tablespaces.
        </p></li><li class="listitem"><p>
          General tablespace data files may be placed in a directory
          relative to or independent of the MySQL data directory, which
          provides you with many of the data file and storage management
          capabilities of
          <a class="link" href="innodb-storage-engine.html#innodb-multiple-tablespaces" title="14.4.4 InnoDB File-Per-Table Tablespaces">file-per-table
          tablespaces</a>. As with file-per-table tablespaces, the
          ability to place data files outside of the MySQL data
          directory allows you to manage performance of critical tables
          separately, setup RAID or DRBD for specific tables, or bind
          tables to particular disks, for example.
        </p></li><li class="listitem"><p>
          General tablespaces support both Antelope and Barracuda file
          formats, and therefore support all table row formats and
          associated features. With support for both file formats,
          general tablespaces have no dependence on
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_format"><code class="literal">innodb_file_format</code></a> or
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_per_table"><code class="literal">innodb_file_per_table</code></a>
          settings, nor do these variables have any effect on general
          tablespaces.
        </p></li><li class="listitem"><p>
          The <code class="literal">TABLESPACE</code> option can be used with
          <a class="link" href="sql-syntax.html#create-table" title="13.1.18 CREATE TABLE Syntax"><code class="literal">CREATE TABLE</code></a> to create tables
          in a general tablespaces, file-per-table tablespace, or in the
          system tablespace.
        </p></li><li class="listitem"><p>
          The <code class="literal">TABLESPACE</code> option can be used with
          <a class="link" href="sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a> to move tables
          between general tablespaces, file-per-table tablespaces, and
          the system tablespace. Previously, it was not possible to move
          a table from a file-per-table tablespace to the system
          tablespace. With the general tablespace feature, you can now
          do so.
</p></li></ul>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h4 class="title"><a name="general-tablespaces-creating"></a>Creating a General Tablespace</h4>

</div>

</div>

</div>
<p>
        General tablespaces are created using
        <a class="link" href="sql-syntax.html#create-tablespace" title="13.1.19 CREATE TABLESPACE Syntax"><code class="literal">CREATE TABLESPACE</code></a> syntax.
      </p><pre class="programlisting">CREATE TABLESPACE tablespace_name
    ADD DATAFILE 'file_name'
    [FILE_BLOCK_SIZE = value]
        [ENGINE [=] engine_name]</pre><p>
        A general tablespace may be created in the MySQL data directory
        or in a directory outside of the MySQL data directory. To avoid
        conflicts with implicitly created file-per-table tablespaces,
        creating a general tablespace in a subdirectory under the MySQL
        data directory is not supported. Also, when creating a general
        tablespace outside of the MySQL data directory, the directory
        must exist prior to creating the tablespace.
      </p><p>
        As of MySQL 5.7.8, an <a class="link" href="glossary.html#glos_isl_file" title=".isl file">isl</a>
        file is created in the MySQL data directory when a general
        tablespace is created outside of the MySQL data directory.
      </p><p>
        Examples:
      </p><p>
        Creating a general tablespace in the MySQL data directory:
      </p><pre class="programlisting">mysql&gt; CREATE TABLESPACE `ts1` ADD DATAFILE 'ts1.ibd' Engine=InnoDB;</pre><p>
        Creating a general tablespace in a directory outside of the
        MySQL data directory:
      </p><pre class="programlisting">mysql&gt; CREATE TABLESPACE `ts1` ADD DATAFILE '/my/tablespace/directory/ts1.ibd' Engine=InnoDB;</pre><p>
        You can specify a path that is relative to the MySQL data
        directory as long as the tablespace directory is not under the
        MySQL data directory. In this example, the
        <code class="filename">my_tablespace</code> directory is at the same
        level as the MySQL data directory:
</p><pre class="programlisting">mysql&gt; CREATE TABLESPACE `ts1` ADD DATAFILE '../my_tablespace/ts1.ibd' Engine=InnoDB;</pre>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
          The <code class="literal">ENGINE = InnoDB</code> clause must be defined
          as part of the <a class="link" href="sql-syntax.html#create-tablespace" title="13.1.19 CREATE TABLESPACE Syntax"><code class="literal">CREATE
          TABLESPACE</code></a> statement or <code class="literal">InnoDB</code>
          must be defined as the default storage engine
          (<a class="link" href="server-administration.html#sysvar_default_storage_engine"><code class="literal">default_storage_engine=InnoDB</code></a>).
</p>
</div>

</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h4 class="title"><a name="general-tablespaces-adding-tables"></a>Adding Tables to a General Tablespace</h4>

</div>

</div>

</div>
<p>
        After creating an <code class="literal">InnoDB</code> general tablespace,
        you can use <a class="link" href="sql-syntax.html#create-table" title="13.1.18 CREATE TABLE Syntax"><code class="literal">CREATE
        TABLE <em class="replaceable"><code>tbl_name</code></em> ... TABLESPACE [=]
        <em class="replaceable"><code>tablespace_name</code></em></code></a> or
        <a class="link" href="sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE Syntax"><code class="literal">ALTER TABLE
        <em class="replaceable"><code>tbl_name</code></em> TABLESPACE [=]
        <em class="replaceable"><code>tablespace_name</code></em></code></a> to add
        tables to the tablespace, as shown in the following examples:
      </p><p>
        <a class="link" href="sql-syntax.html#create-table" title="13.1.18 CREATE TABLE Syntax"><code class="literal">CREATE TABLE</code></a>:
      </p><pre class="programlisting">mysql&gt; CREATE TABLE t1 (c1 INT PRIMARY KEY) TABLESPACE ts1 ROW_FORMAT=COMPACT;</pre><p>
        <a class="link" href="sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a>:
      </p><pre class="programlisting">mysql&gt; ALTER TABLE t2 TABLESPACE ts1;</pre><p>
        For detailed syntax information, see <a class="link" href="sql-syntax.html#create-table" title="13.1.18 CREATE TABLE Syntax"><code class="literal">CREATE
        TABLE</code></a> and <a class="link" href="sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a>.
</p>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h4 class="title"><a name="general-tablespaces-row-format-support"></a>General Tablespace Row Format Support</h4>

</div>

</div>

</div>
<p>
        General tablespaces support all table row formats
        (<code class="literal">REDUNDANT</code>, <code class="literal">COMPACT</code>,
        <code class="literal">DYNAMIC</code>, <code class="literal">COMPRESSED</code>) with
        the caveat that compressed and uncompressed tables cannot
        coexist in the same general tablespace due to different physical
        page sizes.
      </p><p>
        For a general tablespace to contain compressed tables
        (<code class="literal">ROW_FORMAT=COMPRESSED</code>),
        <code class="literal">FILE_BLOCK_SIZE</code> must be specified, and the
        <code class="literal">FILE_BLOCK_SIZE</code> value must be a valid
        compressed page size in relation to the
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_page_size"><code class="literal">innodb_page_size</code></a> value. Also,
        the physical page size of the compressed table
        (<code class="literal">KEY_BLOCK_SIZE</code>) must be equal to
        <code class="literal">FILE_BLOCK_SIZE/1024</code>. For example, if
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_page_size"><code class="literal">innodb_page_size=16K</code></a> and
        <code class="literal">FILE_BLOCK_SIZE=8K</code>, the
        <code class="literal">KEY_BLOCK_SIZE</code> of the table must be 8.
      </p><p>
        The following table shows permitted
        <code class="literal">FILE_BLOCK_SIZE</code> and
        <code class="literal">KEY_BLOCK_SIZE</code> values for each
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_page_size"><code class="literal">innodb_page_size</code></a> value.
        <code class="literal">FILE_BLOCK_SIZE</code> values may also be specified
        in bytes. To determine a valid <code class="literal">KEY_BLOCK_SIZE</code>
        value for a given <code class="literal">FILE_BLOCK_SIZE</code>, divide the
        <code class="literal">FILE_BLOCK_SIZE</code> value by 1024. Table
        compression is not support for 32K and 64K
        <code class="literal">InnoDB</code> page sizes. For more information about
        <code class="literal">KEY_BLOCK_SIZE</code>, see
        <a class="link" href="sql-syntax.html#create-table" title="13.1.18 CREATE TABLE Syntax"><code class="literal">CREATE TABLE</code></a>, and
        <a class="xref" href="innodb-storage-engine.html#innodb-compression-usage" title="14.6.1.2 Creating Compressed Tables">Section 14.6.1.2, “Creating Compressed Tables”</a>.
</p>
<div class="table">
<a name="idm140644113644656"></a><p class="title"><b>Table 14.4 FILE_BLOCK_SIZE and KEY_BLOCK_SIZE Values for CREATE TABLESPACE</b></p>
<div class="table-contents">
<table summary="FILE_BLOCK_SIZE and KEY_BLOCK_SIZE Values for CREATE TABLESPACE" border="1"><colgroup><col class="c1"><col class="c2"><col class="newCol3"></colgroup><thead><tr><th scope="col">InnoDB Page Size (innodb_page_size)</th><th scope="col">Permitted FILE_BLOCK_SIZE Values</th><th scope="col">Permitted KEY_BLOCK_SIZE Values</th></tr></thead><tbody><tr><td scope="row">64K</td><td>64K (65536)</td><td>Compression is not supported</td></tr><tr><td scope="row">32K</td><td>32K (32768)</td><td>Compression is not supported</td></tr><tr><td scope="row" rowspan="5">16K</td><td>16K (16384)</td><td>N/A: If <a class="link" href="innodb-storage-engine.html#sysvar_innodb_page_size"><code class="literal">innodb_page_size</code></a> is equal to
                <code class="literal">FILE_BLOCK_SIZE</code>, the tablespace
                cannot contain a compressed table.</td></tr><tr><td scope="row">8K (8192)</td><td>8</td></tr><tr><td scope="row">4K (4096)</td><td>4</td></tr><tr><td scope="row">2K (2048)</td><td>2</td></tr><tr><td scope="row">1K (1024)</td><td>1</td></tr><tr><td scope="row" rowspan="4">8K</td><td>8K (8192)</td><td>N/A: If <a class="link" href="innodb-storage-engine.html#sysvar_innodb_page_size"><code class="literal">innodb_page_size</code></a> is equal to
                <code class="literal">FILE_BLOCK_SIZE</code>, the tablespace
                cannot contain a compressed table.</td></tr><tr><td scope="row">4K (4096)</td><td>4</td></tr><tr><td scope="row">2K (2048)</td><td>2</td></tr><tr><td scope="row">1K (1024)</td><td>1</td></tr><tr><td scope="row" rowspan="3">4K</td><td>4K (4096)</td><td>N/A: If <a class="link" href="innodb-storage-engine.html#sysvar_innodb_page_size"><code class="literal">innodb_page_size</code></a> is equal to
                <code class="literal">FILE_BLOCK_SIZE</code>, the tablespace
cannot contain a compressed table.</td></tr><tr><td scope="row">2K (2048)</td><td>2</td></tr><tr><td scope="row">1K (1024)</td><td>1</td></tr></tbody></table>
</div>

</div>
<br class="table-break"><p>
        This example demonstrates creating a general tablespace and
        adding a compressed table. The example assumes a default
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_page_size"><code class="literal">innodb_page_size</code></a> of 16K. The
        <code class="literal">FILE_BLOCK_SIZE</code> of 8192 requires that the
        compressed table have a <code class="literal">KEY_BLOCK_SIZE</code> of 8.
      </p><pre class="programlisting">mysql&gt; CREATE TABLESPACE `ts2` ADD DATAFILE 'ts2.ibd' FILE_BLOCK_SIZE = 8192 Engine=InnoDB;
Query OK, 0 rows affected (0.01 sec)

mysql&gt; CREATE TABLE t4 (c1 INT PRIMARY KEY) TABLESPACE ts2 ROW_FORMAT=COMPRESSED 
KEY_BLOCK_SIZE=8;
Query OK, 0 rows affected (0.00 sec)</pre><p>
        If you do not specify <code class="literal">FILE_BLOCK_SIZE</code> when
        creating a general tablespace,
        <code class="literal">FILE_BLOCK_SIZE</code> defaults to
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_page_size"><code class="literal">innodb_page_size</code></a>. When
        <code class="literal">FILE_BLOCK_SIZE</code> is equal to
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_page_size"><code class="literal">innodb_page_size</code></a>, the
        tablespace may only contain tables with an uncompressed row
        format (<code class="literal">COMPACT</code>,
        <code class="literal">REDUNDANT</code>, and <code class="literal">DYNAMIC</code> row
        formats).
</p>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h4 class="title"><a name="general-tablespaces-moving-non-partitioned-tables"></a>Moving Non-Partitioned Tables Between Tablespaces Using ALTER TABLE</h4>

</div>

</div>

</div>
<p>
        You can use <a class="link" href="sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a> with the
        <code class="literal">TABLESPACE</code> option to move a non-partitioned
        <code class="literal">InnoDB</code> table to an existing general
        tablespace, to a new file-per-table tablespace, or to the system
        tablespace.
</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
          Running an <code class="literal">ALTER TABLE
          <em class="replaceable"><code>tbl_name</code></em> TABLESPACE [=]
          <em class="replaceable"><code>tablespace_name</code></em></code> operation
          on a <span class="emphasis"><em>partitioned</em></span> table only modifies the
          table's default tablespace. It does not move the table's
          partitions.
</p>
</div>
<p>
        To move a non-partitioned table from a file-per-table tablespace
        or from the system tablespace to a general tablespace, specify
        the name of the general tablespace. The general tablespace must
        exist. See <a class="link" href="sql-syntax.html#create-tablespace" title="13.1.19 CREATE TABLESPACE Syntax"><code class="literal">CREATE TABLESPACE</code></a> for
        more information.
      </p><pre class="programlisting">ALTER TABLE tbl_name TABLESPACE [=] <em class="replaceable"><code>tablespace_name</code></em></pre><p>
        To move a non-partitioned table from a general tablespace or
        file-per-table tablespace to the system tablespace, specify
        <code class="literal">innodb_system</code> as the tablespace name.
      </p><pre class="programlisting">ALTER TABLE tbl_name ... TABLESPACE [=] innodb_system</pre><p>
        To move a non-partitioned table from the system tablespace or a
        general tablespace to a file-per-table tablespace, specify
        <code class="literal">innodb_file_per_table</code> as the tablespace name.
      </p><pre class="programlisting">ALTER TABLE tbl_name ... TABLESPACE [=] innodb_file_per_table</pre><p>
        <code class="literal">ALTER TABLE ... TABLESPACE</code> operations always
        cause a full table rebuild, even if the
        <code class="literal">TABLESPACE</code> attribute has not changed from its
        previous value.
      </p><p>
        <code class="literal">ALTER TABLE ... TABLESPACE</code> syntax does not
        support moving a table from a temporary tablespace to a
        persistent tablespace.
      </p><p>
        The <code class="literal">DATA DIRECTORY</code> clause is permitted with
        <code class="literal">CREATE TABLE ...
        TABLESPACE=innodb_file_per_table</code> but is otherwise not
        supported for use in combination with the
        <code class="literal">TABLESPACE</code> option.
</p>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h4 class="title"><a name="general-tablespaces-table-partition-support"></a>General Tablespace Table Partition Support</h4>

</div>

</div>

</div>
<p>
        The <code class="literal">TABLESPACE</code> option may be used to assign
        individual table partitions or subpartitions to a
        <a class="link" href="glossary.html#glos_general_tablespace" title="general tablespace">general
        tablespace</a>, a separate file-per-table tablespace, or the
        system tablespace. General tablespace support for table
        partitions and subpartitions was added in MySQL 5.7.8. All
        partitions must belong to the same storage engine. Usage is
        demonstrated in the following examples.
      </p><pre class="programlisting">mysql&gt; CREATE TABLESPACE `ts1` ADD DATAFILE 'ts1.ibd' Engine=InnoDB;
mysql&gt; CREATE TABLESPACE `ts2` ADD DATAFILE 'ts2.ibd' Engine=InnoDB;

mysql&gt; CREATE TABLE t1 (a INT, b INT) ENGINE = InnoDB
    -&gt;  PARTITION BY RANGE(a) SUBPARTITION BY KEY(b) (
    -&gt;    PARTITION p1 VALUES LESS THAN (100) TABLESPACE=`ts1`,
    -&gt;    PARTITION p2 VALUES LESS THAN (1000) TABLESPACE=`ts2`,
    -&gt;    PARTITION p3 VALUES LESS THAN (10000) TABLESPACE `innodb_file_per_table`,
    -&gt;    PARTITION p4 VALUES LESS THAN (100000) TABLESPACE `innodb_system`);

mysql&gt; CREATE TABLE t2 (a INT, b INT) ENGINE = InnoDB
    -&gt;  PARTITION BY RANGE(a) SUBPARTITION BY KEY(b) (
    -&gt;    PARTITION p1 VALUES LESS THAN (100) TABLESPACE=`ts1`
    -&gt;      (SUBPARTITION sp1,
    -&gt;       SUBPARTITION sp2),
    -&gt;    PARTITION p2 VALUES LESS THAN (1000)
    -&gt;      (SUBPARTITION sp3,
    -&gt;       SUBPARTITION sp4 TABLESPACE=`ts2`),
    -&gt;    PARTITION p3 VALUES LESS THAN (10000)
    -&gt;      (SUBPARTITION sp5 TABLESPACE `innodb_system`,
    -&gt;       SUBPARTITION sp6 TABLESPACE `innodb_file_per_table`));</pre><p>
        The <code class="literal">TABLESPACE</code> option is also supported with
        <a class="link" href="sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a>.
</p><pre class="programlisting">mysql&gt; ALTER TABLE t1 ADD PARTITION (PARTITION p5 VALUES LESS THAN (1000000) TABLESPACE = `ts1`);</pre>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
          If the <code class="literal">TABLESPACE =
          <em class="replaceable"><code>tablespace_name</code></em></code> option is
          not defined, the
          <a class="link" href="sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE Syntax"><code class="literal">ALTER TABLE ...
          ADD PARTITION</code></a> operation adds the partition to the
          table's default tablespace, which can be specified at the
          table level during <a class="link" href="sql-syntax.html#create-table" title="13.1.18 CREATE TABLE Syntax"><code class="literal">CREATE TABLE</code></a>
          or <a class="link" href="sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a>.
</p>
</div>
<p>
        To verify that partitions were placed in the specified
        tablespaces, you can query
        <a class="link" href="information-schema.html#innodb-sys-tables-table" title="21.31.7 The INFORMATION_SCHEMA INNODB_SYS_TABLES Table"><code class="literal">INFORMATION_SCHEMA.INNODB_SYS_TABLES</code></a>:
      </p><pre class="programlisting">mysql&gt; SELECT NAME, SPACE, SPACE_TYPE FROM INFORMATION_SCHEMA.INNODB_SYS_TABLES 
    -&gt; WHERE NAME LIKE '%t1%';
+-----------------------+-------+------------+
| NAME                  | SPACE | SPACE_TYPE |
+-----------------------+-------+------------+
| test/t1#P#p1#SP#p1sp0 |    57 | General    |
| test/t1#P#p2#SP#p2sp0 |    58 | General    |
| test/t1#P#p3#SP#p3sp0 |    59 | Single     |
| test/t1#P#p4#SP#p4sp0 |     0 | System     |
| test/t1#P#p5#SP#p5sp0 |    57 | General    |
+-----------------------+-------+------------+

mysql&gt; SELECT NAME, SPACE, SPACE_TYPE FROM INFORMATION_SCHEMA.INNODB_SYS_TABLES 
    -&gt; WHERE NAME LIKE '%t2%';
+---------------------+-------+------------+
| NAME                | SPACE | SPACE_TYPE |
+---------------------+-------+------------+
| test/t2#P#p1#SP#sp1 |    57 | General    |
| test/t2#P#p1#SP#sp2 |    57 | General    |
| test/t2#P#p2#SP#sp3 |    60 | Single     |
| test/t2#P#p2#SP#sp4 |    58 | General    |
| test/t2#P#p3#SP#sp5 |     0 | System     |
| test/t2#P#p3#SP#sp6 |    61 | Single     |
+---------------------+-------+------------+</pre>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h4 class="title"><a name="general-tablespaces-moving-partitions"></a>Moving Table Partitions Between Tablespaces Using ALTER TABLE</h4>

</div>

</div>

</div>
<p>
        To move table partitions to a different tablespace, you must
        move each partition using an <code class="literal">ALTER TABLE
        <em class="replaceable"><code>tbl_name</code></em> REORGANIZE
        PARTITION</code> statement.
      </p><p>
        The following example demonstrates how to move table partitions
        to a different tablespace.
        <a class="link" href="information-schema.html#innodb-sys-tables-table" title="21.31.7 The INFORMATION_SCHEMA INNODB_SYS_TABLES Table"><code class="literal">INFORMATION_SCHEMA.INNODB_SYS_TABLES</code></a>
        and
        <a class="link" href="information-schema.html#innodb-sys-tablespaces-table" title="21.31.15 The INFORMATION_SCHEMA INNODB_SYS_TABLESPACES Table"><code class="literal">INFORMATION_SCHEMA.INNODB_SYS_TABLESPACES</code></a>
        are queried to verify that partitions are placed in the expected
        tablespace.
</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
          If the <code class="literal">TABLESPACE =
          <em class="replaceable"><code>tablespace_name</code></em></code> option is
          not defined in the <code class="literal">REORGANIZE PARTITION</code>
          statement, <code class="literal">InnoDB</code> moves the partition to
          the table's default tablespace. In this example, tablespace
          <code class="literal">ts1</code>, which is defined at the table level,
          is the default tablespace for table <code class="literal">t1</code>.
          Partition <code class="literal">P3</code> is moved from the system
          tablespace to tablespace <code class="literal">ts1</code> since no
          <code class="literal">TABLESPACE</code> option is specified in the
          <a class="link" href="sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE Syntax"><code class="literal">ALTER TABLE t1
          REORGANIZE PARTITION</code></a> statement for partition
          <code class="literal">P3</code>.
        </p><p>
          To change a partitioned table's default tablespace, you can
          run <code class="literal">ALTER TABLE <em class="replaceable"><code>tbl_name</code></em>
          TABLESPACE [=]
          <em class="replaceable"><code>tablespace_name</code></em></code> on the
          <span class="emphasis"><em>partitioned</em></span> table.
</p>
</div>
<pre class="programlisting">mysql&gt; CREATE TABLESPACE ts1 ADD DATAFILE 'ts1.ibd';
mysql&gt; CREATE TABLESPACE ts2 ADD DATAFILE 'ts2.ibd';
 
mysql&gt; CREATE TABLE t1 ( a INT NOT NULL, PRIMARY KEY (a))
    -&gt;  ENGINE=InnoDB TABLESPACE ts1                            
    -&gt;  PARTITION BY RANGE (a) PARTITIONS 3 (
    -&gt;    PARTITION P1 VALUES LESS THAN (2),
    -&gt;    PARTITION P2 VALUES LESS THAN (4) TABLESPACE `innodb_file_per_table`,
    -&gt;    PARTITION P3 VALUES LESS THAN (6) TABLESPACE `innodb_system`);


mysql&gt; SELECT A.NAME as partition_name, A.SPACE_TYPE as space_type, B.NAME as space_name
    -&gt; FROM INFORMATION_SCHEMA.INNODB_SYS_TABLES A
    -&gt; LEFT JOIN INFORMATION_SCHEMA.INNODB_SYS_TABLESPACES B
    -&gt; ON A.SPACE = B.SPACE WHERE A.NAME LIKE '%t1%' ORDER BY A.NAME; 
+----------------+------------+--------------+
| partition_name | space_type | space_name   |
+----------------+------------+--------------+
| test/t1#P#P1   | General    | ts1          |
| test/t1#P#P2   | Single     | test/t1#P#P2 |
| test/t1#P#P3   | System     | NULL         |
+----------------+------------+--------------+

mysql&gt; ALTER TABLE t1 REORGANIZE PARTITION P1 
    -&gt; INTO (PARTITION P1 VALUES LESS THAN (2) TABLESPACE = `ts2`);
    
mysql&gt; ALTER TABLE t1 REORGANIZE PARTITION P2 
    -&gt; INTO (PARTITION P2 VALUES LESS THAN (4) TABLESPACE = `ts2`);
    
mysql&gt; ALTER TABLE t1 REORGANIZE PARTITION P3 
    -&gt; INTO (PARTITION P3 VALUES LESS THAN (6));

mysql&gt; SELECT A.NAME AS partition_name, A.SPACE_TYPE AS space_type, B.NAME AS space_name
    -&gt; FROM INFORMATION_SCHEMA.INNODB_SYS_TABLES A
    -&gt; LEFT JOIN INFORMATION_SCHEMA.INNODB_SYS_TABLESPACES B
    -&gt; ON A.SPACE = B.SPACE WHERE A.NAME LIKE '%t1%' ORDER BY A.NAME; 
+----------------+------------+------------+
| partition_name | space_type | space_name |
+----------------+------------+------------+
| test/t1#P#P1   | General    | ts2        |
| test/t1#P#P2   | General    | ts2        |
| test/t1#P#P3   | General    | ts1        |
+----------------+------------+------------+</pre>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h4 class="title"><a name="general-tablespaces-dropping"></a>Dropping a General Tablespace</h4>

</div>

</div>

</div>
<p>
        The <a class="link" href="sql-syntax.html#drop-tablespace" title="13.1.30 DROP TABLESPACE Syntax"><code class="literal">DROP TABLESPACE</code></a> statement is
        used to drop an <code class="literal">InnoDB</code> general tablespace.
      </p><p>
        All tables must be dropped from the tablespace prior to a
        <a class="link" href="sql-syntax.html#drop-tablespace" title="13.1.30 DROP TABLESPACE Syntax"><code class="literal">DROP TABLESPACE</code></a> operation. If the
        tablespace is not empty, <a class="link" href="sql-syntax.html#drop-tablespace" title="13.1.30 DROP TABLESPACE Syntax"><code class="literal">DROP
        TABLESPACE</code></a> returns an error.
      </p><p>
        If a <a class="link" href="sql-syntax.html#drop-tablespace" title="13.1.30 DROP TABLESPACE Syntax"><code class="literal">DROP TABLESPACE</code></a> operation on
        an <span class="emphasis"><em>empty</em></span> general tablespace returns an
        error, the tablespace may contain an orphan temporary or
        intermediate table that was left by an
        <a class="link" href="sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a> operation that was
        interrupted by a server exit. For more information, see
        <a class="xref" href="innodb-storage-engine.html#innodb-troubleshooting-datadict" title="14.18.3 Troubleshooting InnoDB Data Dictionary Operations">Section 14.18.3, “Troubleshooting InnoDB Data Dictionary Operations”</a>.
      </p><p>
        A general <code class="literal">InnoDB</code> tablespace is not deleted
        automatically when the last table in the tablespace is dropped.
        The tablespace must be dropped explicitly using
        <a class="link" href="sql-syntax.html#drop-tablespace" title="13.1.30 DROP TABLESPACE Syntax"><code class="literal">DROP TABLESPACE
        <em class="replaceable"><code>tablespace_name</code></em></code></a>.
      </p><p>
        A general tablespace does not belong to any particular database.
        A <a class="link" href="sql-syntax.html#drop-database" title="13.1.22 DROP DATABASE Syntax"><code class="literal">DROP DATABASE</code></a> operation can
        drop tables that belong to a general tablespace but it cannot
        drop the tablespace, even if the <a class="link" href="sql-syntax.html#drop-database" title="13.1.22 DROP DATABASE Syntax"><code class="literal">DROP
        DATABASE</code></a> operation drops all tables that belong to the
        tablespace. A general tablespace must be dropped explicitly
        using <a class="link" href="sql-syntax.html#drop-tablespace" title="13.1.30 DROP TABLESPACE Syntax"><code class="literal">DROP
        TABLESPACE <em class="replaceable"><code>tablespace_name</code></em></code></a>.
      </p><p>
        Similar to the system tablespace, truncating or dropping tables
        stored in a general tablespace creates free space internally in
        the general tablespace <a class="link" href="glossary.html#glos_ibd_file" title=".ibd file">.ibd data
        file</a> which can only be used for new
        <code class="literal">InnoDB</code> data. Space is not released back to
        the operating system as it is when a file-per-table tablespace
        is deleted during a <a class="link" href="sql-syntax.html#drop-table" title="13.1.29 DROP TABLE Syntax"><code class="literal">DROP TABLE</code></a>
        operation.
      </p><p>
        This example demonstrates how to drop an
        <code class="literal">InnoDB</code> general tablespace. The general
        tablespace <code class="literal">ts1</code> is created with a single
        table. The table must be dropped before dropping the tablespace.
      </p><pre class="programlisting">mysql&gt; CREATE TABLESPACE `ts1` ADD DATAFILE 'ts1.ibd' Engine=InnoDB;
Query OK, 0 rows affected (0.01 sec)

mysql&gt; CREATE TABLE t1 (c1 INT PRIMARY KEY) TABLESPACE ts10 Engine=InnoDB;
Query OK, 0 rows affected (0.02 sec)

mysql&gt; DROP TABLE t1;
Query OK, 0 rows affected (0.01 sec)

mysql&gt; DROP TABLESPACE ts1;
Query OK, 0 rows affected (0.01 sec)</pre>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
          <code class="literal"><em class="replaceable"><code>tablespace_name</code></em></code>
          is a case-sensitive identifier in MySQL.
</p>
</div>

</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h4 class="title"><a name="general-tablespaces-limitations"></a>General Tablespace Limitations</h4>

</div>

</div>

</div>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            A generated or existing tablespace cannot be changed to a
            general tablespace.
          </p></li><li class="listitem"><p>
            Creation of temporary general tablespaces is not supported.
          </p></li><li class="listitem"><p>
            General tablespaces do not support temporary tables.
          </p></li><li class="listitem"><p>
            Partitioned <code class="literal">InnoDB</code> tables, and using the
            <code class="literal">TABLESPACE=<em class="replaceable"><code>tablespace_name</code></em></code>
            to assign individual table partitions or subpartitions to a
            general tablespace, are only supported in MySQL 5.7.8 or
            higher.
          </p></li><li class="listitem"><p>
            Tables stored in a general tablespace may only be opened in
            MySQL 5.7.6 or later.
          </p></li><li class="listitem"><p>
            Similar to the system tablespace, truncating or dropping
            tables stored in a general tablespace creates free space
            internally in the general tablespace
            <a class="link" href="glossary.html#glos_ibd_file" title=".ibd file">.ibd data file</a> which
            can only be used for new <code class="literal">InnoDB</code> data.
            Space is not released back to the operating system as it is
            for file-per-table tablespaces.
          </p></li><li class="listitem"><p>
            <a class="link" href="sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE Syntax"><code class="literal">ALTER TABLE ...
            DISCARD TABLESPACE</code></a> and
            <a class="link" href="sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE Syntax"><code class="literal">ALTER TABLE
            ...IMPORT TABLESPACE</code></a> are not supported for tables
            that belong to a general tablespace.
          </p></li><li class="listitem"><p>
            General tablespaces created on Windows using a relative data
            file path cannot be opened on Unix-like systems. This
            limitation is removed in MySQL 5.7.8 (Bug #20555168).
          </p></li><li class="listitem"><p>
            In MySQL 5.7.6 and MySQL 5.7.7, tables stored in general
            tablespaces may not open (due to a missing general
            tablespace file) after moving the MySQL data directory to a
            new location. This limitation is addressed in MySQL 5.7.8
            with the introduction of
            <a class="link" href="glossary.html#glos_isl_file" title=".isl file">isl</a> files for general
            tablespaces created outside of the MySQL data directory (Bug
            #20563954).
</p></li></ul>
</div>
<p>
        For more information see <a class="xref" href="sql-syntax.html#create-tablespace" title="13.1.19 CREATE TABLESPACE Syntax">Section 13.1.19, “CREATE TABLESPACE Syntax”</a>.
</p>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="innodb-tablespace-encryption"></a>14.4.10 InnoDB Tablespace Encryption</h3>

</div>

</div>

</div>
<a class="indexterm" name="idm140644113493232"></a><p>
      As of MySQL 5.7.11, <code class="literal">InnoDB</code> supports data
      encryption for <code class="literal">InnoDB</code> tables stored in
      <a class="link" href="glossary.html#glos_file_per_table" title="file-per-table">file-per-table</a>
      tablespaces. This feature provides at-rest encryption for physical
      tablespace data files.
    </p><p>
      <code class="literal">InnoDB</code> tablespace encryption uses a two tier
      encryption key architecture, consisting of a master encryption key
      and tablespace keys. When an <code class="literal">InnoDB</code> table is
      encrypted, a tablespace key is encrypted and stored in the
      tablespace header. When an application or authenticated user wants
      to access encrypted tablespace data, <code class="literal">InnoDB</code>
      uses the master encryption key to decrypt the tablespace key. The
      master encryption key is stored in a <code class="filename">keyring</code>
      file in the location specified by the
      <a class="link" href="server-administration.html#sysvar_keyring_file_data"><code class="literal">keyring_file_data</code></a> configuration
      option. The decrypted version of a tablespace key never changes,
      but the master encryption key may be changed as required. This
      action is referred to as <span class="emphasis"><em>master key rotation</em></span>.
    </p><p>
      <code class="literal">InnoDB</code> tablespace encryption supports the
      Advanced Encryption Standard (AES) block-based encryption
      algorithm. It uses Electronic Codebook (ECB) block encryption mode
      for tablespace key encryption and Cipher Block Chaining (CBC)
      block encryption mode for data encryption.
</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
        The <code class="literal">InnoDB</code> tablespace encryption feature
        provided with MySQL Community Edition is not intended as a
        regulatory compliance solution. Security standards such as PCI,
        FIPS, and others require use of Key Management Systems to
        secure, manage, and protect keys in Key Vaults or Hardware
        Security Modules (HSMs).
</p>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h4 class="title"><a name="innodb-tablespace-encryption-encryption-prerequisites"></a>InnoDB Tablespace Encryption Prerequisites</h4>

</div>

</div>

</div>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            The <code class="literal">keyring_file</code> plugin must be
            installed. This can be done using the
            <a class="link" href="server-administration.html#option_mysqld_early-plugin-load"><code class="option">--early-plugin-load</code></a> option
            (see <a class="xref" href="security.html#keyring" title="6.4.3 The MySQL Keyring">Section 6.4.3, “The MySQL Keyring”</a>). Early loading ensures that
            the plugin is available prior to initialization of the
            <code class="literal">InnoDB</code> storage engine and enables
            <code class="literal">InnoDB</code> to use the keyring service.
</p>
<div class="important" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Important
</div>
<p>
              Once encrypted tables are created in a MySQL instance, the
              <code class="literal">keyring_file</code> plugin must continue to be
              loaded prior to <code class="literal">InnoDB</code> initialization
              using the
              <a class="link" href="server-administration.html#option_mysqld_early-plugin-load"><code class="option">--early-plugin-load</code></a> option.
              Failing to do so results in errors on startup and during
              <code class="literal">InnoDB</code> recovery.
</p>
</div>
<p>
            To verify that the <code class="literal">keyring_file</code> plugin is
            active, use the <a class="link" href="sql-syntax.html#show-plugins" title="13.7.5.25 SHOW PLUGINS Syntax"><code class="literal">SHOW PLUGINS</code></a>
            statement or query the
            <a class="link" href="information-schema.html#plugins-table" title="21.16 The INFORMATION_SCHEMA PLUGINS Table"><code class="literal">INFORMATION_SCHEMA.PLUGINS</code></a>
            table:
          </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT PLUGIN_NAME, PLUGIN_STATUS FROM INFORMATION_SCHEMA.PLUGINS</code></strong>
    -&gt; <strong class="userinput"><code>WHERE plugin_name='keyring_file';</code></strong>
+--------------+---------------+
| PLUGIN_NAME  | PLUGIN_STATUS |
+--------------+---------------+
| keyring_file | ACTIVE        |
+--------------+---------------+</pre></li><li class="listitem"><p>
            The <a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_per_table"><code class="literal">innodb_file_per_table</code></a>
            option must be enabled (the default).
            <code class="literal">InnoDB</code> tablespace encryption only
            supports
            <a class="link" href="glossary.html#glos_file_per_table" title="file-per-table">file-per-table</a>
            tablespaces. Alternatively, you can specify the
            <code class="literal">TABLESPACE='innodb_file_per_table'</code> option
            when creating an encrypted table or altering an existing
            table to enable encryption.
</p></li></ul>
</div>

</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h4 class="title"><a name="innodb-tablespace-encryption-enabling-disabling"></a>Enabling and Disabling InnoDB Tablespace Encryption</h4>

</div>

</div>

</div>
<p>
        To enable encryption for a new <code class="literal">InnoDB</code> table,
        specify the <code class="literal">ENCRYPTION</code> option in a
        <a class="link" href="sql-syntax.html#create-table" title="13.1.18 CREATE TABLE Syntax"><code class="literal">CREATE TABLE</code></a> statement.
      </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>CREATE TABLE t1 (c1 INT) ENCRYPTION='Y';</code></strong></pre><p>
        To enable encryption for an existing <code class="literal">InnoDB</code>
        table, specify the <code class="literal">ENCRYPTION</code> option in an
        <a class="link" href="sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a> statement.
      </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>ALTER TABLE t1 ENCRYPTION='Y';</code></strong></pre><p>
        To disable encryption for an <code class="literal">InnoDB</code> table,
        set <code class="literal">ENCRYPTION='N'</code> using
        <a class="link" href="sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a>.
</p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>ALTER TABLE t1 ENCRYPTION='N';</code></strong></pre>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
          Plan appropriately when altering an existing table with the
          <code class="literal">ENCRYPTION</code> option.
          <a class="link" href="sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE Syntax"><code class="literal">ALTER TABLE ...
          ENCRYPTION</code></a> operations rebuild the table using
          <code class="literal">ALGORITHM=COPY</code>.
          <code class="literal">ALGORITM=INPLACE</code> is not supported.
</p>
</div>

</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h4 class="title"><a name="innodb-tablespace-encryption-master-key-rotation"></a>InnoDB Tablespace Encryption and Master Key Rotation</h4>

</div>

</div>

</div>
<p>
        The master encryption key should be rotated periodically and
        whenever you suspect that the key may have been compromised.
      </p><p>
        Master key rotation is an atomic, instance-level operation. Each
        time the master encryption key is rotated, all tablespace keys
        in the MySQL instance are re-encrypted and saved back to their
        respective tablespace headers. As an atomic operation,
        re-encryption must succeed for all tablespace keys once a
        rotation operation is initiated. If master key rotation is
        interrupted by a server failure, <code class="literal">InnoDB</code> rolls
        the operation forward on server restart. For more information,
        see <a class="xref" href="innodb-storage-engine.html#innodb-tablespace-encryption-recovery" title="InnoDB Tablespace Encryption and Recovery">InnoDB Tablespace Encryption and Recovery</a>.
      </p><p>
        Rotating the master encryption key only changes the master
        encryption key and re-encrypts tablespace keys. It does not
        decrypt or re-encrypt associated tablespace data.
      </p><p>
        Rotating the master encryption key requires the
        <a class="link" href="security.html#priv_super"><code class="literal">SUPER</code></a> privilege.
      </p><p>
        To rotate the master encryption key, run:
      </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>ALTER INSTANCE ROTATE INNODB MASTER KEY;</code></strong></pre><p>
        <a class="link" href="sql-syntax.html#alter-instance" title="13.1.5 ALTER INSTANCE Syntax"><code class="literal">ALTER INSTANCE
        ROTATE INNODB MASTER KEY</code></a> supports concurrent DML.
        However, it cannot be run concurrently with
        <a class="link" href="sql-syntax.html#create-table" title="13.1.18 CREATE TABLE Syntax"><code class="literal">CREATE TABLE ...
        ENCRYPTED</code></a> or
        <a class="link" href="sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE Syntax"><code class="literal">ALTER TABLE ...
        ENCRYPTED</code></a> operations, and locks are taken to prevent
        conflicts that could arise from concurrent execution of these
        statements. If one of the conflicting statements is running, it
        must complete before another can proceed.
</p>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h4 class="title"><a name="innodb-tablespace-encryption-recovery"></a>InnoDB Tablespace Encryption and Recovery</h4>

</div>

</div>

</div>
<p>
        If a server failure occurs during master key rotation,
        <code class="literal">InnoDB</code> continues the operation on server
        restart.
      </p><p>
        The <code class="literal">keyring_file</code> plugin must be loaded prior
        to storage engine initialization so that the information
        necessary to decrypt tablespace data pages can be retrieved from
        tablespace headers before <code class="literal">InnoDB</code>
        initialization and recovery activities access tablespace data.
        (See
        <a class="xref" href="innodb-storage-engine.html#innodb-tablespace-encryption-encryption-prerequisites" title="InnoDB Tablespace Encryption Prerequisites">InnoDB Tablespace Encryption Prerequisites</a>.)
      </p><p>
        When <code class="literal">InnoDB</code> initialization and recovery
        begin, the master key rotation operation resumes. Due to the
        server failure, some tablespaces keys may already be encrypted
        using the new master encryption key. <code class="literal">InnoDB</code>
        reads the encryption data from each tablespace header, and if
        the data indicates that the tablespace key is encrypted using
        the old master encryption key, <code class="literal">InnoDB</code>
        retrieves the old key from the <code class="filename">keyring</code> file
        and uses it to decrypt the tablepace key.
        <code class="literal">InnoDB</code> then re-encrypts the tablespace key
        using the new master encryption key and saves the re-encrypted
        tablespace key back to the tablespace header.
</p>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h4 class="title"><a name="innodb-tablespace-encryption-exporting"></a>Exporting Encrypted Tables</h4>

</div>

</div>

</div>
<p>
        When an encrypted table is exported, <code class="literal">InnoDB</code>
        generates a <span class="emphasis"><em>transfer key</em></span> that is used to
        encrypt the tablespace key. The encrypted tablespace key and
        transfer key are stored in a
        <code class="filename"><em class="replaceable"><code>tablespace_name</code></em>.cfp</code>
        file. This file together with the encrypted tablespace file is
        required to perform an import operation. On import,
        <code class="literal">InnoDB</code> uses the transfer key to decrypt the
        tablespace key in the
        <code class="filename"><em class="replaceable"><code>tablespace_name</code></em>.cfp</code>
        file. For related information, see
        <a class="xref" href="innodb-storage-engine.html#tablespace-copying" title="14.4.6 Copying File-Per-Table Tablespaces to Another Server">Section 14.4.6, “Copying File-Per-Table Tablespaces to Another Server”</a>.
</p>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h4 class="title"><a name="innodb-tablespace-encryption-replication"></a>InnoDB Tablespace Encryption and Replication</h4>

</div>

</div>

</div>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            The <a class="link" href="sql-syntax.html#alter-instance" title="13.1.5 ALTER INSTANCE Syntax"><code class="literal">ALTER
            INSTANCE ROTATE INNODB MASTER KEY</code></a> statement is
            only supported in replication environments where the master
            and slaves run a version of MySQL that supports the
            tablespace encryption feature.
          </p></li><li class="listitem"><p>
            Successful
            <a class="link" href="sql-syntax.html#alter-instance" title="13.1.5 ALTER INSTANCE Syntax"><code class="literal">ALTER
            INSTANCE ROTATE INNODB MASTER KEY</code></a> statements are
            written to the binary log for replication on slaves.
          </p></li><li class="listitem"><p>
            If an <a class="link" href="sql-syntax.html#alter-instance" title="13.1.5 ALTER INSTANCE Syntax"><code class="literal">ALTER
            INSTANCE ROTATE INNODB MASTER KEY</code></a> statement fails,
            it is not logged to the binary log and is not replicated on
            slaves.
          </p></li><li class="listitem"><p>
            Replication of an
            <a class="link" href="sql-syntax.html#alter-instance" title="13.1.5 ALTER INSTANCE Syntax"><code class="literal">ALTER
            INSTANCE ROTATE INNODB MASTER KEY</code></a> operation fails
            if a <code class="literal">keyring_file</code> plugin is installed on
            the master but not on the slave.
          </p></li><li class="listitem"><p>
            If the <code class="literal">keyring_file</code> plugin is installed
            on both the master and a slave but the slave does not have a
            <code class="filename">keyring</code> file, the replicated
            <a class="link" href="sql-syntax.html#alter-instance" title="13.1.5 ALTER INSTANCE Syntax"><code class="literal">ALTER
            INSTANCE ROTATE INNODB MASTER KEY</code></a> statement
            creates the <code class="filename">keyring</code> file on the slave,
            assuming the <code class="filename">keyring</code> file data is not
            cached in memory.
            <a class="link" href="sql-syntax.html#alter-instance" title="13.1.5 ALTER INSTANCE Syntax"><code class="literal">ALTER
            INSTANCE ROTATE INNODB MASTER KEY</code></a> will use
            <code class="filename">keyring</code> file data that is cached in
            memory, if available.
</p></li></ul>
</div>

</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h4 class="title"><a name="innodb-tablespace-encryption-identifying"></a>Identifying Tables that Use InnoDB Tablespace Encryption</h4>

</div>

</div>

</div>
<p>
        When the <code class="literal">ECRYPTION</code> option is specified in a
        <a class="link" href="sql-syntax.html#create-table" title="13.1.18 CREATE TABLE Syntax"><code class="literal">CREATE TABLE</code></a> or
        <a class="link" href="sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a> statement, it is
        recorded in the <code class="literal">CREATE_OPTIONS</code> field of
        <a class="link" href="information-schema.html#tables-table" title="21.24 The INFORMATION_SCHEMA TABLES Table"><code class="literal">INFORMATION_SCHEMA.TABLES</code></a>. This
        field may be queried to identify encrypted tables in a MySQL
        instance.
      </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT TABLE_SCHEMA, TABLE_NAME, CREATE_OPTIONS FROM INFORMATION_SCHEMA.TABLES</code></strong> 
    -&gt; <strong class="userinput"><code>WHERE CREATE_OPTIONS like 'ENCRYPTION="Y"';</code></strong>
+--------------+------------+----------------+
| TABLE_SCHEMA | TABLE_NAME | CREATE_OPTIONS |
+--------------+------------+----------------+
| test         | t1         | ENCRYPTION="Y" |
+--------------+------------+----------------+</pre>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h4 class="title"><a name="innodb-tablespace-encryption-usage-notes"></a>InnoDB Tablespace Encryption Usage Notes</h4>

</div>

</div>

</div>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            The first master encryption key is generated when the first
            new or existing table is encrypted. If a
            <code class="filename">keyring</code> file is empty or missing, the
            first execution of
            <a class="link" href="sql-syntax.html#alter-instance" title="13.1.5 ALTER INSTANCE Syntax"><code class="literal">ALTER
            INSTANCE ROTATE INNODB MASTER KEY</code></a> also creates a
            master encryption key.
          </p></li><li class="listitem"><p>
            Uninstalling the <code class="literal">keyring_file</code> plugin does
            not remove an existing <code class="filename">keyring</code> file.
          </p></li><li class="listitem"><p>
            Losing the <code class="filename">keyring</code> file that contains
            the master encryption key will result in the loss of data
            stored in encrypted tablespace files. It is recommended that
            you create a separate backup of the
            <code class="filename">keyring</code> file immediately after you
            create the first encrypted table and before and after master
            key rotation.
          </p></li><li class="listitem"><p>
            It is recommended that you not place the
            <code class="literal">keyring</code> file under the same directory as
            tablespace data files. The location of the
            <code class="filename">keyring</code> file is specified by the
            <a class="link" href="server-administration.html#sysvar_keyring_file_data"><code class="literal">keyring_file_data</code></a> option.
          </p></li><li class="listitem"><p>
            If the server exits or is stopped during normal operation,
            it is recommended to restart the server using the same
            encryption settings that were configured previously.
          </p></li><li class="listitem"><p>
            Modifying the
            <a class="link" href="server-administration.html#sysvar_keyring_file_data"><code class="literal">keyring_file_data</code></a> option at
            runtime or restarting the server with a new
            <a class="link" href="server-administration.html#sysvar_keyring_file_data"><code class="literal">--keyring_file_data</code></a> setting
            can cause previously encrypted tables to become
            inaccessible, resulting in the loss of data.
          </p></li><li class="listitem"><p>
            Master key rotation re-encrypts tablespaces keys but does
            not change the tablespace key itself. To change a tablespace
            key, you must disable and re-enable table encryption using
            <a class="link" href="sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE Syntax"><code class="literal">ALTER TABLE
            <em class="replaceable"><code>tbl_name</code></em> ENCRYPTION</code></a>,
            which is an <code class="literal">ALGORITHM=COPY</code> operation that
            rebuilds the table.
          </p></li><li class="listitem"><p>
            If a table is created with both the
            <a class="link" href="sql-syntax.html#create-table" title="13.1.18 CREATE TABLE Syntax"><code class="literal">COMPRESSION</code></a>
            and
            <a class="link" href="sql-syntax.html#create-table" title="13.1.18 CREATE TABLE Syntax"><code class="literal">ENCRYPTION</code></a>
            options, compression is performed before the tablespace data
            is encrypted.
</p></li></ul>
</div>

</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h4 class="title"><a name="innodb-tablespace-encryption-limitations"></a>InnoDB Tablespace Encryption Limitations</h4>

</div>

</div>

</div>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            Advanced Encryption Standard (AES) is the only supported
            encryption algorithm. <code class="literal">InnoDB</code> tablespace
            encryption uses Electronic Codebook (ECB) block encryption
            mode for tablespace key encryption and Cipher Block Chaining
            (CBC) block encryption mode for data encryption.
          </p></li><li class="listitem"><p>
            <code class="literal">ALGORITHM=INPLACE</code> operations are not
            supported on encrypted tables.
          </p></li><li class="listitem"><p>
            <code class="literal">ALGORITHM=INPLACE</code> is not supported for
            <a class="link" href="sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE Syntax"><code class="literal">ALTER TABLE ...
            ENCRYPTION</code></a> operations.
          </p></li><li class="listitem"><p>
            <code class="literal">InnoDB</code> tablespace encryption only
            supports <code class="literal">InnoDB</code> tables that are stored in
            a <a class="link" href="glossary.html#glos_file_per_table" title="file-per-table">file-per-table</a>
            tablespaces. Encryption is not supported for tables stored
            in other <code class="literal">InnoDB</code> tablespace types
            including <a class="link" href="glossary.html#glos_general_tablespace" title="general tablespace">general
            tablespaces</a>, the
            <a class="link" href="glossary.html#glos_system_tablespace" title="system tablespace">system
            tablespace</a>, undo log tablespaces, and the temporary
            tablespace.
          </p></li><li class="listitem"><p>
            You cannot move or copy an encrypted table from a
            <a class="link" href="glossary.html#glos_file_per_table" title="file-per-table">file-per-table</a>
            tablespace to an unsupported <code class="literal">InnoDB</code>
            tablespace type.
          </p></li><li class="listitem"><p>
            Tablespace encryption only applies to the tablespace.
            Tablespace data is not encrypted in the redo log, undo log,
            or binary log.
</p></li></ul>
</div>

</div>

</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="innodb-tables"></a>14.5 InnoDB Table Management</h2>

</div>

</div>

</div>
<div class="toc">
<dl class="toc"><dt><span class="section"><a href="innodb-storage-engine.html#using-innodb-tables">14.5.1 Creating InnoDB Tables</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-migration">14.5.2 Moving or Copying InnoDB Tables to Another Machine</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-transactions-with-different-apis">14.5.3 Grouping DML Operations with Transactions</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#converting-tables-to-innodb">14.5.4 Converting Tables from MyISAM to InnoDB</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-auto-increment-handling">14.5.5 AUTO_INCREMENT Handling in InnoDB</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-foreign-key-constraints">14.5.6 InnoDB and FOREIGN KEY Constraints</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-restrictions">14.5.7 Limits on InnoDB Tables</a></span></dt></dl>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="using-innodb-tables"></a>14.5.1 Creating InnoDB Tables</h3>

</div>

</div>

</div>
<a class="indexterm" name="idm140644113337840"></a><p>
      To create an <code class="literal">InnoDB</code> table, use the
      <a class="link" href="sql-syntax.html#create-table" title="13.1.18 CREATE TABLE Syntax"><code class="literal">CREATE TABLE</code></a> statement. You do not
      need to specify the <code class="literal">ENGINE=InnoDB</code> clause if
      <code class="literal">InnoDB</code> is defined as the default storage
      engine, which is the default as of MySQL 5.5. You might still use
      <code class="literal">ENGINE=InnoDB</code> clause if you plan to use
      <a class="link" href="programs.html#mysqldump" title="4.5.4 mysqldump — A Database Backup Program"><span class="command"><strong>mysqldump</strong></span></a> or replication to replay the
      <a class="link" href="sql-syntax.html#create-table" title="13.1.18 CREATE TABLE Syntax"><code class="literal">CREATE TABLE</code></a> statement on a server
      where the default storage engine is not <code class="literal">InnoDB</code>.
    </p><pre class="programlisting">
-- Default storage engine = InnoDB.
CREATE TABLE t1 (a INT, b CHAR (20), PRIMARY KEY (a));
-- Backward-compatible with older MySQL.
CREATE TABLE t2 (a INT, b CHAR (20), PRIMARY KEY (a)) ENGINE=InnoDB;
</pre><p>
      An <code class="literal">InnoDB</code> table and its indexes can be created
      in the <a class="link" href="glossary.html#glos_system_tablespace" title="system tablespace">system
      tablespace</a>, in a
      <a class="link" href="glossary.html#glos_file_per_table" title="file-per-table">file-per-table</a>
      tablespace, or in a
      <a class="link" href="glossary.html#glos_general_tablespace" title="general tablespace">general tablespace</a>
      (introduced in MySQL 5.7.6). When
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_per_table"><code class="literal">innodb_file_per_table</code></a> is enabled,
      which is the default setting as of MySQL 5.6.6, an
      <code class="literal">InnoDB</code> table is implicitly created in an
      individual file-per-table tablespace. Conversely, when
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_per_table"><code class="literal">innodb_file_per_table</code></a> is
      disabled, an <code class="literal">InnoDB</code> table is implicitly created
      in the system tablespace. With the introduction of general
      tablespaces in MySQL 5.7.6, you can use
      <a class="link" href="sql-syntax.html#create-table" title="13.1.18 CREATE TABLE Syntax"><code class="literal">CREATE TABLE ...
      TABLESPACE</code></a> syntax to explicitly create an
      <code class="literal">InnoDB</code> table in any of the three tablespace
      types.
    </p><p>
      When you create an <code class="literal">InnoDB</code> table, MySQL creates
      a <a class="link" href="glossary.html#glos_frm_file" title=".frm file">.frm file</a> in a database
      directory under the MySQL data directory. For a table created in a
      file-per-table tablespace, an <a class="link" href="glossary.html#glos_ibd_file" title=".ibd file">.ibd
      file</a> is also created. A table created in the system
      tablespace is created in the existing system tablespace
      <a class="link" href="glossary.html#glos_ibd_file" title=".ibd file">ibdata files</a>. A table created
      in a general tablespace is created in an existing general
      tablespace <a class="link" href="glossary.html#glos_ibd_file" title=".ibd file">.ibd file</a>.
    </p><p>
      Internally, <code class="literal">InnoDB</code> adds an entry for each table
      to the <code class="literal">InnoDB</code> data dictionary. The entry
      includes the database name. For example, if table
      <code class="literal">t1</code> is created in the <code class="literal">test</code>
      database, the data dictionary entry is
      <code class="literal">'test/t1'</code>. This means you can create a table of
      the same name (<code class="literal">t1</code>) in a different database, and
      the table names do not collide inside <code class="literal">InnoDB</code>.
</p>
<h4><a name="idm140644113307152"></a>Viewing the Properties of InnoDB Tables</h4>
<p>
      To view the properties of <code class="literal">InnoDB</code> tables, issue
      a <a class="link" href="sql-syntax.html#show-table-status" title="13.7.5.36 SHOW TABLE STATUS Syntax"><code class="literal">SHOW TABLE STATUS</code></a> statement:
    </p><pre class="programlisting">mysql &gt; SHOW TABLE STATUS FROM test LIKE 't%' \G;
*************************** 1. row ***************************
           Name: t1
         Engine: InnoDB
        Version: 10
     Row_format: Compact
           Rows: 0
 Avg_row_length: 0
    Data_length: 16384
Max_data_length: 0
   Index_length: 0
      Data_free: 0
 Auto_increment: NULL
    Create_time: 2015-03-16 15:13:31
    Update_time: NULL
     Check_time: NULL
      Collation: latin1_swedish_ci
       Checksum: NULL
 Create_options: 
        Comment: 
1 row in set (0.00 sec)</pre><p>
      In the status output, you see the
      <a class="link" href="glossary.html#glos_row_format" title="row format">Row format</a> property of
      table <code class="literal">t1</code> is <code class="literal">Compact</code>. The
      <code class="literal"><a class="link" href="glossary.html#glos_dynamic_row_format" title="dynamic row format">Dynamic</a></code>
      or
      <code class="literal"><a class="link" href="glossary.html#glos_compressed_row_format" title="compressed row format">Compressed</a></code>
      row format is required take advantage of <code class="literal">InnoDB</code>
      features such as table compression and off-page storage for long
      column values. To use these row formats, you can enable
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_per_table"><code class="literal">innodb_file_per_table</code></a> (the
      default as of MySQL 5.6.6) and set
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_format"><code class="literal">innodb_file_format</code></a> to
      <a class="link" href="glossary.html#glos_barracuda" title="Barracuda">Barracuda</a>, which implicitly
      creates <code class="literal">InnoDB</code> tables in file-per-table
      tablespaces:
    </p><pre class="programlisting">SET GLOBAL innodb_file_per_table=1;
SET GLOBAL innodb_file_format=barracuda;
CREATE TABLE t3 (a INT, b CHAR (20), PRIMARY KEY (a)) ROW_FORMAT=DYNAMIC;
CREATE TABLE t4 (a INT, b CHAR (20), PRIMARY KEY (a)) ROW_FORMAT=COMPRESSED;</pre><p>
      Or, you can use
      <a class="link" href="sql-syntax.html#create-table" title="13.1.18 CREATE TABLE Syntax"><code class="literal">CREATE TABLE ...
      TABLESPACE</code></a> syntax to create an <code class="literal">InnoDB</code>
      table in a general tablespace. General tablespaces support all row
      formats. For more information, see
      <a class="xref" href="innodb-storage-engine.html#general-tablespaces" title="14.4.9 InnoDB General Tablespaces">Section 14.4.9, “InnoDB General Tablespaces”</a>.
    </p><pre class="programlisting">CREATE TABLE t1 (c1 INT PRIMARY KEY) TABLESPACE ts1 ROW_FORMAT=DYNAMIC;</pre><p>
      <a class="link" href="sql-syntax.html#create-table" title="13.1.18 CREATE TABLE Syntax"><code class="literal">CREATE TABLE ...
      TABLESPACE</code></a> syntax can also be used to create
      <code class="literal">InnoDB</code> tables with a <code class="literal">Dynamic</code>
      row format in the system tablespace, along side tables with a
      <code class="literal">Compact</code> or <code class="literal">Redundant</code> row
      format.
    </p><pre class="programlisting">CREATE TABLE t1 (c1 INT PRIMARY KEY) TABLESPACE = innodb_system ROW_FORMAT=DYNAMIC;</pre><p>
      <code class="literal">InnoDB</code> table properties may also be queried
      using the <code class="literal">InnoDB</code> Information Schema system
      tables:
    </p><pre class="programlisting">SELECT * FROM INFORMATION_SCHEMA.INNODB_SYS_TABLES WHERE NAME='test/t1' \G
*************************** 1. row ***************************
     TABLE_ID: 45
         NAME: test/t1
         FLAG: 1
       N_COLS: 5
        SPACE: 35
  FILE_FORMAT: Antelope
   ROW_FORMAT: Compact
ZIP_PAGE_SIZE: 0
   SPACE_TYPE: Single
1 row in set (0.00 sec)</pre>
<h4><a name="idm140644113278800"></a>Defining a Primary Key for InnoDB Tables</h4>
<p>
      Always set up a <a class="link" href="glossary.html#glos_primary_key" title="primary key">primary
      key</a> for each <code class="literal">InnoDB</code> table, specifying
      the column or columns that:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          Are referenced by the most important queries.
        </p></li><li class="listitem"><p>
          Are never left blank.
        </p></li><li class="listitem"><p>
          Never have duplicate values.
        </p></li><li class="listitem"><p>
          Rarely if ever change value once inserted.
</p></li></ul>
</div>
<p>
      For example, in a table containing information about people, you
      would not create a primary key on <code class="literal">(firstname,
      lastname)</code> because more than one person can have the same
      name, some people have blank last names, and sometimes people
      change their names. With so many constraints, often there is not
      an obvious set of columns to use as a primary key, so you create a
      new column with a numeric ID to serve as all or part of the
      primary key. You can declare an
      <a class="link" href="glossary.html#glos_auto_increment" title="auto-increment">auto-increment</a> column
      so that ascending values are filled in automatically as rows are
      inserted:
    </p><pre class="programlisting">
-- The value of ID can act like a pointer between related items in different tables.
CREATE TABLE t5 (id INT AUTO_INCREMENT, b CHAR (20), PRIMARY KEY (id));
-- The primary key can consist of more than one column. Any autoinc column must come first.
CREATE TABLE t6 (id INT AUTO_INCREMENT, a INT, b CHAR (20), PRIMARY KEY (id,a));
</pre><p>
      Although the table works correctly without defining a primary key,
      the primary key is involved with many aspects of performance and
      is a crucial design aspect for any large or frequently used table.
      It is recommended that you always specify a primary key in the
      <a class="link" href="sql-syntax.html#create-table" title="13.1.18 CREATE TABLE Syntax"><code class="literal">CREATE TABLE</code></a> statement. If you
      create the table, load data, and then run
      <a class="link" href="sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a> to add a primary key
      later, that operation is much slower than defining the primary key
      when creating the table.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="innodb-migration"></a>14.5.2 Moving or Copying InnoDB Tables to Another Machine</h3>

</div>

</div>

</div>
<a class="indexterm" name="idm140644113264144"></a><p>
    This section describes techniques for moving or copying some or all
    <code class="literal">InnoDB</code> tables to a different server. For example,
    you might move an entire MySQL instance to a larger, faster server;
    you might clone an entire MySQL instance to a new replication slave
    server; you might copy individual tables to another server to
    develop and test an application, or to a data warehouse server to
    produce reports.
  </p><p>
    Techniques for moving or copying <code class="literal">InnoDB</code> tables
    include:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
        <a class="xref" href="innodb-storage-engine.html#copy-tables-transportable-tablespaces" title="Transportable Tablespaces">Transportable Tablespaces</a>
      </p></li><li class="listitem"><p>
        <a class="xref" href="innodb-storage-engine.html#copy-tables-meb" title="MySQL Enterprise Backup">MySQL Enterprise Backup</a>
      </p></li><li class="listitem"><p>
        <a class="xref" href="innodb-storage-engine.html#copy-tables-cold-backup" title="Copying Data Files (Cold Backup Method)">Copying Data Files (Cold Backup Method)</a>
      </p></li><li class="listitem"><p>
        <a class="xref" href="innodb-storage-engine.html#copy-tables-export-import" title="Export and Import (mysqldump)">Export and Import (mysqldump)</a>
</p></li></ul>
</div>
<h4><a name="idm140644113253232"></a>Using Lowercase Names for Cross-Platform Moving or Copying</h4>
<p>
    On Windows, <code class="literal">InnoDB</code> always stores database and
    table names internally in lowercase. To move databases in a binary
    format from Unix to Windows or from Windows to Unix, create all
    databases and tables using lowercase names. A convenient way to
    accomplish this is to add the following line to the
    <code class="literal">[mysqld]</code> section of your
    <code class="filename">my.cnf</code> or <code class="filename">my.ini</code> file
    before creating any databases or tables:
  </p><pre class="programlisting">
[mysqld]
lower_case_table_names=1
</pre>
<h4><a name="copy-tables-transportable-tablespaces"></a>Transportable Tablespaces</h4>
<p>
    Introduced in MySQL 5.6.6, the transportable tablespaces feature
    uses <a class="link" href="sql-syntax.html#flush" title="13.7.6.3 FLUSH Syntax"><code class="literal">FLUSH TABLES ... FOR
    EXPORT</code></a> to ready <code class="literal">InnoDB</code> tables for
    copying from one server instance to another. To use this feature,
    <code class="literal">InnoDB</code> tables must be created with
    <a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_per_table"><code class="literal">innodb_file_per_table</code></a> set to
    <code class="literal">ON</code> so that each <code class="literal">InnoDB</code> table
    has its own tablespace. For usage information, see
    <a class="xref" href="innodb-storage-engine.html#tablespace-copying" title="14.4.6 Copying File-Per-Table Tablespaces to Another Server">Section 14.4.6, “Copying File-Per-Table Tablespaces to Another Server”</a>.
</p>
<h4><a name="copy-tables-meb"></a>MySQL Enterprise Backup</h4>
<p>
    The MySQL Enterprise Backup product lets you back up a running MySQL
    database, including <code class="literal">InnoDB</code> and
    <code class="literal">MyISAM</code> tables, with minimal disruption to
    operations while producing a consistent snapshot of the database.
    When MySQL Enterprise Backup is copying <code class="literal">InnoDB</code>
    tables, reads and writes to both <code class="literal">InnoDB</code> and
    <code class="literal">MyISAM</code> tables can continue. During the copying of
    <code class="literal">MyISAM</code> and other non-InnoDB tables, reads (but
    not writes) to those tables are permitted. In addition, MySQL
    Enterprise Backup can create compressed backup files, and back up
    subsets of <code class="literal">InnoDB</code> tables. In conjunction with the
    MySQL binary log, you can perform point-in-time recovery. MySQL
    Enterprise Backup is included as part of the MySQL Enterprise
    subscription.
  </p><p>
    For more details about MySQL Enterprise Backup, see
    <a class="xref" href="mysql-enterprise.html#mysql-enterprise-backup" title="26.2 MySQL Enterprise Backup Overview">Section 26.2, “MySQL Enterprise Backup Overview”</a>.
</p>
<h4><a name="copy-tables-cold-backup"></a>Copying Data Files (Cold Backup Method)</h4>
<p>
    You can move an <code class="literal">InnoDB</code> database simply by copying
    all the relevant files listed under "Cold Backups" in
    <a class="xref" href="innodb-storage-engine.html#innodb-backup" title="14.15 InnoDB Backup and Recovery">Section 14.15, “InnoDB Backup and Recovery”</a>.
  </p><p>
    Like <code class="literal">MyISAM</code> data files, <code class="literal">InnoDB</code>
    data and log files are binary-compatible on all platforms having the
    same floating-point number format. If the floating-point formats
    differ but you have not used <a class="link" href="data-types.html#floating-point-types" title="11.2.3 Floating-Point Types (Approximate Value) - FLOAT, DOUBLE"><code class="literal">FLOAT</code></a> or
    <a class="link" href="data-types.html#floating-point-types" title="11.2.3 Floating-Point Types (Approximate Value) - FLOAT, DOUBLE"><code class="literal">DOUBLE</code></a> data types in your tables,
    then the procedure is the same: simply copy the relevant files.
</p>
<h4><a name="idm140644113224448"></a>Portability Considerations for File-Per-Table .ibd Files</h4>
<p>
    When you move or copy file-per-table <code class="filename">.ibd</code>
    files, the database directory name must be the same on the source
    and destination systems. The table definition stored in the
    <code class="literal">InnoDB</code> shared tablespace includes the database
    name. The transaction IDs and log sequence numbers stored in the
    tablespace files also differ between databases.
  </p><p>
    To move an <code class="filename">.ibd</code> file and the associated table
    from one database to another, use a <a class="link" href="sql-syntax.html#rename-table" title="13.1.33 RENAME TABLE Syntax"><code class="literal">RENAME
    TABLE</code></a> statement:
  </p><pre class="programlisting">
RENAME TABLE <em class="replaceable"><code>db1.tbl_name</code></em> TO <em class="replaceable"><code>db2.tbl_name</code></em>;
</pre><a class="indexterm" name="idm140644113217536"></a><a class="indexterm" name="idm140644113216464"></a><p>
    If you have a <span class="quote">“<span class="quote">clean</span>”</span> backup of an
    <code class="filename">.ibd</code> file, you can restore it to the MySQL
    installation from which it originated as follows:
</p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p>
        The table must not have been dropped or truncated since you
        copied the <code class="filename">.ibd</code> file, because doing so
        changes the table ID stored inside the tablespace.
      </p></li><li class="listitem"><p>
        Issue this <a class="link" href="sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a> statement
        to delete the current <code class="filename">.ibd</code> file:
      </p><pre class="programlisting">
ALTER TABLE <em class="replaceable"><code>tbl_name</code></em> DISCARD TABLESPACE;
</pre></li><li class="listitem"><p>
        Copy the backup <code class="filename">.ibd</code> file to the proper
        database directory.
      </p></li><li class="listitem"><p>
        Issue this <a class="link" href="sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a> statement
        to tell <code class="literal">InnoDB</code> to use the new
        <code class="filename">.ibd</code> file for the table:
      </p><pre class="programlisting">
ALTER TABLE <em class="replaceable"><code>tbl_name</code></em> IMPORT TABLESPACE;
</pre>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
          The <a class="link" href="sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE Syntax"><code class="literal">ALTER TABLE
          ... IMPORT TABLESPACE</code></a> feature does not enforce
          foreign key constraints on imported data.
</p>
</div>
</li></ol>
</div>
<p>
    In this context, a <span class="quote">“<span class="quote">clean</span>”</span> <code class="filename">.ibd</code>
    file backup is one for which the following requirements are
    satisfied:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
        There are no uncommitted modifications by transactions in the
        <code class="filename">.ibd</code> file.
      </p></li><li class="listitem"><p>
        There are no unmerged insert buffer entries in the
        <code class="filename">.ibd</code> file.
      </p></li><li class="listitem"><p>
        Purge has removed all delete-marked index records from the
        <code class="filename">.ibd</code> file.
      </p></li><li class="listitem"><p>
        <a class="link" href="programs.html#mysqld" title="4.3.1 mysqld — The MySQL Server"><span class="command"><strong>mysqld</strong></span></a> has flushed all modified pages of the
        <code class="filename">.ibd</code> file from the buffer pool to the file.
</p></li></ul>
</div>
<p>
    You can make a clean backup <code class="filename">.ibd</code> file using the
    following method:
</p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p>
        Stop all activity from the <a class="link" href="programs.html#mysqld" title="4.3.1 mysqld — The MySQL Server"><span class="command"><strong>mysqld</strong></span></a> server and
        commit all transactions.
      </p></li><li class="listitem"><p>
        Wait until <a class="link" href="sql-syntax.html#show-engine" title="13.7.5.15 SHOW ENGINE Syntax"><code class="literal">SHOW
        ENGINE INNODB STATUS</code></a> shows that there are no active
        transactions in the database, and the main thread status of
        <code class="literal">InnoDB</code> is <code class="literal">Waiting for server
        activity</code>. Then you can make a copy of the
        <code class="filename">.ibd</code> file.
</p></li></ol>
</div>
<p>
    Another method for making a clean copy of an
    <code class="filename">.ibd</code> file is to use the MySQL Enterprise Backup
    product:
</p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p>
        Use MySQL Enterprise Backup to back up the
        <code class="literal">InnoDB</code> installation.
      </p></li><li class="listitem"><p>
        Start a second <a class="link" href="programs.html#mysqld" title="4.3.1 mysqld — The MySQL Server"><span class="command"><strong>mysqld</strong></span></a> server on the backup
        and let it clean up the <code class="filename">.ibd</code> files in the
        backup.
</p></li></ol>
</div>
<h4><a name="copy-tables-export-import"></a>Export and Import (mysqldump)</h4>
<p>
    You can use <a class="link" href="programs.html#mysqldump" title="4.5.4 mysqldump — A Database Backup Program"><span class="command"><strong>mysqldump</strong></span></a> to dump your tables on one
    machine and then import the dump files on the other machine. Using
    this method, it does not matter whether the formats differ or if
    your tables contain floating-point data.
  </p><p>
    One way to increase the performance of this method is to switch off
    <a class="link" href="glossary.html#glos_autocommit" title="autocommit">autocommit</a> mode when
    importing data, assuming that the tablespace has enough space for
    the big rollback segment that the import transactions generate. Do
    the commit only after importing a whole table or a segment of a
    table.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="innodb-transactions-with-different-apis"></a>14.5.3 Grouping DML Operations with Transactions</h3>

</div>

</div>

</div>
<a class="indexterm" name="idm140644113168352"></a><p>
      By default, connection to the MySQL server begins with
      <a class="link" href="glossary.html#glos_autocommit" title="autocommit">autocommit</a> mode enabled,
      which automatically commits every SQL statement as you execute it.
      This mode of operation might be unfamiliar if you have experience
      with other database systems, where it is standard practice to
      issue a sequence of <a class="link" href="glossary.html#glos_dml" title="DML">DML</a> statements
      and commit them or roll them back all together.
    </p><p>
      To use multiple-statement
      <a class="link" href="glossary.html#glos_transaction" title="transaction">transactions</a>, switch
      autocommit off with the SQL statement <code class="literal">SET autocommit =
      0</code> and end each transaction with
      <a class="link" href="sql-syntax.html#commit" title="13.3.1 START TRANSACTION, COMMIT, and ROLLBACK Syntax"><code class="literal">COMMIT</code></a> or
      <a class="link" href="sql-syntax.html#commit" title="13.3.1 START TRANSACTION, COMMIT, and ROLLBACK Syntax"><code class="literal">ROLLBACK</code></a> as
      appropriate. To leave autocommit on, begin each transaction with
      <a class="link" href="sql-syntax.html#commit" title="13.3.1 START TRANSACTION, COMMIT, and ROLLBACK Syntax"><code class="literal">START
      TRANSACTION</code></a> and end it with
      <a class="link" href="sql-syntax.html#commit" title="13.3.1 START TRANSACTION, COMMIT, and ROLLBACK Syntax"><code class="literal">COMMIT</code></a> or
      <a class="link" href="sql-syntax.html#commit" title="13.3.1 START TRANSACTION, COMMIT, and ROLLBACK Syntax"><code class="literal">ROLLBACK</code></a>. The
      following example shows two transactions. The first is committed;
      the second is rolled back.
    </p><pre class="programlisting">
shell&gt; <strong class="userinput"><code>mysql test</code></strong>

mysql&gt; <strong class="userinput"><code>CREATE TABLE customer (a INT, b CHAR (20), INDEX (a));</code></strong>
Query OK, 0 rows affected (0.00 sec)
mysql&gt; <strong class="userinput"><code>-- Do a transaction with autocommit turned on.</code></strong>
mysql&gt; <strong class="userinput"><code>START TRANSACTION;</code></strong>
Query OK, 0 rows affected (0.00 sec)
mysql&gt; <strong class="userinput"><code>INSERT INTO customer VALUES (10, 'Heikki');</code></strong>
Query OK, 1 row affected (0.00 sec)
mysql&gt; <strong class="userinput"><code>COMMIT;</code></strong>
Query OK, 0 rows affected (0.00 sec)
mysql&gt; <strong class="userinput"><code>-- Do another transaction with autocommit turned off.</code></strong>
mysql&gt; <strong class="userinput"><code>SET autocommit=0;</code></strong>
Query OK, 0 rows affected (0.00 sec)
mysql&gt; <strong class="userinput"><code>INSERT INTO customer VALUES (15, 'John');</code></strong>
Query OK, 1 row affected (0.00 sec)
mysql&gt; <strong class="userinput"><code>INSERT INTO customer VALUES (20, 'Paul');</code></strong>
Query OK, 1 row affected (0.00 sec)
mysql&gt; <strong class="userinput"><code>DELETE FROM customer WHERE b = 'Heikki';</code></strong>
Query OK, 1 row affected (0.00 sec)
mysql&gt; <strong class="userinput"><code>-- Now we undo those last 2 inserts and the delete.</code></strong>
mysql&gt; <strong class="userinput"><code>ROLLBACK;</code></strong>
Query OK, 0 rows affected (0.00 sec)
mysql&gt; <strong class="userinput"><code>SELECT * FROM customer;</code></strong>
+------+--------+
| a    | b      |
+------+--------+
|   10 | Heikki |
+------+--------+
1 row in set (0.00 sec)
mysql&gt;
</pre>
<h4><a name="idm140644113144256"></a>Transactions in Client-Side Languages</h4>
<p>
      In APIs such as PHP, Perl DBI, JDBC, ODBC, or the standard C call
      interface of MySQL, you can send transaction control statements
      such as <a class="link" href="sql-syntax.html#commit" title="13.3.1 START TRANSACTION, COMMIT, and ROLLBACK Syntax"><code class="literal">COMMIT</code></a> to the MySQL server
      as strings just like any other SQL statements such as
      <a class="link" href="sql-syntax.html#select" title="13.2.9 SELECT Syntax"><code class="literal">SELECT</code></a> or
      <a class="link" href="sql-syntax.html#insert" title="13.2.5 INSERT Syntax"><code class="literal">INSERT</code></a>. Some APIs also offer
      separate special transaction commit and rollback functions or
      methods.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="converting-tables-to-innodb"></a>14.5.4 Converting Tables from MyISAM to InnoDB</h3>

</div>

</div>

</div>
<a class="indexterm" name="idm140644113137840"></a><a class="indexterm" name="idm140644113135920"></a><p>
    If you have existing tables, and applications that use them, that
    you want to convert to <code class="literal">InnoDB</code> for better
    reliability and scalability, use the following guidelines and tips.
    This section assumes most such tables were originally
    <code class="literal">MyISAM</code>, which was formerly the default.
</p>
<h4><a name="innodb-convert-memory-usage"></a>Reduce Memory Usage for MyISAM, Increase Memory Usage for InnoDB</h4>
<p>
    As you transition away from <code class="literal">MyISAM</code> tables, lower
    the value of the <a class="link" href="server-administration.html#sysvar_key_buffer_size"><code class="literal">key_buffer_size</code></a>
    configuration option to free memory no longer needed for caching
    results. Increase the value of the
    <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_size"><code class="literal">innodb_buffer_pool_size</code></a>
    configuration option, which performs a similar role of allocating
    cache memory for <code class="literal">InnoDB</code> tables. The
    <code class="literal">InnoDB</code> <a class="link" href="glossary.html#glos_buffer_pool" title="buffer pool">buffer
    pool</a> caches both table data and index data, so it does double
    duty in speeding up lookups for queries and keeping query results in
    memory for reuse.
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
        Allocate as much memory to this option as you can afford, often
        up to 80% of physical memory on the server.
      </p></li><li class="listitem"><p>
        If the operating system runs short of memory for other processes
        and begins to swap, reduce the
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_size"><code class="literal">innodb_buffer_pool_size</code></a> value.
        Swapping is such an expensive operation that it drastically
        reduces the benefit of the cache memory.
      </p></li><li class="listitem"><p>
        If the <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_size"><code class="literal">innodb_buffer_pool_size</code></a>
        value is several gigabytes or higher, consider increasing the
        values of
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_instances"><code class="literal">innodb_buffer_pool_instances</code></a>.
        Doing so helps on busy servers where many connections are
        reading data into the cache at the same time.
      </p></li><li class="listitem"><p>
        On a busy server, run benchmarks with the Query Cache turned
        off. The <code class="literal">InnoDB</code> buffer pool provides similar
        benefits, so the Query Cache might be tying up memory
        unnecessarily.
</p></li></ul>
</div>
<h4><a name="innodb-convert-transactions"></a>Watch Out for Too-Long Or Too-Short Transactions</h4>
<p>
    Because <code class="literal">MyISAM</code> tables do not support
    <a class="link" href="glossary.html#glos_transaction" title="transaction">transactions</a>, you might not
    have paid much attention to the
    <a class="link" href="server-administration.html#sysvar_autocommit"><code class="literal">autocommit</code></a> configuration option and
    the <a class="link" href="sql-syntax.html#commit" title="13.3.1 START TRANSACTION, COMMIT, and ROLLBACK Syntax"><code class="literal">COMMIT</code></a> and
    <a class="link" href="sql-syntax.html#commit" title="13.3.1 START TRANSACTION, COMMIT, and ROLLBACK Syntax"><code class="literal">ROLLBACK</code></a>
    statements. These keywords are important to allow multiple sessions
    to read and write <code class="literal">InnoDB</code> tables concurrently,
    providing substantial scalability benefits in write-heavy workloads.
  </p><p>
    While a transaction is open, the system keeps a snapshot of the data
    as seen at the beginning of the transaction, which can cause
    substantial overhead if the system inserts, updates, and deletes
    millions of rows while a stray transaction keeps running. Thus, take
    care to avoid transactions that run for too long:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
        If you are using a <a class="link" href="programs.html#mysql" title="4.5.1 mysql — The MySQL Command-Line Tool"><span class="command"><strong>mysql</strong></span></a> session for
        interactive experiments, always
        <a class="link" href="sql-syntax.html#commit" title="13.3.1 START TRANSACTION, COMMIT, and ROLLBACK Syntax"><code class="literal">COMMIT</code></a> (to finalize the changes)
        or <a class="link" href="sql-syntax.html#commit" title="13.3.1 START TRANSACTION, COMMIT, and ROLLBACK Syntax"><code class="literal">ROLLBACK</code></a>
        (to undo the changes) when finished. Close down interactive
        sessions rather than leaving them open for long periods, to
        avoid keeping transactions open for long periods by accident.
      </p></li><li class="listitem"><p>
        Make sure that any error handlers in your application also
        <a class="link" href="sql-syntax.html#commit" title="13.3.1 START TRANSACTION, COMMIT, and ROLLBACK Syntax"><code class="literal">ROLLBACK</code></a>
        incomplete changes or <a class="link" href="sql-syntax.html#commit" title="13.3.1 START TRANSACTION, COMMIT, and ROLLBACK Syntax"><code class="literal">COMMIT</code></a>
        completed changes.
      </p></li><li class="listitem"><p>
        <a class="link" href="sql-syntax.html#commit" title="13.3.1 START TRANSACTION, COMMIT, and ROLLBACK Syntax"><code class="literal">ROLLBACK</code></a> is a
        relatively expensive operation, because
        <a class="link" href="sql-syntax.html#insert" title="13.2.5 INSERT Syntax"><code class="literal">INSERT</code></a>,
        <a class="link" href="sql-syntax.html#update" title="13.2.11 UPDATE Syntax"><code class="literal">UPDATE</code></a>, and
        <a class="link" href="sql-syntax.html#delete" title="13.2.2 DELETE Syntax"><code class="literal">DELETE</code></a> operations are written to
        <code class="literal">InnoDB</code> tables prior to the
        <a class="link" href="sql-syntax.html#commit" title="13.3.1 START TRANSACTION, COMMIT, and ROLLBACK Syntax"><code class="literal">COMMIT</code></a>, with the expectation that
        most changes will be committed successfully and rollbacks will
        be rare. When experimenting with large volumes of data, avoid
        making changes to large numbers of rows and then rolling back
        those changes.
      </p></li><li class="listitem"><p>
        When loading large volumes of data with a sequence of
        <a class="link" href="sql-syntax.html#insert" title="13.2.5 INSERT Syntax"><code class="literal">INSERT</code></a> statements, periodically
        <a class="link" href="sql-syntax.html#commit" title="13.3.1 START TRANSACTION, COMMIT, and ROLLBACK Syntax"><code class="literal">COMMIT</code></a> the results to avoid
        having transactions that last for hours. In typical load
        operations for data warehousing, if something goes wrong, you
        <a class="link" href="sql-syntax.html#truncate-table" title="13.1.34 TRUNCATE TABLE Syntax"><code class="literal">TRUNCATE TABLE</code></a> and start over
        from the beginning rather than doing a
        <a class="link" href="sql-syntax.html#commit" title="13.3.1 START TRANSACTION, COMMIT, and ROLLBACK Syntax"><code class="literal">ROLLBACK</code></a>.
</p></li></ul>
</div>
<p>
    The preceding tips save memory and disk space that can be wasted
    during too-long transactions. When transactions are shorter than
    they should be, the problem is excessive I/O. With each
    <a class="link" href="sql-syntax.html#commit" title="13.3.1 START TRANSACTION, COMMIT, and ROLLBACK Syntax"><code class="literal">COMMIT</code></a>, MySQL makes sure each change
    is safely recorded to disk, which involves some I/O.
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
        For most operations on <code class="literal">InnoDB</code> tables, you
        should use the setting
        <a class="link" href="server-administration.html#sysvar_autocommit"><code class="literal">autocommit=0</code></a>. From an
        efficiency perspective, this avoids unnecessary I/O when you
        issue large numbers of consecutive
        <a class="link" href="sql-syntax.html#insert" title="13.2.5 INSERT Syntax"><code class="literal">INSERT</code></a>,
        <a class="link" href="sql-syntax.html#update" title="13.2.11 UPDATE Syntax"><code class="literal">UPDATE</code></a>, or
        <a class="link" href="sql-syntax.html#delete" title="13.2.2 DELETE Syntax"><code class="literal">DELETE</code></a> statements. From a safety
        perspective, this allows you to issue a
        <a class="link" href="sql-syntax.html#commit" title="13.3.1 START TRANSACTION, COMMIT, and ROLLBACK Syntax"><code class="literal">ROLLBACK</code></a>
        statement to recover lost or garbled data if you make a mistake
        on the <a class="link" href="programs.html#mysql" title="4.5.1 mysql — The MySQL Command-Line Tool"><span class="command"><strong>mysql</strong></span></a> command line, or in an exception
        handler in your application.
      </p></li><li class="listitem"><p>
        The time when <a class="link" href="server-administration.html#sysvar_autocommit"><code class="literal">autocommit=1</code></a> is
        suitable for <code class="literal">InnoDB</code> tables is when running a
        sequence of queries for generating reports or analyzing
        statistics. In this situation, there is no I/O penalty related
        to <a class="link" href="sql-syntax.html#commit" title="13.3.1 START TRANSACTION, COMMIT, and ROLLBACK Syntax"><code class="literal">COMMIT</code></a> or
        <a class="link" href="sql-syntax.html#commit" title="13.3.1 START TRANSACTION, COMMIT, and ROLLBACK Syntax"><code class="literal">ROLLBACK</code></a>, and
        <code class="literal">InnoDB</code> can
        <a class="link" href="optimization.html#innodb-performance-ro-txn" title="8.5.3 Optimizing InnoDB Read-Only Transactions">automatically optimize
        the read-only workload</a>.
      </p></li><li class="listitem"><p>
        If you make a series of related changes, finalize all those
        changes at once with a single
        <a class="link" href="sql-syntax.html#commit" title="13.3.1 START TRANSACTION, COMMIT, and ROLLBACK Syntax"><code class="literal">COMMIT</code></a> at the end. For example,
        if you insert related pieces of information into several tables,
        do a single <a class="link" href="sql-syntax.html#commit" title="13.3.1 START TRANSACTION, COMMIT, and ROLLBACK Syntax"><code class="literal">COMMIT</code></a> after making
        all the changes. Or if you run many consecutive
        <a class="link" href="sql-syntax.html#insert" title="13.2.5 INSERT Syntax"><code class="literal">INSERT</code></a> statements, do a single
        <a class="link" href="sql-syntax.html#commit" title="13.3.1 START TRANSACTION, COMMIT, and ROLLBACK Syntax"><code class="literal">COMMIT</code></a> after all the data is
        loaded; if you are doing millions of
        <a class="link" href="sql-syntax.html#insert" title="13.2.5 INSERT Syntax"><code class="literal">INSERT</code></a> statements, perhaps split
        up the huge transaction by issuing a
        <a class="link" href="sql-syntax.html#commit" title="13.3.1 START TRANSACTION, COMMIT, and ROLLBACK Syntax"><code class="literal">COMMIT</code></a> every ten thousand or
        hundred thousand records, so the transaction does not grow too
        large.
      </p></li><li class="listitem"><p>
        Remember that even a <a class="link" href="sql-syntax.html#select" title="13.2.9 SELECT Syntax"><code class="literal">SELECT</code></a>
        statement opens a transaction, so after running some report or
        debugging queries in an interactive <a class="link" href="programs.html#mysql" title="4.5.1 mysql — The MySQL Command-Line Tool"><span class="command"><strong>mysql</strong></span></a>
        session, either issue a <a class="link" href="sql-syntax.html#commit" title="13.3.1 START TRANSACTION, COMMIT, and ROLLBACK Syntax"><code class="literal">COMMIT</code></a> or
        close the <a class="link" href="programs.html#mysql" title="4.5.1 mysql — The MySQL Command-Line Tool"><span class="command"><strong>mysql</strong></span></a> session.
</p></li></ul>
</div>
<h4><a name="innodb-convert-deadlock"></a>Don't Worry Too Much About Deadlocks</h4>
<p>
    You might see warning messages referring to <span class="quote">“<span class="quote">deadlocks</span>”</span>
    in the MySQL error log, or the output of
    <a class="link" href="sql-syntax.html#show-engine" title="13.7.5.15 SHOW ENGINE Syntax"><code class="literal">SHOW ENGINE INNODB
    STATUS</code></a>. Despite the scary-sounding name, a
    <a class="link" href="glossary.html#glos_deadlock" title="deadlock">deadlock</a> is not a serious issue
    for <code class="literal">InnoDB</code> tables, and often does not require any
    corrective action. When two transactions start modifying multiple
    tables, accessing the tables in a different order, they can reach a
    state where each transaction is waiting for the other and neither
    can proceed. MySQL immediately detects this condition and cancels
    (<a class="link" href="glossary.html#glos_rollback" title="rollback">rolls back</a>) the
    <span class="quote">“<span class="quote">smaller</span>”</span> transaction, allowing the other to proceed.
  </p><p>
    Your applications do need error-handling logic to restart a
    transaction that is forcibly cancelled like this. When you re-issue
    the same SQL statements as before, the original timing issue no
    longer applies: either the other transaction has already finished
    and yours can proceed, or the other transaction is still in progress
    and your transaction waits until it finishes.
  </p><p>
    If deadlock warnings occur constantly, you might review the
    application code to reorder the SQL operations in a consistent way,
    or to shorten the transactions. You can test with the
    <a class="link" href="innodb-storage-engine.html#sysvar_innodb_print_all_deadlocks"><code class="literal">innodb_print_all_deadlocks</code></a> option
    enabled to see all deadlock warnings in the MySQL error log, rather
    than only the last warning in the
    <a class="link" href="sql-syntax.html#show-engine" title="13.7.5.15 SHOW ENGINE Syntax"><code class="literal">SHOW ENGINE INNODB
    STATUS</code></a> output.
</p>
<h4><a name="innodb-convert-plan-storage"></a>Plan the Storage Layout</h4>
<p>
    To get the best performance from <code class="literal">InnoDB</code> tables,
    you can adjust a number of parameters related to storage layout.
  </p><p>
    When you convert <code class="literal">MyISAM</code> tables that are large,
    frequently accessed, and hold vital data, investigate and consider
    the <a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_per_table"><code class="literal">innodb_file_per_table</code></a>,
    <a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_format"><code class="literal">innodb_file_format</code></a>, and
    <a class="link" href="innodb-storage-engine.html#sysvar_innodb_page_size"><code class="literal">innodb_page_size</code></a> configuration
    options, and the
    <a class="link" href="innodb-storage-engine.html#innodb-row-format" title="14.8 InnoDB Row Storage and Row Formats"><code class="literal">ROW_FORMAT</code> and
    <code class="literal">KEY_BLOCK_SIZE</code> clauses</a> of the
    <a class="link" href="sql-syntax.html#create-table" title="13.1.18 CREATE TABLE Syntax"><code class="literal">CREATE TABLE</code></a> statement.
  </p><p>
    During your initial experiments, the most important setting is
    <a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_per_table"><code class="literal">innodb_file_per_table</code></a>. When this
    setting is enabled, which is the default as of MySQL 5.6.6, new
    <code class="literal">InnoDB</code> tables are implicitly created in
    <a class="link" href="glossary.html#glos_file_per_table" title="file-per-table">file-per-table</a>
    tablespaces. In contrast with the <code class="literal">InnoDB</code> system
    tablespace, file-per-table tablespaces allow disk space to be
    reclaimed by the operating system when a table is truncated or
    dropped. File-per-table tablespaces also support the
    <a class="link" href="glossary.html#glos_barracuda" title="Barracuda">Barracuda</a> file format and
    associated features such as table compression and off-page storage
    for long variable-length columns. For more information, see
    <a class="xref" href="innodb-storage-engine.html#innodb-multiple-tablespaces" title="14.4.4 InnoDB File-Per-Table Tablespaces">Section 14.4.4, “InnoDB File-Per-Table Tablespaces”</a>.
  </p><p>
    As of MySQl 5.7.6, you can also store <code class="literal">InnoDB</code>
    tables in a shared general tablespace. General tablespaces support
    the Barracuda file format and can contain multiple tables. For more
    information, see <a class="xref" href="innodb-storage-engine.html#general-tablespaces" title="14.4.9 InnoDB General Tablespaces">Section 14.4.9, “InnoDB General Tablespaces”</a>.
</p>
<h4><a name="innodb-convert-convert"></a>Converting an Existing Table</h4>
<p>
    To convert a non-<code class="literal">InnoDB</code> table to use
    <code class="literal">InnoDB</code> use <a class="link" href="sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE Syntax"><code class="literal">ALTER
    TABLE</code></a>:
  </p><pre class="programlisting">
ALTER TABLE <em class="replaceable"><code>table_name</code></em> ENGINE=InnoDB;
</pre>
<div class="important" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Important
</div>
<p>
      Do not convert MySQL system tables in the <code class="literal">mysql</code>
      database (such as <code class="literal">user</code> or
      <code class="literal">host</code>) to the <code class="literal">InnoDB</code> type.
      This is an unsupported operation. The system tables must always be
      of the <code class="literal">MyISAM</code> type.
</p>
</div>
<h4><a name="innodb-convert-clone"></a>Cloning the Structure of a Table</h4>
<p>
    You might make an InnoDB table that is a clone of a MyISAM table,
    rather than doing the <a class="link" href="sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a>
    conversion, to test the old and new table side-by-side before
    switching.
  </p><p>
    Create an empty <code class="literal">InnoDB</code> table with identical
    column and index definitions. Use <code class="literal">show create table
    <em class="replaceable"><code>table_name</code></em>\G</code> to see the full
    <a class="link" href="sql-syntax.html#create-table" title="13.1.18 CREATE TABLE Syntax"><code class="literal">CREATE TABLE</code></a> statement to use. Change
    the <code class="literal">ENGINE</code> clause to
    <code class="literal">ENGINE=INNODB</code>.
</p>
<h4><a name="innodb-convert-transfer"></a>Transferring Existing Data</h4>
<p>
    To transfer a large volume of data into an empty
    <code class="literal">InnoDB</code> table created as shown in the previous
    section, insert the rows with <code class="literal">INSERT INTO
    <em class="replaceable"><code>innodb_table</code></em> SELECT * FROM
    <em class="replaceable"><code>myisam_table</code></em> ORDER BY
    <em class="replaceable"><code>primary_key_columns</code></em></code>.
  </p><p>
    You can also create the indexes for the <code class="literal">InnoDB</code>
    table after inserting the data. Historically, creating new secondary
    indexes was a slow operation for InnoDB, but now you can create the
    indexes after the data is loaded with relatively little overhead
    from the index creation step.
  </p><p>
    If you have <code class="literal">UNIQUE</code> constraints on secondary keys,
    you can speed up a table import by turning off the uniqueness checks
    temporarily during the import operation:
  </p><pre class="programlisting">
SET unique_checks=0;
<em class="replaceable"><code>... import operation ...</code></em>
SET unique_checks=1;
</pre><p>
    For big tables, this saves disk I/O because
    <code class="literal">InnoDB</code> can use its
    <a class="link" href="glossary.html#glos_change_buffer" title="change buffer">change buffer</a> to write
    secondary index records as a batch. Be certain that the data
    contains no duplicate keys.
    <a class="link" href="server-administration.html#sysvar_unique_checks"><code class="literal">unique_checks</code></a> permits but does not
    require storage engines to ignore duplicate keys.
  </p><p>
    To get better control over the insertion process, you might insert
    big tables in pieces:
  </p><pre class="programlisting">
INSERT INTO newtable SELECT * FROM oldtable
   WHERE yourkey &gt; <em class="replaceable"><code>something</code></em> AND yourkey &lt;= <em class="replaceable"><code>somethingelse</code></em>;
</pre><p>
    After all records have been inserted, you can rename the tables.
  </p><p>
    During the conversion of big tables, increase the size of the
    <code class="literal">InnoDB</code> buffer pool to reduce disk I/O, to a
    maximum of 80% of physical memory. You can also increase the sizes
    of the <code class="literal">InnoDB</code> log files.
</p>
<h4><a name="innodb-convert-plan-storage-2"></a>Storage Requirements</h4>
<p>
    If you intend to make several temporary copies of your data in
    <code class="literal">InnoDB</code> tables during the conversion process, it
    is recommended that you create the tables in file-per-table
    tablespaces so that you can reclaim the disk space when you drop the
    tables. As mentioned previously, when the
    <a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_per_table"><code class="literal">innodb_file_per_table</code></a> option is
    enabled, newly created <code class="literal">InnoDB</code> tables are
    implicitly created in file-per-table tablespaces.
  </p><p>
    Whether you convert the <code class="literal">MyISAM</code> table directly or
    create a cloned <code class="literal">InnoDB</code> table, make sure that you
    have sufficient disk space to hold both the old and new tables
    during the process. <code class="literal">InnoDB</code> tables require more
    disk space than <code class="literal">MyISAM</code> tables. If an
    <a class="link" href="sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a> operation runs out of
    space, it starts a rollback, and that can take hours if it is
    disk-bound. For inserts, <code class="literal">InnoDB</code> uses the insert
    buffer to merge secondary index records to indexes in batches. That
    saves a lot of disk I/O. For rollback, no such mechanism is used,
    and the rollback can take 30 times longer than the insertion.
  </p><p>
    In the case of a runaway rollback, if you do not have valuable data
    in your database, it may be advisable to kill the database process
    rather than wait for millions of disk I/O operations to complete.
    For the complete procedure, see
    <a class="xref" href="innodb-storage-engine.html#forcing-innodb-recovery" title="14.18.2 Forcing InnoDB Recovery">Section 14.18.2, “Forcing InnoDB Recovery”</a>.
</p>
<h4><a name="innodb-convert-primary-key"></a>Carefully Choose a PRIMARY KEY for Each Table</h4>
<p>
    The <code class="literal">PRIMARY KEY</code> clause is a critical factor
    affecting the performance of MySQL queries and the space usage for
    tables and indexes. Perhaps you have phoned a financial institution
    where you are asked for an account number. If you do not have the
    number, you are asked for a dozen different pieces of information to
    <span class="quote">“<span class="quote">uniquely identify</span>”</span> yourself. The primary key is like
    that unique account number that lets you get straight down to
    business when querying or modifying the information in a table.
    Every row in the table must have a primary key value, and no two
    rows can have the same primary key value.
  </p><p>
    Here are some guidelines for the primary key, followed by more
    detailed explanations.
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
        Declare a <code class="literal">PRIMARY KEY</code> for each table.
        Typically, it is the most important column that you refer to in
        <code class="literal">WHERE</code> clauses when looking up a single row.
      </p></li><li class="listitem"><p>
        Declare the <code class="literal">PRIMARY KEY</code> clause in the
        original <a class="link" href="sql-syntax.html#create-table" title="13.1.18 CREATE TABLE Syntax"><code class="literal">CREATE TABLE</code></a> statement,
        rather than adding it later through an
        <a class="link" href="sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a> statement.
      </p></li><li class="listitem"><p>
        Choose the column and its data type carefully. Prefer numeric
        columns over character or string ones.
      </p></li><li class="listitem"><p>
        Consider using an auto-increment column if there is not another
        stable, unique, non-null, numeric column to use.
      </p></li><li class="listitem"><p>
        An auto-increment column is also a good choice if there is any
        doubt whether the value of the primary key column could ever
        change. Changing the value of a primary key column is an
        expensive operation, possibly involving rearranging data within
        the table and within each secondary index.
</p></li></ul>
</div>
<p>
    Consider adding a <a class="link" href="glossary.html#glos_primary_key" title="primary key">primary
    key</a> to any table that does not already have one. Use the
    smallest practical numeric type based on the maximum projected size
    of the table. This can make each row slightly more compact, which
    can yield substantial space savings for large tables. The space
    savings are multiplied if the table has any
    <a class="link" href="glossary.html#glos_secondary_index" title="secondary index">secondary indexes</a>,
    because the primary key value is repeated in each secondary index
    entry. In addition to reducing data size on disk, a small primary
    key also lets more data fit into the
    <a class="link" href="glossary.html#glos_buffer_pool" title="buffer pool">buffer pool</a>, speeding up all
    kinds of operations and improving concurrency.
  </p><p>
    If the table already has a primary key on some longer column, such
    as a <code class="literal">VARCHAR</code>, consider adding a new unsigned
    <code class="literal">AUTO_INCREMENT</code> column and switching the primary
    key to that, even if that column is not referenced in queries. This
    design change can produce substantial space savings in the secondary
    indexes. You can designate the former primary key columns as
    <code class="literal">UNIQUE NOT NULL</code> to enforce the same constraints
    as the <code class="literal">PRIMARY KEY</code> clause, that is, to prevent
    duplicate or null values across all those columns.
  </p><p>
    If you spread related information across multiple tables, typically
    each table uses the same column for its primary key. For example, a
    personnel database might have several tables, each with a primary
    key of employee number. A sales database might have some tables with
    a primary key of customer number, and other tables with a primary
    key of order number. Because lookups using the primary key are very
    fast, you can construct efficient join queries for such tables.
  </p><p>
    If you leave the <code class="literal">PRIMARY KEY</code> clause out entirely,
    MySQL creates an invisible one for you. It is a 6-byte value that
    might be longer than you need, thus wasting space. Because it is
    hidden, you cannot refer to it in queries.
</p>
<h4><a name="innodb-convert-application-performance"></a>Application Performance Considerations</h4>
<p>
    The extra reliability and scalability features of
    <code class="literal">InnoDB</code> do require more disk storage than
    equivalent <code class="literal">MyISAM</code> tables. You might change the
    column and index definitions slightly, for better space utilization,
    reduced I/O and memory consumption when processing result sets, and
    better query optimization plans making efficient use of index
    lookups.
  </p><p>
    If you do set up a numeric ID column for the primary key, use that
    value to cross-reference with related values in any other tables,
    particularly for <a class="link" href="glossary.html#glos_join" title="join">join</a> queries. For
    example, rather than accepting a country name as input and doing
    queries searching for the same name, do one lookup to determine the
    country ID, then do other queries (or a single join query) to look
    up relevant information across several tables. Rather than storing a
    customer or catalog item number as a string of digits, potentially
    using up several bytes, convert it to a numeric ID for storing and
    querying. A 4-byte unsigned <a class="link" href="data-types.html#integer-types" title="11.2.1 Integer Types (Exact Value) - INTEGER, INT, SMALLINT, TINYINT, MEDIUMINT, BIGINT"><code class="literal">INT</code></a>
    column can index over 4 billion items (with the US meaning of
    billion: 1000 million). For the ranges of the different integer
    types, see <a class="xref" href="data-types.html#integer-types" title="11.2.1 Integer Types (Exact Value) - INTEGER, INT, SMALLINT, TINYINT, MEDIUMINT, BIGINT">Section 11.2.1, “Integer Types (Exact Value) - INTEGER, INT, SMALLINT, TINYINT,
        MEDIUMINT, BIGINT”</a>.
</p>
<h4><a name="innodb-convert-understand-files"></a>Understand Files Associated with InnoDB Tables</h4>
<p>
    <code class="literal">InnoDB</code> files require more care and planning than
    <code class="literal">MyISAM</code> files do:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
        You must not delete the <a class="link" href="glossary.html#glos_ibdata_file" title="ibdata file">ibdata
        files</a> that represent the <code class="literal">InnoDB</code>
        <a class="link" href="glossary.html#glos_system_tablespace" title="system tablespace">system tablespace</a>.
      </p></li><li class="listitem"><p>
        Copying InnoDB tables from one server to another requires
        issuing the <code class="literal">FLUSH TABLES ... FOR EXPORT</code>
        statement first, and copying the
        <code class="literal"><em class="replaceable"><code>table_name</code></em>.cfg</code>
        file along with the
        <code class="literal"><em class="replaceable"><code>table_name</code></em>.ibd</code>
        file.
</p></li></ul>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="innodb-auto-increment-handling"></a>14.5.5 AUTO_INCREMENT Handling in InnoDB</h3>

</div>

</div>

</div>
<a class="indexterm" name="idm140644112934752"></a><p>
      <code class="literal">InnoDB</code> provides a configurable locking
      mechanism that can significantly improve scalability and
      performance of SQL statements that add rows to tables with
      <code class="literal">AUTO_INCREMENT</code> columns. To use the
      <code class="literal">AUTO_INCREMENT</code> mechanism with an
      <code class="literal">InnoDB</code> table, an
      <code class="literal">AUTO_INCREMENT</code> column must be defined as part
      of an index such that it is possible to perform the equivalent of
      an indexed <code class="literal">SELECT
      MAX(<em class="replaceable"><code>ai_col</code></em>)</code> lookup on the
      table to obtain the maximum column value. Typically, this is
      achieved by making the column the first column of some table
      index.
    </p><p>
      This section describes the behavior of
      <code class="literal">AUTO_INCREMENT</code> lock modes, usage implications
      for different <code class="literal">AUTO_INCREMENT</code> lock mode
      settings, and how <code class="literal">InnoDB</code> initializes the
      <code class="literal">AUTO_INCREMENT</code> counter.
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          <a class="link" href="innodb-storage-engine.html#innodb-auto-increment-lock-modes" title="InnoDB AUTO_INCREMENT Lock Modes">InnoDB
          AUTO_INCREMENT Lock Modes</a>
        </p></li><li class="listitem"><p>
          <a class="link" href="innodb-storage-engine.html#innodb-auto-increment-lock-mode-usage-implications" title="InnoDB AUTO_INCREMENT Lock Mode Usage Implications">InnoDB
          AUTO_INCREMENT Lock Mode Usage Implications</a>
        </p></li><li class="listitem"><p>
          <a class="link" href="innodb-storage-engine.html#innodb-auto-increment-initialization" title="InnoDB AUTO_INCREMENT Counter Initialization">InnoDB
          AUTO_INCREMENT Counter Initialization</a>
</p></li></ul>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h4 class="title"><a name="innodb-auto-increment-lock-modes"></a>InnoDB AUTO_INCREMENT Lock Modes</h4>

</div>

</div>

</div>
<p>
        This section describes the behavior of
        <code class="literal">AUTO_INCREMENT</code> lock modes used to generate
        auto-increment values, and how each lock mode affects
        replication. Auto-increment lock modes are configured at startup
        using the
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_autoinc_lock_mode"><code class="literal">innodb_autoinc_lock_mode</code></a>
        configuration parameter.
      </p><p>
        The following terms are used in describing
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_autoinc_lock_mode"><code class="literal">innodb_autoinc_lock_mode</code></a>
        settings:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <span class="quote">“<span class="quote"><a class="link" href="sql-syntax.html#insert" title="13.2.5 INSERT Syntax"><code class="literal">INSERT</code></a>-like</span>”</span>
            statements
          </p><p>
            All statements that generate new rows in a table, including
            <a class="link" href="sql-syntax.html#insert" title="13.2.5 INSERT Syntax"><code class="literal">INSERT</code></a>,
            <a class="link" href="sql-syntax.html#insert-select" title="13.2.5.1 INSERT ... SELECT Syntax"><code class="literal">INSERT ...
            SELECT</code></a>, <a class="link" href="sql-syntax.html#replace" title="13.2.8 REPLACE Syntax"><code class="literal">REPLACE</code></a>,
            <a class="link" href="sql-syntax.html#replace" title="13.2.8 REPLACE Syntax"><code class="literal">REPLACE ...
            SELECT</code></a>, and <a class="link" href="sql-syntax.html#load-data" title="13.2.6 LOAD DATA INFILE Syntax"><code class="literal">LOAD
            DATA</code></a>. Includes <span class="quote">“<span class="quote">simple-inserts</span>”</span>,
            <span class="quote">“<span class="quote">bulk-inserts</span>”</span>, and <span class="quote">“<span class="quote">mixed-mode</span>”</span>
            inserts.
          </p></li><li class="listitem"><p>
            <span class="quote">“<span class="quote">Simple inserts</span>”</span>
          </p><p>
            Statements for which the number of rows to be inserted can
            be determined in advance (when the statement is initially
            processed). This includes single-row and multiple-row
            <a class="link" href="sql-syntax.html#insert" title="13.2.5 INSERT Syntax"><code class="literal">INSERT</code></a> and
            <a class="link" href="sql-syntax.html#replace" title="13.2.8 REPLACE Syntax"><code class="literal">REPLACE</code></a> statements that do
            not have a nested subquery, but not
            <a class="link" href="sql-syntax.html#insert-on-duplicate" title="13.2.5.3 INSERT ... ON DUPLICATE KEY UPDATE Syntax"><code class="literal">INSERT
            ... ON DUPLICATE KEY UPDATE</code></a>.
          </p></li><li class="listitem"><p>
            <span class="quote">“<span class="quote">Bulk inserts</span>”</span>
          </p><p>
            Statements for which the number of rows to be inserted (and
            the number of required auto-increment values) is not known
            in advance. This includes
            <a class="link" href="sql-syntax.html#insert-select" title="13.2.5.1 INSERT ... SELECT Syntax"><code class="literal">INSERT ...
            SELECT</code></a>,
            <a class="link" href="sql-syntax.html#replace" title="13.2.8 REPLACE Syntax"><code class="literal">REPLACE ...
            SELECT</code></a>, and <a class="link" href="sql-syntax.html#load-data" title="13.2.6 LOAD DATA INFILE Syntax"><code class="literal">LOAD
            DATA</code></a> statements, but not plain
            <code class="literal">INSERT</code>. <code class="literal">InnoDB</code> will
            assign new values for the <code class="literal">AUTO_INCREMENT</code>
            column one at a time as each row is processed.
          </p></li><li class="listitem"><p>
            <span class="quote">“<span class="quote">Mixed-mode inserts</span>”</span>
          </p><p>
            These are <span class="quote">“<span class="quote">simple insert</span>”</span> statements that
            specify the auto-increment value for some (but not all) of
            the new rows. An example follows, where
            <code class="literal">c1</code> is an
            <code class="literal">AUTO_INCREMENT</code> column of table
            <code class="literal">t1</code>:
          </p><pre class="programlisting">
INSERT INTO t1 (c1,c2) VALUES (1,'a'), (NULL,'b'), (5,'c'), (NULL,'d');
</pre><p>
            Another type of <span class="quote">“<span class="quote">mixed-mode insert</span>”</span> is
            <a class="link" href="sql-syntax.html#insert-on-duplicate" title="13.2.5.3 INSERT ... ON DUPLICATE KEY UPDATE Syntax"><code class="literal">INSERT
            ... ON DUPLICATE KEY UPDATE</code></a>, which in the worst
            case is in effect an <a class="link" href="sql-syntax.html#insert" title="13.2.5 INSERT Syntax"><code class="literal">INSERT</code></a>
            followed by a <a class="link" href="sql-syntax.html#update" title="13.2.11 UPDATE Syntax"><code class="literal">UPDATE</code></a>, where
            the allocated value for the
            <code class="literal">AUTO_INCREMENT</code> column may or may not be
            used during the update phase.
</p></li></ul>
</div>
<p>
        There are three possible settings for the
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_autoinc_lock_mode"><code class="literal">innodb_autoinc_lock_mode</code></a>
        configuration parameter. The settings are 0, 1, or 2, for
        <span class="quote">“<span class="quote">traditional</span>”</span>, <span class="quote">“<span class="quote">consecutive</span>”</span>, or
        <span class="quote">“<span class="quote">interleaved</span>”</span> lock mode, respectively.
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a name="innodb-auto-increment-lock-mode-traditional"></a>
            <code class="literal">innodb_autoinc_lock_mode = 0</code>
            (<span class="quote">“<span class="quote">traditional</span>”</span> lock mode)
          </p><p>
            The traditional lock mode provides the same behavior that
            existed before the
            <a class="link" href="innodb-storage-engine.html#sysvar_innodb_autoinc_lock_mode"><code class="literal">innodb_autoinc_lock_mode</code></a>
            configuration parameter was introduced in MySQL 5.1. The
            traditional lock mode option is provided for backward
            compatibility, performance testing, and working around
            issues with “mixed-mode inserts”, due to possible
            differences in semantics.
          </p><p>
            In this lock mode, all <span class="quote">“<span class="quote">INSERT-like</span>”</span> statements
            obtain a special table-level <code class="literal">AUTO-INC</code>
            lock for inserts into tables with
            <code class="literal">AUTO_INCREMENT</code> columns. This lock is
            normally held to the end of the statement (not to the end of
            the transaction) to ensure that auto-increment values are
            assigned in a predictable and repeatable order for a given
            sequence of <a class="link" href="sql-syntax.html#insert" title="13.2.5 INSERT Syntax"><code class="literal">INSERT</code></a>
            statements, and to ensure that auto-increment values
            assigned by any given statement are consecutive.
          </p><p>
            In the case of statement-based replication, this means that
            when an SQL statement is replicated on a slave server, the
            same values are used for the auto-increment column as on the
            master server. The result of execution of multiple
            <a class="link" href="sql-syntax.html#insert" title="13.2.5 INSERT Syntax"><code class="literal">INSERT</code></a> statements is
            deterministic, and the slave reproduces the same data as on
            the master. If auto-increment values generated by multiple
            <a class="link" href="sql-syntax.html#insert" title="13.2.5 INSERT Syntax"><code class="literal">INSERT</code></a> statements were
            interleaved, the result of two concurrent
            <a class="link" href="sql-syntax.html#insert" title="13.2.5 INSERT Syntax"><code class="literal">INSERT</code></a> statements would be
            nondeterministic, and could not reliably be propagated to a
            slave server using statement-based replication.
          </p><p>
            To make this clear, consider an example that uses this
            table:
          </p><pre class="programlisting">
CREATE TABLE t1 (
  c1 INT(11) NOT NULL AUTO_INCREMENT,
  c2 VARCHAR(10) DEFAULT NULL,
  PRIMARY KEY (c1)
) ENGINE=InnoDB;
</pre><p>
            Suppose that there are two transactions running, each
            inserting rows into a table with an
            <code class="literal">AUTO_INCREMENT</code> column. One transaction is
            using an
            <a class="link" href="sql-syntax.html#insert-select" title="13.2.5.1 INSERT ... SELECT Syntax"><code class="literal">INSERT ...
            SELECT</code></a> statement that inserts 1000 rows, and
            another is using a simple
            <a class="link" href="sql-syntax.html#insert" title="13.2.5 INSERT Syntax"><code class="literal">INSERT</code></a> statement that inserts
            one row:
          </p><pre class="programlisting">
Tx1: INSERT INTO t1 (c2) SELECT 1000 rows from another table ...
Tx2: INSERT INTO t1 (c2) VALUES ('xxx');
</pre><p>
            <code class="literal">InnoDB</code> cannot tell in advance how many
            rows will be retrieved from the
            <a class="link" href="sql-syntax.html#select" title="13.2.9 SELECT Syntax"><code class="literal">SELECT</code></a> in the
            <a class="link" href="sql-syntax.html#insert" title="13.2.5 INSERT Syntax"><code class="literal">INSERT</code></a> statement in Tx1, and
            it assigns the auto-increment values one at a time as the
            statement proceeds. With a table-level lock, held to the end
            of the statement, only one
            <a class="link" href="sql-syntax.html#insert" title="13.2.5 INSERT Syntax"><code class="literal">INSERT</code></a> statement referring to
            table <code class="literal">t1</code> can execute at a time, and the
            generation of auto-increment numbers by different statements
            is not interleaved. The auto-increment value generated by
            the Tx1
            <a class="link" href="sql-syntax.html#insert-select" title="13.2.5.1 INSERT ... SELECT Syntax"><code class="literal">INSERT ...
            SELECT</code></a> statement will be consecutive, and the
            (single) auto-increment value used by the
            <a class="link" href="sql-syntax.html#insert" title="13.2.5 INSERT Syntax"><code class="literal">INSERT</code></a> statement in Tx2 will
            either be smaller or larger than all those used for Tx1,
            depending on which statement executes first.
          </p><p>
            As long as the SQL statements execute in the same order when
            replayed from the binary log (when using statement-based
            replication, or in recovery scenarios), the results will be
            the same as they were when Tx1 and Tx2 first ran. Thus,
            table-level locks held until the end of a statement make
            <a class="link" href="sql-syntax.html#insert" title="13.2.5 INSERT Syntax"><code class="literal">INSERT</code></a> statements using
            auto-increment safe for use with statement-based
            replication. However, those table-level locks limit
            concurrency and scalability when multiple transactions are
            executing insert statements at the same time.
          </p><p>
            In the preceding example, if there were no table-level lock,
            the value of the auto-increment column used for the
            <a class="link" href="sql-syntax.html#insert" title="13.2.5 INSERT Syntax"><code class="literal">INSERT</code></a> in Tx2 depends on
            precisely when the statement executes. If the
            <a class="link" href="sql-syntax.html#insert" title="13.2.5 INSERT Syntax"><code class="literal">INSERT</code></a> of Tx2 executes while
            the <a class="link" href="sql-syntax.html#insert" title="13.2.5 INSERT Syntax"><code class="literal">INSERT</code></a> of Tx1 is running
            (rather than before it starts or after it completes), the
            specific auto-increment values assigned by the two
            <a class="link" href="sql-syntax.html#insert" title="13.2.5 INSERT Syntax"><code class="literal">INSERT</code></a> statements are
            nondeterministic, and may vary from run to run.
          </p><p>
            Under the
            <a class="link" href="innodb-storage-engine.html#innodb-auto-increment-lock-mode-consecutive">consecutive</a>
            lock mode, <code class="literal">InnoDB</code> can avoid using
            table-level <code class="literal">AUTO-INC</code> locks for
            <span class="quote">“<span class="quote">simple insert</span>”</span> statements where the number of
            rows is known in advance, and still preserve deterministic
            execution and safety for statement-based replication.
          </p><p>
            If you are not using the binary log to replay SQL statements
            as part of recovery or replication, the
            <a class="link" href="innodb-storage-engine.html#innodb-auto-increment-lock-mode-interleaved">interleaved</a>
            lock mode can be used to eliminate all use of table-level
            <code class="literal">AUTO-INC</code> locks for even greater
            concurrency and performance, at the cost of permitting gaps
            in auto-increment numbers assigned by a statement and
            potentially having the numbers assigned by concurrently
            executing statements interleaved.
          </p></li><li class="listitem"><p><a name="innodb-auto-increment-lock-mode-consecutive"></a>
            <code class="literal">innodb_autoinc_lock_mode = 1</code>
            (<span class="quote">“<span class="quote">consecutive</span>”</span> lock mode)
          </p><p>
            This is the default lock mode. In this mode, <span class="quote">“<span class="quote">bulk
            inserts</span>”</span> use the special <code class="literal">AUTO-INC</code>
            table-level lock and hold it until the end of the statement.
            This applies to all
            <a class="link" href="sql-syntax.html#insert-select" title="13.2.5.1 INSERT ... SELECT Syntax"><code class="literal">INSERT ...
            SELECT</code></a>,
            <a class="link" href="sql-syntax.html#replace" title="13.2.8 REPLACE Syntax"><code class="literal">REPLACE ...
            SELECT</code></a>, and <a class="link" href="sql-syntax.html#load-data" title="13.2.6 LOAD DATA INFILE Syntax"><code class="literal">LOAD
            DATA</code></a> statements. Only one statement holding the
            <code class="literal">AUTO-INC</code> lock can execute at a time.
          </p><p>
            <span class="quote">“<span class="quote">Simple inserts</span>”</span> (for which the number of rows
            to be inserted is known in advance) avoid table-level
            <code class="literal">AUTO-INC</code> locks by obtaining the required
            number of auto-increment values under the control of a mutex
            (a light-weight lock) that is only held for the duration of
            the allocation process, <span class="emphasis"><em>not</em></span> until the
            statement completes. No table-level
            <code class="literal">AUTO-INC</code> lock is used unless an
            <code class="literal">AUTO-INC</code> lock is held by another
            transaction. If another transaction holds an
            <code class="literal">AUTO-INC</code> lock, a <span class="quote">“<span class="quote">simple
            insert</span>”</span> waits for the <code class="literal">AUTO-INC</code>
            lock, as if it were a <span class="quote">“<span class="quote">bulk insert</span>”</span>.
          </p><p>
            This lock mode ensures that, in the presence of
            <a class="link" href="sql-syntax.html#insert" title="13.2.5 INSERT Syntax"><code class="literal">INSERT</code></a> statements where the
            number of rows is not known in advance (and where
            auto-increment numbers are assigned as the statement
            progresses), all auto-increment values assigned by any
            <span class="quote">“<span class="quote"><a class="link" href="sql-syntax.html#insert" title="13.2.5 INSERT Syntax"><code class="literal">INSERT</code></a>-like</span>”</span>
            statement are consecutive, and operations are safe for
            statement-based replication.
          </p><p>
            Simply put, this lock mode significantly improves
            scalability while being safe for use with statement-based
            replication. Further, as with <span class="quote">“<span class="quote">traditional</span>”</span>
            lock mode, auto-increment numbers assigned by any given
            statement are <span class="emphasis"><em>consecutive</em></span>. There is
            <span class="emphasis"><em>no change</em></span> in semantics compared to
            <span class="quote">“<span class="quote">traditional</span>”</span> mode for any statement that uses
            auto-increment, with one important exception.
          </p><p>
            The exception is for <span class="quote">“<span class="quote">mixed-mode inserts</span>”</span>,
            where the user provides explicit values for an
            <code class="literal">AUTO_INCREMENT</code> column for some, but not
            all, rows in a multiple-row <span class="quote">“<span class="quote">simple insert</span>”</span>.
            For such inserts, <code class="literal">InnoDB</code> allocates more
            auto-increment values than the number of rows to be
            inserted. However, all values automatically assigned are
            consecutively generated (and thus higher than) the
            auto-increment value generated by the most recently executed
            previous statement. <span class="quote">“<span class="quote">Excess</span>”</span> numbers are lost.
          </p></li><li class="listitem"><p><a name="innodb-auto-increment-lock-mode-interleaved"></a>
            <code class="literal">innodb_autoinc_lock_mode = 2</code>
            (<span class="quote">“<span class="quote">interleaved</span>”</span> lock mode)
          </p><p>
            In this lock mode, no
            <span class="quote">“<span class="quote"><a class="link" href="sql-syntax.html#insert" title="13.2.5 INSERT Syntax"><code class="literal">INSERT</code></a>-like</span>”</span>
            statements use the table-level <code class="literal">AUTO-INC</code>
            lock, and multiple statements can execute at the same time.
            This is the fastest and most scalable lock mode, but it is
            <span class="emphasis"><em>not safe</em></span> when using statement-based
            replication or recovery scenarios when SQL statements are
            replayed from the binary log.
          </p><p>
            In this lock mode, auto-increment values are guaranteed to
            be unique and monotonically increasing across all
            concurrently executing
            <span class="quote">“<span class="quote"><a class="link" href="sql-syntax.html#insert" title="13.2.5 INSERT Syntax"><code class="literal">INSERT</code></a>-like</span>”</span>
            statements. However, because multiple statements can be
            generating numbers at the same time (that is, allocation of
            numbers is <span class="emphasis"><em>interleaved</em></span> across
            statements), the values generated for the rows inserted by
            any given statement may not be consecutive.
          </p><p>
            If the only statements executing are <span class="quote">“<span class="quote">simple
            inserts</span>”</span> where the number of rows to be inserted is
            known ahead of time, there will be no gaps in the numbers
            generated for a single statement, except for
            <span class="quote">“<span class="quote">mixed-mode inserts</span>”</span>. However, when <span class="quote">“<span class="quote">bulk
            inserts</span>”</span> are executed, there may be gaps in the
            auto-increment values assigned by any given statement.
</p></li></ul>
</div>

</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h4 class="title"><a name="innodb-auto-increment-lock-mode-usage-implications"></a>InnoDB AUTO_INCREMENT Lock Mode Usage Implications</h4>

</div>

</div>

</div>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            Using auto-increment with replication
          </p><p>
            If you are using statement-based replication, set
            <a class="link" href="innodb-storage-engine.html#sysvar_innodb_autoinc_lock_mode"><code class="literal">innodb_autoinc_lock_mode</code></a> to
            0 or 1 and use the same value on the master and its slaves.
            Auto-increment values are not ensured to be the same on the
            slaves as on the master if you use
            <a class="link" href="innodb-storage-engine.html#sysvar_innodb_autoinc_lock_mode"><code class="literal">innodb_autoinc_lock_mode</code></a> =
            2 (<span class="quote">“<span class="quote">interleaved</span>”</span>) or configurations where the
            master and slaves do not use the same lock mode.
          </p><p>
            If you are using row-based or mixed-format replication, all
            of the auto-increment lock modes are safe, since row-based
            replication is not sensitive to the order of execution of
            the SQL statements (and the mixed format uses row-based
            replication for any statements that are unsafe for
            statement-based replication).
          </p></li><li class="listitem"><p>
            <span class="quote">“<span class="quote">Lost</span>”</span> auto-increment values and sequence gaps
          </p><p>
            In all lock modes (0, 1, and 2), if a transaction that
            generated auto-increment values rolls back, those
            auto-increment values are <span class="quote">“<span class="quote">lost</span>”</span>. Once a value
            is generated for an auto-increment column, it cannot be
            rolled back, whether or not the
            <span class="quote">“<span class="quote"><a class="link" href="sql-syntax.html#insert" title="13.2.5 INSERT Syntax"><code class="literal">INSERT</code></a>-like</span>”</span>
            statement is completed, and whether or not the containing
            transaction is rolled back. Such lost values are not reused.
            Thus, there may be gaps in the values stored in an
            <code class="literal">AUTO_INCREMENT</code> column of a table.
          </p></li><li class="listitem"><p>
            Specifying NULL or 0 for the
            <code class="literal">AUTO_INCREMENT</code> column
          </p><p>
            In all lock modes (0, 1, and 2), if a user specifies NULL or
            0 for the <code class="literal">AUTO_INCREMENT</code> column in an
            <a class="link" href="sql-syntax.html#insert" title="13.2.5 INSERT Syntax"><code class="literal">INSERT</code></a>,
            <code class="literal">InnoDB</code> treats the row as if the value was
            not specified and generates a new value for it.
          </p></li><li class="listitem"><p>
            Assigning a negative value to the
            <code class="literal">AUTO_INCREMENT</code> column
          </p><p>
            In all lock modes (0, 1, and 2), the behavior of the
            auto-increment mechanism is not defined if you assign a
            negative value to the <code class="literal">AUTO_INCREMENT</code>
            column.
          </p></li><li class="listitem"><p>
            If the <code class="literal">AUTO_INCREMENT</code> value becomes
            larger than the maximum integer for the specified integer
            type
          </p><p>
            In all lock modes (0, 1, and 2), the behavior of the
            auto-increment mechanism is not defined if the value becomes
            larger than the maximum integer that can be stored in the
            specified integer type.
          </p></li><li class="listitem"><p>
            Gaps in auto-increment values for <span class="quote">“<span class="quote">bulk
            inserts</span>”</span>
          </p><p>
            With
            <a class="link" href="innodb-storage-engine.html#sysvar_innodb_autoinc_lock_mode"><code class="literal">innodb_autoinc_lock_mode</code></a>
            set to 0 (<span class="quote">“<span class="quote">traditional</span>”</span>) or 1
            (<span class="quote">“<span class="quote">consecutive</span>”</span>), the auto-increment values
            generated by any given statement will be consecutive,
            without gaps, because the table-level
            <code class="literal">AUTO-INC</code> lock is held until the end of
            the statement, and only one such statement can execute at a
            time.
          </p><p>
            With
            <a class="link" href="innodb-storage-engine.html#sysvar_innodb_autoinc_lock_mode"><code class="literal">innodb_autoinc_lock_mode</code></a>
            set to 2 (<span class="quote">“<span class="quote">interleaved</span>”</span>), there may be gaps in
            the auto-increment values generated by <span class="quote">“<span class="quote">bulk
            inserts,</span>”</span> but only if there are concurrently
            executing
            <span class="quote">“<span class="quote"><a class="link" href="sql-syntax.html#insert" title="13.2.5 INSERT Syntax"><code class="literal">INSERT</code></a>-like</span>”</span>
            statements.
          </p><p>
            For lock modes 1 or 2, gaps may occur between successive
            statements because for bulk inserts the exact number of
            auto-increment values required by each statement may not be
            known and overestimation is possible.
          </p></li><li class="listitem"><p>
            Auto-increment values assigned by <span class="quote">“<span class="quote">mixed-mode
            inserts</span>”</span>
          </p><p>
            Consider a <span class="quote">“<span class="quote">mixed-mode insert,</span>”</span> where a
            <span class="quote">“<span class="quote">simple insert</span>”</span> specifies the auto-increment
            value for some (but not all) resulting rows. Such a
            statement will behave differently in lock modes 0, 1, and 2.
            For example, assume <code class="literal">c1</code> is an
            <code class="literal">AUTO_INCREMENT</code> column of table
            <code class="literal">t1</code>, and that the most recent
            automatically generated sequence number is 100. Consider the
            following <span class="quote">“<span class="quote">mixed-mode insert</span>”</span> statement:
          </p><pre class="programlisting">
INSERT INTO t1 (c1,c2) VALUES (1,'a'), (NULL,'b'), (5,'c'), (NULL,'d');
</pre><p>
            With
            <a class="link" href="innodb-storage-engine.html#sysvar_innodb_autoinc_lock_mode"><code class="literal">innodb_autoinc_lock_mode</code></a>
            set to 0 (<span class="quote">“<span class="quote">traditional</span>”</span>), the four new rows
            will be:
          </p><pre class="programlisting">
+-----+------+
| c1  | c2   |
+-----+------+
|   1 | a    |
| 101 | b    |
|   5 | c    |
| 102 | d    |
+-----+------+
</pre><p>
            The next available auto-increment value will be 103 because
            the auto-increment values are allocated one at a time, not
            all at once at the beginning of statement execution. This
            result is true whether or not there are concurrently
            executing
            <span class="quote">“<span class="quote"><a class="link" href="sql-syntax.html#insert" title="13.2.5 INSERT Syntax"><code class="literal">INSERT</code></a>-like</span>”</span>
            statements (of any type).
          </p><p>
            With
            <a class="link" href="innodb-storage-engine.html#sysvar_innodb_autoinc_lock_mode"><code class="literal">innodb_autoinc_lock_mode</code></a>
            set to 1 (<span class="quote">“<span class="quote">consecutive</span>”</span>), the four new rows
            will also be:
          </p><pre class="programlisting">
+-----+------+
| c1  | c2   |
+-----+------+
|   1 | a    |
| 101 | b    |
|   5 | c    |
| 102 | d    |
+-----+------+
</pre><p>
            However, in this case, the next available auto-increment
            value will be 105, not 103 because four auto-increment
            values are allocated at the time the statement is processed,
            but only two are used. This result is true whether or not
            there are concurrently executing
            <span class="quote">“<span class="quote"><a class="link" href="sql-syntax.html#insert" title="13.2.5 INSERT Syntax"><code class="literal">INSERT</code></a>-like</span>”</span>
            statements (of any type).
          </p><p>
            With
            <a class="link" href="innodb-storage-engine.html#sysvar_innodb_autoinc_lock_mode"><code class="literal">innodb_autoinc_lock_mode</code></a>
            set to mode 2 (<span class="quote">“<span class="quote">interleaved</span>”</span>), the four new
            rows will be:
          </p><pre class="programlisting">
+-----+------+
| c1  | c2   |
+-----+------+
|   1 | a    |
|   <em class="replaceable"><code>x</code></em> | b    |
|   5 | c    |
|   <em class="replaceable"><code>y</code></em> | d    |
+-----+------+
</pre><p>
            The values of <em class="replaceable"><code>x</code></em> and
            <em class="replaceable"><code>y</code></em> will be unique and larger than
            any previously generated rows. However, the specific values
            of <em class="replaceable"><code>x</code></em> and
            <em class="replaceable"><code>y</code></em> will depend on the number of
            auto-increment values generated by concurrently executing
            statements.
          </p><p>
            Finally, consider the following statement, issued when the
            most-recently generated sequence number was the value 4:
          </p><pre class="programlisting">
INSERT INTO t1 (c1,c2) VALUES (1,'a'), (NULL,'b'), (5,'c'), (NULL,'d');
</pre><p>
            With any
            <a class="link" href="innodb-storage-engine.html#sysvar_innodb_autoinc_lock_mode"><code class="literal">innodb_autoinc_lock_mode</code></a>
            setting, this statement will generate a duplicate-key error
            23000 (<code class="literal">Can't write; duplicate key in
            table</code>) because 5 will be allocated for the row
            <code class="literal">(NULL, 'b')</code> and insertion of the row
            <code class="literal">(5, 'c')</code> will fail.
</p></li></ul>
</div>

</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h4 class="title"><a name="innodb-auto-increment-initialization"></a>InnoDB AUTO_INCREMENT Counter Initialization</h4>

</div>

</div>

</div>
<p>
        This section describes how <code class="literal">InnoDB</code> initializes
        <code class="literal">AUTO_INCREMENT</code> counters.
      </p><p>
        If you specify an <code class="literal">AUTO_INCREMENT</code> column for
        an <code class="literal">InnoDB</code> table, the table handle in the
        <code class="literal">InnoDB</code> data dictionary contains a special
        counter called the auto-increment counter that is used in
        assigning new values for the column. This counter is stored only
        in main memory, not on disk.
      </p><p>
        To initialize an auto-increment counter after a server restart,
        <code class="literal">InnoDB</code> executes the equivalent of the
        following statement on the first insert into a table containing
        an <code class="literal">AUTO_INCREMENT</code> column.
      </p><pre class="programlisting">
SELECT MAX(ai_col) FROM <em class="replaceable"><code>table_name</code></em> FOR UPDATE;
</pre><p>
        <code class="literal">InnoDB</code> increments the value retrieved by the
        statement and assigns it to the column and to the auto-increment
        counter for the table. By default, the value is incremented by
        1. This default can be overridden by the
        <a class="link" href="replication.html#sysvar_auto_increment_increment"><code class="literal">auto_increment_increment</code></a>
        configuration setting.
      </p><p>
        If the table is empty, <code class="literal">InnoDB</code> uses the value
        <code class="literal">1</code>. This default can be overridden by the
        <a class="link" href="replication.html#sysvar_auto_increment_offset"><code class="literal">auto_increment_offset</code></a>
        configuration setting.
      </p><p>
        If a <a class="link" href="sql-syntax.html#show-table-status" title="13.7.5.36 SHOW TABLE STATUS Syntax"><code class="literal">SHOW TABLE STATUS</code></a> statement
        examines the table before the auto-increment counter is
        initialized, <code class="literal">InnoDB</code> initializes but does not
        increment the value. The value is stored for use by later
        inserts. This initialization uses a normal exclusive-locking
        read on the table and the lock lasts to the end of the
        transaction. <code class="literal">InnoDB</code> follows the same
        procedure for initializing the auto-increment counter for a
        newly created table.
      </p><p>
        After the auto-increment counter has been initialized, if you do
        not explicitly specify a value for an
        <code class="literal">AUTO_INCREMENT</code> column,
        <code class="literal">InnoDB</code> increments the counter and assigns the
        new value to the column. If you insert a row that explicitly
        specifies the column value, and the value is greater than the
        current counter value, the counter is set to the specified
        column value.
      </p><p>
        <code class="literal">InnoDB</code> uses the in-memory auto-increment
        counter as long as the server runs. When the server is stopped
        and restarted, <code class="literal">InnoDB</code> reinitializes the
        counter for each table for the first
        <a class="link" href="sql-syntax.html#insert" title="13.2.5 INSERT Syntax"><code class="literal">INSERT</code></a> to the table, as described
        earlier.
      </p><p>
        A server restart also cancels the effect of the
        <code class="literal">AUTO_INCREMENT = <em class="replaceable"><code>N</code></em></code>
        table option in <a class="link" href="sql-syntax.html#create-table" title="13.1.18 CREATE TABLE Syntax"><code class="literal">CREATE TABLE</code></a> and
        <a class="link" href="sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a> statements, which you
        can use with <code class="literal">InnoDB</code> tables to set the initial
        counter value or alter the current counter value.
</p>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="innodb-foreign-key-constraints"></a>14.5.6 InnoDB and FOREIGN KEY Constraints</h3>

</div>

</div>

</div>
<a class="indexterm" name="idm140644112706736"></a><a class="indexterm" name="idm140644112705248"></a><a class="indexterm" name="idm140644112703760"></a><p>
      This section describes differences in the InnoDB storage
      engine's handling of foreign keys as compared with that of
      the MySQL Server.
</p>
<h4><a name="idm140644112701712"></a>Foreign Key Definitions</h4>
<p>
      Foreign key definitions for <code class="literal">InnoDB</code> tables are
      subject to the following conditions:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          <code class="literal">InnoDB</code> permits a foreign key to reference
          any index column or group of columns. However, in the
          referenced table, there must be an index where the referenced
          columns are listed as the <span class="emphasis"><em>first</em></span> columns
          in the same order.
        </p></li><li class="listitem"><p>
          <a class="link" href="innodb-storage-engine.html" title="Chapter 14 The InnoDB Storage Engine"><code class="literal">InnoDB</code></a> does not currently support
          foreign keys for tables with user-defined partitioning. This
          means that no user-partitioned <code class="literal">InnoDB</code> table
          may contain foreign key references or columns referenced by
          foreign keys.
        </p></li><li class="listitem"><p>
          <code class="literal">InnoDB</code> allows a foreign key constraint to
          reference a non-unique key. <span class="emphasis"><em>This is an
          <code class="literal">InnoDB</code> extension to standard
          SQL.</em></span>
</p></li></ul>
</div>
<h4><a name="idm140644112691632"></a>Referential Actions</h4>
<p>
      Referential actions for foreign keys of <code class="literal">InnoDB</code>
      tables are subject to the following conditions:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          While <code class="literal">SET DEFAULT</code> is allowed by the MySQL
          Server, it is rejected as invalid by
          <code class="literal">InnoDB</code>. <a class="link" href="sql-syntax.html#create-table" title="13.1.18 CREATE TABLE Syntax"><code class="literal">CREATE
          TABLE</code></a> and <a class="link" href="sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a>
          statements using this clause are not allowed for InnoDB
          tables.
        </p></li><li class="listitem"><p>
          If there are several rows in the parent table that have the
          same referenced key value, <code class="literal">InnoDB</code> acts in
          foreign key checks as if the other parent rows with the same
          key value do not exist. For example, if you have defined a
          <code class="literal">RESTRICT</code> type constraint, and there is a
          child row with several parent rows, <code class="literal">InnoDB</code>
          does not permit the deletion of any of those parent rows.
        </p></li><li class="listitem"><p>
          <code class="literal">InnoDB</code> performs cascading operations
          through a depth-first algorithm, based on records in the
          indexes corresponding to the foreign key constraints.
        </p></li><li class="listitem"><p>
          If <code class="literal">ON UPDATE CASCADE</code> or <code class="literal">ON UPDATE
          SET NULL</code> recurses to update the <span class="emphasis"><em>same
          table</em></span> it has previously updated during the cascade,
          it acts like <code class="literal">RESTRICT</code>. This means that you
          cannot use self-referential <code class="literal">ON UPDATE
          CASCADE</code> or <code class="literal">ON UPDATE SET NULL</code>
          operations. This is to prevent infinite loops resulting from
          cascaded updates. A self-referential <code class="literal">ON DELETE SET
          NULL</code>, on the other hand, is possible, as is a
          self-referential <code class="literal">ON DELETE CASCADE</code>.
          Cascading operations may not be nested more than 15 levels
          deep.
        </p></li><li class="listitem"><p>
          Like MySQL in general, in an SQL statement that inserts,
          deletes, or updates many rows, <code class="literal">InnoDB</code>
          checks <code class="literal">UNIQUE</code> and <code class="literal">FOREIGN
          KEY</code> constraints row-by-row. When performing foreign
          key checks, <code class="literal">InnoDB</code> sets shared row-level
          locks on child or parent records it has to look at.
          <code class="literal">InnoDB</code> checks foreign key constraints
          immediately; the check is not deferred to transaction commit.
          According to the SQL standard, the default behavior should be
          deferred checking. That is, constraints are only checked after
          the <span class="emphasis"><em>entire SQL statement</em></span> has been
          processed. Until <code class="literal">InnoDB</code> implements deferred
          constraint checking, some things will be impossible, such as
          deleting a record that refers to itself using a foreign key.
</p></li></ul>
</div>
<h4><a name="idm140644112666672"></a>Foreign Key Usage and Error Information</h4>
<p>
      You can obtain general information about foreign keys and their
      usage from querying the
      <a class="link" href="information-schema.html#key-column-usage-table" title="21.11 The INFORMATION_SCHEMA KEY_COLUMN_USAGE Table"><code class="literal">INFORMATION_SCHEMA.KEY_COLUMN_USAGE</code></a>
      table, and more information more specific to
      <code class="literal">InnoDB</code> tables can be found in the
      <a class="link" href="information-schema.html#innodb-sys-foreign-table" title="21.31.11 The INFORMATION_SCHEMA INNODB_SYS_FOREIGN Table"><code class="literal">INNODB_SYS_FOREIGN</code></a> and
      <a class="link" href="information-schema.html#innodb-sys-foreign-cols-table" title="21.31.12 The INFORMATION_SCHEMA INNODB_SYS_FOREIGN_COLS Table"><code class="literal">INNODB_SYS_FOREIGN_COLS</code></a> tables, also
      in the <code class="literal">INFORMATION_SCHEMA</code> database. See also
      <a class="xref" href="sql-syntax.html#create-table-foreign-keys" title="13.1.18.3 Using FOREIGN KEY Constraints">Section 13.1.18.3, “Using FOREIGN KEY Constraints”</a>.
    </p><p>
      In addition to <a class="link" href="sql-syntax.html#show-errors" title="13.7.5.17 SHOW ERRORS Syntax"><code class="literal">SHOW ERRORS</code></a>, in the
      event of a foreign key error involving <code class="literal">InnoDB</code>
      tables (usually Error 150 in the MySQL Server), you can obtain a
      detailed explanation of the most recent <code class="literal">InnoDB</code>
      foreign key error by checking the output of
      <a class="link" href="sql-syntax.html#show-engine" title="13.7.5.15 SHOW ENGINE Syntax"><code class="literal">SHOW ENGINE INNODB
      STATUS</code></a>.
</p>
</div>

<div class="section">

<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="innodb-restrictions"></a>14.5.7 Limits on InnoDB Tables</h3>

</div>

</div>

</div>
<a class="indexterm" name="idm140644112653744"></a><a class="indexterm" name="idm140644112652256"></a><a class="indexterm" name="idm140644112650768"></a>
<div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Warning
</div>
<p>
        Do <span class="emphasis"><em>not</em></span> convert MySQL system tables in the
        <code class="literal">mysql</code> database from <code class="literal">MyISAM</code>
        to <code class="literal">InnoDB</code> tables. This is an unsupported
        operation. If you do this, MySQL does not restart until you
        restore the old system tables from a backup or regenerate them
        by reinitializing the data directory (see
        <a class="xref" href="installing.html#data-directory-initialization" title="2.10.1 Initializing the Data Directory">Section 2.10.1, “Initializing the Data Directory”</a>).
</p>
</div>
<div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;">
<div class="admon-title">
Warning
</div>
<p>
        <a class="indexterm" name="idm140644112644400"></a>

        <a class="indexterm" name="idm140644112642944"></a>

        It is not a good idea to configure <code class="literal">InnoDB</code> to
        use data files or log files on NFS volumes. Otherwise, the files
        might be locked by other processes and become unavailable for
        use by MySQL.
</p>
</div>
<h4><a name="idm140644112640288"></a>Maximums and Minimums</h4>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          A table can contain a maximum of 1017 columns (raised in MySQL
          5.6.9 from the earlier limit of 1000). Virtual generated
          columns are included in this limit.
        </p></li><li class="listitem"><p>
          A table can contain a maximum of 64
          <a class="link" href="glossary.html#glos_secondary_index" title="secondary index">secondary indexes</a>.
        </p></li><li class="listitem"><p>
          By default, an index key for a single-column index can be up
          to 767 bytes. The same length limit applies to any index key
          prefix. See <a class="xref" href="sql-syntax.html#create-index" title="13.1.14 CREATE INDEX Syntax">Section 13.1.14, “CREATE INDEX Syntax”</a>. For example, you
          might hit this limit with a
          <a class="link" href="glossary.html#glos_column_prefix" title="column prefix">column prefix</a> index
          of more than 255 characters on a <code class="literal">TEXT</code> or
          <code class="literal">VARCHAR</code> column, assuming a UTF-8 character
          set and the maximum of 3 bytes for each character. When the
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_large_prefix"><code class="literal">innodb_large_prefix</code></a>
          configuration option is enabled, this length limit is raised
          to 3072 bytes, for <code class="literal">InnoDB</code> tables that use
          the
          <code class="literal"><a class="link" href="glossary.html#glos_dynamic_row_format" title="dynamic row format">DYNAMIC</a></code>
          and
          <code class="literal"><a class="link" href="glossary.html#glos_compressed_row_format" title="compressed row format">COMPRESSED</a></code>
          row formats.
        </p><p>
          Attempting to use an index prefix length that is greater than
          the allowed maximum value produces an error. To avoid such
          errors for replication configurations, avoid setting the
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_large_prefix"><code class="literal">innodb_large_prefix</code></a> option on
          the master if it cannot also be set on the slaves, and the
          slaves have unique indexes that could be affected by this
          limit.
        </p></li><li class="listitem"><p>
          The <code class="literal">InnoDB</code> internal maximum key length is
          3500 bytes, but MySQL itself restricts this to 3072 bytes.
          This limit applies to the length of the combined index key in
          a multi-column index.
        </p></li><li class="listitem"><p>
          If you reduce the <code class="literal">InnoDB</code>
          <a class="link" href="glossary.html#glos_page_size" title="page size">page size</a> to 8KB or 4KB
          by specifying the
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_page_size"><code class="literal">innodb_page_size</code></a> option when
          creating the MySQL instance, the maximum length of the index
          key is lowered proportionally, based on the limit of 3072
          bytes for a 16KB page size. That is, the maximum index key
          length is 1536 bytes when the page size is 8KB, and 768 bytes
          when the page size is 4KB.
        </p></li><li class="listitem"><p>
          The maximum row length, except for variable-length columns
          (<a class="link" href="data-types.html#binary-varbinary" title="11.4.2 The BINARY and VARBINARY Types"><code class="literal">VARBINARY</code></a>,
          <a class="link" href="data-types.html#char" title="11.4.1 The CHAR and VARCHAR Types"><code class="literal">VARCHAR</code></a>,
          <a class="link" href="data-types.html#blob" title="11.4.3 The BLOB and TEXT Types"><code class="literal">BLOB</code></a> and
          <a class="link" href="data-types.html#blob" title="11.4.3 The BLOB and TEXT Types"><code class="literal">TEXT</code></a>), is slightly less than
          half of a database page for 4KB, 8KB, 16KB, and 32KB page
          sizes. For example, the maximum row length for the default
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_page_size"><code class="literal">innodb_page_size</code></a> of 16KB is
          about 8000 bytes. For an <code class="literal">InnoDB</code> page size
          of 64KB, the maximum row length is about 16000 bytes.
          <a class="link" href="data-types.html#blob" title="11.4.3 The BLOB and TEXT Types"><code class="literal">LONGBLOB</code></a> and
          <a class="link" href="data-types.html#blob" title="11.4.3 The BLOB and TEXT Types"><code class="literal">LONGTEXT</code></a>
          columns must be less than 4GB, and the total row length,
          including <a class="link" href="data-types.html#blob" title="11.4.3 The BLOB and TEXT Types"><code class="literal">BLOB</code></a> and
          <a class="link" href="data-types.html#blob" title="11.4.3 The BLOB and TEXT Types"><code class="literal">TEXT</code></a> columns, must be less than
          4GB.
        </p><p>
          If a row is less than half a page long, all of it is stored
          locally within the page. If it exceeds half a page,
          variable-length columns are chosen for external off-page
          storage until the row fits within half a page, as described in
          <a class="xref" href="innodb-storage-engine.html#innodb-file-space" title="14.9.2 File Space Management">Section 14.9.2, “File Space Management”</a>.
        </p></li><li class="listitem"><p>
          Although <code class="literal">InnoDB</code> supports row sizes larger
          than 65,535 bytes internally, MySQL itself imposes a row-size
          limit of 65,535 for the combined size of all columns:
        </p><pre class="programlisting">
mysql&gt; <strong class="userinput"><code>CREATE TABLE t (a VARCHAR(8000), b VARCHAR(10000),</code></strong>
    -&gt; <strong class="userinput"><code>c VARCHAR(10000), d VARCHAR(10000), e VARCHAR(10000),</code></strong>
    -&gt; <strong class="userinput"><code>f VARCHAR(10000), g VARCHAR(10000)) ENGINE=InnoDB;</code></strong>
ERROR 1118 (42000): Row size too large. The maximum row size for the
used table type, not counting BLOBs, is 65535. You have to change some
columns to TEXT or BLOBs
</pre><p>
          See <a class="xref" href="restrictions.html#column-count-limit" title="C.10.4 Limits on Table Column Count and Row Size">Section C.10.4, “Limits on Table Column Count and Row Size”</a>.
        </p></li><li class="listitem"><p>
          On some older operating systems, files must be less than 2GB.
          This is not a limitation of <code class="literal">InnoDB</code> itself,
          but if you require a large tablespace, you will need to
          configure it using several smaller data files rather than one
          large data file.
        </p></li><li class="listitem"><p>
          The combined size of the <code class="literal">InnoDB</code> log files
          can be up to 512GB.
        </p></li><li class="listitem"><p>
          The minimum tablespace size is slightly larger than 10MB. The
          maximum tablespace size is four billion database pages (64TB).
          This is also the maximum size for a table.
        </p></li><li class="listitem"><p>
          <a class="indexterm" name="idm140644112594896"></a>

          <a class="indexterm" name="idm140644112593408"></a>

          The default database page size in <code class="literal">InnoDB</code> is
          16KB. You can lower the page size to 8KB or 4KB by specifying
          the <a class="link" href="innodb-storage-engine.html#sysvar_innodb_page_size"><code class="literal">innodb_page_size</code></a> option
          when creating the MySQL instance.
</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
            Prior to MySQL 5.7.6, increasing the page size is not a
            supported operation. There is no guarantee that
            <code class="literal">InnoDB</code> will function normally with a page
            size greater than 16KB. Problems compiling or running
            <code class="literal">InnoDB</code> may occur. In particular,
            <code class="literal">ROW_FORMAT=COMPRESSED</code> in the Barracuda
            file format assumes that the page size is at most 16KB and
            uses 14-bit pointers.
          </p><p>
            As of MySQL 5.7.6, 32KB and 64KB page sizes are supported
            but <code class="literal">ROW_FORMAT=COMPRESSED</code> is still
            unsupported for page sizes greater than 16KB. For both 32KB
            and 64KB page sizes, the maximum record size is 16KB. For
            <a class="link" href="innodb-storage-engine.html#sysvar_innodb_page_size"><code class="literal">innodb_page_size=32k</code></a>,
            extent size is 2MB. For
            <a class="link" href="innodb-storage-engine.html#sysvar_innodb_page_size"><code class="literal">innodb_page_size=64k</code></a>,
            extent size is 4MB.
          </p><p>
            A MySQL instance using a particular
            <code class="literal">InnoDB</code> page size cannot use data files or
            log files from an instance that uses a different page size.
            This limitation could affect restore or downgrade operations
            using data from MySQL 5.6, which does support page sizes
            other than 16KB.
</p>
</div>
</li></ul>
</div>
<h4><a name="idm140644112580752"></a>Restrictions on InnoDB Tables</h4>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          <a class="link" href="sql-syntax.html#analyze-table" title="13.7.2.1 ANALYZE TABLE Syntax"><code class="literal">ANALYZE TABLE</code></a> determines index
          cardinality (as displayed in the
          <code class="literal">Cardinality</code> column of
          <a class="link" href="sql-syntax.html#show-index" title="13.7.5.22 SHOW INDEX Syntax"><code class="literal">SHOW INDEX</code></a> output) by doing
          <a class="link" href="glossary.html#glos_random_dive" title="random dive">random dives</a> to each
          of the index trees and updating index cardinality estimates
          accordingly. Because these are only estimates, repeated runs
          of <a class="link" href="sql-syntax.html#analyze-table" title="13.7.2.1 ANALYZE TABLE Syntax"><code class="literal">ANALYZE TABLE</code></a> could produce
          different numbers. This makes <a class="link" href="sql-syntax.html#analyze-table" title="13.7.2.1 ANALYZE TABLE Syntax"><code class="literal">ANALYZE
          TABLE</code></a> fast on <code class="literal">InnoDB</code> tables but
          not 100% accurate because it does not take all rows into
          account.
        </p><p>
          You can make the
          <a class="link" href="glossary.html#glos_statistics" title="statistics">statistics</a> collected by
          <a class="link" href="sql-syntax.html#analyze-table" title="13.7.2.1 ANALYZE TABLE Syntax"><code class="literal">ANALYZE TABLE</code></a> more precise and
          more stable by turning on the
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_stats_persistent"><code class="literal">innodb_stats_persistent</code></a>
          configuration option, as explained in
          <a class="xref" href="innodb-storage-engine.html#innodb-persistent-stats" title="14.3.11.1 Configuring Persistent Optimizer Statistics Parameters">Section 14.3.11.1, “Configuring Persistent Optimizer Statistics Parameters”</a>. When that setting
          is enabled, it is important to run
          <a class="link" href="sql-syntax.html#analyze-table" title="13.7.2.1 ANALYZE TABLE Syntax"><code class="literal">ANALYZE TABLE</code></a> after major
          changes to indexed column data, because the statistics are not
          recalculated periodically (such as after a server restart) as
          they traditionally have been.
        </p><p>
          You can change the number of random dives by modifying the
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_stats_persistent_sample_pages"><code class="literal">innodb_stats_persistent_sample_pages</code></a>
          system variable (if the persistent statistics setting is
          turned on), or the
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_stats_transient_sample_pages"><code class="literal">innodb_stats_transient_sample_pages</code></a>
          system variable (if the persistent statistics setting is
          turned off).
        </p><p>
          MySQL uses index cardinality estimates only in join
          optimization. If some join is not optimized in the right way,
          you can try using <a class="link" href="sql-syntax.html#analyze-table" title="13.7.2.1 ANALYZE TABLE Syntax"><code class="literal">ANALYZE
          TABLE</code></a>. In the few cases that
          <a class="link" href="sql-syntax.html#analyze-table" title="13.7.2.1 ANALYZE TABLE Syntax"><code class="literal">ANALYZE TABLE</code></a> does not produce
          values good enough for your particular tables, you can use
          <code class="literal">FORCE INDEX</code> with your queries to force the
          use of a particular index, or set the
          <a class="link" href="server-administration.html#sysvar_max_seeks_for_key"><code class="literal">max_seeks_for_key</code></a> system
          variable to ensure that MySQL prefers index lookups over table
          scans. See <a class="xref" href="server-administration.html#server-system-variables" title="5.1.4 Server System Variables">Section 5.1.4, “Server System Variables”</a>, and
          <a class="xref" href="error-handling.html#optimizer-issues" title="B.5.5 Optimizer-Related Issues">Section B.5.5, “Optimizer-Related Issues”</a>.
        </p></li><li class="listitem"><p>
          If statements or transactions are running on a table and
          <a class="link" href="sql-syntax.html#analyze-table" title="13.7.2.1 ANALYZE TABLE Syntax"><code class="literal">ANALYZE TABLE</code></a> is run on the
          same table followed by a second <a class="link" href="sql-syntax.html#analyze-table" title="13.7.2.1 ANALYZE TABLE Syntax"><code class="literal">ANALYZE
          TABLE</code></a> operation, the second
          <a class="link" href="sql-syntax.html#analyze-table" title="13.7.2.1 ANALYZE TABLE Syntax"><code class="literal">ANALYZE TABLE</code></a> operation is
          blocked until the statements or transactions are completed.
          This behavior occurs because <a class="link" href="sql-syntax.html#analyze-table" title="13.7.2.1 ANALYZE TABLE Syntax"><code class="literal">ANALYZE
          TABLE</code></a> marks the currently loaded table definition as
          obsolete when <a class="link" href="sql-syntax.html#analyze-table" title="13.7.2.1 ANALYZE TABLE Syntax"><code class="literal">ANALYZE TABLE</code></a> is
          finished running. New statements or transactions (including a
          second <a class="link" href="sql-syntax.html#analyze-table" title="13.7.2.1 ANALYZE TABLE Syntax"><code class="literal">ANALYZE TABLE</code></a> statement)
          must load the new table definition into the table cache, which
          cannot occur until currently running statements or
          transactions are completed and the old table definition is
          purged. Loading multiple concurrent table definitions is not
          supported.
        </p></li><li class="listitem"><p>
          <a class="link" href="sql-syntax.html#show-table-status" title="13.7.5.36 SHOW TABLE STATUS Syntax"><code class="literal">SHOW TABLE STATUS</code></a> does not give
          accurate statistics on <code class="literal">InnoDB</code> tables,
          except for the physical size reserved by the table. The row
          count is only a rough estimate used in SQL optimization.
        </p></li><li class="listitem"><p>
          <code class="literal">InnoDB</code> does not keep an internal count of
          rows in a table because concurrent transactions might
          <span class="quote">“<span class="quote">see</span>”</span> different numbers of rows at the same time.
          To process a <code class="literal">SELECT COUNT(*) FROM t</code>
          statement, <code class="literal">InnoDB</code> scans an index of the
          table, which takes some time if the index is not entirely in
          the buffer pool. To get a fast count, you have to use a
          counter table you create yourself and let your application
          update it according to the inserts and deletes it does. If an
          approximate row count is sufficient, <a class="link" href="sql-syntax.html#show-table-status" title="13.7.5.36 SHOW TABLE STATUS Syntax"><code class="literal">SHOW
          TABLE STATUS</code></a> can be used. See
          <a class="xref" href="optimization.html#optimizing-innodb" title="8.5 Optimizing for InnoDB Tables">Section 8.5, “Optimizing for InnoDB Tables”</a>.
        </p></li><li class="listitem"><p>
          On Windows, <code class="literal">InnoDB</code> always stores database
          and table names internally in lowercase. To move databases in
          a binary format from Unix to Windows or from Windows to Unix,
          create all databases and tables using lowercase names.
        </p></li><li class="listitem"><p>
          An <code class="literal">AUTO_INCREMENT</code> column
          <em class="replaceable"><code>ai_col</code></em> must be defined as part of
          an index such that it is possible to perform the equivalent of
          an indexed <code class="literal">SELECT
          MAX(<em class="replaceable"><code>ai_col</code></em>)</code> lookup on the
          table to obtain the maximum column value. Typically, this is
          achieved by making the column the first column of some table
          index.
        </p></li><li class="listitem"><p>
          <code class="literal">InnoDB</code> sets an exclusive lock on the end of
          the index associated with the
          <code class="literal">AUTO_INCREMENT</code> column while initializing a
          previously specified <code class="literal">AUTO_INCREMENT</code> column
          on a table.
        </p><p>
          With
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_autoinc_lock_mode"><code class="literal">innodb_autoinc_lock_mode=0</code></a>,
          <code class="literal">InnoDB</code> uses a special
          <code class="literal">AUTO-INC</code> table lock mode where the lock is
          obtained and held to the end of the current SQL statement
          while accessing the auto-increment counter. Other clients
          cannot insert into the table while the
          <code class="literal">AUTO-INC</code> table lock is held. The same
          behavior occurs for <span class="quote">“<span class="quote">bulk inserts</span>”</span> with
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_autoinc_lock_mode"><code class="literal">innodb_autoinc_lock_mode=1</code></a>.
          Table-level <code class="literal">AUTO-INC</code> locks are not used
          with
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_autoinc_lock_mode"><code class="literal">innodb_autoinc_lock_mode=2</code></a>.
          For more information, See
          <a class="xref" href="innodb-storage-engine.html#innodb-auto-increment-handling" title="14.5.5 AUTO_INCREMENT Handling in InnoDB">Section 14.5.5, “AUTO_INCREMENT Handling in InnoDB”</a>.
        </p></li><li class="listitem"><p>
          When you restart the MySQL server, <code class="literal">InnoDB</code>
          may reuse an old value that was generated for an
          <code class="literal">AUTO_INCREMENT</code> column but never stored
          (that is, a value that was generated during an old transaction
          that was rolled back).
        </p></li><li class="listitem"><p>
          When an <code class="literal">AUTO_INCREMENT</code> integer column runs
          out of values, a subsequent <code class="literal">INSERT</code>
          operation returns a duplicate-key error. This is general MySQL
          behavior, similar to how <code class="literal">MyISAM</code> works.
        </p></li><li class="listitem"><p>
          <code class="literal">DELETE FROM
          <em class="replaceable"><code>tbl_name</code></em></code> does not
          regenerate the table but instead deletes all rows, one by one.
        </p></li><li class="listitem"><p>
          Cascaded foreign key actions do not activate triggers.
        </p></li><li class="listitem"><p>
          You cannot create a table with a column name that matches the
          name of an internal InnoDB column (including
          <code class="literal">DB_ROW_ID</code>, <code class="literal">DB_TRX_ID</code>,
          <code class="literal">DB_ROLL_PTR</code>, and
          <code class="literal">DB_MIX_ID</code>). The server reports error 1005
          and refers to error −1 in the error message. This
          restriction applies only to use of the names in uppercase.
</p></li></ul>
</div>
<h4><a name="idm140644112508432"></a>Locking and Transactions</h4>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          <a class="link" href="sql-syntax.html#lock-tables" title="13.3.5 LOCK TABLES and UNLOCK TABLES Syntax"><code class="literal">LOCK TABLES</code></a> acquires two locks
          on each table if <code class="literal">innodb_table_locks=1</code> (the
          default). In addition to a table lock on the MySQL layer, it
          also acquires an <code class="literal">InnoDB</code> table lock.
          Versions of MySQL before 4.1.2 did not acquire
          <code class="literal">InnoDB</code> table locks; the old behavior can be
          selected by setting <code class="literal">innodb_table_locks=0</code>.
          If no <code class="literal">InnoDB</code> table lock is acquired,
          <a class="link" href="sql-syntax.html#lock-tables" title="13.3.5 LOCK TABLES and UNLOCK TABLES Syntax"><code class="literal">LOCK TABLES</code></a> completes even if
          some records of the tables are being locked by other
          transactions.
        </p><p>
          In MySQL 5.7,
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_table_locks"><code class="literal">innodb_table_locks=0</code></a> has no
          effect for tables locked explicitly with
          <a class="link" href="sql-syntax.html#lock-tables" title="13.3.5 LOCK TABLES and UNLOCK TABLES Syntax"><code class="literal">LOCK TABLES ...
          WRITE</code></a>. It does have an effect for tables locked for
          read or write by
          <a class="link" href="sql-syntax.html#lock-tables" title="13.3.5 LOCK TABLES and UNLOCK TABLES Syntax"><code class="literal">LOCK TABLES ...
          WRITE</code></a> implicitly (for example, through triggers) or
          by <a class="link" href="sql-syntax.html#lock-tables" title="13.3.5 LOCK TABLES and UNLOCK TABLES Syntax"><code class="literal">LOCK TABLES
          ... READ</code></a>.
        </p></li><li class="listitem"><p>
          All <code class="literal">InnoDB</code> locks held by a transaction are
          released when the transaction is committed or aborted. Thus,
          it does not make much sense to invoke
          <a class="link" href="sql-syntax.html#lock-tables" title="13.3.5 LOCK TABLES and UNLOCK TABLES Syntax"><code class="literal">LOCK TABLES</code></a> on
          <code class="literal">InnoDB</code> tables in
          <a class="link" href="server-administration.html#sysvar_autocommit"><code class="literal">autocommit=1</code></a> mode because the
          acquired <code class="literal">InnoDB</code> table locks would be
          released immediately.
        </p></li><li class="listitem"><p>
          You cannot lock additional tables in the middle of a
          transaction because <a class="link" href="sql-syntax.html#lock-tables" title="13.3.5 LOCK TABLES and UNLOCK TABLES Syntax"><code class="literal">LOCK TABLES</code></a>
          performs an implicit <a class="link" href="sql-syntax.html#commit" title="13.3.1 START TRANSACTION, COMMIT, and ROLLBACK Syntax"><code class="literal">COMMIT</code></a> and
          <a class="link" href="sql-syntax.html#lock-tables" title="13.3.5 LOCK TABLES and UNLOCK TABLES Syntax"><code class="literal">UNLOCK
          TABLES</code></a>.
        </p></li><li class="listitem"><p>
          The limit on data-modifying transactions is now 96 * 1023
          concurrent transactions that generate undo records. As of
          MySQL 5.7.2, 32 of 128 rollback segments are assigned to
          non-redo logs for transactions that modify temporary tables
          and related objects. This reduces the maximum number of
          concurrent data-modifying transactions from 128K to 96K. The
          96K limit assumes that transactions do not modify temporary
          tables. If all data-modifying transactions also modify
          temporary tables, the limit is 32K concurrent transactions.
</p></li></ul>
</div>

</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="innodb-compression"></a>14.6 InnoDB Table and Page Compression</h2>

</div>

</div>

</div>
<div class="toc">
<dl class="toc"><dt><span class="section"><a href="innodb-storage-engine.html#innodb-table-compression">14.6.1 InnoDB Table Compression</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-page-compression">14.6.2 InnoDB Page Compression</a></span></dt></dl>
</div>
<a class="indexterm" name="idm140644112481552"></a><a class="indexterm" name="idm140644112480512"></a><p>
    This section provides information about the
    <code class="literal">InnoDB</code> table compression and
    <code class="literal">InnoDB</code> page compression features. The page
    compression feature, referred to as
    <a class="link" href="glossary.html#glos_transparent_page_compression" title="transparent page compression">transparent page
    compression</a>, was introduced in MySQL 5.7.8.
  </p><p>
    Using the compression features of <code class="literal">InnoDB</code>, you can
    create tables where the data is stored in compressed form.
    Compression can help to improve both raw performance and
    scalability. The compression means less data is transferred between
    disk and memory, and takes up less space on disk and in memory. The
    benefits are amplified for tables with
    <a class="link" href="glossary.html#glos_secondary_index" title="secondary index">secondary indexes</a>,
    because index data is compressed also. Compression can be especially
    important for <a class="link" href="glossary.html#glos_ssd" title="SSD">SSD</a> storage devices,
    because they tend to have lower capacity than
    <a class="link" href="glossary.html#glos_hdd" title="HDD">HDD</a> devices.
</p>
<div class="section">

<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="innodb-table-compression"></a>14.6.1 InnoDB Table Compression</h3>

</div>

</div>

</div>

<div class="toc">
<dl class="toc"><dt><span class="section"><a href="innodb-storage-engine.html#innodb-compression-background">14.6.1.1 Overview of Table Compression</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-compression-usage">14.6.1.2 Creating Compressed Tables</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-compression-tuning">14.6.1.3 Tuning Compression for InnoDB Tables</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-compression-tuning-monitoring">14.6.1.4 Monitoring Compression at Runtime</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-compression-internals">14.6.1.5 How Compression Works for InnoDB Tables</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-performance-compression-oltp">14.6.1.6 Compression for OLTP Workloads</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-compression-syntax-warnings">14.6.1.7 SQL Compression Syntax Warnings and Errors</a></span></dt></dl>
</div>
<p>
      This section describes <code class="literal">InnoDB</code> table
      compression, which is supported with <code class="literal">InnoDB</code>
      tables that reside in
      <a class="link" href="glossary.html#glos_file_per_table" title="file-per-table">file_per_table</a>
      tablespaces or <a class="link" href="glossary.html#glos_general_tablespace" title="general tablespace">general
      tablespaces</a>. Table compression is enabled using the
      <code class="literal">ROW_FORMAT=COMPRESSED</code> attribute with
      <a class="link" href="sql-syntax.html#create-table" title="13.1.18 CREATE TABLE Syntax"><code class="literal">CREATE TABLE</code></a> or
      <a class="link" href="sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a>.
</p>
<div class="section">

<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="innodb-compression-background"></a>14.6.1.1 Overview of Table Compression</h4>
</div>
</div>
</div>
<a class="indexterm" name="idm140644112463296"></a><p>
        Because processors and cache memories have increased in speed
        more than disk storage devices, many workloads are
        <a class="link" href="glossary.html#glos_disk_bound" title="disk-bound">disk-bound</a>. Data
        <a class="link" href="glossary.html#glos_compression" title="compression">compression</a> enables
        smaller database size, reduced I/O, and improved throughput, at
        the small cost of increased CPU utilization. Compression is
        especially valuable for read-intensive applications, on systems
        with enough RAM to keep frequently used data in memory.
      </p><p>
        An <code class="literal">InnoDB</code> table created with
        <code class="literal">ROW_FORMAT=COMPRESSED</code> can use a smaller
        <a class="link" href="glossary.html#glos_page_size" title="page size">page size</a> on disk than the
        configured <a class="link" href="innodb-storage-engine.html#sysvar_innodb_page_size"><code class="literal">innodb_page_size</code></a>
        value. Smaller pages require less I/O to read from and write to
        disk, which is especially valuable for
        <a class="link" href="glossary.html#glos_ssd" title="SSD">SSD</a> devices.
      </p><p>
        The compressed page size is specified through the
        <a class="link" href="sql-syntax.html#create-table" title="13.1.18 CREATE TABLE Syntax"><code class="literal">CREATE TABLE</code></a> or
        <a class="link" href="sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a>
        <code class="literal">KEY_BLOCK_SIZE</code> parameter. The different page
        size requires that the table be placed in a
        <a class="link" href="glossary.html#glos_file_per_table" title="file-per-table">file-per-table</a>
        tablespace or <a class="link" href="glossary.html#glos_general_tablespace" title="general tablespace">general
        tablespace</a> rather than in the
        <a class="link" href="glossary.html#glos_system_tablespace" title="system tablespace">system tablespace</a>,
        as the system tablespace cannot store compressed tables. For
        more information, see
        <a class="xref" href="innodb-storage-engine.html#innodb-multiple-tablespaces" title="14.4.4 InnoDB File-Per-Table Tablespaces">Section 14.4.4, “InnoDB File-Per-Table Tablespaces”</a>, and
        <a class="xref" href="innodb-storage-engine.html#general-tablespaces" title="14.4.9 InnoDB General Tablespaces">Section 14.4.9, “InnoDB General Tablespaces”</a>.
      </p><p>
        The level of compression is the same regardless of the
        <code class="literal">KEY_BLOCK_SIZE</code> value. As you specify smaller
        values for <code class="literal">KEY_BLOCK_SIZE</code>, you get the I/O
        benefits of increasingly smaller pages. But if you specify a
        value that is too small, there is additional overhead to
        reorganize the pages when data values cannot be compressed
        enough to fit multiple rows in each page. There is a hard limit
        on how small <code class="literal">KEY_BLOCK_SIZE</code> can be for a
        table, based on the lengths of the key columns for each of its
        indexes. Specify a value that is too small, and the
        <a class="link" href="sql-syntax.html#create-table" title="13.1.18 CREATE TABLE Syntax"><code class="literal">CREATE TABLE</code></a> or
        <a class="link" href="sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a> statement fails.
      </p><p>
        In the buffer pool, the compressed data is held in small pages,
        with a page size based on the <code class="literal">KEY_BLOCK_SIZE</code>
        value. For extracting or updating the column values, MySQL also
        creates an uncompressed page in the buffer pool with the
        uncompressed data. Within the buffer pool, any updates to the
        uncompressed page are also re-written back to the equivalent
        compressed page. You might need to size your buffer pool to
        accommodate the additional data of both compressed and
        uncompressed pages, although the uncompressed pages are
        <a class="link" href="glossary.html#glos_eviction" title="eviction">evicted</a> from the buffer
        pool when space is needed, and then uncompressed again on the
        next access.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="innodb-compression-usage"></a>14.6.1.2 Creating Compressed Tables</h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140644112437200"></a><a class="indexterm" name="idm140644112435712"></a><a class="indexterm" name="idm140644112434640"></a><a class="indexterm" name="idm140644112433152"></a><a class="indexterm" name="idm140644112431664"></a><a class="indexterm" name="idm140644112430176"></a><a class="indexterm" name="idm140644112429104"></a><a class="indexterm" name="idm140644112428032"></a><p>
        Compressed tables can be created in
        <a class="link" href="glossary.html#glos_file_per_table" title="file-per-table">file-per-table</a>
        tablespaces or in
        <a class="link" href="glossary.html#glos_general_tablespace" title="general tablespace">general
        tablespaces</a>. Table compression is not available for the
        InnoDB <a class="link" href="glossary.html#glos_system_tablespace" title="system tablespace">system
        tablespace</a>. The system tablespace (space 0, the
        <a class="link" href="glossary.html#glos_ibd_file" title=".ibd file">.ibdata files</a>) can contain
        user-created tables, but it also contains internal system data,
        which is never compressed. Thus, compression applies only to
        tables (and indexes) stored in file-per-table or general
        tablespaces.
</p>
<h5><a name="idm140644112422400"></a>Creating a Compressed Table in File-Per-Table Tablespace</h5>
<p>
        To create a compressed table in a file-per-table tablespace,
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_per_table"><code class="literal">innodb_file_per_table</code></a> must be
        enabled (the default in MySQL 5.6.6) and
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_format"><code class="literal">innodb_file_format</code></a> must be set
        to <code class="literal">Barracuda</code>. You can set these parameters in
        the MySQL configuration file (<code class="filename">my.cnf</code> or
        <code class="filename">my.ini</code>) or dynamically, using a
        <a class="link" href="sql-syntax.html#set-statement" title="13.7.4 SET Syntax"><code class="literal">SET</code></a>
        statement.
      </p><p>
        After the <a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_per_table"><code class="literal">innodb_file_per_table</code></a>
        and <a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_format"><code class="literal">innodb_file_format</code></a> options
        are configured, specify the
        <code class="literal">ROW_FORMAT=COMPRESSED</code> clause or
        <code class="literal">KEY_BLOCK_SIZE</code> clause, or both, in a
        <a class="link" href="sql-syntax.html#create-table" title="13.1.18 CREATE TABLE Syntax"><code class="literal">CREATE TABLE</code></a> or
        <a class="link" href="sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a> statement to create a
        compressed table in a file-per-table tablespace.
      </p><p>
        For example, you might use the following statements:
      </p><pre class="programlisting">SET GLOBAL innodb_file_per_table=1;
SET GLOBAL innodb_file_format=Barracuda;
CREATE TABLE t1
 (c1 INT PRIMARY KEY) 
 ROW_FORMAT=COMPRESSED 
KEY_BLOCK_SIZE=8;</pre>
<h5><a name="idm140644112406832"></a>Creating a Compressed Table in a General Tablespace</h5>
<p>
        To create a compressed table in a general tablespace,
        <code class="literal">FILE_BLOCK_SIZE</code> must be defined for the
        general tablespace, which is specified when the tablespace is
        created. The <code class="literal">FILE_BLOCK_SIZE</code> value must be a
        valid compressed page size in relation to the
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_page_size"><code class="literal">innodb_page_size</code></a> value, and the
        page size of the compressed table, defined by the
        <a class="link" href="sql-syntax.html#create-table" title="13.1.18 CREATE TABLE Syntax"><code class="literal">CREATE TABLE</code></a> or
        <a class="link" href="sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a>
        <code class="literal">KEY_BLOCK_SIZE</code> clause, must be equal to
        <code class="literal">FILE_BLOCK_SIZE/1024</code>. For example, if
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_page_size"><code class="literal">innodb_page_size=16384</code></a> and
        <code class="literal">FILE_BLOCK_SIZE=8192</code>, the
        <code class="literal">KEY_BLOCK_SIZE</code> of the table must be 8. For
        more information, see <a class="xref" href="innodb-storage-engine.html#general-tablespaces" title="14.4.9 InnoDB General Tablespaces">Section 14.4.9, “InnoDB General Tablespaces”</a>.
      </p><p>
        The following example demonstrates creating a general tablespace
        and adding a compressed table. The example assumes a default
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_page_size"><code class="literal">innodb_page_size</code></a> of 16K. The
        <code class="literal">FILE_BLOCK_SIZE</code> of 8192 requires that the
        compressed table have a <code class="literal">KEY_BLOCK_SIZE</code> of 8.
      </p><pre class="programlisting">mysql&gt; CREATE TABLESPACE `ts2` ADD DATAFILE 'ts2.ibd' FILE_BLOCK_SIZE = 8192 Engine=InnoDB;
Query OK, 0 rows affected (0.01 sec)

mysql&gt; CREATE TABLE t4 (c1 INT PRIMARY KEY) TABLESPACE ts2 ROW_FORMAT=COMPRESSED KEY_BLOCK_SIZE=8;
Query OK, 0 rows affected (0.00 sec)</pre>
<h5><a name="idm140644112391200"></a>Notes</h5>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            If you specify <code class="literal">ROW_FORMAT=COMPRESSED</code>, you
            can omit <code class="literal">KEY_BLOCK_SIZE</code>; the
            <code class="literal">KEY_BLOCK_SIZE</code> setting defaults to half
            the <a class="link" href="innodb-storage-engine.html#sysvar_innodb_page_size"><code class="literal">innodb_page_size</code></a> value.
          </p></li><li class="listitem"><p>
            If you specify a valid <code class="literal">KEY_BLOCK_SIZE</code>
            value, you can omit
            <code class="literal">ROW_FORMAT=COMPRESSED</code>; compression is
            enabled automatically.
          </p></li><li class="listitem"><p>
            To determine the best value for
            <code class="literal">KEY_BLOCK_SIZE,</code> typically you create
            several copies of the same table with different values for
            this clause, then measure the size of the resulting
            <code class="filename">.ibd</code> files and see how well each
            performs with a realistic
            <a class="link" href="glossary.html#glos_workload" title="workload">workload</a>. For general
            tablespaces, keep in mind that dropping a table does not
            reduce the size of the general tablespace
            <code class="filename">.ibd</code> file, nor does it return disk
            space to the operating system. For more information, see
            <a class="xref" href="innodb-storage-engine.html#general-tablespaces" title="14.4.9 InnoDB General Tablespaces">Section 14.4.9, “InnoDB General Tablespaces”</a>.
          </p></li><li class="listitem"><p>
            The <code class="literal">KEY_BLOCK_SIZE</code> value is treated as a
            hint; a different size could be used by
            <code class="literal">InnoDB</code> if necessary. For file-per-table
            tablespaces, the <code class="literal">KEY_BLOCK_SIZE</code> can only
            be less than or equal to the
            <a class="link" href="innodb-storage-engine.html#sysvar_innodb_page_size"><code class="literal">innodb_page_size</code></a> value. If
            you specify a value greater than the
            <a class="link" href="innodb-storage-engine.html#sysvar_innodb_page_size"><code class="literal">innodb_page_size</code></a> value, the
            specified value is ignored, a warning is issued, and
            <code class="literal">KEY_BLOCK_SIZE</code> is set to half of the
            <a class="link" href="innodb-storage-engine.html#sysvar_innodb_page_size"><code class="literal">innodb_page_size</code></a> value. If
            <code class="literal">innodb_strict_mode=ON</code>, specifying an
            invalid <code class="literal">KEY_BLOCK_SIZE</code> value returns an
            error. For general tablespaces, valid
            <code class="literal">KEY_BLOCK_SIZE</code> values depend on the
            <code class="literal">FILE_BLOCK_SIZE</code> setting of the
            tablespace. For more information, see
            <a class="xref" href="innodb-storage-engine.html#general-tablespaces" title="14.4.9 InnoDB General Tablespaces">Section 14.4.9, “InnoDB General Tablespaces”</a>.
          </p></li><li class="listitem"><p>
            Support for 32k and 64k page sizes was added in MySQL 5.7.6
            but these page sizes do not support compression. For more
            information, refer to the
            <a class="link" href="innodb-storage-engine.html#sysvar_innodb_page_size"><code class="literal">innodb_page_size</code></a>
            documentation.
          </p></li><li class="listitem"><p>
            The default uncompressed size of <code class="literal">InnoDB</code>
            data <a class="link" href="glossary.html#glos_page" title="page">pages</a> is 16KB.
            Depending on the combination of option values, MySQL uses a
            page size of 1KB, 2KB, 4KB, 8KB, or 16KB for the tablespace
            data file (<code class="filename">.ibd</code> file). The actual
            compression algorithm is not affected by the
            <code class="literal">KEY_BLOCK_SIZE</code> value; the value
            determines how large each compressed chunk is, which in turn
            affects how many rows can be packed into each compressed
            page.
          </p></li><li class="listitem"><p>
            When creating a compressed table in a file-per-table
            tablespace, setting <code class="literal">KEY_BLOCK_SIZE</code> equal
            to the <code class="literal">InnoDB</code>
            <a class="link" href="glossary.html#glos_page_size" title="page size">page size</a> does not
            typically result in much compression. For example, setting
            <code class="literal">KEY_BLOCK_SIZE=16</code> typically would not
            result in much compression, since the normal
            <code class="literal">InnoDB</code> page size is 16KB. This setting
            may still be useful for tables with many long
            <a class="link" href="data-types.html#blob" title="11.4.3 The BLOB and TEXT Types"><code class="literal">BLOB</code></a>,
            <a class="link" href="data-types.html#char" title="11.4.1 The CHAR and VARCHAR Types"><code class="literal">VARCHAR</code></a> or
            <a class="link" href="data-types.html#blob" title="11.4.3 The BLOB and TEXT Types"><code class="literal">TEXT</code></a> columns, because such
            values often do compress well, and might therefore require
            fewer <a class="link" href="glossary.html#glos_overflow_page" title="overflow page">overflow
            pages</a> as described in
            <a class="xref" href="innodb-storage-engine.html#innodb-compression-internals" title="14.6.1.5 How Compression Works for InnoDB Tables">Section 14.6.1.5, “How Compression Works for InnoDB Tables”</a>. For general
            tablespaces, a <code class="literal">KEY_BLOCK_SIZE</code> value equal
            to the <code class="literal">InnoDB</code> page size is not permitted.
            For more information, see
            <a class="xref" href="innodb-storage-engine.html#general-tablespaces" title="14.4.9 InnoDB General Tablespaces">Section 14.4.9, “InnoDB General Tablespaces”</a>.
          </p></li><li class="listitem"><p>
            All indexes of a table (including the
            <a class="link" href="glossary.html#glos_clustered_index" title="clustered index">clustered index</a>)
            are compressed using the same page size, as specified in the
            <code class="literal">CREATE TABLE</code> or <code class="literal">ALTER
            TABLE</code> statement. Table attributes such as
            <code class="literal">ROW_FORMAT</code> and
            <code class="literal">KEY_BLOCK_SIZE</code> are not part of the
            <code class="literal">CREATE INDEX</code> syntax for
            <code class="literal">InnoDB</code> tables, and are ignored if they
            are specified (although, if specified, they will appear in
            the output of the <a class="link" href="sql-syntax.html#show-create-table" title="13.7.5.10 SHOW CREATE TABLE Syntax"><code class="literal">SHOW CREATE
            TABLE</code></a> statement).
          </p></li><li class="listitem"><p>
            For performance-related configuration options, see
            <a class="xref" href="innodb-storage-engine.html#innodb-compression-tuning" title="14.6.1.3 Tuning Compression for InnoDB Tables">Section 14.6.1.3, “Tuning Compression for InnoDB Tables”</a>.
</p></li></ul>
</div>
<h5><a name="idm140644112338896"></a>Restrictions on Compressed Tables</h5>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            MySQL versions prior to 5.1 cannot process compressed
            tables.
          </p></li><li class="listitem"><p>
            Compressed tables cannot be stored in the
            <code class="literal">InnoDB</code> system tablespace.
          </p></li><li class="listitem"><p>
            General tablespaces can contain multiple tables, but
            compressed and uncompressed tables cannot coexist within the
            same general tablespace.
          </p></li><li class="listitem"><p>
            Compression applies to an entire table and all its
            associated indexes, not to individual rows, despite the
            clause name <code class="literal">ROW_FORMAT</code>.
</p></li></ul>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="innodb-compression-tuning"></a>14.6.1.3 Tuning Compression for InnoDB Tables</h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140644112331456"></a><a class="indexterm" name="idm140644112329968"></a><p>
        Most often, the internal optimizations described in
        <a class="xref" href="innodb-storage-engine.html#innodb-compression-internals-storage" title="InnoDB Data Storage and Compression">InnoDB Data Storage and Compression</a> ensure
        that the system runs well with compressed data. However, because
        the efficiency of compression depends on the nature of your
        data, you can make decisions that affect the performance of
        compressed tables:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            Which tables to compress.
          </p></li><li class="listitem"><p>
            What compressed page size to use.
          </p></li><li class="listitem"><p>
            Whether to adjust the size of the buffer pool based on
            run-time performance characteristics, such as the amount of
            time the system spends compressing and uncompressing data.
            Whether the workload is more like a
            <a class="link" href="glossary.html#glos_data_warehouse" title="data warehouse">data warehouse</a>
            (primarily queries) or an
            <a class="link" href="glossary.html#glos_oltp" title="OLTP">OLTP</a> system (mix of queries
            and <a class="link" href="glossary.html#glos_dml" title="DML">DML</a>).
          </p></li><li class="listitem"><p>
            If the system performs DML operations on compressed tables,
            and the way the data is distributed leads to expensive
            <a class="link" href="glossary.html#glos_compression_failure" title="compression failure">compression
            failures</a> at runtime, you might adjust additional
            advanced configuration options.
</p></li></ul>
</div>
<p>
        Use the guidelines in this section to help make those
        architectural and configuration choices. When you are ready to
        conduct long-term testing and put compressed tables into
        production, see
        <a class="xref" href="innodb-storage-engine.html#innodb-compression-tuning-monitoring" title="14.6.1.4 Monitoring Compression at Runtime">Section 14.6.1.4, “Monitoring Compression at Runtime”</a> for ways
        to verify the effectiveness of those choices under real-world
        conditions.
</p>
<h5><a name="innodb-compression-tuning-when"></a>When to Use Compression</h5>
<p>
        In general, compression works best on tables that include a
        reasonable number of character string columns and where the data
        is read far more often than it is written. Because there are no
        guaranteed ways to predict whether or not compression benefits a
        particular situation, always test with a specific
        <a class="link" href="glossary.html#glos_workload" title="workload">workload</a> and data set
        running on a representative configuration. Consider the
        following factors when deciding which tables to compress.
</p>
<h5><a name="innodb-compression-tuning-when-data"></a>Data Characteristics and Compression</h5>
<a class="indexterm" name="idm140644112313056"></a><p>
        A key determinant of the efficiency of compression in reducing
        the size of data files is the nature of the data itself. Recall
        that compression works by identifying repeated strings of bytes
        in a block of data. Completely randomized data is the worst
        case. Typical data often has repeated values, and so compresses
        effectively. Character strings often compress well, whether
        defined in <code class="literal">CHAR</code>, <code class="literal">VARCHAR</code>,
        <code class="literal">TEXT</code> or <code class="literal">BLOB</code> columns. On
        the other hand, tables containing mostly binary data (integers
        or floating point numbers) or data that is previously compressed
        (for example <acronym class="acronym">JPEG</acronym> or <acronym class="acronym">PNG</acronym>
        images) may not generally compress well, significantly or at
        all.
      </p><p>
        You choose whether to turn on compression for each InnoDB table.
        A table and all of its indexes use the same (compressed)
        <a class="link" href="glossary.html#glos_page_size" title="page size">page size</a>. It might be
        that the <a class="link" href="glossary.html#glos_primary_key" title="primary key">primary key</a>
        (clustered) index, which contains the data for all columns of a
        table, compresses more effectively than the secondary indexes.
        For those cases where there are long rows, the use of
        compression might result in long column values being stored
        <span class="quote">“<span class="quote">off-page</span>”</span>, as discussed in
        <a class="xref" href="innodb-storage-engine.html#innodb-row-format-dynamic" title="14.8.3 DYNAMIC and COMPRESSED Row Formats">Section 14.8.3, “DYNAMIC and COMPRESSED Row Formats”</a>. Those overflow
        pages may compress well. Given these considerations, for many
        applications, some tables compress more effectively than others,
        and you might find that your workload performs best only with a
        subset of tables compressed.
      </p><p>
        To determine whether or not to compress a particular table,
        conduct experiments. You can get a rough estimate of how
        efficiently your data can be compressed by using a utility that
        implements LZ77 compression (such as <code class="literal">gzip</code> or
        WinZip) on a copy of the <a class="link" href="glossary.html#glos_ibd_file" title=".ibd file">.ibd
        file</a> for an uncompressed table. You can expect less
        compression from a MySQL compressed table than from file-based
        compression tools, because MySQL compresses data in chunks based
        on the <a class="link" href="glossary.html#glos_page_size" title="page size">page size</a>, 16KB by
        default. In addition to user data, the page format includes some
        internal system data that is not compressed. File-based
        compression utilities can examine much larger chunks of data,
        and so might find more repeated strings in a huge file than
        MySQL can find in an individual page.
      </p><p>
        Another way to test compression on a specific table is to copy
        some data from your uncompressed table to a similar, compressed
        table (having all the same indexes) in a
        <a class="link" href="glossary.html#glos_file_per_table" title="file-per-table">file-per-table</a>
        tablespace and look at the size of the resulting
        <code class="literal">.ibd</code> file. For example:
      </p><pre class="programlisting">
use test;
set global innodb_file_per_table=1;
set global innodb_file_format=Barracuda;
set global autocommit=0;

-- Create an uncompressed table with a million or two rows.
create table big_table as select * from information_schema.columns;
insert into big_table select * from big_table;
insert into big_table select * from big_table;
insert into big_table select * from big_table;
insert into big_table select * from big_table;
insert into big_table select * from big_table;
insert into big_table select * from big_table;
insert into big_table select * from big_table;
insert into big_table select * from big_table;
insert into big_table select * from big_table;
insert into big_table select * from big_table;
commit;
alter table big_table add id int unsigned not null primary key auto_increment;

show create table big_table\G

select count(id) from big_table;

-- Check how much space is needed for the uncompressed table.
\! ls -l data/test/big_table.ibd

create table key_block_size_4 like big_table;
alter table key_block_size_4 key_block_size=4 row_format=compressed;

insert into key_block_size_4 select * from big_table;
commit;

-- Check how much space is needed for a compressed table
-- with particular compression settings.
\! ls -l data/test/key_block_size_4.ibd
</pre><p>
        This experiment produced the following numbers, which of course
        could vary considerably depending on your table structure and
        data:
      </p><pre class="programlisting">
-rw-rw----  1 cirrus  staff  310378496 Jan  9 13:44 data/test/big_table.ibd
-rw-rw----  1 cirrus  staff  83886080 Jan  9 15:10 data/test/key_block_size_4.ibd
</pre><p>
        To see whether compression is efficient for your particular
        <a class="link" href="glossary.html#glos_workload" title="workload">workload</a>:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            For simple tests, use a MySQL instance with no other
            compressed tables and run queries against the
            <a class="link" href="information-schema.html#innodb-cmp-table" title="21.31.1 The INFORMATION_SCHEMA INNODB_CMP and INNODB_CMP_RESET Tables"><code class="literal">INFORMATION_SCHEMA.INNODB_CMP</code></a>
            table.
          </p></li><li class="listitem"><p>
            For more elaborate tests involving workloads with multiple
            compressed tables, run queries against the
            <a class="link" href="information-schema.html#innodb-cmp-per-index-table" title="21.31.2 The INFORMATION_SCHEMA INNODB_CMP_PER_INDEX and INNODB_CMP_PER_INDEX_RESET Tables"><code class="literal">INFORMATION_SCHEMA.INNODB_CMP_PER_INDEX</code></a>
            table. Because the statistics in the
            <code class="literal">INNODB_CMP_PER_INDEX</code> table are expensive
            to collect, you must enable the configuration option
            <a class="link" href="innodb-storage-engine.html#sysvar_innodb_cmp_per_index_enabled"><code class="literal">innodb_cmp_per_index_enabled</code></a>
            before querying that table, and you might restrict such
            testing to a development server or a non-critical
            <a class="link" href="glossary.html#glos_slave_server" title="slave server">slave server</a>.
          </p></li><li class="listitem"><p>
            Run some typical SQL statements against the compressed table
            you are testing.
          </p></li><li class="listitem"><p>
            Examine the ratio of successful compression operations to
            overall compression operations by querying the
            <a class="link" href="information-schema.html#innodb-cmp-table" title="21.31.1 The INFORMATION_SCHEMA INNODB_CMP and INNODB_CMP_RESET Tables"><code class="literal">INFORMATION_SCHEMA.INNODB_CMP</code></a>
            or
            <a class="link" href="information-schema.html#innodb-cmp-per-index-table" title="21.31.2 The INFORMATION_SCHEMA INNODB_CMP_PER_INDEX and INNODB_CMP_PER_INDEX_RESET Tables"><code class="literal">INFORMATION_SCHEMA.INNODB_CMP_PER_INDEX</code></a>
            table, and comparing <code class="literal">COMPRESS_OPS</code> to
            <code class="literal">COMPRESS_OPS_OK</code>.
          </p></li><li class="listitem"><p>
            If a high percentage of compression operations complete
            successfully, the table might be a good candidate for
            compression.
          </p></li><li class="listitem"><p>
            If you get a high proportion of
            <a class="link" href="glossary.html#glos_compression_failure" title="compression failure">compression
            failures</a>, you can adjust
            <a class="link" href="innodb-storage-engine.html#sysvar_innodb_compression_level"><code class="literal">innodb_compression_level</code></a>,
            <a class="link" href="innodb-storage-engine.html#sysvar_innodb_compression_failure_threshold_pct"><code class="literal">innodb_compression_failure_threshold_pct</code></a>,
            and
            <a class="link" href="innodb-storage-engine.html#sysvar_innodb_compression_pad_pct_max"><code class="literal">innodb_compression_pad_pct_max</code></a>
            options as described in
            <a class="xref" href="innodb-storage-engine.html#innodb-performance-compression-oltp" title="14.6.1.6 Compression for OLTP Workloads">Section 14.6.1.6, “Compression for OLTP Workloads”</a>, and
            try further tests.
</p></li></ul>
</div>
<h5><a name="innodb-compression-application"></a>Database Compression versus Application Compression</h5>
<a class="indexterm" name="idm140644112269488"></a><p>
        Decide whether to compress data in your application or in the
        table; do not use both types of compression for the same data.
        When you compress the data in the application and store the
        results in a compressed table, extra space savings are extremely
        unlikely, and the double compression just wastes CPU cycles.
</p>
<h5><a name="innodb-compression-in-database"></a>Compressing in the Database</h5>
<p>
        When enabled, MySQL table compression is automatic and applies
        to all columns and index values. The columns can still be tested
        with operators such as <code class="literal">LIKE</code>, and sort
        operations can still use indexes even when the index values are
        compressed. Because indexes are often a significant fraction of
        the total size of a database, compression could result in
        significant savings in storage, I/O or processor time. The
        compression and decompression operations happen on the database
        server, which likely is a powerful system that is sized to
        handle the expected load.
</p>
<h5><a name="innodb-compression-in-application"></a>Compressing in the Application</h5>
<p>
        If you compress data such as text in your application, before it
        is inserted into the database, You might save overhead for data
        that does not compress well by compressing some columns and not
        others. This approach uses CPU cycles for compression and
        uncompression on the client machine rather than the database
        server, which might be appropriate for a distributed application
        with many clients, or where the client machine has spare CPU
        cycles.
</p>
<h5><a name="innodb-compression-hybrid"></a>Hybrid Approach</h5>
<p>
        Of course, it is possible to combine these approaches. For some
        applications, it may be appropriate to use some compressed
        tables and some uncompressed tables. It may be best to
        externally compress some data (and store it in uncompressed
        tables) and allow MySQL to compress (some of) the other tables
        in the application. As always, up-front design and real-life
        testing are valuable in reaching the right decision.
</p>
<h5><a name="innodb-compression-tuning-when-workload"></a>Workload Characteristics and Compression</h5>
<a class="indexterm" name="idm140644112258464"></a><p>
        In addition to choosing which tables to compress (and the page
        size), the workload is another key determinant of performance.
        If the application is dominated by reads, rather than updates,
        fewer pages need to be reorganized and recompressed after the
        index page runs out of room for the per-page <span class="quote">“<span class="quote">modification
        log</span>”</span> that MySQL maintains for compressed data. If the
        updates predominantly change non-indexed columns or those
        containing <code class="literal">BLOB</code>s or large strings that happen
        to be stored <span class="quote">“<span class="quote">off-page</span>”</span>, the overhead of
        compression may be acceptable. If the only changes to a table
        are <code class="literal">INSERT</code>s that use a monotonically
        increasing primary key, and there are few secondary indexes,
        there is little need to reorganize and recompress index pages.
        Since MySQL can <span class="quote">“<span class="quote">delete-mark</span>”</span> and delete rows on
        compressed pages <span class="quote">“<span class="quote">in place</span>”</span> by modifying
        uncompressed data, <code class="literal">DELETE</code> operations on a
        table are relatively efficient.
      </p><p>
        For some environments, the time it takes to load data can be as
        important as run-time retrieval. Especially in data warehouse
        environments, many tables may be read-only or read-mostly. In
        those cases, it might or might not be acceptable to pay the
        price of compression in terms of increased load time, unless the
        resulting savings in fewer disk reads or in storage cost is
        significant.
      </p><p>
        Fundamentally, compression works best when the CPU time is
        available for compressing and uncompressing data. Thus, if your
        workload is I/O bound, rather than CPU-bound, you might find
        that compression can improve overall performance. When you test
        your application performance with different compression
        configurations, test on a platform similar to the planned
        configuration of the production system.
</p>
<h5><a name="innodb-compression-tuning-when-config"></a>Configuration Characteristics and Compression</h5>
<a class="indexterm" name="idm140644112248880"></a><p>
        Reading and writing database
        <a class="link" href="glossary.html#glos_page" title="page">pages</a> from and to disk is the
        slowest aspect of system performance. Compression attempts to
        reduce I/O by using CPU time to compress and uncompress data,
        and is most effective when I/O is a relatively scarce resource
        compared to processor cycles.
      </p><p>
        This is often especially the case when running in a multi-user
        environment with fast, multi-core CPUs. When a page of a
        compressed table is in memory, MySQL often uses additional
        memory, typically 16KB, in the
        <a class="link" href="glossary.html#glos_buffer_pool" title="buffer pool">buffer pool</a> for an
        uncompressed copy of the page. The adaptive LRU algorithm
        attempts to balance the use of memory between compressed and
        uncompressed pages to take into account whether the workload is
        running in an I/O-bound or CPU-bound manner. Still, a
        configuration with more memory dedicated to the buffer pool
        tends to run better when using compressed tables than a
        configuration where memory is highly constrained.
</p>
<h5><a name="innodb-compression-tuning-when-size"></a>Choosing the Compressed Page Size</h5>
<a class="indexterm" name="idm140644112242752"></a><a class="indexterm" name="idm140644112241264"></a><a class="indexterm" name="idm140644112239776"></a><a class="indexterm" name="idm140644112238288"></a><p>
        The optimal setting of the compressed page size depends on the
        type and distribution of data that the table and its indexes
        contain. The compressed page size should always be bigger than
        the maximum record size, or operations may fail as noted in
        <a class="xref" href="innodb-storage-engine.html#innodb-compression-internals-storage-btree" title="Compression of B-Tree Pages">Compression of B-Tree Pages</a>.
      </p><p>
        Setting the compressed page size too large wastes some space,
        but the pages do not have to be compressed as often. If the
        compressed page size is set too small, inserts or updates may
        require time-consuming recompression, and the
        <a class="link" href="glossary.html#glos_b_tree" title="B-tree">B-tree</a> nodes may have to be
        split more frequently, leading to bigger data files and less
        efficient indexing.
      </p><p>
        Typically, you set the compressed page size to 8K or 4K bytes.
        Given that the maximum row size for an InnoDB table is around
        8K, <code class="literal">KEY_BLOCK_SIZE=8</code> is usually a safe
        choice.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="innodb-compression-tuning-monitoring"></a>14.6.1.4 Monitoring Compression at Runtime</h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140644112231408"></a><p>
        Overall application performance, CPU and I/O utilization and the
        size of disk files are good indicators of how effective
        compression is for your application. This section builds on the
        performance tuning advice from
        <a class="xref" href="innodb-storage-engine.html#innodb-compression-tuning" title="14.6.1.3 Tuning Compression for InnoDB Tables">Section 14.6.1.3, “Tuning Compression for InnoDB Tables”</a>, and shows how to
        find problems that might not turn up during initial testing.
      </p><p>
        To dig deeper into performance considerations for compressed
        tables, you can monitor compression performance at runtime using
        the <a class="link" href="glossary.html#glos_information_schema" title="INFORMATION_SCHEMA">Information
        Schema</a> tables described in
        <a class="xref" href="innodb-storage-engine.html#innodb-information-schema-examples-compression" title="Example 14.10 Using the Compression Information Schema Tables">Example 14.10, “Using the Compression Information Schema Tables”</a>.
        These tables reflect the internal use of memory and the rates of
        compression used overall.
      </p><p>
        The <a class="link" href="information-schema.html#innodb-cmp-table" title="21.31.1 The INFORMATION_SCHEMA INNODB_CMP and INNODB_CMP_RESET Tables"><code class="literal">INNODB_CMP</code></a> table reports
        information about compression activity for each compressed page
        size (<code class="literal">KEY_BLOCK_SIZE</code>) in use. The information
        in these tables is system-wide: it summarizes the compression
        statistics across all compressed tables in your database. You
        can use this data to help decide whether or not to compress a
        table by examining these tables when no other compressed tables
        are being accessed. It involves relatively low overhead on the
        server, so you might query it periodically on a production
        server to check the overall efficiency of the compression
        feature.
      </p><p>
        The <a class="link" href="information-schema.html#innodb-cmp-per-index-table" title="21.31.2 The INFORMATION_SCHEMA INNODB_CMP_PER_INDEX and INNODB_CMP_PER_INDEX_RESET Tables"><code class="literal">INNODB_CMP_PER_INDEX</code></a> table
        reports information about compression activity for individual
        tables and indexes. This information is more targeted and more
        useful for evaluating compression efficiency and diagnosing
        performance issues one table or index at a time. (Because that
        each <code class="literal">InnoDB</code> table is represented as a
        clustered index, MySQL does not make a big distinction between
        tables and indexes in this context.) The
        <a class="link" href="information-schema.html#innodb-cmp-per-index-table" title="21.31.2 The INFORMATION_SCHEMA INNODB_CMP_PER_INDEX and INNODB_CMP_PER_INDEX_RESET Tables"><code class="literal">INNODB_CMP_PER_INDEX</code></a> table does
        involve substantial overhead, so it is more suitable for
        development servers, where you can compare the effects of
        different <a class="link" href="glossary.html#glos_workload" title="workload">workloads</a>, data,
        and compression settings in isolation. To guard against imposing
        this monitoring overhead by accident, you must enable the
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_cmp_per_index_enabled"><code class="literal">innodb_cmp_per_index_enabled</code></a>
        configuration option before you can query the
        <a class="link" href="information-schema.html#innodb-cmp-per-index-table" title="21.31.2 The INFORMATION_SCHEMA INNODB_CMP_PER_INDEX and INNODB_CMP_PER_INDEX_RESET Tables"><code class="literal">INNODB_CMP_PER_INDEX</code></a> table.
      </p><p>
        The key statistics to consider are the number of, and amount of
        time spent performing, compression and uncompression operations.
        Since MySQL splits <a class="link" href="glossary.html#glos_b_tree" title="B-tree">B-tree</a>
        nodes when they are too full to contain the compressed data
        following a modification, compare the number of
        <span class="quote">“<span class="quote">successful</span>”</span> compression operations with the number
        of such operations overall. Based on the information in the
        <a class="link" href="information-schema.html#innodb-cmp-table" title="21.31.1 The INFORMATION_SCHEMA INNODB_CMP and INNODB_CMP_RESET Tables"><code class="literal">INNODB_CMP</code></a> and
        <a class="link" href="information-schema.html#innodb-cmp-per-index-table" title="21.31.2 The INFORMATION_SCHEMA INNODB_CMP_PER_INDEX and INNODB_CMP_PER_INDEX_RESET Tables"><code class="literal">INNODB_CMP_PER_INDEX</code></a> tables and
        overall application performance and hardware resource
        utilization, you might make changes in your hardware
        configuration, adjust the size of the buffer pool, choose a
        different page size, or select a different set of tables to
        compress.
      </p><p>
        If the amount of CPU time required for compressing and
        uncompressing is high, changing to faster or multi-core CPUs can
        help improve performance with the same data, application
        workload and set of compressed tables. Increasing the size of
        the buffer pool might also help performance, so that more
        uncompressed pages can stay in memory, reducing the need to
        uncompress pages that exist in memory only in compressed form.
      </p><p>
        A large number of compression operations overall (compared to
        the number of <code class="literal">INSERT</code>,
        <code class="literal">UPDATE</code> and <code class="literal">DELETE</code>
        operations in your application and the size of the database)
        could indicate that some of your compressed tables are being
        updated too heavily for effective compression. If so, choose a
        larger page size, or be more selective about which tables you
        compress.
      </p><p>
        If the number of <span class="quote">“<span class="quote">successful</span>”</span> compression
        operations (<code class="literal">COMPRESS_OPS_OK</code>) is a high
        percentage of the total number of compression operations
        (<code class="literal">COMPRESS_OPS</code>), then the system is likely
        performing well. If the ratio is low, then MySQL is
        reorganizing, recompressing, and splitting B-tree nodes more
        often than is desirable. In this case, avoid compressing some
        tables, or increase <code class="literal">KEY_BLOCK_SIZE</code> for some
        of the compressed tables. You might turn off compression for
        tables that cause the number of <span class="quote">“<span class="quote">compression
        failures</span>”</span> in your application to be more than 1% or 2% of
        the total. (Such a failure ratio might be acceptable during a
        temporary operation such as a data load).
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="innodb-compression-internals"></a>14.6.1.5 How Compression Works for InnoDB Tables</h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140644112201328"></a><p>
        This section describes some internal implementation details
        about <a class="link" href="glossary.html#glos_compression" title="compression">compression</a> for
        InnoDB tables. The information presented here may be helpful in
        tuning for performance, but is not necessary to know for basic
        use of compression.
</p>
<h5><a name="innodb-compression-internals-algorithms"></a>Compression Algorithms</h5>
<a class="indexterm" name="idm140644112197120"></a><p>
        Some operating systems implement compression at the file system
        level. Files are typically divided into fixed-size blocks that
        are compressed into variable-size blocks, which easily leads
        into fragmentation. Every time something inside a block is
        modified, the whole block is recompressed before it is written
        to disk. These properties make this compression technique
        unsuitable for use in an update-intensive database system.
      </p><p>
        MySQL implements compression with the help of the well-known
        <a class="ulink" href="http://www.zlib.net/" target="_top">zlib library</a>, which
        implements the LZ77 compression algorithm. This compression
        algorithm is mature, robust, and efficient in both CPU
        utilization and in reduction of data size. The algorithm is
        <span class="quote">“<span class="quote">lossless</span>”</span>, so that the original uncompressed data
        can always be reconstructed from the compressed form. LZ77
        compression works by finding sequences of data that are repeated
        within the data to be compressed. The patterns of values in your
        data determine how well it compresses, but typical user data
        often compresses by 50% or more.
      </p><p>
        Unlike compression performed by an application, or compression
        features of some other database management systems, InnoDB
        compression applies both to user data and to indexes. In many
        cases, indexes can constitute 40-50% or more of the total
        database size, so this difference is significant. When
        compression is working well for a data set, the size of the
        InnoDB data files (the
        <a class="link" href="glossary.html#glos_file_per_table" title="file-per-table">file-per-table</a>
        tablespace or <a class="link" href="glossary.html#glos_general_tablespace" title="general tablespace">general
        tablespace</a> <code class="literal">.idb</code> files) is 25% to 50%
        of the uncompressed size or possibly smaller. Depending on the
        <a class="link" href="glossary.html#glos_workload" title="workload">workload</a>, this smaller
        database can in turn lead to a reduction in I/O, and an increase
        in throughput, at a modest cost in terms of increased CPU
        utilization. You can adjust the balance between compression
        level and CPU overhead by modifying the
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_compression_level"><code class="literal">innodb_compression_level</code></a>
        configuration option.
</p>
<h5><a name="innodb-compression-internals-storage"></a>InnoDB Data Storage and Compression</h5>
<a class="indexterm" name="idm140644112185728"></a><p>
        All user data in InnoDB tables is stored in pages comprising a
        <a class="link" href="glossary.html#glos_b_tree" title="B-tree">B-tree</a> index (the
        <a class="link" href="glossary.html#glos_clustered_index" title="clustered index">clustered index</a>). In
        some other database systems, this type of index is called an
        <span class="quote">“<span class="quote">index-organized table</span>”</span>. Each row in the index node
        contains the values of the (user-specified or system-generated)
        <a class="link" href="glossary.html#glos_primary_key" title="primary key">primary key</a> and all the
        other columns of the table.
      </p><p>
        <a class="link" href="glossary.html#glos_secondary_index" title="secondary index">Secondary indexes</a> in
        InnoDB tables are also B-trees, containing pairs of values: the
        index key and a pointer to a row in the clustered index. The
        pointer is in fact the value of the primary key of the table,
        which is used to access the clustered index if columns other
        than the index key and primary key are required. Secondary index
        records must always fit on a single B-tree page.
      </p><p>
        The compression of B-tree nodes (of both clustered and secondary
        indexes) is handled differently from compression of
        <a class="link" href="glossary.html#glos_overflow_page" title="overflow page">overflow pages</a> used to
        store long <code class="literal">VARCHAR</code>, <code class="literal">BLOB</code>,
        or <code class="literal">TEXT</code> columns, as explained in the
        following sections.
</p>
<h5><a name="innodb-compression-internals-storage-btree"></a>Compression of B-Tree Pages</h5>
<a class="indexterm" name="idm140644112174224"></a><p>
        Because they are frequently updated, B-tree pages require
        special treatment. It is important to minimize the number of
        times B-tree nodes are split, as well as to minimize the need to
        uncompress and recompress their content.
      </p><p>
        One technique MySQL uses is to maintain some system information
        in the B-tree node in uncompressed form, thus facilitating
        certain in-place updates. For example, this allows rows to be
        delete-marked and deleted without any compression operation.
      </p><p>
        In addition, MySQL attempts to avoid unnecessary uncompression
        and recompression of index pages when they are changed. Within
        each B-tree page, the system keeps an uncompressed
        <span class="quote">“<span class="quote">modification log</span>”</span> to record changes made to the
        page. Updates and inserts of small records may be written to
        this modification log without requiring the entire page to be
        completely reconstructed.
      </p><p>
        When the space for the modification log runs out, InnoDB
        uncompresses the page, applies the changes and recompresses the
        page. If recompression fails (a situation known as a
        <a class="link" href="glossary.html#glos_compression_failure" title="compression failure">compression
        failure</a>), the B-tree nodes are split and the process is
        repeated until the update or insert succeeds.
      </p><p>
        To avoid frequent compression failures in write-intensive
        workloads, such as for <a class="link" href="glossary.html#glos_oltp" title="OLTP">OLTP</a>
        applications, MySQL sometimes reserves some empty space
        (padding) in the page, so that the modification log fills up
        sooner and the page is recompressed while there is still enough
        room to avoid splitting it. The amount of padding space left in
        each page varies as the system keeps track of the frequency of
        page splits. On a busy server doing frequent writes to
        compressed tables, you can adjust the
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_compression_failure_threshold_pct"><code class="literal">innodb_compression_failure_threshold_pct</code></a>,
        and
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_compression_pad_pct_max"><code class="literal">innodb_compression_pad_pct_max</code></a>
        configuration options to fine-tune this mechanism.
      </p><p>
        Generally, MySQL requires that each B-tree page in an InnoDB
        table can accommodate at least two records. For compressed
        tables, this requirement has been relaxed. Leaf pages of B-tree
        nodes (whether of the primary key or secondary indexes) only
        need to accommodate one record, but that record must fit, in
        uncompressed form, in the per-page modification log. If
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_strict_mode"><code class="literal">innodb_strict_mode</code></a> is
        <code class="literal">ON</code>, MySQL checks the maximum row size during
        <a class="link" href="sql-syntax.html#create-table" title="13.1.18 CREATE TABLE Syntax"><code class="literal">CREATE TABLE</code></a> or
        <a class="link" href="sql-syntax.html#create-index" title="13.1.14 CREATE INDEX Syntax"><code class="literal">CREATE INDEX</code></a>. If the row does not
        fit, the following error message is issued: <code class="literal">ERROR
        HY000: Too big row</code>.
      </p><p>
        If you create a table when
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_strict_mode"><code class="literal">innodb_strict_mode</code></a> is OFF, and
        a subsequent <code class="literal">INSERT</code> or
        <code class="literal">UPDATE</code> statement attempts to create an index
        entry that does not fit in the size of the compressed page, the
        operation fails with <code class="literal">ERROR 42000: Row size too
        large</code>. (This error message does not name the index for
        which the record is too large, or mention the length of the
        index record or the maximum record size on that particular index
        page.) To solve this problem, rebuild the table with
        <a class="link" href="sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a> and select a larger
        compressed page size (<code class="literal">KEY_BLOCK_SIZE</code>),
        shorten any column prefix indexes, or disable compression
        entirely with <code class="literal">ROW_FORMAT=DYNAMIC</code> or
        <code class="literal">ROW_FORMAT=COMPACT</code>.
      </p><p>
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_strict_mode"><code class="literal">innodb_strict_mode</code></a> is not
        applicable to general tablespaces, which also support compressed
        tables. Tablespace management rules for general tablespaces are
        strictly enforced independently of
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_strict_mode"><code class="literal">innodb_strict_mode</code></a>. For more
        information, see <a class="xref" href="sql-syntax.html#create-tablespace" title="13.1.19 CREATE TABLESPACE Syntax">Section 13.1.19, “CREATE TABLESPACE Syntax”</a>.
</p>
<h5><a name="innodb-compression-internals-storage-blobs"></a>Compressing BLOB, VARCHAR, and TEXT Columns</h5>
<a class="indexterm" name="idm140644112145248"></a><a class="indexterm" name="idm140644112143760"></a><a class="indexterm" name="idm140644112142272"></a><a class="indexterm" name="idm140644112140784"></a><p>
        In an InnoDB table, <a class="link" href="data-types.html#blob" title="11.4.3 The BLOB and TEXT Types"><code class="literal">BLOB</code></a>,
        <a class="link" href="data-types.html#char" title="11.4.1 The CHAR and VARCHAR Types"><code class="literal">VARCHAR</code></a>, and
        <a class="link" href="data-types.html#blob" title="11.4.3 The BLOB and TEXT Types"><code class="literal">TEXT</code></a> columns that are not part of
        the primary key may be stored on separately allocated
        <a class="link" href="glossary.html#glos_overflow_page" title="overflow page">overflow pages</a>. We
        refer to these columns as
        <a class="link" href="glossary.html#glos_off_page_column" title="off-page column">off-page columns</a>.
        Their values are stored on singly-linked lists of overflow
        pages.
      </p><p>
        For tables created in <code class="literal">ROW_FORMAT=DYNAMIC</code> or
        <code class="literal">ROW_FORMAT=COMPRESSED</code>, the values of
        <a class="link" href="data-types.html#blob" title="11.4.3 The BLOB and TEXT Types"><code class="literal">BLOB</code></a>,
        <a class="link" href="data-types.html#blob" title="11.4.3 The BLOB and TEXT Types"><code class="literal">TEXT</code></a>, or
        <a class="link" href="data-types.html#char" title="11.4.1 The CHAR and VARCHAR Types"><code class="literal">VARCHAR</code></a> columns may be stored
        fully off-page, depending on their length and the length of the
        entire row. For columns that are stored off-page, the clustered
        index record only contains 20-byte pointers to the overflow
        pages, one per column. Whether any columns are stored off-page
        depends on the page size and the total size of the row. When the
        row is too long to fit entirely within the page of the clustered
        index, MySQL chooses the longest columns for off-page storage
        until the row fits on the clustered index page. As noted above,
        if a row does not fit by itself on a compressed page, an error
        occurs.
</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
          For tables created in <code class="literal">ROW_FORMAT=DYNAMIC</code> or
          <code class="literal">ROW_FORMAT=COMPRESSED</code>,
          <a class="link" href="data-types.html#blob" title="11.4.3 The BLOB and TEXT Types"><code class="literal">TEXT</code></a> and
          <a class="link" href="data-types.html#blob" title="11.4.3 The BLOB and TEXT Types"><code class="literal">BLOB</code></a> columns that are less than
          or equal to 40 bytes are always stored in-line.
</p>
</div>
<p>
        Tables created in older versions of MySQL use the
        <a class="link" href="glossary.html#glos_antelope" title="Antelope">Antelope</a> file format, which
        supports only <code class="literal">ROW_FORMAT=REDUNDANT</code> and
        <code class="literal">ROW_FORMAT=COMPACT</code>. In these formats, MySQL
        stores the first 768 bytes of
        <a class="link" href="data-types.html#blob" title="11.4.3 The BLOB and TEXT Types"><code class="literal">BLOB</code></a>,
        <a class="link" href="data-types.html#char" title="11.4.1 The CHAR and VARCHAR Types"><code class="literal">VARCHAR</code></a>, and
        <a class="link" href="data-types.html#blob" title="11.4.3 The BLOB and TEXT Types"><code class="literal">TEXT</code></a> columns in the clustered
        index record along with the primary key. The 768-byte prefix is
        followed by a 20-byte pointer to the overflow pages that contain
        the rest of the column value.
      </p><p>
        When a table is in <code class="literal">COMPRESSED</code> format, all
        data written to overflow pages is compressed <span class="quote">“<span class="quote">as
        is</span>”</span>; that is, MySQL applies the zlib compression
        algorithm to the entire data item. Other than the data,
        compressed overflow pages contain an uncompressed header and
        trailer comprising a page checksum and a link to the next
        overflow page, among other things. Therefore, very significant
        storage savings can be obtained for longer
        <code class="literal">BLOB</code>, <code class="literal">TEXT</code>, or
        <code class="literal">VARCHAR</code> columns if the data is highly
        compressible, as is often the case with text data. Image data,
        such as <code class="literal">JPEG</code>, is typically already compressed
        and so does not benefit much from being stored in a compressed
        table; the double compression can waste CPU cycles for little or
        no space savings.
      </p><p>
        The overflow pages are of the same size as other pages. A row
        containing ten columns stored off-page occupies ten overflow
        pages, even if the total length of the columns is only 8K bytes.
        In an uncompressed table, ten uncompressed overflow pages occupy
        160K bytes. In a compressed table with an 8K page size, they
        occupy only 80K bytes. Thus, it is often more efficient to use
        compressed table format for tables with long column values.
      </p><p>
        For <a class="link" href="glossary.html#glos_file_per_table" title="file-per-table">file-per-table</a>
        tablespaces, using a 16K compressed page size can reduce storage
        and I/O costs for <a class="link" href="data-types.html#blob" title="11.4.3 The BLOB and TEXT Types"><code class="literal">BLOB</code></a>,
        <a class="link" href="data-types.html#char" title="11.4.1 The CHAR and VARCHAR Types"><code class="literal">VARCHAR</code></a>, or
        <a class="link" href="data-types.html#blob" title="11.4.3 The BLOB and TEXT Types"><code class="literal">TEXT</code></a> columns, because such data
        often compress well, and might therefore require fewer overflow
        pages, even though the B-tree nodes themselves take as many
        pages as in the uncompressed form. General tablespaces do not
        support a 16K compressed page size
        (<code class="literal">KEY_BLOCK_SIZE</code>). For more information, see
        <a class="xref" href="innodb-storage-engine.html#general-tablespaces" title="14.4.9 InnoDB General Tablespaces">Section 14.4.9, “InnoDB General Tablespaces”</a>.
</p>
<h5><a name="innodb-compression-internals-pool"></a>Compression and the InnoDB Buffer Pool</h5>
<a class="indexterm" name="idm140644112101392"></a><a class="indexterm" name="idm140644112099888"></a><p>
        In a compressed <code class="literal">InnoDB</code> table, every
        compressed page (whether 1K, 2K, 4K or 8K) corresponds to an
        uncompressed page of 16K bytes (or a smaller size if
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_page_size"><code class="literal">innodb_page_size</code></a> is set). To
        access the data in a page, MySQL reads the compressed page from
        disk if it is not already in the
        <a class="link" href="glossary.html#glos_buffer_pool" title="buffer pool">buffer pool</a>, then
        uncompresses the page to its original form. This section
        describes how <code class="literal">InnoDB</code> manages the buffer pool
        with respect to pages of compressed tables.
      </p><p>
        To minimize I/O and to reduce the need to uncompress a page, at
        times the buffer pool contains both the compressed and
        uncompressed form of a database page. To make room for other
        required database pages, MySQL can
        <a class="link" href="glossary.html#glos_eviction" title="eviction">evict</a> from the buffer pool
        an uncompressed page, while leaving the compressed page in
        memory. Or, if a page has not been accessed in a while, the
        compressed form of the page might be written to disk, to free
        space for other data. Thus, at any given time, the buffer pool
        might contain both the compressed and uncompressed forms of the
        page, or only the compressed form of the page, or neither.
      </p><p>
        MySQL keeps track of which pages to keep in memory and which to
        evict using a least-recently-used
        (<a class="link" href="glossary.html#glos_lru" title="LRU">LRU</a>) list, so that
        <a class="link" href="glossary.html#glos_hot" title="hot">hot</a> (frequently accessed) data
        tends to stay in memory. When compressed tables are accessed,
        MySQL uses an adaptive LRU algorithm to achieve an appropriate
        balance of compressed and uncompressed pages in memory. This
        adaptive algorithm is sensitive to whether the system is running
        in an <a class="link" href="glossary.html#glos_io_bound" title="I/O-bound">I/O-bound</a> or
        <a class="link" href="glossary.html#glos_cpu_bound" title="CPU-bound">CPU-bound</a> manner. The goal
        is to avoid spending too much processing time uncompressing
        pages when the CPU is busy, and to avoid doing excess I/O when
        the CPU has spare cycles that can be used for uncompressing
        compressed pages (that may already be in memory). When the
        system is I/O-bound, the algorithm prefers to evict the
        uncompressed copy of a page rather than both copies, to make
        more room for other disk pages to become memory resident. When
        the system is CPU-bound, MySQL prefers to evict both the
        compressed and uncompressed page, so that more memory can be
        used for <span class="quote">“<span class="quote">hot</span>”</span> pages and reducing the need to
        uncompress data in memory only in compressed form.
</p>
<h5><a name="innodb-compression-internals-log"></a>Compression and the InnoDB Redo Log Files</h5>
<a class="indexterm" name="idm140644112085120"></a><p>
        Before a compressed page is written to a
        <a class="link" href="glossary.html#glos_data_files" title="data files">data file</a>, MySQL writes a
        copy of the page to the redo log (if it has been recompressed
        since the last time it was written to the database). This is
        done to ensure that redo logs are usable for
        <a class="link" href="glossary.html#glos_crash_recovery" title="crash recovery">crash recovery</a>, even
        in the unlikely case that the <code class="literal">zlib</code> library is
        upgraded and that change introduces a compatibility problem with
        the compressed data. Therefore, some increase in the size of
        <a class="link" href="glossary.html#glos_log_file" title="log file">log files</a>, or a need for
        more frequent
        <a class="link" href="glossary.html#glos_checkpoint" title="checkpoint">checkpoints</a>, can be
        expected when using compression. The amount of increase in the
        log file size or checkpoint frequency depends on the number of
        times compressed pages are modified in a way that requires
        reorganization and recompression.
      </p><p>
        Compressed tables require the
        <a class="link" href="glossary.html#glos_barracuda" title="Barracuda">Barracuda</a> file format. To
        create a compressed table in a file-per-table tablespace,
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_per_table"><code class="literal">innodb_file_per_table</code></a> must be
        enabled and <a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_format"><code class="literal">innodb_file_format</code></a>
        must be set to <a class="link" href="glossary.html#glos_barracuda" title="Barracuda">Barracuda</a>.
        There is no dependence on the
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_format"><code class="literal">innodb_file_format</code></a> setting when
        creating a compressed table in a general tablespace. For more
        information, see <a class="xref" href="innodb-storage-engine.html#general-tablespaces" title="14.4.9 InnoDB General Tablespaces">Section 14.4.9, “InnoDB General Tablespaces”</a>. The
        <a class="link" href="glossary.html#glos_mysql_enterprise_backup" title="MySQL Enterprise Backup">MySQL Enterprise
        Backup</a> product supports the
        <a class="link" href="glossary.html#glos_barracuda" title="Barracuda">Barracuda</a> file format.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="innodb-performance-compression-oltp"></a>14.6.1.6 Compression for OLTP Workloads</h4>

</div>

</div>

</div>
<p>
        Traditionally, the <code class="literal">InnoDB</code>
        <a class="link" href="glossary.html#glos_compression" title="compression">compression</a> feature was
        recommended primarily for read-only or read-mostly
        <a class="link" href="glossary.html#glos_workload" title="workload">workloads</a>, such as in a
        <a class="link" href="glossary.html#glos_data_warehouse" title="data warehouse">data warehouse</a>
        configuration. The rise of <a class="link" href="glossary.html#glos_ssd" title="SSD">SSD</a>
        storage devices, which are fast but relatively small and
        expensive, makes compression attractive also for
        <code class="literal">OLTP</code> workloads: high-traffic, interactive web
        sites can reduce their storage requirements and their I/O
        operations per second (<a class="link" href="glossary.html#glos_iops" title="IOPS">IOPS</a>) by
        using compressed tables with applications that do frequent
        <a class="link" href="sql-syntax.html#insert" title="13.2.5 INSERT Syntax"><code class="literal">INSERT</code></a>,
        <a class="link" href="sql-syntax.html#update" title="13.2.11 UPDATE Syntax"><code class="literal">UPDATE</code></a>, and
        <a class="link" href="sql-syntax.html#delete" title="13.2.2 DELETE Syntax"><code class="literal">DELETE</code></a> operations.
      </p><p>
        Configuration options introduced in MySQL 5.6 let you adjust the
        way compression works for a particular MySQL instance, with an
        emphasis on performance and scalability for write-intensive
        operations:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <a class="link" href="innodb-storage-engine.html#sysvar_innodb_compression_level"><code class="literal">innodb_compression_level</code></a>
            lets you turn the degree of compression up or down. A higher
            value lets you fit more data onto a storage device, at the
            expense of more CPU overhead during compression. A lower
            value lets you reduce CPU overhead when storage space is not
            critical, or you expect the data is not especially
            compressible.
          </p></li><li class="listitem"><p>
            <a class="link" href="innodb-storage-engine.html#sysvar_innodb_compression_failure_threshold_pct"><code class="literal">innodb_compression_failure_threshold_pct</code></a>
            specifies a cutoff point for
            <a class="link" href="glossary.html#glos_compression_failure" title="compression failure">compression
            failures</a> during updates to a compressed table. When
            this threshold is passed, MySQL begins to leave additional
            free space within each new compressed page, dynamically
            adjusting the amount of free space up to the percentage of
            page size specified by
            <a class="link" href="innodb-storage-engine.html#sysvar_innodb_compression_pad_pct_max"><code class="literal">innodb_compression_pad_pct_max</code></a>
          </p></li><li class="listitem"><p>
            <a class="link" href="innodb-storage-engine.html#sysvar_innodb_compression_pad_pct_max"><code class="literal">innodb_compression_pad_pct_max</code></a>
            lets you adjust the maximum amount of space reserved within
            each <a class="link" href="glossary.html#glos_page" title="page">page</a> to record changes
            to compressed rows, without needing to compress the entire
            page again. The higher the value, the more changes can be
            recorded without recompressing the page. MySQL uses a
            variable amount of free space for the pages within each
            compressed table, only when a designated percentage of
            compression operations
            <span class="quote">“<span class="quote"><a class="link" href="glossary.html#glos_compression_failure" title="compression failure">fail</a></span>”</span>
            at runtime, requiring an expensive operation to split the
            compressed page.
</p></li></ul>
</div>
<p>
        Because working with compressed data sometimes involves keeping
        both compressed and uncompressed versions of a page in memory at
        the same time, when using compression with an OLTP-style
        workload, be prepared to increase the value of the
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_size"><code class="literal">innodb_buffer_pool_size</code></a>
        configuration option.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="innodb-compression-syntax-warnings"></a>14.6.1.7 SQL Compression Syntax Warnings and Errors</h4>

</div>

</div>

</div>
<p>
        This section describes syntax warnings and errors that you may
        encounter when using the table compression feature with
        <a class="link" href="glossary.html#glos_file_per_table" title="file-per-table">file-per-table</a>
        tablespaces and <a class="link" href="glossary.html#glos_general_tablespace" title="general tablespace">general
        tablespaces</a>.
</p>
<h5><a name="idm140644112040528"></a>SQL Compression Syntax Warnings and Errors for File-Per-Table
Tablespaces</h5>
<p>
        When <a class="link" href="innodb-storage-engine.html#sysvar_innodb_strict_mode"><code class="literal">innodb_strict_mode</code></a> is
        enabled (the default as of MySQL 5.7.7), specifying
        <code class="literal">ROW_FORMAT=COMPRESSED</code> or
        <code class="literal">KEY_BLOCK_SIZE</code> in <a class="link" href="sql-syntax.html#create-table" title="13.1.18 CREATE TABLE Syntax"><code class="literal">CREATE
        TABLE</code></a> or <a class="link" href="sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a>
        statements produces the following error if
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_per_table"><code class="literal">innodb_file_per_table</code></a> is
        disabled or if
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_format"><code class="literal">innodb_file_format</code></a> is set to
        <code class="literal">Antelope</code> rather than
        <code class="literal">Barracuda</code>.
</p><pre class="programlisting">ERROR 1031 (HY000): Table storage engine for 't1' doesn't have this option</pre>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
          The table is not created if the current configuration does not
          permit using compressed tables.
</p>
</div>
<p>
        When <a class="link" href="innodb-storage-engine.html#sysvar_innodb_strict_mode"><code class="literal">innodb_strict_mode</code></a> is
        disabled, specifying <code class="literal">ROW_FORMAT=COMPRESSED</code> or
        <code class="literal">KEY_BLOCK_SIZE</code> in <a class="link" href="sql-syntax.html#create-table" title="13.1.18 CREATE TABLE Syntax"><code class="literal">CREATE
        TABLE</code></a> or <a class="link" href="sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a>
        statements produces the following warnings if
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_per_table"><code class="literal">innodb_file_per_table</code></a> is
        disabled.
      </p><pre class="programlisting">mysql&gt; SHOW WARNINGS;
+---------+------+---------------------------------------------------------------+
| Level   | Code | Message                                                       |
+---------+------+---------------------------------------------------------------+
| Warning | 1478 | InnoDB: KEY_BLOCK_SIZE requires innodb_file_per_table.        |
| Warning | 1478 | InnoDB: ignoring KEY_BLOCK_SIZE=4.                            |
| Warning | 1478 | InnoDB: ROW_FORMAT=COMPRESSED requires innodb_file_per_table. |
| Warning | 1478 | InnoDB: assuming ROW_FORMAT=DYNAMIC.                          |
+---------+------+---------------------------------------------------------------+</pre><p>
        Similar warnings are issued if
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_format"><code class="literal">innodb_file_format</code></a> is set to
        <code class="literal">Antelope</code> rather than
        <code class="literal">Barracuda</code>.
</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
          These messages are only warnings, not errors, and the table is
          created without compression, as if the options were not
          specified.
</p>
</div>
<p>
        The <span class="quote">“<span class="quote">non-strict</span>”</span> behavior lets you import a
        <code class="literal">mysqldump</code> file into a database that does not
        support compressed tables, even if the source database contained
        compressed tables. In that case, MySQL creates the table in
        <code class="literal">ROW_FORMAT=COMPACT</code> instead of preventing the
        operation.
      </p><p>
        To import the dump file into a new database, and have the tables
        re-created as they exist in the original database, ensure the
        server has the proper settings for the configuration parameters
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_format"><code class="literal">innodb_file_format</code></a> and
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_per_table"><code class="literal">innodb_file_per_table</code></a>.
      </p><p>
        The attribute <code class="literal">KEY_BLOCK_SIZE</code> is permitted
        only when <code class="literal">ROW_FORMAT</code> is specified as
        <code class="literal">COMPRESSED</code> or is omitted. Specifying a
        <code class="literal">KEY_BLOCK_SIZE</code> with any other
        <code class="literal">ROW_FORMAT</code> generates a warning that you can
        view with <code class="literal">SHOW WARNINGS</code>. However, the table
        is non-compressed; the specified
        <code class="literal">KEY_BLOCK_SIZE</code> is ignored).
</p>
<div class="informaltable">
<table summary=" Warning level, error code, and message text for
          messages that could be generated when using conflicting
          clauses for InnoDB table compression. " border="1"><colgroup><col><col><col></colgroup><thead><tr><th scope="col">Level</th><th scope="col">Code</th><th scope="col">Message</th></tr></thead><tbody><tr><td scope="row">Warning</td><td>1478</td><td><code class="literal"> InnoDB: ignoring KEY_BLOCK_SIZE=<em class="replaceable"><code>n</code></em>
unless ROW_FORMAT=COMPRESSED. </code></td></tr></tbody></table>
</div>
<p>
        If you are running with
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_strict_mode"><code class="literal">innodb_strict_mode</code></a> enabled, the
        combination of a <code class="literal">KEY_BLOCK_SIZE</code> with any
        <code class="literal">ROW_FORMAT</code> other than
        <code class="literal">COMPRESSED</code> generates an error, not a warning,
        and the table is not created.
      </p><p>
        <a class="xref" href="innodb-storage-engine.html#innodb-compression-create-and-alter-options-table" title="Table 14.5 ROW_FORMAT and KEY_BLOCK_SIZE Options">Table 14.5, “ROW_FORMAT and KEY_BLOCK_SIZE Options”</a>
        provides an overview the <code class="literal">ROW_FORMAT</code> and
        <code class="literal">KEY_BLOCK_SIZE</code> options that are used with
        <a class="link" href="sql-syntax.html#create-table" title="13.1.18 CREATE TABLE Syntax"><code class="literal">CREATE TABLE</code></a> or
        <a class="link" href="sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a>.
</p>
<div class="table">
<a name="innodb-compression-create-and-alter-options-table"></a><p class="title"><b>Table 14.5 ROW_FORMAT and KEY_BLOCK_SIZE Options</b></p>
<div class="table-contents">
<table summary="ROW_FORMAT and KEY_BLOCK_SIZE Options" border="1"><colgroup><col><col><col></colgroup><thead><tr><th scope="col">Option</th><th scope="col">Usage Notes</th><th scope="col">Description</th></tr></thead><tbody><tr><td scope="row"><code class="literal">ROW_FORMAT=​REDUNDANT</code></td><td>Storage format used prior to MySQL 5.0.3</td><td>Less efficient than <code class="literal">ROW_FORMAT=COMPACT</code>; for backward
                compatibility</td></tr><tr><td scope="row"><code class="literal">ROW_FORMAT=​COMPACT</code></td><td>Default storage format since MySQL 5.0.3</td><td>Stores a prefix of 768 bytes of long column values in the clustered
                index page, with the remaining bytes stored in an
                overflow page</td></tr><tr><td scope="row"><code class="literal">ROW_FORMAT=​DYNAMIC</code></td><td>File-per-table tablespaces require
                <code class="literal">innodb_file​_format=Barracuda</code></td><td>Store values within the clustered index page if they fit; if not, stores
                only a 20-byte pointer to an overflow page (no prefix)</td></tr><tr><td scope="row"><code class="literal">ROW_FORMAT=​COMPRESSED</code></td><td>File-per-table tablespaces require
                <code class="literal">innodb_file​_format=Barracuda</code></td><td>Compresses the table and indexes using zlib</td></tr><tr><td scope="row"><code class="literal">KEY_BLOCK_​SIZE=<em class="replaceable"><code>n</code></em></code></td><td>File-per-table tablespaces require
                <code class="literal">innodb_file​_format=Barracuda</code></td><td>Specifies compressed page size of 1, 2, 4, 8 or 16 kilobytes; implies
                <code class="literal">ROW_FORMAT=COMPRESSED</code>. For general
                tablespaces, a <code class="literal">KEY_BLOCK_SIZE</code> value
                equal to the <code class="literal">InnoDB</code> page size is not
permitted.</td></tr></tbody></table>
</div>

</div>
<br class="table-break"><p>
        <a class="xref" href="innodb-storage-engine.html#innodb-compression-create-and-alter-errors-table" title="Table 14.6 CREATE/ALTER TABLE Warnings and Errors when InnoDB Strict Mode is OFF">Table 14.6, “CREATE/ALTER TABLE Warnings and Errors when InnoDB Strict Mode is OFF”</a>
        summarizes error conditions that occur with certain combinations
        of configuration parameters and options on the
        <a class="link" href="sql-syntax.html#create-table" title="13.1.18 CREATE TABLE Syntax"><code class="literal">CREATE TABLE</code></a> or
        <a class="link" href="sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a> statements, and how
        the options appear in the output of <code class="literal">SHOW TABLE
        STATUS</code>.
      </p><p>
        When <a class="link" href="innodb-storage-engine.html#sysvar_innodb_strict_mode"><code class="literal">innodb_strict_mode</code></a> is
        <code class="literal">OFF</code>, MySQL creates or alters the table, but
        ignores certain settings as shown below. You can see the warning
        messages in the MySQL error log. When
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_strict_mode"><code class="literal">innodb_strict_mode</code></a> is
        <code class="literal">ON</code>, these specified combinations of options
        generate errors, and the table is not created or altered. To see
        the full description of the error condition, issue the
        <code class="literal">SHOW ERRORS</code> statement: example:

</p><pre class="screen">
mysql&gt; <strong class="userinput"><code>CREATE TABLE x (id INT PRIMARY KEY, c INT)
</code></strong>
-&gt; <strong class="userinput"><code>ENGINE=INNODB KEY_BLOCK_SIZE=33333;
</code></strong>
ERROR 1005 (HY000): Can't create table 'test.x' (errno: 1478)

mysql&gt; <strong class="userinput"><code>SHOW ERRORS;</code></strong>
+-------+------+-------------------------------------------+ 
| Level | Code | Message                                   | 
+-------+------+-------------------------------------------+ 
| Error | 1478 | InnoDB: invalid KEY_BLOCK_SIZE=33333.     | 
| Error | 1005 | Can't create table 'test.x' (errno: 1478) | 
+-------+------+-------------------------------------------+ 
</pre><p>
</p>
<div class="table">
<a name="innodb-compression-create-and-alter-errors-table"></a><p class="title"><b>Table 14.6 CREATE/ALTER TABLE Warnings and Errors when InnoDB Strict Mode is OFF</b></p>
<div class="table-contents">
<table summary="CREATE/ALTER TABLE Warnings and Errors when InnoDB Strict Mode is OFF" border="1"><colgroup><col><col><col></colgroup><thead><tr><th scope="col">Syntax</th><th scope="col">Warning or Error Condition</th><th scope="col">Resulting <code class="literal">ROW_FORMAT</code>, as shown in <code class="literal">SHOW TABLE
                STATUS</code></th></tr></thead><tbody><tr><td scope="row"><code class="literal">ROW_FORMAT=REDUNDANT</code></td><td>None</td><td><code class="literal">REDUNDANT</code></td></tr><tr><td scope="row"><code class="literal">ROW_FORMAT=COMPACT</code></td><td>None</td><td><code class="literal">COMPACT</code></td></tr><tr><td scope="row"><code class="literal">ROW_FORMAT=COMPRESSED</code> or
                <code class="literal">ROW_FORMAT=DYNAMIC</code> or
                <code class="literal">KEY_BLOCK_SIZE</code> is specified</td><td>Ignored for file-per-table tablespaces unless both
                <a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_format"><code class="literal">innodb_file_format</code></a><code class="literal">=Barracuda</code>
                and
                <a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_per_table"><code class="literal">innodb_file_per_table</code></a>
                are enabled. General tablespaces support all row formats
                (with some restrictions) regardless of
                <a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_format"><code class="literal">innodb_file_format</code></a> and
                <a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_per_table"><code class="literal">innodb_file_per_table</code></a>
                settings. See <a class="xref" href="innodb-storage-engine.html#general-tablespaces" title="14.4.9 InnoDB General Tablespaces">Section 14.4.9, “InnoDB General Tablespaces”</a>.</td><td><code class="literal">the default row format for file-per-table tablespaces; the
                specified row format for general tablespaces</code></td></tr><tr><td scope="row">Invalid <code class="literal">KEY_BLOCK_SIZE</code> is specified (not 1, 2, 4, 8
                or 16)</td><td><code class="literal">KEY_BLOCK_SIZE</code> is ignored</td><td>the specified row format, or the default row format</td></tr><tr><td scope="row"><code class="literal">ROW_FORMAT=COMPRESSED</code> and valid
                <code class="literal">KEY_BLOCK_SIZE</code> are specified</td><td>None; <code class="literal">KEY_BLOCK_SIZE</code> specified is used</td><td><code class="literal">COMPRESSED</code></td></tr><tr><td scope="row"><code class="literal">KEY_BLOCK_SIZE</code> is specified with
                <code class="literal">REDUNDANT</code>, <code class="literal">COMPACT</code>
                or <code class="literal">DYNAMIC</code> row format</td><td><code class="literal">KEY_BLOCK_SIZE</code> is ignored</td><td><code class="literal">REDUNDANT</code>, <code class="literal">COMPACT</code> or
                <code class="literal">DYNAMIC</code></td></tr><tr><td scope="row"><code class="literal">ROW_FORMAT</code> is not one of
                <code class="literal">REDUNDANT</code>,
                <code class="literal">COMPACT</code>, <code class="literal">DYNAMIC</code>
                or <code class="literal">COMPRESSED</code></td><td>Ignored if recognized by the MySQL parser. Otherwise, an error is
issued.</td><td>the default row format or N/A</td></tr></tbody></table>
</div>

</div>
<br class="table-break"><p>
        When <code class="literal">innodb_strict_mode</code> is
        <code class="literal">ON</code>, MySQL rejects invalid
        <code class="literal">ROW_FORMAT</code> or
        <code class="literal">KEY_BLOCK_SIZE</code> parameters and issues errors.
        When <code class="literal">innodb_strict_mode</code> is
        <code class="literal">OFF</code>, MySQL issues warnings instead of errors
        for ignored invalid parameters.
        <code class="literal">innodb_strict_mode</code> is <code class="literal">ON</code>
        by default as of MySQL 5.7.7.
      </p><p>
        When <code class="literal">innodb_strict_mode</code> is
        <code class="literal">ON</code>, MySQL rejects invalid
        <code class="literal">ROW_FORMAT</code> or
        <code class="literal">KEY_BLOCK_SIZE</code> parameters. For compatibility
        with earlier versions of MySQL, strict mode is not enabled by
        default; instead, MySQL issues warnings (not errors) for ignored
        invalid parameters.
      </p><p>
        It is not possible to see the chosen
        <code class="literal">KEY_BLOCK_SIZE</code> using <code class="literal">SHOW TABLE
        STATUS</code>. The statement <code class="literal">SHOW CREATE
        TABLE</code> displays the <code class="literal">KEY_BLOCK_SIZE</code>
        (even if it was ignored when creating the table). The real
        compressed page size of the table cannot be displayed by MySQL.
</p>
<h5><a name="idm140644111894480"></a>SQL Compression Syntax Warnings and Errors for General Tablespaces</h5>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            If <code class="literal">FILE_BLOCK_SIZE</code> was not defined for
            the general tablespace when the tablespace was created, the
            tablespace cannot contain compressed tables. If you attempt
            to add a compressed table, an error is returned, as shown in
            the following example:
          </p><pre class="programlisting">mysql&gt; CREATE TABLESPACE `ts1` ADD DATAFILE 'ts1.ibd' Engine=InnoDB;
Query OK, 0 rows affected (0.01 sec)

mysql&gt; CREATE TABLE t1 (c1 INT PRIMARY KEY) TABLESPACE ts1 ROW_FORMAT=COMPRESSED 
KEY_BLOCK_SIZE=8;
ERROR 1478 (HY000): InnoDB: Tablespace `ts1` cannot contain a COMPRESSED table</pre></li><li class="listitem"><p>
            Attempting to add a table with an invalid
            <code class="literal">KEY_BLOCK_SIZE</code> to a general tablespace
            returns an error, as shown in the following example:
          </p><pre class="programlisting">mysql&gt; CREATE TABLESPACE `ts2` ADD DATAFILE 'ts2.ibd' FILE_BLOCK_SIZE = 8192 Engine=InnoDB;
Query OK, 0 rows affected (0.01 sec)
    
mysql&gt; CREATE TABLE t2 (c1 INT PRIMARY KEY) TABLESPACE ts2 ROW_FORMAT=COMPRESSED 
KEY_BLOCK_SIZE=4;
ERROR 1478 (HY000): InnoDB: Tablespace `ts2` uses block size 8192 and cannot 
contain a table with physical page size 4096</pre><p>
            For general tablespaces, the
            <code class="literal">KEY_BLOCK_SIZE</code> of the table must be equal
            to the <code class="literal">FILE_BLOCK_SIZE</code> of the tablespace
            divided by 1024. For example, if the
            <code class="literal">FILE_BLOCK_SIZE</code> of the tablespace is
            8192, the <code class="literal">KEY_BLOCK_SIZE</code> of the table
            must be 8.
          </p></li><li class="listitem"><p>
            Attempting to add a table with an uncompressed row format to
            a general tablespace configured to store compressed tables
            returns an error, as shown in the following example:
          </p><pre class="programlisting">mysql&gt; CREATE TABLESPACE `ts3` ADD DATAFILE 'ts3.ibd' FILE_BLOCK_SIZE = 8192 Engine=InnoDB;
Query OK, 0 rows affected (0.01 sec)

mysql&gt; CREATE TABLE t3 (c1 INT PRIMARY KEY) TABLESPACE ts3 ROW_FORMAT=COMPACT;
ERROR 1478 (HY000): InnoDB: Tablespace `ts3` uses block size 8192 and cannot 
contain a table with physical page size 16384</pre></li></ul>
</div>
<p>
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_strict_mode"><code class="literal">innodb_strict_mode</code></a> is not
        applicable to general tablespaces. Tablespace management rules
        for general tablespaces are strictly enforced independently of
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_strict_mode"><code class="literal">innodb_strict_mode</code></a>. For more
        information, see <a class="xref" href="sql-syntax.html#create-tablespace" title="13.1.19 CREATE TABLESPACE Syntax">Section 13.1.19, “CREATE TABLESPACE Syntax”</a>.
      </p><p>
        For more information about using compressed tables with general
        tablespaces, see <a class="xref" href="innodb-storage-engine.html#general-tablespaces" title="14.4.9 InnoDB General Tablespaces">Section 14.4.9, “InnoDB General Tablespaces”</a>.
</p>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="innodb-page-compression"></a>14.6.2 InnoDB Page Compression</h3>

</div>

</div>

</div>
<a class="indexterm" name="idm140644111874288"></a><a class="indexterm" name="idm140644111873216"></a><p>
      As of MySQL 5.7.8, <code class="literal">InnoDB</code> supports page-level
      compression for tables that reside in
      <a class="link" href="glossary.html#glos_file_per_table" title="file-per-table">file_per_table</a>
      tablespaces. This feature is referred to as <span class="emphasis"><em>Transparent
      Page Compression</em></span>. Page compression is enabled by
      specifying the <code class="literal">COMPRESSION</code> attribute with
      <a class="link" href="sql-syntax.html#create-table" title="13.1.18 CREATE TABLE Syntax"><code class="literal">CREATE TABLE</code></a> or
      <a class="link" href="sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a>. Supported compression
      algorithms include <code class="literal">Zlib</code> and
      <code class="literal">LZ4</code>.
</p>
<h4><a name="idm140644111864960"></a>Supported Platforms</h4>
<p>
      Page compression requires sparse file and hole punching support.
      Page compression is supported on Windows with NTFS, and on the
      following subset of MySQL-supported Linux platforms where the
      kernel level provides hole punching support:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          RHEL 7 and derived distributions that use kernel version
          3.10.0-123 or higher
        </p></li><li class="listitem"><p>
          OEL 5.10 (UEK2) kernel version 2.6.39 or higher
        </p></li><li class="listitem"><p>
          OEL 6.5 (UEK3) kernel version 3.8.13 or higher
        </p></li><li class="listitem"><p>
          OEL 7.0 kernel version 3.8.13 or higher
        </p></li><li class="listitem"><p>
          SLE11 kernel version 3.0-x
        </p></li><li class="listitem"><p>
          SLE12 kernel version 3.12-x
        </p></li><li class="listitem"><p>
          OES11 kernel version 3.0-x
        </p></li><li class="listitem"><p>
          Ubuntu 14.0.4 LTS kernel version 3.13 or higher
        </p></li><li class="listitem"><p>
          Ubuntu 12.0.4 LTS kernel version 3.2 or higher
        </p></li><li class="listitem"><p>
          Debian 7 kernel version 3.2 or higher
</p></li></ul>
</div>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">
<div class="admon-title">
Note
</div>
<p>
        All of the available file systems for a given Linux distribution
        may not support hole punching.
</p>
</div>
<h4><a name="idm140644111853840"></a>How Page Compression Works</h4>
<p>
      When a page is written, it is compressed using the specified
      compression algorithm. The compressed data is written to disk,
      where the hole punching mechanism releases empty blocks from the
      end of the page. If compression fails, data is written out as-is.
</p>
<h4><a name="idm140644111852432"></a>Hole Punch Size on Linux</h4>
<p>
      On Linux systems, the file system block size is the unit size used
      for hole punching. Therefore, page compression only works if page
      data can be compressed to a size that is less than or equal to the
      <code class="literal">InnoDB</code> page size minus the file system block
      size. For example, if
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_page_size"><code class="literal">innodb_page_size=16K</code></a> and the file
      system block size is 4K, page data must compress to less than or
      equal to 12K to make hole punching possible.
</p>
<h4><a name="idm140644111848944"></a>Hole Punch Size on Windows</h4>
<p>
      On Windows systems, the underlying infrastructure for sparse files
      is based on NTFS compression. Hole punching size is the NTFS
      compression unit, which is 16 times the NTFS cluster size. Cluster
      sizes and their compression units are shown in the following
      table:
</p>
<div class="table">
<a name="idm140644111847520"></a><p class="title"><b>Table 14.7 Windows NTFS Cluster Size and Compression Units</b></p>
<div class="table-contents">
<table summary="Windows NTFS Cluster Size and Compression Units" border="1"><colgroup><col class="c1"><col class="c2"></colgroup><thead><tr><th scope="col">Cluster Size</th><th scope="col">Compression Unit</th></tr></thead><tbody><tr><td scope="row">512 Bytes</td><td>8 KB</td></tr><tr><td scope="row">1 KB</td><td>16 KB</td></tr><tr><td scope="row">2 KB</td><td>32 KB</td></tr><tr><td scope="row">4 KB</td><td>64 KB</td></tr></tbody></table>
</div>

</div>
<br class="table-break"><p>
      Page compression on Windows systems only works if page data can be
      compressed to a size that is less than or equal to the
      <code class="literal">InnoDB</code> page size minus the compression unit
      size.
    </p><p>
      The default NTFS cluster size is 4K, for which the compression
      unit size is 64K. This means that page compression has no benefit
      for an out-of-the box Windows NTFS configuration, as the maximum
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_page_size"><code class="literal">innodb_page_size</code></a> is also 64K.
    </p><p>
      For page compression to work on Windows, the file system must be
      created with a cluster size smaller than 4K, and the
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_page_size"><code class="literal">innodb_page_size</code></a> must be at least
      twice the size of the compression unit. For example, for page
      compression to work on Windows, you could build the file system
      with a cluster size of 512 Bytes (which has a compression unit of
      8KB) and initialize <code class="literal">InnoDB</code> with an
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_page_size"><code class="literal">innodb_page_size</code></a> value of 16K or
      greater.
</p>
<h4><a name="idm140644111829824"></a>Enabling Page Compression</h4>
<p>
      To enable page compression, specify the
      <code class="literal">COMPRESSION</code> attribute in the
      <a class="link" href="sql-syntax.html#create-table" title="13.1.18 CREATE TABLE Syntax"><code class="literal">CREATE TABLE</code></a> statement. For
      example:
    </p><pre class="programlisting">CREATE TABLE t1 (c1 INT) COMPRESSION="zlib";</pre><p>
      You can also enable page compression in an
      <a class="link" href="sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a> statement. However,
      <a class="link" href="sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE Syntax"><code class="literal">ALTER TABLE ...
      COMPRESSION</code></a> only updates the tablespace compression
      attribute. Writes to the tablespace that occur after setting the
      new compression algorithm use the new setting, but to apply the
      new compression algorithm to existing pages, you must rebuild the
      table using <a class="link" href="sql-syntax.html#optimize-table" title="13.7.2.4 OPTIMIZE TABLE Syntax"><code class="literal">OPTIMIZE TABLE</code></a>.
    </p><pre class="programlisting">ALTER TABLE t1 COMPRESSION="zlib";
OPTIMZE TABLE t1;</pre>
<h4><a name="idm140644111820784"></a>Disabling Page Compression</h4>
<p>
      To disable page compression, set
      <code class="literal">COMPRESSION=None</code> using
      <a class="link" href="sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a>. Writes to the
      tablespace that occur after setting
      <code class="literal">COMPRESSION=None</code> no longer use page
      compression. To uncompress existing pages, you must rebuild the
      table using <a class="link" href="sql-syntax.html#optimize-table" title="13.7.2.4 OPTIMIZE TABLE Syntax"><code class="literal">OPTIMIZE TABLE</code></a> after
      setting <code class="literal">COMPRESSION=None</code>.
    </p><pre class="programlisting">ALTER TABLE t1 COMPRESSION="None";
OPTIMZE TABLE t1;</pre>
<h4><a name="idm140644111814128"></a>Page Compression Metadata</h4>
<p>
      Page compression metadata is found in the
      <a class="link" href="information-schema.html#innodb-sys-tablespaces-table" title="21.31.15 The INFORMATION_SCHEMA INNODB_SYS_TABLESPACES Table"><code class="literal">INFORMATION_SCHEMA.INNODB_SYS_TABLESPACES</code></a>
      table, in four columns that were added with the introduction of
      the Transparent Page Compression feature:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          <code class="literal">FS_BLOCK_SIZE</code>: The file system block size,
          which is the unit size used for hole punching.
        </p></li><li class="listitem"><p>
          <code class="literal">FILE_SIZE</code>: The apparent size of the file,
          which represents the maximum size of the file, uncompressed.
        </p></li><li class="listitem"><p>
          <code class="literal">ALLOCATED_SIZE</code>: The actual size of the
          file, which is the amount of space allocated on disk.
        </p></li><li class="listitem"><p>
          <code class="literal">COMPRESSION</code>: The current tablespace setting
          for page compression (<code class="literal">Zlib</code>,
          <code class="literal">Lz4</code>, or <code class="literal">None</code>). A table
          may contain a mix of pages with different compression
          settings.
        </p><p>
          The <code class="literal">COMPRESSION</code> column displays incorrect
          data after a server restart (Bug #78197) and is removed in
          5.7.10. Use <a class="link" href="sql-syntax.html#show-create-table" title="13.7.5.10 SHOW CREATE TABLE Syntax"><code class="literal">SHOW CREATE TABLE</code></a>
          to view the current page compression setting.
</p></li></ul>
</div>
<p>
      In the following example, page compression metadata for the
      employees table is retrieved from the
      <a class="link" href="information-schema.html#innodb-sys-tablespaces-table" title="21.31.15 The INFORMATION_SCHEMA INNODB_SYS_TABLESPACES Table"><code class="literal">INFORMATION_SCHEMA.INNODB_SYS_TABLESPACES</code></a>
      table.
    </p><pre class="programlisting"># Create the employees table with Zlib page compression

CREATE TABLE employees (
    emp_no      INT             NOT NULL,
    birth_date  DATE            NOT NULL,
    first_name  VARCHAR(14)     NOT NULL,
    last_name   VARCHAR(16)     NOT NULL,
    gender      ENUM ('M','F')  NOT NULL,    
    hire_date   DATE            NOT NULL,
    PRIMARY KEY (emp_no)
) COMPRESSION="zlib";

# Insert data (not shown)
    
# Query page compression metadata in INFORMATION_SCHEMA.INNODB_SYS_TABLESPACES
    
mysql&gt; SELECT SPACE, NAME, FS_BLOCK_SIZE, FILE_SIZE, ALLOCATED_SIZE, COMPRESSION FROM 
INFORMATION_SCHEMA.INNODB_SYS_TABLESPACES WHERE NAME='employees/employees'\G
*************************** 1. row ***************************
SPACE: 45
NAME: employees/employees
FS_BLOCK_SIZE: 4096
FILE_SIZE: 23068672
ALLOCATED_SIZE: 19415040
COMPRESSION: Zlib</pre><p>
      Page compression metadata for the employees table shows that Zlib
      compression is used. The apparent file size is 23068672 bytes
      while the actual file size (with page compression) is 19415040
      bytes. The file system block size is 4096 bytes, which is the
      block size used for hole punching.
</p>
<h4><a name="idm140644111795888"></a>Page Compression Limitations and Usage Notes</h4>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          Page compression is disabled if the file system block size (or
          compression unit size on Windows) * 2 &gt;
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_page_size"><code class="literal">innodb_page_size</code></a>.
        </p></li><li class="listitem"><p>
          Page compression is not supported for tables that reside in
          shared tablespaces, which include the system tablespace, the
          temporary table tablespace, and general tablespaces.
        </p></li><li class="listitem"><p>
          Page compression is not supported for undo log tablespaces.
        </p></li><li class="listitem"><p>
          Page compression is not supported for redo log pages.
        </p></li><li class="listitem"><p>
          R-tree pages, which are used for spatial indexes, are not
          compressed.
        </p></li><li class="listitem"><p>
          Pages that belong to compressed tables
          (<code class="literal">ROW_FORMAT=COMPRESSED</code>) are left as-is.
        </p></li><li class="listitem"><p>
          During recovery, updated pages are written out in an
          uncompressed form.
        </p></li><li class="listitem"><p>
          Loading a page-compressed tablespace on a server that does not
          support the compression algorithm that was used causes an I/O
          error.
        </p></li><li class="listitem"><p>
          Before downgrading to an earlier version of MySQL that does
          not support page compression, uncompress the tables that use
          the page compression feature. To uncompress a table, run
          <a class="link" href="sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE Syntax"><code class="literal">ALTER TABLE ...
          COMPRESSION=None</code></a> and <a class="link" href="sql-syntax.html#optimize-table" title="13.7.2.4 OPTIMIZE TABLE Syntax"><code class="literal">OPTIMIZE
          TABLE</code></a>.
        </p></li><li class="listitem"><p>
          Page-compressed tablespaces can be copied between Linux and
          Windows servers if the compression algorithm that was used is
          available on both servers.
        </p></li><li class="listitem"><p>
          Preserving page compression when moving a page-compressed
          tablespace file from one host to another requires a utility
          that preserves sparse files.
        </p></li><li class="listitem"><p>
          Better page compression may be achieved on Fusion-io hardware
          with NVMFS than on other platforms, as NVMFS is designed to
          take advantage of punch hole functionality.
        </p></li><li class="listitem"><p>
          Using the page compression feature with a large
          <code class="literal">InnoDB</code> page size and relatively small file
          system block size could result in write amplification. For
          example, a maximum <code class="literal">InnoDB</code> page size of 64KB
          with a 4KB file system block size may improve compression but
          may also increase demand on the buffer pool, leading to
          increased I/O and potential write amplification.
</p></li></ul>
</div>

</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="innodb-file-format"></a>14.7 InnoDB File-Format Management</h2>

</div>

</div>

</div>
<div class="toc">
<dl class="toc"><dt><span class="section"><a href="innodb-storage-engine.html#innodb-file-format-enabling">14.7.1 Enabling File Formats</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-file-format-compatibility">14.7.2 Verifying File Format Compatibility</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-file-format-identifying">14.7.3 Identifying the File Format in Use</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-file-format-downgrading">14.7.4 Modifying the File Format</a></span></dt></dl>
</div>
<a class="indexterm" name="idm140644111775040"></a><a class="indexterm" name="idm140644111774000"></a><a class="indexterm" name="idm140644111772928"></a><a class="indexterm" name="idm140644111771856"></a><p>
    As <code class="literal">InnoDB</code> evolves, data file formats that are not
    compatible with prior versions of <code class="literal">InnoDB</code> are
    sometimes required to support new features. To help manage
    compatibility in upgrade and downgrade situations, and systems that
    run different versions of MySQL, <code class="literal">InnoDB</code> uses
    named file formats. <code class="literal">InnoDB</code> currently supports two
    named file formats, <a class="link" href="glossary.html#glos_antelope" title="Antelope">Antelope</a>
    and <a class="link" href="glossary.html#glos_barracuda" title="Barracuda">Barracuda</a>.
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
        <a class="link" href="glossary.html#glos_antelope" title="Antelope">Antelope</a> is the original
        <code class="literal">InnoDB</code> file format, which previously did not
        have a name. It supports the
        <a class="link" href="glossary.html#glos_compact_row_format" title="compact row format">COMPACT</a> and
        <a class="link" href="glossary.html#glos_redundant_row_format" title="redundant row format">REDUNDANT</a> row
        formats for <code class="literal">InnoDB</code> tables.
      </p></li><li class="listitem"><p>
        <a class="link" href="glossary.html#glos_barracuda" title="Barracuda">Barracuda</a> is the newest
        file format. It supports all <code class="literal">InnoDB</code> row
        formats including the newer
        <a class="link" href="glossary.html#glos_compressed_row_format" title="compressed row format">COMPRESSED</a> and
        <a class="link" href="glossary.html#glos_dynamic_row_format" title="dynamic row format">DYNAMIC</a> row
        formats. The features associated with
        <a class="link" href="glossary.html#glos_compressed_row_format" title="compressed row format">COMPRESSED</a> and
        <a class="link" href="glossary.html#glos_dynamic_row_format" title="dynamic row format">DYNAMIC</a> row
        formats include compressed tables, off-page storage for long
        column data, and index key prefixes up to 3072 bytes
        (<a class="link" href="innodb-storage-engine.html#sysvar_innodb_large_prefix"><code class="literal">innodb_large_prefix</code></a>). See
        <a class="xref" href="innodb-storage-engine.html#innodb-row-format" title="14.8 InnoDB Row Storage and Row Formats">Section 14.8, “InnoDB Row Storage and Row Formats”</a>.
</p></li></ul>
</div>
<p>
    This section discusses enabling file formats for new
    <code class="literal">InnoDB</code> tables, verifying compatibility of
    different file formats between MySQL releases, and identifying the
    file format in use.
  </p><p>
    InnoDB file format settings do not apply to tables stored in
    <a class="link" href="innodb-storage-engine.html#general-tablespaces" title="14.4.9 InnoDB General Tablespaces">general tablespaces</a>
    (introduced in MySQL 5.7.6). General tablespaces provide support for
    all row formats and associated features. For more information, see
    <a class="xref" href="innodb-storage-engine.html#general-tablespaces" title="14.4.9 InnoDB General Tablespaces">Section 14.4.9, “InnoDB General Tablespaces”</a>.
</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
      The following file format configuration parameters have new
      default values as of MySQL 5.7.7:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          The <a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_format"><code class="literal">innodb_file_format</code></a>
          default value was changed to <code class="literal">Barracuda</code>. The
          previous default value was <code class="literal">Antelope</code>.
        </p></li><li class="listitem"><p>
          The <a class="link" href="innodb-storage-engine.html#sysvar_innodb_large_prefix"><code class="literal">innodb_large_prefix</code></a>
          default value was changed to <code class="literal">ON</code>. The
          previous default was <code class="literal">OFF</code>.
</p></li></ul>
</div>
<p>
      The following file format configuration parameters are deprecated
      in MySQL 5.7.7 and may be removed in a future release:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_format"><code class="literal">innodb_file_format</code></a>
        </p></li><li class="listitem"><p>
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_format_check"><code class="literal">innodb_file_format_check</code></a>
        </p></li><li class="listitem"><p>
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_format_max"><code class="literal">innodb_file_format_max</code></a>
        </p></li><li class="listitem"><p>
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_large_prefix"><code class="literal">innodb_large_prefix</code></a>
</p></li></ul>
</div>
<p>
      The file format configuration parameters were provided for
      creating tables compatible with earlier versions of
      <code class="literal">InnoDB</code> in MySQL 5.1. Now that MySQL 5.1 has
      reached the end of its product lifecycle, the parameters are no
      longer required. Future removal of the
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_format"><code class="literal">innodb_file_format</code></a> parameter will
      require a new mechanism for managing compatibility of
      <code class="literal">InnoDB</code> tables and tablespaces among different
      versions of MySQL.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="innodb-file-format-enabling"></a>14.7.1 Enabling File Formats</h3>

</div>

</div>

</div>
<p>
      The <a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_format"><code class="literal">innodb_file_format</code></a>
      configuration option defines the file format used when
      <code class="literal">InnoDB</code> tables are created in
      <a class="link" href="glossary.html#glos_file_per_table" title="file-per-table">file_per_table</a>
      tablespaces.
    </p><p>
      <code class="literal">Barracuda</code> is the default
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_format"><code class="literal">innodb_file_format</code></a> setting as of
      MySQL 5.7.7. Prior to MySQL 5.7.7, the default file format is
      <code class="literal">Antelope</code>.
</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
        The <a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_format"><code class="literal">innodb_file_format</code></a>
        configuration option is deprecated and may be removed in a
        future release. For more information, see
        <a class="xref" href="innodb-storage-engine.html#innodb-file-format" title="14.7 InnoDB File-Format Management">Section 14.7, “InnoDB File-Format Management”</a>.
</p>
</div>
<p>
      You can set the value of
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_format"><code class="literal">innodb_file_format</code></a> on the command
      line when you start <a class="link" href="programs.html#mysqld" title="4.3.1 mysqld — The MySQL Server"><span class="command"><strong>mysqld</strong></span></a>, or in the option
      file (<code class="filename">my.cnf</code> on Unix,
      <code class="filename">my.ini</code> on Windows). You can also change it
      dynamically with a <code class="literal">SET GLOBAL</code> statement.
    </p><pre class="programlisting">mysql&gt; SET GLOBAL innodb_file_format=Barracuda;
Query OK, 0 rows affected (0.00 sec)</pre>
<h4><a name="idm140644111711616"></a>Usage notes</h4>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          <a class="link" href="sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a> operations that
          recreate <code class="literal">InnoDB</code> tables use the current
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_format"><code class="literal">innodb_file_format</code></a> setting.
        </p></li><li class="listitem"><p>
          <code class="literal">InnoDB</code> file format settings do not apply to
          tables stored in <a class="link" href="innodb-storage-engine.html#general-tablespaces" title="14.4.9 InnoDB General Tablespaces">general
          tablespaces</a>. General tablespaces provide support for
          all row formats and associated features. For more information,
          see <a class="xref" href="innodb-storage-engine.html#general-tablespaces" title="14.4.9 InnoDB General Tablespaces">Section 14.4.9, “InnoDB General Tablespaces”</a>.
        </p></li><li class="listitem"><p>
          As of MySQL 5.7.6, the
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_format"><code class="literal">innodb_file_format</code></a> setting is
          not applicable when using the <code class="literal">TABLESPACE [=]
          innodb_system</code> table option with
          <a class="link" href="sql-syntax.html#create-table" title="13.1.18 CREATE TABLE Syntax"><code class="literal">CREATE TABLE</code></a> or
          <a class="link" href="sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a> to store a
          <code class="literal">DYNAMIC</code> table in the system tablespace.
        </p></li><li class="listitem"><p>
          As of MySQL 5.7.9, the
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_format"><code class="literal">innodb_file_format</code></a> setting is
          ignored when creating tables that use the
          <code class="literal">DYNAMIC</code> row format. For more information,
          see <a class="xref" href="innodb-storage-engine.html#innodb-row-format-dynamic" title="14.8.3 DYNAMIC and COMPRESSED Row Formats">Section 14.8.3, “DYNAMIC and COMPRESSED Row Formats”</a>.
</p></li></ul>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="innodb-file-format-compatibility"></a>14.7.2 Verifying File Format Compatibility</h3>

</div>

</div>

</div>
<div class="toc">
<dl class="toc"><dt><span class="section"><a href="innodb-storage-engine.html#innodb-file-format-compatibility-checking">14.7.2.1 Compatibility Check When InnoDB Is Started</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-file-format-compatibility-checking-table-access">14.7.2.2 Compatibility Check When a Table Is Opened</a></span></dt></dl>
</div>
<a class="indexterm" name="idm140644111692384"></a><p>
      InnoDB incorporates several checks to guard against the possible
      crashes and data corruptions that might occur if you run an old
      release of the MySQL server on InnoDB data files that use a newer
      file format. These checks take place when the server is started,
      and when you first access a table. This section describes these
      checks, how you can control them, and error and warning conditions
      that might arise.
</p>
<h4><a name="idm140644111690448"></a>Backward Compatibility</h4>
<p>
      You only need to consider backward file format compatibility when
      using a recent version of InnoDB (MySQL 5.5 and higher with
      InnoDB) alongside an older version (MySQL 5.1 or earlier, with the
      built-in InnoDB rather than the InnoDB Plugin). To minimize the
      chance of compatibility issues, you can standardize on the InnoDB
      Plugin for all your MySQL 5.1 and earlier database servers.
    </p><p>
      In general, a newer version of InnoDB may create a table or index
      that cannot safely be read or written with an older version of
      InnoDB without risk of crashes, hangs, wrong results or
      corruptions. InnoDB includes a mechanism to guard against these
      conditions, and to help preserve compatibility among database
      files and versions of InnoDB. This mechanism lets you take
      advantage of some new features of an InnoDB release (such as
      performance improvements and bug fixes), and still preserve the
      option of using your database with an old version of InnoDB, by
      preventing accidental use of new features that create
      downward-incompatible disk files.
    </p><p>
      If a version of InnoDB supports a particular file format (whether
      or not that format is the default), you can query and update any
      table that requires that format or an earlier format. Only the
      creation of new tables using new features is limited based on the
      particular file format enabled. Conversely, if a tablespace
      contains a table or index that uses a file format that is not
      supported, it cannot be accessed at all, even for read access.
    </p><p>
      The only way to <span class="quote">“<span class="quote">downgrade</span>”</span> an InnoDB tablespace to
      the earlier Antelope file format is to copy the data to a new
      table, in a tablespace that uses the earlier format.
    </p><p>
      The easiest way to determine the file format of an existing InnoDB
      tablespace is to examine the properties of the table it contains,
      using the <code class="literal">SHOW TABLE STATUS</code> command or querying
      the table <code class="literal">INFORMATION_SCHEMA.TABLES</code>. If the
      <code class="literal">Row_format</code> of the table is reported as
      <code class="literal">'Compressed'</code> or <code class="literal">'Dynamic'</code>,
      the tablespace containing the table supports the Barracuda format.
</p>
<h4><a name="idm140644111681632"></a>Internal Details</h4>
<p>
      Every InnoDB file-per-table tablespace (represented by a
      <code class="literal">*.ibd</code> file) file is labeled with a file format
      identifier. The system tablespace (represented by the
      <code class="literal">ibdata</code> files) is tagged with the
      <span class="quote">“<span class="quote">highest</span>”</span> file format in use in a group of InnoDB
      database files, and this tag is checked when the files are opened.
    </p><p>
      Creating a compressed table, or a table with
      <code class="literal">ROW_FORMAT=DYNAMIC</code>, updates the file header of
      the corresponding file-per-table <code class="literal">.ibd</code> file and
      the table type in the InnoDB data dictionary with the identifier
      for the Barracuda file format. From that point forward, the table
      cannot be used with a version of InnoDB that does not support the
      Barracuda file format. To protect against anomalous behavior,
      InnoDB performs a compatibility check when the table is opened.
      (In many cases, the <a class="link" href="sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a>
      statement recreates a table and thus changes its properties. The
      special case of adding or dropping indexes without rebuilding the
      table is described in <a class="ulink" href="http://dev.mysql.com/doc/refman/5.5/en/innodb-create-index.html" target="_top">InnoDB Fast Index Creation</a>.)
    </p><p>
      General tablespaces, which are also represented by a
      <code class="literal">*.ibd</code> file, support both Antelope and Barracuda
      file formats. For more information about general tablespaces, see
      <a class="xref" href="innodb-storage-engine.html#general-tablespaces" title="14.4.9 InnoDB General Tablespaces">Section 14.4.9, “InnoDB General Tablespaces”</a>.
</p>
<h4><a name="idm140644111671920"></a>Definition of ib-file set</h4>
<p>
      To avoid confusion, for the purposes of this discussion we define
      the term <span class="quote">“<span class="quote">ib-file set</span>”</span> to mean the set of operating
      system files that InnoDB manages as a unit. The ib-file set
      includes the following files:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          The system tablespace (one or more <code class="literal">ibdata</code>
          files) that contain internal system information (including
          internal catalogs and undo information) and may include user
          data and indexes.
        </p></li><li class="listitem"><p>
          Zero or more single-table tablespaces (also called <span class="quote">“<span class="quote">file
          per table</span>”</span> files, named <code class="literal">*.ibd</code>
          files).
        </p></li><li class="listitem"><p>
          InnoDB log files; usually two, <code class="literal">ib_logfile0</code>
          and <code class="literal">ib_logfile1</code>. Used for crash recovery
          and in backups.
</p></li></ul>
</div>
<p>
      An <span class="quote">“<span class="quote">ib-file set</span>”</span> does not include the corresponding
      <code class="literal">.frm</code> files that contain metadata about InnoDB
      tables. The <code class="literal">.frm</code> files are created and managed
      by MySQL, and can sometimes get out of sync with the internal
      metadata in InnoDB.
    </p><p>
      Multiple tables, even from more than one database, can be stored
      in a single <span class="quote">“<span class="quote">ib-file set</span>”</span>. (In MySQL, a
      <span class="quote">“<span class="quote">database</span>”</span> is a logical collection of tables, what
      other systems refer to as a <span class="quote">“<span class="quote">schema</span>”</span> or
      <span class="quote">“<span class="quote">catalog</span>”</span>.)
</p>
<div class="section">

<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="innodb-file-format-compatibility-checking"></a>14.7.2.1 Compatibility Check When InnoDB Is Started</h4>
</div>
</div>
</div>
<a class="indexterm" name="idm140644111657568"></a><a class="indexterm" name="idm140644111656480"></a><p>
        To prevent possible crashes or data corruptions when InnoDB
        opens an ib-file set, it checks that it can fully support the
        file formats in use within the ib-file set. If the system is
        restarted following a crash, or a <span class="quote">“<span class="quote">fast shutdown</span>”</span>
        (i.e., <a class="link" href="innodb-storage-engine.html#sysvar_innodb_fast_shutdown"><code class="literal">innodb_fast_shutdown</code></a> is
        greater than zero), there may be on-disk data structures (such
        as redo or undo entries, or doublewrite pages) that are in a
        <span class="quote">“<span class="quote">too-new</span>”</span> format for the current software. During
        the recovery process, serious damage can be done to your data
        files if these data structures are accessed. The startup check
        of the file format occurs before any recovery process begins,
        thereby preventing consistency issues with the new tables or
        startup problems for the MySQL server.
      </p><p>
        Beginning with version InnoDB 1.0.1, the system tablespace
        records an identifier or tag for the <span class="quote">“<span class="quote">highest</span>”</span> file
        format used by any table in any of the tablespaces that is part
        of the ib-file set. Checks against this file format tag are
        controlled by the configuration parameter
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_format_check"><code class="literal">innodb_file_format_check</code></a>, which
        is <code class="literal">ON</code> by default.
      </p><p>
        If the file format tag in the system tablespace is newer or
        higher than the highest version supported by the particular
        currently executing software and if
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_format_check"><code class="literal">innodb_file_format_check</code></a> is
        <code class="literal">ON</code>, the following error is issued when the
        server is started:
      </p><pre class="programlisting">
InnoDB: Error: the system tablespace is in a
file format that this version doesn't support
</pre><p>
        You can also set
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_format"><code class="literal">innodb_file_format</code></a> to a file
        format name. Doing so prevents InnoDB from starting if the
        current software does not support the file format specified. It
        also sets the <span class="quote">“<span class="quote">high water mark</span>”</span> to the value you
        specify. The ability to set
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_format_check"><code class="literal">innodb_file_format_check</code></a> will
        be useful (with future releases of InnoDB) if you manually
        <span class="quote">“<span class="quote">downgrade</span>”</span> all of the tables in an ib-file set (as
        described in <a class="ulink" href="http://dev.mysql.com/doc/refman/5.5/en/innodb-downgrading.html" target="_top">Downgrading the InnoDB Storage Engine</a>). You can then
        rely on the file format check at startup if you subsequently use
        an older version of InnoDB to access the ib-file set.
      </p><p>
        In some limited circumstances, you might want to start the
        server and use an ib-file set that is in a new file format that
        is not supported by the software you are using. If you set the
        configuration parameter
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_format_check"><code class="literal">innodb_file_format_check</code></a> to
        <code class="literal">OFF</code>, InnoDB opens the database, but issues
        this warning message in the error log:
      </p><pre class="programlisting">
InnoDB: Warning: the system tablespace is in a
file format that this version doesn't support
</pre>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
          This is a dangerous setting, as it permits the recovery
          process to run, possibly corrupting your database if the
          previous shutdown was a crash or <span class="quote">“<span class="quote">fast shutdown</span>”</span>.
          You should only set
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_format_check"><code class="literal">innodb_file_format_check</code></a> to
          <code class="literal">OFF</code> if you are sure that the previous
          shutdown was done with
          <code class="literal">innodb_fast_shutdown=0</code>, so that essentially
          no recovery process occurs.
</p>
</div>
<p>
        The parameter
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_format_check"><code class="literal">innodb_file_format_check</code></a>
        affects only what happens when a database is opened, not
        subsequently. Conversely, the parameter
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_format"><code class="literal">innodb_file_format</code></a> (which
        enables a specific format) only determines whether or not a new
        table can be created in the enabled format and has no effect on
        whether or not a database can be opened.
      </p><p>
        The file format tag is a <span class="quote">“<span class="quote">high water mark</span>”</span>, and as
        such it is increased after the server is started, if a table in
        a <span class="quote">“<span class="quote">higher</span>”</span> format is created or an existing table
        is accessed for read or write (assuming its format is
        supported). If you access an existing table in a format higher
        than the format the running software supports, the system
        tablespace tag is not updated, but table-level compatibility
        checking applies (and an error is issued), as described in
        <a class="xref" href="innodb-storage-engine.html#innodb-file-format-compatibility-checking-table-access" title="14.7.2.2 Compatibility Check When a Table Is Opened">Section 14.7.2.2, “Compatibility Check When a Table Is Opened”</a>.
        Any time the high water mark is updated, the value of
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_format_check"><code class="literal">innodb_file_format_check</code></a> is
        updated as well, so the command <code class="literal">SELECT
        @@innodb_file_format_check;</code> displays the name of the
        latest file format known to be used by tables in the currently
        open ib-file set and supported by the currently executing
        software.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="innodb-file-format-compatibility-checking-table-access"></a>14.7.2.2 Compatibility Check When a Table Is Opened</h4>

</div>

</div>

</div>
<p>
        When a table is first accessed, InnoDB (including some releases
        prior to InnoDB 1.0) checks that the file format of the
        tablespace in which the table is stored is fully supported. This
        check prevents crashes or corruptions that would otherwise occur
        when tables using a <span class="quote">“<span class="quote">too new</span>”</span> data structure are
        encountered.
      </p><p>
        All tables using any file format supported by a release can be
        read or written (assuming the user has sufficient privileges).
        The setting of the system configuration parameter
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_format"><code class="literal">innodb_file_format</code></a> can prevent
        creating a new table that uses a specific file format, even if
        the file format is supported by a given release. Such a setting
        might be used to preserve backward compatibility, but it does
        not prevent accessing any table that uses a supported format.
      </p><p>
        Versions of MySQL older than 5.0.21 cannot reliably use database
        files created by newer versions if a new file format was used
        when a table was created. To prevent various error conditions or
        corruptions, InnoDB checks file format compatibility when it
        opens a file (for example, upon first access to a table). If the
        currently running version of InnoDB does not support the file
        format identified by the table type in the InnoDB data
        dictionary, MySQL reports the following error:
      </p><pre class="programlisting">
ERROR 1146 (42S02): Table '<em class="replaceable"><code>test</code></em>.<em class="replaceable"><code>t1</code></em>' doesn't exist
</pre><p>
        InnoDB also writes a message to the error log:
      </p><pre class="programlisting">
InnoDB: table <em class="replaceable"><code>test</code></em>/<em class="replaceable"><code>t1</code></em>: unknown table type <em class="replaceable"><code>33</code></em>
</pre><p>
        The table type should be equal to the tablespace flags, which
        contains the file format version as discussed in
        <a class="xref" href="innodb-storage-engine.html#innodb-file-format-identifying" title="14.7.3 Identifying the File Format in Use">Section 14.7.3, “Identifying the File Format in Use”</a>.
      </p><p>
        Versions of InnoDB prior to MySQL 4.1 did not include table
        format identifiers in the database files, and versions prior to
        MySQL 5.0.21 did not include a table format compatibility check.
        Therefore, there is no way to ensure proper operations if a
        table in a newer file format is used with versions of InnoDB
        prior to 5.0.21.
      </p><p>
        The file format management capability in InnoDB 1.0 and higher
        (tablespace tagging and run-time checks) allows InnoDB to verify
        as soon as possible that the running version of software can
        properly process the tables existing in the database.
      </p><p>
        If you permit InnoDB to open a database containing files in a
        format it does not support (by setting the parameter
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_format_check"><code class="literal">innodb_file_format_check</code></a> to
        <code class="literal">OFF</code>), the table-level checking described in
        this section still applies.
      </p><p>
        Users are <span class="emphasis"><em>strongly</em></span> urged not to use
        database files that contain Barracuda file format tables with
        releases of InnoDB older than the MySQL 5.1 with the InnoDB
        Plugin. It may be possible to rebuild such tables to use the
        Antelope format.
</p>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="innodb-file-format-identifying"></a>14.7.3 Identifying the File Format in Use</h3>

</div>

</div>

</div>
<a class="indexterm" name="idm140644111605936"></a><a class="indexterm" name="idm140644111604448"></a><p>
      If you enable a different <a class="link" href="glossary.html#glos_file_format" title="file format">file
      format</a> using the
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_format"><code class="literal">innodb_file_format</code></a> configuration
      option, the change only applies to newly created tables. Also,
      when you create a new table, the tablespace containing the table
      is tagged with the <span class="quote">“<span class="quote">earliest</span>”</span> or
      <span class="quote">“<span class="quote">simplest</span>”</span> file format that is required to support
      the table's features. For example, if you enable the
      <code class="literal">Barracuda</code> file format, and create a new table
      that does not use the Dynamic or Compressed row format, the new
      tablespace that contains the table is tagged as using the
      <code class="literal">Antelope</code> file format .
    </p><p>
      It is easy to identify the file format used by a given table. The
      table uses the <code class="literal">Antelope</code> file format if the row
      format reported by <code class="literal">SHOW TABLE STATUS</code> is either
      <code class="literal">Compact</code> or <code class="literal">Redundant</code>. The
      table uses the <code class="literal">Barracuda</code> file format if the row
      format reported by <code class="literal">SHOW TABLE STATUS</code> is either
      <code class="literal">Compressed</code> or <code class="literal">Dynamic</code>.
    </p><pre class="programlisting">
mysql&gt; SHOW TABLE STATUS\G
*************************** 1. row ***************************
           Name: t1
         Engine: InnoDB
        Version: 10
     Row_format: Compact
           Rows: 0
 Avg_row_length: 0
    Data_length: 16384
Max_data_length: 0
   Index_length: 16384
      Data_free: 0
 Auto_increment: 1
    Create_time: 2014-11-03 13:32:10
    Update_time: NULL
     Check_time: NULL
      Collation: latin1_swedish_ci
       Checksum: NULL
 Create_options: 
        Comment:</pre><p>
      You can also identify the file format used by a given table or
      tablespace using <code class="literal">InnoDB</code>
      <code class="literal">INFORMATION_SCHEMA</code> tables. For example:
    </p><pre class="programlisting">mysql&gt; SELECT * FROM INFORMATION_SCHEMA.INNODB_SYS_TABLES WHERE NAME='test/t1'\G 
*************************** 1. row ***************************
     TABLE_ID: 44
         NAME: test/t1
         FLAG: 1
       N_COLS: 6
        SPACE: 30
  FILE_FORMAT: Antelope
   ROW_FORMAT: Compact
ZIP_PAGE_SIZE: 0
    
mysql&gt; SELECT * FROM INFORMATION_SCHEMA.INNODB_SYS_TABLESPACES WHERE NAME='test/t1'\G
*************************** 1. row ***************************
        SPACE: 30
         NAME: test/t1
         FLAG: 0
  FILE_FORMAT: Antelope
   ROW_FORMAT: Compact or Redundant
    PAGE_SIZE: 16384
ZIP_PAGE_SIZE: 0
</pre>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="innodb-file-format-downgrading"></a>14.7.4 Modifying the File Format</h3>

</div>

</div>

</div>
<a class="indexterm" name="idm140644111584928"></a><p>
      Each InnoDB tablespace file (with a name matching
      <code class="literal">*.ibd</code>) is tagged with the file format used to
      create its table and indexes. The way to modify the file format is
      to re-create the table and its indexes. The easiest way to
      recreate a table and its indexes is to use the following command
      on each table that you want to modify:
    </p><pre class="programlisting">
ALTER TABLE <em class="replaceable"><code>t</code></em> ROW_FORMAT=<em class="replaceable"><code>format_name</code></em>;
</pre><p>
      If you are modifying the file format to downgrade to an older
      MySQL version, there may be incompatibilities in table storage
      formats that require additional steps. For information about
      downgrading to a previous MySQL version, see
      <a class="xref" href="installing.html#downgrading" title="2.11.2 Downgrading MySQL">Section 2.11.2, “Downgrading MySQL”</a>.
</p>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="innodb-row-format"></a>14.8 InnoDB Row Storage and Row Formats</h2>

</div>

</div>

</div>
<div class="toc">
<dl class="toc"><dt><span class="section"><a href="innodb-storage-engine.html#innodb-row-format-overview">14.8.1 Overview of InnoDB Row Storage</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-row-format-specification">14.8.2 Specifying the Row Format for a Table</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-row-format-dynamic">14.8.3 DYNAMIC and COMPRESSED Row Formats</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-row-format-antelope">14.8.4 COMPACT and REDUNDANT Row Formats</a></span></dt></dl>
</div>
<p>
    This section discusses how InnoDB features such as table
    <a class="link" href="glossary.html#glos_compression" title="compression">compression</a>, off-page
    storage of long variable-length column values, and large index key
    prefixes (<a class="link" href="innodb-storage-engine.html#sysvar_innodb_large_prefix"><code class="literal">innodb_large_prefix</code></a>) are
    controlled by the row format of an <code class="literal">InnoDB</code> table.
    It also discusses considerations for choosing the right row format,
    and compatibility of row formats between MySQL releases.
</p>
<div class="section">

<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="innodb-row-format-overview"></a>14.8.1 Overview of InnoDB Row Storage</h3>
</div>
</div>
</div>
<p>
      The storage for rows and associated columns affects performance
      for queries and DML operations. As more rows fit into a single
      disk <a class="link" href="glossary.html#glos_page" title="page">page</a>, queries and index
      lookups can work faster, less cache memory is required in the
      InnoDB buffer pool, and less I/O is required to write out updated
      values for the numeric and short string columns.
    </p><p>
      The data in each InnoDB table is divided into
      <a class="link" href="glossary.html#glos_page" title="page">pages</a>. The pages that make up
      each table are arranged in a tree data structure called a
      <a class="link" href="glossary.html#glos_b_tree" title="B-tree">B-tree index</a>. Table data
      and <a class="link" href="glossary.html#glos_secondary_index" title="secondary index">secondary indexes</a>
      both use this type of structure. The B-tree index that represents
      an entire table is known as the
      <a class="link" href="glossary.html#glos_clustered_index" title="clustered index">clustered index</a>, which
      is organized according to the
      <a class="link" href="glossary.html#glos_primary_key" title="primary key">primary key</a> columns. The
      nodes of the index data structure contain the values of all the
      columns in that row (for the clustered index) or the index columns
      and the primary key columns (for secondary indexes).
    </p><p>
      Variable-length columns are an exception to this rule. Columns
      such as <code class="literal">BLOB</code> and <code class="literal">VARCHAR</code>
      that are too long to fit on a B-tree page are stored on separately
      allocated disk pages called
      <a class="link" href="glossary.html#glos_overflow_page" title="overflow page">overflow pages</a>. We call
      such columns <a class="link" href="glossary.html#glos_off_page_column" title="off-page column">off-page
      columns</a>. The values of these columns are stored in
      singly-linked lists of overflow pages, and each such column has
      its own list of one or more overflow pages. In some cases, all or
      a prefix of the long column value is stored in the B-tree, to
      avoid wasting storage and eliminating the need to read a separate
      page.
    </p><p>
      The following sections describe how to configure the row format of
      <code class="literal">InnoDB</code> tables to control how variable-length
      columns values are stored. Row format configuration also
      determines the availability of the
      <a class="link" href="glossary.html#glos_compression" title="compression">table compression</a> feature
      and the large index key prefix feature
      (<a class="link" href="innodb-storage-engine.html#sysvar_innodb_large_prefix"><code class="literal">innodb_large_prefix</code></a>).
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="innodb-row-format-specification"></a>14.8.2 Specifying the Row Format for a Table</h3>

</div>

</div>

</div>
<a class="indexterm" name="idm140644111557680"></a><a class="indexterm" name="idm140644111556192"></a><a class="indexterm" name="idm140644111554704"></a><p>
      In MySQL 5.7.8 and earlier, rows are stored in
      <code class="literal">COMPACT</code> format by default. As of MySQL 5.7.9,
      the default row format is defined by
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_default_row_format"><code class="literal">innodb_default_row_format</code></a>, which
      has a default value of <code class="literal">DYNAMIC</code>. The default row
      format is used when the <code class="literal">ROW_FORMAT</code> table option
      is not defined explicitly or when
      <code class="literal">ROW_FORMAT=DEFAULT</code> is specified.
    </p><p>
      The row format of a table can be defined explicitly using the
      <code class="literal">ROW_FORMAT</code> table option in a
      <a class="link" href="sql-syntax.html#create-table" title="13.1.18 CREATE TABLE Syntax"><code class="literal">CREATE TABLE</code></a> or
      <a class="link" href="sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a> statement. For example:
    </p><pre class="programlisting">CREATE TABLE t1 (c1 INT) ROW_FORMAT=DYNAMIC;</pre><p>
      An explicitly defined <code class="literal">ROW_FORMAT</code> setting
      overrides the implicit default. Specifying
      <code class="literal">ROW_FORMAT=DEFAULT</code> is equivalent to using the
      implicit default.
    </p><p>
      The <a class="link" href="innodb-storage-engine.html#sysvar_innodb_default_row_format"><code class="literal">innodb_default_row_format</code></a>
      option, introduced in MySQL 5.7.9, can be set dynamically:
    </p><pre class="programlisting">mysql&gt; SET GLOBAL innodb_default_row_format=DYNAMIC;</pre><p>
      Valid <a class="link" href="innodb-storage-engine.html#sysvar_innodb_default_row_format"><code class="literal">innodb_default_row_format</code></a>
      options include <code class="literal">DYNAMIC</code>,
      <code class="literal">COMPACT</code>, and <code class="literal">REDUNDANT</code>. The
      <code class="literal">COMPRESSED</code> row format, which is not supported
      for use in the system tablespace, cannot be defined as the
      default. It can only be specified explicitly in a
      <a class="link" href="sql-syntax.html#create-table" title="13.1.18 CREATE TABLE Syntax"><code class="literal">CREATE TABLE</code></a> or
      <a class="link" href="sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a> statement. Attempting
      to set <a class="link" href="innodb-storage-engine.html#sysvar_innodb_default_row_format"><code class="literal">innodb_default_row_format</code></a>
      to <code class="literal">COMPRESSED</code> returns an error:
    </p><pre class="programlisting">mysql&gt; SET GLOBAL innodb_default_row_format=COMPRESSED;
ERROR 1231 (42000): Variable 'innodb_default_row_format' 
can't be set to the value of 'COMPRESSED'</pre><p>
      Newly created tables use the row format defined by
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_default_row_format"><code class="literal">innodb_default_row_format</code></a> when a
      <code class="literal">ROW_FORMAT</code> option is not specified explicitly
      or when <code class="literal">ROW_FORMAT=DEFAULT</code> is used. For
      example, the following <a class="link" href="sql-syntax.html#create-table" title="13.1.18 CREATE TABLE Syntax"><code class="literal">CREATE TABLE</code></a>
      statements use the row format defined by
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_default_row_format"><code class="literal">innodb_default_row_format</code></a>.
    </p><pre class="programlisting">CREATE TABLE t1 (c1 INT);</pre><pre class="programlisting">CREATE TABLE t2 (c1 INT) ROW_FORMAT=DEFAULT;</pre><p>
      When a <code class="literal">ROW_FORMAT</code> option is not specified
      explicitly or when <code class="literal">ROW_FORMAT=DEFAULT</code> is used,
      any operation that rebuilds a table also silently changes the row
      format of the table to the format defined by
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_default_row_format"><code class="literal">innodb_default_row_format</code></a>.
    </p><p>
      Table-rebuilding operations include <a class="link" href="sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE Syntax"><code class="literal">ALTER
      TABLE</code></a> operations that use
      <code class="literal">ALGORITHM=COPY</code> or <a class="link" href="sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE Syntax"><code class="literal">ALTER
      TABLE</code></a> operations that use
      <code class="literal">ALGORITM=INPLACE</code> where table rebuilding is
      required. See <a class="xref" href="innodb-storage-engine.html#innodb-online-ddl-summary-grid" title="Table 14.8 Summary of Online Status for DDL Operations">Table 14.8, “Summary of Online Status for DDL Operations”</a> for
      an overview of the online status of DDL operations.
      <a class="link" href="sql-syntax.html#optimize-table" title="13.7.2.4 OPTIMIZE TABLE Syntax"><code class="literal">OPTIMIZE TABLE</code></a> is also a
      table-rebuilding operation.
    </p><p>
      The following example demonstrates a table-rebuilding operation
      that silently changes the row format of a table created without an
      explicitly defined row format.
    </p><pre class="programlisting">mysql&gt; SELECT @@innodb_default_row_format;
+-----------------------------+
| @@innodb_default_row_format |
+-----------------------------+
| dynamic                     |
+-----------------------------+

mysql&gt; CREATE TABLE t1 (c1 INT);

mysql&gt; SELECT * FROM INFORMATION_SCHEMA.INNODB_SYS_TABLES WHERE NAME LIKE 'test/t1' \G
*************************** 1. row ***************************
     TABLE_ID: 54
         NAME: test/t1
         FLAG: 33
       N_COLS: 4
        SPACE: 35
  FILE_FORMAT: Barracuda
   ROW_FORMAT: Dynamic
ZIP_PAGE_SIZE: 0
   SPACE_TYPE: Single

mysql&gt; SET GLOBAL innodb_default_row_format=COMPACT;

mysql&gt; ALTER TABLE t1 ADD COLUMN (c2 INT);

mysql&gt; SELECT * FROM INFORMATION_SCHEMA.INNODB_SYS_TABLES WHERE NAME LIKE 'test/t1' \G
*************************** 1. row ***************************
     TABLE_ID: 55
         NAME: test/t1
         FLAG: 1
       N_COLS: 5
        SPACE: 36
  FILE_FORMAT: Antelope
   ROW_FORMAT: Compact
ZIP_PAGE_SIZE: 0
   SPACE_TYPE: Single</pre><p>
      Consider the following potential issues before changing the row
      format of existing tables from <code class="literal">REDUNDANT</code> or
      <code class="literal">COMPACT</code> to <code class="literal">DYNAMIC</code>.
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          The <code class="literal">REDUNDANT</code> and
          <code class="literal">COMPACT</code> row format supports a maximum index
          key prefix length of 767 bytes whereas
          <code class="literal">DYNAMIC</code> and <code class="literal">COMPRESSED</code>
          row formats support an index key prefix length of 3072 bytes
          if the <a class="link" href="innodb-storage-engine.html#sysvar_innodb_large_prefix"><code class="literal">innodb_large_prefix</code></a>
          configuration option is enabled. In a replication environment,
          if <a class="link" href="innodb-storage-engine.html#sysvar_innodb_default_row_format"><code class="literal">innodb_default_row_format</code></a>
          is set to <code class="literal">DYNAMIC</code> on the master and set to
          <code class="literal">COMPACT</code> on the slave, the following DDL
          statement, which does not explicitly define a row format,
          succeeds on the master but fails on the slave:
        </p><pre class="programlisting">CREATE TABLE t1 (c1 INT PRIMARY KEY, c2 VARCHAR(5000), KEY i1(c2(3070)));</pre><p>
          For related information, see
          <a class="xref" href="innodb-storage-engine.html#innodb-restrictions" title="14.5.7 Limits on InnoDB Tables">Section 14.5.7, “Limits on InnoDB Tables”</a>.
        </p></li><li class="listitem"><p>
          Importing a table that does not explicitly define a row format
          results in a schema mismatch error if the
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_default_row_format"><code class="literal">innodb_default_row_format</code></a>
          setting on the source server differs from the setting on the
          destination server. For more information, refer to the
          limitations outlined in <a class="xref" href="innodb-storage-engine.html#tablespace-copying" title="14.4.6 Copying File-Per-Table Tablespaces to Another Server">Section 14.4.6, “Copying File-Per-Table Tablespaces to Another Server”</a>.
</p></li></ul>
</div>
<p>
      To view the row format of a table, issue a
      <a class="link" href="sql-syntax.html#show-table-status" title="13.7.5.36 SHOW TABLE STATUS Syntax"><code class="literal">SHOW TABLE STATUS</code></a> statement or
      query <a class="link" href="information-schema.html#tables-table" title="21.24 The INFORMATION_SCHEMA TABLES Table"><code class="literal">INFORMATION_SCHEMA.TABLES</code></a>.
    </p><pre class="programlisting">SELECT * FROM INFORMATION_SCHEMA.INNODB_SYS_TABLES WHERE NAME LIKE 'test/t1' \G</pre><p>
      The row format of an <code class="literal">InnoDB</code> table determines
      its physical row structure. See
      <a class="xref" href="innodb-storage-engine.html#innodb-physical-record" title="14.2.7.7 Physical Row Structure">Section 14.2.7.7, “Physical Row Structure”</a> for more information.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="innodb-row-format-dynamic"></a>14.8.3 DYNAMIC and COMPRESSED Row Formats</h3>

</div>

</div>

</div>
<a class="indexterm" name="idm140644111486864"></a><a class="indexterm" name="idm140644111485408"></a><a class="indexterm" name="idm140644111484336"></a><a class="indexterm" name="idm140644111482848"></a><a class="indexterm" name="idm140644111481776"></a><p>
      When a table is created with a <code class="literal">DYNAMIC</code> or
      <code class="literal">COMPRESSED</code> row format, long column values are
      stored fully off-page, and the clustered index record contains
      only a 20-byte pointer to the overflow page. By comparison, the
      <code class="literal">COMPACT</code> row format stores up to the first 768
      bytes of variable-length columns values in the clustered index
      record along with a 20-byte pointer to the overflow page.
    </p><p>
      Whether any columns are stored off-page depends on the page size
      and the total size of the row. When the row is too long,
      <code class="literal">InnoDB</code> chooses the longest columns for off-page
      storage until the clustered index record fits on the
      <a class="link" href="glossary.html#glos_b_tree" title="B-tree">B-tree</a> page.
      <a class="link" href="data-types.html#blob" title="11.4.3 The BLOB and TEXT Types"><code class="literal">TEXT</code></a> and
      <a class="link" href="data-types.html#blob" title="11.4.3 The BLOB and TEXT Types"><code class="literal">BLOB</code></a> columns that are less than or
      equal to 40 bytes are always stored in-line.
    </p><p>
      The <code class="literal">DYNAMIC</code> row format maintains the efficiency
      of storing the entire row in the index node if it fits (as do the
      <code class="literal">COMPACT</code> and <code class="literal">REDUNDANT</code>
      formats), but the <code class="literal">DYNAMIC</code> row format avoids the
      problem of filling B-tree nodes with a large number of data bytes
      of long columns. The <code class="literal">DYNAMIC</code> format is based on
      the idea that if a portion of a long data value is stored
      off-page, it is usually most efficient to store all of the value
      off-page. With <code class="literal">DYNAMIC</code> format, shorter columns
      are likely to remain in the B-tree node, minimizing the number of
      overflow pages needed for any given row.
    </p><p>
      The <code class="literal">COMPRESSED</code> row format uses similar internal
      details for off-page storage as the <code class="literal">DYNAMIC</code> row
      format, with additional storage and performance considerations
      from the table and index data being compressed and using smaller
      page sizes. With the <code class="literal">COMPRESSED</code> row format, the
      <code class="literal">KEY_BLOCK_SIZE</code> option controls how much column
      data is stored in the clustered index, and how much is placed on
      overflow pages. For full details about the
      <code class="literal">COMPRESSED</code> row format, see
      <a class="xref" href="innodb-storage-engine.html#innodb-compression" title="14.6 InnoDB Table and Page Compression">Section 14.6, “InnoDB Table and Page Compression”</a>.
    </p><p>
      Both <code class="literal">DYNAMIC</code> and <code class="literal">COMPRESSED</code>
      row formats support index key prefixes up to 3072 bytes. This
      feature is controlled by the
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_large_prefix"><code class="literal">innodb_large_prefix</code></a> configuration
      option, which is enabled by default as of MySQL 5.7.7. See the
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_large_prefix"><code class="literal">innodb_large_prefix</code></a> option
      description for more information.
    </p><p>
      Tables that use the <code class="literal">COMPRESSED</code> row format can
      be created in <a class="link" href="glossary.html#glos_file_per_table" title="file-per-table">file_per_table
      </a> tablespaces or
      <a class="link" href="glossary.html#glos_general_tablespace" title="general tablespace">general tablespaces</a>
      (introduced in MySQL 5.7.6). The system tablespace does not
      support the <code class="literal">COMPRESSED</code> row format. To store a
      <code class="literal">COMPRESSED</code> table in a file-per-table
      tablespace, <a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_per_table"><code class="literal">innodb_file_per_table</code></a>
      must be enabled and
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_format"><code class="literal">innodb_file_format</code></a> must be set to
      <code class="literal">Barracuda</code>. The
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_per_table"><code class="literal">innodb_file_per_table</code></a> and
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_format"><code class="literal">innodb_file_format</code></a> configuration
      options are not applicable to general tablespaces. General
      tablespaces support all row formats with the caveat that
      compressed and uncompressed tables cannot coexist in the same
      general tablespace due to different physical page sizes. For more
      information about general tablespaces, see
      <a class="xref" href="innodb-storage-engine.html#general-tablespaces" title="14.4.9 InnoDB General Tablespaces">Section 14.4.9, “InnoDB General Tablespaces”</a>.
    </p><p>
      In MySQL 5.7.5 and earlier, tables that use the
      <code class="literal">DYNAMIC</code> row format can only be stored in
      <a class="link" href="glossary.html#glos_file_per_table" title="file-per-table">file_per_table</a>
      tablespaces, requiring that
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_per_table"><code class="literal">innodb_file_per_table</code></a> be enabled
      and <a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_format"><code class="literal">innodb_file_format</code></a> be set to
      <code class="literal">Barracuda</code>.
    </p><p>
      As of MySQL 5.7.6, <code class="literal">DYNAMIC</code> tables can be stored
      in file-per-table tablespaces, general tablespaces, and the system
      tablespace. To store <code class="literal">DYNAMIC</code> tables in the
      system tablespace, you must use the <code class="literal">TABLESPACE [=]
      innodb_system</code> table option with <code class="literal">CREATE
      TABLE</code> or <code class="literal">ALTER TABLE</code>. The
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_per_table"><code class="literal">innodb_file_per_table</code></a> and
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_format"><code class="literal">innodb_file_format</code></a> configuration
      options are not applicable to general tablespaces, nor are they
      applicable when using the <code class="literal">TABLESPACE [=]
      innodb_system</code> table option to store
      <code class="literal">DYNAMIC</code> tables in the system tablespace.
    </p><p>
      As of MySQL 5.7.9, you can add a <code class="literal">DYNAMIC</code> table
      to the system tablespace by disabling
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_per_table"><code class="literal">innodb_file_per_table</code></a> and using a
      regular <code class="literal">CREATE TABLE</code> or <code class="literal">ALTER
      TABLE</code> statement. The
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_format"><code class="literal">innodb_file_format</code></a> setting is
      ignored. A <code class="literal">DYNAMIC</code> table always uses the
      <code class="literal">Barracuda</code> file format.
    </p><p>
      <code class="literal">DYNAMIC</code> and <code class="literal">COMPRESSED</code> row
      formats are variations of the <code class="literal">COMPACT</code> row
      format and therefore handle <a class="link" href="data-types.html#char" title="11.4.1 The CHAR and VARCHAR Types"><code class="literal">CHAR</code></a>
      storage in the same way as the <code class="literal">COMPACT</code> row
      format. For more information, see
      <a class="xref" href="innodb-storage-engine.html#innodb-physical-record" title="14.2.7.7 Physical Row Structure">Section 14.2.7.7, “Physical Row Structure”</a>.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="innodb-row-format-antelope"></a>14.8.4 COMPACT and REDUNDANT Row Formats</h3>

</div>

</div>

</div>
<a class="indexterm" name="idm140644111420096"></a><a class="indexterm" name="idm140644111418608"></a><a class="indexterm" name="idm140644111417536"></a><a class="indexterm" name="idm140644111416048"></a><a class="indexterm" name="idm140644111414976"></a><p>
      Early versions of <code class="literal">InnoDB</code> used an unnamed file
      format (now called <a class="link" href="glossary.html#glos_antelope" title="Antelope">Antelope</a>)
      for database files. The Antelope file format supports the
      <code class="literal">COMPACT</code> or <code class="literal">REDUNDANT</code> row
      formats. With these row formats, <code class="literal">InnoDB</code> stores
      up to the first 768 bytes of variable-length columns (such as
      <code class="literal">BLOB</code> and <code class="literal">VARCHAR</code>) in the
      index record within the <a class="link" href="glossary.html#glos_b_tree" title="B-tree">B-tree</a>
      node, with the remainder stored on the overflow pages.
    </p><p>
      To preserve compatibility with earlier versions of
      <code class="literal">InnoDB</code>, <code class="literal">COMPACT</code> remained the
      default row format up to MySQL 5.7.8. As of MySQL 5.7.9, the
      default row format is <code class="literal">DYNAMIC</code>, which is defined
      by the <a class="link" href="innodb-storage-engine.html#sysvar_innodb_default_row_format"><code class="literal">innodb_default_row_format</code></a>
      configuration option. See
      <a class="xref" href="innodb-storage-engine.html#innodb-row-format-dynamic" title="14.8.3 DYNAMIC and COMPRESSED Row Formats">Section 14.8.3, “DYNAMIC and COMPRESSED Row Formats”</a> for information about
      the <code class="literal">DYNAMIC</code> and <code class="literal">COMPRESSED</code>
      row formats.
    </p><p>
      With the Antelope file format, if the value of a column is 768
      bytes or less, no overflow page is needed, and some savings in I/O
      may result, since the value is in the B-tree node. This works well
      for relatively short <code class="literal">BLOB</code>s, but may cause
      B-tree nodes to fill with data rather than key values, reducing
      their efficiency. Tables with many <code class="literal">BLOB</code> columns
      could cause B-tree nodes to become too full of data, and contain
      too few rows, making the entire index less efficient than if the
      rows were shorter or if the column values were stored off-page.
    </p><p>
      For information about the physical row structure of tables that
      use the <code class="literal">REDUNDANT</code> or <code class="literal">COMPACT</code>
      row format, see <a class="xref" href="innodb-storage-engine.html#innodb-physical-record" title="14.2.7.7 Physical Row Structure">Section 14.2.7.7, “Physical Row Structure”</a>.
</p>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="innodb-disk-management"></a>14.9 InnoDB Disk I/O and File Space Management</h2>

</div>

</div>

</div>
<div class="toc">
<dl class="toc"><dt><span class="section"><a href="innodb-storage-engine.html#innodb-disk-io">14.9.1 InnoDB Disk I/O</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-file-space">14.9.2 File Space Management</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-checkpoints">14.9.3 InnoDB Checkpoints</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-file-defragmenting">14.9.4 Defragmenting a Table</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-truncate-table-reclaim-space">14.9.5 Reclaiming Disk Space with TRUNCATE TABLE</a></span></dt></dl>
</div>
<p>
    As a DBA, you must manage disk I/O to keep the I/O subsystem from
    becoming saturated, and manage disk space to avoid filling up
    storage devices. The <a class="link" href="glossary.html#glos_acid" title="ACID">ACID</a> design
    model requires a certain amount of I/O that might seem redundant,
    but helps to ensure data reliability. Within these constraints,
    <code class="literal">InnoDB</code> tries to optimize the database work and
    the organization of disk files to minimize the amount of disk I/O.
    Sometimes, I/O is postponed until the database is not busy, or until
    everything needs to be brought to a consistent state, such as during
    a database restart after a <a class="link" href="glossary.html#glos_fast_shutdown" title="fast shutdown">fast
    shutdown</a>.
  </p><p>
    This section discusses the main considerations for I/O and disk
    space with the default kind of MySQL tables (also known as
    <code class="literal">InnoDB</code> tables):
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
        Controlling the amount of background I/O used to improve query
        performance.
      </p></li><li class="listitem"><p>
        Enabling or disabling features that provide extra durability at
        the expense of additional I/O.
      </p></li><li class="listitem"><p>
        Organizing tables into many small files, a few larger files, or
        a combination of both.
      </p></li><li class="listitem"><p>
        Balancing the size of redo log files against the I/O activity
        that occurs when the log files become full.
      </p></li><li class="listitem"><p>
        How to reorganize a table for optimal query performance.
</p></li></ul>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="innodb-disk-io"></a>14.9.1 InnoDB Disk I/O</h3>

</div>

</div>

</div>
<a class="indexterm" name="idm140644111384000"></a><p>
      <code class="literal">InnoDB</code> uses asynchronous disk I/O where
      possible, by creating a number of threads to handle I/O
      operations, while permitting other database operations to proceed
      while the I/O is still in progress. On Linux and Windows
      platforms, InnoDB uses the available OS and library functions to
      perform <span class="quote">“<span class="quote">native</span>”</span> asynchronous I/O. On other
      platforms, InnoDB still uses I/O threads, but the threads may
      actually wait for I/O requests to complete; this technique is
      known as <span class="quote">“<span class="quote">simulated</span>”</span> asynchronous I/O.
</p>
<h4><a name="idm140644111380048"></a>Read-Ahead</h4>
<p>
      If InnoDB can determine there is a high probability that data
      might be needed soon, it performs read-ahead operations to bring
      that data into the buffer pool so that it is available in memory.
      Making a few large read requests for contiguous data can be more
      efficient than making several small, spread-out requests. There
      are two read-ahead heuristics in InnoDB:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          In sequential read-ahead, if <code class="literal">InnoDB</code> notices
          that the access pattern to a segment in the tablespace is
          sequential, it posts in advance a batch of reads of database
          pages to the I/O system.
        </p></li><li class="listitem"><p>
          In random read-ahead, if <code class="literal">InnoDB</code> notices
          that some area in a tablespace seems to be in the process of
          being fully read into the buffer pool, it posts the remaining
          reads to the I/O system.
</p></li></ul>
</div>
<h4><a name="idm140644111374736"></a>Doublewrite Buffer</h4>
<a class="indexterm" name="idm140644111374048"></a><a class="indexterm" name="idm140644111372976"></a><p>
      <code class="literal">InnoDB</code> uses a novel file flush technique
      involving a structure called the
      <a class="link" href="glossary.html#glos_doublewrite_buffer" title="doublewrite buffer">doublewrite buffer</a>,
      which is enabled by default
      (<a class="link" href="innodb-storage-engine.html#sysvar_innodb_doublewrite"><code class="literal">innodb_doublewrite=ON</code></a>). It adds
      safety to recovery following a crash or power outage, and improves
      performance on most varieties of Unix by reducing the need for
      <code class="literal">fsync()</code> operations.
    </p><p>
      Before writing pages to a data file, <code class="literal">InnoDB</code>
      first writes them to a contiguous tablespace area called the
      doublewrite buffer. Only after the write and the flush to the
      doublewrite buffer has completed does <code class="literal">InnoDB</code>
      write the pages to their proper positions in the data file. If
      there is an operating system, storage subsystem, or
      <a class="link" href="programs.html#mysqld" title="4.3.1 mysqld — The MySQL Server"><span class="command"><strong>mysqld</strong></span></a> process crash in the middle of a page
      write (causing a <a class="link" href="glossary.html#glos_torn_page" title="torn page">torn page</a>
      condition), <code class="literal">InnoDB</code> can later find a good copy
      of the page from the doublewrite buffer during recovery.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="innodb-file-space"></a>14.9.2 File Space Management</h3>

</div>

</div>

</div>
<a class="indexterm" name="idm140644111361328"></a><p>
      The data files that you define in the configuration file form the
      <code class="literal">InnoDB</code>
      <a class="link" href="glossary.html#glos_system_tablespace" title="system tablespace">system tablespace</a>.
      The files are logically concatenated to form the tablespace. There
      is no striping in use. You cannot define where within the
      tablespace your tables are allocated. In a newly created
      tablespace, <code class="literal">InnoDB</code> allocates space starting
      from the first data file.
    </p><p>
      To avoid the issues that come with storing all tables and indexes
      inside the system tablespace, you can turn on the
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_per_table"><code class="literal">innodb_file_per_table</code></a>
      configuration option, which stores each newly created table in a
      separate tablespace file (with extension <code class="literal">.ibd</code>).
      For tables stored this way, there is less fragmentation within the
      disk file, and when the table is truncated, the space is returned
      to the operating system rather than still being reserved by InnoDB
      within the system tablespace. For more information, see
      <a class="xref" href="innodb-storage-engine.html#innodb-multiple-tablespaces" title="14.4.4 InnoDB File-Per-Table Tablespaces">Section 14.4.4, “InnoDB File-Per-Table Tablespaces”</a>.
    </p><p>
      As of MySQL 5.7.6, you can also store tables in
      <a class="link" href="glossary.html#glos_general_tablespace" title="general tablespace">general
      tablespaces</a>. General tablespaces are shared tablespaces
      created using <a class="link" href="sql-syntax.html#create-tablespace" title="13.1.19 CREATE TABLESPACE Syntax"><code class="literal">CREATE TABLESPACE</code></a>
      syntax. They can be created outside of the MySQL data directory,
      are capable of holding multiple tables, and support tables of all
      row formats. For more information, see
      <a class="xref" href="innodb-storage-engine.html#general-tablespaces" title="14.4.9 InnoDB General Tablespaces">Section 14.4.9, “InnoDB General Tablespaces”</a>.
</p>
<h4><a name="idm140644111349840"></a>Pages, Extents, Segments, and Tablespaces</h4>
<p>
      Each tablespace consists of database
      <a class="link" href="glossary.html#glos_page" title="page">pages</a>. Every tablespace in a
      MySQL instance has the same <a class="link" href="glossary.html#glos_page_size" title="page size">page
      size</a>. By default, all tablespaces have a page size of 16KB;
      you can reduce the page size to 8KB or 4KB by specifying the
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_page_size"><code class="literal">innodb_page_size</code></a> option when you
      create the MySQL instance. As of MySQL 5.7.6, you can also
      increase the page size to 32KB or 64KB. For more information,
      refer to the <a class="link" href="innodb-storage-engine.html#sysvar_innodb_page_size"><code class="literal">innodb_page_size</code></a>
      documentation.
    </p><p>
      The pages are grouped into
      <a class="link" href="glossary.html#glos_extent" title="extent">extents</a> of size 1MB for pages
      up to 16KB in size (64 consecutive 16KB pages, or 128 8KB pages,
      or 256 4KB pages). For a page size of 32KB, extent size is 2MB.
      For page size of 64KB, extent size is 4MB. The
      <span class="quote">“<span class="quote">files</span>”</span> inside a tablespace are called
      <a class="link" href="glossary.html#glos_segment" title="segment">segments</a> in
      <code class="literal">InnoDB</code>. (These segments are different from the
      <a class="link" href="glossary.html#glos_rollback_segment" title="rollback segment">rollback segment</a>,
      which actually contains many tablespace segments.)
    </p><p>
      When a segment grows inside the tablespace,
      <code class="literal">InnoDB</code> allocates the first 32 pages to it one
      at a time. After that, <code class="literal">InnoDB</code> starts to
      allocate whole extents to the segment. <code class="literal">InnoDB</code>
      can add up to 4 extents at a time to a large segment to ensure
      good sequentiality of data.
    </p><p>
      Two segments are allocated for each index in
      <code class="literal">InnoDB</code>. One is for nonleaf nodes of the
      <a class="link" href="glossary.html#glos_b_tree" title="B-tree">B-tree</a>, the other is for the
      leaf nodes. Keeping the leaf nodes contiguous on disk enables
      better sequential I/O operations, because these leaf nodes contain
      the actual table data.
    </p><p>
      Some pages in the tablespace contain bitmaps of other pages, and
      therefore a few extents in an <code class="literal">InnoDB</code> tablespace
      cannot be allocated to segments as a whole, but only as individual
      pages.
    </p><p>
      When you ask for available free space in the tablespace by issuing
      a <a class="link" href="sql-syntax.html#show-table-status" title="13.7.5.36 SHOW TABLE STATUS Syntax"><code class="literal">SHOW TABLE STATUS</code></a> statement,
      <code class="literal">InnoDB</code> reports the extents that are definitely
      free in the tablespace. <code class="literal">InnoDB</code> always reserves
      some extents for cleanup and other internal purposes; these
      reserved extents are not included in the free space.
    </p><p>
      When you delete data from a table, <code class="literal">InnoDB</code>
      contracts the corresponding B-tree indexes. Whether the freed
      space becomes available for other users depends on whether the
      pattern of deletes frees individual pages or extents to the
      tablespace. Dropping a table or deleting all rows from it is
      guaranteed to release the space to other users, but remember that
      deleted rows are physically removed only by the
      <a class="link" href="glossary.html#glos_purge" title="purge">purge</a> operation, which happens
      automatically some time after they are no longer needed for
      transaction rollbacks or consistent reads. (See
      <a class="xref" href="innodb-storage-engine.html#innodb-multi-versioning" title="14.2.3 InnoDB Multi-Versioning">Section 14.2.3, “InnoDB Multi-Versioning”</a>.)
    </p><a class="indexterm" name="idm140644111326880"></a><a class="indexterm" name="idm140644111325392"></a><a class="indexterm" name="idm140644111323904"></a><p>
      To view information about the tablespace, query the
      <a class="link" href="information-schema.html#innodb-sys-tablespaces-table" title="21.31.15 The INFORMATION_SCHEMA INNODB_SYS_TABLESPACES Table"><code class="literal">INNODB_SYS_TABLESPACES</code></a> table.
</p>
<h4><a name="idm140644111320640"></a>How Pages Relate to Table Rows</h4>
<p>
      The maximum row length, except for variable-length columns
      (<a class="link" href="data-types.html#binary-varbinary" title="11.4.2 The BINARY and VARBINARY Types"><code class="literal">VARBINARY</code></a>,
      <a class="link" href="data-types.html#char" title="11.4.1 The CHAR and VARCHAR Types"><code class="literal">VARCHAR</code></a>,
      <a class="link" href="data-types.html#blob" title="11.4.3 The BLOB and TEXT Types"><code class="literal">BLOB</code></a> and
      <a class="link" href="data-types.html#blob" title="11.4.3 The BLOB and TEXT Types"><code class="literal">TEXT</code></a>), is slightly less than half
      of a database page for 4KB, 8KB, 16KB, and 32KB
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_page_size"><code class="literal">innodb_page_size</code></a> settings. For
      example, the maximum row length is about 8000 bytes for the
      default 16KB page size. For an
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_page_size"><code class="literal">innodb_page_size</code></a> setting of 64KB,
      <a class="link" href="innodb-storage-engine.html" title="Chapter 14 The InnoDB Storage Engine"><code class="literal">InnoDB</code></a> restricts row size to about
      16000 bytes. <a class="link" href="data-types.html#blob" title="11.4.3 The BLOB and TEXT Types"><code class="literal">LONGBLOB</code></a> and
      <a class="link" href="data-types.html#blob" title="11.4.3 The BLOB and TEXT Types"><code class="literal">LONGTEXT</code></a> columns
      must be less than 4GB, and the total row length, including
      <a class="link" href="data-types.html#blob" title="11.4.3 The BLOB and TEXT Types"><code class="literal">BLOB</code></a> and
      <a class="link" href="data-types.html#blob" title="11.4.3 The BLOB and TEXT Types"><code class="literal">TEXT</code></a> columns, must be less than
      4GB.
    </p><p>
      If a row is less than half a page long, all of it is stored
      locally within the page. If it exceeds half a page,
      variable-length columns are chosen for external off-page storage
      until the row fits within half a page. For a column chosen for
      off-page storage, <code class="literal">InnoDB</code> stores the first 768
      bytes locally in the row, and the rest externally into overflow
      pages. Each such column has its own list of overflow pages. The
      768-byte prefix is accompanied by a 20-byte value that stores the
      true length of the column and points into the overflow list where
      the rest of the value is stored.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="innodb-checkpoints"></a>14.9.3 InnoDB Checkpoints</h3>

</div>

</div>

</div>
<a class="indexterm" name="idm140644111302576"></a><p>
      Making your <a class="link" href="glossary.html#glos_log_file" title="log file">log files</a> very
      large may reduce disk I/O during
      <a class="link" href="glossary.html#glos_checkpoint" title="checkpoint">checkpointing</a>. It often
      makes sense to set the total size of the log files as large as the
      buffer pool or even larger. Although in the past large log files
      could make crash recovery take excessive time, starting with MySQL
      5.5, performance enhancements to crash recovery make it possible
      to use large log files with fast startup after a crash. (Strictly
      speaking, this performance improvement is available for MySQL 5.1
      with the InnoDB Plugin 1.0.7 and higher. It is with MySQL 5.5 that
      this improvement is available in the default InnoDB storage
      engine.)
</p>
<h4><a name="idm140644111298384"></a>How Checkpoint Processing Works</h4>
<p>
      <code class="literal">InnoDB</code> implements a
      <a class="link" href="glossary.html#glos_checkpoint" title="checkpoint">checkpoint</a> mechanism known
      as <a class="link" href="glossary.html#glos_fuzzy_checkpointing" title="fuzzy checkpointing">fuzzy
      checkpointing</a>. <code class="literal">InnoDB</code> flushes modified
      database pages from the buffer pool in small batches. There is no
      need to flush the buffer pool in one single batch, which would
      disrupt processing of user SQL statements during the checkpointing
      process.
    </p><p>
      During <a class="link" href="glossary.html#glos_crash_recovery" title="crash recovery">crash recovery</a>,
      <code class="literal">InnoDB</code> looks for a checkpoint label written to
      the log files. It knows that all modifications to the database
      before the label are present in the disk image of the database.
      Then <code class="literal">InnoDB</code> scans the log files forward from
      the checkpoint, applying the logged modifications to the database.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="innodb-file-defragmenting"></a>14.9.4 Defragmenting a Table</h3>

</div>

</div>

</div>
<a class="indexterm" name="idm140644111289456"></a><a class="indexterm" name="idm140644111287552"></a><p>
      Random insertions into or deletions from a secondary index can
      cause the index to become fragmented. Fragmentation means that the
      physical ordering of the index pages on the disk is not close to
      the index ordering of the records on the pages, or that there are
      many unused pages in the 64-page blocks that were allocated to the
      index.
    </p><p>
      One symptom of fragmentation is that a table takes more space than
      it <span class="quote">“<span class="quote">should</span>”</span> take. How much that is exactly, is
      difficult to determine. All <code class="literal">InnoDB</code> data and
      indexes are stored in <a class="link" href="glossary.html#glos_b_tree" title="B-tree">B-trees</a>,
      and their <a class="link" href="glossary.html#glos_fill_factor" title="fill factor">fill factor</a> may
      vary from 50% to 100%. Another symptom of fragmentation is that a
      table scan such as this takes more time than it
      <span class="quote">“<span class="quote">should</span>”</span> take:
    </p><pre class="programlisting">
SELECT COUNT(*) FROM t WHERE <em class="replaceable"><code>non_indexed_column</code></em> &lt;&gt; 12345;
</pre><p>
      The preceding query requires MySQL to perform a full table scan,
      the slowest type of query for a large table.
    </p><p>
      To speed up index scans, you can periodically perform a
      <span class="quote">“<span class="quote">null</span>”</span> <a class="link" href="sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a>
      operation, which causes MySQL to rebuild the table:
    </p><pre class="programlisting">
ALTER TABLE <em class="replaceable"><code>tbl_name</code></em> ENGINE=INNODB
</pre><p>
      You can also use
      <a class="link" href="sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE Syntax"><code class="literal">ALTER TABLE
      <em class="replaceable"><code>tbl_name</code></em> FORCE</code></a> to perform a
      <span class="quote">“<span class="quote">null</span>”</span> alter operation that rebuilds the table.
    </p><p>
      As of MySQL 5.7.4, both
      <a class="link" href="sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE Syntax"><code class="literal">ALTER TABLE
      <em class="replaceable"><code>tbl_name</code></em> ENGINE=INNODB</code></a> and
      <a class="link" href="sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE Syntax"><code class="literal">ALTER TABLE
      <em class="replaceable"><code>tbl_name</code></em> FORCE</code></a> use
      <a class="link" href="innodb-storage-engine.html#innodb-online-ddl" title="14.10 InnoDB and Online DDL">online DDL</a>
      (<code class="literal">ALGORITHM=COPY</code>). For more information, see
      <a class="xref" href="innodb-storage-engine.html#innodb-create-index-overview" title="14.10.1 Overview of Online DDL">Section 14.10.1, “Overview of Online DDL”</a>.
    </p><p>
      Another way to perform a defragmentation operation is to use
      <a class="link" href="programs.html#mysqldump" title="4.5.4 mysqldump — A Database Backup Program"><span class="command"><strong>mysqldump</strong></span></a> to dump the table to a text file,
      drop the table, and reload it from the dump file.
    </p><p>
      If the insertions into an index are always ascending and records
      are deleted only from the end, the <code class="literal">InnoDB</code>
      filespace management algorithm guarantees that fragmentation in
      the index does not occur.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="innodb-truncate-table-reclaim-space"></a>14.9.5 Reclaiming Disk Space with TRUNCATE TABLE</h3>

</div>

</div>

</div>
<p>
      To reclaim operating system disk space when
      <a class="link" href="glossary.html#glos_truncate" title="truncate">truncating</a> an
      <code class="literal">InnoDB</code> table, the table must be stored in its
      own <a class="link" href="glossary.html#glos_ibd_file" title=".ibd file">.ibd</a> file. For a table to
      be stored in its own <a class="link" href="glossary.html#glos_ibd_file" title=".ibd file">.ibd</a>
      file, <a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_per_table"><code class="literal">innodb_file_per_table</code></a> must
      enabled when the table is created. Additionally, there cannot be a
      <a class="link" href="glossary.html#glos_foreign_key" title="foreign key">foreign key</a> constraint
      between the table being truncated and other tables, otherwise the
      <code class="literal">TRUNCATE TABLE</code> operation fails. A foreign key
      constraint between two columns in the same table, however, is
      permitted.
    </p><p>
      When a table is truncated, it is dropped and re-created in a new
      <code class="filename">.ibd</code> file, and the freed space is returned to
      the operating system. This is in contrast to truncating
      <code class="literal">InnoDB</code> tables that are stored within the
      <code class="literal">InnoDB</code>
      <a class="link" href="glossary.html#glos_system_tablespace" title="system tablespace">system tablespace</a>
      (tables created when <code class="literal">innodb_file_per_table=OFF</code>)
      and tables stored in shared
      <a class="link" href="glossary.html#glos_general_tablespace" title="general tablespace">general
      tablespaces</a>, where only <code class="literal">InnoDB</code> can use
      the freed space after the table is truncated.
    </p><p>
      The ability to truncate tables and return disk space to the
      operating system also means that
      <a class="link" href="glossary.html#glos_physical_backup" title="physical backup">physical backups</a> can
      be smaller. Truncating tables that are stored in the system
      tablespace (tables created when
      <code class="literal">innodb_file_per_table=OFF</code>) or in a general
      tablespace leaves blocks of unused space in the tablespace.
</p>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="innodb-online-ddl"></a>14.10 InnoDB and Online DDL</h2>

</div>

</div>

</div>
<div class="toc">
<dl class="toc"><dt><span class="section"><a href="innodb-storage-engine.html#innodb-create-index-overview">14.10.1 Overview of Online DDL</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-create-index-concurrency">14.10.2 Performance and Concurrency Considerations for Online DDL</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-online-ddl-syntax">14.10.3 SQL Syntax for Online DDL</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-online-ddl-single-multi">14.10.4 Combining or Separating DDL Statements</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-create-index-examples">14.10.5 Examples of Online DDL</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-create-index-implementation">14.10.6 Implementation Details of Online DDL</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-create-index-recovery">14.10.7 How Crash Recovery Works with Online DDL</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#online-ddl-partitioning">14.10.8 Online DDL for Partitioned InnoDB Tables</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-create-index-limitations">14.10.9 Limitations of Online DDL</a></span></dt></dl>
</div>
<a class="indexterm" name="idm140644111246672"></a><a class="indexterm" name="idm140644111245600"></a><a class="indexterm" name="idm140644111244528"></a><p>
    The <a class="link" href="glossary.html#glos_online_ddl" title="online DDL">online DDL</a> feature
    enhances many types of <a class="link" href="sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a>
    operations to avoid table copying, blocking of
    <a class="link" href="glossary.html#glos_dml" title="DML">DML</a> operations while
    <a class="link" href="glossary.html#glos_ddl" title="DDL">DDL</a> is in progress, or both.
  </p><p>
    The <a class="link" href="glossary.html#glos_online_ddl" title="online DDL">online DDL</a> feature has
    the following benefits:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
        It improves responsiveness and availability in busy production
        environments, where making a table unavailable for minutes or
        hours whenever you modify its indexes or column definitions is
        not practical.
      </p></li><li class="listitem"><p>
        It lets you adjust the balance between performance and
        concurrency during the DDL operation, by choosing whether to
        block access to the table entirely
        (<code class="literal">LOCK=EXCLUSIVE</code> clause), allow queries but
        not DML (<code class="literal">LOCK=SHARED</code> clause), or allow full
        query and DML access to the table (<code class="literal">LOCK=NONE</code>
        clause). When you omit the <code class="literal">LOCK</code> clause or
        specify <code class="literal">LOCK=DEFAULT</code>, MySQL allows as much
        concurrency as possible depending on the type of operation.
      </p></li><li class="listitem"><p>
        Performing changes in-place where possible, rather than creating
        a new copy of the table, avoids temporary increases in disk
        space usage and I/O overhead associated with copying the table
        and reconstructing secondary indexes.
</p></li></ul>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="innodb-create-index-overview"></a>14.10.1 Overview of Online DDL</h3>

</div>

</div>

</div>
<a class="indexterm" name="idm140644111229008"></a><a class="indexterm" name="idm140644111227936"></a><p>
      Historically, many <a class="link" href="glossary.html#glos_ddl" title="DDL">DDL</a> operations
      on <code class="literal">InnoDB</code> tables were expensive. Many
      <a class="link" href="sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a> operations worked by
      creating a new, empty table defined with the requested table
      options and indexes, then copying the existing rows to the new
      table one-by-one, updating the indexes as the rows were inserted.
      After all rows from the original table were copied, the old table
      was dropped and the copy was renamed with the name of the original
      table.
    </p><p>
      MySQL 5.5, and MySQL 5.1 with the InnoDB Plugin, optimized
      <code class="literal">CREATE INDEX</code> and <code class="literal">DROP INDEX</code>
      to avoid the table-copying behavior. That feature was known as
      <a class="link" href="glossary.html#glos_fast_index_creation" title="Fast Index Creation">Fast Index
      Creation</a>. MySQL 5.6 enhanced many other types of
      <a class="link" href="sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a> operations to avoid
      copying the table. Another enhancement allowed
      <a class="link" href="sql-syntax.html#select" title="13.2.9 SELECT Syntax"><code class="literal">SELECT</code></a> queries and
      <a class="link" href="sql-syntax.html#insert" title="13.2.5 INSERT Syntax"><code class="literal">INSERT</code></a>,
      <a class="link" href="sql-syntax.html#update" title="13.2.11 UPDATE Syntax"><code class="literal">UPDATE</code></a>, and
      <a class="link" href="sql-syntax.html#delete" title="13.2.2 DELETE Syntax"><code class="literal">DELETE</code></a>
      (<a class="link" href="glossary.html#glos_dml" title="DML">DML</a>) statements to proceed while
      the table is being altered. In MySQL 5.7,
      <a class="link" href="sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE Syntax"><code class="literal">ALTER TABLE RENAME
      INDEX</code></a> was also enhanced to avoid table copying. This
      combination of features is now known as
      <a class="link" href="glossary.html#glos_online_ddl" title="online DDL">online DDL</a>.
    </p><p>
      This mechanism also means that you can generally speed the overall
      process of creating and loading a table and associated indexes by
      creating the table without any secondary indexes, then adding the
      secondary indexes after the data is loaded.
    </p><p>
      Although no syntax changes are required in the
      <a class="link" href="sql-syntax.html#create-index" title="13.1.14 CREATE INDEX Syntax"><code class="literal">CREATE INDEX</code></a> or
      <a class="link" href="sql-syntax.html#drop-index" title="13.1.25 DROP INDEX Syntax"><code class="literal">DROP INDEX</code></a> commands, some factors
      affect the performance, space usage, and semantics of this
      operation (see <a class="xref" href="innodb-storage-engine.html#innodb-create-index-limitations" title="14.10.9 Limitations of Online DDL">Section 14.10.9, “Limitations of Online DDL”</a>).
    </p><p>
      The online DDL enhancements in MySQL 5.6 improved many DDL
      operations that formerly required a table copy, blocked DML
      operations on the table, or both.
      <a class="xref" href="innodb-storage-engine.html#innodb-online-ddl-summary-grid" title="Table 14.8 Summary of Online Status for DDL Operations">Table 14.8, “Summary of Online Status for DDL Operations”</a> shows the
      variations of the <a class="link" href="sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a>
      statement and shows how the online DDL feature applies to each.
    </p><p>
      With the exception of <a class="link" href="sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a>
      partitioning clauses, online DDL operations for partitioned
      <code class="literal">InnoDB</code> tables follow the same rules that apply
      to regular <code class="literal">InnoDB</code> tables. For more information,
      see <a class="xref" href="innodb-storage-engine.html#online-ddl-partitioning" title="14.10.8 Online DDL for Partitioned InnoDB Tables">Section 14.10.8, “Online DDL for Partitioned InnoDB Tables”</a>.
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          The <span class="quote">“<span class="quote">In-Place?</span>”</span> column shows which operations
          allow the <code class="literal">ALGORITHM=INPLACE</code> clause; the
          preferred value is <span class="quote">“<span class="quote">Yes</span>”</span>.
        </p></li><li class="listitem"><p>
          The <span class="quote">“<span class="quote">Copies Table?</span>”</span> column shows which operations
          are able to avoid the expensive table-copying operation; the
          preferred value is <span class="quote">“<span class="quote">No</span>”</span>. This column is mostly
          the reverse of the <span class="quote">“<span class="quote">In-Place?</span>”</span> column, except
          that a few operations allow
          <code class="literal">ALGORITHM=INPLACE</code> but still involve some
          amount of table copying.
        </p></li><li class="listitem"><p>
          The <span class="quote">“<span class="quote">Allows Concurrent DML?</span>”</span> column shows which
          operations can be performed fully online; the preferred value
          is <span class="quote">“<span class="quote">Yes</span>”</span>. You can specify
          <code class="literal">LOCK=NONE</code> to assert that full concurrency
          is allowed during the DDL, but MySQL automatically allows this
          level of concurrency when possible. When concurrent DML is
          allowed, concurrent queries are also always allowed.
        </p></li><li class="listitem"><p>
          The <span class="quote">“<span class="quote">Allows Concurrent Queries?</span>”</span> column shows
          which DDL operations allow queries on the table while the
          operation is in progress; the preferred value is
          <span class="quote">“<span class="quote">Yes</span>”</span>. Concurrent query is allowed during all
          online DDL operations. It is shown with <span class="quote">“<span class="quote">Yes</span>”</span>
          listed for all cells, for reference purposes. You can specify
          <code class="literal">LOCK=SHARED</code> to assert that concurrent
          queries are allowed during the DDL, but MySQL automatically
          allows this level of concurrency when possible.
        </p></li><li class="listitem"><p>
          The <span class="quote">“<span class="quote">Notes</span>”</span> column explains any exceptions to the
          <span class="quote">“<span class="quote">Yes/No</span>”</span> values of the other columns, such as
          when the answer depends on the setting of a configuration
          option or some other clause in the DDL statement. The values
          <span class="quote">“<span class="quote">Yes*</span>”</span> and <span class="quote">“<span class="quote">No*</span>”</span> indicate that an
          answer depends on these additional notes.
</p></li></ul>
</div>

<div class="table">
<a name="innodb-online-ddl-summary-grid"></a><p class="title"><b>Table 14.8 Summary of Online Status for DDL Operations</b></p>
<div class="table-contents">
<table summary="Summary of Online Status for DDL Operations" border="1"><colgroup><col align="left"><col align="center"><col align="center"><col align="center"><col align="center"><col align="left"></colgroup><thead><tr><th scope="col" align="left">Operation</th><th scope="col" align="center">In-Place?</th><th scope="col" align="center">Copies Table?</th><th scope="col" align="center">Allows Concurrent DML?</th><th scope="col" align="center">Allows Concurrent Query?</th><th scope="col" align="left">Notes</th></tr></thead><tbody><tr><td scope="row" align="left"><a class="link" href="sql-syntax.html#create-index" title="13.1.14 CREATE INDEX Syntax"><code class="literal">CREATE INDEX</code></a>,
              <a class="link" href="sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE Syntax"><code class="literal">ADD
              INDEX</code></a></td><td align="center">Yes*</td><td align="center">No*</td><td align="center">Yes</td><td align="center">Yes</td><td align="left">Some restrictions for <code class="literal">FULLTEXT</code> index; see next row.</td></tr><tr><td scope="row" align="left"><a class="link" href="sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE Syntax"><code class="literal">ADD FULLTEXT
              INDEX</code></a></td><td align="center">Yes</td><td align="center">No*</td><td align="center">No</td><td align="center">Yes</td><td align="left">Creating the first <code class="literal">FULLTEXT</code> index for a table
              involves a table copy, unless there is a user-supplied
              <code class="literal">FTS_DOC_ID</code> column. Subsequent
              <code class="literal">FULLTEXT</code> indexes on the same table can
              be created in-place.</td></tr><tr><td scope="row" align="left"><a class="link" href="sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE Syntax"><code class="literal">ADD SPATIAL INDEX</code></a></td><td align="center">Yes</td><td align="center">No</td><td align="center">No</td><td align="center">Yes</td><td align="left">In-place support was added in MySQL 5.7.5. Bulk load is not supported.</td></tr><tr><td scope="row" align="left"><a class="link" href="sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE Syntax"><code class="literal">RENAME INDEX</code></a></td><td align="center">Yes</td><td align="center">No</td><td align="center">Yes</td><td align="center">Yes</td><td align="left">Only modifies table metadata.</td></tr><tr><td scope="row" align="left"><a class="link" href="sql-syntax.html#drop-index" title="13.1.25 DROP INDEX Syntax"><code class="literal">DROP INDEX</code></a></td><td align="center">Yes</td><td align="center">No</td><td align="center">Yes</td><td align="center">Yes</td><td align="left">Only modifies table metadata.</td></tr><tr><td scope="row" align="left"><a class="link" href="sql-syntax.html#optimize-table" title="13.7.2.4 OPTIMIZE TABLE Syntax"><code class="literal">OPTIMIZE TABLE</code></a></td><td align="center">Yes</td><td align="center">Yes</td><td align="center">Yes</td><td align="center">Yes</td><td align="left">Uses <code class="literal">ALGORITHM=INPLACE</code> as of MySQL 5.7.4.
              <code class="literal">ALGORITHM=COPY</code> is used if
              <code class="literal">old_alter_table=1</code> or
              <a class="link" href="programs.html#mysqld" title="4.3.1 mysqld — The MySQL Server"><span class="command"><strong>mysqld</strong></span></a> <code class="literal">--skip-new</code>
              option is enabled. <code class="literal">OPTIMIZE TABLE</code> using
              online DDL (<code class="literal">ALGORITHM=INPLACE</code>) is not
              supported for tables with FULLTEXT indexes.</td></tr><tr><td scope="row" align="left">Set default value for a column</td><td align="center">Yes</td><td align="center">No</td><td align="center">Yes</td><td align="center">Yes</td><td align="left">Only modifies table metadata.</td></tr><tr><td scope="row" align="left">Change <a class="link" href="glossary.html#glos_auto_increment" title="auto-increment">auto-increment</a> value
              for a column</td><td align="center">Yes</td><td align="center">No</td><td align="center">Yes</td><td align="center">Yes</td><td align="left">Modifies a value stored in memory, not the data file.</td></tr><tr><td scope="row" align="left">Add a <a class="link" href="glossary.html#glos_foreign_key_constraint" title="FOREIGN KEY constraint">foreign key
              constraint</a></td><td align="center">Yes*</td><td align="center">No*</td><td align="center">Yes</td><td align="center">Yes</td><td align="left">To avoid copying the table, disable
              <a class="link" href="server-administration.html#sysvar_foreign_key_checks"><code class="literal">foreign_key_checks</code></a> during
              constraint creation.</td></tr><tr><td scope="row" align="left">Drop a <a class="link" href="glossary.html#glos_foreign_key_constraint" title="FOREIGN KEY constraint">foreign key
              constraint</a></td><td align="center">Yes</td><td align="center">No</td><td align="center">Yes</td><td align="center">Yes</td><td align="left">The <a class="link" href="server-administration.html#sysvar_foreign_key_checks"><code class="literal">foreign_key_checks</code></a> option can be
              enabled or disabled.</td></tr><tr><td scope="row" align="left">Rename a column</td><td align="center">Yes*</td><td align="center">No*</td><td align="center">Yes*</td><td align="center">Yes</td><td align="left">To allow concurrent DML, keep the same data type and only change the
              column name. Prior to MySQL 5.7.8,
              <code class="literal">ALGORITHM=INPLACE</code> is supported for
              renaming a virtual generated column but not for renaming a
              stored generated column. As of MySQL 5.7.8,
              <code class="literal">ALGORITHM=INPLACE</code> is not supported for
              renaming virtual or stored generated columns.</td></tr><tr><td scope="row" align="left">Add a column</td><td align="center">Yes*</td><td align="center">Yes*</td><td align="center">Yes*</td><td align="center">Yes</td><td align="left">Concurrent DML is not allowed when adding an
              <a class="link" href="glossary.html#glos_auto_increment" title="auto-increment">auto-increment</a>
              column. Although <code class="literal">ALGORITHM=INPLACE</code> is
              allowed, the data is reorganized substantially, so it is
              still an expensive operation.
              <code class="literal">ALGORITHM=INPLACE</code> is supported for
              adding a virtual generated column but not for adding a
              stored generated column. Adding a virtual generated column
              does not require a table copy.</td></tr><tr><td scope="row" align="left">Drop a column</td><td align="center">Yes</td><td align="center">Yes*</td><td align="center">Yes</td><td align="center">Yes</td><td align="left">Although <code class="literal">ALGORITHM=INPLACE</code> is allowed, the data is
              reorganized substantially, so it is still an expensive
              operation. <code class="literal">ALGORITHM=INPLACE</code> is
              supported for dropping a generated column. Dropping a
              virtual generated column does not require a table copy.</td></tr><tr><td scope="row" align="left">Reorder columns</td><td align="center">Yes</td><td align="center">Yes</td><td align="center">Yes</td><td align="center">Yes</td><td align="left">Although <code class="literal">ALGORITHM=INPLACE</code> is allowed, the data is
              reorganized substantially, so it is still an expensive
              operation.</td></tr><tr><td scope="row" align="left">Change <code class="literal">ROW_FORMAT</code> property</td><td align="center">Yes</td><td align="center">Yes</td><td align="center">Yes</td><td align="center">Yes</td><td align="left">Although <code class="literal">ALGORITHM=INPLACE</code> is allowed, the data is
              reorganized substantially, so it is still an expensive
              operation.</td></tr><tr><td scope="row" align="left">Change <code class="literal">KEY_BLOCK_SIZE</code> property</td><td align="center">Yes</td><td align="center">Yes</td><td align="center">Yes</td><td align="center">Yes</td><td align="left">Although <code class="literal">ALGORITHM=INPLACE</code> is allowed, the data is
              reorganized substantially, so it is still an expensive
              operation.</td></tr><tr><td scope="row" align="left">Make column <code class="literal">NULL</code></td><td align="center">Yes</td><td align="center">Yes</td><td align="center">Yes</td><td align="center">Yes</td><td align="left">Although <code class="literal">ALGORITHM=INPLACE</code> is allowed, the data is
              reorganized substantially, so it is still an expensive
              operation.</td></tr><tr><td scope="row" align="left">Make column <code class="literal">NOT NULL</code></td><td align="center">Yes*</td><td align="center">Yes</td><td align="center">Yes</td><td align="center">Yes</td><td align="left"><code class="literal">STRICT_ALL_TABLES</code> or
              <code class="literal">STRICT_TRANS_TABLES</code>
              <a class="link" href="server-administration.html#sysvar_sql_mode"><code class="literal">SQL_MODE</code></a> is required for
              the operation to succeed. The operation fails if the
              column contains NULL values. The server prohibits changes
              to foreign key columns that have the potential to cause
              loss of referential integrity. For more information, see
              <a class="xref" href="sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE Syntax">Section 13.1.8, “ALTER TABLE Syntax”</a>. Although
              <code class="literal">ALGORITHM=INPLACE</code> is allowed, the data
              is reorganized substantially, so it is still an expensive
              operation.</td></tr><tr><td scope="row" align="left">Change data type of column</td><td align="center">No*</td><td align="center">Yes*</td><td align="center">No</td><td align="center">Yes</td><td align="left">Exception: <a class="link" href="data-types.html#char" title="11.4.1 The CHAR and VARCHAR Types"><code class="literal">VARCHAR</code></a> size may be increased
              using online <a class="link" href="sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a>.
              See <a class="xref" href="innodb-storage-engine.html#innodb-online-ddl-column-properties" title="Column Properties">InnoDB Online DDL Column Properties</a>
              for more information.</td></tr><tr><td scope="row" align="left">Add <a class="link" href="glossary.html#glos_primary_key" title="primary key">primary key</a></td><td align="center">Yes*</td><td align="center">Yes</td><td align="center">Yes</td><td align="center">Yes</td><td align="left">Although <code class="literal">ALGORITHM=INPLACE</code> is allowed, the data is
              reorganized substantially, so it is still an expensive
              operation. <code class="literal">ALGORITHM=INPLACE</code> is not
              allowed under certain conditions if columns have to be
              converted to <code class="literal">NOT NULL</code>. See
              <a class="xref" href="innodb-storage-engine.html#online-ddl-ex-primary-key" title="Example 14.9 Creating and Dropping the Primary Key">Example 14.9, “Creating and Dropping the Primary Key”</a>.</td></tr><tr><td scope="row" align="left">Drop <a class="link" href="glossary.html#glos_primary_key" title="primary key">primary key</a> and add another</td><td align="center">Yes</td><td align="center">Yes</td><td align="center">Yes</td><td align="center">Yes</td><td align="left"><code class="literal">ALGORITHM=INPLACE</code> is only allowed when you add a new
              primary key in the same <a class="link" href="sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE Syntax"><code class="literal">ALTER
              TABLE</code></a>; the data is reorganized substantially, so
              it is still an expensive operation.</td></tr><tr><td scope="row" align="left">Drop <a class="link" href="glossary.html#glos_primary_key" title="primary key">primary key</a></td><td align="center">No</td><td align="center">Yes</td><td align="center">No</td><td align="center">Yes</td><td align="left">Restrictions apply when you drop a primary key primary key without
              adding a new one in the same <code class="literal">ALTER
              TABLE</code> statement.</td></tr><tr><td scope="row" align="left">Convert character set</td><td align="center">No</td><td align="center">Yes</td><td align="center">No</td><td align="center">Yes</td><td align="left">Rebuilds the table if the new character encoding is different.</td></tr><tr><td scope="row" align="left">Specify character set</td><td align="center">No</td><td align="center">Yes</td><td align="center">No</td><td align="center">Yes</td><td align="left">Rebuilds the table if the new character encoding is different.</td></tr><tr><td scope="row" align="left">Rebuild with <code class="literal">FORCE</code> option</td><td align="center">Yes</td><td align="center">Yes</td><td align="center">Yes</td><td align="center">Yes</td><td align="left">Uses <code class="literal">ALGORITHM=INPLACE</code> as of MySQL 5.7.4.
              <code class="literal">ALGORITHM=COPY</code> is used if
              <code class="literal">old_alter_table=1</code> or
              <a class="link" href="programs.html#mysqld" title="4.3.1 mysqld — The MySQL Server"><span class="command"><strong>mysqld</strong></span></a> <code class="literal">--skip-new</code>
              option is enabled. Table rebuild using online DDL
              (<code class="literal">ALGORITHM=INPLACE</code>) is not supported
              for tables with FULLTEXT indexes.</td></tr><tr><td scope="row" align="left">Rebuild with <span class="quote">“<span class="quote">null</span>”</span> <code class="literal">ALTER TABLE ...
              ENGINE=INNODB</code></td><td align="center">Yes</td><td align="center">Yes</td><td align="center">Yes</td><td align="center">Yes</td><td align="left">Uses <code class="literal">ALGORITHM=INPLACE</code> as of MySQL 5.7.4.
              <code class="literal">ALGORITHM=COPY</code> is used if
              <code class="literal">old_alter_table=1</code> or
              <a class="link" href="programs.html#mysqld" title="4.3.1 mysqld — The MySQL Server"><span class="command"><strong>mysqld</strong></span></a> <code class="literal">--skip-new</code>
              option is enabled. Table rebuild using online DDL
              (<code class="literal">ALGORITHM=INPLACE</code>) is not supported
              for tables with FULLTEXT indexes.</td></tr><tr><td scope="row" align="left">Set table-level <a class="link" href="glossary.html#glos_persistent_statistics" title="persistent statistics">persistent
              statistics</a> options
              (<code class="literal">STATS_PERSISTENT</code>,
              <code class="literal">STATS_AUTO_RECALC</code>
<code class="literal">STATS_SAMPLE_PAGES</code>)</td><td align="center">Yes</td><td align="center">No</td><td align="center">Yes</td><td align="center">Yes</td><td align="left">Only modifies table metadata.</td></tr></tbody></table>
</div>

</div>
<br class="table-break"><p>
      The following sections shows the basic syntax, and usage notes
      related to online DDL, for each of the major operations that can
      be performed with concurrent DML, in-place, or both:
</p>
<h4><a name="idm140644111036736"></a>Secondary Indexes</h4>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          Create <a class="link" href="glossary.html#glos_secondary_index" title="secondary index">secondary
          indexes</a>: <code class="literal">CREATE INDEX
          <em class="replaceable"><code>name</code></em> ON
          <em class="replaceable"><code>table</code></em>
          (<em class="replaceable"><code>col_list</code></em>)</code> or
          <code class="literal">ALTER TABLE <em class="replaceable"><code>table</code></em> ADD
          INDEX <em class="replaceable"><code>name</code></em>
          (<em class="replaceable"><code>col_list</code></em>)</code>. (Creating a a
          <code class="literal">FULLTEXT</code> index still requires locking the
          table.)
        </p></li><li class="listitem"><p>
          Drop <a class="link" href="glossary.html#glos_secondary_index" title="secondary index">secondary
          indexes</a>: <code class="literal">DROP INDEX
          <em class="replaceable"><code>name</code></em> ON
          <em class="replaceable"><code>table</code></em>;</code> or <code class="literal">ALTER
          TABLE <em class="replaceable"><code>table</code></em> DROP INDEX
          <em class="replaceable"><code>name</code></em></code>
</p></li></ul>
</div>
<p>
      Creating and dropping secondary indexes on
      <code class="literal">InnoDB</code> tables skips the table-copying behavior,
      the same as in MySQL 5.5 and MySQL 5.1 with the
      <code class="literal">InnoDB</code> Plugin.
    </p><p>
      In MySQL 5.6 and higher, the table remains available for read and
      write operations while the index is being created or dropped. The
      <a class="link" href="sql-syntax.html#create-index" title="13.1.14 CREATE INDEX Syntax"><code class="literal">CREATE INDEX</code></a> or
      <a class="link" href="sql-syntax.html#drop-index" title="13.1.25 DROP INDEX Syntax"><code class="literal">DROP INDEX</code></a> statement only finishes
      after all transactions that are accessing the table are completed,
      so that the initial state of the index reflects the most recent
      contents of the table. Previously, modifying the table while an
      index is being created or dropped typically resulted in a
      <a class="link" href="glossary.html#glos_deadlock" title="deadlock">deadlock</a> that cancelled the
      <a class="link" href="sql-syntax.html#insert" title="13.2.5 INSERT Syntax"><code class="literal">INSERT</code></a>,
      <a class="link" href="sql-syntax.html#update" title="13.2.11 UPDATE Syntax"><code class="literal">UPDATE</code></a>, or
      <a class="link" href="sql-syntax.html#delete" title="13.2.2 DELETE Syntax"><code class="literal">DELETE</code></a> statement on the table.
</p>
<h4><a name="innodb-online-ddl-column-properties"></a>Column Properties</h4>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          Set a default value for a column: <code class="literal">ALTER TABLE
          <em class="replaceable"><code>tbl</code></em> ALTER COLUMN
          <em class="replaceable"><code>col</code></em> SET DEFAULT
          <em class="replaceable"><code>literal</code></em></code> or <code class="literal">ALTER
          TABLE <em class="replaceable"><code>tbl</code></em> ALTER COLUMN
          <em class="replaceable"><code>col</code></em> DROP DEFAULT</code>
        </p><p>
          The default values for columns are stored in the
          <a class="link" href="glossary.html#glos_frm_file" title=".frm file">.frm file</a> for the table,
          not the <code class="literal">InnoDB</code>
          <a class="link" href="glossary.html#glos_data_dictionary" title="data dictionary">data dictionary</a>.
        </p></li><li class="listitem"><p>
          Changing the
          <a class="link" href="glossary.html#glos_auto_increment" title="auto-increment">auto-increment</a>
          value for a column: <code class="literal">ALTER TABLE
          <em class="replaceable"><code>table</code></em>
          AUTO_INCREMENT=<em class="replaceable"><code>next_value</code></em>;</code>
        </p><p>
          Especially in a distributed system using replication or
          sharding, you sometimes reset the auto-increment counter for a
          table to a specific value. The next row inserted into the
          table uses the specified value for its auto-increment column.
          You might also use this technique in a data warehousing
          environment where you periodically empty all the tables and
          reload them, and you can restart the auto-increment sequence
          from 1.
        </p></li><li class="listitem"><p>
          Renaming a column: <code class="literal">ALTER TABLE
          <em class="replaceable"><code>tbl</code></em> CHANGE
          <em class="replaceable"><code>old_col_name</code></em>
          <em class="replaceable"><code>new_col_name</code></em>
          <em class="replaceable"><code>datatype</code></em></code>
        </p><p>
          When you keep the same data type and <code class="literal">[NOT]
          NULL</code> attribute, only changing the column name, this
          operation can always be performed online.
        </p><p>
          You can also rename a column that is part of a foreign key
          constraint. The foreign key definition is automatically
          updated to use the new column name. Renaming a column
          participating in a foreign key only works with the in-place
          mode of <a class="link" href="sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a>. If you use
          the <code class="literal">ALGORITHM=COPY</code> clause, or some other
          condition causes the command to use
          <code class="literal">ALGORITHM=COPY</code> behind the scenes, the
          <code class="literal">ALTER TABLE</code> statement will fail.
        </p></li><li class="listitem"><p>
          Extending <a class="link" href="data-types.html#char" title="11.4.1 The CHAR and VARCHAR Types"><code class="literal">VARCHAR</code></a> size using an
          in-place <a class="link" href="sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a> statement,
          as in this example:
        </p><pre class="programlisting">
ALTER TABLE t1 ALGORITHM=INPLACE, CHANGE COLUMN c1 c1 VARCHAR(255);
</pre><p>
          The number of length bytes required by a
          <a class="link" href="data-types.html#char" title="11.4.1 The CHAR and VARCHAR Types"><code class="literal">VARCHAR</code></a> column must remain the
          same. For <a class="link" href="data-types.html#char" title="11.4.1 The CHAR and VARCHAR Types"><code class="literal">VARCHAR</code></a>
          values of 0 to 255, one length byte is required to encode the
          value. For <a class="link" href="data-types.html#char" title="11.4.1 The CHAR and VARCHAR Types"><code class="literal">VARCHAR</code></a> values of
          256 bytes or more, two length bytes are required. As a result,
          in-place <a class="link" href="sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a> only
          supports increasing <a class="link" href="data-types.html#char" title="11.4.1 The CHAR and VARCHAR Types"><code class="literal">VARCHAR</code></a>
          size from 0 to 255 bytes or increasing
          <a class="link" href="data-types.html#char" title="11.4.1 The CHAR and VARCHAR Types"><code class="literal">VARCHAR</code></a> size from a value equal
          to or greater than 256 bytes. In-place
          <a class="link" href="sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a> does not support
          increasing <a class="link" href="data-types.html#char" title="11.4.1 The CHAR and VARCHAR Types"><code class="literal">VARCHAR</code></a>
          size from less than 256 bytes to a value equal to or greater
          than 256 bytes. In this case, the number of required length
          bytes would change from 1 to 2, which is only supported by a
          table copy (<code class="literal">ALGORITHM=COPY</code>). For example,
          attempting to change <a class="link" href="data-types.html#char" title="11.4.1 The CHAR and VARCHAR Types"><code class="literal">VARCHAR</code></a>
          column size from 255 to 256 using in-place
          <a class="link" href="sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a> would return an
          error:
        </p><pre class="programlisting">
ALTER TABLE t1 ALGORITHM=INPLACE, CHANGE COLUMN c1 c1 VARCHAR(256);
ERROR 0A000: ALGORITHM=INPLACE is not supported. Reason: Cannot change
column type INPLACE. Try ALGORITHM=COPY.
</pre><p>
          Decreasing <a class="link" href="data-types.html#char" title="11.4.1 The CHAR and VARCHAR Types"><code class="literal">VARCHAR</code></a> size using
          in-place <a class="link" href="sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a> is not
          supported. Decreasing <a class="link" href="data-types.html#char" title="11.4.1 The CHAR and VARCHAR Types"><code class="literal">VARCHAR</code></a>
          size requires a table copy
          (<code class="literal">ALGORITHM=COPY</code>).
</p></li></ul>
</div>
<h4><a name="idm140644110969504"></a>Foreign Keys</h4>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          Adding or dropping a
          <a class="link" href="glossary.html#glos_foreign_key_constraint" title="FOREIGN KEY constraint">foreign key
          constraint</a>:
        </p><pre class="programlisting">
ALTER TABLE <em class="replaceable"><code>tbl1</code></em> ADD CONSTRAINT <em class="replaceable"><code>fk_name</code></em> FOREIGN KEY <em class="replaceable"><code>index</code></em> (<em class="replaceable"><code>col1</code></em>) REFERENCES <em class="replaceable"><code>tbl2</code></em>(<em class="replaceable"><code>col2</code></em>) <em class="replaceable"><code>referential_actions</code></em>;
ALTER TABLE <em class="replaceable"><code>tbl</code></em> DROP FOREIGN KEY <em class="replaceable"><code>fk_name</code></em>;
</pre><p>
          Dropping a foreign key can be performed online with the
          <a class="link" href="server-administration.html#sysvar_foreign_key_checks"><code class="literal">foreign_key_checks</code></a> option
          enabled or disabled. Creating a foreign key online requires
          <a class="link" href="server-administration.html#sysvar_foreign_key_checks"><code class="literal">foreign_key_checks</code></a> to be
          disabled.
        </p><p>
          If you do not know the names of the foreign key constraints on
          a particular table, issue the following statement and find the
          constraint name in the <code class="literal">CONSTRAINT</code> clause
          for each foreign key:
        </p><pre class="programlisting">
show create table <em class="replaceable"><code>table</code></em>\G
</pre><p>
          Or, query the
          <a class="link" href="information-schema.html#table-constraints-table" title="21.26 The INFORMATION_SCHEMA TABLE_CONSTRAINTS Table"><code class="literal">information_schema.table_constraints</code></a>
          table and use the <code class="literal">constraint_name</code> and
          <code class="literal">constraint_type</code> columns to identify the
          foreign key names.
        </p><p>
          You can also drop a foreign key and its associated index in a
          single statement:
        </p><pre class="programlisting">
ALTER TABLE <em class="replaceable"><code>table</code></em> DROP FOREIGN KEY <em class="replaceable"><code>constraint</code></em>, DROP INDEX <em class="replaceable"><code>index</code></em>;
</pre></li></ul>
</div>
<p>
      If <a class="link" href="glossary.html#glos_foreign_key" title="foreign key">foreign keys</a> are
      already present in the table being altered (that is, it is a
      <a class="link" href="glossary.html#glos_child_table" title="child table">child table</a> containing any
      <code class="literal">FOREIGN KEY ... REFERENCE</code> clauses), additional
      restrictions apply to online DDL operations, even those not
      directly involving the foreign key columns:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          Concurrent DML is disallowed during online DDL operations on
          such child tables. (This restriction is being evaluated as a
          bug and might be lifted.)
        </p></li><li class="listitem"><p>
          An <a class="link" href="sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a> on the child
          table could also wait for another transaction to commit, if a
          change to the parent table caused associated changes in the
          child table through an <code class="literal">ON UPDATE</code> or
          <code class="literal">ON DELETE</code> clause using the
          <code class="literal">CASCADE</code> or <code class="literal">SET NULL</code>
          parameters.
</p></li></ul>
</div>
<p>
      In the same way, if a table is the
      <a class="link" href="glossary.html#glos_parent_table" title="parent table">parent table</a> in a foreign
      key relationship, even though it does not contain any
      <code class="literal">FOREIGN KEY</code> clauses, it could wait for the
      <a class="link" href="sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a> to complete if an
      <a class="link" href="sql-syntax.html#insert" title="13.2.5 INSERT Syntax"><code class="literal">INSERT</code></a>,
      <a class="link" href="sql-syntax.html#update" title="13.2.11 UPDATE Syntax"><code class="literal">UPDATE</code></a>, or
      <a class="link" href="sql-syntax.html#delete" title="13.2.2 DELETE Syntax"><code class="literal">DELETE</code></a> statement caused an
      <code class="literal">ON UPDATE</code> or <code class="literal">ON DELETE</code>
      action in the child table.
</p>
<h4><a name="idm140644110932848"></a>Notes on ALGORITHM=COPY</h4>
<p>
      Any <a class="link" href="sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a> operation run with
      the <code class="literal">ALGORITHM=COPY</code> clause prevents concurrent
      DML operations. Concurrent queries are still allowed. That is, a
      table-copying operation always includes at least the concurrency
      restrictions of <code class="literal">LOCK=SHARED</code> (allow queries but
      not DML). You can further restrict concurrency for such operations
      by specifying <code class="literal">LOCK=EXCLUSIVE</code> (prevent DML and
      queries).
</p>
<h4><a name="idm140644110928048"></a>Concurrent DML but Table Copy Still Required</h4>
<p>
      Some other <a class="link" href="sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a> operations
      allow concurrent DML but still require a table copy. However, the
      table copy for these operations is faster than it was in MySQL 5.5
      and prior.
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          Adding, dropping, or reordering columns.
        </p></li><li class="listitem"><p>
          Adding or dropping a <a class="link" href="glossary.html#glos_primary_key" title="primary key">primary
          key</a>.
        </p></li><li class="listitem"><p>
          Changing the <code class="literal">ROW_FORMAT</code> or
          <code class="literal">KEY_BLOCK_SIZE</code> properties for a table.
        </p></li><li class="listitem"><p>
          Changing the nullable status for a column.
        </p></li><li class="listitem"><p>
          <a class="link" href="sql-syntax.html#optimize-table" title="13.7.2.4 OPTIMIZE TABLE Syntax"><code class="literal">OPTIMIZE TABLE</code></a>
        </p></li><li class="listitem"><p>
          Rebuilding a table with the <code class="literal">FORCE</code> option
        </p></li><li class="listitem"><p>
          Rebuilding a table using a <span class="quote">“<span class="quote">null</span>”</span> <code class="literal">ALTER
          TABLE ... ENGINE=INNODB</code> statement
</p></li></ul>
</div>
<h4><a name="idm140644110914016"></a>Maintaining CREATE TABLE Statements</h4>
<p>
      As your database schema evolves with new columns, data types,
      constraints, indexes, and so on, keep your
      <a class="link" href="sql-syntax.html#create-table" title="13.1.18 CREATE TABLE Syntax"><code class="literal">CREATE TABLE</code></a> statements up to date
      with the latest table definitions. Even with the performance
      improvements of online DDL, it is more efficient to create stable
      database structures at the beginning, rather than creating part of
      the schema and then issuing <a class="link" href="sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE Syntax"><code class="literal">ALTER
      TABLE</code></a> statements afterward.
    </p><p>
      The main exception to this guideline is for
      <a class="link" href="glossary.html#glos_secondary_index" title="secondary index">secondary indexes</a> on
      tables with large numbers of rows. It is typically most efficient
      to create the table with all details specified except the
      secondary indexes, load the data, then create the secondary
      indexes. You can use the same technique with
      <a class="link" href="glossary.html#glos_foreign_key" title="foreign key">foreign keys</a> (load the
      data first, then set up the foreign keys) if you know the initial
      data is clean and do not need consistency checks during the
      loading process.
    </p><p>
      Whatever sequence of <a class="link" href="sql-syntax.html#create-table" title="13.1.18 CREATE TABLE Syntax"><code class="literal">CREATE TABLE</code></a>,
      <a class="link" href="sql-syntax.html#create-index" title="13.1.14 CREATE INDEX Syntax"><code class="literal">CREATE INDEX</code></a>,
      <a class="link" href="sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a>, and similar statements
      went into putting a table together, you can capture the SQL needed
      to reconstruct the current form of the table by issuing the
      statement <code class="literal">SHOW CREATE TABLE
      <em class="replaceable"><code>table</code></em>\G</code> (uppercase
      <code class="literal">\G</code> required for tidy formatting). This output
      shows clauses such as numeric precision, <code class="literal">NOT
      NULL</code>, and <code class="literal">CHARACTER SET</code> that are
      sometimes added behind the scenes, and you might otherwise leave
      out when cloning the table on a new system or setting up foreign
      key columns with identical type.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="innodb-create-index-concurrency"></a>14.10.2 Performance and Concurrency Considerations for Online DDL</h3>

</div>

</div>

</div>
<a class="indexterm" name="idm140644110898272"></a><p>
      <a class="link" href="glossary.html#glos_online_ddl" title="online DDL">Online DDL</a> improves several
      aspects of MySQL operation, such as performance, concurrency,
      availability, and scalability:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          Because queries and <a class="link" href="glossary.html#glos_dml" title="DML">DML</a>
          operations on the table can proceed while the DDL is in
          progress, applications that access the table are more
          responsive. Reduced
          <a class="link" href="glossary.html#glos_locking" title="locking">locking</a> and waiting for
          other resources all throughout the MySQL server leads to
          greater scalability, even for operations not involving the
          table being altered.
        </p></li><li class="listitem"><p>
          For in-place operations, by avoiding the disk I/O and CPU
          cycles to rebuild the table, you minimize the overall load on
          the database and maintain good performance and high throughput
          during the DDL operation.
        </p></li><li class="listitem"><p>
          For in-place operations, because less data is read into the
          <a class="link" href="glossary.html#glos_buffer_pool" title="buffer pool">buffer pool</a> than if
          all the data was copied, you avoid purging frequently accessed
          data from memory, which formerly could cause a temporary
          performance dip after a DDL operation.
</p></li></ul>
</div>
<p>
      If an online operation requires temporary files,
      <code class="literal">InnoDB</code> creates them in the temporary file
      directory, not the directory containing the original table. If
      this directory is not large enough to hold such files, you may
      need to set the <a class="link" href="server-administration.html#sysvar_tmpdir"><code class="literal">tmpdir</code></a> system
      variable to a different directory. (See
      <a class="xref" href="error-handling.html#temporary-files" title="B.5.3.5 Where MySQL Stores Temporary Files">Section B.5.3.5, “Where MySQL Stores Temporary Files”</a>.)
</p>
<h4><a name="idm140644110886096"></a>Locking Options for Online DDL</h4>
<p>
      While an InnoDB table is being changed by a DDL operation, the
      table may or may not be
      <a class="link" href="glossary.html#glos_locking" title="locking">locked</a>, depending on the
      internal workings of that operation and the
      <code class="literal">LOCK</code> clause of the <a class="link" href="sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE Syntax"><code class="literal">ALTER
      TABLE</code></a> statement. By default, MySQL uses as little
      locking as possible during a DDL operation; you specify the clause
      either to make the locking more restrictive than it normally would
      be (thus limiting concurrent DML, or DML and queries), or to
      ensure that some expected degree of locking is allowed for an
      operation. If the <code class="literal">LOCK</code> clause specifies a level
      of locking that is not available for that specific kind of DDL
      operation, such as <code class="literal">LOCK=SHARED</code> or
      <code class="literal">LOCK=NONE</code> while creating or dropping a primary
      key, the clause works like an assertion, causing the statement to
      fail with an error. The following list shows the different
      possibilities for the <code class="literal">LOCK</code> clause, from the
      most permissive to the most restrictive:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          For DDL operations with <code class="literal">LOCK=NONE</code>, both
          queries and concurrent DML are allowed. This clause makes the
          <a class="link" href="sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a> fail if the kind of
          DDL operation cannot be performed with the requested type of
          locking, so specify <code class="literal">LOCK=NONE</code> if keeping
          the table fully available is vital and it is OK to cancel the
          DDL if that is not possible. For example, you might use this
          clause in DDLs for tables involving customer signups or
          purchases, to avoid making those tables unavailable by
          mistakenly issuing an expensive <a class="link" href="sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE Syntax"><code class="literal">ALTER
          TABLE</code></a> statement.
        </p></li><li class="listitem"><p>
          For DDL operations with <code class="literal">LOCK=SHARED</code>, any
          writes to the table (that is, DML operations) are blocked, but
          the data in the table can be read. This clause makes the
          <a class="link" href="sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a> fail if the kind of
          DDL operation cannot be performed with the requested type of
          locking, so specify <code class="literal">LOCK=SHARED</code> if keeping
          the table available for queries is vital and it is OK to
          cancel the DDL if that is not possible. For example, you might
          use this clause in DDLs for tables in a data warehouse, where
          it is OK to delay data load operations until the DDL is
          finished, but queries cannot be delayed for long periods.
        </p></li><li class="listitem"><p>
          For DDL operations with <code class="literal">LOCK=DEFAULT</code>, or
          with the <code class="literal">LOCK</code> clause omitted, MySQL uses
          the lowest level of locking that is available for that kind of
          operation, allowing concurrent queries, DML, or both wherever
          possible. This is the setting to use when making pre-planned,
          pre-tested changes that you know will not cause any
          availability problems based on the workload for that table.
        </p></li><li class="listitem"><p>
          For DDL operations with <code class="literal">LOCK=EXCLUSIVE</code>,
          both queries and DML operations are blocked. This clause makes
          the <a class="link" href="sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a> fail if the
          kind of DDL operation cannot be performed with the requested
          type of locking, so specify <code class="literal">LOCK=EXCLUSIVE</code>
          if the primary concern is finishing the DDL in the shortest
          time possible, and it is OK to make applications wait when
          they try to access the table. You might also use
          <code class="literal">LOCK=EXCLUSIVE</code> if the server is supposed to
          be idle, to avoid unexpected accesses to the table.
</p></li></ul>
</div>
<p>
      An online DDL statement for an InnoDB table always waits for
      currently executing transactions that are accessing the table to
      <a class="link" href="glossary.html#glos_commit" title="commit">commit</a> or
      <a class="link" href="glossary.html#glos_rollback" title="rollback">roll back</a>, because it
      requires exclusive access to the table for a brief period while
      the DDL statement is being prepared. Likewise, it requires
      exclusive access to the table for a brief time before finishing.
      Thus, an online DDL statement waits for any transactions that are
      started while the DDL is in progress, and query or modify the
      table, to commit or roll back before the DDL completes.
    </p><p>
      Because there is some processing work involved with recording the
      changes made by concurrent DML operations, then applying those
      changes at the end, an online DDL operation could take longer
      overall than the old-style mechanism that blocks table access from
      other sessions. The reduction in raw performance is balanced
      against better responsiveness for applications that use the table.
      When evaluating the ideal techniques for changing table structure,
      consider end-user perception of performance, based on factors such
      as load times for web pages.
    </p><p>
      A newly created InnoDB secondary index contains only the committed
      data in the table at the time the <a class="link" href="sql-syntax.html#create-index" title="13.1.14 CREATE INDEX Syntax"><code class="literal">CREATE
      INDEX</code></a> or <a class="link" href="sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a>
      statement finishes executing. It does not contain any uncommitted
      values, old versions of values, or values marked for deletion but
      not yet removed from the old index.
</p>
<h4><a name="idm140644110854224"></a>Performance of In-Place versus Table-Copying DDL Operations</h4>
<p>
      The raw performance of an online DDL operation is largely
      determined by whether the operation is performed in-place, or
      requires copying and rebuilding the entire table. See
      <a class="xref" href="innodb-storage-engine.html#innodb-online-ddl-summary-grid" title="Table 14.8 Summary of Online Status for DDL Operations">Table 14.8, “Summary of Online Status for DDL Operations”</a> to see what kinds
      of operations can be performed in-place, and any requirements for
      avoiding table-copy operations.
    </p><p>
      The performance speedup from in-place DDL applies to operations on
      secondary indexes, not to the primary key index. The rows of an
      InnoDB table are stored in a
      <a class="link" href="glossary.html#glos_clustered_index" title="clustered index">clustered index</a>
      organized based on the <a class="link" href="glossary.html#glos_primary_key" title="primary key">primary
      key</a>, forming what some database systems call an
      <span class="quote">“<span class="quote">index-organized table</span>”</span>. Because the table structure
      is so closely tied to the primary key, redefining the primary key
      still requires copying the data.
    </p><p>
      When an operation on the primary key uses
      <code class="literal">ALGORITHM=INPLACE</code>, even though the data is
      still copied, it is more efficient than using
      <code class="literal">ALGORITHM=COPY</code> because:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          No undo logging or associated redo logging is required for
          <code class="literal">ALGORITHM=INPLACE</code>. These operations add
          overhead to DDL statements that use
          <code class="literal">ALGORITHM=COPY</code>.
        </p></li><li class="listitem"><p>
          The secondary index entries are pre-sorted, and so can be
          loaded in order.
        </p></li><li class="listitem"><p>
          The change buffer is not used, because there are no
          random-access inserts into the secondary indexes.
</p></li></ul>
</div>
<p>
      To judge the relative performance of online DDL operations, you
      can run such operations on a big <code class="literal">InnoDB</code> table
      using current and earlier versions of MySQL. You can also run all
      the performance tests under the latest MySQL version, simulating
      the previous DDL behavior for the <span class="quote">“<span class="quote">before</span>”</span> results,
      by setting the <a class="link" href="server-administration.html#sysvar_old_alter_table"><code class="literal">old_alter_table</code></a>
      system variable. Issue the statement <code class="literal">set
      old_alter_table=1</code> in the session, and measure DDL
      performance to record the <span class="quote">“<span class="quote">before</span>”</span> figures. Then
      <code class="literal">set old_alter_table=0</code> to re-enable the newer,
      faster behavior, and run the DDL operations again to record the
      <span class="quote">“<span class="quote">after</span>”</span> figures.
    </p><p>
      For a basic idea of whether a DDL operation does its changes
      in-place or performs a table copy, look at the <span class="quote">“<span class="quote">rows
      affected</span>”</span> value displayed after the command finishes. For
      example, here are lines you might see after doing different types
      of DDL operations:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          Changing the default value of a column (super-fast, does not
          affect the table data at all):
        </p><pre class="programlisting">
Query OK, 0 rows affected (0.07 sec)
</pre></li><li class="listitem"><p>
          Adding an index (takes time, but <code class="literal">0 rows
          affected</code> shows that the table is not copied):
        </p><pre class="programlisting">
Query OK, 0 rows affected (21.42 sec)
</pre></li><li class="listitem"><p>
          Changing the data type of a column (takes substantial time and
          does require rebuilding all the rows of the table):
        </p><pre class="programlisting">
Query OK, 1671168 rows affected (1 min 35.54 sec)
</pre>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
            Changing the data type of a column requires rebuilding all
            the rows of the table with the exception of changing
            <a class="link" href="data-types.html#char" title="11.4.1 The CHAR and VARCHAR Types"><code class="literal">VARCHAR</code></a> size, which may be
            performed using online <a class="link" href="sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE Syntax"><code class="literal">ALTER
            TABLE</code></a>. See
            <a class="xref" href="innodb-storage-engine.html#innodb-online-ddl-column-properties" title="Column Properties">InnoDB Online DDL Column Properties</a> for
            more information.
</p>
</div>
</li></ul>
</div>
<p>
      For example, before running a DDL operation on a big table, you
      might check whether the operation will be fast or slow as follows:
</p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p>
          Clone the table structure.
        </p></li><li class="listitem"><p>
          Populate the cloned table with a tiny amount of data.
        </p></li><li class="listitem"><p>
          Run the DDL operation on the cloned table.
        </p></li><li class="listitem"><p>
          Check whether the <span class="quote">“<span class="quote">rows affected</span>”</span> value is zero
          or not. A non-zero value means the operation will require
          rebuilding the entire table, which might require special
          planning. For example, you might do the DDL operation during a
          period of scheduled downtime, or on each replication slave
          server one at a time.
</p></li></ol>
</div>
<p>
      For a deeper understanding of the reduction in MySQL processing,
      examine the <code class="literal">performance_schema</code> and
      <code class="literal">INFORMATION_SCHEMA</code> tables related to
      <code class="literal">InnoDB</code> before and after DDL operations, to see
      the number of physical reads, writes, memory allocations, and so
      on.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="innodb-online-ddl-syntax"></a>14.10.3 SQL Syntax for Online DDL</h3>

</div>

</div>

</div>
<p>
      Typically, you do not need to do anything special to enable
      <a class="link" href="glossary.html#glos_online_ddl" title="online DDL">online DDL</a> when using the
      <a class="link" href="sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a> statement for
      <code class="literal">InnoDB</code> tables. See
      <a class="xref" href="innodb-storage-engine.html#innodb-online-ddl-summary-grid" title="Table 14.8 Summary of Online Status for DDL Operations">Table 14.8, “Summary of Online Status for DDL Operations”</a> for the kinds of
      DDL operations that can be performed in-place, allowing concurrent
      DML, or both. Some variations require particular combinations of
      configuration settings or <a class="link" href="sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE Syntax"><code class="literal">ALTER
      TABLE</code></a> clauses.
    </p><p>
      You can control the various aspects of a particular online DDL
      operation by using the <code class="literal">LOCK</code> and
      <code class="literal">ALGORITHM</code> clauses of the
      <a class="link" href="sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a> statement. These
      clauses come at the end of the statement, separated from the table
      and column specifications by commas. The <code class="literal">LOCK</code>
      clause is useful for fine-tuning the degree of concurrent access
      to the table. The <code class="literal">ALGORITHM</code> clause is primarily
      intended for performance comparisons and as a fallback to the
      older table-copying behavior in case you encounter any issues with
      existing DDL code. For example:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          To avoid accidentally making the table unavailable for reads,
          writes, or both, specify a clause on the
          <a class="link" href="sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a> statement such as
          <code class="literal">LOCK=NONE</code> (allow both reads and writes) or
          <code class="literal">LOCK=SHARED</code> (allow reads). The operation
          halts immediately if the requested level of concurrency is not
          available.
        </p></li><li class="listitem"><p>
          To compare performance, run one statement with
          <code class="literal">ALGORITHM=INPLACE</code> and another with
          <code class="literal">ALGORITHM=COPY</code>, as an alternative to
          setting the <a class="link" href="server-administration.html#sysvar_old_alter_table"><code class="literal">old_alter_table</code></a>
          configuration option.
        </p></li><li class="listitem"><p>
          To avoid tying up the server with an
          <a class="link" href="sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a> operation that
          copies the table, include
          <code class="literal">ALGORITHM=INPLACE</code>. The statement halts
          immediately if it cannot use the in-place mechanism. See
          <a class="xref" href="innodb-storage-engine.html#innodb-online-ddl-summary-grid" title="Table 14.8 Summary of Online Status for DDL Operations">Table 14.8, “Summary of Online Status for DDL Operations”</a> for a list of
          the DDL operations that can or cannot be performed in-place.
</p></li></ul>
</div>
<p>
      See <a class="xref" href="innodb-storage-engine.html#innodb-create-index-concurrency" title="14.10.2 Performance and Concurrency Considerations for Online DDL">Section 14.10.2, “Performance and Concurrency Considerations for Online DDL”</a> for more
      details about the <code class="literal">LOCK</code> clause. For full
      examples of using online DDL, see
      <a class="xref" href="innodb-storage-engine.html#innodb-create-index-examples" title="14.10.5 Examples of Online DDL">Section 14.10.5, “Examples of Online DDL”</a>.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="innodb-online-ddl-single-multi"></a>14.10.4 Combining or Separating DDL Statements</h3>

</div>

</div>

</div>
<p>
      Before the introduction of <a class="link" href="glossary.html#glos_online_ddl" title="online DDL">online
      DDL</a>, it was common practice to combine many DDL operations
      into a single <a class="link" href="sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a>
      statement. Because each <a class="link" href="sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a>
      statement involved copying and rebuilding the table, it was more
      efficient to make several changes to the same table at once, since
      those changes could all be done with a single rebuild operation
      for the table. The downside was that SQL code involving DDL
      operations was harder to maintain and to reuse in different
      scripts. If the specific changes were different each time, you
      might have to construct a new complex <a class="link" href="sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE Syntax"><code class="literal">ALTER
      TABLE</code></a> for each slightly different scenario.
    </p><p>
      For DDL operations that can be done in-place, as shown in
      <a class="xref" href="innodb-storage-engine.html#innodb-online-ddl-summary-grid" title="Table 14.8 Summary of Online Status for DDL Operations">Table 14.8, “Summary of Online Status for DDL Operations”</a>, now you can
      separate them into individual <a class="link" href="sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE Syntax"><code class="literal">ALTER
      TABLE</code></a> statements for easier scripting and maintenance,
      without sacrificing efficiency. For example, you might take a
      complicated statement such as:
    </p><pre class="programlisting">
ALTER TABLE t1 ADD INDEX i1(c1), ADD UNIQUE INDEX i2(c2), 
  CHANGE c4_old_name c4_new_name INTEGER UNSIGNED;
</pre><p>
      and break it down into simpler parts that can be tested and
      performed independently, such as:
    </p><pre class="programlisting">
ALTER TABLE t1 ADD INDEX i1(c1);
ALTER TABLE t1 ADD UNIQUE INDEX i2(c2);
ALTER TABLE t1 CHANGE c4_old_name c4_new_name INTEGER UNSIGNED NOT NULL;
</pre><p>
      You might still use multi-part <a class="link" href="sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE Syntax"><code class="literal">ALTER
      TABLE</code></a> statements for:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          Operations that must be performed in a specific sequence, such
          as creating an index followed by a foreign key constraint that
          uses that index.
        </p></li><li class="listitem"><p>
          Operations all using the same specific <code class="literal">LOCK</code>
          clause, that you want to either succeed or fail as a group.
        </p></li><li class="listitem"><p>
          Operations that cannot be performed in-place, that is, that
          still copy and rebuild the table.
        </p></li><li class="listitem"><p>
          Operations for which you specify
          <code class="literal">ALGORITHM=COPY</code> or
          <a class="link" href="server-administration.html#sysvar_old_alter_table"><code class="literal">old_alter_table=1</code></a>, to force
          the table-copying behavior if needed for precise
          backward-compatibility in specialized scenarios.
</p></li></ul>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="innodb-create-index-examples"></a>14.10.5 Examples of Online DDL</h3>

</div>

</div>

</div>
<a class="indexterm" name="idm140644110770112"></a><p>
      Here are code examples showing some operations whose performance,
      concurrency, and scalability are improved by the latest
      <a class="link" href="glossary.html#glos_online_ddl" title="online DDL">online DDL</a> enhancements.
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          <a class="xref" href="innodb-storage-engine.html#online-ddl-ex-setup" title="Example 14.1 Schema Setup Code for Online DDL Experiments">Example 14.1, “Schema Setup Code for Online DDL Experiments”</a> sets up tables named
          <code class="literal">BIG_TABLE</code> and
          <code class="literal">SMALL_TABLE</code> used in the subsequent
          examples.
        </p></li><li class="listitem"><p>
          <a class="xref" href="innodb-storage-engine.html#online-ddl-ex-create-drop-index" title="Example 14.2 Speed and Efficiency of CREATE INDEX and DROP INDEX">Example 14.2, “Speed and Efficiency of CREATE INDEX and DROP INDEX”</a> illustrates
          the performance aspects of creating and dropping indexes.
        </p></li><li class="listitem"><p>
          <a class="xref" href="innodb-storage-engine.html#online-ddl-ex-concurrent-dml" title="Example 14.3 Concurrent DML During CREATE INDEX and DROP INDEX">Example 14.3, “Concurrent DML During CREATE INDEX and DROP INDEX”</a> shows queries
          and DML statements running during a <a class="link" href="sql-syntax.html#drop-index" title="13.1.25 DROP INDEX Syntax"><code class="literal">DROP
          INDEX</code></a> operation.
        </p></li><li class="listitem"><p>
          <a class="xref" href="innodb-storage-engine.html#online-ddl-ex-rename-column" title="Example 14.4 Renaming a Column">Example 14.4, “Renaming a Column”</a> demonstrates the
          speed improvement for renaming a column, and shows the care
          needed to keep the data type precisely the same when doing the
          rename operation.
        </p></li><li class="listitem"><p>
          <a class="xref" href="innodb-storage-engine.html#online-ddl-ex-drop-foreign-key" title="Example 14.5 Dropping Foreign Keys">Example 14.5, “Dropping Foreign Keys”</a> demonstrates
          how foreign keys work with online DDL. Because two tables are
          involved in foreign key operations, there are extra locking
          considerations. Thus, tables with foreign keys sometimes have
          restrictions for online DDL operations.
        </p></li><li class="listitem"><p>
          <a class="xref" href="innodb-storage-engine.html#online-ddl-ex-auto-increment" title="Example 14.6 Changing Auto-Increment Value">Example 14.6, “Changing Auto-Increment Value”</a> demonstrates
          how auto-increment columns work with online DDL. Tables with
          auto-increment columns sometimes have restrictions for online
          DDL operations.
        </p></li><li class="listitem"><p>
          <a class="xref" href="innodb-storage-engine.html#online-ddl-ex-lock-clause" title="Example 14.7 Controlling Concurrency with the LOCK Clause">Example 14.7, “Controlling Concurrency with the LOCK Clause”</a> demonstrates the
          options to permit or restrict concurrent queries and DML
          operations while an online DDL operation is in progress. It
          shows the situations when the DDL statement might wait, or the
          concurrent transaction might wait, or the concurrent
          transaction might cancel a DML statement due to a deadlock
          error.
        </p></li><li class="listitem"><p>
          <a class="xref" href="innodb-storage-engine.html#online-ddl-ex-multi-create-index" title="Example 14.8 Schema Setup Code for Online DDL Experiments">Example 14.8, “Schema Setup Code for Online DDL Experiments”</a>
          demonstrates creating and dropping multiple indexes in a
          single statement, which can be more efficient than using a
          separate statement for each index operation.
        </p></li><li class="listitem"><p>
          <a class="xref" href="innodb-storage-engine.html#online-ddl-ex-primary-key" title="Example 14.9 Creating and Dropping the Primary Key">Example 14.9, “Creating and Dropping the Primary Key”</a> demonstrates how
          it is more efficient to define a
          <a class="link" href="glossary.html#glos_primary_key" title="primary key">primary key</a> when
          creating the table, and relatively expensive to add one later.
</p></li></ul>
</div>

<div class="example">
<a name="online-ddl-ex-setup"></a><p class="title"><b>Example 14.1 Schema Setup Code for Online DDL Experiments</b></p>
<div class="example-contents">
<p>
        Here is the code that sets up the initial tables used in these
        demonstrations:
      </p><a name="online-ddl-setup"></a><pre class="programlisting">
/* 
Setup code for the online DDL demonstration:
- Set up some config variables.
- Create 2 tables that are clones of one of the INFORMATION_SCHEMA tables
  that always has some data. The "small" table has a couple of thousand rows.
  For the "big" table, keep doubling the data until it reaches over a million rows.
- Set up a primary key for the sample tables, since we are demonstrating InnoDB aspects.
*/ 

set autocommit = 0;
set foreign_key_checks = 1;
set global innodb_file_per_table = 1;
set old_alter_table=0;
prompt mysql: 

use test;

\! echo "Setting up 'small' table:"
drop table if exists small_table;
create table small_table as select * from information_schema.columns;
alter table small_table add id int unsigned not null primary key auto_increment;
select count(id) from small_table;

\! echo "Setting up 'big' table:"
drop table if exists big_table;
create table big_table as select * from information_schema.columns;
show create table big_table\G

insert into big_table select * from big_table;
insert into big_table select * from big_table;
insert into big_table select * from big_table;
insert into big_table select * from big_table;
insert into big_table select * from big_table;
insert into big_table select * from big_table;
insert into big_table select * from big_table;
insert into big_table select * from big_table;
insert into big_table select * from big_table;
insert into big_table select * from big_table;
commit;

alter table big_table add id int unsigned not null primary key auto_increment;
select count(id) from big_table;
</pre><p>
        Running this code gives this output, condensed for brevity and
        with the most important points bolded:
      </p><pre class="programlisting">
Setting up 'small' table:
Query OK, 0 rows affected (0.01 sec)

Query OK, 1678 rows affected (0.13 sec)
Records: 1678  Duplicates: 0  Warnings: 0

Query OK, 1678 rows affected (0.07 sec)
Records: 1678  Duplicates: 0  Warnings: 0

+-----------+
| count(id) |
+-----------+
|      <span class="bold"><strong>1678</strong></span> |
+-----------+
1 row in set (0.00 sec)

Setting up 'big' table:
Query OK, 0 rows affected (0.16 sec)

Query OK, 1678 rows affected (0.17 sec)
Records: 1678  Duplicates: 0  Warnings: 0

*************************** 1. row ***************************
       Table: big_table
Create Table: CREATE TABLE `big_table` (
  `TABLE_CATALOG` varchar(512) CHARACTER SET utf8 NOT NULL DEFAULT '',
  `TABLE_SCHEMA` varchar(64) CHARACTER SET utf8 NOT NULL DEFAULT '',
  `TABLE_NAME` varchar(64) CHARACTER SET utf8 NOT NULL DEFAULT '',
  `COLUMN_NAME` varchar(64) CHARACTER SET utf8 NOT NULL DEFAULT '',
  `ORDINAL_POSITION` bigint(21) unsigned NOT NULL DEFAULT '0',
  `COLUMN_DEFAULT` longtext CHARACTER SET utf8,
  `IS_NULLABLE` varchar(3) CHARACTER SET utf8 NOT NULL DEFAULT '',
  `DATA_TYPE` varchar(64) CHARACTER SET utf8 NOT NULL DEFAULT '',
  `CHARACTER_MAXIMUM_LENGTH` bigint(21) unsigned DEFAULT NULL,
  `CHARACTER_OCTET_LENGTH` bigint(21) unsigned DEFAULT NULL,
  `NUMERIC_PRECISION` bigint(21) unsigned DEFAULT NULL,
  `NUMERIC_SCALE` bigint(21) unsigned DEFAULT NULL,
  `DATETIME_PRECISION` bigint(21) unsigned DEFAULT NULL,
  `CHARACTER_SET_NAME` varchar(32) CHARACTER SET utf8 DEFAULT NULL,
  `COLLATION_NAME` varchar(32) CHARACTER SET utf8 DEFAULT NULL,
  `COLUMN_TYPE` longtext CHARACTER SET utf8 NOT NULL,
  `COLUMN_KEY` varchar(3) CHARACTER SET utf8 NOT NULL DEFAULT '',
  `EXTRA` varchar(30) CHARACTER SET utf8 NOT NULL DEFAULT '',
  `PRIVILEGES` varchar(80) CHARACTER SET utf8 NOT NULL DEFAULT '',
  `COLUMN_COMMENT` varchar(1024) CHARACTER SET utf8 NOT NULL DEFAULT ''
) ENGINE=InnoDB DEFAULT CHARSET=latin1
1 row in set (0.00 sec)

Query OK, 1678 rows affected (0.09 sec)
Records: 1678  Duplicates: 0  Warnings: 0

Query OK, 3356 rows affected (0.07 sec)
Records: 3356  Duplicates: 0  Warnings: 0

Query OK, 6712 rows affected (0.17 sec)
Records: 6712  Duplicates: 0  Warnings: 0

Query OK, 13424 rows affected (0.44 sec)
Records: 13424  Duplicates: 0  Warnings: 0

Query OK, 26848 rows affected (0.63 sec)
Records: 26848  Duplicates: 0  Warnings: 0

Query OK, 53696 rows affected (1.72 sec)
Records: 53696  Duplicates: 0  Warnings: 0

Query OK, 107392 rows affected (3.02 sec)
Records: 107392  Duplicates: 0  Warnings: 0

Query OK, 214784 rows affected (6.28 sec)
Records: 214784  Duplicates: 0  Warnings: 0

Query OK, 429568 rows affected (13.25 sec)
Records: 429568  Duplicates: 0  Warnings: 0

Query OK, 859136 rows affected (28.16 sec)
Records: 859136  Duplicates: 0  Warnings: 0

Query OK, 0 rows affected (0.03 sec)

Query OK, 1718272 rows affected (1 min 9.22 sec)
Records: 1718272  Duplicates: 0  Warnings: 0

+-----------+
| count(id) |
+-----------+
|   <span class="bold"><strong>1718272</strong></span> |
+-----------+
1 row in set (1.75 sec)
</pre>
</div>

</div>
<br class="example-break">
<div class="example">
<a name="online-ddl-ex-create-drop-index"></a><p class="title"><b>Example 14.2 Speed and Efficiency of CREATE INDEX and DROP INDEX</b></p>
<div class="example-contents">
<p>
        Here is a sequence of statements demonstrating the relative
        speed of <a class="link" href="sql-syntax.html#create-index" title="13.1.14 CREATE INDEX Syntax"><code class="literal">CREATE INDEX</code></a> and
        <a class="link" href="sql-syntax.html#drop-index" title="13.1.25 DROP INDEX Syntax"><code class="literal">DROP INDEX</code></a> statements. For a
        small table, the elapsed time is less than a second whether we
        use the fast or slow technique, so we look at the <span class="quote">“<span class="quote">rows
        affected</span>”</span> output to verify which operations can avoid the
        table rebuild. For a large table, the difference in efficiency
        is obvious because skipping the table rebuild saves substantial
        time.
      </p><a name="online-ddl-create_drop_index"></a><pre class="programlisting">
\! clear

\! echo "=== Create and drop index (small table, new/fast technique) ==="
\! echo
\! echo "Data size (kilobytes) before index created: "
\! du -k data/test/small_table.ibd
create index i_dtyp_small on small_table (data_type)<span class="bold"><strong>, algorithm=inplace</strong></span>;
\! echo "Data size after index created: "
\! du -k data/test/small_table.ibd
drop index i_dtyp_small on small_table<span class="bold"><strong>, algorithm=inplace</strong></span>;

-- Compare against the older slower DDL.

\! echo "=== Create and drop index (small table, old/slow technique) ==="
\! echo
\! echo "Data size (kilobytes) before index created: "
\! du -k data/test/small_table.ibd
create index i_dtyp_small on small_table (data_type)<span class="bold"><strong>, algorithm=copy</strong></span>;
\! echo "Data size after index created: "
\! du -k data/test/small_table.ibd
drop index i_dtyp_small on small_table<span class="bold"><strong>, algorithm=copy</strong></span>;

-- In the above example, we examined the "rows affected" number,
-- ideally looking for a zero figure. Let's try again with a larger
-- sample size, where we'll see that the actual time taken can
-- vary significantly.

\! echo "=== Create and drop index (big table, new/fast technique) ==="
\! echo
\! echo "Data size (kilobytes) before index created: "
\! du -k data/test/big_table.ibd
create index i_dtyp_big on big_table (data_type)<span class="bold"><strong>, algorithm=inplace</strong></span>;
\! echo "Data size after index created: "
\! du -k data/test/big_table.ibd
drop index i_dtyp_big on big_table<span class="bold"><strong>, algorithm=inplace</strong></span>;

\! echo "=== Create and drop index (big table, old/slow technique) ==="
\! echo
\! echo "Data size (kilobytes) before index created: "
\! du -k data/test/big_table.ibd
create index i_dtyp_big on big_table (data_type)<span class="bold"><strong>, algorithm=copy</strong></span>;
\! echo "Data size after index created: "
\! du -k data/test/big_table.ibd
drop index i_dtyp_big on big_table<span class="bold"><strong>, algorithm=copy</strong></span>;
</pre><p>
        Running this code gives this output, condensed for brevity and
        with the most important points bolded:
      </p><pre class="programlisting">
Query OK, 0 rows affected (0.00 sec)

=== Create and drop index (small table, new/fast technique) ===

Data size (kilobytes) before index created: 
384  data/test/small_table.ibd
Query OK, <span class="bold"><strong>0 rows affected</strong></span> (0.04 sec)
Records: 0  Duplicates: 0  Warnings: 0

Data size after index created: 
432  data/test/small_table.ibd
Query OK, <span class="bold"><strong>0 rows affected</strong></span> (0.02 sec)
Records: 0  Duplicates: 0  Warnings: 0

Query OK, 0 rows affected (0.00 sec)

=== Create and drop index (small table, old/slow technique) ===

Data size (kilobytes) before index created: 
432  data/test/small_table.ibd
Query OK, <span class="bold"><strong>1678 rows affected</strong></span> (0.12 sec)
Records: 1678  Duplicates: 0  Warnings: 0

Data size after index created: 
448  data/test/small_table.ibd
Query OK, <span class="bold"><strong>1678 rows affected</strong></span> (0.10 sec)
Records: 1678  Duplicates: 0  Warnings: 0

Query OK, 0 rows affected (0.00 sec)

=== Create and drop index (big table, new/fast technique) ===

Data size (kilobytes) before index created: 
315392  data/test/big_table.ibd
Query OK, <span class="bold"><strong>0 rows affected</strong></span> (33.32 sec)
Records: 0  Duplicates: 0  Warnings: 0

Data size after index created: 
335872  data/test/big_table.ibd
Query OK, <span class="bold"><strong>0 rows affected</strong></span> (0.02 sec)
Records: 0  Duplicates: 0  Warnings: 0

Query OK, 0 rows affected (0.00 sec)

=== Create and drop index (big table, old/slow technique) ===

Data size (kilobytes) before index created: 
335872  data/test/big_table.ibd
Query OK, <span class="bold"><strong>1718272 rows affected</strong></span> (1 min 5.01 sec)
Records: 1718272  Duplicates: 0  Warnings: 0

Data size after index created: 
348160  data/test/big_table.ibd
Query OK, <span class="bold"><strong>1718272 rows affected</strong></span> (46.59 sec)
Records: 1718272  Duplicates: 0  Warnings: 0
</pre>
</div>

</div>
<br class="example-break">
<div class="example">
<a name="online-ddl-ex-concurrent-dml"></a><p class="title"><b>Example 14.3 Concurrent DML During CREATE INDEX and DROP INDEX</b></p>
<div class="example-contents">
<p>
        Here are some snippets of code that are run in separate
        <a class="link" href="programs.html#mysql" title="4.5.1 mysql — The MySQL Command-Line Tool"><span class="command"><strong>mysql</strong></span></a> sessions connected to the same
        database, to illustrate DML statements (insert, update, or
        delete) running at the same time as <a class="link" href="sql-syntax.html#create-index" title="13.1.14 CREATE INDEX Syntax"><code class="literal">CREATE
        INDEX</code></a> and <a class="link" href="sql-syntax.html#drop-index" title="13.1.25 DROP INDEX Syntax"><code class="literal">DROP INDEX</code></a>.
      </p><pre class="programlisting">
/*
CREATE INDEX statement to run against a table while 
insert/update/delete statements are modifying the
column being indexed.
*/

-- Run this script in one session, while simultaneously creating and dropping
-- an index on test/big_table.table_name in another session.

use test;
create index i_concurrent on big_table(table_name);
</pre><pre class="programlisting">
/*
DROP INDEX statement to run against a table while
insert/update/delete statements are modifying the
column being indexed.
*/

-- Run this script in one session, while simultaneously creating and dropping
-- an index on test/big_table.table_name in another session.

use test;
drop index i_concurrent on big_table;
</pre><pre class="programlisting">
/*
Some queries and insert/update/delete statements to run against a table
while an index is being created or dropped. Previously, these operations
would have stalled during the index create/drop period and possibly
timed out or deadlocked.
*/

-- Run this script in one session, while simultaneously creating and dropping
-- an index on test/big_table.table_name in another session.

-- In the test instance, that column has about 1.7M rows, with 136 different values.
-- Sample values: COLUMNS (20480), ENGINES (6144), EVENTS (24576), FILES (38912), 
-- TABLES (21504), VIEWS (10240).

set autocommit = 0;
use test;

select distinct character_set_name from big_table where table_name = 'FILES';
delete from big_table where table_name = 'FILES';
select distinct character_set_name from big_table where table_name = 'FILES';

-- I'll issue the final rollback interactively, not via script,
-- the better to control the timing.
-- rollback;
</pre><p>
        Running this code gives this output, condensed for brevity and
        with the most important points bolded:
      </p><pre class="programlisting">
mysql: source concurrent_ddl_create.sql
Database changed
Query OK, <span class="bold"><strong>0 rows affected</strong></span> (1 min 25.15 sec)
Records: 0  Duplicates: 0  Warnings: 0

mysql: source concurrent_ddl_drop.sql
Database changed
Query OK, <span class="bold"><strong>0 rows affected</strong></span> (24.98 sec)
Records: 0  Duplicates: 0  Warnings: 0

mysql: source concurrent_dml.sql
Query OK, 0 rows affected (0.00 sec)

Database changed
+--------------------+
| character_set_name |
+--------------------+
| NULL               |
| utf8               |
+--------------------+
2 rows in set (0.32 sec)

Query OK, <span class="bold"><strong>38912 rows affected</strong></span> (1.84 sec)

Empty set (0.01 sec)

mysql: rollback;
Query OK, 0 rows affected (1.05 sec)
</pre>
</div>

</div>
<br class="example-break">
<div class="example">
<a name="online-ddl-ex-rename-column"></a><p class="title"><b>Example 14.4 Renaming a Column</b></p>
<div class="example-contents">
<p>
        Here is a demonstration of using <a class="link" href="sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE Syntax"><code class="literal">ALTER
        TABLE</code></a> to rename a column. We use the new, fast DDL
        mechanism to change the name, then the old, slow DDL mechanism
        (with <code class="literal">old_alter_table=1</code>) to restore the
        original column name.
      </p><p>
        Notes:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            Because the syntax for renaming a column also involves
            re-specifying the data type, be careful to specify exactly
            the same data type to avoid a costly table rebuild. In this
            case, we checked the output of <code class="literal">show create table
            <em class="replaceable"><code>table</code></em>\G</code> and copied any
            clauses such as <code class="literal">CHARACTER SET</code> and
            <code class="literal">NOT NULL</code> from the original column
            definition.
          </p></li><li class="listitem"><p>
            Again, renaming a column for a small table is fast enough
            that we need to examine the <span class="quote">“<span class="quote">rows affected</span>”</span>
            number to verify that the new DDL mechanism is more
            efficient than the old one. With a big table, the difference
            in elapsed time makes the improvement obvious.
</p></li></ul>
</div>
<a name="online-ddl-rename_column"></a><pre class="programlisting">
/*
Run through a sequence of 'rename column' statements.
Because this operation involves only metadata, not table data,
it is fast for big and small tables, with new or old DDL mechanisms.
*/

\! clear

\! echo "Rename column (fast technique, small table):"
alter table small_table change `IS_NULLABLE` `NULLABLE` varchar(3) character 
  set utf8 not null<span class="bold"><strong>, algorithm=inplace</strong></span>;
\! echo "Rename back to original name (slow technique):"
alter table small_table change `NULLABLE` `IS_NULLABLE` varchar(3) character 
  set utf8 not null<span class="bold"><strong>, algorithm=copy</strong></span>;


\! echo "Rename column (fast technique, big table):"
alter table big_table change `IS_NULLABLE` `NULLABLE` varchar(3) character 
  set utf8 not null<span class="bold"><strong>, algorithm=inplace</strong></span>;
\! echo "Rename back to original name (slow technique):"
alter table big_table change `NULLABLE` `IS_NULLABLE` varchar(3) character 
  set utf8 not null<span class="bold"><strong>, algorithm=copy</strong></span>;
</pre><p>
        Running this code gives this output, condensed for brevity and
        with the most important points bolded:
      </p><pre class="programlisting">
Rename column (fast technique, small table):
Query OK, 0 rows affected (0.05 sec)

Query OK, <span class="bold"><strong>0 rows affected</strong></span> (0.13 sec)
Records: 0  Duplicates: 0  Warnings: 0

Rename back to original name (slow technique):
Query OK, 0 rows affected (0.00 sec)

Query OK, <span class="bold"><strong>1678 rows affected</strong></span> (0.35 sec)
Records: 1678  Duplicates: 0  Warnings: 0

Rename column (fast technique, big table):
Query OK, 0 rows affected (0.00 sec)

Query OK, 0 <span class="bold"><strong>rows affected</strong></span> (0.11 sec)
Records: 0  Duplicates: 0  Warnings: 0

Rename back to original name (slow technique):
Query OK, 0 rows affected (0.00 sec)

Query OK, <span class="bold"><strong>1718272 rows affected</strong></span> (1 min 0.00 sec)
Records: 1718272  Duplicates: 0  Warnings: 0

Query OK, 0 rows affected (0.00 sec)
</pre>
</div>

</div>
<br class="example-break">
<div class="example">
<a name="online-ddl-ex-drop-foreign-key"></a><p class="title"><b>Example 14.5 Dropping Foreign Keys</b></p>
<div class="example-contents">
<p>
        Here is a demonstration of foreign keys, including improvement
        to the speed of dropping a foreign key constraint.
      </p><a name="online-ddl-foreign_key"></a><pre class="programlisting">
/*
Demonstrate aspects of foreign keys that are or aren't affected by the DDL improvements.
- Create a new table with only a few values to serve as the parent table.
- Set up the 'small' and 'big' tables as child tables using a foreign key.
- Verify that the ON DELETE CASCADE clause makes changes ripple from parent to child tables.
- Drop the foreign key constraints, and optionally associated indexes. (This is the operation that is sped up.)
*/

\! clear

-- Make sure foreign keys are being enforced, and allow
-- rollback after doing some DELETEs that affect both
-- parent and child tables.
set foreign_key_checks = 1;
set autocommit = 0;

-- Create a parent table, containing values that we know are already present
-- in the child tables.
drop table if exists schema_names;
create table schema_names (id int unsigned not null primary key auto_increment, schema_name 
  varchar(64) character set utf8 not null, index i_schema (schema_name)) as select distinct 
  table_schema schema_name from small_table;

show create table schema_names\G
show create table small_table\G
show create table big_table\G

-- Creating the foreign key constraint still involves a table rebuild when foreign_key_checks=1,
-- as illustrated by the "rows affected" figure.
alter table small_table add constraint small_fk foreign key i_table_schema (table_schema) 
  references schema_names(schema_name) on delete cascade;
alter table big_table add constraint big_fk foreign key i_table_schema (table_schema) 
  references schema_names(schema_name) on delete cascade;

show create table small_table\G
show create table big_table\G

select schema_name from schema_names order by schema_name;
select count(table_schema) howmany, table_schema from small_table group by table_schema;
select count(table_schema) howmany, table_schema from big_table group by table_schema;

-- big_table is the parent table.
-- schema_names is the parent table.
-- big_table is the child table.
-- (One row in the parent table can have many "children" in the child table.)
-- Changes to the parent table can ripple through to the child table.
-- For example, removing the value 'test' from schema_names.schema_name will
-- result in the removal of 20K or so rows from big_table.

delete from schema_names where schema_name = 'test';

select schema_name from schema_names order by schema_name;
select count(table_schema) howmany, table_schema from small_table group by table_schema;
select count(table_schema) howmany, table_schema from big_table group by table_schema;

-- Because we've turned off autocommit, we can still get back those deleted rows
-- if the DELETE was issued by mistake.
rollback;

select schema_name from schema_names order by schema_name;
select count(table_schema) howmany, table_schema from small_table group by table_schema;
select count(table_schema) howmany, table_schema from big_table group by table_schema;

-- All of the cross-checking between parent and child tables would be
-- deadly slow if there wasn't the requirement for the corresponding
-- columns to be indexed!

-- But we can get rid of the foreign key using a fast operation
-- that doesn't rebuild the table.
-- If we didn't specify a constraint name when setting up the foreign key, we would
-- have to find the auto-generated name such as 'big_table_ibfk_1' in the
-- output from 'show create table'.

-- For the small table, drop the foreign key and the associated index.
-- Having an index on a small table is less critical.

\! echo "DROP FOREIGN KEY and INDEX from small_table:"
alter table small_table drop foreign key small_fk, drop index small_fk;

-- For the big table, drop the foreign key and leave the associated index.
-- If we are still doing queries that reference the indexed column, the index is
-- very important to avoid a full table scan of the big table.
\! echo "DROP FOREIGN KEY from big_table:"
alter table big_table drop foreign key big_fk;


show create table small_table\G
show create table big_table\G
</pre><p>
        Running this code gives this output, condensed for brevity and
        with the most important points bolded:
      </p><pre class="programlisting">
Query OK, 0 rows affected (0.00 sec)

Query OK, 0 rows affected (0.00 sec)

Query OK, 0 rows affected (0.01 sec)

Query OK, 4 rows affected (0.03 sec)
Records: 4  Duplicates: 0  Warnings: 0

*************************** 1. row ***************************
       Table: schema_names
Create Table: CREATE TABLE `schema_names` (
  `id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `schema_name` varchar(64) CHARACTER SET utf8 NOT NULL,
  PRIMARY KEY (`id`),
  KEY `i_schema` (`schema_name`)
) ENGINE=InnoDB AUTO_INCREMENT=8 DEFAULT CHARSET=latin1
1 row in set (0.00 sec)

*************************** 1. row ***************************
       Table: small_table
Create Table: CREATE TABLE `small_table` (
  `TABLE_CATALOG` varchar(512) CHARACTER SET utf8 NOT NULL DEFAULT '',
  `TABLE_SCHEMA` varchar(64) CHARACTER SET utf8 NOT NULL DEFAULT '',
  `TABLE_NAME` varchar(64) CHARACTER SET utf8 NOT NULL DEFAULT '',
  `COLUMN_NAME` varchar(64) CHARACTER SET utf8 NOT NULL DEFAULT '',
  `ORDINAL_POSITION` bigint(21) unsigned NOT NULL DEFAULT '0',
  `COLUMN_DEFAULT` longtext CHARACTER SET utf8,
  `IS_NULLABLE` varchar(3) CHARACTER SET utf8 NOT NULL,
  `DATA_TYPE` varchar(64) CHARACTER SET utf8 NOT NULL DEFAULT '',
  `CHARACTER_MAXIMUM_LENGTH` bigint(21) unsigned DEFAULT NULL,
  `CHARACTER_OCTET_LENGTH` bigint(21) unsigned DEFAULT NULL,
  `NUMERIC_PRECISION` bigint(21) unsigned DEFAULT NULL,
  `NUMERIC_SCALE` bigint(21) unsigned DEFAULT NULL,
  `DATETIME_PRECISION` bigint(21) unsigned DEFAULT NULL,
  `CHARACTER_SET_NAME` varchar(32) CHARACTER SET utf8 DEFAULT NULL,
  `COLLATION_NAME` varchar(32) CHARACTER SET utf8 DEFAULT NULL,
  `COLUMN_TYPE` longtext CHARACTER SET utf8 NOT NULL,
  `COLUMN_KEY` varchar(3) CHARACTER SET utf8 NOT NULL DEFAULT '',
  `EXTRA` varchar(30) CHARACTER SET utf8 NOT NULL DEFAULT '',
  `PRIVILEGES` varchar(80) CHARACTER SET utf8 NOT NULL DEFAULT '',
  `COLUMN_COMMENT` varchar(1024) CHARACTER SET utf8 NOT NULL DEFAULT '',
  `id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=1679 DEFAULT CHARSET=latin1
1 row in set (0.00 sec)

*************************** 1. row ***************************
       Table: big_table
Create Table: CREATE TABLE `big_table` (
  `TABLE_CATALOG` varchar(512) CHARACTER SET utf8 NOT NULL DEFAULT '',
  `TABLE_SCHEMA` varchar(64) CHARACTER SET utf8 NOT NULL DEFAULT '',
  `TABLE_NAME` varchar(64) CHARACTER SET utf8 NOT NULL DEFAULT '',
  `COLUMN_NAME` varchar(64) CHARACTER SET utf8 NOT NULL DEFAULT '',
  `ORDINAL_POSITION` bigint(21) unsigned NOT NULL DEFAULT '0',
  `COLUMN_DEFAULT` longtext CHARACTER SET utf8,
  `IS_NULLABLE` varchar(3) CHARACTER SET utf8 NOT NULL,
  `DATA_TYPE` varchar(64) CHARACTER SET utf8 NOT NULL DEFAULT '',
  `CHARACTER_MAXIMUM_LENGTH` bigint(21) unsigned DEFAULT NULL,
  `CHARACTER_OCTET_LENGTH` bigint(21) unsigned DEFAULT NULL,
  `NUMERIC_PRECISION` bigint(21) unsigned DEFAULT NULL,
  `NUMERIC_SCALE` bigint(21) unsigned DEFAULT NULL,
  `DATETIME_PRECISION` bigint(21) unsigned DEFAULT NULL,
  `CHARACTER_SET_NAME` varchar(32) CHARACTER SET utf8 DEFAULT NULL,
  `COLLATION_NAME` varchar(32) CHARACTER SET utf8 DEFAULT NULL,
  `COLUMN_TYPE` longtext CHARACTER SET utf8 NOT NULL,
  `COLUMN_KEY` varchar(3) CHARACTER SET utf8 NOT NULL DEFAULT '',
  `EXTRA` varchar(30) CHARACTER SET utf8 NOT NULL DEFAULT '',
  `PRIVILEGES` varchar(80) CHARACTER SET utf8 NOT NULL DEFAULT '',
  `COLUMN_COMMENT` varchar(1024) CHARACTER SET utf8 NOT NULL DEFAULT '',
  `id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  PRIMARY KEY (`id`),
  <span class="bold"><strong>KEY `big_fk` (`TABLE_SCHEMA`)</strong></span> 
) ENGINE=InnoDB AUTO_INCREMENT=1718273 DEFAULT CHARSET=latin1
1 row in set (0.00 sec)

Query OK, 1678 rows affected (0.10 sec)
Records: 1678  Duplicates: 0  Warnings: 0

Query OK, 1718272 rows affected (1 min 14.54 sec)
Records: 1718272  Duplicates: 0  Warnings: 0

*************************** 1. row ***************************
       Table: small_table
Create Table: CREATE TABLE `small_table` (
  `TABLE_CATALOG` varchar(512) CHARACTER SET utf8 NOT NULL DEFAULT '',
  `TABLE_SCHEMA` varchar(64) CHARACTER SET utf8 NOT NULL DEFAULT '',
  `TABLE_NAME` varchar(64) CHARACTER SET utf8 NOT NULL DEFAULT '',
  `COLUMN_NAME` varchar(64) CHARACTER SET utf8 NOT NULL DEFAULT '',
  `ORDINAL_POSITION` bigint(21) unsigned NOT NULL DEFAULT '0',
  `COLUMN_DEFAULT` longtext CHARACTER SET utf8,
  `IS_NULLABLE` varchar(3) CHARACTER SET utf8 NOT NULL,
  `DATA_TYPE` varchar(64) CHARACTER SET utf8 NOT NULL DEFAULT '',
  `CHARACTER_MAXIMUM_LENGTH` bigint(21) unsigned DEFAULT NULL,
  `CHARACTER_OCTET_LENGTH` bigint(21) unsigned DEFAULT NULL,
  `NUMERIC_PRECISION` bigint(21) unsigned DEFAULT NULL,
  `NUMERIC_SCALE` bigint(21) unsigned DEFAULT NULL,
  `DATETIME_PRECISION` bigint(21) unsigned DEFAULT NULL,
  `CHARACTER_SET_NAME` varchar(32) CHARACTER SET utf8 DEFAULT NULL,
  `COLLATION_NAME` varchar(32) CHARACTER SET utf8 DEFAULT NULL,
  `COLUMN_TYPE` longtext CHARACTER SET utf8 NOT NULL,
  `COLUMN_KEY` varchar(3) CHARACTER SET utf8 NOT NULL DEFAULT '',
  `EXTRA` varchar(30) CHARACTER SET utf8 NOT NULL DEFAULT '',
  `PRIVILEGES` varchar(80) CHARACTER SET utf8 NOT NULL DEFAULT '',
  `COLUMN_COMMENT` varchar(1024) CHARACTER SET utf8 NOT NULL DEFAULT '',
  `id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  PRIMARY KEY (`id`),
  <span class="bold"><strong>KEY `small_fk` (`TABLE_SCHEMA`),</strong></span> 
  <span class="bold"><strong>CONSTRAINT `small_fk` FOREIGN KEY (`TABLE_SCHEMA`) 
    REFERENCES `schema_names` (`schema_name`) ON DELETE CASCADE</strong></span> 
) ENGINE=InnoDB AUTO_INCREMENT=1679 DEFAULT CHARSET=latin1
1 row in set (0.12 sec)

*************************** 1. row ***************************
       Table: big_table
Create Table: CREATE TABLE `big_table` (
  `TABLE_CATALOG` varchar(512) CHARACTER SET utf8 NOT NULL DEFAULT '',
  `TABLE_SCHEMA` varchar(64) CHARACTER SET utf8 NOT NULL DEFAULT '',
  `TABLE_NAME` varchar(64) CHARACTER SET utf8 NOT NULL DEFAULT '',
  `COLUMN_NAME` varchar(64) CHARACTER SET utf8 NOT NULL DEFAULT '',
  `ORDINAL_POSITION` bigint(21) unsigned NOT NULL DEFAULT '0',
  `COLUMN_DEFAULT` longtext CHARACTER SET utf8,
  `IS_NULLABLE` varchar(3) CHARACTER SET utf8 NOT NULL,
  `DATA_TYPE` varchar(64) CHARACTER SET utf8 NOT NULL DEFAULT '',
  `CHARACTER_MAXIMUM_LENGTH` bigint(21) unsigned DEFAULT NULL,
  `CHARACTER_OCTET_LENGTH` bigint(21) unsigned DEFAULT NULL,
  `NUMERIC_PRECISION` bigint(21) unsigned DEFAULT NULL,
  `NUMERIC_SCALE` bigint(21) unsigned DEFAULT NULL,
  `DATETIME_PRECISION` bigint(21) unsigned DEFAULT NULL,
  `CHARACTER_SET_NAME` varchar(32) CHARACTER SET utf8 DEFAULT NULL,
  `COLLATION_NAME` varchar(32) CHARACTER SET utf8 DEFAULT NULL,
  `COLUMN_TYPE` longtext CHARACTER SET utf8 NOT NULL,
  `COLUMN_KEY` varchar(3) CHARACTER SET utf8 NOT NULL DEFAULT '',
  `EXTRA` varchar(30) CHARACTER SET utf8 NOT NULL DEFAULT '',
  `PRIVILEGES` varchar(80) CHARACTER SET utf8 NOT NULL DEFAULT '',
  `COLUMN_COMMENT` varchar(1024) CHARACTER SET utf8 NOT NULL DEFAULT '',
  `id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  PRIMARY KEY (`id`),
  <span class="bold"><strong>KEY `big_fk` (`TABLE_SCHEMA`),</strong></span> 
  <span class="bold"><strong>CONSTRAINT `big_fk` FOREIGN KEY (`TABLE_SCHEMA`) 
    REFERENCES `schema_names` (`schema_name`) ON DELETE CASCADE</strong></span> 
) ENGINE=InnoDB AUTO_INCREMENT=1718273 DEFAULT CHARSET=latin1
1 row in set (0.01 sec)

+--------------------+
| schema_name        |
+--------------------+
| information_schema |
| mysql              |
| performance_schema |
| test               |
+--------------------+
4 rows in set (0.00 sec)

+---------+--------------------+
| howmany | table_schema       |
+---------+--------------------+
|     563 | information_schema |
|     286 | mysql              |
|     786 | performance_schema |
|      43 | test               |
+---------+--------------------+
4 rows in set (0.01 sec)

+---------+--------------------+
| howmany | table_schema       |
+---------+--------------------+
|  576512 | information_schema |
|  292864 | mysql              |
|  804864 | performance_schema |
|   44032 | test               |
+---------+--------------------+
4 rows in set (2.10 sec)

Query OK, 1 row affected (1.52 sec)

+--------------------+
| schema_name        |
+--------------------+
| information_schema |
| mysql              |
| performance_schema |
+--------------------+
3 rows in set (0.00 sec)

+---------+--------------------+
| howmany | table_schema       |
+---------+--------------------+
|     563 | information_schema |
|     286 | mysql              |
|     786 | performance_schema |
+---------+--------------------+
3 rows in set (0.00 sec)

+---------+--------------------+
| howmany | table_schema       |
+---------+--------------------+
|  576512 | information_schema |
|  292864 | mysql              |
|  804864 | performance_schema |
+---------+--------------------+
3 rows in set (1.74 sec)

Query OK, 0 rows affected (0.60 sec)

+--------------------+
| schema_name        |
+--------------------+
| information_schema |
| mysql              |
| performance_schema |
| test               |
+--------------------+
4 rows in set (0.00 sec)

+---------+--------------------+
| howmany | table_schema       |
+---------+--------------------+
|     563 | information_schema |
|     286 | mysql              |
|     786 | performance_schema |
|      43 | test               |
+---------+--------------------+
4 rows in set (0.01 sec)

+---------+--------------------+
| howmany | table_schema       |
+---------+--------------------+
|  576512 | information_schema |
|  292864 | mysql              |
|  804864 | performance_schema |
|   44032 | test               |
+---------+--------------------+
4 rows in set (1.59 sec)

DROP FOREIGN KEY and INDEX from small_table:
Query OK, <span class="bold"><strong>0 rows affected</strong></span> (0.02 sec)
Records: 0  Duplicates: 0  Warnings: 0

DROP FOREIGN KEY from big_table:
Query OK, <span class="bold"><strong>0 rows affected</strong></span> (0.02 sec)
Records: 0  Duplicates: 0  Warnings: 0

*************************** 1. row ***************************
       Table: small_table
Create Table: CREATE TABLE `small_table` (
  `TABLE_CATALOG` varchar(512) CHARACTER SET utf8 NOT NULL DEFAULT '',
  `TABLE_SCHEMA` varchar(64) CHARACTER SET utf8 NOT NULL DEFAULT '',
  `TABLE_NAME` varchar(64) CHARACTER SET utf8 NOT NULL DEFAULT '',
  `COLUMN_NAME` varchar(64) CHARACTER SET utf8 NOT NULL DEFAULT '',
  `ORDINAL_POSITION` bigint(21) unsigned NOT NULL DEFAULT '0',
  `COLUMN_DEFAULT` longtext CHARACTER SET utf8,
  `IS_NULLABLE` varchar(3) CHARACTER SET utf8 NOT NULL,
  `DATA_TYPE` varchar(64) CHARACTER SET utf8 NOT NULL DEFAULT '',
  `CHARACTER_MAXIMUM_LENGTH` bigint(21) unsigned DEFAULT NULL,
  `CHARACTER_OCTET_LENGTH` bigint(21) unsigned DEFAULT NULL,
  `NUMERIC_PRECISION` bigint(21) unsigned DEFAULT NULL,
  `NUMERIC_SCALE` bigint(21) unsigned DEFAULT NULL,
  `DATETIME_PRECISION` bigint(21) unsigned DEFAULT NULL,
  `CHARACTER_SET_NAME` varchar(32) CHARACTER SET utf8 DEFAULT NULL,
  `COLLATION_NAME` varchar(32) CHARACTER SET utf8 DEFAULT NULL,
  `COLUMN_TYPE` longtext CHARACTER SET utf8 NOT NULL,
  `COLUMN_KEY` varchar(3) CHARACTER SET utf8 NOT NULL DEFAULT '',
  `EXTRA` varchar(30) CHARACTER SET utf8 NOT NULL DEFAULT '',
  `PRIVILEGES` varchar(80) CHARACTER SET utf8 NOT NULL DEFAULT '',
  `COLUMN_COMMENT` varchar(1024) CHARACTER SET utf8 NOT NULL DEFAULT '',
  `id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=1679 DEFAULT CHARSET=latin1
1 row in set (0.00 sec)

*************************** 1. row ***************************
       Table: big_table
Create Table: CREATE TABLE `big_table` (
  `TABLE_CATALOG` varchar(512) CHARACTER SET utf8 NOT NULL DEFAULT '',
  `TABLE_SCHEMA` varchar(64) CHARACTER SET utf8 NOT NULL DEFAULT '',
  `TABLE_NAME` varchar(64) CHARACTER SET utf8 NOT NULL DEFAULT '',
  `COLUMN_NAME` varchar(64) CHARACTER SET utf8 NOT NULL DEFAULT '',
  `ORDINAL_POSITION` bigint(21) unsigned NOT NULL DEFAULT '0',
  `COLUMN_DEFAULT` longtext CHARACTER SET utf8,
  `IS_NULLABLE` varchar(3) CHARACTER SET utf8 NOT NULL,
  `DATA_TYPE` varchar(64) CHARACTER SET utf8 NOT NULL DEFAULT '',
  `CHARACTER_MAXIMUM_LENGTH` bigint(21) unsigned DEFAULT NULL,
  `CHARACTER_OCTET_LENGTH` bigint(21) unsigned DEFAULT NULL,
  `NUMERIC_PRECISION` bigint(21) unsigned DEFAULT NULL,
  `NUMERIC_SCALE` bigint(21) unsigned DEFAULT NULL,
  `DATETIME_PRECISION` bigint(21) unsigned DEFAULT NULL,
  `CHARACTER_SET_NAME` varchar(32) CHARACTER SET utf8 DEFAULT NULL,
  `COLLATION_NAME` varchar(32) CHARACTER SET utf8 DEFAULT NULL,
  `COLUMN_TYPE` longtext CHARACTER SET utf8 NOT NULL,
  `COLUMN_KEY` varchar(3) CHARACTER SET utf8 NOT NULL DEFAULT '',
  `EXTRA` varchar(30) CHARACTER SET utf8 NOT NULL DEFAULT '',
  `PRIVILEGES` varchar(80) CHARACTER SET utf8 NOT NULL DEFAULT '',
  `COLUMN_COMMENT` varchar(1024) CHARACTER SET utf8 NOT NULL DEFAULT '',
  `id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  PRIMARY KEY (`id`),
  KEY `big_fk` (`TABLE_SCHEMA`)
) ENGINE=InnoDB AUTO_INCREMENT=1718273 DEFAULT CHARSET=latin1
1 row in set (0.00 sec)
</pre>
</div>

</div>
<br class="example-break">
<div class="example">
<a name="online-ddl-ex-auto-increment"></a><p class="title"><b>Example 14.6 Changing Auto-Increment Value</b></p>
<div class="example-contents">
<p>
        Here is an illustration of increasing the
        <a class="link" href="glossary.html#glos_auto_increment" title="auto-increment">auto-increment</a> lower
        limit for a table column, demonstrating how this operation now
        avoids a table rebuild, plus other facts about
        <code class="literal">InnoDB</code> auto-increment columns.
      </p><a name="online-ddl-autoinc"></a><pre class="programlisting">
/*
If this script is run after foreign_key.sql, the schema_names table is
already set up. But to allow this script to run multiple times without
running into duplicate ID errors, we set up the schema_names table
all over again.
*/

\! clear

\! echo "=== Adjusting the Auto-Increment Limit for a Table ==="
\! echo

drop table if exists schema_names;
create table schema_names (id int unsigned not null primary key auto_increment,
  schema_name varchar(64) character set utf8 not null, index i_schema (schema_name))
  as select distinct table_schema schema_name from small_table;

\! echo "Initial state of schema_names table."
\! echo "AUTO_INCREMENT is included in SHOW CREATE TABLE output."
\! echo "Note how MySQL reserved a block of IDs."
\! echo "Only 4 IDs are needed in this transaction. The next inserted values get IDs 8 and 9."
show create table schema_names\G
select * from schema_names order by id;

\! echo "Inserting even a tiny amount of data can produce gaps in the ID sequence."
insert into schema_names (schema_name) values ('eight'), ('nine');

\! echo "Bumping auto-increment lower limit to 20 (fast mechanism):"
alter table schema_names auto_increment=20<span class="bold"><strong>, algorithm=inplace</strong></span>;

\! echo "Inserting 2 rows that should get IDs 20 and 21:"
insert into schema_names (schema_name) values ('foo'), ('bar');
commit;

\! echo "Bumping auto-increment lower limit to 30 (slow mechanism):"
alter table schema_names auto_increment=30<span class="bold"><strong>, algorithm=copy</strong></span>;

\! echo "Inserting 2 rows that should get IDs 30 and 31:"
insert into schema_names (schema_name) values ('bletch'),('baz');
commit;

select * from schema_names order by id;

\! echo "Final state of schema_names table."
\! echo "AUTO_INCREMENT value shows the next inserted row would get ID=32."
show create table schema_names\G
</pre><p>
        Running this code gives this output, condensed for brevity and
        with the most important points bolded:
      </p><pre class="programlisting">
=== Adjusting the Auto-Increment Limit for a Table ===

Query OK, 0 rows affected (0.01 sec)

Query OK, 4 rows affected (0.02 sec)
Records: 4  Duplicates: 0  Warnings: 0

Initial state of schema_names table. 
AUTO_INCREMENT is included in SHOW CREATE TABLE output.
Note how MySQL reserved a block of IDs.
Only 4 IDs are needed in this transaction. The next inserted values get IDs 8 and 9.
*************************** 1. row ***************************
       Table: schema_names
Create Table: CREATE TABLE `schema_names` (
  `id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `schema_name` varchar(64) CHARACTER SET utf8 NOT NULL,
  PRIMARY KEY (`id`),
  KEY `i_schema` (`schema_name`)
) ENGINE=InnoDB AUTO_INCREMENT=8 DEFAULT CHARSET=latin1
1 row in set (0.00 sec)

+----+--------------------+
| id | schema_name        |
+----+--------------------+
|  1 | information_schema |
|  2 | mysql              |
|  3 | performance_schema |
|  4 | test               |
+----+--------------------+
4 rows in set (0.00 sec)

Inserting even a tiny amount of data can produce gaps in the ID sequence.
Query OK, 2 rows affected (0.00 sec)
Records: 2  Duplicates: 0  Warnings: 0

Query OK, 0 rows affected (0.00 sec)

Bumping auto-increment lower limit to 20 (fast mechanism):
Query OK, <span class="bold"><strong>0 rows affected</strong></span> (0.01 sec)
Records: 0  Duplicates: 0  Warnings: 0

Inserting 2 rows that should get IDs 20 and 21:
Query OK, 2 rows affected (0.00 sec)
Records: 2  Duplicates: 0  Warnings: 0

Query OK, 0 rows affected (0.00 sec)

Query OK, 0 rows affected (0.00 sec)

Bumping auto-increment lower limit to 30 (slow mechanism):
Query OK, <span class="bold"><strong>8 rows affected</strong></span> (0.02 sec)
Records: 8  Duplicates: 0  Warnings: 0

Inserting 2 rows that should get IDs 30 and 31:
Query OK, 2 rows affected (0.00 sec)
Records: 2  Duplicates: 0  Warnings: 0

Query OK, 0 rows affected (0.01 sec)

+----+--------------------+
| id | schema_name        |
+----+--------------------+
|  1 | information_schema |
|  2 | mysql              |
|  3 | performance_schema |
|  4 | test               |
|  8 | eight              |
|  9 | nine               |
| 20 | foo                |
| 21 | bar                |
| 30 | bletch             |
| 31 | baz                |
+----+--------------------+
10 rows in set (0.00 sec)

Query OK, 0 rows affected (0.00 sec)

Final state of schema_names table. 
AUTO_INCREMENT value shows the next inserted row would get ID=32.
*************************** 1. row ***************************
       Table: schema_names
Create Table: CREATE TABLE `schema_names` (
  `id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `schema_name` varchar(64) CHARACTER SET utf8 NOT NULL,
  PRIMARY KEY (`id`),
  KEY `i_schema` (`schema_name`)
) ENGINE=InnoDB <span class="bold"><strong>AUTO_INCREMENT=32</strong></span> DEFAULT CHARSET=latin1
1 row in set (0.00 sec)
</pre>
</div>

</div>
<br class="example-break">
<div class="example">
<a name="online-ddl-ex-lock-clause"></a><p class="title"><b>Example 14.7 Controlling Concurrency with the LOCK Clause</b></p>
<div class="example-contents">
<p>
        This example shows how to use the <code class="literal">LOCK</code> clause
        of the <a class="link" href="sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a> statement to
        allow or deny concurrent access to the table while an online DDL
        operation is in progress. The clause has settings that allow
        queries and <a class="link" href="glossary.html#glos_dml" title="DML">DML</a> statements
        (<code class="literal">LOCK=NONE</code>), just
        <a class="link" href="glossary.html#glos_query" title="query">queries</a>
        (<code class="literal">LOCK=SHARED</code>), or no concurrent access at all
        (<code class="literal">LOCK=EXCLUSIVE</code>).
      </p><p>
        In one session, we run a succession of
        <a class="link" href="sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a> statements to create
        and drop an index, using different values for the
        <code class="literal">LOCK</code> clause to see what happens with waiting
        or deadlocking in either session. We are using the same
        <code class="literal">BIG_TABLE</code> table as in previous examples,
        starting with approximately 1.7 million rows. For illustration
        purposes, we will index and query the
        <code class="literal">IS_NULLABLE</code> column. (Although in real life it
        would be silly to make an index for a tiny column with only 2
        distinct values.)
      </p><pre class="programlisting">
mysql: desc big_table;
+--------------------------+---------------------+------+-----+---------+----------------+
| Field                    | Type                | Null | Key | Default | Extra          |
+--------------------------+---------------------+------+-----+---------+----------------+
| TABLE_CATALOG            | varchar(512)        | NO   |     |         |                |
| TABLE_SCHEMA             | varchar(64)         | NO   |     |         |                |
| TABLE_NAME               | varchar(64)         | NO   |     |         |                |
| COLUMN_NAME              | varchar(64)         | NO   |     |         |                |
| ORDINAL_POSITION         | bigint(21) unsigned | NO   |     | 0       |                |
| COLUMN_DEFAULT           | longtext            | YES  |     | NULL    |                |

<span class="bold"><strong>| IS_NULLABLE              | varchar(3)          | NO   |     |         |                |</strong></span>
...
+--------------------------+---------------------+------+-----+---------+----------------+
21 rows in set (0.14 sec)

mysql: alter table big_table add index i1(is_nullable);
Query OK, 0 rows affected (20.71 sec)

mysql: alter table big_table drop index i1;
Query OK, 0 rows affected (0.02 sec)

mysql: alter table big_table add index i1(is_nullable)<span class="bold"><strong>, lock=exclusive</strong></span>;
Query OK, 0 rows affected (19.44 sec)

mysql: alter table big_table drop index i1;
Query OK, 0 rows affected (0.03 sec)

mysql: alter table big_table add index i1(is_nullable)<span class="bold"><strong>, lock=shared</strong></span>;
Query OK, 0 rows affected (16.71 sec)

mysql: alter table big_table drop index i1;
Query OK, 0 rows affected (0.05 sec)

mysql: alter table big_table add index i1(is_nullable)<span class="bold"><strong>, lock=none</strong></span>;
Query OK, 0 rows affected (12.26 sec)

mysql: alter table big_table drop index i1;
Query OK, 0 rows affected (0.01 sec)

... repeat statements like the above while running queries ...
... and DML statements at the same time in another session ...
</pre><p>
        Nothing dramatic happens in the session running the DDL
        statements. Sometimes, an <a class="link" href="sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE Syntax"><code class="literal">ALTER
        TABLE</code></a> takes unusually long because it is waiting for
        another transaction to finish, when that transaction modified
        the table during the DDL or queried the table before the DDL:
      </p><pre class="programlisting">
mysql: alter table big_table add index i1(is_nullable), lock=none;

<span class="bold"><strong>Query OK, 0 rows affected (59.27 sec)</strong></span>

mysql: -- The previous ALTER took so long because it was waiting for all the concurrent
mysql: -- transactions to commit or roll back.

mysql: alter table big_table drop index i1;
<span class="bold"><strong>Query OK, 0 rows affected (41.05 sec)</strong></span>

mysql: -- Even doing a SELECT on the table in the other session first causes
mysql: -- the ALTER TABLE above to stall until the transaction
mysql: -- surrounding the SELECT is committed or rolled back.
</pre><p>
        Here is the log from another session running concurrently, where
        we issue queries and DML statements against the table before,
        during, and after the DDL operations shown in the previous
        listings. This first listing shows queries only. We expect the
        queries to be allowed during DDL operations using
        <code class="literal">LOCK=NONE</code> or <code class="literal">LOCK=SHARED</code>,
        and for the query to wait until the DDL is finished if the
        <a class="link" href="sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a> statement includes
        <code class="literal">LOCK=EXCLUSIVE</code>.
      </p><pre class="programlisting">
mysql: show variables like 'autocommit';
+---------------+-------+
| Variable_name | Value |
+---------------+-------+
| autocommit    | ON    |
+---------------+-------+
1 row in set (0.01 sec)

mysql: -- A trial query before any ADD INDEX in the other session:
mysql: -- Note: because autocommit is enabled, each
mysql: -- transaction finishes immediately after the query.
mysql: select distinct is_nullable from big_table;
+-------------+
| is_nullable |
+-------------+
| NO          |
| YES         |
+-------------+
2 rows in set (4.49 sec)

mysql: -- Index is being created with LOCK=EXCLUSIVE on the ALTER statement.
mysql: -- The query waits until the DDL is finished before proceeding.
mysql: select distinct is_nullable from big_table;
+-------------+
| is_nullable |
+-------------+
| NO          |
| YES         |
+-------------+

<span class="bold"><strong>2 rows in set (17.26 sec)</strong></span>

mysql: -- Index is being created with LOCK=SHARED on the ALTER statement.
mysql: -- The query returns its results while the DDL is in progress.
mysql: -- The same thing happens with LOCK=NONE on the ALTER statement.
mysql: select distinct is_nullable from big_table;
+-------------+
| is_nullable |
+-------------+
| NO          |
| YES         |
+-------------+
<span class="bold"><strong>2 rows in set (3.11 sec)</strong></span>

mysql: -- Once the index is created, and with no DDL in progress,
mysql: -- queries referencing the indexed column are very fast:
mysql: select count(*) from big_table where is_nullable = 'YES';
+----------+
| count(*) |
+----------+
|   411648 |
+----------+
<span class="bold"><strong>1 row in set (0.20 sec)</strong></span>

mysql: select distinct is_nullable from big_table;
+-------------+
| is_nullable |
+-------------+
| NO          |
| YES         |
+-------------+
<span class="bold"><strong>2 rows in set (0.00 sec)</strong></span>
</pre><p>
        Now in this concurrent session, we run some transactions
        including DML statements, or a combination of DML statements and
        queries. We use <a class="link" href="sql-syntax.html#delete" title="13.2.2 DELETE Syntax"><code class="literal">DELETE</code></a> statements
        to illustrate predictable, verifiable changes to the table.
        Because the transactions in this part can span multiple
        statements, we run these tests with
        <a class="link" href="server-administration.html#sysvar_autocommit"><code class="literal">autocommit</code></a> turned off.
      </p><pre class="programlisting">
mysql: set global autocommit = off;
Query OK, 0 rows affected (0.00 sec)

mysql: -- Count the rows that will be involved in our DELETE statements:
mysql: select count(*) from big_table where is_nullable = 'YES';
+----------+
| count(*) |
+----------+
|   411648 |
+----------+
1 row in set (0.95 sec)

mysql: -- After this point, any DDL statements back in the other session 
mysql: -- stall until we commit or roll back.

mysql: delete from big_table where is_nullable = 'YES' limit 11648;
Query OK, 11648 rows affected (0.14 sec)

mysql: select count(*) from big_table where is_nullable = 'YES';
+----------+
| count(*) |
+----------+
|   400000 |
+----------+
1 row in set (1.04 sec)

mysql: rollback;
Query OK, 0 rows affected (0.09 sec)

mysql: select count(*) from big_table where is_nullable = 'YES';
+----------+
| count(*) |
+----------+
|   411648 |
+----------+
1 row in set (0.93 sec)

mysql: -- OK, now we're going to try that during index creation with LOCK=NONE.
mysql: delete from big_table where is_nullable = 'YES' limit 11648;
Query OK, 11648 rows affected (0.21 sec)

mysql: -- We expect that now there will be 400000 'YES' rows left:
mysql: select count(*) from big_table where is_nullable = 'YES';
+----------+
| count(*) |
+----------+
|   400000 |
+----------+
1 row in set (1.25 sec)

mysql: -- In the other session, the ALTER TABLE is waiting before finishing,
mysql: -- because _this_ transaction hasn't committed or rolled back yet.
mysql: rollback;
Query OK, 0 rows affected (0.11 sec)

mysql: select count(*) from big_table where is_nullable = 'YES';
+----------+
| count(*) |
+----------+
|   411648 |
+----------+
1 row in set (0.19 sec)

mysql: -- The ROLLBACK left the table in the same state we originally found it.
mysql: -- Now let's make a permanent change while the index is being created,
mysql: -- again with ALTER TABLE ... , LOCK=NONE.
mysql: -- First, commit so the DROP INDEX in the other shell can finish;
mysql: -- the previous SELECT started a transaction that accessed the table.
mysql: commit;
Query OK, 0 rows affected (0.00 sec)

mysql: -- Now we add the index back in the other shell, then issue DML in this one
mysql: -- while the DDL is running.
mysql: delete from big_table where is_nullable = 'YES' limit 11648;
Query OK, 11648 rows affected (0.23 sec)

mysql: commit;
Query OK, 0 rows affected (0.01 sec)

mysql: -- In the other shell, the ADD INDEX has finished.
mysql: select count(*) from big_table where is_nullable = 'YES';
+----------+
| count(*) |
+----------+
|   400000 |
+----------+
1 row in set (0.19 sec)

mysql: -- At the point the new index is finished being created, it contains entries
mysql: -- only for the 400000 'YES' rows left when all concurrent transactions are finished.
mysql: 
mysql: -- Now we will run a similar test, while ALTER TABLE ... , LOCK=SHARED is running.
mysql: -- We expect a query to complete during the ALTER TABLE, but for the DELETE
mysql: -- to run into some kind of issue.
mysql: commit;
Query OK, 0 rows affected (0.00 sec)

mysql: -- As expected, the query returns results while the LOCK=SHARED DDL is running:
mysql: select count(*) from big_table where is_nullable = 'YES';
+----------+
| count(*) |
+----------+
|   400000 |
+----------+
1 row in set (2.07 sec)

mysql: -- The DDL in the other session is not going to finish until this transaction
mysql: -- is committed or rolled back. If we tried a DELETE now and it waited because
mysql: -- of LOCK=SHARED on the DDL, both transactions would wait forever (deadlock).
mysql: -- MySQL detects this condition and cancels the attempted DML statement.
mysql: delete from big_table where is_nullable = 'YES' limit 100000;
ERROR 1213 (40001): Deadlock found when trying to get lock; try restarting transaction
mysql: -- The transaction here is still going, so in the other shell, the ADD INDEX operation
mysql: -- is waiting for this transaction to commit or roll back.
mysql: rollback;
Query OK, 0 rows affected (0.00 sec)

mysql: -- Now let's try issuing a query and some DML, on one line, while running
mysql: -- ALTER TABLE ... , LOCK=EXCLUSIVE in the other shell.
mysql: -- Notice how even the query is held up until the DDL is finished.
mysql: -- By the time the DELETE is issued, there is no conflicting access
mysql: -- to the table and we avoid the deadlock error.
mysql: select count(*) from big_table where is_nullable = 'YES'; delete from big_table 
  where is_nullable = 'YES' limit 100000;
+----------+
| count(*) |
+----------+
|   400000 |
+----------+

<span class="bold"><strong>1 row in set (15.98 sec)</strong></span>

Query OK, 100000 rows affected (2.81 sec)

mysql: select count(*) from big_table where is_nullable = 'YES';
+----------+
| count(*) |
+----------+
|   300000 |
+----------+
1 row in set (0.17 sec)

mysql: rollback;
Query OK, 0 rows affected (1.36 sec)

mysql: select count(*) from big_table where is_nullable = 'YES';
+----------+
| count(*) |
+----------+
|   400000 |
+----------+
1 row in set (0.19 sec)

mysql: commit;
Query OK, 0 rows affected (0.00 sec)

mysql: -- Next, we try ALTER TABLE ... , LOCK=EXCLUSIVE in the other session
mysql: -- and only issue DML, not any query, in the concurrent transaction here.
mysql: delete from big_table where is_nullable = 'YES' limit 100000;
<span class="bold"><strong>Query OK, 100000 rows affected (16.37 sec)</strong></span>

mysql: -- That was OK because the ALTER TABLE did not have to wait for the transaction
mysql: -- here to complete. The DELETE in this session waited until the index was ready.
mysql: select count(*) from big_table where is_nullable = 'YES';
+----------+
| count(*) |
+----------+
|   300000 |
+----------+
1 row in set (0.16 sec)

mysql: commit;
Query OK, 0 rows affected (0.00 sec)
</pre><p>
        In the preceding example listings, we learned that:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            The <code class="literal">LOCK</code> clause for
            <a class="link" href="sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a> is set off from
            the rest of the statement by a comma.
          </p></li><li class="listitem"><p>
            Online DDL operations might wait before starting, until any
            prior transactions that access the table are committed or
            rolled back.
          </p></li><li class="listitem"><p>
            Online DDL operations might wait before completing, until
            any concurrent transactions that access the table are
            committed or rolled back.
          </p></li><li class="listitem"><p>
            While an online DDL operation is running, concurrent queries
            are relatively straightforward, as long as the
            <a class="link" href="sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a> statement uses
            <code class="literal">LOCK=NONE</code> or
            <code class="literal">LOCK=SHARED</code>.
          </p></li><li class="listitem"><p>
            Pay attention to whether
            <a class="link" href="server-administration.html#sysvar_autocommit"><code class="literal">autocommit</code></a> is turned on or
            off. If it is turned off, be careful to end transactions in
            other sessions (even just queries) before performing DDL
            operations on the table.
          </p></li><li class="listitem"><p>
            With <code class="literal">LOCK=SHARED</code>, concurrent transactions
            that mix queries and DML could encounter deadlock errors and
            have to be restarted after the DDL is finished.
          </p></li><li class="listitem"><p>
            With <code class="literal">LOCK=NONE</code>, concurrent transactions
            can freely mix queries and DML. The DDL operation waits
            until the concurrent transactions are committed or rolled
            back.
          </p></li><li class="listitem"><p>
            With <code class="literal">LOCK=EXCLUSIVE</code>, concurrent
            transactions can freely mix queries and DML, but those
            transactions wait until the DDL operation is finished before
            they can access the table.
</p></li></ul>
</div>

</div>

</div>
<br class="example-break">
<div class="example">
<a name="online-ddl-ex-multi-create-index"></a><p class="title"><b>Example 14.8 Schema Setup Code for Online DDL Experiments</b></p>
<div class="example-contents">
<p>
        You can create multiple indexes on a table with one
        <a class="link" href="sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a> statement. This is
        relatively efficient, because the clustered index of the table
        needs to be scanned only once (although the data is sorted
        separately for each new index). For example:
      </p><pre class="programlisting">
CREATE TABLE T1(A INT PRIMARY KEY, B INT, C CHAR(1)) ENGINE=InnoDB;
INSERT INTO T1 VALUES (1,2,'a'), (2,3,'b'), (3,2,'c'), (4,3,'d'), (5,2,'e');
COMMIT;
ALTER TABLE T1 ADD INDEX (B), ADD UNIQUE INDEX (C);
</pre><p>
        The above statements create table <code class="literal">T1</code> with the
        primary key on column <code class="literal">A</code>, insert several rows,
        then build two new indexes on columns <code class="literal">B</code> and
        <code class="literal">C</code>. If there were many rows inserted into
        <code class="literal">T1</code> before the <a class="link" href="sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE Syntax"><code class="literal">ALTER
        TABLE</code></a> statement, this approach is much more efficient
        than creating all the secondary indexes before loading the data.
      </p><p>
        Because dropping InnoDB secondary indexes also does not require
        any copying of table data, it is equally efficient to drop
        multiple indexes with a single <a class="link" href="sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE Syntax"><code class="literal">ALTER
        TABLE</code></a> statement or multiple <a class="link" href="sql-syntax.html#drop-index" title="13.1.25 DROP INDEX Syntax"><code class="literal">DROP
        INDEX</code></a> statements:
      </p><pre class="programlisting">
ALTER TABLE T1 DROP INDEX B, DROP INDEX C;
</pre><p>
        or:
      </p><pre class="programlisting">
DROP INDEX B ON T1;
DROP INDEX C ON T1;
</pre>
</div>

</div>
<br class="example-break">
<div class="example">
<a name="online-ddl-ex-primary-key"></a><p class="title"><b>Example 14.9 Creating and Dropping the Primary Key</b></p>
<div class="example-contents">
<p>
        Restructuring the <a class="link" href="glossary.html#glos_clustered_index" title="clustered index">clustered
        index</a> for an <code class="literal">InnoDB</code> table always
        requires copying the table data. Thus, it is best to define the
        <a class="link" href="glossary.html#glos_primary_key" title="primary key">primary key</a> when you
        create a table, rather than issuing <code class="literal">ALTER TABLE ... ADD
        PRIMARY KEY</code> later, to avoid rebuilding the table.
      </p><p>
        Defining a <code class="literal">PRIMARY KEY</code> later causes the data
        to be copied, as in the following example:
      </p><pre class="programlisting">
CREATE TABLE T2 (A INT, B INT);
INSERT INTO T2 VALUES (NULL, 1);
ALTER TABLE T2 ADD PRIMARY KEY (B);
</pre><p>
        When you create a <code class="literal">UNIQUE</code> or <code class="literal">PRIMARY
        KEY</code> index, MySQL must do some extra work. For
        <code class="literal">UNIQUE</code> indexes, MySQL checks that the table
        contains no duplicate values for the key. For a <code class="literal">PRIMARY
        KEY</code> index, MySQL also checks that none of the
        <code class="literal">PRIMARY KEY</code> columns contains a
        <code class="literal">NULL</code>.
      </p><p>
        When you add a primary key using the
        <code class="literal">ALGORITHM=COPY</code> clause, MySQL actually
        converts <code class="literal">NULL</code> values in the associated
        columns to default values: 0 for numbers, the empty string for
        character-based columns and BLOBs, and 0000-00-00 00:00:00 for
        <code class="literal">DATETIME</code>. This is a non-standard behavior
        that Oracle recommends you not rely on. Adding a primary key
        using <code class="literal">ALGORITHM=INPLACE</code> is only allowed when
        the <a class="link" href="server-administration.html#sysvar_sql_mode"><code class="literal">SQL_MODE</code></a> setting includes
        the <code class="literal">strict_trans_tables</code> or
        <code class="literal">strict_all_tables</code> flags; when the
        <code class="literal">SQL_MODE</code> setting is strict, <code class="literal">ADD
        PRIMARY KEY ... , ALGORITHM=INPLACE</code> is allowed, but
        the statement can still fail if the requested primary key
        columns contain any <code class="literal">NULL</code> values. The
        <code class="literal">ALGORITHM=INPLACE</code> behavior is more
        standard-compliant.
      </p><p>
        The following examples show the different possibilities for the
        <code class="literal">ADD PRIMARY KEY</code> clause. With the
        <code class="literal">ALGORITHM=COPY</code> clause, the operation succeeds
        despite the presence of <code class="literal">NULL</code> values in the
        primary key columns; the data is silently changed, which could
        cause problems.
      </p><pre class="programlisting">mysql&gt; CREATE TABLE add_pk_via_copy (c1 INT, c2 VARCHAR(10), c3 DATETIME);
Query OK, 0 rows affected (0.03 sec)

mysql&gt; INSERT INTO add_pk_via_copy VALUES (1,'a','2014-11-03 11:01:37'),(NULL,NULL,NULL);
Query OK, 2 rows affected (0.00 sec)
Records: 2  Duplicates: 0  Warnings: 0

mysql&gt; SET sql_mode = '';
Query OK, 0 rows affected (0.00 sec)

mysql&gt; ALTER TABLE add_pk_via_copy ADD PRIMARY KEY (c1,c2,c3), ALGORITHM=COPY;
Query OK, 2 rows affected, 3 warnings (0.07 sec)
Records: 2  Duplicates: 0  Warnings: 3

mysql&gt; SHOW WARNINGS;
+---------+------+-----------------------------------------+
| Level   | Code | Message                                 |
+---------+------+-----------------------------------------+
| Warning | 1265 | Data truncated for column 'c1' at row 2 |
| Warning | 1265 | Data truncated for column 'c2' at row 2 |
| Warning | 1265 | Data truncated for column 'c3' at row 2 |
+---------+------+-----------------------------------------+
3 rows in set (0.00 sec)

mysql&gt; SELECT * FROM add_pk_via_copy;
+----+----+---------------------+
| c1 | c2 | c3                  |
+----+----+---------------------+
|  0 |    | 0000-00-00 00:00:00 |
|  1 | a  | 2014-11-03 11:01:37 |
+----+----+---------------------+
2 rows in set (0.00 sec)
        
      </pre><p>
        With the <code class="literal">ALGORITHM=INPLACE</code> clause, the
        operation could fail for different reasons, because this setting
        considers data integrity a high priority: the statement gives an
        error if the <a class="link" href="server-administration.html#sysvar_sql_mode"><code class="literal">SQL_MODE</code></a> setting
        is not <span class="quote">“<span class="quote">strict</span>”</span> enough, or if the primary key
        columns contain any <code class="literal">NULL</code> values. Once we
        address both of those requirements, the
        <a class="link" href="sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a> operation succeeds.
      </p><pre class="programlisting">mysql&gt; CREATE TABLE add_pk_via_inplace (c1 INT, c2 VARCHAR(10), c3 DATETIME);
Query OK, 0 rows affected (0.02 sec)

mysql&gt; INSERT INTO add_pk_via_inplace VALUES (1,'a','2014-11-03 11:01:37'),(NULL,NULL,NULL);
Query OK, 2 rows affected (0.00 sec)
Records: 2  Duplicates: 0  Warnings: 0

mysql&gt; SELECT * FROM add_pk_via_inplace;
+------+------+---------------------+
| c1   | c2   | c3                  |
+------+------+---------------------+
|    1 | a    | 2014-11-03 11:01:37 |
| NULL | NULL | NULL                |
+------+------+---------------------+
2 rows in set (0.00 sec)

mysql&gt; SET sql_mode = '';
Query OK, 0 rows affected (0.00 sec)

mysql&gt; ALTER TABLE add_pk_via_inplace ADD PRIMARY KEY (c1,c2,c3), ALGORITHM=INPLACE;
ERROR 1846 (0A000): ALGORITHM=INPLACE is not supported. Reason: cannot silently convert NULL 
values, as required in this SQL_MODE. Try ALGORITHM=COPY.

mysql&gt; SET sql_mode ='strict_trans_tables';
Query OK, 0 rows affected (0.00 sec)

mysql&gt; ALTER TABLE add_pk_via_inplace ADD PRIMARY KEY (c1,c2,c3), ALGORITHM=INPLACE;
ERROR 1138 (22004): Invalid use of NULL value
mysql&gt; DELETE FROM add_pk_via_inplace WHERE c1 IS NULL OR c2 IS NULL OR c3 IS NULL;
Query OK, 1 row affected (0.01 sec)

mysql&gt; SELECT * FROM add_pk_via_inplace;
+------+------+---------------------+
| c1   | c2   | c3                  |
+------+------+---------------------+
|    1 | a    | 2014-11-03 11:01:37 |
+------+------+---------------------+
1 row in set (0.00 sec)

mysql&gt; ALTER TABLE add_pk_via_inplace ADD PRIMARY KEY (c1,c2,c3), ALGORITHM=INPLACE;
Query OK, 0 rows affected (0.09 sec)
Records: 0  Duplicates: 0  Warnings: 0
</pre><p>
        If you create a table without a primary key, InnoDB chooses one
        for you, which can be the first <code class="literal">UNIQUE</code> key
        defined on <code class="literal">NOT NULL</code> columns, or a
        system-generated key. To avoid any uncertainty and the potential
        space requirement for an extra hidden column, specify the
        <code class="literal">PRIMARY KEY</code> clause as part of the
        <a class="link" href="sql-syntax.html#create-table" title="13.1.18 CREATE TABLE Syntax"><code class="literal">CREATE TABLE</code></a> statement.
</p>
</div>

</div>
<br class="example-break">
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="innodb-create-index-implementation"></a>14.10.6 Implementation Details of Online DDL</h3>

</div>

</div>

</div>
<a class="indexterm" name="idm140644110507152"></a><a class="indexterm" name="idm140644110505664"></a><p>
      Each <a class="link" href="sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a> operation for an
      <code class="literal">InnoDB</code> table is governed by several aspects:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          Whether there is any change to the physical representation of
          the table, or whether it purely a change to metadata that can
          be done without touching the table itself.
        </p></li><li class="listitem"><p>
          Whether the volume of data in the table stays the same,
          increases, or decreases.
        </p></li><li class="listitem"><p>
          Whether a change in table data involves the clustered index,
          secondary indexes, or both.
        </p></li><li class="listitem"><p>
          Whether there are any <a class="link" href="glossary.html#glos_foreign_key" title="foreign key">foreign
          key</a> relationships between the table being altered and
          some other table. The mechanics differ depending on whether
          the <a class="link" href="server-administration.html#sysvar_foreign_key_checks"><code class="literal">foreign_key_checks</code></a>
          configuration option is enabled or disabled.
        </p></li><li class="listitem"><p>
          Whether the table is partitioned. Partitioning clauses of
          <a class="link" href="sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a> are turned into
          low-level operations involving one or more tables, and those
          operations follow the regular rules for online DDL.
        </p></li><li class="listitem"><p>
          Whether the table data must be copied, whether the table can
          be reorganized <span class="quote">“<span class="quote">in-place</span>”</span>, or a combination of
          both.
        </p></li><li class="listitem"><p>
          Whether the table contains any
          <a class="link" href="glossary.html#glos_auto_increment" title="auto-increment">auto-increment</a>
          columns.
        </p></li><li class="listitem"><p>
          What degree of <a class="link" href="glossary.html#glos_locking" title="locking">locking</a> is
          required, either by the nature of the underlying database
          operations, or a <code class="literal">LOCK</code> clause that you
          specify in the <a class="link" href="sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a>
          statement.
</p></li></ul>
</div>
<p>
      This section explains how these factors affect the different kinds
      of <a class="link" href="sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a> operations on
      <code class="literal">InnoDB</code> tables.
</p>
<h4><a name="idm140644110484064"></a>Error Conditions for Online DDL</h4>
<p>
      Here are the primary reasons why an online DDL operation could
      fail:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          If a <code class="literal">LOCK</code> clause specifies a low degree of
          locking (<code class="literal">SHARED</code> or <code class="literal">NONE</code>)
          that is not compatible with the particular type of DDL
          operation.
        </p></li><li class="listitem"><p>
          If a timeout occurs while waiting to get an
          <a class="link" href="glossary.html#glos_exclusive_lock" title="exclusive lock">exclusive lock</a> on
          the table, which is needed briefly during the initial and
          final phases of the DDL operation.
        </p></li><li class="listitem"><p>
          If the <a class="link" href="server-administration.html#sysvar_tmpdir"><code class="literal">tmpdir</code></a> file system
          runs out of disk space, while MySQL writes temporary sort
          files on disk during index creation.
        </p></li><li class="listitem"><p>
          If the <a class="link" href="sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a> takes so
          long, and concurrent DML modifies the table so much, that the
          size of the temporary online log exceeds the value of the
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_online_alter_log_max_size"><code class="literal">innodb_online_alter_log_max_size</code></a>
          configuration option. This condition causes a
          <code class="literal">DB_ONLINE_LOG_TOO_BIG</code> error.
        </p></li><li class="listitem"><p>
          If concurrent DML makes changes to the table that are allowed
          with the original table definition, but not with the new one.
          The operation only fails at the very end, when MySQL tries to
          apply all the changes from concurrent DML statements. For
          example, you might insert duplicate values into a column while
          a unique index is being created, or you might insert
          <code class="literal">NULL</code> values into a column while creating a
          <a class="link" href="glossary.html#glos_primary_key" title="primary key">primary key</a> index on
          that column. The changes made by the concurrent DML take
          precedence, and the <a class="link" href="sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a>
          operation is effectively <a class="link" href="glossary.html#glos_rollback" title="rollback">rolled
          back</a>.
</p></li></ul>
</div>
<p>
      Although the configuration option
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_per_table"><code class="literal">innodb_file_per_table</code></a> has a
      dramatic effect on the representation for an
      <code class="literal">InnoDB</code> table, all online DDL operations work
      equally well whether that option is enabled or disabled, and
      whether the table is physically located in its own
      <a class="link" href="glossary.html#glos_ibd_file" title=".ibd file">.ibd file</a> or inside the
      <a class="link" href="glossary.html#glos_system_tablespace" title="system tablespace">system tablespace</a>.
    </p><p>
      InnoDB has two types of indexes: the
      <a class="link" href="glossary.html#glos_clustered_index" title="clustered index">clustered index</a>
      representing all the data in the table, and optional
      <a class="link" href="glossary.html#glos_secondary_index" title="secondary index">secondary indexes</a> to
      speed up queries. Since the clustered index contains the data
      values in its B-tree nodes, adding or dropping a clustered index
      does involve copying the data, and creating a new copy of the
      table. A secondary index, however, contains only the index key and
      the value of the primary key. This type of index can be created or
      dropped without copying the data in the clustered index. Because
      each secondary index contains copies of the primary key values
      (used to access the clustered index when needed), when you change
      the definition of the primary key, all secondary indexes are
      recreated as well.
    </p><p>
      Dropping a secondary index is simple. Only the internal InnoDB
      system tables and the MySQL data dictionary tables are updated to
      reflect the fact that the index no longer exists. InnoDB returns
      the storage used for the index to the tablespace that contained
      it, so that new indexes or additional table rows can use the
      space.
    </p><p>
      To add a secondary index to an existing table, InnoDB scans the
      table, and sorts the rows using memory buffers and temporary files
      in order by the values of the secondary index key columns. The
      B-tree is then built in key-value order, which is more efficient
      than inserting rows into an index in random order. Because the
      B-tree nodes are split when they fill, building the index in this
      way results in a higher fill-factor for the index, making it more
      efficient for subsequent access.
</p>
<h4><a name="innodb-online-ddl-implementation"></a>Primary Key and Secondary Key Indexes</h4>
<p>
      Historically, the MySQL server and <code class="literal">InnoDB</code> have
      each kept their own metadata about table and index structures. The
      MySQL server stores this information in
      <a class="link" href="glossary.html#glos_frm_file" title=".frm file">.frm files</a> that are not
      protected by a transactional mechanism, while
      <code class="literal">InnoDB</code> has its own
      <a class="link" href="glossary.html#glos_data_dictionary" title="data dictionary">data dictionary</a> as
      part of the <a class="link" href="glossary.html#glos_system_tablespace" title="system tablespace">system
      tablespace</a>. If a DDL operation was interrupted by a crash
      or other unexpected event partway through, the metadata could be
      left inconsistent between these two locations, causing problems
      such as startup errors or inability to access the table that was
      being altered. Now that <code class="literal">InnoDB</code> is the default
      storage engine, addressing such issues is a high priority. These
      enhancements to DDL operations reduce the window of opportunity
      for such issues to occur.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="innodb-create-index-recovery"></a>14.10.7 How Crash Recovery Works with Online DDL</h3>

</div>

</div>

</div>
<a class="indexterm" name="idm140644110449120"></a><p>
      Although no data is lost if the server crashes while an
      <a class="link" href="sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a> statement is executing,
      the <a class="link" href="glossary.html#glos_crash_recovery" title="crash recovery">crash recovery</a>
      process is different for
      <a class="link" href="glossary.html#glos_clustered_index" title="clustered index">clustered indexes</a> and
      <a class="link" href="glossary.html#glos_secondary_index" title="secondary index">secondary indexes</a>.
    </p><p>
      If the server crashes while creating an InnoDB secondary index,
      upon recovery, MySQL drops any partially created indexes. You must
      re-run the <a class="link" href="sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a> or
      <a class="link" href="sql-syntax.html#create-index" title="13.1.14 CREATE INDEX Syntax"><code class="literal">CREATE INDEX</code></a> statement.
    </p><p>
      When a crash occurs during the creation of an InnoDB clustered
      index, recovery is more complicated, because the data in the table
      must be copied to an entirely new clustered index. Remember that
      all InnoDB tables are stored as clustered indexes.
    </p><p>
      MySQL creates the new clustered index by copying the existing data
      from the original InnoDB table to a temporary table that has the
      desired index structure. Once the data is completely copied to
      this temporary table, the original table is renamed with a
      different temporary table name. The temporary table comprising the
      new clustered index is renamed with the name of the original
      table, and the original table is dropped from the database.
    </p><p>
      If a system crash occurs while creating a new clustered index, no
      data is lost, but you must complete the recovery process using the
      temporary tables that exist during the process. Since it is rare
      to re-create a clustered index or re-define primary keys on large
      tables, or to encounter a system crash during this operation, this
      manual does not provide information on recovering from this
      scenario.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="online-ddl-partitioning"></a>14.10.8 Online DDL for Partitioned InnoDB Tables</h3>

</div>

</div>

</div>
<p>
      With the exception of <a class="link" href="sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a>
      partitioning clauses, online DDL operations for partitioned
      <code class="literal">InnoDB</code> tables follow the same rules that apply
      to regular <code class="literal">InnoDB</code> tables. Online DDL rules are
      outlined in <a class="xref" href="innodb-storage-engine.html#innodb-online-ddl-summary-grid" title="Table 14.8 Summary of Online Status for DDL Operations">Table 14.8, “Summary of Online Status for DDL Operations”</a>.
    </p><p>
      <a class="link" href="sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a> partitioning clauses do
      not go through the same internal online DDL API as regular
      non-partitioned <code class="literal">InnoDB</code> tables, and are only
      allowed in conjunction with <code class="literal">ALGORITHM=DEFAULT</code>
      and <code class="literal">LOCK=DEFAULT</code>.
    </p><p>
      If you use an ALTER TABLE partitioning clause in an
      <a class="link" href="sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a> statement, the
      partitioned table will be <span class="quote">“<span class="quote">re-partitioned</span>”</span> using the
      <a class="link" href="sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a> <code class="literal">COPY</code>
      algorithm. In other words, a new partitioned table is created with
      the new partitioning scheme. The newly created table will include
      any changes applied by the <a class="link" href="sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE Syntax"><code class="literal">ALTER
      TABLE</code></a> statement and the table data will be copied into
      the new table structure.
    </p><p>
      If you do not change the table's partitioning using
      <a class="link" href="sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a> partitioning clauses or
      perform any other partition management in your
      <a class="link" href="sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a> statement,
      <a class="link" href="sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a> will use the
      <code class="literal">INPLACE</code> algorithm on each table partition. Be
      aware, however, that when <code class="literal">INPLACE</code>
      <a class="link" href="sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a> operations are
      performed on each partition, there will be increased demand on
      system resources due to operations being performed on multiple
      partitions.
    </p><p>
      Even though partitioning clauses of the <a class="link" href="sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE Syntax"><code class="literal">ALTER
      TABLE</code></a> statement do not go through the same internal
      online DDL API as regular non-partitioned
      <code class="literal">InnoDB</code> tables, MySQL still attempts to minimize
      data copying and locking where possible:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          <code class="literal">ADD PARTITION</code> and <code class="literal">DROP
          PARTITION</code> for tables partitioned by
          <code class="literal">RANGE</code> or <code class="literal">LIST</code> do not
          copy any existing data.
        </p></li><li class="listitem"><p>
          <code class="literal">TRUNCATE PARTITION</code> does not copy any
          existing data, for all types of partitioned tables.
        </p></li><li class="listitem"><p>
          Concurrent queries are allowed during <code class="literal">ADD
          PARTITION</code> and <code class="literal">COALESCE PARTITION</code>
          for tables partitioned by <code class="literal">HASH</code> or
          <code class="literal">LIST</code>. MySQL copies the data while holding a
          shared lock.
        </p></li><li class="listitem"><p>
          For <code class="literal">REORGANIZE PARTITION</code>, <code class="literal">REBUILD
          PARTITION</code>, or <code class="literal">ADD PARTITION</code> or
          <code class="literal">COALESCE PARTITION</code> for a table partitioned
          by <code class="literal">LINEAR HASH</code> or <code class="literal">LIST</code>,
          concurrent queries are allowed. Data from the affected
          partitions is copied while holding a shared metadata (read)
          lock at the table level.
</p></li></ul>
</div>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">
<div class="admon-title">
Note
</div>
<p>
        Full-text search (FTS) and foreign keys are not supported by
        <code class="literal">InnoDB</code> partitioned tables. For more
        information, see <a class="xref" href="functions.html#fulltext-restrictions" title="12.9.5 Full-Text Restrictions">Section 12.9.5, “Full-Text Restrictions”</a> and
        <a class="xref" href="partitioning.html#partitioning-limitations-storage-engines" title="19.6.2 Partitioning Limitations Relating to Storage Engines">Section 19.6.2, “Partitioning Limitations Relating to Storage Engines”</a>.
</p>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="innodb-create-index-limitations"></a>14.10.9 Limitations of Online DDL</h3>

</div>

</div>

</div>
<a class="indexterm" name="idm140644110394736"></a><a class="indexterm" name="idm140644110393248"></a><a class="indexterm" name="idm140644110391760"></a><p>
      Take the following limitations into account when running online
      DDL operations:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          During an online DDL operation that copies the table, files
          are written to the temporary directory
          (<code class="literal">$TMPDIR</code> on Unix, <code class="literal">%TEMP%</code>
          on Windows, or the directory specified by the
          <a class="link" href="server-administration.html#sysvar_tmpdir"><code class="literal">--tmpdir</code></a> configuration
          variable). Each temporary file is large enough to hold one
          column in the new table or index, and each one is removed as
          soon as it is merged into the final table or index.
        </p></li><li class="listitem"><p>
          The table is copied, rather than using Fast Index Creation
          when you create an index on a <code class="literal">TEMPORARY
          TABLE</code>. This has been reported as MySQL Bug #39833.
        </p></li><li class="listitem"><p>
          InnoDB handles error cases when users attempt to drop indexes
          needed for foreign keys. See
          <a class="xref" href="error-handling.html#error-messages-server" title="B.3 Server Error Codes and Messages">Section B.3, “Server Error Codes and Messages”</a> for information
          related to error <code class="literal">1553</code>.
        </p></li><li class="listitem"><p>
          The <a class="link" href="sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a> clause
          <code class="literal">LOCK=NONE</code> is not allowed if there are
          <code class="literal">ON...CASCADE</code> or <code class="literal">ON...SET
          NULL</code> constraints on the table.
        </p></li><li class="listitem"><p>
          During each online DDL <a class="link" href="sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE Syntax"><code class="literal">ALTER
          TABLE</code></a> statement, regardless of the
          <code class="literal">LOCK</code> clause, there are brief periods at the
          beginning and end requiring an
          <a class="link" href="glossary.html#glos_exclusive_lock" title="exclusive lock">exclusive lock</a> on
          the table (the same kind of lock specified by the
          <code class="literal">LOCK=EXCLUSIVE</code> clause). Thus, an online DDL
          operation might wait before starting if there is a
          long-running transaction performing inserts, updates, deletes,
          or <code class="literal">SELECT ... FOR UPDATE</code> on that table; and
          an online DDL operation might wait before finishing if a
          similar long-running transaction was started while the
          <a class="link" href="sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a> was in progress.
        </p></li><li class="listitem"><p>
          When running an online <a class="link" href="sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE Syntax"><code class="literal">ALTER
          TABLE</code></a> operation, the thread that runs the
          <a class="link" href="sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a> operation will
          apply an <span class="quote">“<span class="quote">online log</span>”</span> of DML operations that were
          run concurrently on the same table from other connection
          threads. When the DML operations are applied, it is possible
          to encounter a duplicate key entry error (<span class="errortext">ERROR
          1062 (23000): Duplicate entry</span>), even if the
          duplicate entry is only temporary and would be reverted by a
          later entry in the <span class="quote">“<span class="quote">online log</span>”</span>. This is similar
          to the idea of a foreign key constraint check in
          <code class="literal">InnoDB</code> in which constraints must hold
          during a transaction.
        </p></li><li class="listitem"><p>
          <a class="link" href="sql-syntax.html#optimize-table" title="13.7.2.4 OPTIMIZE TABLE Syntax"><code class="literal">OPTIMIZE TABLE</code></a> for an
          <code class="literal">InnoDB</code> table is mapped to an
          <a class="link" href="sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a> operation to
          rebuild the table and update index statistics and free unused
          space in the clustered index. Prior to 5.7.4, there is no
          <a class="link" href="innodb-storage-engine.html#innodb-online-ddl" title="14.10 InnoDB and Online DDL">online DDL</a> support
          for this operation. Secondary indexes are not created as
          efficiently because keys are inserted in the order they
          appeared in the primary key. As of 5.7.4,
          <a class="link" href="sql-syntax.html#optimize-table" title="13.7.2.4 OPTIMIZE TABLE Syntax"><code class="literal">OPTIMIZE TABLE</code></a> is supported
          with the addition of <a class="link" href="innodb-storage-engine.html#innodb-online-ddl" title="14.10 InnoDB and Online DDL">online
          DDL</a> support for rebuilding regular and partitioned
          <code class="literal">InnoDB</code> tables. For additional information,
          see <a class="xref" href="innodb-storage-engine.html#innodb-create-index-overview" title="14.10.1 Overview of Online DDL">Section 14.10.1, “Overview of Online DDL”</a>.
        </p></li><li class="listitem"><p>
          <code class="literal">InnoDB</code> tables created before MySQL 5.6 do
          not support <a class="link" href="sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE Syntax"><code class="literal">ALTER
          TABLE ... ALGORITHM=INPLACE</code></a> for tables that include
          temporal columns (<a class="link" href="data-types.html#datetime" title="11.3.1 The DATE, DATETIME, and TIMESTAMP Types"><code class="literal">DATE</code></a>,
          <a class="link" href="data-types.html#datetime" title="11.3.1 The DATE, DATETIME, and TIMESTAMP Types"><code class="literal">DATETIME</code></a> or
          <a class="link" href="data-types.html#datetime" title="11.3.1 The DATE, DATETIME, and TIMESTAMP Types"><code class="literal">TIMESTAMP</code></a>) and have not been
          rebuilt using
          <a class="link" href="sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE Syntax"><code class="literal">ALTER TABLE ...
          ALGORITHM=COPY</code></a>. In this case, an
          <a class="link" href="sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE Syntax"><code class="literal">ALTER TABLE ...
          ALGORITHM=INPLACE</code></a> operation returns the following
          error:
        </p><pre class="programlisting">
ERROR 1846 (0A000): ALGORITHM=INPLACE is not supported. 
Reason: Cannot change column type INPLACE. Try ALGORITHM=COPY.
</pre></li><li class="listitem"><p>
          These limitations are generally applicable to online DDL
          operations on large tables where table copying is involved:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
              There is no mechanism to pause an online DDL operation or
              to throttle I/O or CPU usage for an online DDL operation.
            </p></li><li class="listitem"><p>
              Progress monitoring capability for online DDL operations
              is limited until MySQL 5.7.6, which introduces Performance
              Schema stage events for monitoring
              <a class="link" href="sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a> progress. See
              <a class="xref" href="innodb-storage-engine.html#monitor-alter-table-performance-schema" title="14.13.1 Monitoring ALTER TABLE Progress for InnoDB Tables Using Performance Schema">Section 14.13.1, “Monitoring ALTER TABLE Progress for InnoDB Tables Using Performance
      Schema”</a>.
            </p></li><li class="listitem"><p>
              Rollback of an online DDL operation can be expensive
              should the operation fail.
            </p></li><li class="listitem"><p>
              Long running online DDL operations can cause replication
              lag. An online DDL operation must finish running on the
              master before it is run on the slave. Also, DML that was
              processed concurrently on the master is only processed on
              the slave after the DDL operation on the slave is
              completed (Bug #73196).
            </p></li><li class="listitem"><p>
              An online <a class="link" href="sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a>
              operation can cause a server exit if the operation uses
              all of the available disk space on the file system where
              the data directory
              (<a class="link" href="server-administration.html#sysvar_datadir"><code class="literal">datadir</code></a>) resides (Bug
              #77497). To avoid this problem, ensure that there is
              enough disk space to accommodate operations that copy the
              table. During these operations, MySQL writes temporary
              sort files to the temporary directory
              (<a class="link" href="server-administration.html#sysvar_tmpdir"><code class="literal">--tmpdir</code></a>).
</p></li></ul>
</div>
<p>
          For additional information related to running online DDL
          operations on large tables, see
          <a class="xref" href="innodb-storage-engine.html#innodb-create-index-concurrency" title="14.10.2 Performance and Concurrency Considerations for Online DDL">Section 14.10.2, “Performance and Concurrency Considerations for Online DDL”</a>.
</p></li></ul>
</div>

</div>

</div>

<div class="section">

<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="innodb-parameters"></a>14.11 InnoDB Startup Options and System Variables</h2>

</div>

</div>

</div>
<a class="indexterm" name="idm140644110330064"></a><a class="indexterm" name="idm140644110328640"></a>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          System variables that are true or false can be enabled at
          server startup by naming them, or disabled by using a
          <code class="literal">--skip-</code> prefix. For example, to enable or
          disable the <code class="literal">InnoDB</code> adaptive hash index, you
          can use
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_adaptive_hash_index"><code class="option">--innodb_adaptive_hash_index</code></a> or
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_adaptive_hash_index"><code class="option">--skip-innodb_adaptive_hash_index</code></a>
          on the command line, or
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_adaptive_hash_index"><code class="literal">innodb_adaptive_hash_index</code></a> or
          <code class="literal">skip-innodb_adaptive_hash_index</code> in an
          option file.
        </p></li><li class="listitem"><p>
          System variables that take a numeric value can be specified as
          <code class="option">--<em class="replaceable"><code>var_name</code></em>=<em class="replaceable"><code>value</code></em></code>
          on the command line or as
          <code class="literal"><em class="replaceable"><code>var_name</code></em>=<em class="replaceable"><code>value</code></em></code>
          in option files.
        </p></li><li class="listitem"><p>
          Many system variables can be changed at runtime (see
          <a class="xref" href="server-administration.html#dynamic-system-variables" title="5.1.5.2 Dynamic System Variables">Section 5.1.5.2, “Dynamic System Variables”</a>).
        </p></li><li class="listitem"><p>
          For information about <code class="literal">GLOBAL</code> and
          <code class="literal">SESSION</code> variable scope modifiers, refer to
          the
          <a class="link" href="sql-syntax.html#set-statement" title="13.7.4 SET Syntax"><code class="literal">SET</code></a>
          statement documentation.
        </p></li><li class="listitem"><p>
          Certain options control the locations and layout of the
          <code class="literal">InnoDB</code> data files.
          <a class="xref" href="innodb-storage-engine.html#innodb-configuration" title="14.3 InnoDB Configuration">Section 14.3, “InnoDB Configuration”</a> explains how to use
          these options.
        </p></li><li class="listitem"><p>
          Some options, which you might not use initially, help tune
          <code class="literal">InnoDB</code> performance characteristics based on
          machine capacity and your database
          <a class="link" href="glossary.html#glos_workload" title="workload">workload</a>.
        </p></li><li class="listitem"><p>
          For more information on specifying options and system
          variables, see <a class="xref" href="programs.html#program-options" title="4.2.3 Specifying Program Options">Section 4.2.3, “Specifying Program Options”</a>.
</p></li></ul>
</div>
<div class="table">
<a name="idm140644110305504"></a><p class="title"><b>Table 14.9 <code class="literal">InnoDB</code> Option/Variable
Reference</b></p>
<div class="table-contents">
<table summary="InnoDB Option/Variable
Reference" border="1"><colgroup><col class="name"><col class="cmd-line"><col class="option_file"><col class="system_var"><col class="status_var"><col class="var_scope"><col class="dynamic"></colgroup><thead><tr><th scope="col">Name</th><th scope="col">Cmd-Line</th><th scope="col">Option File</th><th scope="col">System Var</th><th scope="col">Status Var</th><th scope="col">Var Scope</th><th scope="col">Dynamic</th></tr></thead><tbody><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_daemon_memcached_enable_binlog">daemon_memcached_enable_binlog</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_daemon_memcached_engine_lib_name">daemon_memcached_engine_lib_name</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_daemon_memcached_engine_lib_path">daemon_memcached_engine_lib_path</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_daemon_memcached_option">daemon_memcached_option</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_daemon_memcached_r_batch_size">daemon_memcached_r_batch_size</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_daemon_memcached_w_batch_size">daemon_memcached_w_batch_size</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="server-administration.html#sysvar_foreign_key_checks">foreign_key_checks</a></td><td> </td><td> </td><td>Yes</td><td> </td><td>Both</td><td>Yes</td></tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#option_mysqld_ignore-builtin-innodb">ignore-builtin-innodb</a></td><td>Yes</td><td>Yes</td><td> </td><td> </td><td>Global</td><td>No</td></tr><tr><td scope="row"> - <span class="emphasis"><em>Variable</em></span>: <a class="link" href="innodb-storage-engine.html#sysvar_ignore_builtin_innodb">ignore_builtin_innodb</a></td><td> </td><td> </td><td>Yes</td><td> </td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#option_mysqld_innodb">innodb</a></td><td>Yes</td><td>Yes</td><td> </td><td> </td><td> </td><td> </td></tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_adaptive_flushing">innodb_adaptive_flushing</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_adaptive_flushing_lwm">innodb_adaptive_flushing_lwm</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_adaptive_hash_index">innodb_adaptive_hash_index</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_adaptive_hash_index_parts">innodb_adaptive_hash_index_parts</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_adaptive_max_sleep_delay">innodb_adaptive_max_sleep_delay</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_additional_mem_pool_size">innodb_additional_mem_pool_size</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_api_bk_commit_interval">innodb_api_bk_commit_interval</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_api_disable_rowlock">innodb_api_disable_rowlock</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_api_enable_binlog">innodb_api_enable_binlog</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_api_enable_mdl">innodb_api_enable_mdl</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_api_trx_level">innodb_api_trx_level</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_autoextend_increment">innodb_autoextend_increment</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_autoinc_lock_mode">innodb_autoinc_lock_mode</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="server-administration.html#statvar_Innodb_available_undo_logs">Innodb_available_undo_logs</a></td><td> </td><td> </td><td> </td><td>Yes</td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_background_drop_list_empty">innodb_background_drop_list_empty</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td scope="row"><a class="link" href="server-administration.html#statvar_Innodb_buffer_pool_bytes_data">Innodb_buffer_pool_bytes_data</a></td><td> </td><td> </td><td> </td><td>Yes</td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="server-administration.html#statvar_Innodb_buffer_pool_bytes_dirty">Innodb_buffer_pool_bytes_dirty</a></td><td> </td><td> </td><td> </td><td>Yes</td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_chunk_size">innodb_buffer_pool_chunk_size</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_dump_at_shutdown">innodb_buffer_pool_dump_at_shutdown</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_dump_now">innodb_buffer_pool_dump_now</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_dump_pct">innodb_buffer_pool_dump_pct</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td scope="row"><a class="link" href="server-administration.html#statvar_Innodb_buffer_pool_dump_status">Innodb_buffer_pool_dump_status</a></td><td> </td><td> </td><td> </td><td>Yes</td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_filename">innodb_buffer_pool_filename</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_instances">innodb_buffer_pool_instances</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_load_abort">innodb_buffer_pool_load_abort</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_load_at_startup">innodb_buffer_pool_load_at_startup</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_load_now">innodb_buffer_pool_load_now</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td scope="row"><a class="link" href="server-administration.html#statvar_Innodb_buffer_pool_load_status">Innodb_buffer_pool_load_status</a></td><td> </td><td> </td><td> </td><td>Yes</td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="server-administration.html#statvar_Innodb_buffer_pool_pages_data">Innodb_buffer_pool_pages_data</a></td><td> </td><td> </td><td> </td><td>Yes</td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="server-administration.html#statvar_Innodb_buffer_pool_pages_dirty">Innodb_buffer_pool_pages_dirty</a></td><td> </td><td> </td><td> </td><td>Yes</td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="server-administration.html#statvar_Innodb_buffer_pool_pages_flushed">Innodb_buffer_pool_pages_flushed</a></td><td> </td><td> </td><td> </td><td>Yes</td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="server-administration.html#statvar_Innodb_buffer_pool_pages_free">Innodb_buffer_pool_pages_free</a></td><td> </td><td> </td><td> </td><td>Yes</td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="server-administration.html#statvar_Innodb_buffer_pool_pages_latched">Innodb_buffer_pool_pages_latched</a></td><td> </td><td> </td><td> </td><td>Yes</td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="server-administration.html#statvar_Innodb_buffer_pool_pages_misc">Innodb_buffer_pool_pages_misc</a></td><td> </td><td> </td><td> </td><td>Yes</td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="server-administration.html#statvar_Innodb_buffer_pool_pages_total">Innodb_buffer_pool_pages_total</a></td><td> </td><td> </td><td> </td><td>Yes</td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="server-administration.html#statvar_Innodb_buffer_pool_read_ahead">Innodb_buffer_pool_read_ahead</a></td><td> </td><td> </td><td> </td><td>Yes</td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="server-administration.html#statvar_Innodb_buffer_pool_read_ahead_evicted">Innodb_buffer_pool_read_ahead_evicted</a></td><td> </td><td> </td><td> </td><td>Yes</td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="server-administration.html#statvar_Innodb_buffer_pool_read_requests">Innodb_buffer_pool_read_requests</a></td><td> </td><td> </td><td> </td><td>Yes</td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="server-administration.html#statvar_Innodb_buffer_pool_reads">Innodb_buffer_pool_reads</a></td><td> </td><td> </td><td> </td><td>Yes</td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="server-administration.html#statvar_Innodb_buffer_pool_resize_status">Innodb_buffer_pool_resize_status</a></td><td> </td><td> </td><td> </td><td>Yes</td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_size">innodb_buffer_pool_size</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>Varies</td></tr><tr><td scope="row"><a class="link" href="server-administration.html#statvar_Innodb_buffer_pool_wait_free">Innodb_buffer_pool_wait_free</a></td><td> </td><td> </td><td> </td><td>Yes</td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="server-administration.html#statvar_Innodb_buffer_pool_write_requests">Innodb_buffer_pool_write_requests</a></td><td> </td><td> </td><td> </td><td>Yes</td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_change_buffer_max_size">innodb_change_buffer_max_size</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_change_buffering">innodb_change_buffering</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_change_buffering_debug">innodb_change_buffering_debug</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_checksum_algorithm">innodb_checksum_algorithm</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_checksums">innodb_checksums</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_cmp_per_index_enabled">innodb_cmp_per_index_enabled</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_commit_concurrency">innodb_commit_concurrency</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_compress_debug">innodb_compress_debug</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_compression_failure_threshold_pct">innodb_compression_failure_threshold_pct</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_compression_level">innodb_compression_level</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_compression_pad_pct_max">innodb_compression_pad_pct_max</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_concurrency_tickets">innodb_concurrency_tickets</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_create_intrinsic">innodb_create_intrinsic</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Session</td><td>Yes</td></tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_data_file_path">innodb_data_file_path</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="server-administration.html#statvar_Innodb_data_fsyncs">Innodb_data_fsyncs</a></td><td> </td><td> </td><td> </td><td>Yes</td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_data_home_dir">innodb_data_home_dir</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="server-administration.html#statvar_Innodb_data_pending_fsyncs">Innodb_data_pending_fsyncs</a></td><td> </td><td> </td><td> </td><td>Yes</td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="server-administration.html#statvar_Innodb_data_pending_reads">Innodb_data_pending_reads</a></td><td> </td><td> </td><td> </td><td>Yes</td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="server-administration.html#statvar_Innodb_data_pending_writes">Innodb_data_pending_writes</a></td><td> </td><td> </td><td> </td><td>Yes</td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="server-administration.html#statvar_Innodb_data_read">Innodb_data_read</a></td><td> </td><td> </td><td> </td><td>Yes</td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="server-administration.html#statvar_Innodb_data_reads">Innodb_data_reads</a></td><td> </td><td> </td><td> </td><td>Yes</td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="server-administration.html#statvar_Innodb_data_writes">Innodb_data_writes</a></td><td> </td><td> </td><td> </td><td>Yes</td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="server-administration.html#statvar_Innodb_data_written">Innodb_data_written</a></td><td> </td><td> </td><td> </td><td>Yes</td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="server-administration.html#statvar_Innodb_dblwr_pages_written">Innodb_dblwr_pages_written</a></td><td> </td><td> </td><td> </td><td>Yes</td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="server-administration.html#statvar_Innodb_dblwr_writes">Innodb_dblwr_writes</a></td><td> </td><td> </td><td> </td><td>Yes</td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_default_row_format">innodb_default_row_format</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_disable_resize_buffer_pool_debug">innodb_disable_resize_buffer_pool_debug</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_disable_sort_file_cache">innodb_disable_sort_file_cache</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_doublewrite">innodb_doublewrite</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_fast_shutdown">innodb_fast_shutdown</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_fil_make_page_dirty_debug">innodb_fil_make_page_dirty_debug</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_format">innodb_file_format</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_format_check">innodb_file_format_check</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_format_max">innodb_file_format_max</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_per_table">innodb_file_per_table</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_fill_factor">innodb_fill_factor</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_flush_log_at_timeout">innodb_flush_log_at_timeout</a></td><td> </td><td> </td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_flush_log_at_trx_commit">innodb_flush_log_at_trx_commit</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_flush_method">innodb_flush_method</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_flush_neighbors">innodb_flush_neighbors</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_flush_sync">innodb_flush_sync</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_flushing_avg_loops">innodb_flushing_avg_loops</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_force_load_corrupted">innodb_force_load_corrupted</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_force_recovery">innodb_force_recovery</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_ft_aux_table">innodb_ft_aux_table</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_ft_cache_size">innodb_ft_cache_size</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_ft_enable_diag_print">innodb_ft_enable_diag_print</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_ft_enable_stopword">innodb_ft_enable_stopword</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_ft_max_token_size">innodb_ft_max_token_size</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_ft_min_token_size">innodb_ft_min_token_size</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_ft_num_word_optimize">innodb_ft_num_word_optimize</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_ft_result_cache_limit">innodb_ft_result_cache_limit</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_ft_server_stopword_table">innodb_ft_server_stopword_table</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_ft_sort_pll_degree">innodb_ft_sort_pll_degree</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_ft_total_cache_size">innodb_ft_total_cache_size</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_ft_user_stopword_table">innodb_ft_user_stopword_table</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Both</td><td>Yes</td></tr><tr><td scope="row"><a class="link" href="server-administration.html#statvar_Innodb_have_atomic_builtins">Innodb_have_atomic_builtins</a></td><td> </td><td> </td><td> </td><td>Yes</td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_io_capacity">innodb_io_capacity</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_io_capacity_max">innodb_io_capacity_max</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_large_prefix">innodb_large_prefix</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_limit_optimistic_insert_debug">innodb_limit_optimistic_insert_debug</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_lock_wait_timeout">innodb_lock_wait_timeout</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Both</td><td>Yes</td></tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_locks_unsafe_for_binlog">innodb_locks_unsafe_for_binlog</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_log_buffer_size">innodb_log_buffer_size</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_log_checksum_algorithm">innodb_log_checksum_algorithm</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_log_checksums">innodb_log_checksums</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_log_compressed_pages">innodb_log_compressed_pages</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_log_file_size">innodb_log_file_size</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_log_files_in_group">innodb_log_files_in_group</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_log_group_home_dir">innodb_log_group_home_dir</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="server-administration.html#statvar_Innodb_log_waits">Innodb_log_waits</a></td><td> </td><td> </td><td> </td><td>Yes</td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_log_write_ahead_size">innodb_log_write_ahead_size</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td scope="row"><a class="link" href="server-administration.html#statvar_Innodb_log_write_requests">Innodb_log_write_requests</a></td><td> </td><td> </td><td> </td><td>Yes</td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="server-administration.html#statvar_Innodb_log_writes">Innodb_log_writes</a></td><td> </td><td> </td><td> </td><td>Yes</td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_lru_scan_depth">innodb_lru_scan_depth</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_max_dirty_pages_pct">innodb_max_dirty_pages_pct</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_max_dirty_pages_pct_lwm">innodb_max_dirty_pages_pct_lwm</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_max_purge_lag">innodb_max_purge_lag</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_max_purge_lag_delay">innodb_max_purge_lag_delay</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_max_undo_log_size">innodb_max_undo_log_size</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_merge_threshold_set_all_debug">innodb_merge_threshold_set_all_debug</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_monitor_disable">innodb_monitor_disable</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_monitor_enable">innodb_monitor_enable</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_monitor_reset">innodb_monitor_reset</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_monitor_reset_all">innodb_monitor_reset_all</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td scope="row"><a class="link" href="server-administration.html#statvar_Innodb_num_open_files">Innodb_num_open_files</a></td><td> </td><td> </td><td> </td><td>Yes</td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_numa_interleave">innodb_numa_interleave</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_old_blocks_pct">innodb_old_blocks_pct</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_old_blocks_time">innodb_old_blocks_time</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_online_alter_log_max_size">innodb_online_alter_log_max_size</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_open_files">innodb_open_files</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_optimize_fulltext_only">innodb_optimize_fulltext_only</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_optimize_point_storage">innodb_optimize_point_storage</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Session</td><td>Yes</td></tr><tr><td scope="row"><a class="link" href="server-administration.html#statvar_Innodb_os_log_fsyncs">Innodb_os_log_fsyncs</a></td><td> </td><td> </td><td> </td><td>Yes</td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="server-administration.html#statvar_Innodb_os_log_pending_fsyncs">Innodb_os_log_pending_fsyncs</a></td><td> </td><td> </td><td> </td><td>Yes</td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="server-administration.html#statvar_Innodb_os_log_pending_writes">Innodb_os_log_pending_writes</a></td><td> </td><td> </td><td> </td><td>Yes</td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="server-administration.html#statvar_Innodb_os_log_written">Innodb_os_log_written</a></td><td> </td><td> </td><td> </td><td>Yes</td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_page_cleaners">innodb_page_cleaners</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="server-administration.html#statvar_Innodb_page_size">Innodb_page_size</a></td><td> </td><td> </td><td> </td><td>Yes</td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_page_size">innodb_page_size</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="server-administration.html#statvar_Innodb_pages_created">Innodb_pages_created</a></td><td> </td><td> </td><td> </td><td>Yes</td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="server-administration.html#statvar_Innodb_pages_read">Innodb_pages_read</a></td><td> </td><td> </td><td> </td><td>Yes</td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="server-administration.html#statvar_Innodb_pages_written">Innodb_pages_written</a></td><td> </td><td> </td><td> </td><td>Yes</td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_print_all_deadlocks">innodb_print_all_deadlocks</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_purge_batch_size">innodb_purge_batch_size</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_purge_rseg_truncate_frequency">innodb_purge_rseg_truncate_frequency</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_purge_threads">innodb_purge_threads</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_random_read_ahead">innodb_random_read_ahead</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_read_ahead_threshold">innodb_read_ahead_threshold</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_read_io_threads">innodb_read_io_threads</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_read_only">innodb_read_only</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_replication_delay">innodb_replication_delay</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_rollback_on_timeout">innodb_rollback_on_timeout</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_rollback_segments">innodb_rollback_segments</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td scope="row"><a class="link" href="server-administration.html#statvar_Innodb_row_lock_current_waits">Innodb_row_lock_current_waits</a></td><td> </td><td> </td><td> </td><td>Yes</td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="server-administration.html#statvar_Innodb_row_lock_time">Innodb_row_lock_time</a></td><td> </td><td> </td><td> </td><td>Yes</td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="server-administration.html#statvar_Innodb_row_lock_time_avg">Innodb_row_lock_time_avg</a></td><td> </td><td> </td><td> </td><td>Yes</td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="server-administration.html#statvar_Innodb_row_lock_time_max">Innodb_row_lock_time_max</a></td><td> </td><td> </td><td> </td><td>Yes</td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="server-administration.html#statvar_Innodb_row_lock_waits">Innodb_row_lock_waits</a></td><td> </td><td> </td><td> </td><td>Yes</td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="server-administration.html#statvar_Innodb_rows_deleted">Innodb_rows_deleted</a></td><td> </td><td> </td><td> </td><td>Yes</td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="server-administration.html#statvar_Innodb_rows_inserted">Innodb_rows_inserted</a></td><td> </td><td> </td><td> </td><td>Yes</td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="server-administration.html#statvar_Innodb_rows_read">Innodb_rows_read</a></td><td> </td><td> </td><td> </td><td>Yes</td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="server-administration.html#statvar_Innodb_rows_updated">Innodb_rows_updated</a></td><td> </td><td> </td><td> </td><td>Yes</td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_saved_page_number_debug">innodb_saved_page_number_debug</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_sort_buffer_size">innodb_sort_buffer_size</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_spin_wait_delay">innodb_spin_wait_delay</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_stats_auto_recalc">innodb_stats_auto_recalc</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_stats_method">innodb_stats_method</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_stats_on_metadata">innodb_stats_on_metadata</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_stats_persistent">innodb_stats_persistent</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_stats_persistent_sample_pages">innodb_stats_persistent_sample_pages</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_stats_sample_pages">innodb_stats_sample_pages</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_stats_transient_sample_pages">innodb_stats_transient_sample_pages</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#option_mysqld_innodb-status-file">innodb-status-file</a></td><td>Yes</td><td>Yes</td><td> </td><td> </td><td> </td><td> </td></tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_status_output">innodb_status_output</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_status_output_locks">innodb_status_output_locks</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_strict_mode">innodb_strict_mode</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Both</td><td>Yes</td></tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_support_xa">innodb_support_xa</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Both</td><td>Yes</td></tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_sync_array_size">innodb_sync_array_size</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_sync_debug">innodb_sync_debug</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_sync_spin_loops">innodb_sync_spin_loops</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_table_locks">innodb_table_locks</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Both</td><td>Yes</td></tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_temp_data_file_path">innodb_temp_data_file_path</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_thread_concurrency">innodb_thread_concurrency</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_thread_sleep_delay">innodb_thread_sleep_delay</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_tmpdir">innodb_tmpdir</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Session</td><td>Yes</td></tr><tr><td scope="row"><a class="link" href="server-administration.html#statvar_Innodb_truncated_status_writes">Innodb_truncated_status_writes</a></td><td> </td><td> </td><td> </td><td>Yes</td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_trx_purge_view_update_only_debug">innodb_trx_purge_view_update_only_debug</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_trx_rseg_n_slots_debug">innodb_trx_rseg_n_slots_debug</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_undo_directory">innodb_undo_directory</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_undo_log_truncate">innodb_undo_log_truncate</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_undo_logs">innodb_undo_logs</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_undo_tablespaces">innodb_undo_tablespaces</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_use_native_aio">innodb_use_native_aio</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_use_sys_malloc">innodb_use_sys_malloc</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_version">innodb_version</a></td><td> </td><td> </td><td>Yes</td><td> </td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_write_io_threads">innodb_write_io_threads</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="server-administration.html#sysvar_mecab_rc_file">mecab_rc_file</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="server-administration.html#sysvar_ngram_token_size">ngram_token_size</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="server-administration.html#sysvar_timed_mutexes">timed_mutexes</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td scope="row"><a class="link" href="server-administration.html#sysvar_unique_checks">unique_checks</a></td><td> </td><td> </td><td>Yes</td><td> </td><td>Both</td><td>Yes</td></tr></tbody></table>
</div>

</div>
<br class="table-break">
<h3><a name="idm140644109602240"></a>InnoDB Command Options</h3>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a name="option_mysqld_ignore-builtin-innodb"></a>
          <a class="indexterm" name="idm140644109600400"></a>

          <a class="indexterm" name="idm140644109598944"></a>

          <code class="option">--ignore-builtin-innodb</code>
</p>
<div class="informaltable">
<table summary="Options for ignore-builtin-innodb" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Deprecated</strong></span></td><td colspan="3">5.5.22</td></tr><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--ignore-builtin-innodb</code></td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>System Variable</strong></span></td><td><span class="bold"><strong>Name</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_ignore_builtin_innodb">ignore_builtin_innodb</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="2">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="2">No</td></tr><tr><td scope="row"><span class="bold"><strong>Permitted Values</strong></span></td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">boolean</code></td></tr></tbody></table>
</div>
<p>
          In MySQL 5.1, this option caused the server to behave as if
          the built-in <code class="literal">InnoDB</code> were not present, which
          enabled <code class="literal">InnoDB Plugin</code> to be used instead.
          In MySQL 5.7, <code class="literal">InnoDB</code> is the
          default storage engine and <code class="literal">InnoDB Plugin</code> is
          not used, so this option is ignored.
        </p></li><li class="listitem"><p><a name="option_mysqld_innodb"></a>
          <a class="indexterm" name="idm140644109573584"></a>

          <a class="indexterm" name="idm140644109572128"></a>

          <code class="option">--innodb[=<em class="replaceable"><code>value</code></em>]</code>
</p>
<div class="informaltable">
<table summary="Options for innodb" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Deprecated</strong></span></td><td colspan="3">5.7.5</td></tr><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb[=value]</code></td></tr><tr><td scope="row" rowspan="5"><span class="bold"><strong>Permitted Values</strong></span></td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">enumeration</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">ON</code></td></tr><tr><td scope="row" rowspan="3" valign="top"><span class="bold"><strong>Valid Values</strong></span></td><td colspan="2"><code class="literal">OFF</code></td></tr><tr><td scope="row" colspan="2"><code class="literal">ON</code></td></tr><tr><td scope="row" colspan="2"><code class="literal">FORCE</code></td></tr></tbody></table>
</div>
<p>
          Controls loading of the <code class="literal">InnoDB</code> storage
          engine, if the server was compiled with
          <code class="literal">InnoDB</code> support. This option has a tristate
          format, with possible values of <code class="literal">OFF</code>,
          <code class="literal">ON</code>, or <code class="literal">FORCE</code>. See
          <a class="xref" href="server-administration.html#server-plugin-loading" title="5.1.8.1 Installing and Uninstalling Plugins">Section 5.1.8.1, “Installing and Uninstalling Plugins”</a>.
        </p><p>
          To disable <code class="literal">InnoDB</code>, use
          <a class="link" href="innodb-storage-engine.html#option_mysqld_innodb"><code class="option">--innodb=OFF</code></a>
          or
          <a class="link" href="innodb-storage-engine.html#option_mysqld_innodb"><code class="option">--skip-innodb</code></a>.
          In this case, because the default storage engine is
          <a class="link" href="innodb-storage-engine.html" title="Chapter 14 The InnoDB Storage Engine"><code class="literal">InnoDB</code></a>, the server will not start
          unless you also use
          <a class="link" href="server-administration.html#sysvar_default_storage_engine"><code class="option">--default-storage-engine</code></a> and
          <a class="link" href="server-administration.html#sysvar_default_tmp_storage_engine"><code class="option">--default-tmp-storage-engine</code></a> to
          set the default to some other engine for both permanent and
          <code class="literal">TEMPORARY</code> tables.
        </p><p>
          As of MySQL 5.7.5, the <code class="literal">InnoDB</code> storage
          engine can no longer be disabled, and the
          <a class="link" href="innodb-storage-engine.html#option_mysqld_innodb"><code class="option">--innodb=OFF</code></a>
          and
          <a class="link" href="innodb-storage-engine.html#option_mysqld_innodb"><code class="option">--skip-innodb</code></a>
          options are deprecated and have no effect. Their use results
          in a warning. These options will be removed in a future MySQL
          release.
        </p></li><li class="listitem"><p><a name="option_mysqld_innodb-status-file"></a>
          <a class="indexterm" name="idm140644109534464"></a>

          <a class="indexterm" name="idm140644109533008"></a>

          <code class="option">--innodb-status-file</code>
</p>
<div class="informaltable">
<table summary="Options for innodb-status-file" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb-status-file</code></td></tr><tr><td scope="row" rowspan="2"><span class="bold"><strong>Permitted Values</strong></span></td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">boolean</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">OFF</code></td></tr></tbody></table>
</div>
<p>
          Controls whether <code class="literal">InnoDB</code> creates a file
          named
          <code class="filename">innodb_status.<em class="replaceable"><code>pid</code></em></code>
          in the MySQL data directory. If enabled,
          <code class="literal">InnoDB</code> periodically writes the output of
          <a class="link" href="sql-syntax.html#show-engine" title="13.7.5.15 SHOW ENGINE Syntax"><code class="literal">SHOW ENGINE
          INNODB STATUS</code></a> to this file.
        </p><p>
          By default, the file is not created. To create it, start
          <a class="link" href="programs.html#mysqld" title="4.3.1 mysqld — The MySQL Server"><span class="command"><strong>mysqld</strong></span></a> with the
          <code class="option">--innodb-status-file=1</code> option. The file is
          deleted during normal shutdown.
        </p></li><li class="listitem"><p>
          <a class="indexterm" name="idm140644109511600"></a>

          <a class="indexterm" name="idm140644109510112"></a>

          <a class="link" href="innodb-storage-engine.html#option_mysqld_innodb"><code class="option">--skip-innodb</code></a>
        </p><p>
          Disable the <code class="literal">InnoDB</code> storage engine. See the
          description of <a class="link" href="innodb-storage-engine.html#option_mysqld_innodb"><code class="option">--innodb</code></a>.
</p></li></ul>
</div>
<h3><a name="idm140644109505184"></a>InnoDB System Variables</h3>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a name="sysvar_daemon_memcached_enable_binlog"></a>
          <a class="indexterm" name="idm140644109503216"></a>

          <code class="literal">daemon_memcached_enable_binlog</code>
</p>
<div class="informaltable">
<table summary="Options for daemon_memcached_enable_binlog" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--daemon_memcached_enable_binlog=#</code></td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>System Variable</strong></span></td><td><span class="bold"><strong>Name</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_daemon_memcached_enable_binlog">daemon_memcached_enable_binlog</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="2">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="2">No</td></tr><tr><td scope="row" rowspan="2"><span class="bold"><strong>Permitted Values</strong></span></td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">boolean</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">false</code></td></tr></tbody></table>
</div>
<p>
          See <a class="xref" href="innodb-storage-engine.html#innodb-memcached" title="14.17 InnoDB memcached Plugin">Section 14.17, “InnoDB memcached Plugin”</a> for usage details for
          this option.
        </p></li><li class="listitem"><p><a name="sysvar_daemon_memcached_engine_lib_name"></a>
          <a class="indexterm" name="idm140644109479936"></a>

          <code class="literal">daemon_memcached_engine_lib_name</code>
</p>
<div class="informaltable">
<table summary="Options for daemon_memcached_engine_lib_name" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--daemon_memcached_engine_lib_name=library</code></td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>System Variable</strong></span></td><td><span class="bold"><strong>Name</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_daemon_memcached_engine_lib_name">daemon_memcached_engine_lib_name</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="2">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="2">No</td></tr><tr><td scope="row" rowspan="2"><span class="bold"><strong>Permitted Values</strong></span></td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">file name</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">innodb_engine.so</code></td></tr></tbody></table>
</div>
<p>
          Specifies the shared library that implements the
          <code class="literal">InnoDB</code> <span class="command"><strong>memcached</strong></span> plugin.
        </p><p>
          See <a class="xref" href="innodb-storage-engine.html#innodb-memcached" title="14.17 InnoDB memcached Plugin">Section 14.17, “InnoDB memcached Plugin”</a> for usage details for
          this option.
        </p></li><li class="listitem"><p><a name="sysvar_daemon_memcached_engine_lib_path"></a>
          <a class="indexterm" name="idm140644109454800"></a>

          <code class="literal">daemon_memcached_engine_lib_path</code>
</p>
<div class="informaltable">
<table summary="Options for daemon_memcached_engine_lib_path" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--daemon_memcached_engine_lib_path=directory</code></td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>System Variable</strong></span></td><td><span class="bold"><strong>Name</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_daemon_memcached_engine_lib_path">daemon_memcached_engine_lib_path</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="2">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="2">No</td></tr><tr><td scope="row" rowspan="2"><span class="bold"><strong>Permitted Values</strong></span></td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">directory name</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">NULL</code></td></tr></tbody></table>
</div>
<p>
          The path of the directory containing the shared library that
          implements the <code class="literal">InnoDB</code>
          <span class="command"><strong>memcached</strong></span> plugin. The default value is
          NULL, representing the MySQL plugin directory. You should not
          need to modify this parameter unless specifying a different
          storage engine <code class="literal">memcached</code> plugin that is
          located outside of the MySQL plugin directory.
        </p><p>
          See <a class="xref" href="innodb-storage-engine.html#innodb-memcached" title="14.17 InnoDB memcached Plugin">Section 14.17, “InnoDB memcached Plugin”</a> for usage details for
          this option.
        </p></li><li class="listitem"><p><a name="sysvar_daemon_memcached_option"></a>
          <a class="indexterm" name="idm140644109428672"></a>

          <code class="literal">daemon_memcached_option</code>
</p>
<div class="informaltable">
<table summary="Options for daemon_memcached_option" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--daemon_memcached_option=options</code></td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>System Variable</strong></span></td><td><span class="bold"><strong>Name</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_daemon_memcached_option">daemon_memcached_option</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="2">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="2">No</td></tr><tr><td scope="row" rowspan="2"><span class="bold"><strong>Permitted Values</strong></span></td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">string</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal"></code></td></tr></tbody></table>
</div>
<p>
          Used to pass space-separated memcached options to the
          underlying <span class="command"><strong>memcached</strong></span> memory object caching
          daemon on startup. For example, you might change the port that
          <span class="command"><strong>memcached</strong></span> listens on, reduce the maximum
          number of simultaneous connections, change the maximum memory
          size for a key/value pair, or enable debugging messages for
          the error log.
        </p><p>
          See <a class="xref" href="innodb-storage-engine.html#innodb-memcached" title="14.17 InnoDB memcached Plugin">Section 14.17, “InnoDB memcached Plugin”</a> for usage details for
          this option. For information about memcached options, refer to
          the memcached man page.
        </p></li><li class="listitem"><p><a name="sysvar_daemon_memcached_r_batch_size"></a>
          <a class="indexterm" name="idm140644109403344"></a>

          <code class="literal">daemon_memcached_r_batch_size</code>
</p>
<div class="informaltable">
<table summary="Options for daemon_memcached_r_batch_size" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--daemon_memcached_r_batch_size=#</code></td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>System Variable</strong></span></td><td><span class="bold"><strong>Name</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_daemon_memcached_r_batch_size">daemon_memcached_r_batch_size</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="2">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="2">No</td></tr><tr><td scope="row" rowspan="2"><span class="bold"><strong>Permitted Values</strong></span></td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">integer</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">1</code></td></tr></tbody></table>
</div>
<p>
          Specifies how many <span class="command"><strong>memcached</strong></span> read
          operations (<code class="literal">get</code>) to perform before doing a
          <a class="link" href="sql-syntax.html#commit" title="13.3.1 START TRANSACTION, COMMIT, and ROLLBACK Syntax"><code class="literal">COMMIT</code></a> to start a new
          transaction. Counterpart of
          <a class="link" href="innodb-storage-engine.html#sysvar_daemon_memcached_w_batch_size"><code class="literal">daemon_memcached_w_batch_size</code></a>.
        </p><p>
          This value is set to 1 by default, so that any changes made to
          the table through SQL statements are immediately visible to
          the <span class="command"><strong>memcached</strong></span> operations. You might
          increase it to reduce the overhead from frequent commits on a
          system where the underlying table is only being accessed
          through the <span class="command"><strong>memcached</strong></span> interface. If you set
          the value too large, the amount of undo or redo data could
          impose some storage overhead, as with any long-running
          transaction.
        </p><p>
          See <a class="xref" href="innodb-storage-engine.html#innodb-memcached" title="14.17 InnoDB memcached Plugin">Section 14.17, “InnoDB memcached Plugin”</a> for usage details for
          this option.
        </p></li><li class="listitem"><p><a name="sysvar_daemon_memcached_w_batch_size"></a>
          <a class="indexterm" name="idm140644109373344"></a>

          <code class="literal">daemon_memcached_w_batch_size</code>
</p>
<div class="informaltable">
<table summary="Options for daemon_memcached_w_batch_size" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--daemon_memcached_w_batch_size=#</code></td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>System Variable</strong></span></td><td><span class="bold"><strong>Name</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_daemon_memcached_w_batch_size">daemon_memcached_w_batch_size</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="2">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="2">No</td></tr><tr><td scope="row" rowspan="2"><span class="bold"><strong>Permitted Values</strong></span></td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">integer</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">1</code></td></tr></tbody></table>
</div>
<p>
          Specifies how many <span class="command"><strong>memcached</strong></span> write
          operations, such as <code class="literal">add</code>,
          <code class="literal">set</code>, or <code class="literal">incr</code>, to perform
          before doing a <a class="link" href="sql-syntax.html#commit" title="13.3.1 START TRANSACTION, COMMIT, and ROLLBACK Syntax"><code class="literal">COMMIT</code></a> to start
          a new transaction. Counterpart of
          <a class="link" href="innodb-storage-engine.html#sysvar_daemon_memcached_r_batch_size"><code class="literal">daemon_memcached_r_batch_size</code></a>.
        </p><p>
          This value is set to 1 by default, on the assumption that any
          data being stored is important to preserve in case of an
          outage and should immediately be committed. When storing
          non-critical data, you might increase this value to reduce the
          overhead from frequent commits; but then the last
          <em class="replaceable"><code>N</code></em>-1 uncommitted write operations
          could be lost in case of a crash.
        </p><p>
          See <a class="xref" href="innodb-storage-engine.html#innodb-memcached" title="14.17 InnoDB memcached Plugin">Section 14.17, “InnoDB memcached Plugin”</a> for usage details for
          this option.
        </p></li><li class="listitem"><p><a name="sysvar_ignore_builtin_innodb"></a>
          <a class="indexterm" name="idm140644109343008"></a>

          <a class="indexterm" name="idm140644109342000"></a>

          <code class="literal">ignore_builtin_innodb</code>
</p>
<div class="informaltable">
<table summary="Options for ignore-builtin-innodb" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Deprecated</strong></span></td><td colspan="3">5.5.22</td></tr><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--ignore-builtin-innodb</code></td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>System Variable</strong></span></td><td><span class="bold"><strong>Name</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_ignore_builtin_innodb">ignore_builtin_innodb</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="2">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="2">No</td></tr><tr><td scope="row"><span class="bold"><strong>Permitted Values</strong></span></td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">boolean</code></td></tr></tbody></table>
</div>
<p>
          See the description of
          <a class="link" href="innodb-storage-engine.html#option_mysqld_ignore-builtin-innodb"><code class="option">--ignore-builtin-innodb</code></a> under
          <span class="quote">“<span class="quote"><code class="literal">InnoDB</code> Command Options</span>”</span>
          earlier in this section.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_adaptive_flushing"></a>
          <a class="indexterm" name="idm140644109317424"></a>

          <a class="indexterm" name="idm140644109316320"></a>

          <code class="literal">innodb_adaptive_flushing</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_adaptive_flushing" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_adaptive_flushing=#</code></td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>System Variable</strong></span></td><td><span class="bold"><strong>Name</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_adaptive_flushing">innodb_adaptive_flushing</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="2">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="2">Yes</td></tr><tr><td scope="row" rowspan="2"><span class="bold"><strong>Permitted Values</strong></span></td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">boolean</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">ON</code></td></tr></tbody></table>
</div>
<a class="indexterm" name="idm140644109294992"></a><p>
          Specifies whether to dynamically adjust the rate of flushing
          <a class="link" href="glossary.html#glos_dirty_page" title="dirty page">dirty pages</a> in the
          <code class="literal">InnoDB</code>
          <a class="link" href="glossary.html#glos_buffer_pool" title="buffer pool">buffer pool</a> based on
          the workload. Adjusting the flush rate dynamically is intended
          to avoid bursts of I/O activity. This setting is enabled by
          default. See
          <a class="xref" href="innodb-storage-engine.html#innodb-performance-adaptive_flushing" title="14.3.3.2 Configuring the Rate of InnoDB Buffer Pool Flushing">Section 14.3.3.2, “Configuring the Rate of InnoDB Buffer Pool Flushing”</a> for
          more information. For general I/O tuning advice, see
          <a class="xref" href="optimization.html#optimizing-innodb-diskio" title="8.5.8 Optimizing InnoDB Disk I/O">Section 8.5.8, “Optimizing InnoDB Disk I/O”</a>.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_adaptive_flushing_lwm"></a>
          <a class="indexterm" name="idm140644109288288"></a>

          <code class="literal">innodb_adaptive_flushing_lwm</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_adaptive_flushing_lwm" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_adaptive_flushing_lwm=#</code></td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>System Variable</strong></span></td><td><span class="bold"><strong>Name</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_adaptive_flushing_lwm">innodb_adaptive_flushing_lwm</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="2">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="2">Yes</td></tr><tr><td scope="row" rowspan="4"><span class="bold"><strong>Permitted Values</strong></span></td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">integer</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">10</code></td></tr><tr><td scope="row"><span class="bold"><strong>Min Value</strong></span></td><td colspan="2"><code class="literal">0</code></td></tr><tr><td scope="row"><span class="bold"><strong>Max Value</strong></span></td><td colspan="2"><code class="literal">70</code></td></tr></tbody></table>
</div>
<p>
          Low water mark representing percentage of
          <a class="link" href="glossary.html#glos_redo_log" title="redo log">redo log</a> capacity at
          which <a class="link" href="glossary.html#glos_adaptive_flushing" title="adaptive flushing">adaptive
          flushing</a> is enabled.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_adaptive_hash_index"></a>
          <a class="indexterm" name="idm140644109259616"></a>

          <a class="indexterm" name="idm140644109258512"></a>

          <code class="literal">innodb_adaptive_hash_index</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_adaptive_hash_index" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_adaptive_hash_index=#</code></td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>System Variable</strong></span></td><td><span class="bold"><strong>Name</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_adaptive_hash_index">innodb_adaptive_hash_index</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="2">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="2">Yes</td></tr><tr><td scope="row" rowspan="2"><span class="bold"><strong>Permitted Values</strong></span></td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">boolean</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">ON</code></td></tr></tbody></table>
</div>
<p>
          Whether the <code class="literal">InnoDB</code>
          <a class="link" href="glossary.html#glos_adaptive_hash_index" title="adaptive hash index">adaptive hash
          index</a> is enabled or disabled. It may be desirable,
          depending on your workload, to dynamically enable or disable
          <a class="link" href="glossary.html#glos_adaptive_hash_index" title="adaptive hash index">adaptive hash
          indexing</a> to improve query performance. Because the
          adaptive hash index may not be useful for all workloads,
          conduct benchmarks with it both enabled and disabled, using
          realistic workloads. See
          <a class="xref" href="innodb-storage-engine.html#innodb-adaptive-hash" title="14.2.7.6 Adaptive Hash Indexes">Section 14.2.7.6, “Adaptive Hash Indexes”</a> for details.
        </p><p>
          This variable is enabled by default. You can modify this
          parameter using the <code class="literal">SET GLOBAL</code> statement,
          without restarting the server. Changing the setting requires
          the <code class="literal">SUPER</code> privilege. You can also use
          <code class="option">--skip-innodb_adaptive_hash_index</code> at server
          startup to disable it.
        </p><p>
          Disabling the adaptive hash index empties the hash table
          immediately. Normal operations can continue while the hash
          table is emptied, and executing queries that were using the
          hash table access the index B-trees directly instead. When the
          adaptive hash index is re-enabled, the hash table is populated
          again during normal operation.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_adaptive_hash_index_parts"></a>
          <a class="indexterm" name="idm140644109228832"></a>

          <a class="indexterm" name="idm140644109227728"></a>

          <code class="literal">innodb_adaptive_hash_index_parts</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_adaptive_hash_index_parts" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Introduced</strong></span></td><td colspan="3">5.7.8</td></tr><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_adaptive_hash_index_parts=#</code></td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>System Variable</strong></span></td><td><span class="bold"><strong>Name</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_adaptive_hash_index_parts">innodb_adaptive_hash_index_parts</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="2">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="2">No</td></tr><tr><td scope="row" rowspan="4"><span class="bold"><strong>Permitted Values</strong></span></td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">numeric</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">8</code></td></tr><tr><td scope="row"><span class="bold"><strong>Min Value</strong></span></td><td colspan="2"><code class="literal">1</code></td></tr><tr><td scope="row"><span class="bold"><strong>Max Value</strong></span></td><td colspan="2"><code class="literal">512</code></td></tr></tbody></table>
</div>
<p>
          Partitions the adaptive hash index search system. Each index
          is bound to a specific partition, with each partition
          protected by a separate latch.
        </p><p>
          Prior to MySQL 5.7.8, the adaptive hash index search system
          was protected by a single latch
          (<code class="literal">btr_search_latch</code>) which could become a
          point of contention. With the introduction of the
          <code class="literal">innodb_adaptive_hash_index_parts</code> option,
          the search system is partitioned into 8 parts by default. The
          maximum setting is 512.
        </p><p>
          For related information, see
          <a class="xref" href="innodb-storage-engine.html#innodb-adaptive-hash" title="14.2.7.6 Adaptive Hash Indexes">Section 14.2.7.6, “Adaptive Hash Indexes”</a>.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_adaptive_max_sleep_delay"></a>
          <a class="indexterm" name="idm140644109195088"></a>

          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_adaptive_max_sleep_delay"><code class="literal">innodb_adaptive_max_sleep_delay</code></a>
</p>
<div class="informaltable">
<table summary="Options for innodb_adaptive_max_sleep_delay" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_adaptive_max_sleep_delay=#</code></td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>System Variable</strong></span></td><td><span class="bold"><strong>Name</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_adaptive_max_sleep_delay">innodb_adaptive_max_sleep_delay</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="2">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="2">Yes</td></tr><tr><td scope="row" rowspan="4"><span class="bold"><strong>Permitted Values</strong></span></td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">integer</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">150000</code></td></tr><tr><td scope="row"><span class="bold"><strong>Min Value</strong></span></td><td colspan="2"><code class="literal">0</code></td></tr><tr><td scope="row"><span class="bold"><strong>Max Value</strong></span></td><td colspan="2"><code class="literal">1000000</code></td></tr></tbody></table>
</div>
<p>
          Allows <code class="literal">InnoDB</code> to automatically adjust the
          value of
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_thread_sleep_delay"><code class="literal">innodb_thread_sleep_delay</code></a> up
          or down according to the current workload. Any non-zero value
          enables automated, dynamic adjustment of the
          <code class="literal">innodb_thread_sleep_delay</code> value, up to the
          maximum value specified in the
          <code class="literal">innodb_adaptive_max_sleep_delay</code> option. The
          value represents the number of microseconds. This option can
          be useful in busy systems, with greater than 16
          <code class="literal">InnoDB</code> threads. (In practice, it is most
          valuable for MySQL systems with hundreds or thousands of
          simultaneous connections.)
        </p><p>
          For more information, see
          <a class="xref" href="innodb-storage-engine.html#innodb-performance-thread_concurrency" title="14.3.6 Configuring Thread Concurrency for InnoDB">Section 14.3.6, “Configuring Thread Concurrency for InnoDB”</a>.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_additional_mem_pool_size"></a>
          <a class="indexterm" name="idm140644109161712"></a>

          <a class="indexterm" name="idm140644109160608"></a>

          <code class="literal">innodb_additional_mem_pool_size</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_additional_mem_pool_size" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Deprecated</strong></span></td><td colspan="3">5.6.3</td></tr><tr><td scope="row"><span class="bold"><strong>Removed</strong></span></td><td colspan="3">5.7.4</td></tr><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_additional_mem_pool_size=#</code></td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>System Variable</strong></span></td><td><span class="bold"><strong>Name</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_additional_mem_pool_size">innodb_additional_mem_pool_size</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="2">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="2">No</td></tr><tr><td scope="row" rowspan="4"><span class="bold"><strong>Permitted Values</strong></span></td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">integer</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">8388608</code></td></tr><tr><td scope="row"><span class="bold"><strong>Min Value</strong></span></td><td colspan="2"><code class="literal">2097152</code></td></tr><tr><td scope="row"><span class="bold"><strong>Max Value</strong></span></td><td colspan="2"><code class="literal">4294967295</code></td></tr></tbody></table>
</div>
<p>
          The size in bytes of a memory pool <code class="literal">InnoDB</code>
          uses to store <a class="link" href="glossary.html#glos_data_dictionary" title="data dictionary">data
          dictionary</a> information and other internal data
          structures. The more tables you have in your application, the
          more memory you allocate here. If <code class="literal">InnoDB</code>
          runs out of memory in this pool, it starts to allocate memory
          from the operating system and writes warning messages to the
          MySQL error log. The default value is 8MB.
        </p><p>
          This variable relates to the <code class="literal">InnoDB</code>
          internal memory allocator, which is unused if
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_use_sys_malloc"><code class="literal">innodb_use_sys_malloc</code></a> is
          enabled.
        </p><p>
          <code class="literal">innodb_additional_mem_pool_size</code> was
          deprecated in MySQL 5.6.3 and removed in MySQL 5.7.4.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_api_bk_commit_interval"></a>
          <a class="indexterm" name="idm140644109123152"></a>

          <code class="literal">innodb_api_bk_commit_interval</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_api_bk_commit_interval" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_api_bk_commit_interval=#</code></td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>System Variable</strong></span></td><td><span class="bold"><strong>Name</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_api_bk_commit_interval">innodb_api_bk_commit_interval</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="2">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="2">Yes</td></tr><tr><td scope="row" rowspan="4"><span class="bold"><strong>Permitted Values</strong></span></td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">integer</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">5</code></td></tr><tr><td scope="row"><span class="bold"><strong>Min Value</strong></span></td><td colspan="2"><code class="literal">1</code></td></tr><tr><td scope="row"><span class="bold"><strong>Max Value</strong></span></td><td colspan="2"><code class="literal">1073741824 </code></td></tr></tbody></table>
</div>
<p>
          How often to auto-commit idle connections that use the
          <code class="literal">InnoDB</code> <span class="command"><strong>memcached</strong></span>
          interface, in seconds. See <a class="xref" href="innodb-storage-engine.html#innodb-memcached" title="14.17 InnoDB memcached Plugin">Section 14.17, “InnoDB memcached Plugin”</a>
          for usage details for this option.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_api_disable_rowlock"></a>
          <a class="indexterm" name="idm140644109093968"></a>

          <code class="literal">innodb_api_disable_rowlock</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_api_disable_rowlock" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_api_disable_rowlock=#</code></td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>System Variable</strong></span></td><td><span class="bold"><strong>Name</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_api_disable_rowlock">innodb_api_disable_rowlock</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="2">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="2">No</td></tr><tr><td scope="row" rowspan="2"><span class="bold"><strong>Permitted Values</strong></span></td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">boolean</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">OFF</code></td></tr></tbody></table>
</div>
<p>
          Use this variable to disable row locks when
          <code class="literal">InnoDB</code> <span class="command"><strong>memcached</strong></span>
          performs DML operations. By default,
          <code class="literal">innodb_api_disable_rowlock</code> is set to
          <code class="literal">OFF</code> which means that
          <span class="command"><strong>memcached</strong></span> requests row locks for get and
          set operations. When
          <code class="literal">innodb_api_disable_rowlock</code> is set to
          <code class="literal">ON</code>, <span class="command"><strong>memcached</strong></span> requests a
          table lock instead of row locks.
        </p><p>
          The <code class="literal">innodb_api_disable_rowlock</code> option is
          not dynamic. It must be specified on the
          <a class="link" href="programs.html#mysqld" title="4.3.1 mysqld — The MySQL Server"><span class="command"><strong>mysqld</strong></span></a> command line or entered in the MySQL
          configuration file. Configuration takes effect when the plugin
          is installed, which you do each time the MySQL server is
          started.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_api_enable_binlog"></a>
          <a class="indexterm" name="idm140644109062976"></a>

          <code class="literal">innodb_api_enable_binlog</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_api_enable_binlog" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_api_enable_binlog=#</code></td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>System Variable</strong></span></td><td><span class="bold"><strong>Name</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_api_enable_binlog">innodb_api_enable_binlog</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="2">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="2">No</td></tr><tr><td scope="row" rowspan="2"><span class="bold"><strong>Permitted Values</strong></span></td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">boolean</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">OFF</code></td></tr></tbody></table>
</div>
<p>
          Lets you use the <code class="literal">InnoDB</code>
          <span class="command"><strong>memcached</strong></span> plugin with the MySQL
          <a class="link" href="glossary.html#glos_binary_log" title="binary log">binary log</a>. See
          <a class="xref" href="innodb-storage-engine.html#innodb-memcached" title="14.17 InnoDB memcached Plugin">Section 14.17, “InnoDB memcached Plugin”</a> for usage details for this
          option.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_api_enable_mdl"></a>
          <a class="indexterm" name="idm140644109037296"></a>

          <code class="literal">innodb_api_enable_mdl</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_api_enable_mdl" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_api_enable_mdl=#</code></td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>System Variable</strong></span></td><td><span class="bold"><strong>Name</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_api_enable_mdl">innodb_api_enable_mdl</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="2">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="2">No</td></tr><tr><td scope="row" rowspan="2"><span class="bold"><strong>Permitted Values</strong></span></td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">boolean</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">OFF</code></td></tr></tbody></table>
</div>
<p>
          Locks the table used by the <code class="literal">InnoDB</code>
          <span class="command"><strong>memcached</strong></span> plugin, so that it cannot be
          dropped or altered by <a class="link" href="glossary.html#glos_ddl" title="DDL">DDL</a>
          through the SQL interface. See
          <a class="xref" href="innodb-storage-engine.html#innodb-memcached" title="14.17 InnoDB memcached Plugin">Section 14.17, “InnoDB memcached Plugin”</a> for usage details for this
          option.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_api_trx_level"></a>
          <a class="indexterm" name="idm140644109011840"></a>

          <code class="literal">innodb_api_trx_level</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_api_trx_level" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_api_trx_level=#</code></td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>System Variable</strong></span></td><td><span class="bold"><strong>Name</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_api_trx_level">innodb_api_trx_level</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="2">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="2">Yes</td></tr><tr><td scope="row" rowspan="2"><span class="bold"><strong>Permitted Values</strong></span></td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">integer</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">0</code></td></tr></tbody></table>
</div>
<p>
          Lets you control the transaction
          <a class="link" href="glossary.html#glos_isolation_level" title="isolation level">isolation level</a> on
          queries processed by the <span class="command"><strong>memcached</strong></span>
          interface. See <a class="xref" href="innodb-storage-engine.html#innodb-memcached" title="14.17 InnoDB memcached Plugin">Section 14.17, “InnoDB memcached Plugin”</a> for usage
          details for this option. The constants corresponding to the
          familiar names are:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
              0 = <a class="link" href="sql-syntax.html#isolevel_read-uncommitted"><code class="literal">READ UNCOMMITTED</code></a>
            </p></li><li class="listitem"><p>
              1 = <a class="link" href="sql-syntax.html#isolevel_read-committed"><code class="literal">READ COMMITTED</code></a>
            </p></li><li class="listitem"><p>
              2 = <a class="link" href="sql-syntax.html#isolevel_repeatable-read"><code class="literal">REPEATABLE READ</code></a>
            </p></li><li class="listitem"><p>
              3 = <a class="link" href="sql-syntax.html#isolevel_serializable"><code class="literal">SERIALIZABLE</code></a>
</p></li></ul>
</div>
</li><li class="listitem"><p><a name="sysvar_innodb_autoextend_increment"></a>
          <a class="indexterm" name="idm140644108978592"></a>

          <a class="indexterm" name="idm140644108977488"></a>

          <code class="literal">innodb_autoextend_increment</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_autoextend_increment" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_autoextend_increment=#</code></td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>System Variable</strong></span></td><td><span class="bold"><strong>Name</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_autoextend_increment">innodb_autoextend_increment</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="2">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="2">Yes</td></tr><tr><td scope="row" rowspan="4"><span class="bold"><strong>Permitted Values</strong></span></td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">integer</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">64</code></td></tr><tr><td scope="row"><span class="bold"><strong>Min Value</strong></span></td><td colspan="2"><code class="literal">1</code></td></tr><tr><td scope="row"><span class="bold"><strong>Max Value</strong></span></td><td colspan="2"><code class="literal">1000</code></td></tr></tbody></table>
</div>
<p>
          The increment size (in MB) for extending the size of an
          auto-extend <code class="literal">InnoDB</code>
          <a class="link" href="glossary.html#glos_system_tablespace" title="system tablespace">system
          tablespace</a> file when it becomes full. The default value
          is 64. This variable does not affect file-per-table
          (<code class="filename">.ibd</code>) data files that are created if you
          use <a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_per_table"><code class="literal">innodb_file_per_table=1</code></a>,
          or general tablespace <code class="filename">.ibd</code> data files.
          Those files are auto-extending regardless of the value of
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_autoextend_increment"><code class="literal">innodb_autoextend_increment</code></a>.
          The initial extensions are by small amounts, after which
          extensions occur in increments of 4MB.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_autoinc_lock_mode"></a>
          <a class="indexterm" name="idm140644108944208"></a>

          <a class="indexterm" name="idm140644108943104"></a>

          <code class="literal">innodb_autoinc_lock_mode</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_autoinc_lock_mode" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_autoinc_lock_mode=#</code></td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>System Variable</strong></span></td><td><span class="bold"><strong>Name</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_autoinc_lock_mode">innodb_autoinc_lock_mode</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="2">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="2">No</td></tr><tr><td scope="row" rowspan="5"><span class="bold"><strong>Permitted Values</strong></span></td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">integer</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">1</code></td></tr><tr><td scope="row" rowspan="3" valign="top"><span class="bold"><strong>Valid Values</strong></span></td><td colspan="2"><code class="literal">0</code></td></tr><tr><td scope="row" colspan="2"><code class="literal">1</code></td></tr><tr><td scope="row" colspan="2"><code class="literal">2</code></td></tr></tbody></table>
</div>
<p>
          The <a class="link" href="glossary.html#glos_lock_mode" title="lock mode">lock mode</a> to use for
          generating
          <a class="link" href="glossary.html#glos_auto_increment" title="auto-increment">auto-increment</a>
          values. The permissible values are 0, 1, or 2, for
          <span class="quote">“<span class="quote">traditional</span>”</span>, <span class="quote">“<span class="quote">consecutive</span>”</span>, or
          <span class="quote">“<span class="quote">interleaved</span>”</span> lock mode, respectively.
          <a class="xref" href="innodb-storage-engine.html#innodb-auto-increment-handling" title="14.5.5 AUTO_INCREMENT Handling in InnoDB">Section 14.5.5, “AUTO_INCREMENT Handling in InnoDB”</a>, describes
          the characteristics of these modes.
        </p><p>
          This variable has a default of 1 (<span class="quote">“<span class="quote">consecutive</span>”</span>
          lock mode).
        </p></li><li class="listitem"><p><a name="sysvar_innodb_background_drop_list_empty"></a>
          <a class="indexterm" name="idm140644108909760"></a>

          <a class="indexterm" name="idm140644108908720"></a>

          <code class="literal">innodb_background_drop_list_empty</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_background_drop_list_empty" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Introduced</strong></span></td><td colspan="3">5.7.10</td></tr><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_background_drop_list_empty=#</code></td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>System Variable</strong></span></td><td><span class="bold"><strong>Name</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_background_drop_list_empty">innodb_background_drop_list_empty</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="2">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="2">Yes</td></tr><tr><td scope="row" rowspan="2"><span class="bold"><strong>Permitted Values</strong></span></td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">boolean</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">OFF</code></td></tr></tbody></table>
</div>
<p>
          Enabling the
          <code class="literal">innodb_background_drop_list_empty</code> debug
          option helps avoid test case failures by delaying table
          creation until the background drop list is empty. For example,
          if test case A places table <code class="literal">t1</code> on the
          background drop list, test case B waits until the background
          drop list is empty before creating table
          <code class="literal">t1</code>.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_buffer_pool_chunk_size"></a>
          <a class="indexterm" name="idm140644108881520"></a>

          <a class="indexterm" name="idm140644108880416"></a>

          <code class="literal">innodb_buffer_pool_chunk_size</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_buffer_pool_chunk_size" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Introduced</strong></span></td><td colspan="3">5.7.5</td></tr><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_buffer_pool_chunk_size</code></td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>System Variable</strong></span></td><td><span class="bold"><strong>Name</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_chunk_size">innodb_buffer_pool_chunk_size</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="2">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="2">No</td></tr><tr><td scope="row" rowspan="4"><span class="bold"><strong>Permitted Values</strong></span></td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">integer</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">134217728</code></td></tr><tr><td scope="row"><span class="bold"><strong>Min Value</strong></span></td><td colspan="2"><code class="literal">1048576</code></td></tr><tr><td scope="row"><span class="bold"><strong>Max Value</strong></span></td><td colspan="2"><code class="literal">innodb_buffer_pool_size / innodb_buffer_pool_instances</code></td></tr></tbody></table>
</div>
<p>
          <code class="literal">innodb_buffer_pool_chunk_size</code> defines the
          chunk size for online <code class="literal">InnoDB</code> buffer pool
          resizing operations.
        </p><p>
          As of MySQL 5.7.5, the
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_size"><code class="literal">innodb_buffer_pool_size</code></a>
          parameter is dynamic, which allows you to resize the buffer
          pool without restarting the server. To avoid copying all
          buffer pool pages during resizing operations, the operation is
          performed in <span class="quote">“<span class="quote">chunks</span>”</span>. Chunk size is defined by
          <code class="literal">innodb_buffer_pool_chunk_size</code>. By default,
          <code class="literal">innodb_buffer_pool_chunk_size</code> is 128MB
          (134217728 bytes). The number of pages contained in a chunk
          depends on the value of
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_page_size"><code class="literal">innodb_page_size</code></a>.
          <code class="literal">innodb_buffer_pool_chunk_size</code> can be
          increased or decreased in units of 1MB (1048576 bytes).
        </p><p>
          The following conditions apply when altering the
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_chunk_size"><code class="literal">innodb_buffer_pool_chunk_size</code></a>
          value:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
              If <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_chunk_size"><code class="literal">
              innodb_buffer_pool_chunk_size</code></a> *
              <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_instances"><code class="literal">innodb_buffer_pool_instances</code></a>
              is larger than the current buffer pool size when the
              buffer pool is initialized,
              <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_chunk_size"><code class="literal">innodb_buffer_pool_chunk_size</code></a>
              is truncated to
              <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_size"><code class="literal">innodb_buffer_pool_size</code></a> /
              <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_instances"><code class="literal">innodb_buffer_pool_instances</code></a>.
            </p></li><li class="listitem"><p>
              Buffer pool size must always be a multiple of
              <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_chunk_size"><code class="literal">innodb_buffer_pool_chunk_size</code></a>
              *
              <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_instances"><code class="literal">innodb_buffer_pool_instances</code></a>.
              If you alter
              <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_chunk_size"><code class="literal">innodb_buffer_pool_chunk_size</code></a>,
              <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_size"><code class="literal">innodb_buffer_pool_size</code></a>
              is automatically adjusted to a multiple of
              <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_chunk_size"><code class="literal">innodb_buffer_pool_chunk_size</code></a>
              *
              <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_instances"><code class="literal">innodb_buffer_pool_instances</code></a>
              that is not less than current buffer pool size. The
              adjustment occurs when the buffer pool is initialized.
</p></li></ul>
</div>
<div class="important" style="margin-left: 0.5in; margin-right: 0.5in;">
<div class="admon-title">
Important
</div>
<p>
            Care should be taken when changing
            <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_chunk_size"><code class="literal">innodb_buffer_pool_chunk_size</code></a>,
            as changing this value can automatically increase the size
            of the buffer pool. Before you change
            <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_chunk_size"><code class="literal">innodb_buffer_pool_chunk_size</code></a>,
            calculate the effect it will have on
            <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_size"><code class="literal">innodb_buffer_pool_size</code></a> to
            ensure that the resulting buffer pool size is acceptable.
</p>
</div>
<p>
          To avoid potential performance issues, the number of chunks
          (<a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_size"><code class="literal">innodb_buffer_pool_size</code></a> /
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_chunk_size"><code class="literal">innodb_buffer_pool_chunk_size</code></a>)
          should not exceed 1000.
        </p><p>
          See <a class="xref" href="innodb-storage-engine.html#innodb-buffer-pool-online-resize" title="Configuring InnoDB Buffer Pool Size Online">Configuring InnoDB Buffer Pool Size Online</a> for
          more information.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_buffer_pool_dump_at_shutdown"></a>
          <a class="indexterm" name="idm140644108816128"></a>

          <code class="literal">innodb_buffer_pool_dump_at_shutdown</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_buffer_pool_dump_at_shutdown" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_buffer_pool_dump_at_shutdown=#</code></td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>System Variable</strong></span></td><td><span class="bold"><strong>Name</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_dump_at_shutdown">innodb_buffer_pool_dump_at_shutdown</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="2">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="2">Yes</td></tr><tr><td scope="row" rowspan="2"><span class="bold"><strong>Permitted Values</strong></span> (&lt;= 5.7.6)</td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">boolean</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">OFF</code></td></tr><tr><td scope="row" rowspan="2"><span class="bold"><strong>Permitted Values</strong></span> (&gt;= 5.7.7)</td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">boolean</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">ON</code></td></tr></tbody></table>
</div>
<p>
          Specifies whether to record the pages cached in the InnoDB
          <a class="link" href="glossary.html#glos_buffer_pool" title="buffer pool">buffer pool</a> when the
          MySQL server is shut down, to shorten the
          <a class="link" href="glossary.html#glos_warm_up" title="warm up">warmup</a> process at the next
          restart. Typically used in combination with
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_load_at_startup"><code class="literal">innodb_buffer_pool_load_at_startup</code></a>.
          The
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_dump_pct"><code class="literal">innodb_buffer_pool_dump_pct</code></a>
          option defines the percentage of most recently used buffer
          pool pages to dump.
        </p><p>
          Both
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_dump_at_shutdown"><code class="literal">innodb_buffer_pool_dump_at_shutdown</code></a>
          and <code class="literal">innodb_buffer_pool_load_at_startup</code> are
          enabled by default as of MySQL 5.7.7.
        </p><p>
          For related information, see
          <a class="xref" href="innodb-storage-engine.html#innodb-preload-buffer-pool" title="14.3.3.5 Preloading the InnoDB Buffer Pool for Faster Restart">Section 14.3.3.5, “Preloading the InnoDB Buffer Pool for Faster Restart”</a>.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_buffer_pool_dump_now"></a>
          <a class="indexterm" name="idm140644108779552"></a>

          <code class="literal">innodb_buffer_pool_dump_now</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_buffer_pool_dump_now" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_buffer_pool_dump_now=#</code></td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>System Variable</strong></span></td><td><span class="bold"><strong>Name</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_dump_now">innodb_buffer_pool_dump_now</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="2">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="2">Yes</td></tr><tr><td scope="row" rowspan="2"><span class="bold"><strong>Permitted Values</strong></span></td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">boolean</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">OFF</code></td></tr></tbody></table>
</div>
<p>
          Immediately records the pages cached in the InnoDB
          <a class="link" href="glossary.html#glos_buffer_pool" title="buffer pool">buffer pool</a>. Typically
          used in combination with
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_load_now"><code class="literal">innodb_buffer_pool_load_now</code></a>.
        </p><p>
          For related information, see
          <a class="xref" href="innodb-storage-engine.html#innodb-preload-buffer-pool" title="14.3.3.5 Preloading the InnoDB Buffer Pool for Faster Restart">Section 14.3.3.5, “Preloading the InnoDB Buffer Pool for Faster Restart”</a>.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_buffer_pool_dump_pct"></a>
          <a class="indexterm" name="idm140644108753680"></a>

          <code class="literal">innodb_buffer_pool_dump_pct</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_buffer_pool_dump_pct" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Introduced</strong></span></td><td colspan="3">5.7.2</td></tr><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_buffer_pool_dump_pct=#</code></td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>System Variable</strong></span></td><td><span class="bold"><strong>Name</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_dump_pct">innodb_buffer_pool_dump_pct</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="2">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="2">Yes</td></tr><tr><td scope="row" rowspan="4"><span class="bold"><strong>Permitted Values</strong></span> (&lt;= 5.7.6)</td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">integer</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">100</code></td></tr><tr><td scope="row"><span class="bold"><strong>Min Value</strong></span></td><td colspan="2"><code class="literal">1</code></td></tr><tr><td scope="row"><span class="bold"><strong>Max Value</strong></span></td><td colspan="2"><code class="literal">100</code></td></tr><tr><td scope="row" rowspan="4"><span class="bold"><strong>Permitted Values</strong></span> (&gt;= 5.7.7)</td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">integer</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">25</code></td></tr><tr><td scope="row"><span class="bold"><strong>Min Value</strong></span></td><td colspan="2"><code class="literal">1</code></td></tr><tr><td scope="row"><span class="bold"><strong>Max Value</strong></span></td><td colspan="2"><code class="literal">100</code></td></tr></tbody></table>
</div>
<p>
          Specifies the percentage of the most recently used pages for
          each buffer pool to read out and dump. The range is 1 to 100.
          Prior to MySQL 5.7.7, the default value is 100 (dump all
          pages). As of MySQL 5.7.7, the default value is 25. For
          example, if there are 4 buffer pools with 100 pages each, and
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_dump_pct"><code class="literal">innodb_buffer_pool_dump_pct</code></a>
          is set to 25, the 25 most recently used pages from each buffer
          pool are dumped.
        </p><p>
          The change to the
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_dump_pct"><code class="literal">innodb_buffer_pool_dump_pct</code></a>
          default value in MySQL 5.7.7 coincides with default value
          changes for
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_dump_at_shutdown"><code class="literal">innodb_buffer_pool_dump_at_shutdown</code></a>
          and
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_load_at_startup"><code class="literal">innodb_buffer_pool_load_at_startup</code></a>,
          which are both enabled by default as of MySQL 5.7.7.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_buffer_pool_filename"></a>
          <a class="indexterm" name="idm140644108708448"></a>

          <code class="literal">innodb_buffer_pool_filename</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_buffer_pool_filename" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_buffer_pool_filename=file</code></td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>System Variable</strong></span></td><td><span class="bold"><strong>Name</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_filename">innodb_buffer_pool_filename</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="2">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="2">Yes</td></tr><tr><td scope="row" rowspan="2"><span class="bold"><strong>Permitted Values</strong></span></td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">file name</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">ib_buffer_pool</code></td></tr></tbody></table>
</div>
<p>
          Specifies the name of the file that holds the list of
          tablespace IDs and page IDs produced by
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_dump_at_shutdown"><code class="literal">innodb_buffer_pool_dump_at_shutdown</code></a>
          or
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_dump_now"><code class="literal">innodb_buffer_pool_dump_now</code></a>.
          Tablespace IDs and page IDs are saved in the following format:
          <code class="literal">space, page_id</code>. By default, the file is
          located in the <code class="literal">InnoDB</code> data directory.
        </p><p>
          For related information, see
          <a class="xref" href="innodb-storage-engine.html#innodb-preload-buffer-pool" title="14.3.3.5 Preloading the InnoDB Buffer Pool for Faster Restart">Section 14.3.3.5, “Preloading the InnoDB Buffer Pool for Faster Restart”</a>.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_buffer_pool_instances"></a>
          <a class="indexterm" name="idm140644108680496"></a>

          <a class="indexterm" name="idm140644108679392"></a>

          <code class="literal">innodb_buffer_pool_instances</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_buffer_pool_instances" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_buffer_pool_instances=#</code></td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>System Variable</strong></span></td><td><span class="bold"><strong>Name</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_instances">innodb_buffer_pool_instances</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="2">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="2">No</td></tr><tr><td scope="row" rowspan="4"><span class="bold"><strong>Permitted Values</strong></span> (Windows, 32-bit platforms)</td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">integer</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">(autosized)</code></td></tr><tr><td scope="row"><span class="bold"><strong>Min Value</strong></span></td><td colspan="2"><code class="literal">1</code></td></tr><tr><td scope="row"><span class="bold"><strong>Max Value</strong></span></td><td colspan="2"><code class="literal">64</code></td></tr><tr><td scope="row" rowspan="4"><span class="bold"><strong>Permitted Values</strong></span> (Other)</td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">integer</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">8 (or 1 if innodb_buffer_pool_size &lt; 1GB</code></td></tr><tr><td scope="row"><span class="bold"><strong>Min Value</strong></span></td><td colspan="2"><code class="literal">1</code></td></tr><tr><td scope="row"><span class="bold"><strong>Max Value</strong></span></td><td colspan="2"><code class="literal">64</code></td></tr></tbody></table>
</div>
<p>
          The number of regions that the <code class="literal">InnoDB</code>
          <a class="link" href="glossary.html#glos_buffer_pool" title="buffer pool">buffer pool</a> is divided
          into. For systems with buffer pools in the multi-gigabyte
          range, dividing the buffer pool into separate instances can
          improve concurrency, by reducing contention as different
          threads read and write to cached pages. Each page that is
          stored in or read from the buffer pool is assigned to one of
          the buffer pool instances randomly, using a hashing function.
          Each buffer pool manages its own free lists,
          <a class="link" href="glossary.html#glos_flush_list" title="flush list">flush lists</a>,
          <a class="link" href="glossary.html#glos_lru" title="LRU">LRUs</a>, and all other data
          structures connected to a buffer pool, and is protected by its
          own buffer pool <a class="link" href="glossary.html#glos_mutex" title="mutex">mutex</a>.
        </p><p>
          This option takes effect only when you set the
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_size"><code class="literal">innodb_buffer_pool_size</code></a> to a
          size of 1GB or more. The total size you specify is divided
          among all the buffer pools. For best efficiency, specify a
          combination of
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_instances"><code class="literal">innodb_buffer_pool_instances</code></a>
          and <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_size"><code class="literal">innodb_buffer_pool_size</code></a>
          so that each buffer pool instance is at least 1GB.
        </p><p>
          The default value in on 32-bit Windows systems depends on the
          value of
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_size"><code class="literal">innodb_buffer_pool_size</code></a>, as
          described below:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
              If
              <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_size"><code class="literal">innodb_buffer_pool_size</code></a>
              is greater than 1.3GB, the default for
              <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_instances"><code class="literal">innodb_buffer_pool_instances</code></a>
              is
              <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_size"><code class="literal">innodb_buffer_pool_size</code></a>/128MB,
              with individual memory allocation requests for each chunk.
              1.3GB was chosen as the boundary at which there is
              significant risk for 32-bit Windows to be unable to
              allocate the contiguous address space needed for a single
              buffer pool.
            </p></li><li class="listitem"><p>
              Otherwise, the default is 1.
</p></li></ul>
</div>
<p>
          On all other platforms, the default value is 8 when
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_size"><code class="literal">innodb_buffer_pool_size</code></a> is
          greater than or equal to 1GB. Otherwise, the default is 1.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_buffer_pool_load_abort"></a>
          <a class="indexterm" name="idm140644108622624"></a>

          <code class="literal">innodb_buffer_pool_load_abort</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_buffer_pool_load_abort" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_buffer_pool_load_abort=#</code></td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>System Variable</strong></span></td><td><span class="bold"><strong>Name</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_load_abort">innodb_buffer_pool_load_abort</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="2">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="2">Yes</td></tr><tr><td scope="row" rowspan="2"><span class="bold"><strong>Permitted Values</strong></span></td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">boolean</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">OFF</code></td></tr></tbody></table>
</div>
<p>
          Interrupts the process of restoring InnoDB
          <a class="link" href="glossary.html#glos_buffer_pool" title="buffer pool">buffer pool</a> contents
          triggered by
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_load_at_startup"><code class="literal">innodb_buffer_pool_load_at_startup</code></a>
          or
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_load_now"><code class="literal">innodb_buffer_pool_load_now</code></a>.
        </p><p>
          For related information, see
          <a class="xref" href="innodb-storage-engine.html#innodb-preload-buffer-pool" title="14.3.3.5 Preloading the InnoDB Buffer Pool for Faster Restart">Section 14.3.3.5, “Preloading the InnoDB Buffer Pool for Faster Restart”</a>.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_buffer_pool_load_at_startup"></a>
          <a class="indexterm" name="idm140644108595344"></a>

          <code class="literal">innodb_buffer_pool_load_at_startup</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_buffer_pool_load_at_startup" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_buffer_pool_load_at_startup=#</code></td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>System Variable</strong></span></td><td><span class="bold"><strong>Name</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_load_at_startup">innodb_buffer_pool_load_at_startup</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="2">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="2">No</td></tr><tr><td scope="row" rowspan="2"><span class="bold"><strong>Permitted Values</strong></span> (&lt;= 5.7.6)</td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">boolean</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">OFF</code></td></tr><tr><td scope="row" rowspan="2"><span class="bold"><strong>Permitted Values</strong></span> (&gt;= 5.7.7)</td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">boolean</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">ON</code></td></tr></tbody></table>
</div>
<p>
          Specifies that, on MySQL server startup, the InnoDB
          <a class="link" href="glossary.html#glos_buffer_pool" title="buffer pool">buffer pool</a> is
          automatically <a class="link" href="glossary.html#glos_warm_up" title="warm up">warmed up</a> by
          loading the same pages it held at an earlier time. Typically
          used in combination with
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_dump_at_shutdown"><code class="literal">innodb_buffer_pool_dump_at_shutdown</code></a>.
        </p><p>
          Both
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_dump_at_shutdown"><code class="literal">innodb_buffer_pool_dump_at_shutdown</code></a>
          and <code class="literal">innodb_buffer_pool_load_at_startup</code> are
          enabled by default as of MySQL 5.7.7.
        </p><p>
          For related information, see
          <a class="xref" href="innodb-storage-engine.html#innodb-preload-buffer-pool" title="14.3.3.5 Preloading the InnoDB Buffer Pool for Faster Restart">Section 14.3.3.5, “Preloading the InnoDB Buffer Pool for Faster Restart”</a>.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_buffer_pool_load_now"></a>
          <a class="indexterm" name="idm140644108560160"></a>

          <code class="literal">innodb_buffer_pool_load_now</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_buffer_pool_load_now" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_buffer_pool_load_now=#</code></td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>System Variable</strong></span></td><td><span class="bold"><strong>Name</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_load_now">innodb_buffer_pool_load_now</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="2">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="2">Yes</td></tr><tr><td scope="row" rowspan="2"><span class="bold"><strong>Permitted Values</strong></span></td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">boolean</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">OFF</code></td></tr></tbody></table>
</div>
<p>
          Immediately <a class="link" href="glossary.html#glos_warm_up" title="warm up">warms up</a> the
          <code class="literal">InnoDB</code>
          <a class="link" href="glossary.html#glos_buffer_pool" title="buffer pool">buffer pool</a> by loading
          a set of data pages, without waiting for a server restart. Can
          be useful to bring cache memory back to a known state during
          benchmarking, or to ready the MySQL server to resume its
          normal workload after running queries for reports or
          maintenance.
        </p><p>
          For related information, see
          <a class="xref" href="innodb-storage-engine.html#innodb-preload-buffer-pool" title="14.3.3.5 Preloading the InnoDB Buffer Pool for Faster Restart">Section 14.3.3.5, “Preloading the InnoDB Buffer Pool for Faster Restart”</a>.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_buffer_pool_size"></a>
          <a class="indexterm" name="idm140644108533856"></a>

          <a class="indexterm" name="idm140644108532816"></a>

          <code class="literal">innodb_buffer_pool_size</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_buffer_pool_size" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_buffer_pool_size=#</code></td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>System Variable</strong></span> (&lt;= 5.7.4)</td><td><span class="bold"><strong>Name</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_size">innodb_buffer_pool_size</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="2">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="2">No</td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>System Variable</strong></span> (&gt;= 5.7.5)</td><td><span class="bold"><strong>Name</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_size">innodb_buffer_pool_size</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="2">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="2">Yes</td></tr><tr><td scope="row" rowspan="4"><span class="bold"><strong>Permitted Values</strong></span> (32-bit platforms)</td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">integer</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">134217728</code></td></tr><tr><td scope="row"><span class="bold"><strong>Min Value</strong></span></td><td colspan="2"><code class="literal">5242880</code></td></tr><tr><td scope="row"><span class="bold"><strong>Max Value</strong></span></td><td colspan="2"><code class="literal">2**32-1</code></td></tr><tr><td scope="row" rowspan="4"><span class="bold"><strong>Permitted Values</strong></span> (64-bit platforms)</td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">integer</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">134217728</code></td></tr><tr><td scope="row"><span class="bold"><strong>Min Value</strong></span></td><td colspan="2"><code class="literal">5242880</code></td></tr><tr><td scope="row"><span class="bold"><strong>Max Value</strong></span></td><td colspan="2"><code class="literal">2**64-1</code></td></tr></tbody></table>
</div>
<p>
          The size in bytes of the
          <a class="link" href="glossary.html#glos_buffer_pool" title="buffer pool">buffer pool</a>, the
          memory area where <code class="literal">InnoDB</code> caches table and
          index data. The default value is 128MB. The maximum value
          depends on the CPU architecture; the maximum is 4294967295
          (2<sup>32</sup>-1) on 32-bit systems and
          18446744073709551615 (2<sup>64</sup>-1) on
          64-bit systems. On 32-bit systems, the CPU architecture and
          operating system may impose a lower practical maximum size
          than the stated maximum. When the size of the buffer pool is
          greater than 1GB, setting
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_instances"><code class="literal">innodb_buffer_pool_instances</code></a>
          to a value greater than 1 can improve the scalability on a
          busy server.
        </p><p>
          A larger buffer pool requires less disk I/O to access the same
          table data more than once. On a dedicated database server, you
          might set the buffer pool size to 80% of the machine's
          physical memory size. Be aware of the following potential
          issues when configuring buffer pool size, and be prepared to
          scale back the size of the buffer pool if necessary.
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
              Competition for physical memory can cause paging in the
              operating system.
            </p></li><li class="listitem"><p>
              <code class="literal">InnoDB</code> reserves additional memory for
              buffers and control structures, so that the total
              allocated space is approximately 10% greater than the
              specified buffer pool size.
            </p></li><li class="listitem"><p>
              Address space for the buffer pool must be contiguous,
              which can be an issue on Windows systems with DLLs that
              load at specific addresses.
            </p></li><li class="listitem"><p>
              The time to initialize the buffer pool is roughly
              proportional to its size. On large installations,
              initialization time might be significant. For example, on
              a modern Linux x86_64 server, initialization of a 10GB
              buffer pool takes approximately 6 seconds. See
              <a class="xref" href="optimization.html#innodb-buffer-pool" title="8.10.1 The InnoDB Buffer Pool">Section 8.10.1, “The InnoDB Buffer Pool”</a>.
</p></li></ul>
</div>
<p>
          As of MySQL 5.7.5, when you increase or decrease buffer pool
          size, the operation is performed in chunks. Chunk size is
          defined by the
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_chunk_size"><code class="literal">innodb_buffer_pool_chunk_size</code></a>
          configuration option, which has a default of 128 MB.
        </p><p>
          Increasing or decreasing buffer pool size by an amount that is
          not divisible by
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_chunk_size"><code class="literal">innodb_buffer_pool_chunk_size</code></a>
          returns a warning, and the buffer pool size is automatically
          adjusted to a valid value.
        </p><p>
          Buffer pool size must always be a multiple of
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_chunk_size"><code class="literal">innodb_buffer_pool_chunk_size</code></a>
          *
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_instances"><code class="literal">innodb_buffer_pool_instances</code></a>.
          If you alter the buffer pool size to a value that is not a
          multiple of
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_chunk_size"><code class="literal">innodb_buffer_pool_chunk_size</code></a>
          *
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_instances"><code class="literal">innodb_buffer_pool_instances</code></a>,
          buffer pool size is automatically adjusted to a multiple of
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_chunk_size"><code class="literal">innodb_buffer_pool_chunk_size</code></a>
          *
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_instances"><code class="literal">innodb_buffer_pool_instances</code></a>
          that is not less than the specified buffer pool size.
        </p><p>
          As of MySQL 5.7.5, <code class="literal">innodb_buffer_pool_size</code>
          can be set dynamically, which allows you to resize the buffer
          pool without restarting the server. For online buffer pool
          resizing operations, the
          <a class="link" href="server-administration.html#statvar_Innodb_buffer_pool_resize_status"><code class="literal">Innodb_buffer_pool_resize_status</code></a>
          status variable reports the status of the resizing operation.
          See <a class="xref" href="innodb-storage-engine.html#innodb-buffer-pool-online-resize" title="Configuring InnoDB Buffer Pool Size Online">Configuring InnoDB Buffer Pool Size Online</a> for
          more information.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_change_buffer_max_size"></a>
          <a class="indexterm" name="idm140644108460896"></a>

          <code class="literal">innodb_change_buffer_max_size</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_change_buffer_max_size" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_change_buffer_max_size=#</code></td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>System Variable</strong></span></td><td><span class="bold"><strong>Name</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_change_buffer_max_size">innodb_change_buffer_max_size</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="2">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="2">Yes</td></tr><tr><td scope="row" rowspan="4"><span class="bold"><strong>Permitted Values</strong></span></td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">integer</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">25</code></td></tr><tr><td scope="row"><span class="bold"><strong>Min Value</strong></span></td><td colspan="2"><code class="literal">0</code></td></tr><tr><td scope="row"><span class="bold"><strong>Max Value</strong></span></td><td colspan="2"><code class="literal">50</code></td></tr></tbody></table>
</div>
<p>
          Maximum size for the InnoDB
          <a class="link" href="glossary.html#glos_change_buffer" title="change buffer">change buffer</a>, as a
          percentage of the total size of the
          <a class="link" href="glossary.html#glos_buffer_pool" title="buffer pool">buffer pool</a>. You might
          increase this value for a MySQL server with heavy insert,
          update, and delete activity, or decrease it for a MySQL server
          with unchanging data used for reporting. For general I/O
          tuning advice, see <a class="xref" href="optimization.html#optimizing-innodb-diskio" title="8.5.8 Optimizing InnoDB Disk I/O">Section 8.5.8, “Optimizing InnoDB Disk I/O”</a>.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_change_buffering"></a>
          <a class="indexterm" name="idm140644108431280"></a>

          <a class="indexterm" name="idm140644108430240"></a>

          <code class="literal">innodb_change_buffering</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_change_buffering" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_change_buffering=#</code></td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>System Variable</strong></span></td><td><span class="bold"><strong>Name</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_change_buffering">innodb_change_buffering</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="2">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="2">Yes</td></tr><tr><td scope="row" rowspan="8"><span class="bold"><strong>Permitted Values</strong></span></td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">enumeration</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">all</code></td></tr><tr><td scope="row" rowspan="6" valign="top"><span class="bold"><strong>Valid Values</strong></span></td><td colspan="2"><code class="literal">none</code></td></tr><tr><td scope="row" colspan="2"><code class="literal">inserts</code></td></tr><tr><td scope="row" colspan="2"><code class="literal">deletes</code></td></tr><tr><td scope="row" colspan="2"><code class="literal">changes</code></td></tr><tr><td scope="row" colspan="2"><code class="literal">purges</code></td></tr><tr><td scope="row" colspan="2"><code class="literal">all</code></td></tr></tbody></table>
</div>
<p>
          Whether <code class="literal">InnoDB</code> performs
          <a class="link" href="glossary.html#glos_change_buffering" title="change buffering">change buffering</a>,
          an optimization that delays write operations to secondary
          indexes so that the I/O operations can be performed
          sequentially. The permitted values are described in the
          following table. For more information, see
          <a class="xref" href="innodb-storage-engine.html#innodb-performance-change_buffering" title="14.3.5 Configuring InnoDB Change Buffering">Section 14.3.5, “Configuring InnoDB Change Buffering”</a>. For
          general I/O tuning advice, see
          <a class="xref" href="optimization.html#optimizing-innodb-diskio" title="8.5.8 Optimizing InnoDB Disk I/O">Section 8.5.8, “Optimizing InnoDB Disk I/O”</a>.
</p>
<div class="table">
<a name="idm140644108395392"></a><p class="title"><b>Table 14.10 Permitted Values for innodb_change_buffering</b></p>
<div class="table-contents">
<table summary="Permitted Values for innodb_change_buffering" border="1"><colgroup><col><col></colgroup><thead><tr><th scope="col">Value</th><th scope="col">Description</th></tr></thead><tbody><tr><td scope="row"><code class="literal">none</code></td><td>Do not buffer any operations.</td></tr><tr><td scope="row"><code class="literal">inserts</code></td><td>Buffer insert operations.</td></tr><tr><td scope="row"><code class="literal">deletes</code></td><td>Buffer delete marking operations; strictly speaking, the writes that
                  mark index records for later deletion during a purge
operation.</td></tr><tr><td scope="row"><code class="literal">changes</code></td><td>Buffer inserts and delete-marking operations.</td></tr><tr><td scope="row"><code class="literal">purges</code></td><td>Buffer the physical deletion operations that happen in the background.</td></tr><tr><td scope="row"><code class="literal">all</code></td><td>The default. Buffer inserts, delete-marking operations, and purges.</td></tr></tbody></table>
</div>

</div>
<br class="table-break"></li><li class="listitem"><p><a name="sysvar_innodb_change_buffering_debug"></a>
          <a class="indexterm" name="idm140644108379872"></a>

          <a class="indexterm" name="idm140644108378832"></a>

          <code class="literal">innodb_change_buffering_debug</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_change_buffering_debug" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_change_buffering_debug=#</code></td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>System Variable</strong></span></td><td><span class="bold"><strong>Name</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_change_buffering_debug">innodb_change_buffering_debug</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="2">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="2">Yes</td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>Permitted Values</strong></span></td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">integer</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">0</code></td></tr><tr><td scope="row"><span class="bold"><strong>Max Value</strong></span></td><td colspan="2"><code class="literal">2</code></td></tr></tbody></table>
</div>
<p>
          Sets a debug flag for <code class="literal">InnoDB</code> change
          buffering. A value of 1 forces all changes to the change
          buffer. A value of 2 causes a crash at merge. A default value
          of 0 indicates that the change buffering debug flag is not
          set. This option is only available when debugging support is
          compiled in using the <a class="link" href="installing.html#option_cmake_with_debug"><code class="option">WITH_DEBUG</code></a>
          <span class="command"><strong>CMake</strong></span> option.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_checksum_algorithm"></a>
          <a class="indexterm" name="idm140644108350976"></a>

          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_checksum_algorithm"><code class="literal">innodb_checksum_algorithm</code></a>
</p>
<div class="informaltable">
<table summary="Options for innodb_checksum_algorithm" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_checksum_algorithm=#</code></td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>System Variable</strong></span></td><td><span class="bold"><strong>Name</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_checksum_algorithm">innodb_checksum_algorithm</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="2">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="2">Yes</td></tr><tr><td scope="row" rowspan="8"><span class="bold"><strong>Permitted Values</strong></span> (&lt;= 5.7.6)</td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">enumeration</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">innodb</code></td></tr><tr><td scope="row" rowspan="6" valign="top"><span class="bold"><strong>Valid Values</strong></span></td><td colspan="2"><code class="literal">innodb</code></td></tr><tr><td scope="row" colspan="2"><code class="literal">crc32</code></td></tr><tr><td scope="row" colspan="2"><code class="literal">none</code></td></tr><tr><td scope="row" colspan="2"><code class="literal">strict_innodb</code></td></tr><tr><td scope="row" colspan="2"><code class="literal">strict_crc32</code></td></tr><tr><td scope="row" colspan="2"><code class="literal">strict_none</code></td></tr><tr><td scope="row" rowspan="8"><span class="bold"><strong>Permitted Values</strong></span> (&gt;= 5.7.7)</td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">enumeration</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">crc32</code></td></tr><tr><td scope="row" rowspan="6" valign="top"><span class="bold"><strong>Valid Values</strong></span></td><td colspan="2"><code class="literal">innodb</code></td></tr><tr><td scope="row" colspan="2"><code class="literal">crc32</code></td></tr><tr><td scope="row" colspan="2"><code class="literal">none</code></td></tr><tr><td scope="row" colspan="2"><code class="literal">strict_innodb</code></td></tr><tr><td scope="row" colspan="2"><code class="literal">strict_crc32</code></td></tr><tr><td scope="row" colspan="2"><code class="literal">strict_none</code></td></tr></tbody></table>
</div>
<p>
          Specifies how to generate and verify the
          <a class="link" href="glossary.html#glos_checksum" title="checksum">checksum</a> stored in each
          disk block of each <code class="literal">InnoDB</code>
          <a class="link" href="glossary.html#glos_tablespace" title="tablespace">tablespace</a>.
        </p><p>
          The default value for
          <code class="literal">innodb_checksum_algorithm</code> was changed from
          <code class="literal">innodb</code> to <code class="literal">crc32</code> in MySQL
          5.6.6, but switched back to <code class="literal">innodb</code> in 5.6.7
          for improved compatibility of <code class="literal">InnoDB</code> data
          files during a downgrade to an earlier MySQL version, and for
          use with <a class="link" href="mysql-enterprise.html#mysql-enterprise-backup" title="26.2 MySQL Enterprise Backup Overview">MySQL
          Enterprise Backup</a>. The limitations encountered
          included:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
              <code class="literal">.ibd</code> files containing CRC32 checksums
              could cause problems downgrading to MySQL versions prior
              to 5.6.3. MySQL 5.6.3 and up recognizes either the new or
              old checksum values for the block as correct when reading
              the block from disk, ensuring that data blocks are
              compatible during upgrade and downgrade regardless of the
              algorithm setting. If data written with new checksum
              values is processed by a level of MySQL earlier than
              5.6.3, it could be reported as corrupted.
            </p></li><li class="listitem"><p>
              Versions of <a class="link" href="mysql-enterprise.html#mysql-enterprise-backup" title="26.2 MySQL Enterprise Backup Overview">MySQL
              Enterprise Backup</a> up to 3.8.0 do not support
              backing up tablespaces that use CRC32 checksums.
              <a class="link" href="mysql-enterprise.html#mysql-enterprise-backup" title="26.2 MySQL Enterprise Backup Overview">MySQL Enterprise
              Backup</a> adds CRC32 checksum support in 3.8.1, with
              some limitations. Refer to the
              <a class="link" href="mysql-enterprise.html#mysql-enterprise-backup" title="26.2 MySQL Enterprise Backup Overview">MySQL Enterprise
              Backup</a> 3.8.1 Change History for more information.
</p></li></ul>
</div>
<p>
          <span class="emphasis"><em>As of MySQL 5.7.7, <code class="literal">crc32</code> is once
          again the default value for
          <code class="literal">innodb_checksum_algorithm</code>.</em></span>
        </p><p>
          <code class="literal">innodb_checksum_algorithm</code> replaced the
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_checksums"><code class="literal">innodb_checksums</code></a> option in
          MySQL 5.6.3. The following values were provided for
          compatibility, up to and including MySQL 5.7.6:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
              <code class="literal">innodb_checksums=ON</code> is the same as
              <code class="literal">innodb_checksum_algorithm=innodb</code>.
            </p></li><li class="listitem"><p>
              <code class="literal">innodb_checksums=OFF</code> is the same as
              <code class="literal">innodb_checksum_algorithm=none</code>.
</p></li></ul>
</div>
<p>
          As of MySQl 5.7.7, with a default
          <code class="literal">innodb_checksum_algorithm</code> value of crc32,
          <code class="literal">innodb_checksums=ON</code> is now the same as
          <code class="literal">innodb_checksum_algorithm=crc32</code>.
          <code class="literal">innodb_checksums=OFF</code> is still the same as
          <code class="literal">innodb_checksum_algorithm=none</code>.
        </p><p>
          To avoid conflicts, remove references to
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_checksums"><code class="literal">innodb_checksums</code></a> from your
          configuration file and MySQL startup scripts.
        </p><p>
          The value <code class="literal">innodb</code> is backward-compatible
          with all versions of MySQL. The value <code class="literal">crc32</code>
          uses an algorithm that is faster to compute the checksum for
          every modified block, and to check the checksums for each disk
          read. It scans blocks 32 bits at a time, which is faster the
          <code class="literal">innodb</code> checksum algorithm, which scans
          blocks 8 bits at a time. The value <code class="literal">none</code>
          writes a constant value in the checksum field rather than
          computing a value based on the block data. The blocks in a
          tablespace can use a mix of old, new, and no checksum values,
          being updated gradually as the data is modified; once any
          blocks in a tablespace are modified to use the
          <code class="literal">crc32</code> algorithm, the associated tables
          cannot be read by earlier versions of MySQL.
        </p><p>
          The <code class="literal">strict_*</code> forms work the same as
          <code class="literal">innodb</code>, <code class="literal">crc32</code>, and
          <code class="literal">none</code>, except that <code class="literal">InnoDB</code>
          reports an error if it encounters a valid but non-matching
          checksum value in the tablespace. It is recommended that you
          only use the <code class="literal">strict_*</code> options in a new
          instance, to set up all tablespaces for the first time. The
          <code class="literal">strict_*</code> settings are somewhat faster,
          because they do not need to compute all checksum values during
          disk reads.
</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
            Prior to MySQL 5.7.8, a strict mode setting for
            <code class="literal">innodb_checksum_algorithm</code> caused
            <code class="literal">InnoDB</code> to halt when encountering a
            <span class="emphasis"><em>valid</em></span> but non-matching checksum. In
            MySQL 5.7.8 and later, only an error message is printed, and
            the page is accepted as valid if it has a valid
            <code class="literal">innodb</code>, <code class="literal">crc32</code> or
            <code class="literal">none</code> checksum.
</p>
</div>
<p>
          The following table illustrates the difference between the
          <code class="literal">none</code>, <code class="literal">innodb</code>, and
          <code class="literal">crc32</code> option values, and their
          <code class="literal">strict_*</code> counterparts.
          <code class="literal">none</code>, <code class="literal">innodb</code>, and
          <code class="literal">crc32</code> write the specified type of checksum
          value into each data block, but for compatibility accept any
          of the other checksum values when verifying a block during a
          read operation. The <code class="literal">strict_*</code> form of each
          parameter also accepts any valid checksum value but prints an
          error message when a valid non-matching checksum value is
          encountered. Using the <code class="literal">strict_*</code> form can
          make verification faster if all <code class="literal">InnoDB</code> data
          files in an instance are created under an identical
          <code class="literal">innodb_checksum_algorithm</code> value.
</p>
<div class="table">
<a name="idm140644108249888"></a><p class="title"><b>Table 14.11 innodb_checksum_algorithm Settings</b></p>
<div class="table-contents">
<table summary="innodb_checksum_algorithm Settings" border="1"><colgroup><col><col><col></colgroup><thead><tr><th scope="col">Value</th><th scope="col">Generated checksum (when writing)</th><th scope="col">Allowed checksums (when reading)</th></tr></thead><tbody><tr><td scope="row">none</td><td>A constant number.</td><td>Any of the checksums generated by <code class="literal">none</code>,
                  <code class="literal">innodb</code>, or
                  <code class="literal">crc32</code>.</td></tr><tr><td scope="row">innodb</td><td>A checksum calculated in software, using the original algorithm from
                  <code class="literal">InnoDB</code>.</td><td>Any of the checksums generated by <code class="literal">none</code>,
                  <code class="literal">innodb</code>, or
                  <code class="literal">crc32</code>.</td></tr><tr><td scope="row">crc32</td><td>A checksum calculated using the <code class="literal">crc32</code> algorithm,
                  possibly done with a hardware assist.</td><td>Any of the checksums generated by <code class="literal">none</code>,
                  <code class="literal">innodb</code>, or
                  <code class="literal">crc32</code>.</td></tr><tr><td scope="row">strict_none</td><td>A constant number</td><td>Any of the checksums generated by <code class="literal">none</code>,
                  <code class="literal">innodb</code>, or
                  <code class="literal">crc32</code>. <code class="literal">InnoDB</code>
                  prints an error message if a valid but non-matching
                  checksum is encountered.</td></tr><tr><td scope="row">strict_innodb</td><td>A checksum calculated in software, using the original algorithm from
                  <code class="literal">InnoDB</code>.</td><td>Any of the checksums generated by <code class="literal">none</code>,
                  <code class="literal">innodb</code>, or
                  <code class="literal">crc32</code>. <code class="literal">InnoDB</code>
                  prints an error message if a valid but non-matching
                  checksum is encountered.</td></tr><tr><td scope="row">strict_crc32</td><td>A checksum calculated using the <code class="literal">crc32</code> algorithm,
                  possibly done with a hardware assist.</td><td>Any of the checksums generated by <code class="literal">none</code>,
                  <code class="literal">innodb</code>, or
                  <code class="literal">crc32</code>. <code class="literal">InnoDB</code>
                  prints an error message if a valid but non-matching
checksum is encountered.</td></tr></tbody></table>
</div>

</div>
<br class="table-break"></li><li class="listitem"><p><a name="sysvar_innodb_checksums"></a>
          <a class="indexterm" name="idm140644108215248"></a>

          <a class="indexterm" name="idm140644108214192"></a>

          <code class="literal">innodb_checksums</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_checksums" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Deprecated</strong></span></td><td colspan="3">5.6.3</td></tr><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_checksums</code></td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>System Variable</strong></span></td><td><span class="bold"><strong>Name</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_checksums">innodb_checksums</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="2">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="2">No</td></tr><tr><td scope="row" rowspan="2"><span class="bold"><strong>Permitted Values</strong></span></td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">boolean</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">ON</code></td></tr></tbody></table>
</div>
<p>
          <code class="literal">InnoDB</code> can use
          <a class="link" href="glossary.html#glos_checksum" title="checksum">checksum</a> validation on
          all tablespace pages read from the disk to ensure extra fault
          tolerance against hardware faults or corrupted data files.
          This validation is enabled by default. Under specialized
          circumstances (such as when running benchmarks) this extra
          safety feature can be disabled with
          <code class="option">--skip-innodb-checksums</code>. You can specify the
          method of calculating the checksum with
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_checksum_algorithm"><code class="literal">innodb_checksum_algorithm</code></a>.
        </p><p>
          In MySQL 5.6.3 and higher, <code class="literal">innodb_checksums</code>
          is deprecated, replaced by
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_checksum_algorithm"><code class="literal">innodb_checksum_algorithm</code></a>.
        </p><p>
          Prior to MySQL 5.7.7, <code class="literal">innodb_checksums=ON</code>
          is the same as
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_checksum_algorithm"><code class="literal">innodb_checksum_algorithm=innodb</code></a>.
          As of MySQL 5.7.7, the
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_checksum_algorithm"><code class="literal">innodb_checksum_algorithm</code></a>
          default value is <code class="literal">crc32</code>, and
          <code class="literal">innodb_checksums=ON</code> is the same as
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_checksum_algorithm"><code class="literal">innodb_checksum_algorithm=crc32</code></a>.
          <code class="literal">innodb_checksums=OFF</code> is the same as
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_checksum_algorithm"><code class="literal">innodb_checksum_algorithm=none</code></a>.
        </p><p>
          It is recommended that you remove any
          <code class="literal">innodb_checksums</code> options from your
          configuration files and startup scripts, to avoid conflicts
          with <code class="literal">innodb_checksum_algorithm</code>.
          <code class="literal">innodb_checksums=OFF</code> automatically sets
          <code class="literal">innodb_checksum_algorithm=none</code>.
          <code class="literal">innodb_checksums=ON</code> is ignored and
          overridden by any other setting for
          <code class="literal">innodb_checksum_algorithm</code>.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_cmp_per_index_enabled"></a>
          <a class="indexterm" name="idm140644108169920"></a>

          <code class="literal">innodb_cmp_per_index_enabled</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_cmp_per_index_enabled" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_cmp_per_index_enabled=#</code></td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>System Variable</strong></span></td><td><span class="bold"><strong>Name</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_cmp_per_index_enabled">innodb_cmp_per_index_enabled</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="2">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="2">Yes</td></tr><tr><td scope="row" rowspan="4"><span class="bold"><strong>Permitted Values</strong></span></td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">boolean</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">OFF</code></td></tr><tr><td scope="row" rowspan="2" valign="top"><span class="bold"><strong>Valid Values</strong></span></td><td colspan="2"><code class="literal">OFF</code></td></tr><tr><td scope="row" colspan="2"><code class="literal">ON</code></td></tr></tbody></table>
</div>
<p>
          Enables per-index compression-related statistics in the
          <a class="link" href="information-schema.html#innodb-cmp-per-index-table" title="21.31.2 The INFORMATION_SCHEMA INNODB_CMP_PER_INDEX and INNODB_CMP_PER_INDEX_RESET Tables"><code class="literal">INFORMATION_SCHEMA.INNODB_CMP_PER_INDEX</code></a>
          table. Because these statistics can be expensive to gather,
          only enable this option on development, test, or slave
          instances during performance tuning related to
          <code class="literal">InnoDB</code>
          <a class="link" href="glossary.html#glos_compression" title="compression">compressed</a> tables.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_commit_concurrency"></a>
          <a class="indexterm" name="idm140644108140272"></a>

          <a class="indexterm" name="idm140644108139168"></a>

          <a class="indexterm" name="idm140644108137712"></a>

          <code class="literal">innodb_commit_concurrency</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_commit_concurrency" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_commit_concurrency=#</code></td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>System Variable</strong></span></td><td><span class="bold"><strong>Name</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_commit_concurrency">innodb_commit_concurrency</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="2">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="2">Yes</td></tr><tr><td scope="row" rowspan="4"><span class="bold"><strong>Permitted Values</strong></span></td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">integer</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">0</code></td></tr><tr><td scope="row"><span class="bold"><strong>Min Value</strong></span></td><td colspan="2"><code class="literal">0</code></td></tr><tr><td scope="row"><span class="bold"><strong>Max Value</strong></span></td><td colspan="2"><code class="literal">1000</code></td></tr></tbody></table>
</div>
<p>
          The number of <a class="link" href="glossary.html#glos_thread" title="thread">threads</a> that
          can <a class="link" href="glossary.html#glos_commit" title="commit">commit</a> at the same
          time. A value of 0 (the default) permits any number of
          <a class="link" href="glossary.html#glos_transaction" title="transaction">transactions</a> to commit
          simultaneously.
        </p><p>
          The value of <code class="literal">innodb_commit_concurrency</code>
          cannot be changed at runtime from zero to nonzero or vice
          versa. The value can be changed from one nonzero value to
          another.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_compress_debug"></a>
          <a class="indexterm" name="idm140644108106400"></a>

          <a class="indexterm" name="idm140644108105328"></a>

          <code class="literal">innodb_compress_debug</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_compress_debug" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Introduced</strong></span></td><td colspan="3">5.7.8</td></tr><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_compress_debug=#</code></td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>System Variable</strong></span></td><td><span class="bold"><strong>Name</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_compress_debug">innodb_compress_debug</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="2">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="2">Yes</td></tr><tr><td scope="row" rowspan="6"><span class="bold"><strong>Permitted Values</strong></span></td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">enumeration</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">none</code></td></tr><tr><td scope="row" rowspan="4" valign="top"><span class="bold"><strong>Valid Values</strong></span></td><td colspan="2"><code class="literal">none</code></td></tr><tr><td scope="row" colspan="2"><code class="literal">zlib</code></td></tr><tr><td scope="row" colspan="2"><code class="literal">lz4</code></td></tr><tr><td scope="row" colspan="2"><code class="literal">lz4hc</code></td></tr></tbody></table>
</div>
<p>
          Compresses all tables using a specified compression algorithm
          without having to define a <code class="literal">COMPRESSION</code>
          attribute for each table. This option is only available if
          debugging support is compiled in using the
          <a class="link" href="installing.html#option_cmake_with_debug"><code class="option">WITH_DEBUG</code></a>
          <span class="command"><strong>CMake</strong></span> option.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_compression_failure_threshold_pct"></a>
          <a class="indexterm" name="idm140644108071024"></a>

          <code class="literal">innodb_compression_failure_threshold_pct</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_compression_failure_threshold_pct" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_compression_failure_threshold_pct=#</code></td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>System Variable</strong></span></td><td><span class="bold"><strong>Name</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_compression_failure_threshold_pct">innodb_compression_failure_threshold_pct</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="2">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="2">Yes</td></tr><tr><td scope="row" rowspan="4"><span class="bold"><strong>Permitted Values</strong></span></td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">integer</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">5</code></td></tr><tr><td scope="row"><span class="bold"><strong>Min Value</strong></span></td><td colspan="2"><code class="literal">0</code></td></tr><tr><td scope="row"><span class="bold"><strong>Max Value</strong></span></td><td colspan="2"><code class="literal">100</code></td></tr></tbody></table>
</div>
<p>
          Sets the cutoff point at which MySQL begins adding padding
          within <a class="link" href="glossary.html#glos_compression" title="compression">compressed</a>
          pages to avoid expensive
          <a class="link" href="glossary.html#glos_compression_failure" title="compression failure">compression
          failures</a>. A value of zero disables the mechanism that
          monitors compression efficiency and dynamically adjusts the
          padding amount.
        </p><p>
          For more information, see
          <a class="xref" href="innodb-storage-engine.html#innodb-performance-compression-oltp" title="14.6.1.6 Compression for OLTP Workloads">Section 14.6.1.6, “Compression for OLTP Workloads”</a>.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_compression_level"></a>
          <a class="indexterm" name="idm140644108040928"></a>

          <code class="literal">innodb_compression_level</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_compression_level" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_compression_level=#</code></td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>System Variable</strong></span></td><td><span class="bold"><strong>Name</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_compression_level">innodb_compression_level</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="2">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="2">Yes</td></tr><tr><td scope="row" rowspan="4"><span class="bold"><strong>Permitted Values</strong></span></td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">integer</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">6</code></td></tr><tr><td scope="row"><span class="bold"><strong>Min Value</strong></span></td><td colspan="2"><code class="literal">0</code></td></tr><tr><td scope="row"><span class="bold"><strong>Max Value</strong></span></td><td colspan="2"><code class="literal">9</code></td></tr></tbody></table>
</div>
<p>
          Specifies the level of zlib compression to use for
          <code class="literal">InnoDB</code>
          <a class="link" href="glossary.html#glos_compression" title="compression">compressed</a> tables and
          indexes.
        </p><p>
          For more information, see
          <a class="xref" href="innodb-storage-engine.html#innodb-performance-compression-oltp" title="14.6.1.6 Compression for OLTP Workloads">Section 14.6.1.6, “Compression for OLTP Workloads”</a>.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_compression_pad_pct_max"></a>
          <a class="indexterm" name="idm140644108011264"></a>

          <code class="literal">innodb_compression_pad_pct_max</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_compression_pad_pct_max" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_compression_pad_pct_max=#</code></td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>System Variable</strong></span></td><td><span class="bold"><strong>Name</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_compression_pad_pct_max">innodb_compression_pad_pct_max</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="2">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="2">Yes</td></tr><tr><td scope="row" rowspan="4"><span class="bold"><strong>Permitted Values</strong></span></td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">integer</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">50</code></td></tr><tr><td scope="row"><span class="bold"><strong>Min Value</strong></span></td><td colspan="2"><code class="literal">0</code></td></tr><tr><td scope="row"><span class="bold"><strong>Max Value</strong></span></td><td colspan="2"><code class="literal">75</code></td></tr></tbody></table>
</div>
<p>
          Specifies the maximum percentage that can be reserved as free
          space within each compressed
          <a class="link" href="glossary.html#glos_page" title="page">page</a>, allowing room to
          reorganize the data and modification log within the page when
          a <a class="link" href="glossary.html#glos_compression" title="compression">compressed</a> table or
          index is updated and the data might be recompressed. Only
          applies when
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_compression_failure_threshold_pct"><code class="literal">innodb_compression_failure_threshold_pct</code></a>
          is set to a non-zero value, and the rate of
          <a class="link" href="glossary.html#glos_compression_failure" title="compression failure">compression
          failures</a> passes the cutoff point.
        </p><p>
          For more information, see
          <a class="xref" href="innodb-storage-engine.html#innodb-performance-compression-oltp" title="14.6.1.6 Compression for OLTP Workloads">Section 14.6.1.6, “Compression for OLTP Workloads”</a>.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_concurrency_tickets"></a>
          <a class="indexterm" name="idm140644107979024"></a>

          <a class="indexterm" name="idm140644107977920"></a>

          <a class="indexterm" name="idm140644107976464"></a>

          <code class="literal">innodb_concurrency_tickets</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_concurrency_tickets" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_concurrency_tickets=#</code></td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>System Variable</strong></span></td><td><span class="bold"><strong>Name</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_concurrency_tickets">innodb_concurrency_tickets</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="2">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="2">Yes</td></tr><tr><td scope="row" rowspan="4"><span class="bold"><strong>Permitted Values</strong></span></td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">integer</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">5000</code></td></tr><tr><td scope="row"><span class="bold"><strong>Min Value</strong></span></td><td colspan="2"><code class="literal">1</code></td></tr><tr><td scope="row"><span class="bold"><strong>Max Value</strong></span></td><td colspan="2"><code class="literal">4294967295</code></td></tr></tbody></table>
</div>
<p>
          Determines the number of
          <a class="link" href="glossary.html#glos_thread" title="thread">threads</a> that can enter
          <code class="literal">InnoDB</code> concurrently. A thread is placed in
          a queue when it tries to enter <code class="literal">InnoDB</code> if
          the number of threads has already reached the concurrency
          limit. When a thread is permitted to enter
          <code class="literal">InnoDB</code>, it is given a number of <span class="quote">“<span class="quote">free
          tickets</span>”</span> equal to the value of
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_concurrency_tickets"><code class="literal">innodb_concurrency_tickets</code></a>,
          and the thread can enter and leave <code class="literal">InnoDB</code>
          freely until it has used up its tickets. After that point, the
          thread again becomes subject to the concurrency check (and
          possible queuing) the next time it tries to enter
          <code class="literal">InnoDB</code>. The default value is 5000.
        </p><p>
          With a small <code class="literal">innodb_concurrency_tickets</code>
          value, small transactions that only need to process a few rows
          compete fairly with larger transactions that process many
          rows. The disadvantage of a small
          <code class="literal">innodb_concurrency_tickets</code> value is that
          large transactions must loop through the queue many times
          before they can complete, which extends the length of time
          required to complete their task.
        </p><p>
          With a large <code class="literal">innodb_concurrency_tickets</code>
          value, large transactions spend less time waiting for a
          position at the end of the queue (controlled by
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_thread_concurrency"><code class="literal">innodb_thread_concurrency</code></a>)
          and more time retrieving rows. Large transactions also require
          fewer trips through the queue to complete their task. The
          disadvantage of a large
          <code class="literal">innodb_concurrency_tickets</code> value is that
          too many large transactions running at the same time can
          starve smaller transactions by making them wait a longer time
          before executing.
        </p><p>
          With a non-zero
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_thread_concurrency"><code class="literal">innodb_thread_concurrency</code></a>
          value, you may need to adjust the
          <code class="literal">innodb_concurrency_tickets</code> value up or down
          to find the optimal balance between larger and smaller
          transactions. The <code class="literal">SHOW ENGINE INNODB STATUS</code>
          report shows the number of tickets remaining for an executing
          transaction in its current pass through the queue. This data
          may also be obtained from the
          <code class="literal">TRX_CONCURRENCY_TICKETS</code> column of the
          <a class="link" href="information-schema.html#innodb-trx-table" title="21.31.4 The INFORMATION_SCHEMA INNODB_TRX Table"><code class="literal">INFORMATION_SCHEMA.INNODB_TRX</code></a>
          table.
        </p><p>
          For more information, see
          <a class="xref" href="innodb-storage-engine.html#innodb-performance-thread_concurrency" title="14.3.6 Configuring Thread Concurrency for InnoDB">Section 14.3.6, “Configuring Thread Concurrency for InnoDB”</a>.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_create_intrinsic"></a>
          <a class="indexterm" name="idm140644107929728"></a>

          <a class="indexterm" name="idm140644107928688"></a>

          <code class="literal">innodb_create_intrinsic</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_create_intrinsic" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Introduced</strong></span></td><td colspan="3">5.7.5</td></tr><tr><td scope="row"><span class="bold"><strong>Removed</strong></span></td><td colspan="3">5.7.6</td></tr><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_create_intrinsic=#</code></td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>System Variable</strong></span></td><td><span class="bold"><strong>Name</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_create_intrinsic">innodb_create_intrinsic</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="2">Session</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="2">Yes</td></tr><tr><td scope="row" rowspan="2"><span class="bold"><strong>Permitted Values</strong></span></td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">boolean</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">OFF</code></td></tr></tbody></table>
</div>
<a class="indexterm" name="idm140644107903664"></a><p>
          When <code class="literal">innodb_create_intrinsic</code> is enabled,
          <a class="link" href="sql-syntax.html#create-table" title="13.1.18 CREATE TABLE Syntax"><code class="literal">CREATE TEMPORY
          TABLE</code></a> creates <span class="quote">“<span class="quote">optimized temporary
          tables</span>”</span> instead of normal temporary tables.
        </p><p>
          An optimized temporary table is a lightweight subclass of
          temporary table that excludes certain functionality and
          benefits from optimizations that makes it faster than a normal
          temporary table. Like normal temporary tables, optimized
          temporary tables are only visible to the current connection,
          and are dropped when the connection is terminated. Unlike
          normal temporary tables, optimized temporary tables are
          operational when <code class="literal">InnoDB</code> is in read-only
          mode.
        </p><p>
          Row format <code class="literal">COMPRESSED</code> is not supported. If
          you attempt to create a compressed optimized temporary table,
          the <code class="literal">innodb_create_intrinsic=ON</code> setting is
          ignored and <code class="literal">InnoDB</code> creates a normal
          temporary table.
        </p><p>
          Optimized temporary table metadata is not available in the
          <a class="link" href="information-schema.html#innodb-temp-table-info-table" title="21.31.27 The INFORMATION_SCHEMA INNODB_TEMP_TABLE_INFO Table"><code class="literal">INFORMATION_SCHEMA.INNODB_TEMP_TABLE_INFO</code></a>
          table.
        </p><p>
          Undo logging is disabled for optimized temporary tables, which
          means that rollback is also not supported.
        </p><p>
          Atomicity for optimized temporary tables is supported at the
          row-level, not at the statement level.
        </p><p>
          Statistics generated by the same workload may differ for
          intrinsic temporary tables compared to normal temporary
          tables, as optimized temporary tables may use a different
          algorithm to complete certain types of operations.
        </p><p>
          <code class="literal">innodb_create_intrinsic</code> was removed in
          MySQL 5.7.6.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_data_file_path"></a>
          <a class="indexterm" name="idm140644107889328"></a>

          <a class="indexterm" name="idm140644107888288"></a>

          <code class="literal">innodb_data_file_path</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_data_file_path" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_data_file_path=name</code></td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>System Variable</strong></span></td><td><span class="bold"><strong>Name</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_data_file_path">innodb_data_file_path</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="2">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="2">No</td></tr><tr><td scope="row" rowspan="2"><span class="bold"><strong>Permitted Values</strong></span></td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">string</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">ibdata1:12M:autoextend</code></td></tr></tbody></table>
</div>
<p>
          The paths to individual <code class="literal">InnoDB</code>
          <a class="link" href="glossary.html#glos_data_files" title="data files">data files</a> and their
          sizes. The full directory path to each data file is formed by
          concatenating
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_data_home_dir"><code class="literal">innodb_data_home_dir</code></a> to each
          path specified here. The file sizes are specified KB, MB or GB
          (1024MB) by appending <code class="literal">K</code>,
          <code class="literal">M</code> or <code class="literal">G</code> to the size
          value. If specifying data file size in kilobytes (KB), do so
          in multiples of 1024. Otherwise, KB values are rounded off to
          nearest megabyte (MB) boundary. The sum of the sizes of the
          files must be at least slightly larger than 10MB. If you do
          not specify <code class="literal">innodb_data_file_path</code>, the
          default behavior is to create a single auto-extending data
          file, slightly larger than 12MB, named
          <code class="filename">ibdata1</code>. The size limit of individual
          files is determined by your operating system. You can set the
          file size to more than 4GB on those operating systems that
          support big files. You can also
          <a class="link" href="innodb-storage-engine.html#innodb-raw-devices" title="14.4.3 Using Raw Disk Partitions for the System Tablespace">use raw disk partitions as
          data files</a>. For detailed information on configuring
          <code class="literal">InnoDB</code>
          <a class="link" href="glossary.html#glos_tablespace" title="tablespace">tablespace</a> files, see
          <a class="xref" href="innodb-storage-engine.html#innodb-configuration" title="14.3 InnoDB Configuration">Section 14.3, “InnoDB Configuration”</a>.
        </p><p>
          As of MySQL 5.7.8, the following minimum file sizes are
          enforced for the <span class="emphasis"><em>first</em></span> system tablespace
          data file (<code class="literal">ibdata1</code>) to ensure that there is
          enough space for doublewrite buffer blocks (Bug #20972309):
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
              For an <a class="link" href="innodb-storage-engine.html#sysvar_innodb_page_size"><code class="literal">innodb_page_size</code></a>
              value of 16KB or less, the minimum data file size is 3MB.
            </p></li><li class="listitem"><p>
              For an <a class="link" href="innodb-storage-engine.html#sysvar_innodb_page_size"><code class="literal">innodb_page_size</code></a>
              value of 32KB, the minimum data file size is 6MB.
            </p></li><li class="listitem"><p>
              For an <a class="link" href="innodb-storage-engine.html#sysvar_innodb_page_size"><code class="literal">innodb_page_size</code></a>
              value of 64KB, the minimum data file size is 12MB.
</p></li></ul>
</div>
</li><li class="listitem"><p><a name="sysvar_innodb_data_home_dir"></a>
          <a class="indexterm" name="idm140644107846688"></a>

          <a class="indexterm" name="idm140644107845648"></a>

          <code class="literal">innodb_data_home_dir</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_data_home_dir" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_data_home_dir=dir_name</code></td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>System Variable</strong></span></td><td><span class="bold"><strong>Name</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_data_home_dir">innodb_data_home_dir</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="2">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="2">No</td></tr><tr><td scope="row"><span class="bold"><strong>Permitted Values</strong></span></td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">directory name</code></td></tr></tbody></table>
</div>
<p>
          The common part of the directory path for all
          <code class="literal">InnoDB</code> <a class="link" href="glossary.html#glos_data_files" title="data files">data
          files</a> in the
          <a class="link" href="glossary.html#glos_system_tablespace" title="system tablespace">system
          tablespace</a>. This setting does not affect the location
          of <a class="link" href="glossary.html#glos_file_per_table" title="file-per-table">file-per-table</a>
          tablespaces when
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_per_table"><code class="literal">innodb_file_per_table</code></a> is
          enabled. The default value is the MySQL
          <code class="filename">data</code> directory. If you specify the value
          as an empty string, you can use absolute file paths in
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_data_file_path"><code class="literal">innodb_data_file_path</code></a>.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_default_row_format"></a>
          <a class="indexterm" name="idm140644107818256"></a>

          <a class="indexterm" name="idm140644107817152"></a>

          <code class="literal">innodb_default_row_format</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_default_row_format" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Introduced</strong></span></td><td colspan="3">5.7.9</td></tr><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_default_row_format=#</code></td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>System Variable</strong></span></td><td><span class="bold"><strong>Name</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_default_row_format">innodb_default_row_format</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="2">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="2">Yes</td></tr><tr><td scope="row" rowspan="5"><span class="bold"><strong>Permitted Values</strong></span></td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">enumeration</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">DYNAMIC</code></td></tr><tr><td scope="row" rowspan="3" valign="top"><span class="bold"><strong>Valid Values</strong></span></td><td colspan="2"><code class="literal">DYNAMIC</code></td></tr><tr><td scope="row" colspan="2"><code class="literal">COMPACT</code></td></tr><tr><td scope="row" colspan="2"><code class="literal">REDUNDANT</code></td></tr></tbody></table>
</div>
<p>
          The <code class="literal">innodb_default_row_format</code> option,
          introduced in MySQL 5.7.9, defines the default row format for
          <code class="literal">InnoDB</code> tables (including user-created
          <code class="literal">InnoDB</code> temporary tables). The default
          setting is <code class="literal">DYNAMIC</code>. Other permitted values
          are <code class="literal">COMPACT</code> and
          <code class="literal">REDUNDANT</code>. The
          <code class="literal">COMPRESSED</code> row format, which is not
          supported for use in the system tablespace, cannot be defined
          as the default.
        </p><p>
          Newly created tables use the row format defined by
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_default_row_format"><code class="literal">innodb_default_row_format</code></a>
          when a <code class="literal">ROW_FORMAT</code> option is not specified
          explicitly or when <code class="literal">ROW_FORMAT=DEFAULT</code> is
          used.
        </p><p>
          When a <code class="literal">ROW_FORMAT</code> option is not specified
          explicitly or when <code class="literal">ROW_FORMAT=DEFAULT</code> is
          used, any operation that rebuilds a table also silently
          changes the row format of the table to the format defined by
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_default_row_format"><code class="literal">innodb_default_row_format</code></a>.
          For more information, see
          <a class="xref" href="innodb-storage-engine.html#innodb-row-format-specification" title="14.8.2 Specifying the Row Format for a Table">Section 14.8.2, “Specifying the Row Format for a Table”</a>.
        </p><p>
          Internal <code class="literal">InnoDB</code> temporary tables created by
          the server to process queries use the
          <code class="literal">DYNAMIC</code> row format, regardless of the
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_default_row_format"><code class="literal">innodb_default_row_format</code></a>
          setting.
        </p><p>
          In MySQL 5.7.8 and earlier, the default row format is
          <code class="literal">COMPACT</code>.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_disable_sort_file_cache"></a>
          <a class="indexterm" name="idm140644107769760"></a>

          <a class="indexterm" name="idm140644107768656"></a>

          <code class="literal">innodb_disable_sort_file_cache</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_disable_sort_file_cache" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_disable_sort_file_cache=#</code></td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>System Variable</strong></span></td><td><span class="bold"><strong>Name</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_disable_sort_file_cache">innodb_disable_sort_file_cache</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="2">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="2">Yes</td></tr><tr><td scope="row" rowspan="2"><span class="bold"><strong>Permitted Values</strong></span></td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">boolean</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">OFF</code></td></tr></tbody></table>
</div>
<p>
          If enabled, this variable disables the operating system file
          system cache for merge-sort temporary files. The effect is to
          open such files with the equivalent of
          <code class="literal">O_DIRECT</code>.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_disable_resize_buffer_pool_debug"></a>
          <a class="indexterm" name="idm140644107744784"></a>

          <a class="indexterm" name="idm140644107743696"></a>

          <code class="literal">innodb_disable_resize_buffer_pool_debug</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_disable_resize_buffer_pool_debug" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Introduced</strong></span></td><td colspan="3">5.7.6</td></tr><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_disable_resize_buffer_pool_debug=#</code></td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>System Variable</strong></span></td><td><span class="bold"><strong>Name</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_disable_resize_buffer_pool_debug">innodb_disable_resize_buffer_pool_debug</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="2">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="2">Yes</td></tr><tr><td scope="row" rowspan="2"><span class="bold"><strong>Permitted Values</strong></span></td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">boolean</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">ON</code></td></tr></tbody></table>
</div>
<p>
          Disables resizing of the <code class="literal">InnoDB</code> buffer
          pool. This option is only available if debugging support is
          compiled in using the <a class="link" href="installing.html#option_cmake_with_debug"><code class="option">WITH_DEBUG</code></a>
          <span class="command"><strong>CMake</strong></span> option.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_doublewrite"></a>
          <a class="indexterm" name="idm140644107716432"></a>

          <a class="indexterm" name="idm140644107715392"></a>

          <a class="indexterm" name="idm140644107713904"></a>

          <code class="literal">innodb_doublewrite</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_doublewrite" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb-doublewrite</code></td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>System Variable</strong></span></td><td><span class="bold"><strong>Name</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_doublewrite">innodb_doublewrite</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="2">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="2">No</td></tr><tr><td scope="row" rowspan="2"><span class="bold"><strong>Permitted Values</strong></span></td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">boolean</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">ON</code></td></tr></tbody></table>
</div>
<p>
          If this variable is enabled (the default),
          <code class="literal">InnoDB</code> stores all data twice, first to the
          <a class="link" href="glossary.html#glos_doublewrite_buffer" title="doublewrite buffer">doublewrite
          buffer</a>, then to the actual
          <a class="link" href="glossary.html#glos_data_files" title="data files">data files</a>. This
          variable can be turned off with
          <code class="option">--skip-innodb_doublewrite</code> for benchmarks or
          cases when top performance is needed rather than concern for
          data integrity or possible failures.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_fast_shutdown"></a>
          <a class="indexterm" name="idm140644107688368"></a>

          <a class="indexterm" name="idm140644107687328"></a>

          <code class="literal">innodb_fast_shutdown</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_fast_shutdown" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_fast_shutdown[=#]</code></td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>System Variable</strong></span></td><td><span class="bold"><strong>Name</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_fast_shutdown">innodb_fast_shutdown</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="2">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="2">Yes</td></tr><tr><td scope="row" rowspan="5"><span class="bold"><strong>Permitted Values</strong></span></td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">integer</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">1</code></td></tr><tr><td scope="row" rowspan="3" valign="top"><span class="bold"><strong>Valid Values</strong></span></td><td colspan="2"><code class="literal">0</code></td></tr><tr><td scope="row" colspan="2"><code class="literal">1</code></td></tr><tr><td scope="row" colspan="2"><code class="literal">2</code></td></tr></tbody></table>
</div>
<p>
          The <code class="literal">InnoDB</code>
          <a class="link" href="glossary.html#glos_shutdown" title="shutdown">shutdown</a> mode. If the
          value is 0, <code class="literal">InnoDB</code> does a
          <a class="link" href="glossary.html#glos_slow_shutdown" title="slow shutdown">slow shutdown</a>, a
          full <a class="link" href="glossary.html#glos_purge" title="purge">purge</a> and a change
          buffer merge before shutting down. If the value is 1 (the
          default), <code class="literal">InnoDB</code> skips these operations at
          shutdown, a process known as a
          <a class="link" href="glossary.html#glos_fast_shutdown" title="fast shutdown">fast shutdown</a>. If
          the value is 2, <code class="literal">InnoDB</code> flushes its logs and
          shuts down cold, as if MySQL had crashed; no committed
          transactions are lost, but the
          <a class="link" href="glossary.html#glos_crash_recovery" title="crash recovery">crash recovery</a>
          operation makes the next startup take longer.
        </p><p>
          The slow shutdown can take minutes, or even hours in extreme
          cases where substantial amounts of data are still buffered.
          Use the slow shutdown technique before upgrading or
          downgrading between MySQL major releases, so that all data
          files are fully prepared in case the upgrade process updates
          the file format.
        </p><p>
          Use <code class="literal">innodb_fast_shutdown=2</code> in emergency or
          troubleshooting situations, to get the absolute fastest
          shutdown if data is at risk of corruption.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_fil_make_page_dirty_debug"></a>
          <a class="indexterm" name="idm140644107649376"></a>

          <a class="indexterm" name="idm140644107648336"></a>

          <code class="literal">innodb_fil_make_page_dirty_debug</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_fil_make_page_dirty_debug" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_fil_make_page_dirty_debug=#</code></td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>System Variable</strong></span></td><td><span class="bold"><strong>Name</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_fil_make_page_dirty_debug">innodb_fil_make_page_dirty_debug</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="2">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="2">Yes</td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>Permitted Values</strong></span></td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">integer</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">0</code></td></tr><tr><td scope="row"><span class="bold"><strong>Max Value</strong></span></td><td colspan="2"><code class="literal">2**32-1</code></td></tr></tbody></table>
</div>
<p>
          By default, setting
          <code class="literal">innodb_fil_make_page_dirty_debug</code> to the ID
          of a tablespace immediately dirties the first page of the
          tablespace. If
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_saved_page_number_debug"><code class="literal">innodb_saved_page_number_debug</code></a>
          is set to a non-default value, setting
          <code class="literal">innodb_fil_make_page_dirty_debug</code> dirties
          the specified page. The
          <code class="literal">innodb_fil_make_page_dirty_debug</code> option is
          only available if debugging support is compiled in using the
          <a class="link" href="installing.html#option_cmake_with_debug"><code class="option">WITH_DEBUG</code></a>
          <span class="command"><strong>CMake</strong></span> option.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_file_format"></a>
          <a class="indexterm" name="idm140644107617776"></a>

          <a class="indexterm" name="idm140644107616736"></a>

          <a class="indexterm" name="idm140644107615248"></a>

          <a class="indexterm" name="idm140644107614176"></a>

          <code class="literal">innodb_file_format</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_file_format" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Deprecated</strong></span></td><td colspan="3">5.7.7</td></tr><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_file_format=#</code></td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>System Variable</strong></span></td><td><span class="bold"><strong>Name</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_format">innodb_file_format</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="2">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="2">Yes</td></tr><tr><td scope="row" rowspan="4"><span class="bold"><strong>Permitted Values</strong></span> (&lt;= 5.7.6)</td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">string</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">Antelope</code></td></tr><tr><td scope="row" rowspan="2" valign="top"><span class="bold"><strong>Valid Values</strong></span></td><td colspan="2"><code class="literal">Antelope</code></td></tr><tr><td scope="row" colspan="2"><code class="literal">Barracuda</code></td></tr><tr><td scope="row" rowspan="4"><span class="bold"><strong>Permitted Values</strong></span> (&gt;= 5.7.7)</td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">string</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">Barracuda</code></td></tr><tr><td scope="row" rowspan="2" valign="top"><span class="bold"><strong>Valid Values</strong></span></td><td colspan="2"><code class="literal">Antelope</code></td></tr><tr><td scope="row" colspan="2"><code class="literal">Barracuda</code></td></tr></tbody></table>
</div>
<p>
          The <a class="link" href="glossary.html#glos_file_format" title="file format">file format</a> to use
          for new <code class="literal">InnoDB</code> tables. Currently,
          <code class="literal">Antelope</code> and <code class="literal">Barracuda</code>
          are supported. This setting only applies to tables that have
          their own
          <a class="link" href="glossary.html#glos_file_per_table" title="file-per-table">file-per-table</a>
          <a class="link" href="glossary.html#glos_tablespace" title="tablespace">tablespace</a>, so for it
          to have an effect,
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_per_table"><code class="literal">innodb_file_per_table</code></a> must be
          enabled. The <a class="link" href="glossary.html#glos_barracuda" title="Barracuda">Barracuda</a>
          file format is required to use
          <a class="link" href="glossary.html#glos_compressed_row_format" title="compressed row format">Compressed</a>
          or <a class="link" href="glossary.html#glos_dynamic_row_format" title="dynamic row format">Dynamic</a> row
          formats and associated features such as
          <a class="link" href="glossary.html#glos_compression" title="compression">compression</a>, off-page
          storage for large variable-length columns, and large index key
          prefixes (see
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_large_prefix"><code class="literal">innodb_large_prefix</code></a>). This
          restriction does not apply to tables stored in general
          tablespaces. For more information, see
          <a class="xref" href="innodb-storage-engine.html#general-tablespaces" title="14.4.9 InnoDB General Tablespaces">Section 14.4.9, “InnoDB General Tablespaces”</a>.
        </p><p>
          Be aware that <a class="link" href="sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a>
          operations that recreate <code class="literal">InnoDB</code> tables
          (<code class="literal">ALGORITHM=COPY</code>) in file-per-table
          tablespaces will use the current
          <code class="literal">innodb_file_format</code> setting (the conditions
          outlined above still apply).
        </p><p>
          The <code class="literal">innodb_file_format</code> default value was
          changed to <code class="literal">Barracuda</code> in MySQL 5.7.7. This
          change allows
          <a class="link" href="glossary.html#glos_compressed_row_format" title="compressed row format">Compressed</a>
          or <a class="link" href="glossary.html#glos_dynamic_row_format" title="dynamic row format">Dynamic</a> row
          formats to be used for tables stored in file-per-table
          tablespaces.
        </p><p>
          The <a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_format"><code class="literal">innodb_file_format</code></a> option
          is also deprecated in MySQL 5.7.7, and will be removed in a
          future release. The purpose of the
          <code class="literal">innodb_file_format</code> option was to allow
          users to downgrade to the built-in version of
          <code class="literal">InnoDB</code> in MySQL 5.1. Now that MySQL 5.1 has
          reached the end of its product lifecycle, downgrade support
          provided by this option is no longer necessary.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_file_format_check"></a>
          <a class="indexterm" name="idm140644107552896"></a>

          <a class="indexterm" name="idm140644107551792"></a>

          <code class="literal">innodb_file_format_check</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_file_format_check" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Deprecated</strong></span></td><td colspan="3">5.7.7</td></tr><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_file_format_check=#</code></td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>System Variable</strong></span></td><td><span class="bold"><strong>Name</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_format_check">innodb_file_format_check</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="2">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="2">No</td></tr><tr><td scope="row" rowspan="2"><span class="bold"><strong>Permitted Values</strong></span></td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">boolean</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">ON</code></td></tr></tbody></table>
</div>
<p>
          This variable can be set to 1 or 0 at server startup to enable
          or disable whether <code class="literal">InnoDB</code> checks the
          <a class="link" href="glossary.html#glos_file_format" title="file format">file format</a> tag in the
          <a class="link" href="glossary.html#glos_system_tablespace" title="system tablespace">system
          tablespace</a> (for example, <code class="literal">Antelope</code> or
          <code class="literal">Barracuda</code>). If the tag is checked and is
          higher than that supported by the current version of
          <code class="literal">InnoDB</code>, an error occurs and
          <code class="literal">InnoDB</code> does not start. If the tag is not
          higher, <code class="literal">InnoDB</code> sets the value of
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_format_max"><code class="literal">innodb_file_format_max</code></a> to the
          file format tag.
</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
            Despite the default value sometimes being displayed as
            <code class="literal">ON</code> or <code class="literal">OFF</code>, always use
            the numeric values 1 or 0 to turn this option on or off in
            your configuration file or command line.
</p>
</div>
<p>
          The <a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_format_check"><code class="literal">innodb_file_format_check</code></a>
          option is deprecated in MySQL 5.7.7 together with the
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_format"><code class="literal">innodb_file_format</code></a> option.
          Both options will be removed in a future release.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_file_format_max"></a>
          <a class="indexterm" name="idm140644107514064"></a>

          <a class="indexterm" name="idm140644107513024"></a>

          <code class="literal">innodb_file_format_max</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_file_format_max" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Deprecated</strong></span></td><td colspan="3">5.7.7</td></tr><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_file_format_max=#</code></td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>System Variable</strong></span></td><td><span class="bold"><strong>Name</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_format_max">innodb_file_format_max</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="2">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="2">Yes</td></tr><tr><td scope="row" rowspan="4"><span class="bold"><strong>Permitted Values</strong></span></td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">string</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">Antelope</code></td></tr><tr><td scope="row" rowspan="2" valign="top"><span class="bold"><strong>Valid Values</strong></span></td><td colspan="2"><code class="literal">Antelope</code></td></tr><tr><td scope="row" colspan="2"><code class="literal">Barracuda</code></td></tr></tbody></table>
</div>
<p>
          At server startup, <code class="literal">InnoDB</code> sets the value of
          this variable to the <a class="link" href="glossary.html#glos_file_format" title="file format">file
          format</a> tag in the
          <a class="link" href="glossary.html#glos_system_tablespace" title="system tablespace">system
          tablespace</a> (for example, <code class="literal">Antelope</code> or
          <code class="literal">Barracuda</code>). If the server creates or opens
          a table with a <span class="quote">“<span class="quote">higher</span>”</span> file format, it sets the
          value of
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_format_max"><code class="literal">innodb_file_format_max</code></a> to
          that format.
        </p><p>
          The <a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_format_max"><code class="literal">innodb_file_format_max</code></a>
          option is deprecated in MySQL 5.7.7 together with the
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_format"><code class="literal">innodb_file_format</code></a> option.
          Both options will be removed in a future release.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_file_per_table"></a>
          <a class="indexterm" name="idm140644107475408"></a>

          <a class="indexterm" name="idm140644107474368"></a>

          <code class="literal">innodb_file_per_table</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_file_per_table" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_file_per_table</code></td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>System Variable</strong></span></td><td><span class="bold"><strong>Name</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_per_table">innodb_file_per_table</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="2">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="2">Yes</td></tr><tr><td scope="row" rowspan="2"><span class="bold"><strong>Permitted Values</strong></span></td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">boolean</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">ON</code></td></tr></tbody></table>
</div>
<p>
          When <code class="literal">innodb_file_per_table</code> is enabled (the
          default in 5.6.6 and higher), <code class="literal">InnoDB</code> stores
          the data and indexes for each newly created table in a
          separate
          <a class="link" href="glossary.html#glos_ibd_file" title=".ibd file"><code class="filename">.ibd</code>
          file</a>, rather than in the system tablespace. The storage
          for these <code class="literal">InnoDB</code> tables is reclaimed when
          the tables are dropped or truncated. This setting enables
          several other <code class="literal">InnoDB</code> features, such as
          table <a class="link" href="glossary.html#glos_compression" title="compression">compression</a>. See
          <a class="xref" href="innodb-storage-engine.html#innodb-multiple-tablespaces" title="14.4.4 InnoDB File-Per-Table Tablespaces">Section 14.4.4, “InnoDB File-Per-Table Tablespaces”</a> for details
          about such features as well as advantages and disadvantages of
          using per-table tablespaces.
        </p><p>
          Be aware that enabling
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_per_table"><code class="literal">innodb_file_per_table</code></a> also
          means that an <a class="link" href="sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a>
          operation will move <code class="literal">InnoDB</code> table from the
          system tablespace to an individual <code class="filename">.ibd</code>
          file in cases where <a class="link" href="sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a>
          recreates the table (<code class="literal">ALGORITHM=COPY</code>). An
          exception to this rule is for tables that were placed in the
          system tablespace using the
          <code class="literal">TABLESPACE=innodb_system</code> option with
          <a class="link" href="sql-syntax.html#create-table" title="13.1.18 CREATE TABLE Syntax"><code class="literal">CREATE TABLE</code></a> or
          <a class="link" href="sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a>. These tables are
          unaffected by the <code class="literal">innodb_file_per_table</code>
          setting and can only be moved to file-per-table tablespaces
          using <a class="link" href="sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE Syntax"><code class="literal">ALTER TABLE
          ... TABLESPACE=innodb_file_per_table</code></a>.
        </p><p>
          When <code class="literal">innodb_file_per_table</code> is disabled,
          <code class="literal">InnoDB</code> stores the data for all tables and
          indexes in the <a class="link" href="glossary.html#glos_ibdata_file" title="ibdata file">ibdata
          files</a> that make up the
          <a class="link" href="glossary.html#glos_system_tablespace" title="system tablespace">system
          tablespace</a>. This setting reduces the performance
          overhead of filesystem operations for operations such as
          <a class="link" href="sql-syntax.html#drop-table" title="13.1.29 DROP TABLE Syntax"><code class="literal">DROP TABLE</code></a> or
          <a class="link" href="sql-syntax.html#truncate-table" title="13.1.34 TRUNCATE TABLE Syntax"><code class="literal">TRUNCATE TABLE</code></a>. It is most
          appropriate for a server environment where entire storage
          devices are devoted to MySQL data. Because the system
          tablespace never shrinks, and is shared across all databases
          in an <a class="link" href="glossary.html#glos_instance" title="instance">instance</a>, avoid
          loading huge amounts of temporary data on a space-constrained
          system when <code class="literal">innodb_file_per_table=OFF</code>. Set
          up a separate instance in such cases, so that you can drop the
          entire instance to reclaim the space.
        </p><p>
          By default, <code class="literal">innodb_file_per_table</code> is
          enabled as of MySQL 5.6.6, disabled before that. Consider
          disabling it if backward compatibility with MySQL 5.5 or 5.1
          is a concern. This will prevent <a class="link" href="sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE Syntax"><code class="literal">ALTER
          TABLE</code></a> from moving
          <a class="link" href="innodb-storage-engine.html" title="Chapter 14 The InnoDB Storage Engine"><code class="literal">InnoDB</code></a> tables from the system
          tablespace to individual <code class="filename">.ibd</code> files.
        </p><p>
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_per_table"><code class="literal">innodb_file_per_table</code></a> is
          dynamic and can be set <code class="literal">ON</code> or
          <code class="literal">OFF</code> using <code class="literal">SET GLOBAL</code>.
          You can also set this parameter in the MySQL
          <a class="link" href="glossary.html#glos_configuration_file" title="configuration file">configuration
          file</a> (<code class="filename">my.cnf</code> or
          <code class="filename">my.ini</code>) but this requires shutting down
          and restarting the server.
        </p><p>
          Dynamically changing the value of this parameter requires the
          <code class="literal">SUPER</code> privilege and immediately affects the
          operation of all connections.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_fill_factor"></a>
          <a class="indexterm" name="idm140644107413312"></a>

          <a class="indexterm" name="idm140644107412272"></a>

          <code class="literal">innodb_fill_factor</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_fill_factor" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Introduced</strong></span></td><td colspan="3">5.7.5</td></tr><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_fill_factor=#</code></td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>System Variable</strong></span></td><td><span class="bold"><strong>Name</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_fill_factor">innodb_fill_factor</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="2">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="2">Yes</td></tr><tr><td scope="row" rowspan="4"><span class="bold"><strong>Permitted Values</strong></span></td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">integer</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">100</code></td></tr><tr><td scope="row"><span class="bold"><strong>Min Value</strong></span></td><td colspan="2"><code class="literal">10</code></td></tr><tr><td scope="row"><span class="bold"><strong>Max Value</strong></span></td><td colspan="2"><code class="literal">100</code></td></tr></tbody></table>
</div>
<p>
          As of MySQL 5.7.5, <code class="literal">InnoDB</code> performs a bulk
          load when creating or rebuilding indexes. This method of index
          creation is known as a <span class="quote">“<span class="quote">sorted index build</span>”</span>.
        </p><p>
          <code class="literal">innodb_fill_factor</code> defines the percentage
          of space on each B-tree page that is filled during a sorted
          index build, with the remaining space reserved for future
          index growth. For example, setting
          <code class="literal">innodb_fill_factor</code> to 80 reserves 20
          percent of the space on each B-tree page for future index
          growth. Actual percentages may vary. The
          <code class="literal">innodb_fill_factor</code> setting is interpreted
          as a hint rather than a hard limit.
        </p><p>
          As of MySQL 5.7.8, an
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_fill_factor"><code class="literal">innodb_fill_factor</code></a> setting of
          100 leaves 1/16 of the space in clustered index pages free for
          future index growth (MySQL Bug #74325).
        </p><p>
          <code class="literal">innodb_fill_factor</code> applies to both B-tree
          leaf and non-leaf pages. It does not apply to external pages
          used for <a class="link" href="data-types.html#blob" title="11.4.3 The BLOB and TEXT Types"><code class="literal">TEXT</code></a> or
          <a class="link" href="data-types.html#blob" title="11.4.3 The BLOB and TEXT Types"><code class="literal">BLOB</code></a> entries.
        </p><p>
          For more information, see
          <a class="xref" href="innodb-storage-engine.html#sorted-index-builds" title="14.2.7.8 Sorted Index Builds">Section 14.2.7.8, “Sorted Index Builds”</a>.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_flush_log_at_timeout"></a>
          <a class="indexterm" name="idm140644107372272"></a>

          <a class="indexterm" name="idm140644107371168"></a>

          <code class="literal">innodb_flush_log_at_timeout</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_flush_log_at_timeout" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row" rowspan="3"><span class="bold"><strong>System Variable</strong></span></td><td><span class="bold"><strong>Name</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_flush_log_at_timeout">innodb_flush_log_at_timeout</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="2">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="2">Yes</td></tr><tr><td scope="row" rowspan="4"><span class="bold"><strong>Permitted Values</strong></span></td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">integer</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">1</code></td></tr><tr><td scope="row"><span class="bold"><strong>Min Value</strong></span></td><td colspan="2"><code class="literal">1</code></td></tr><tr><td scope="row"><span class="bold"><strong>Max Value</strong></span></td><td colspan="2"><code class="literal">2700</code></td></tr></tbody></table>
</div>
<p>
          Write and flush the logs every <em class="replaceable"><code>N</code></em>
          seconds.
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_flush_log_at_timeout"><code class="literal">innodb_flush_log_at_timeout</code></a>
          was introduced in MySQL 5.6.6. It allows the timeout period
          between flushes to be increased in order to reduce flushing
          and avoid impacting performance of binary log group commit.
          Prior to MySQL 5.6.6, flushing frequency was once per second.
          The default setting for
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_flush_log_at_timeout"><code class="literal">innodb_flush_log_at_timeout</code></a>
          is also once per second.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_flush_log_at_trx_commit"></a>
          <a class="indexterm" name="idm140644107342720"></a>

          <a class="indexterm" name="idm140644107341616"></a>

          <code class="literal">innodb_flush_log_at_trx_commit</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_flush_log_at_trx_commit" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_flush_log_at_trx_commit[=#]</code></td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>System Variable</strong></span></td><td><span class="bold"><strong>Name</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_flush_log_at_trx_commit">innodb_flush_log_at_trx_commit</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="2">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="2">Yes</td></tr><tr><td scope="row" rowspan="5"><span class="bold"><strong>Permitted Values</strong></span></td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">enumeration</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">1</code></td></tr><tr><td scope="row" rowspan="3" valign="top"><span class="bold"><strong>Valid Values</strong></span></td><td colspan="2"><code class="literal">0</code></td></tr><tr><td scope="row" colspan="2"><code class="literal">1</code></td></tr><tr><td scope="row" colspan="2"><code class="literal">2</code></td></tr></tbody></table>
</div>
<p>
          Controls the balance between strict
          <a class="link" href="glossary.html#glos_acid" title="ACID">ACID</a> compliance for
          <a class="link" href="glossary.html#glos_commit" title="commit">commit</a> operations, and
          higher performance that is possible when commit-related I/O
          operations are rearranged and done in batches. You can achieve
          better performance by changing the default value, but then you
          can lose up to a second of transactions in a crash.
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
              The default value of 1 is required for full ACID
              compliance. With this value, the contents of the
              <code class="literal">InnoDB</code>
              <a class="link" href="glossary.html#glos_log_buffer" title="log buffer">log buffer</a> are
              written out to the <a class="link" href="glossary.html#glos_log_file" title="log file">log
              file</a> at each transaction commit and the log file is
              <a class="link" href="glossary.html#glos_flush" title="flush">flushed</a> to disk.
            </p></li><li class="listitem"><p>
              With a value of 0, the contents of the
              <code class="literal">InnoDB</code> log buffer are written to the
              log file approximately once per second and the log file is
              flushed to disk. No writes from the log buffer to the log
              file are performed at transaction commit. Once-per-second
              flushing is not 100% guaranteed to happen every second,
              due to process scheduling issues. Because the flush to
              disk operation only occurs approximately once per second,
              you can lose up to a second of transactions with any
              <a class="link" href="programs.html#mysqld" title="4.3.1 mysqld — The MySQL Server"><span class="command"><strong>mysqld</strong></span></a> process crash.
            </p></li><li class="listitem"><p>
              With a value of 2, the contents of the
              <code class="literal">InnoDB</code> log buffer are written to the
              log file after each transaction commit and the log file is
              flushed to disk approximately once per second.
              Once-per-second flushing is not 100% guaranteed to happen
              every second, due to process scheduling issues. Because
              the flush to disk operation only occurs approximately once
              per second, you can lose up to a second of transactions in
              an operating system crash or a power outage.
            </p></li><li class="listitem"><p>
              As of MySQL 5.6.6, <code class="filename">InnoDB</code> log
              flushing frequency is controlled by
              <a class="link" href="innodb-storage-engine.html#sysvar_innodb_flush_log_at_timeout"><code class="literal">innodb_flush_log_at_timeout</code></a>,
              which allows you to set log flushing frequency to
              <em class="replaceable"><code>N</code></em> seconds (where
              <em class="replaceable"><code>N</code></em> is <code class="literal">1 ...
              2700</code>, with a default value of 1). However, any
              <a class="link" href="programs.html#mysqld" title="4.3.1 mysqld — The MySQL Server"><span class="command"><strong>mysqld</strong></span></a> process crash can erase up to
              <em class="replaceable"><code>N</code></em> seconds of transactions.
            </p></li><li class="listitem"><p>
              DDL changes and other internal <code class="literal">InnoDB</code>
              activities flush the <code class="literal">InnoDB</code> log
              independent of the
              <code class="literal">innodb_flush_log_at_trx_commit</code> setting.
            </p></li><li class="listitem"><p>
              <code class="literal">InnoDB</code>'s
              <a class="link" href="glossary.html#glos_crash_recovery" title="crash recovery">crash recovery</a>
              works regardless of the
              <code class="literal">innodb_flush_log_at_trx_commit</code> setting.
              Transactions are either applied entirely or erased
              entirely.
</p></li></ul>
</div>
<p>
          For durability and consistency in a replication setup that
          uses <code class="literal">InnoDB</code> with transactions:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
              If binary logging is enabled, set
              <code class="literal">sync_binlog=1</code>.
            </p></li><li class="listitem"><p>
              Always set
              <code class="literal">innodb_flush_log_at_trx_commit=1</code>.
</p></li></ul>
</div>
<div class="caution" style="margin-left: 0.5in; margin-right: 0.5in;">
<div class="admon-title">
Caution
</div>
<p>
            Many operating systems and some disk hardware fool the
            flush-to-disk operation. They may tell
            <a class="link" href="programs.html#mysqld" title="4.3.1 mysqld — The MySQL Server"><span class="command"><strong>mysqld</strong></span></a> that the flush has taken place,
            even though it has not. Then the durability of transactions
            is not guaranteed even with the setting 1, and in the worst
            case a power outage can even corrupt
            <code class="literal">InnoDB</code> data. Using a battery-backed disk
            cache in the SCSI disk controller or in the disk itself
            speeds up file flushes, and makes the operation safer. You
            can also try using the Unix command
            <span class="command"><strong>hdparm</strong></span> to disable the caching of disk
            writes in hardware caches, or use some other command
            specific to the hardware vendor.
</p>
</div>
</li><li class="listitem"><p><a name="sysvar_innodb_flush_method"></a>
          <a class="indexterm" name="idm140644107279824"></a>

          <a class="indexterm" name="idm140644107278784"></a>

          <code class="literal">innodb_flush_method</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_flush_method" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_flush_method=name</code></td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>System Variable</strong></span></td><td><span class="bold"><strong>Name</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_flush_method">innodb_flush_method</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="2">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="2">No</td></tr><tr><td scope="row" rowspan="8"><span class="bold"><strong>Permitted Values</strong></span> (Unix)</td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">string</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">NULL</code></td></tr><tr><td scope="row" rowspan="6" valign="top"><span class="bold"><strong>Valid Values</strong></span></td><td colspan="2"><code class="literal">fsync</code></td></tr><tr><td scope="row" colspan="2"><code class="literal">O_DSYNC</code></td></tr><tr><td scope="row" colspan="2"><code class="literal">littlesync</code></td></tr><tr><td scope="row" colspan="2"><code class="literal">nosync</code></td></tr><tr><td scope="row" colspan="2"><code class="literal">O_DIRECT</code></td></tr><tr><td scope="row" colspan="2"><code class="literal">O_DIRECT_NO_FSYNC</code></td></tr><tr><td scope="row" rowspan="5"><span class="bold"><strong>Permitted Values</strong></span> (Windows)</td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">string</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">NULL</code></td></tr><tr><td scope="row" rowspan="3" valign="top"><span class="bold"><strong>Valid Values</strong></span></td><td colspan="2"><code class="literal">async_unbuffered</code></td></tr><tr><td scope="row" colspan="2"><code class="literal">normal</code></td></tr><tr><td scope="row" colspan="2"><code class="literal">unbuffered</code></td></tr></tbody></table>
</div>
<p>
          Defines the method used to
          <a class="link" href="glossary.html#glos_flush" title="flush">flush</a> data to the
          <code class="literal">InnoDB</code> <a class="link" href="glossary.html#glos_data_files" title="data files">data
          files</a> and <a class="link" href="glossary.html#glos_log_file" title="log file">log
          files</a>, which can affect I/O throughput.
        </p><p>
          If <code class="literal">innodb_flush_method=NULL</code> on a Unix-like
          system, the <code class="literal">fsync</code> option is used by
          default. If <code class="literal">innodb_flush_method=NULL</code> on
          Windows, the <code class="literal">async_unbuffered</code> option is
          used by default.
        </p><p>
          The <code class="literal">innodb_flush_method</code> options for
          Unix-like systems include:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
              <code class="literal">fsync</code>: <code class="literal">InnoDB</code> uses
              the <code class="literal">fsync()</code> system call to flush both
              the data and log files. <code class="literal">fsync</code> is the
              default setting.
            </p></li><li class="listitem"><p>
              <code class="literal">O_DSYNC</code>: <code class="literal">InnoDB</code> uses
              <code class="literal">O_SYNC</code> to open and flush the log files,
              and <code class="literal">fsync()</code> to flush the data files.
              <code class="literal">InnoDB</code> does not use
              <code class="literal">O_DSYNC</code> directly because there have
              been problems with it on many varieties of Unix.
            </p></li><li class="listitem"><p>
              <code class="literal">littlesync</code>: This option is used for
              internal performance testing and is currently unsupported.
              Use at your own risk.
            </p></li><li class="listitem"><p>
              <code class="literal">nosync</code>: This option is used for
              internal performance testing and is currently unsupported.
              Use at your own risk.
            </p></li><li class="listitem"><p>
              <code class="literal">O_DIRECT</code>: <code class="literal">InnoDB</code>
              uses <code class="literal">O_DIRECT</code> (or
              <code class="literal">directio()</code> on Solaris) to open the data
              files, and uses <code class="literal">fsync()</code> to flush both
              the data and log files. This option is available on some
              GNU/Linux versions, FreeBSD, and Solaris.
            </p></li><li class="listitem"><p>
              <code class="literal">O_DIRECT_NO_FSYNC</code>:
              <code class="literal">InnoDB</code> uses <code class="literal">O_DIRECT</code>
              during flushing I/O, but skips the
              <code class="literal">fsync()</code> system call afterwards. This
              setting is suitable for some types of file systems but not
              others. For example, it is not suitable for XFS. If you
              are not sure whether the file system you use requires an
              <code class="literal">fsync()</code>, for example to preserve all
              file metadata, use <code class="literal">O_DIRECT</code> instead.
              This option was introduced in MySQL 5.6.7 (Bug #11754304,
              Bug #45892).
</p></li></ul>
</div>
<p>
          The <code class="literal">innodb_flush_method</code> options for Windows
          systems include:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
              <code class="literal">async_unbuffered</code>:
              <code class="literal">InnoDB</code> uses Windows asynchronous I/O
              and non-buffered I/O. <code class="literal">async_unbuffered</code>
              is the default setting on Windows systems.
            </p></li><li class="listitem"><p>
              <code class="literal">normal</code>: <code class="literal">InnoDB</code> uses
              a simulated asynchronous I/O and buffered I/O.
            </p></li><li class="listitem"><p>
              <code class="literal">unbuffered</code>: <code class="literal">InnoDB</code>
              uses a simulated asynchronous I/O and non-buffered I/O.
</p></li></ul>
</div>
<p>
          How each settings affects performance depends on hardware
          configuration and workload. Benchmark your particular
          configuration to decide which setting to use, or whether to
          keep the default setting. Examine the
          <a class="link" href="server-administration.html#statvar_Innodb_data_fsyncs"><code class="literal">Innodb_data_fsyncs</code></a> status
          variable to see the overall number of
          <code class="literal">fsync()</code> calls for each setting. The mix of
          read and write operations in your workload can affect how a
          setting performs. For example, on a system with a hardware
          RAID controller and battery-backed write cache,
          <code class="literal">O_DIRECT</code> can help to avoid double buffering
          between the <code class="literal">InnoDB</code> buffer pool and the
          operating system's file system cache. On some systems where
          <code class="literal">InnoDB</code> data and log files are located on a
          SAN, the default value or <code class="literal">O_DSYNC</code> might be
          faster for a read-heavy workload with mostly
          <code class="literal">SELECT</code> statements. Always test this
          parameter with hardware and workload that reflect your
          production environment. For general I/O tuning advice, see
          <a class="xref" href="optimization.html#optimizing-innodb-diskio" title="8.5.8 Optimizing InnoDB Disk I/O">Section 8.5.8, “Optimizing InnoDB Disk I/O”</a>.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_flush_neighbors"></a>
          <a class="indexterm" name="idm140644107186384"></a>

          <code class="literal">innodb_flush_neighbors</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_flush_neighbors" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_flush_neighbors</code></td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>System Variable</strong></span></td><td><span class="bold"><strong>Name</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_flush_neighbors">innodb_flush_neighbors</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="2">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="2">Yes</td></tr><tr><td scope="row" rowspan="5"><span class="bold"><strong>Permitted Values</strong></span></td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">enumeration</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">1</code></td></tr><tr><td scope="row" rowspan="3" valign="top"><span class="bold"><strong>Valid Values</strong></span></td><td colspan="2"><code class="literal">0</code></td></tr><tr><td scope="row" colspan="2"><code class="literal">1</code></td></tr><tr><td scope="row" colspan="2"><code class="literal">2</code></td></tr></tbody></table>
</div>
<p>
          Specifies whether <a class="link" href="glossary.html#glos_flush" title="flush">flushing</a> a
          page from the InnoDB <a class="link" href="glossary.html#glos_buffer_pool" title="buffer pool">buffer
          pool</a> also flushes other
          <a class="link" href="glossary.html#glos_dirty_page" title="dirty page">dirty pages</a> in the same
          <a class="link" href="glossary.html#glos_extent" title="extent">extent</a>.
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
              The default value of 1 flushes contiguous dirty pages in
              the same extent from the buffer pool.
            </p></li><li class="listitem"><p>
              A setting of 0 turns
              <code class="literal">innodb_flush_neighbors</code> off and no other
              dirty pages are flushed from the buffer pool.
            </p></li><li class="listitem"><p>
              A setting of 2 flushes dirty pages in the same extent from
              the buffer pool.
</p></li></ul>
</div>
<p>
          When the table data is stored on a traditional
          <a class="link" href="glossary.html#glos_hdd" title="HDD">HDD</a> storage device, flushing
          such <a class="link" href="glossary.html#glos_neighbor_page" title="neighbor page">neighbor pages</a>
          in one operation reduces I/O overhead (primarily for disk seek
          operations) compared to flushing individual pages at different
          times. For table data stored on
          <a class="link" href="glossary.html#glos_ssd" title="SSD">SSD</a>, seek time is not a
          significant factor and you can turn this setting off to spread
          out the write operations. For general I/O tuning advice, see
          <a class="xref" href="optimization.html#optimizing-innodb-diskio" title="8.5.8 Optimizing InnoDB Disk I/O">Section 8.5.8, “Optimizing InnoDB Disk I/O”</a>.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_flush_sync"></a>
          <a class="indexterm" name="idm140644107147216"></a>

          <a class="indexterm" name="idm140644107146176"></a>

          <code class="literal">innodb_flush_sync</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_flush_sync" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Introduced</strong></span></td><td colspan="3">5.7.8</td></tr><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_flush_sync=#</code></td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>System Variable</strong></span></td><td><span class="bold"><strong>Name</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_flush_sync">innodb_flush_sync</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="2">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="2">Yes</td></tr><tr><td scope="row" rowspan="2"><span class="bold"><strong>Permitted Values</strong></span></td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">boolean</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">ON</code></td></tr></tbody></table>
</div>
<p>
          The <code class="literal">innodb_flush_sync</code> parameter, which is
          enabled by default, causes the
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_io_capacity"><code class="literal">innodb_io_capacity</code></a> setting to
          be ignored for bursts of I/O activity that occur at
          <a class="link" href="glossary.html#glos_checkpoint" title="checkpoint">checkpoints</a>. To adhere
          to the limit on InnoDB background I/O activity defined by the
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_io_capacity"><code class="literal">innodb_io_capacity</code></a>
          setting, disable <code class="literal">innodb_flush_sync</code>.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_flushing_avg_loops"></a>
          <a class="indexterm" name="idm140644107116432"></a>

          <code class="literal">innodb_flushing_avg_loops</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_flushing_avg_loops" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_flushing_avg_loops=#</code></td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>System Variable</strong></span></td><td><span class="bold"><strong>Name</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_flushing_avg_loops">innodb_flushing_avg_loops</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="2">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="2">Yes</td></tr><tr><td scope="row" rowspan="4"><span class="bold"><strong>Permitted Values</strong></span></td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">integer</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">30</code></td></tr><tr><td scope="row"><span class="bold"><strong>Min Value</strong></span></td><td colspan="2"><code class="literal">1</code></td></tr><tr><td scope="row"><span class="bold"><strong>Max Value</strong></span></td><td colspan="2"><code class="literal">1000</code></td></tr></tbody></table>
</div>
<p>
          Number of iterations for which InnoDB keeps the previously
          calculated snapshot of the flushing state, controlling how
          quickly <a class="link" href="glossary.html#glos_adaptive_flushing" title="adaptive flushing">adaptive
          flushing</a> responds to changing
          <a class="link" href="glossary.html#glos_workload" title="workload">workloads</a>. Increasing the
          value makes the rate of
          <a class="link" href="glossary.html#glos_flush" title="flush">flush</a> operations change
          smoothly and gradually as the workload changes. Decreasing the
          value makes adaptive flushing adjust quickly to workload
          changes, which can cause spikes in flushing activity if the
          workload increases and decreases suddenly.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_force_load_corrupted"></a>
          <a class="indexterm" name="idm140644107086496"></a>

          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_force_load_corrupted"><code class="literal">innodb_force_load_corrupted</code></a>
</p>
<div class="informaltable">
<table summary="Options for innodb_force_load_corrupted" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_force_load_corrupted</code></td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>System Variable</strong></span></td><td><span class="bold"><strong>Name</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_force_load_corrupted">innodb_force_load_corrupted</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="2">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="2">No</td></tr><tr><td scope="row" rowspan="2"><span class="bold"><strong>Permitted Values</strong></span></td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">boolean</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">OFF</code></td></tr></tbody></table>
</div>
<p>
          Lets InnoDB load tables at startup that are marked as
          corrupted. Use only during troubleshooting, to recover data
          that is otherwise inaccessible. When troubleshooting is
          complete, turn this setting back off and restart the server.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_force_recovery"></a>
          <a class="indexterm" name="idm140644107063184"></a>

          <a class="indexterm" name="idm140644107062144"></a>

          <code class="literal">innodb_force_recovery</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_force_recovery" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_force_recovery=#</code></td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>System Variable</strong></span></td><td><span class="bold"><strong>Name</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_force_recovery">innodb_force_recovery</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="2">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="2">No</td></tr><tr><td scope="row" rowspan="4"><span class="bold"><strong>Permitted Values</strong></span></td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">integer</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">0</code></td></tr><tr><td scope="row"><span class="bold"><strong>Min Value</strong></span></td><td colspan="2"><code class="literal">0</code></td></tr><tr><td scope="row"><span class="bold"><strong>Max Value</strong></span></td><td colspan="2"><code class="literal">6</code></td></tr></tbody></table>
</div>
<p>
          The <a class="link" href="glossary.html#glos_crash_recovery" title="crash recovery">crash recovery</a>
          mode, typically only changed in serious troubleshooting
          situations. Possible values are from 0 to 6. For the meanings
          of these values and important information about
          <code class="literal">innodb_force_recovery</code>, see
          <a class="xref" href="innodb-storage-engine.html#forcing-innodb-recovery" title="14.18.2 Forcing InnoDB Recovery">Section 14.18.2, “Forcing InnoDB Recovery”</a>.
</p>
<div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Warning
</div>
<p>
            Only set this variable to a value greater than 0 in an
            emergency situation, so that you can start
            <code class="literal">InnoDB</code> and dump your tables. As a safety
            measure, <code class="literal">InnoDB</code> prevents
            <a class="link" href="sql-syntax.html#insert" title="13.2.5 INSERT Syntax"><code class="literal">INSERT</code></a>,
            <a class="link" href="sql-syntax.html#update" title="13.2.11 UPDATE Syntax"><code class="literal">UPDATE</code></a>, or
            <a class="link" href="sql-syntax.html#delete" title="13.2.2 DELETE Syntax"><code class="literal">DELETE</code></a> operations when
            <code class="literal">innodb_force_recovery</code> is greater than 0.
            Also, as of 5.7.3, an
            <code class="literal">innodb_force_recovery</code> setting of 4 or
            greater places <code class="literal">InnoDB</code> into read-only
            mode.
          </p><p>
            These restrictions may cause replication administration
            commands to fail with an error, as replication options such
            as
            <a class="link" href="replication.html#option_mysqld_relay-log-info-repository"><code class="option">--relay-log-info-repository=TABLE</code></a>
            and
            <a class="link" href="replication.html#option_mysqld_master-info-repository"><code class="option">--master-info-repository=TABLE</code></a>
            store information in tables in <code class="literal">InnoDB</code>.
</p>
</div>
</li><li class="listitem"><p><a name="sysvar_innodb_ft_aux_table"></a>
          <a class="indexterm" name="idm140644107020672"></a>

          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_ft_aux_table"><code class="literal">innodb_ft_aux_table</code></a>
</p>
<div class="informaltable">
<table summary="Options for innodb_ft_aux_table" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_ft_aux_table=#</code> (&gt;= 5.7.2)</td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>System Variable</strong></span></td><td><span class="bold"><strong>Name</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_ft_aux_table">innodb_ft_aux_table</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="2">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="2">Yes</td></tr><tr><td scope="row"><span class="bold"><strong>Permitted Values</strong></span></td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">string</code></td></tr></tbody></table>
</div>
<p>
          Specifies the qualified name of an <code class="literal">InnoDB</code>
          table containing a <code class="literal">FULLTEXT</code> index. This
          variable is intended for diagnostic purposes.
        </p><p>
          After you set this variable to a name in the format
          <code class="literal"><em class="replaceable"><code>db_name</code></em>/<em class="replaceable"><code>table_name</code></em></code>,
          the <code class="literal">INFORMATION_SCHEMA</code> tables
          <a class="link" href="information-schema.html#innodb-ft-index-table-table" title="21.31.23 The INFORMATION_SCHEMA INNODB_FT_INDEX_TABLE Table"><code class="literal">INNODB_FT_INDEX_TABLE</code></a>,
          <a class="link" href="information-schema.html#innodb-ft-index-cache-table" title="21.31.24 The INFORMATION_SCHEMA INNODB_FT_INDEX_CACHE Table"><code class="literal">INNODB_FT_INDEX_CACHE</code></a>,
          <a class="link" href="information-schema.html#innodb-ft-config-table" title="21.31.21 The INFORMATION_SCHEMA INNODB_FT_CONFIG Table"><code class="literal">INNODB_FT_CONFIG</code></a>,
          <a class="link" href="information-schema.html#innodb-ft-deleted-table" title="21.31.25 The INFORMATION_SCHEMA INNODB_FT_DELETED Table"><code class="literal">INNODB_FT_DELETED</code></a>, and
          <a class="link" href="information-schema.html#innodb-ft-being-deleted-table" title="21.31.26 The INFORMATION_SCHEMA INNODB_FT_BEING_DELETED Table"><code class="literal">INNODB_FT_BEING_DELETED</code></a> will show
          information about the search index for the specified table.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_ft_cache_size"></a>
          <a class="indexterm" name="idm140644106989440"></a>

          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_ft_cache_size"><code class="literal">innodb_ft_cache_size</code></a>
</p>
<div class="informaltable">
<table summary="Options for innodb_ft_cache_size" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_ft_cache_size=#</code></td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>System Variable</strong></span></td><td><span class="bold"><strong>Name</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_ft_cache_size">innodb_ft_cache_size</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="2">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="2">No</td></tr><tr><td scope="row" rowspan="4"><span class="bold"><strong>Permitted Values</strong></span></td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">integer</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">8000000</code></td></tr><tr><td scope="row"><span class="bold"><strong>Min Value</strong></span></td><td colspan="2"><code class="literal">1600000</code></td></tr><tr><td scope="row"><span class="bold"><strong>Max Value</strong></span></td><td colspan="2"><code class="literal">80000000</code></td></tr></tbody></table>
</div>
<p>
          The memory allocated, in bytes, for the
          <code class="literal">InnoDB</code> <code class="literal">FULLTEXT</code> search
          index cache, which holds a parsed document in memory while
          creating an <code class="literal">InnoDB</code>
          <code class="literal">FULLTEXT</code> index. Index inserts and updates
          are only committed to disk when the
          <code class="literal">innodb_ft_cache_size</code> size limit is reached.
          <code class="literal">innodb_ft_cache_size</code> defines the cache size
          on a per table basis. To set a global limit for all tables,
          see
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_ft_total_cache_size"><code class="literal">innodb_ft_total_cache_size</code></a>.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_ft_enable_diag_print"></a>
          <a class="indexterm" name="idm140644106956064"></a>

          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_ft_enable_diag_print"><code class="literal">innodb_ft_enable_diag_print</code></a>
</p>
<div class="informaltable">
<table summary="Options for innodb_ft_enable_diag_print" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_ft_enable_diag_print=#</code></td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>System Variable</strong></span></td><td><span class="bold"><strong>Name</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_ft_enable_diag_print">innodb_ft_enable_diag_print</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="2">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="2">Yes</td></tr><tr><td scope="row" rowspan="2"><span class="bold"><strong>Permitted Values</strong></span></td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">boolean</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">OFF</code></td></tr></tbody></table>
</div>
<p>
          Whether to enable additional full-text search (FTS) diagnostic
          output. This option is primarily intended for advanced FTS
          debugging and will not be of interest to most users. Output is
          printed to the error log and includes information such as:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
              FTS index sync progress (when the FTS cache limit is
              reached). For example:
            </p><pre class="programlisting">
FTS SYNC for table test, deleted count: 100 size: 10000 bytes
SYNC words: 100 
</pre></li><li class="listitem"><p>
              FTS optimize progress. For example:
            </p><pre class="programlisting">
FTS start optimize test
FTS_OPTIMIZE: optimize "mysql"
FTS_OPTIMIZE: processed "mysql" 
</pre></li><li class="listitem"><p>
              FTS index build progress. For example:
            </p><pre class="programlisting">
Number of doc processed: 1000
</pre></li><li class="listitem"><p>
              For FTS queries, the query parsing tree, word weight,
              query processing time, and memory usage are printed. For
              example:
            </p><pre class="programlisting">
FTS Search Processing time: 1 secs: 100 millisec: row(s) 10000
Full Search Memory: 245666 (bytes),  Row: 10000 
</pre></li></ul>
</div>
</li><li class="listitem"><p><a name="sysvar_innodb_ft_enable_stopword"></a>
          <a class="indexterm" name="idm140644106925872"></a>

          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_ft_enable_stopword"><code class="literal">innodb_ft_enable_stopword</code></a>
</p>
<div class="informaltable">
<table summary="Options for innodb_ft_enable_stopword" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_ft_enable_stopword=#</code></td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>System Variable</strong></span></td><td><span class="bold"><strong>Name</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_ft_enable_stopword">innodb_ft_enable_stopword</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="2">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="2">Yes</td></tr><tr><td scope="row" rowspan="2"><span class="bold"><strong>Permitted Values</strong></span></td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">boolean</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">ON</code></td></tr></tbody></table>
</div>
<p>
          Specifies that a set of
          <a class="link" href="glossary.html#glos_stopword" title="stopword">stopwords</a> is associated
          with an <code class="literal">InnoDB</code> <code class="literal">FULLTEXT</code>
          index at the time the index is created. If the
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_ft_user_stopword_table"><code class="literal">innodb_ft_user_stopword_table</code></a>
          option is set, the stopwords are taken from that table. Else,
          if the
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_ft_server_stopword_table"><code class="literal">innodb_ft_server_stopword_table</code></a>
          option is set, the stopwords are taken from that table.
          Otherwise, a built-in set of default stopwords is used.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_ft_max_token_size"></a>
          <a class="indexterm" name="idm140644106897552"></a>

          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_ft_max_token_size"><code class="literal">innodb_ft_max_token_size</code></a>
</p>
<div class="informaltable">
<table summary="Options for innodb_ft_max_token_size" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_ft_max_token_size=#</code></td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>System Variable</strong></span></td><td><span class="bold"><strong>Name</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_ft_max_token_size">innodb_ft_max_token_size</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="2">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="2">No</td></tr><tr><td scope="row" rowspan="4"><span class="bold"><strong>Permitted Values</strong></span></td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">integer</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">84</code></td></tr><tr><td scope="row"><span class="bold"><strong>Min Value</strong></span></td><td colspan="2"><code class="literal">10</code></td></tr><tr><td scope="row"><span class="bold"><strong>Max Value</strong></span></td><td colspan="2"><code class="literal">84</code></td></tr><tr><td scope="row" rowspan="4"><span class="bold"><strong>Permitted Values</strong></span> (&lt;= 5.7.2)</td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">integer</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">84</code></td></tr><tr><td scope="row"><span class="bold"><strong>Min Value</strong></span></td><td colspan="2"><code class="literal">10</code></td></tr><tr><td scope="row"><span class="bold"><strong>Max Value</strong></span></td><td colspan="2"><code class="literal">252</code></td></tr><tr><td scope="row" rowspan="4"><span class="bold"><strong>Permitted Values</strong></span> (&gt;= 5.7.3)</td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">integer</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">84</code></td></tr><tr><td scope="row"><span class="bold"><strong>Min Value</strong></span></td><td colspan="2"><code class="literal">10</code></td></tr><tr><td scope="row"><span class="bold"><strong>Max Value</strong></span></td><td colspan="2"><code class="literal">84</code></td></tr></tbody></table>
</div>
<p>
          Maximum character length of words that are stored in an InnoDB
          <code class="literal">FULLTEXT</code> index. Setting a limit on this
          value reduces the size of the index, thus speeding up queries,
          by omitting long keywords or arbitrary collections of letters
          that are not real words and are not likely to be search terms.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_ft_min_token_size"></a>
          <a class="indexterm" name="idm140644106848784"></a>

          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_ft_min_token_size"><code class="literal">innodb_ft_min_token_size</code></a>
</p>
<div class="informaltable">
<table summary="Options for innodb_ft_min_token_size" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_ft_min_token_size=#</code></td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>System Variable</strong></span></td><td><span class="bold"><strong>Name</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_ft_min_token_size">innodb_ft_min_token_size</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="2">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="2">No</td></tr><tr><td scope="row" rowspan="4"><span class="bold"><strong>Permitted Values</strong></span></td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">integer</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">3</code></td></tr><tr><td scope="row"><span class="bold"><strong>Min Value</strong></span></td><td colspan="2"><code class="literal">0</code></td></tr><tr><td scope="row"><span class="bold"><strong>Max Value</strong></span></td><td colspan="2"><code class="literal">16</code></td></tr></tbody></table>
</div>
<p>
          Minimum length of words that are stored in an InnoDB
          <code class="literal">FULLTEXT</code> index. Increasing this value
          reduces the size of the index, thus speeding up queries, by
          omitting common word that are unlikely to be significant in a
          search context, such as the English words <span class="quote">“<span class="quote">a</span>”</span> and
          <span class="quote">“<span class="quote">to</span>”</span>. For content using a CJK (Chinese, Japanese,
          Korean) character set, specify a value of 1.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_ft_num_word_optimize"></a>
          <a class="indexterm" name="idm140644106819408"></a>

          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_ft_num_word_optimize"><code class="literal">innodb_ft_num_word_optimize</code></a>
</p>
<div class="informaltable">
<table summary="Options for innodb_ft_num_word_optimize" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_ft_num_word_optimize=#</code></td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>System Variable</strong></span></td><td><span class="bold"><strong>Name</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_ft_num_word_optimize">innodb_ft_num_word_optimize</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="2">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="2">Yes</td></tr><tr><td scope="row" rowspan="2"><span class="bold"><strong>Permitted Values</strong></span></td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">integer</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">2000</code></td></tr></tbody></table>
</div>
<p>
          Number of words to process during each
          <a class="link" href="sql-syntax.html#optimize-table" title="13.7.2.4 OPTIMIZE TABLE Syntax"><code class="literal">OPTIMIZE TABLE</code></a> operation on an
          <code class="literal">InnoDB</code> <code class="literal">FULLTEXT</code> index.
          Because a bulk insert or update operation to a table
          containing a full-text search index could require substantial
          index maintenance to incorporate all changes, you might do a
          series of <a class="link" href="sql-syntax.html#optimize-table" title="13.7.2.4 OPTIMIZE TABLE Syntax"><code class="literal">OPTIMIZE TABLE</code></a>
          statements, each picking up where the last left off.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_ft_result_cache_limit"></a>
          <a class="indexterm" name="idm140644106792112"></a>

          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_ft_result_cache_limit"><code class="literal">innodb_ft_result_cache_limit</code></a>
</p>
<div class="informaltable">
<table summary="Options for innodb_ft_result_cache_limit" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Introduced</strong></span></td><td colspan="3">5.7.2</td></tr><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_ft_result_cache_limit=#</code></td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>System Variable</strong></span></td><td><span class="bold"><strong>Name</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_ft_result_cache_limit">innodb_ft_result_cache_limit</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="2">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="2">Yes</td></tr><tr><td scope="row" rowspan="4"><span class="bold"><strong>Permitted Values</strong></span> (&gt;= 5.7.4)</td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">integer</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">2000000000</code></td></tr><tr><td scope="row"><span class="bold"><strong>Min Value</strong></span></td><td colspan="2"><code class="literal">1000000</code></td></tr><tr><td scope="row"><span class="bold"><strong>Max Value</strong></span></td><td colspan="2"><code class="literal">2**32-1</code></td></tr><tr><td scope="row" rowspan="4"><span class="bold"><strong>Permitted Values</strong></span> (Unix, 32-bit platforms, &gt;= 5.7.2, &lt;= 5.7.3)</td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">integer</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">2000000000</code></td></tr><tr><td scope="row"><span class="bold"><strong>Min Value</strong></span></td><td colspan="2"><code class="literal">1000000</code></td></tr><tr><td scope="row"><span class="bold"><strong>Max Value</strong></span></td><td colspan="2"><code class="literal">2**32-1</code></td></tr><tr><td scope="row" rowspan="4"><span class="bold"><strong>Permitted Values</strong></span> (Unix, 64-bit platforms, &gt;= 5.7.2, &lt;= 5.7.3)</td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">integer</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">2000000000</code></td></tr><tr><td scope="row"><span class="bold"><strong>Min Value</strong></span></td><td colspan="2"><code class="literal">1000000</code></td></tr><tr><td scope="row"><span class="bold"><strong>Max Value</strong></span></td><td colspan="2"><code class="literal">2**64-1</code></td></tr><tr><td scope="row" rowspan="4"><span class="bold"><strong>Permitted Values</strong></span> (Windows, &gt;= 5.7.2, &lt;= 5.7.3)</td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">integer</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">2000000000</code></td></tr><tr><td scope="row"><span class="bold"><strong>Min Value</strong></span></td><td colspan="2"><code class="literal">1000000</code></td></tr><tr><td scope="row"><span class="bold"><strong>Max Value</strong></span></td><td colspan="2"><code class="literal">2**32-1</code></td></tr></tbody></table>
</div>
<p>
          The <code class="literal">InnoDB</code> FULLTEXT search (FTS) query
          result cache limit (defined in bytes) per FTS query or per
          thread. Intermediate and final <code class="literal">InnoDB</code> FTS
          query results are handled in memory. Use
          <code class="literal">innodb_ft_result_cache_limit</code> to place a
          size limit on the <code class="literal">InnoDB</code> FTS query result
          cache to avoid excessive memory consumption in case of very
          large <code class="literal">InnoDB</code> FTS query results (millions or
          hundreds of millions of rows, for example). Memory is
          allocated as required when an FTS query is processed. If the
          result cache size limit is reached, an error is returned
          indicating that the query exceeds the maximum allowed memory.
        </p><p>
          As of MySQL 5.7.4, the maximum value of
          <code class="literal">innodb_ft_result_cache_limit</code> for all
          platform types and platform bit sizes is 2**32-1. Bug #71554.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_ft_server_stopword_table"></a>
          <a class="indexterm" name="idm140644106726384"></a>

          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_ft_server_stopword_table"><code class="literal">innodb_ft_server_stopword_table</code></a>
</p>
<div class="informaltable">
<table summary="Options for innodb_ft_server_stopword_table" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_ft_server_stopword_table=db_name/table_name</code></td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>System Variable</strong></span></td><td><span class="bold"><strong>Name</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_ft_server_stopword_table">innodb_ft_server_stopword_table</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="2">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="2">Yes</td></tr><tr><td scope="row" rowspan="2"><span class="bold"><strong>Permitted Values</strong></span></td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">string</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">NULL</code></td></tr></tbody></table>
</div>
<p>
          This option is used to specify your own
          <code class="literal">InnoDB</code> <code class="literal">FULLTEXT</code> index
          stopword list for all <code class="literal">InnoDB</code> tables. To
          configure your own stopword list for a specific
          <code class="literal">InnoDB</code> table, use
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_ft_user_stopword_table"><code class="literal">innodb_ft_user_stopword_table</code></a>.
        </p><p>
          Set <code class="literal">innodb_ft_server_stopword_table</code> to the
          name of the table containing a list of stopwords, in the
          format
          <code class="literal"><em class="replaceable"><code>db_name</code></em>/<em class="replaceable"><code>table_name</code></em></code>.
        </p><p>
          The stopword table must exist before you configure
          <code class="literal">innodb_ft_server_stopword_table</code>.
          <code class="literal">innodb_ft_enable_stopword</code> must be enabled
          and <code class="literal">innodb_ft_server_stopword_table</code> option
          must be configured before you create the
          <code class="literal">FULLTEXT</code> index.
        </p><p>
          The stopword table must be an <code class="literal">InnoDB</code> table,
          containing a single <code class="literal">VARCHAR</code> column named
          <code class="literal">value</code>.
        </p><p>
          For more information, see
          <a class="xref" href="functions.html#fulltext-stopwords" title="12.9.4 Full-Text Stopwords">Section 12.9.4, “Full-Text Stopwords”</a>.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_ft_sort_pll_degree"></a>
          <a class="indexterm" name="idm140644106689360"></a>

          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_ft_sort_pll_degree"><code class="literal">innodb_ft_sort_pll_degree</code></a>
</p>
<div class="informaltable">
<table summary="Options for innodb_ft_sort_pll_degree" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_ft_sort_pll_degree=#</code></td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>System Variable</strong></span></td><td><span class="bold"><strong>Name</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_ft_sort_pll_degree">innodb_ft_sort_pll_degree</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="2">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="2">No</td></tr><tr><td scope="row" rowspan="4"><span class="bold"><strong>Permitted Values</strong></span></td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">integer</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">2</code></td></tr><tr><td scope="row"><span class="bold"><strong>Min Value</strong></span></td><td colspan="2"><code class="literal">1</code></td></tr><tr><td scope="row"><span class="bold"><strong>Max Value</strong></span></td><td colspan="2"><code class="literal">32</code></td></tr></tbody></table>
</div>
<p>
          Number of threads used in parallel to index and tokenize text
          in an <code class="literal">InnoDB</code> <code class="literal">FULLTEXT</code>
          index, when building a
          <a class="link" href="glossary.html#glos_search_index" title="search index">search index</a>. See
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_sort_buffer_size"><code class="literal">innodb_sort_buffer_size</code></a> for
          additional usage information.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_ft_total_cache_size"></a>
          <a class="indexterm" name="idm140644106658080"></a>

          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_ft_total_cache_size"><code class="literal">innodb_ft_total_cache_size</code></a>
</p>
<div class="informaltable">
<table summary="Options for innodb_ft_total_cache_size" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Introduced</strong></span></td><td colspan="3">5.7.2</td></tr><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_ft_total_cache_size=#</code></td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>System Variable</strong></span></td><td><span class="bold"><strong>Name</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_ft_total_cache_size">innodb_ft_total_cache_size</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="2">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="2">No</td></tr><tr><td scope="row" rowspan="4"><span class="bold"><strong>Permitted Values</strong></span></td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">integer</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">640000000</code></td></tr><tr><td scope="row"><span class="bold"><strong>Min Value</strong></span></td><td colspan="2"><code class="literal">32000000</code></td></tr><tr><td scope="row"><span class="bold"><strong>Max Value</strong></span></td><td colspan="2"><code class="literal">1600000000</code></td></tr></tbody></table>
</div>
<p>
          The total memory allocated, in bytes, for the
          <code class="literal">InnoDB</code> FULLTEXT search index cache for all
          tables. Creating numerous tables, each with a full-text search
          index, could consume a significant portion of available
          memory.
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_ft_total_cache_size"><code class="literal">innodb_ft_total_cache_size</code></a>,
          defines a global memory limit for all full-text search indexes
          to help avoid excessive memory consumption. If the global
          limit is reached by an index operation, a force sync is
          triggered.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_ft_user_stopword_table"></a>
          <a class="indexterm" name="idm140644106626224"></a>

          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_ft_user_stopword_table"><code class="literal">innodb_ft_user_stopword_table</code></a>
</p>
<div class="informaltable">
<table summary="Options for innodb_ft_user_stopword_table" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_ft_user_stopword_table=db_name/table_name</code></td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>System Variable</strong></span></td><td><span class="bold"><strong>Name</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_ft_user_stopword_table">innodb_ft_user_stopword_table</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="2">Global, Session</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="2">Yes</td></tr><tr><td scope="row" rowspan="2"><span class="bold"><strong>Permitted Values</strong></span></td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">string</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">NULL</code></td></tr></tbody></table>
</div>
<p>
          This option is used to specify your own
          <code class="literal">InnoDB</code> <code class="literal">FULLTEXT</code> index
          stopword list on a specific table. To configure your own
          stopword list for all <code class="literal">InnoDB</code> tables, use
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_ft_server_stopword_table"><code class="literal">innodb_ft_server_stopword_table</code></a>.
        </p><p>
          Set <code class="literal">innodb_ft_user_stopword_table</code> to the
          name of the table containing a list of stopwords, in the
          format
          <code class="literal"><em class="replaceable"><code>db_name</code></em>/<em class="replaceable"><code>table_name</code></em></code>.
        </p><p>
          The stopword table must exist before you configure
          <code class="literal">innodb_ft_user_stopword_table</code>.
          <code class="literal">innodb_ft_enable_stopword</code> must be enabled
          and <code class="literal">innodb_ft_user_stopword_table</code> must be
          configured before you create the <code class="literal">FULLTEXT</code>
          index.
        </p><p>
          The stopword table must be an <code class="literal">InnoDB</code> table,
          containing a single <code class="literal">VARCHAR</code> column named
          <code class="literal">value</code>.
        </p><p>
          For more information, see
          <a class="xref" href="functions.html#fulltext-stopwords" title="12.9.4 Full-Text Stopwords">Section 12.9.4, “Full-Text Stopwords”</a>.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_io_capacity"></a>
          <a class="indexterm" name="idm140644106589840"></a>

          <a class="indexterm" name="idm140644106588800"></a>

          <code class="literal">innodb_io_capacity</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_io_capacity" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_io_capacity=#</code></td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>System Variable</strong></span></td><td><span class="bold"><strong>Name</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_io_capacity">innodb_io_capacity</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="2">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="2">Yes</td></tr><tr><td scope="row" rowspan="4"><span class="bold"><strong>Permitted Values</strong></span> (32-bit platforms)</td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">integer</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">200</code></td></tr><tr><td scope="row"><span class="bold"><strong>Min Value</strong></span></td><td colspan="2"><code class="literal">100</code></td></tr><tr><td scope="row"><span class="bold"><strong>Max Value</strong></span></td><td colspan="2"><code class="literal">2**32-1</code></td></tr><tr><td scope="row" rowspan="4"><span class="bold"><strong>Permitted Values</strong></span> (64-bit platforms)</td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">integer</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">200</code></td></tr><tr><td scope="row"><span class="bold"><strong>Min Value</strong></span></td><td colspan="2"><code class="literal">100</code></td></tr><tr><td scope="row"><span class="bold"><strong>Max Value</strong></span></td><td colspan="2"><code class="literal">2**64-1</code></td></tr></tbody></table>
</div>
<p>
          The <a class="link" href="innodb-storage-engine.html#sysvar_innodb_io_capacity"><code class="literal">innodb_io_capacity</code></a>
          parameter sets an upper limit on the I/O activity performed by
          the <code class="literal">InnoDB</code> background tasks, such as
          <a class="link" href="glossary.html#glos_flush" title="flush">flushing</a> pages from the
          <a class="link" href="glossary.html#glos_buffer_pool" title="buffer pool">buffer pool</a> and
          merging data from the
          <a class="link" href="glossary.html#glos_change_buffer" title="change buffer">change buffer</a>. The
          default value is 200. For busy systems capable of higher I/O
          rates, you can set a higher value at server startup, to help
          the server handle the background maintenance work associated
          with a high rate of row changes.
        </p><p>
          The <a class="link" href="innodb-storage-engine.html#sysvar_innodb_io_capacity"><code class="literal">innodb_io_capacity</code></a> limit
          is a total limit for all buffer pool instances. When dirty
          pages are flushed, the
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_io_capacity"><code class="literal">innodb_io_capacity</code></a> limit is
          divided equally among buffer pool instances.
        </p><p>
          As of MySQL 5.7.2, the
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_io_capacity"><code class="literal">innodb_io_capacity</code></a> setting is
          also used to limit the number of buffer pool load operations
          per second when there is other I/O activity being performed by
          <code class="literal">InnoDB</code> background tasks.
        </p><p>
          For systems with individual 5400 RPM or 7200 RPM drives, you
          might lower the value to the former default of
          <code class="literal">100</code>.
        </p><p>
          This parameter should be set to approximately the number of
          I/O operations that the system can perform per second.
          Ideally, keep this setting as low as practical, but not so low
          that these background activities fall behind. If the value is
          too high, data is removed from the buffer pool and insert
          buffer too quickly to provide significant benefit from the
          caching.
        </p><p>
          The value represents an estimated proportion of the I/O
          operations per second (IOPS) available to older-generation
          disk drives that could perform about 100 IOPS. The current
          default of 200 reflects that modern storage devices are
          capable of much higher I/O rates.
        </p><p>
          In general, you can increase the value as a function of the
          number of drives used for <a class="link" href="innodb-storage-engine.html" title="Chapter 14 The InnoDB Storage Engine"><code class="literal">InnoDB</code></a>
          I/O, particularly fast drives capable of high numbers of IOPS.
          For example, systems that use multiple disks or solid-state
          disks for <a class="link" href="innodb-storage-engine.html" title="Chapter 14 The InnoDB Storage Engine"><code class="literal">InnoDB</code></a> are likely to
          benefit from the ability to control this parameter.
        </p><p>
          Although you can specify a very high number, in practice such
          large values have little if any benefit; for example, a value
          of one million would be considered very high.
        </p><p>
          You can set the <code class="literal">innodb_io_capacity</code> value to
          any number 100 or greater to a maximum defined by
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_io_capacity_max"><code class="literal">innodb_io_capacity_max</code></a>. The
          default value is <code class="literal">200</code>. You can set the value
          of this parameter in the MySQL option file
          (<code class="literal">my.cnf</code> or <code class="literal">my.ini</code>) or
          change it dynamically with the <code class="literal">SET GLOBAL</code>
          command, which requires the <code class="literal">SUPER</code>
          privilege.
        </p><p>
          The <a class="link" href="innodb-storage-engine.html#sysvar_innodb_flush_sync"><code class="literal">innodb_flush_sync</code></a>
          configuration option, introduced in MySQL 5.7.8, causes the
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_io_capacity"><code class="literal">innodb_io_capacity</code></a> setting to
          be ignored during bursts of I/O activity that occur at
          checkpoints.
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_flush_sync"><code class="literal">innodb_flush_sync</code></a> is enabled
          by default.
        </p><p>
          See <a class="xref" href="innodb-storage-engine.html#innodb-performance-thread_io_rate" title="14.3.8 Configuring the InnoDB Master Thread I/O Rate">Section 14.3.8, “Configuring the InnoDB Master Thread I/O Rate”</a> for
          more information about the
          <code class="literal">innodb_io_capacity</code> setting. For general
          information about InnoDB I/O performance, see
          <a class="xref" href="optimization.html#optimizing-innodb-diskio" title="8.5.8 Optimizing InnoDB Disk I/O">Section 8.5.8, “Optimizing InnoDB Disk I/O”</a>.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_io_capacity_max"></a>
          <a class="indexterm" name="idm140644106520752"></a>

          <code class="literal">innodb_io_capacity_max</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_io_capacity_max" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_io_capacity_max=#</code></td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>System Variable</strong></span></td><td><span class="bold"><strong>Name</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_io_capacity_max">innodb_io_capacity_max</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="2">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="2">Yes</td></tr><tr><td scope="row" rowspan="4"><span class="bold"><strong>Permitted Values</strong></span> (32-bit platforms)</td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">integer</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">see description</code></td></tr><tr><td scope="row"><span class="bold"><strong>Min Value</strong></span></td><td colspan="2"><code class="literal">2000</code></td></tr><tr><td scope="row"><span class="bold"><strong>Max Value</strong></span></td><td colspan="2"><code class="literal">2**32-1</code></td></tr><tr><td scope="row" rowspan="4"><span class="bold"><strong>Permitted Values</strong></span> (Unix, 64-bit platforms)</td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">integer</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">see description</code></td></tr><tr><td scope="row"><span class="bold"><strong>Min Value</strong></span></td><td colspan="2"><code class="literal">2000</code></td></tr><tr><td scope="row"><span class="bold"><strong>Max Value</strong></span></td><td colspan="2"><code class="literal">2**64-1</code></td></tr><tr><td scope="row" rowspan="4"><span class="bold"><strong>Permitted Values</strong></span> (Windows, 64-bit platforms)</td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">integer</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">2000</code></td></tr><tr><td scope="row"><span class="bold"><strong>Min Value</strong></span></td><td colspan="2"><code class="literal">2000</code></td></tr><tr><td scope="row"><span class="bold"><strong>Max Value</strong></span></td><td colspan="2"><code class="literal">2**32-1</code></td></tr></tbody></table>
</div>
<p>
          The limit up to which <code class="literal">InnoDB</code> is allowed to
          extend the <a class="link" href="innodb-storage-engine.html#sysvar_innodb_io_capacity"><code class="literal">innodb_io_capacity</code></a>
          setting in case of emergency. If you specify an
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_io_capacity"><code class="literal">innodb_io_capacity</code></a> setting at
          startup and do not specify a value for
          <code class="literal">innodb_io_capacity_max</code>, the
          <code class="literal">innodb_io_capacity_max</code> value defaults to
          twice the value of
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_io_capacity"><code class="literal">innodb_io_capacity</code></a>, with a
          lower limit of 2000. 2000 is also the initial default
          <code class="literal">innodb_io_capacity_max</code> configuration value.
        </p><p>
          The <a class="link" href="innodb-storage-engine.html#sysvar_innodb_io_capacity_max"><code class="literal">innodb_io_capacity_max</code></a>
          setting is a total limit for all buffer pool instances.
        </p><p>
          For a brief period during MySQL 5.6 development, this variable
          was known as <code class="literal">innodb_max_io_capacity</code>.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_large_prefix"></a>
          <a class="indexterm" name="idm140644106463360"></a>

          <a class="indexterm" name="idm140644106462320"></a>

          <code class="literal">innodb_large_prefix</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_large_prefix" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Deprecated</strong></span></td><td colspan="3">5.7.7</td></tr><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_large_prefix</code></td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>System Variable</strong></span></td><td><span class="bold"><strong>Name</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_large_prefix">innodb_large_prefix</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="2">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="2">Yes</td></tr><tr><td scope="row" rowspan="2"><span class="bold"><strong>Permitted Values</strong></span> (&lt;= 5.7.6)</td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">boolean</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">OFF</code></td></tr><tr><td scope="row" rowspan="2"><span class="bold"><strong>Permitted Values</strong></span> (&gt;= 5.7.7)</td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">boolean</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">ON</code></td></tr></tbody></table>
</div>
<p>
          When this option is enabled, index key prefixes longer than
          767 bytes (up to 3072 bytes) are allowed for
          <code class="literal">InnoDB</code> tables that use the
          <code class="literal"><a class="link" href="glossary.html#glos_dynamic_row_format" title="dynamic row format">DYNAMIC</a></code>
          and
          <code class="literal"><a class="link" href="glossary.html#glos_compressed_row_format" title="compressed row format">COMPRESSED</a></code>
          row formats. See <a class="xref" href="innodb-storage-engine.html#innodb-restrictions" title="14.5.7 Limits on InnoDB Tables">Section 14.5.7, “Limits on InnoDB Tables”</a> for the
          relevant maximums associated with index key prefixes under
          various settings.
        </p><p>
          For tables using the
          <code class="literal"><a class="link" href="glossary.html#glos_redundant_row_format" title="redundant row format">REDUNDANT</a></code>
          and
          <code class="literal"><a class="link" href="glossary.html#glos_compact_row_format" title="compact row format">COMPACT</a></code>
          row formats, this option does not affect the allowed index key
          prefix length.
        </p><p>
          <code class="literal">innodb_large_prefix</code> is enabled by default
          in MySQL 5.7.7. This change coincides with the default value
          change for <code class="literal">innodb_file_format</code>, which is set
          to <code class="literal">Barracuda</code> by default in MySQL 5.7.7.
          Together, these default value changes allow larger index key
          prefixes to be created when using
          <code class="literal">ROW_FORMAT=DYNAMIC</code> or
          <code class="literal">ROW_FORMAT=COMPRESSED</code>. If either option is
          set to a non-default value, index key prefixes larger than 767
          bytes are silently truncated.
        </p><p>
          <code class="literal">innodb_large_prefix</code> is deprecated in MySQL
          5.7.7, and will be removed in a future release.
          <code class="literal">innodb_large_prefix</code> was introduced in MySQL
          5.5 to allow users to disable large index key prefixes for
          compatibility with earlier versions of MySQL and
          <code class="literal">InnoDB</code> that do not support large index key
          prefixes.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_limit_optimistic_insert_debug"></a>
          <a class="indexterm" name="idm140644106417296"></a>

          <a class="indexterm" name="idm140644106416208"></a>

          <code class="literal">innodb_limit_optimistic_insert_debug</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_limit_optimistic_insert_debug" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_limit_optimistic_insert_debug=#</code></td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>System Variable</strong></span></td><td><span class="bold"><strong>Name</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_limit_optimistic_insert_debug">innodb_limit_optimistic_insert_debug</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="2">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="2">Yes</td></tr><tr><td scope="row" rowspan="4"><span class="bold"><strong>Permitted Values</strong></span></td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">integer</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">0</code></td></tr><tr><td scope="row"><span class="bold"><strong>Min Value</strong></span></td><td colspan="2"><code class="literal">0</code></td></tr><tr><td scope="row"><span class="bold"><strong>Max Value</strong></span></td><td colspan="2"><code class="literal">2**32-1</code></td></tr></tbody></table>
</div>
<p>
          Limits the number of records per
          <a class="link" href="glossary.html#glos_b_tree" title="B-tree">B-tree</a> page. A default
          value of 0 means that no limit is imposed. This option is only
          available if debugging support is compiled in using the
          <a class="link" href="installing.html#option_cmake_with_debug"><code class="option">WITH_DEBUG</code></a>
          <span class="command"><strong>CMake</strong></span> option.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_lock_wait_timeout"></a>
          <a class="indexterm" name="idm140644106386160"></a>

          <a class="indexterm" name="idm140644106385056"></a>

          <code class="literal">innodb_lock_wait_timeout</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_lock_wait_timeout" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_lock_wait_timeout=#</code></td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>System Variable</strong></span></td><td><span class="bold"><strong>Name</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_lock_wait_timeout">innodb_lock_wait_timeout</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="2">Global, Session</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="2">Yes</td></tr><tr><td scope="row" rowspan="4"><span class="bold"><strong>Permitted Values</strong></span></td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">integer</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">50</code></td></tr><tr><td scope="row"><span class="bold"><strong>Min Value</strong></span></td><td colspan="2"><code class="literal">1</code></td></tr><tr><td scope="row"><span class="bold"><strong>Max Value</strong></span></td><td colspan="2"><code class="literal">1073741824</code></td></tr></tbody></table>
</div>
<p>
          The length of time in seconds an <code class="literal">InnoDB</code>
          <a class="link" href="glossary.html#glos_transaction" title="transaction">transaction</a> waits for
          a <a class="link" href="glossary.html#glos_row_lock" title="row lock">row lock</a> before giving
          up. The default value is 50 seconds. A transaction that tries
          to access a row that is locked by another
          <code class="literal">InnoDB</code> transaction waits at most this many
          seconds for write access to the row before issuing the
          following error:
        </p><pre class="programlisting">
ERROR 1205 (HY000): Lock wait timeout exceeded; try restarting transaction
</pre><p>
          When a lock wait timeout occurs, the current statement is
          <a class="link" href="glossary.html#glos_rollback" title="rollback">rolled back</a> (not the
          entire transaction). To have the entire transaction roll back,
          start the server with the
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_rollback_on_timeout"><code class="option">--innodb_rollback_on_timeout</code></a>
          option. See also <a class="xref" href="innodb-storage-engine.html#innodb-error-handling" title="14.18.4 InnoDB Error Handling">Section 14.18.4, “InnoDB Error Handling”</a>.
        </p><p>
          You might decrease this value for highly interactive
          applications or <a class="link" href="glossary.html#glos_oltp" title="OLTP">OLTP</a> systems,
          to display user feedback quickly or put the update into a
          queue for processing later. You might increase this value for
          long-running back-end operations, such as a transform step in
          a data warehouse that waits for other large insert or update
          operations to finish.
        </p><p>
          <code class="literal">innodb_lock_wait_timeout</code> applies to
          <code class="literal">InnoDB</code> row locks only. A MySQL
          <a class="link" href="glossary.html#glos_table_lock" title="table lock">table lock</a> does not
          happen inside <code class="literal">InnoDB</code> and this timeout does
          not apply to waits for table locks.
        </p><p>
          The lock wait timeout value does not apply to
          <a class="link" href="glossary.html#glos_deadlock" title="deadlock">deadlocks</a>, because
          <code class="literal">InnoDB</code> detects them immediately and rolls
          back one of the deadlocked transactions.
        </p><p>
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_lock_wait_timeout"><code class="literal">innodb_lock_wait_timeout</code></a> can
          be set at runtime with the <code class="literal">SET GLOBAL</code> or
          <code class="literal">SET SESSION</code> statement. Changing the
          <code class="literal">GLOBAL</code> setting requires the
          <code class="literal">SUPER</code> privilege and affects the operation
          of all clients that subsequently connect. Any client can
          change the <code class="literal">SESSION</code> setting for
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_lock_wait_timeout"><code class="literal">innodb_lock_wait_timeout</code></a>,
          which affects only that client.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_locks_unsafe_for_binlog"></a>
          <a class="indexterm" name="idm140644106336496"></a>

          <a class="indexterm" name="idm140644106335392"></a>

          <code class="literal">innodb_locks_unsafe_for_binlog</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_locks_unsafe_for_binlog" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Deprecated</strong></span></td><td colspan="3">5.6.3</td></tr><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_locks_unsafe_for_binlog</code></td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>System Variable</strong></span></td><td><span class="bold"><strong>Name</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_locks_unsafe_for_binlog">innodb_locks_unsafe_for_binlog</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="2">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="2">No</td></tr><tr><td scope="row" rowspan="2"><span class="bold"><strong>Permitted Values</strong></span></td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">boolean</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">OFF</code></td></tr></tbody></table>
</div>
<a class="indexterm" name="idm140644106312208"></a><a class="indexterm" name="idm140644106310720"></a><a class="indexterm" name="idm140644106309232"></a><a class="indexterm" name="idm140644106307744"></a><a class="indexterm" name="idm140644106306256"></a><a class="indexterm" name="idm140644106304768"></a><a class="indexterm" name="idm140644106303280"></a><a class="indexterm" name="idm140644106301792"></a><a class="indexterm" name="idm140644106300304"></a><a class="indexterm" name="idm140644106298816"></a><p>
          This variable affects how <code class="literal">InnoDB</code> uses
          <a class="link" href="glossary.html#glos_gap_lock" title="gap lock">gap locking</a> for searches
          and index scans. As of MySQL 5.6.3,
          <code class="literal">innodb_locks_unsafe_for_binlog</code> is
          deprecated and will be removed in a future MySQL release.
        </p><p>
          Normally, <code class="literal">InnoDB</code> uses an algorithm called
          next-key locking that combines index-row locking with
          <a class="link" href="glossary.html#glos_gap_lock" title="gap lock">gap locking</a>.
          <code class="literal">InnoDB</code> performs row-level locking in such a
          way that when it searches or scans a table index, it sets
          shared or exclusive locks on the index records it encounters.
          Thus, the row-level locks are actually index-record locks. In
          addition, a next-key lock on an index record also affects the
          <span class="quote">“<span class="quote">gap</span>”</span> before that index record. That is, a
          next-key lock is an index-record lock plus a gap lock on the
          gap preceding the index record. If one session has a shared or
          exclusive lock on record <code class="literal">R</code> in an index,
          another session cannot insert a new index record in the gap
          immediately before <code class="literal">R</code> in the index order.
          See <a class="xref" href="innodb-storage-engine.html#innodb-record-level-locks" title="14.2.2.2 InnoDB Record, Gap, and Next-Key Locks">Section 14.2.2.2, “InnoDB Record, Gap, and Next-Key Locks”</a>.
        </p><p>
          By default, the value of
          <code class="literal">innodb_locks_unsafe_for_binlog</code> is 0
          (disabled), which means that gap locking is enabled:
          <code class="literal">InnoDB</code> uses next-key locks for searches and
          index scans. To enable the variable, set it to 1. This causes
          gap locking to be disabled: <code class="literal">InnoDB</code> uses
          only index-record locks for searches and index scans.
        </p><p>
          Enabling <code class="literal">innodb_locks_unsafe_for_binlog</code>
          does not disable the use of gap locking for foreign-key
          constraint checking or duplicate-key checking.
        </p><p>
          The effect of enabling
          <code class="literal">innodb_locks_unsafe_for_binlog</code> is similar
          to but not identical to setting the transaction isolation
          level to <a class="link" href="sql-syntax.html#isolevel_read-committed"><code class="literal">READ COMMITTED</code></a>:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
              Enabling
              <a class="link" href="innodb-storage-engine.html#sysvar_innodb_locks_unsafe_for_binlog"><code class="literal">innodb_locks_unsafe_for_binlog</code></a>
              is a global setting and affects all sessions, whereas the
              isolation level can be set globally for all sessions, or
              individually per session.
            </p></li><li class="listitem"><p>
              <a class="link" href="innodb-storage-engine.html#sysvar_innodb_locks_unsafe_for_binlog"><code class="literal">innodb_locks_unsafe_for_binlog</code></a>
              can be set only at server startup, whereas the isolation
              level can be set at startup or changed at runtime.
</p></li></ul>
</div>
<p>
          <a class="link" href="sql-syntax.html#isolevel_read-committed"><code class="literal">READ COMMITTED</code></a> therefore
          offers finer and more flexible control than
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_locks_unsafe_for_binlog"><code class="literal">innodb_locks_unsafe_for_binlog</code></a>.
          For additional details about the effect of isolation level on
          gap locking, see <a class="xref" href="sql-syntax.html#set-transaction" title="13.3.6 SET TRANSACTION Syntax">Section 13.3.6, “SET TRANSACTION Syntax”</a>.
        </p><p>
          Enabling <code class="literal">innodb_locks_unsafe_for_binlog</code> may
          cause phantom problems because other sessions can insert new
          rows into the gaps when gap locking is disabled. Suppose that
          there is an index on the <code class="literal">id</code> column of the
          <code class="literal">child</code> table and that you want to read and
          lock all rows from the table having an identifier value larger
          than 100, with the intention of updating some column in the
          selected rows later:
        </p><pre class="programlisting">
SELECT * FROM child WHERE id &gt; 100 FOR UPDATE;
</pre><p>
          The query scans the index starting from the first record where
          <code class="literal">id</code> is greater than 100. If the locks set on
          the index records in that range do not lock out inserts made
          in the gaps, another session can insert a new row into the
          table. Consequently, if you were to execute the same
          <a class="link" href="sql-syntax.html#select" title="13.2.9 SELECT Syntax"><code class="literal">SELECT</code></a> again within the same
          transaction, you would see a new row in the result set
          returned by the query. This also means that if new items are
          added to the database, <code class="literal">InnoDB</code> does not
          guarantee serializability. Therefore, if
          <code class="literal">innodb_locks_unsafe_for_binlog</code> is enabled,
          <code class="literal">InnoDB</code> guarantees at most an isolation
          level of <a class="link" href="sql-syntax.html#isolevel_read-committed"><code class="literal">READ COMMITTED</code></a>.
          (Conflict serializability is still guaranteed.) For additional
          information about phantoms, see
          <a class="xref" href="innodb-storage-engine.html#innodb-next-key-locking" title="14.2.2.3 Avoiding the Phantom Problem Using Next-Key Locking">Section 14.2.2.3, “Avoiding the Phantom Problem Using Next-Key Locking”</a>.
        </p><p>
          Enabling <code class="literal">innodb_locks_unsafe_for_binlog</code> has
          additional effects:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
              For <a class="link" href="sql-syntax.html#update" title="13.2.11 UPDATE Syntax"><code class="literal">UPDATE</code></a> or
              <a class="link" href="sql-syntax.html#delete" title="13.2.2 DELETE Syntax"><code class="literal">DELETE</code></a> statements,
              <code class="literal">InnoDB</code> holds locks only for rows that
              it updates or deletes. Record locks for nonmatching rows
              are released after MySQL has evaluated the
              <code class="literal">WHERE</code> condition. This greatly reduces
              the probability of deadlocks, but they can still happen.
            </p></li><li class="listitem"><p>
              For <a class="link" href="sql-syntax.html#update" title="13.2.11 UPDATE Syntax"><code class="literal">UPDATE</code></a> statements, if a
              row is already locked, <code class="literal">InnoDB</code> performs
              a <span class="quote">“<span class="quote">semi-consistent</span>”</span> read, returning the
              latest committed version to MySQL so that MySQL can
              determine whether the row matches the
              <code class="literal">WHERE</code> condition of the
              <a class="link" href="sql-syntax.html#update" title="13.2.11 UPDATE Syntax"><code class="literal">UPDATE</code></a>. If the row matches
              (must be updated), MySQL reads the row again and this time
              <code class="literal">InnoDB</code> either locks it or waits for a
              lock on it.
</p></li></ul>
</div>
<p>
          Consider the following example, beginning with this table:
        </p><pre class="programlisting">
CREATE TABLE t (a INT NOT NULL, b INT) ENGINE = InnoDB;
INSERT INTO t VALUES (1,2),(2,3),(3,2),(4,3),(5,2);
COMMIT;
</pre><p>
          In this case, table has no indexes, so searches and index
          scans use the hidden clustered index for record locking (see
          <a class="xref" href="innodb-storage-engine.html#innodb-index-types" title="14.2.7.2 Clustered and Secondary Indexes">Section 14.2.7.2, “Clustered and Secondary Indexes”</a>).
        </p><p>
          Suppose that one client performs an
          <a class="link" href="sql-syntax.html#update" title="13.2.11 UPDATE Syntax"><code class="literal">UPDATE</code></a> using these statements:
        </p><pre class="programlisting">
SET autocommit = 0;
UPDATE t SET b = 5 WHERE b = 3;
</pre><p>
          Suppose also that a second client performs an
          <a class="link" href="sql-syntax.html#update" title="13.2.11 UPDATE Syntax"><code class="literal">UPDATE</code></a> by executing these
          statements following those of the first client:
        </p><pre class="programlisting">
SET autocommit = 0;
UPDATE t SET b = 4 WHERE b = 2;
</pre><p>
          As <code class="literal">InnoDB</code> executes each
          <a class="link" href="sql-syntax.html#update" title="13.2.11 UPDATE Syntax"><code class="literal">UPDATE</code></a>, it first acquires an
          exclusive lock for each row, and then determines whether to
          modify it. If <code class="literal">InnoDB</code> does not modify the
          row and <code class="literal">innodb_locks_unsafe_for_binlog</code> is
          enabled, it releases the lock. Otherwise,
          <code class="literal">InnoDB</code> retains the lock until the end of
          the transaction. This affects transaction processing as
          follows.
        </p><p>
          If <code class="literal">innodb_locks_unsafe_for_binlog</code> is
          disabled, the first <a class="link" href="sql-syntax.html#update" title="13.2.11 UPDATE Syntax"><code class="literal">UPDATE</code></a>
          acquires x-locks and does not release any of them:
        </p><pre class="programlisting">
x-lock(1,2); retain x-lock
x-lock(2,3); update(2,3) to (2,5); retain x-lock
x-lock(3,2); retain x-lock
x-lock(4,3); update(4,3) to (4,5); retain x-lock
x-lock(5,2); retain x-lock
</pre><p>
          The second <a class="link" href="sql-syntax.html#update" title="13.2.11 UPDATE Syntax"><code class="literal">UPDATE</code></a> blocks as
          soon as it tries to acquire any locks (because first update
          has retained locks on all rows), and does not proceed until
          the first <a class="link" href="sql-syntax.html#update" title="13.2.11 UPDATE Syntax"><code class="literal">UPDATE</code></a> commits or
          rolls back:
        </p><pre class="programlisting">
x-lock(1,2); block and wait for first UPDATE to commit or roll back
</pre><p>
          If <code class="literal">innodb_locks_unsafe_for_binlog</code> is
          enabled, the first <a class="link" href="sql-syntax.html#update" title="13.2.11 UPDATE Syntax"><code class="literal">UPDATE</code></a>
          acquires x-locks and releases those for rows that it does not
          modify:
        </p><pre class="programlisting">
x-lock(1,2); unlock(1,2)
x-lock(2,3); update(2,3) to (2,5); retain x-lock
x-lock(3,2); unlock(3,2)
x-lock(4,3); update(4,3) to (4,5); retain x-lock
x-lock(5,2); unlock(5,2)
</pre><p>
          For the second <code class="literal">UPDATE</code>,
          <code class="literal">InnoDB</code> does a
          <span class="quote">“<span class="quote">semi-consistent</span>”</span> read, returning the latest
          committed version of each row to MySQL so that MySQL can
          determine whether the row matches the <code class="literal">WHERE</code>
          condition of the <a class="link" href="sql-syntax.html#update" title="13.2.11 UPDATE Syntax"><code class="literal">UPDATE</code></a>:
        </p><pre class="programlisting">
x-lock(1,2); update(1,2) to (1,4); retain x-lock
x-lock(2,3); unlock(2,3)
x-lock(3,2); update(3,2) to (3,4); retain x-lock
x-lock(4,3); unlock(4,3)
x-lock(5,2); update(5,2) to (5,4); retain x-lock
</pre></li><li class="listitem"><p><a name="sysvar_innodb_log_buffer_size"></a>
          <a class="indexterm" name="idm140644106220784"></a>

          <a class="indexterm" name="idm140644106219744"></a>

          <code class="literal">innodb_log_buffer_size</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_log_buffer_size" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_log_buffer_size=#</code></td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>System Variable</strong></span></td><td><span class="bold"><strong>Name</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_log_buffer_size">innodb_log_buffer_size</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="2">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="2">No</td></tr><tr><td scope="row" rowspan="4"><span class="bold"><strong>Permitted Values</strong></span> (&lt;= 5.7.5)</td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">integer</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">8388608</code></td></tr><tr><td scope="row"><span class="bold"><strong>Min Value</strong></span></td><td colspan="2"><code class="literal">262144</code></td></tr><tr><td scope="row"><span class="bold"><strong>Max Value</strong></span></td><td colspan="2"><code class="literal">4294967295</code></td></tr><tr><td scope="row" rowspan="4"><span class="bold"><strong>Permitted Values</strong></span> (&gt;= 5.7.6)</td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">integer</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">16777216</code></td></tr><tr><td scope="row"><span class="bold"><strong>Min Value</strong></span></td><td colspan="2"><code class="literal">1048576</code></td></tr><tr><td scope="row"><span class="bold"><strong>Max Value</strong></span></td><td colspan="2"><code class="literal">4294967295</code></td></tr></tbody></table>
</div>
<p>
          The size in bytes of the buffer that <code class="literal">InnoDB</code>
          uses to write to the <a class="link" href="glossary.html#glos_log_file" title="log file">log
          files</a> on disk. The default value changed from 8MB to
          16MB in 5.7.6 with the introduction of 32k and 64k
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_page_size"><code class="literal">innodb_page_size</code></a> values. A
          large <a class="link" href="glossary.html#glos_log_buffer" title="log buffer">log buffer</a>
          enables large
          <a class="link" href="glossary.html#glos_transaction" title="transaction">transactions</a> to run
          without a need to write the log to disk before the
          transactions <a class="link" href="glossary.html#glos_commit" title="commit">commit</a>. Thus,
          if you have transactions that update, insert, or delete many
          rows, making the log buffer larger saves disk I/O. For general
          I/O tuning advice, see
          <a class="xref" href="optimization.html#optimizing-innodb-diskio" title="8.5.8 Optimizing InnoDB Disk I/O">Section 8.5.8, “Optimizing InnoDB Disk I/O”</a>.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_log_checksum_algorithm"></a>
          <a class="indexterm" name="idm140644106175616"></a>

          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_log_checksum_algorithm"><code class="literal">innodb_log_checksum_algorithm</code></a>
</p>
<div class="informaltable">
<table summary="Options for innodb_log_checksum_algorithm" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Introduced</strong></span></td><td colspan="3">5.7.8</td></tr><tr><td scope="row"><span class="bold"><strong>Removed</strong></span></td><td colspan="3">5.7.9</td></tr><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_log_checksum_algorithm=#</code></td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>System Variable</strong></span></td><td><span class="bold"><strong>Name</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_log_checksum_algorithm">innodb_log_checksum_algorithm</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="2">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="2">Yes</td></tr><tr><td scope="row" rowspan="8"><span class="bold"><strong>Permitted Values</strong></span> (&gt;= 5.7.8)</td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">enumeration</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">innodb</code></td></tr><tr><td scope="row" rowspan="6" valign="top"><span class="bold"><strong>Valid Values</strong></span></td><td colspan="2"><code class="literal">innodb</code></td></tr><tr><td scope="row" colspan="2"><code class="literal">crc32</code></td></tr><tr><td scope="row" colspan="2"><code class="literal">none</code></td></tr><tr><td scope="row" colspan="2"><code class="literal">strict_innodb</code></td></tr><tr><td scope="row" colspan="2"><code class="literal">strict_crc32</code></td></tr><tr><td scope="row" colspan="2"><code class="literal">strict_none</code></td></tr></tbody></table>
</div>
<p>
          This configuration option was removed in MySQL 5.7.9 and
          replaced by <code class="literal">innodb_log_checksums</code>.
        </p><p>
          Specifies how to generate and verify the
          <a class="link" href="glossary.html#glos_checksum" title="checksum">checksum</a> stored in each
          redo log disk block.
          <code class="literal">innodb_log_checksum_algorithm</code> supports same
          algorithms as <code class="literal">innodb_checksum_algorithm</code>.
          Previously, only the <code class="literal">innodb</code> algorithm was
          supported for redo log disk blocks.
          <code class="literal">innodb_log_checksum_algorithm=innodb</code> is the
          default setting.
        </p><p>
          The <code class="literal">strict_*</code> forms work the same as
          <code class="literal">innodb</code>, <code class="literal">crc32</code>, and
          <code class="literal">none</code>, except that <code class="literal">InnoDB</code>
          halts if it encounters a mix of checksum values in the same
          redo log. You can only use these options in a completely new
          instance. The <code class="literal">strict_*</code> settings are
          somewhat faster, because they do not need to compute both new
          and old checksum values to accept both during disk reads.
        </p><p>
          The following table illustrates the difference between the
          <code class="literal">none</code>, <code class="literal">innodb</code>, and
          <code class="literal">crc32</code> option values, and their
          <code class="literal">strict_</code> counterparts.
          <code class="literal">none</code>, <code class="literal">innodb</code>, and
          <code class="literal">crc32</code> write the specified type checksum
          value into each data block, but for compatibility accept any
          of the other checksum values when verifying a block during a
          read operation. The <code class="literal">strict_</code> form of each
          parameter only recognizes one kind of checksum, which makes
          verification faster but requires that all
          <code class="literal">InnoDB</code> redo logs in an instance be created
          under the identical
          <code class="literal">innodb_log_checksum_algorithm</code> value.
</p>
<div class="table">
<a name="idm140644106121744"></a><p class="title"><b>Table 14.12 Allowed Settings for innodb_log_checksum_algorithm</b></p>
<div class="table-contents">
<table summary="Allowed Settings for innodb_log_checksum_algorithm" border="1"><colgroup><col><col><col></colgroup><thead><tr><th scope="col">Value</th><th scope="col">Generated checksum (when writing)</th><th scope="col">Allowed checksums (when reading)</th></tr></thead><tbody><tr><td scope="row">none</td><td>A constant number.</td><td>Any of the checksums generated by <code class="literal">none</code>,
                  <code class="literal">innodb</code>, or
                  <code class="literal">crc32</code>.</td></tr><tr><td scope="row">innodb</td><td>A checksum calculated in software, using the original algorithm from
                  <code class="literal">InnoDB</code>.</td><td>Any of the checksums generated by <code class="literal">none</code>,
                  <code class="literal">innodb</code>, or
                  <code class="literal">crc32</code>.</td></tr><tr><td scope="row">crc32</td><td>A checksum calculated using the <code class="literal">crc32</code> algorithm,
                  possibly done with a hardware assist.</td><td>Any of the checksums generated by <code class="literal">none</code>,
                  <code class="literal">innodb</code>, or
                  <code class="literal">crc32</code>.</td></tr><tr><td scope="row">strict_none</td><td>A constant number</td><td>Only the checksum generated by <code class="literal">none</code>.</td></tr><tr><td scope="row">strict_innodb</td><td>A checksum calculated in software, using the original algorithm from
                  <code class="literal">InnoDB</code>.</td><td>Only the checksum generated by <code class="literal">innodb</code>.</td></tr><tr><td scope="row">strict_crc32</td><td>A checksum calculated using the <code class="literal">crc32</code> algorithm,
possibly done with a hardware assist.</td><td>Only the checksum generated by <code class="literal">crc32</code>.</td></tr></tbody></table>
</div>

</div>
<br class="table-break"></li><li class="listitem"><p><a name="sysvar_innodb_log_checksums"></a>
          <a class="indexterm" name="idm140644106093808"></a>

          <a class="indexterm" name="idm140644106092768"></a>

          <code class="literal">innodb_log_checksums</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_log_checksums" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Introduced</strong></span></td><td colspan="3">5.7.9</td></tr><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_log_checksums=#</code></td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>System Variable</strong></span></td><td><span class="bold"><strong>Name</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_log_checksums">innodb_log_checksums</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="2">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="2">Yes</td></tr><tr><td scope="row" rowspan="2"><span class="bold"><strong>Permitted Values</strong></span></td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">boolean</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">ON</code></td></tr></tbody></table>
</div>
<p>
          Enables or disables checksums for redo log pages.
          <code class="literal">innodb_log_checksums</code> replaces
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_log_checksum_algorithm"><code class="literal">innodb_log_checksum_algorithm</code></a>,
          which was removed in MySQL 5.7.9.
        </p><p>
          <code class="literal">innodb_log_checksums=ON</code> enables the
          <code class="literal">CRC-32C</code> checksum algorithm for redo log
          pages. When <code class="literal">innodb_log_checksums</code> is
          disabled, the contents of the redo log page checksum field are
          ignored.
        </p><p>
          Checksums on the redo log header page and redo log checkpoint
          pages are never disabled.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_log_compressed_pages"></a>
          <a class="indexterm" name="idm140644106062832"></a>

          <code class="literal">innodb_log_compressed_pages</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_log_compressed_pages" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_log_compressed_pages=#</code></td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>System Variable</strong></span></td><td><span class="bold"><strong>Name</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_log_compressed_pages">innodb_log_compressed_pages</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="2">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="2">Yes</td></tr><tr><td scope="row" rowspan="2"><span class="bold"><strong>Permitted Values</strong></span></td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">boolean</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">ON</code></td></tr></tbody></table>
</div>
<p>
          Specifies whether images of
          <a class="link" href="glossary.html#glos_compression" title="compression">re-compressed</a>
          <a class="link" href="glossary.html#glos_page" title="page">pages</a> are stored in
          <code class="literal">InnoDB</code> <a class="link" href="glossary.html#glos_redo_log" title="redo log">redo
          logs</a>.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_log_file_size"></a>
          <a class="indexterm" name="idm140644106037136"></a>

          <a class="indexterm" name="idm140644106036096"></a>

          <code class="literal">innodb_log_file_size</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_log_file_size" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_log_file_size=#</code></td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>System Variable</strong></span></td><td><span class="bold"><strong>Name</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_log_file_size">innodb_log_file_size</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="2">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="2">No</td></tr><tr><td scope="row" rowspan="4"><span class="bold"><strong>Permitted Values</strong></span> (&lt;= 5.7.10)</td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">integer</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">50331648</code></td></tr><tr><td scope="row"><span class="bold"><strong>Min Value</strong></span></td><td colspan="2"><code class="literal">1048576</code></td></tr><tr><td scope="row"><span class="bold"><strong>Max Value</strong></span></td><td colspan="2"><code class="literal">512GB / innodb_log_files_in_group</code></td></tr><tr><td scope="row" rowspan="4"><span class="bold"><strong>Permitted Values</strong></span> (&gt;= 5.7.11)</td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">integer</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">50331648</code></td></tr><tr><td scope="row"><span class="bold"><strong>Min Value</strong></span></td><td colspan="2"><code class="literal">4194304</code></td></tr><tr><td scope="row"><span class="bold"><strong>Max Value</strong></span></td><td colspan="2"><code class="literal">512GB / innodb_log_files_in_group</code></td></tr></tbody></table>
</div>
<p>
          The size in bytes of each <a class="link" href="glossary.html#glos_log_file" title="log file">log
          file</a> in a
          <a class="link" href="glossary.html#glos_log_group" title="log group">log group</a>.
          The combined size of log files
          (<code class="literal">innodb_log_file_size</code> *
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_log_files_in_group"><code class="literal">innodb_log_files_in_group</code></a>)
          cannot exceed a maximum value that is slightly less than
          512GB. A pair of 255 GB log files, for example, would allow
          you to approach the limit but not exceed it. The default value
          is 48MB. Sensible values range from 4MB to
          1/<em class="replaceable"><code>N</code></em>-th of the size of the
          <a class="link" href="glossary.html#glos_buffer_pool" title="buffer pool">buffer pool</a>, where
          <em class="replaceable"><code>N</code></em> is the number of log files in the
          group. The larger the value, the less checkpoint flush
          activity is needed in the buffer pool, saving disk I/O. Larger
          log files also make
          <a class="link" href="glossary.html#glos_crash_recovery" title="crash recovery">crash
          recovery</a> slower, although improvements to recovery
          performance in MySQL 5.5 and higher make the log file size
          less of a consideration. For general I/O tuning advice, see
          <a class="xref" href="optimization.html#optimizing-innodb-diskio" title="8.5.8 Optimizing InnoDB Disk I/O">Section 8.5.8, “Optimizing InnoDB Disk I/O”</a>.
        </p><p>
          The minimum <code class="literal">innodb_log_file_size</code> value was
          increased from 1MB to 4MB in MySQL 5.7.11.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_log_files_in_group"></a>
          <a class="indexterm" name="idm140644105989328"></a>

          <a class="indexterm" name="idm140644105988224"></a>

          <code class="literal">innodb_log_files_in_group</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_log_files_in_group" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_log_files_in_group=#</code></td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>System Variable</strong></span></td><td><span class="bold"><strong>Name</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_log_files_in_group">innodb_log_files_in_group</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="2">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="2">No</td></tr><tr><td scope="row" rowspan="4"><span class="bold"><strong>Permitted Values</strong></span></td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">integer</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">2</code></td></tr><tr><td scope="row"><span class="bold"><strong>Min Value</strong></span></td><td colspan="2"><code class="literal">2</code></td></tr><tr><td scope="row"><span class="bold"><strong>Max Value</strong></span></td><td colspan="2"><code class="literal">100</code></td></tr></tbody></table>
</div>
<p>
          The number of <a class="link" href="glossary.html#glos_log_file" title="log file">log files</a>
          in the <a class="link" href="glossary.html#glos_log_group" title="log group">log group</a>.
          <code class="literal">InnoDB</code> writes to the files in a circular
          fashion. The default (and recommended) value is 2. The
          location of these files is specified by
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_log_group_home_dir"><code class="literal">innodb_log_group_home_dir</code></a>.
          The combined size of log files
          (<a class="link" href="innodb-storage-engine.html#sysvar_innodb_log_file_size"><code class="literal">innodb_log_file_size</code></a> *
          <code class="literal">innodb_log_files_in_group</code>) can be up to
          512GB.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_log_group_home_dir"></a>
          <a class="indexterm" name="idm140644105955024"></a>

          <a class="indexterm" name="idm140644105953920"></a>

          <code class="literal">innodb_log_group_home_dir</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_log_group_home_dir" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_log_group_home_dir=dir_name</code></td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>System Variable</strong></span></td><td><span class="bold"><strong>Name</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_log_group_home_dir">innodb_log_group_home_dir</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="2">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="2">No</td></tr><tr><td scope="row"><span class="bold"><strong>Permitted Values</strong></span></td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">directory name</code></td></tr></tbody></table>
</div>
<p>
          The directory path to the <code class="literal">InnoDB</code>
          <a class="link" href="glossary.html#glos_redo_log" title="redo log">redo log</a> files, whose
          number is specified by
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_log_files_in_group"><code class="literal">innodb_log_files_in_group</code></a>. If
          you do not specify any <code class="literal">InnoDB</code> log
          variables, the default is to create two files named
          <code class="filename">ib_logfile0</code> and
          <code class="filename">ib_logfile1</code> in the MySQL data directory.
          Their size is given by the size of the
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_log_file_size"><code class="literal">innodb_log_file_size</code></a> system
          variable.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_log_write_ahead_size"></a>
          <a class="indexterm" name="idm140644105926768"></a>

          <a class="indexterm" name="idm140644105925664"></a>

          <code class="literal">innodb_log_write_ahead_size</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_log_write_ahead_size" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Introduced</strong></span></td><td colspan="3">5.7.4</td></tr><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_log_write_ahead_size=#</code></td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>System Variable</strong></span></td><td><span class="bold"><strong>Name</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_log_write_ahead_size">innodb_log_write_ahead_size</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="2">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="2">Yes</td></tr><tr><td scope="row" rowspan="4"><span class="bold"><strong>Permitted Values</strong></span></td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">integer</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">8192</code></td></tr><tr><td scope="row"><span class="bold"><strong>Min Value</strong></span></td><td colspan="2"><code class="literal">512 (log file block size)</code></td></tr><tr><td scope="row"><span class="bold"><strong>Max Value</strong></span></td><td colspan="2"><code class="literal">Equal to innodb_page_size</code></td></tr></tbody></table>
</div>
<p>
          The write-ahead block size for the redo log, in bytes. To
          avoid <span class="quote">“<span class="quote">read-on-write</span>”</span>, set
          <code class="literal">innodb_log_write_ahead_size</code> to match the
          operating system or file system cache block size.
          Read-on-write occurs when redo log blocks are not entirely
          cached to the operating system or file system due to a
          mismatch between write-ahead block size for redo logs and
          operating system or file system cache block size.
        </p><p>
          Valid values for
          <code class="literal">innodb_log_write_ahead_size</code> are multiples
          of the <code class="literal">InnoDB</code> log file block size (2^n).
          The minimum value is the <code class="literal">InnoDB</code> log file
          block size (512). Write-ahead does not occur when the minimum
          value is specified. The maximum value is equal to
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_page_size"><code class="literal">innodb_page_size</code></a>. If you
          specify a value for
          <code class="literal">innodb_log_write_ahead_size</code> that is larger
          than the <a class="link" href="innodb-storage-engine.html#sysvar_innodb_page_size"><code class="literal">innodb_page_size</code></a>
          value, the <code class="literal">innodb_log_write_ahead_size</code>
          value is truncated to the
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_page_size"><code class="literal">innodb_page_size</code></a> value.
        </p><p>
          Setting the <code class="literal">innodb_log_write_ahead_size</code>
          value too low in relation to the operating system or file
          system cache block size will result in
          <span class="quote">“<span class="quote">read-on-write</span>”</span>. Setting the value too high may
          have a slight impact on <code class="literal">fsync</code> performance
          for log file writes due to several blocks being written at
          once.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_lru_scan_depth"></a>
          <a class="indexterm" name="idm140644105884160"></a>

          <code class="literal">innodb_lru_scan_depth</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_lru_scan_depth" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_lru_scan_depth=#</code></td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>System Variable</strong></span></td><td><span class="bold"><strong>Name</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_lru_scan_depth">innodb_lru_scan_depth</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="2">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="2">Yes</td></tr><tr><td scope="row" rowspan="4"><span class="bold"><strong>Permitted Values</strong></span> (32-bit platforms)</td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">integer</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">1024</code></td></tr><tr><td scope="row"><span class="bold"><strong>Min Value</strong></span></td><td colspan="2"><code class="literal">100</code></td></tr><tr><td scope="row"><span class="bold"><strong>Max Value</strong></span></td><td colspan="2"><code class="literal">2**32-1</code></td></tr><tr><td scope="row" rowspan="4"><span class="bold"><strong>Permitted Values</strong></span> (64-bit platforms)</td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">integer</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">1024</code></td></tr><tr><td scope="row"><span class="bold"><strong>Min Value</strong></span></td><td colspan="2"><code class="literal">100</code></td></tr><tr><td scope="row"><span class="bold"><strong>Max Value</strong></span></td><td colspan="2"><code class="literal">2**64-1</code></td></tr></tbody></table>
</div>
<p>
          A parameter that influences the algorithms and heuristics for
          the <a class="link" href="glossary.html#glos_flush" title="flush">flush</a> operation for the
          <code class="literal">InnoDB</code>
          <a class="link" href="glossary.html#glos_buffer_pool" title="buffer pool">buffer pool</a>. Primarily
          of interest to performance experts tuning I/O-intensive
          workloads. It specifies, per buffer pool instance, how far
          down the buffer pool LRU list the
          <code class="literal">page_cleaner</code> thread scans looking for
          <a class="link" href="glossary.html#glos_dirty_page" title="dirty page">dirty pages</a> to flush.
          This is a background operation performed once a second. If you
          have spare I/O capacity under a typical workload, increase the
          value. If a write-intensive workload saturates your I/O
          capacity, decrease the value, especially if you have a large
          buffer pool. For general I/O tuning advice, see
          <a class="xref" href="optimization.html#optimizing-innodb-diskio" title="8.5.8 Optimizing InnoDB Disk I/O">Section 8.5.8, “Optimizing InnoDB Disk I/O”</a>.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_max_dirty_pages_pct"></a>
          <a class="indexterm" name="idm140644105841744"></a>

          <a class="indexterm" name="idm140644105840640"></a>

          <code class="literal">innodb_max_dirty_pages_pct</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_max_dirty_pages_pct" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_max_dirty_pages_pct=#</code></td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>System Variable</strong></span></td><td><span class="bold"><strong>Name</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_max_dirty_pages_pct">innodb_max_dirty_pages_pct</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="2">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="2">Yes</td></tr><tr><td scope="row" rowspan="4"><span class="bold"><strong>Permitted Values</strong></span> (&lt;= 5.7.4)</td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">numeric</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">75</code></td></tr><tr><td scope="row"><span class="bold"><strong>Min Value</strong></span></td><td colspan="2"><code class="literal">0</code></td></tr><tr><td scope="row"><span class="bold"><strong>Max Value</strong></span></td><td colspan="2"><code class="literal">99</code></td></tr><tr><td scope="row" rowspan="4"><span class="bold"><strong>Permitted Values</strong></span> (&gt;= 5.7.5)</td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">numeric</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">75</code></td></tr><tr><td scope="row"><span class="bold"><strong>Min Value</strong></span></td><td colspan="2"><code class="literal">0</code></td></tr><tr><td scope="row"><span class="bold"><strong>Max Value</strong></span></td><td colspan="2"><code class="literal">99.99</code></td></tr></tbody></table>
</div>
<p>
          <code class="literal">InnoDB</code> tries to
          <a class="link" href="glossary.html#glos_flush" title="flush">flush</a> data from the
          <a class="link" href="glossary.html#glos_buffer_pool" title="buffer pool">buffer pool</a> so that
          the percentage of <a class="link" href="glossary.html#glos_dirty_page" title="dirty page">dirty
          pages</a> does not exceed this value. The default value is
          75.
        </p><p>
          The
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_max_dirty_pages_pct"><code class="literal">innodb_max_dirty_pages_pct</code></a>
          setting establishes a target for flushing activity. It does
          not affect the rate of flushing. For information about
          managing the rate of flushing, see
          <a class="xref" href="innodb-storage-engine.html#innodb-performance-adaptive_flushing" title="14.3.3.2 Configuring the Rate of InnoDB Buffer Pool Flushing">Section 14.3.3.2, “Configuring the Rate of InnoDB Buffer Pool Flushing”</a>.
        </p><p>
          For additional information about this variable, see
          <a class="xref" href="innodb-storage-engine.html#innodb-lru-background-flushing" title="14.3.3.6 Tuning InnoDB Buffer Pool Flushing">Section 14.3.3.6, “Tuning InnoDB Buffer Pool Flushing”</a>. For general
          I/O tuning advice, see
          <a class="xref" href="optimization.html#optimizing-innodb-diskio" title="8.5.8 Optimizing InnoDB Disk I/O">Section 8.5.8, “Optimizing InnoDB Disk I/O”</a>.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_max_dirty_pages_pct_lwm"></a>
          <a class="indexterm" name="idm140644105794336"></a>

          <code class="literal">innodb_max_dirty_pages_pct_lwm</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_max_dirty_pages_pct_lwm" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_max_dirty_pages_pct_lwm=#</code></td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>System Variable</strong></span></td><td><span class="bold"><strong>Name</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_max_dirty_pages_pct_lwm">innodb_max_dirty_pages_pct_lwm</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="2">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="2">Yes</td></tr><tr><td scope="row" rowspan="4"><span class="bold"><strong>Permitted Values</strong></span> (&lt;= 5.7.4)</td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">numeric</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">0</code></td></tr><tr><td scope="row"><span class="bold"><strong>Min Value</strong></span></td><td colspan="2"><code class="literal">0</code></td></tr><tr><td scope="row"><span class="bold"><strong>Max Value</strong></span></td><td colspan="2"><code class="literal">99</code></td></tr><tr><td scope="row" rowspan="4"><span class="bold"><strong>Permitted Values</strong></span> (&gt;= 5.7.5)</td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">numeric</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">0</code></td></tr><tr><td scope="row"><span class="bold"><strong>Min Value</strong></span></td><td colspan="2"><code class="literal">0</code></td></tr><tr><td scope="row"><span class="bold"><strong>Max Value</strong></span></td><td colspan="2"><code class="literal">99.99</code></td></tr></tbody></table>
</div>
<p>
          Low water mark representing percentage of
          <a class="link" href="glossary.html#glos_dirty_page" title="dirty page">dirty pages</a> where
          preflushing is enabled to control the dirty page ratio. The
          default of 0 disables the pre-flushing behavior entirely. For
          additional information about this variable, see
          <a class="xref" href="innodb-storage-engine.html#innodb-lru-background-flushing" title="14.3.3.6 Tuning InnoDB Buffer Pool Flushing">Section 14.3.3.6, “Tuning InnoDB Buffer Pool Flushing”</a>.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_max_purge_lag"></a>
          <a class="indexterm" name="idm140644105755376"></a>

          <a class="indexterm" name="idm140644105754336"></a>

          <code class="literal">innodb_max_purge_lag</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_max_purge_lag" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_max_purge_lag=#</code></td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>System Variable</strong></span></td><td><span class="bold"><strong>Name</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_max_purge_lag">innodb_max_purge_lag</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="2">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="2">Yes</td></tr><tr><td scope="row" rowspan="4"><span class="bold"><strong>Permitted Values</strong></span></td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">integer</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">0</code></td></tr><tr><td scope="row"><span class="bold"><strong>Min Value</strong></span></td><td colspan="2"><code class="literal">0</code></td></tr><tr><td scope="row"><span class="bold"><strong>Max Value</strong></span></td><td colspan="2"><code class="literal">4294967295</code></td></tr></tbody></table>
</div>
<p>
          This variable controls how to delay
          <a class="link" href="sql-syntax.html#insert" title="13.2.5 INSERT Syntax"><code class="literal">INSERT</code></a>,
          <a class="link" href="sql-syntax.html#update" title="13.2.11 UPDATE Syntax"><code class="literal">UPDATE</code></a>, and
          <a class="link" href="sql-syntax.html#delete" title="13.2.2 DELETE Syntax"><code class="literal">DELETE</code></a> operations when
          <a class="link" href="glossary.html#glos_purge" title="purge">purge</a> operations are lagging
          (see <a class="xref" href="innodb-storage-engine.html#innodb-multi-versioning" title="14.2.3 InnoDB Multi-Versioning">Section 14.2.3, “InnoDB Multi-Versioning”</a>). The default
          value is 0 (no delays).
        </p><p>
          The <code class="literal">InnoDB</code> transaction system maintains a
          list of transactions that have index records delete-marked by
          <a class="link" href="sql-syntax.html#update" title="13.2.11 UPDATE Syntax"><code class="literal">UPDATE</code></a> or
          <a class="link" href="sql-syntax.html#delete" title="13.2.2 DELETE Syntax"><code class="literal">DELETE</code></a> operations. The length
          of this list represents the
          <em class="replaceable"><code>purge_lag</code></em> value. When
          <em class="replaceable"><code>purge_lag</code></em> exceeds
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_max_purge_lag"><code class="literal">innodb_max_purge_lag</code></a>, each
          <a class="link" href="sql-syntax.html#insert" title="13.2.5 INSERT Syntax"><code class="literal">INSERT</code></a>,
          <a class="link" href="sql-syntax.html#update" title="13.2.11 UPDATE Syntax"><code class="literal">UPDATE</code></a>, and
          <a class="link" href="sql-syntax.html#delete" title="13.2.2 DELETE Syntax"><code class="literal">DELETE</code></a> operation is delayed.
        </p><p>
          To prevent excessive delays in extreme situations where
          <em class="replaceable"><code>purge_lag</code></em> becomes huge, you can put
          a cap on the amount of delay by setting the
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_max_purge_lag_delay"><code class="literal">innodb_max_purge_lag_delay</code></a>
          configuration option. The delay is computed at the beginning
          of a purge batch.
        </p><p>
          A typical setting for a problematic workload might be 1
          million, assuming that transactions are small, only 100 bytes
          in size, and it is permissible to have 100MB of unpurged
          <code class="literal">InnoDB</code> table rows.
        </p><p>
          The lag value is displayed as the history list length in the
          <code class="literal">TRANSACTIONS</code> section of InnoDB Monitor
          output. For example, if the output includes the following
          lines, the lag value is 20:
        </p><pre class="programlisting">
------------
TRANSACTIONS
------------
Trx id counter 0 290328385
Purge done for trx's n:o &lt; 0 290315608 undo n:o &lt; 0 17
History list length 20
</pre><p>
          For general I/O tuning advice, see
          <a class="xref" href="optimization.html#optimizing-innodb-diskio" title="8.5.8 Optimizing InnoDB Disk I/O">Section 8.5.8, “Optimizing InnoDB Disk I/O”</a>.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_max_purge_lag_delay"></a>
          <a class="indexterm" name="idm140644105704944"></a>

          <a class="indexterm" name="idm140644105703840"></a>

          <code class="literal">innodb_max_purge_lag_delay</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_max_purge_lag_delay" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_max_purge_lag_delay=#</code></td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>System Variable</strong></span></td><td><span class="bold"><strong>Name</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_max_purge_lag_delay">innodb_max_purge_lag_delay</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="2">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="2">Yes</td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>Permitted Values</strong></span></td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">integer</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">0</code></td></tr><tr><td scope="row"><span class="bold"><strong>Min Value</strong></span></td><td colspan="2"><code class="literal">0</code></td></tr></tbody></table>
</div>
<p>
          Specifies the maximum delay in milliseconds for the delay
          imposed by the
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_max_purge_lag"><code class="literal">innodb_max_purge_lag</code></a>
          configuration option. Any non-zero value represents an upper
          limit on the delay period computed from the formula based on
          the value of <code class="literal">innodb_max_purge_lag</code>. The
          default of zero means that there is no upper limit imposed on
          the delay interval.
        </p><p>
          For general I/O tuning advice, see
          <a class="xref" href="optimization.html#optimizing-innodb-diskio" title="8.5.8 Optimizing InnoDB Disk I/O">Section 8.5.8, “Optimizing InnoDB Disk I/O”</a>.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_max_undo_log_size"></a>
          <a class="indexterm" name="idm140644105675248"></a>

          <a class="indexterm" name="idm140644105674144"></a>

          <code class="literal">innodb_max_undo_log_size</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_max_undo_log_size" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Introduced</strong></span></td><td colspan="3">5.7.5</td></tr><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_max_undo_log_size=#</code></td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>System Variable</strong></span></td><td><span class="bold"><strong>Name</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_max_undo_log_size">innodb_max_undo_log_size</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="2">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="2">Yes</td></tr><tr><td scope="row" rowspan="4"><span class="bold"><strong>Permitted Values</strong></span></td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">integer</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">1073741824</code></td></tr><tr><td scope="row"><span class="bold"><strong>Min Value</strong></span></td><td colspan="2"><code class="literal">10485760</code></td></tr><tr><td scope="row"><span class="bold"><strong>Max Value</strong></span></td><td colspan="2"><code class="literal">2**64-1</code></td></tr></tbody></table>
</div>
<p>
          <code class="literal">innodb_max_undo_log_size</code> defines a
          threshold size for undo tablespaces. If an undo tablespace
          exceeds the threshold, it can be marked for truncation when
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_undo_log_truncate"><code class="literal">innodb_undo_log_truncate</code></a> is
          enabled. The default value is 1024 MiB (1073741824 bytes).
        </p><p>
          For more information, see
          <a class="xref" href="innodb-storage-engine.html#truncate-undo-tablespace" title="14.4.8 Truncating Undo Logs That Reside in Undo Tablespaces">Section 14.4.8, “Truncating Undo Logs That Reside in Undo Tablespaces”</a>.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_merge_threshold_set_all_debug"></a>
          <a class="indexterm" name="idm140644105641456"></a>

          <a class="indexterm" name="idm140644105640416"></a>

          <code class="literal">innodb_merge_threshold_set_all_debug</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_merge_threshold_set_all_debug" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Introduced</strong></span></td><td colspan="3">5.7.6</td></tr><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_merge_threshold_set_all_debug=#</code></td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>System Variable</strong></span></td><td><span class="bold"><strong>Name</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_merge_threshold_set_all_debug">innodb_merge_threshold_set_all_debug</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="2">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="2">Yes</td></tr><tr><td scope="row" rowspan="4"><span class="bold"><strong>Permitted Values</strong></span></td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">integer</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">50</code></td></tr><tr><td scope="row"><span class="bold"><strong>Min Value</strong></span></td><td colspan="2"><code class="literal">1</code></td></tr><tr><td scope="row"><span class="bold"><strong>Max Value</strong></span></td><td colspan="2"><code class="literal">50</code></td></tr></tbody></table>
</div>
<p>
          Overrides the current <code class="literal">MERGE_THRESHOLD</code>
          setting with the specified value for all indexes that are
          currently in the dictionary cache. This option is only
          available if debugging support is compiled in using the
          <a class="link" href="installing.html#option_cmake_with_debug"><code class="option">WITH_DEBUG</code></a>
          <span class="command"><strong>CMake</strong></span> option. For related information, see
          <a class="xref" href="innodb-storage-engine.html#index-page-merge-threshold" title="14.3.12 Configuring the Merge Threshold for Index Pages">Section 14.3.12, “Configuring the Merge Threshold for Index Pages”</a>.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_monitor_disable"></a>
          <a class="indexterm" name="idm140644105607968"></a>

          <code class="literal">innodb_monitor_disable</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_monitor_disable" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_monitor_disable=[counter|module|pattern|all]</code></td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>System Variable</strong></span></td><td><span class="bold"><strong>Name</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_monitor_disable">innodb_monitor_disable</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="2">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="2">Yes</td></tr><tr><td scope="row"><span class="bold"><strong>Permitted Values</strong></span></td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">string</code></td></tr></tbody></table>
</div>
<p>
          Turns off one or more
          <a class="link" href="glossary.html#glos_counter" title="counter">counters</a> in the
          <a class="link" href="information-schema.html#innodb-metrics-table" title="21.31.20 The INFORMATION_SCHEMA INNODB_METRICS Table"><code class="literal">INFORMATION_SCHEMA.INNODB_METRICS</code></a>
          table. For usage information, see
          <a class="xref" href="information-schema.html#innodb-metrics-table" title="21.31.20 The INFORMATION_SCHEMA INNODB_METRICS Table">Section 21.31.20, “The INFORMATION_SCHEMA INNODB_METRICS Table”</a>.
        </p><p>
          As of MySQL 5.7.8,
          <code class="literal">innodb_monitor_disable='latch'</code> disables
          statistics collection for
          <a class="link" href="sql-syntax.html#show-engine" title="13.7.5.15 SHOW ENGINE Syntax"><code class="literal">SHOW ENGINE
          INNODB MUTEX</code></a>. For more information, see
          <a class="xref" href="sql-syntax.html#show-engine" title="13.7.5.15 SHOW ENGINE Syntax">Section 13.7.5.15, “SHOW ENGINE Syntax”</a>.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_monitor_enable"></a>
          <a class="indexterm" name="idm140644105581616"></a>

          <code class="literal">innodb_monitor_enable</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_monitor_enable" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_monitor_enable=[counter|module|pattern|all]</code></td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>System Variable</strong></span></td><td><span class="bold"><strong>Name</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_monitor_enable">innodb_monitor_enable</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="2">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="2">Yes</td></tr><tr><td scope="row"><span class="bold"><strong>Permitted Values</strong></span></td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">string</code></td></tr></tbody></table>
</div>
<p>
          Turns on one or more
          <a class="link" href="glossary.html#glos_counter" title="counter">counters</a> in the
          <a class="link" href="information-schema.html#innodb-metrics-table" title="21.31.20 The INFORMATION_SCHEMA INNODB_METRICS Table"><code class="literal">INFORMATION_SCHEMA.INNODB_METRICS</code></a>
          table. For usage information, see
          <a class="xref" href="information-schema.html#innodb-metrics-table" title="21.31.20 The INFORMATION_SCHEMA INNODB_METRICS Table">Section 21.31.20, “The INFORMATION_SCHEMA INNODB_METRICS Table”</a>.
        </p><p>
          As of MySQL 5.7.8,
          <code class="literal">innodb_monitor_enable='latch'</code> enables
          statistics collection for
          <a class="link" href="sql-syntax.html#show-engine" title="13.7.5.15 SHOW ENGINE Syntax"><code class="literal">SHOW ENGINE
          INNODB MUTEX</code></a>. For more information, see
          <a class="xref" href="sql-syntax.html#show-engine" title="13.7.5.15 SHOW ENGINE Syntax">Section 13.7.5.15, “SHOW ENGINE Syntax”</a>.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_monitor_reset"></a>
          <a class="indexterm" name="idm140644105555456"></a>

          <code class="literal">innodb_monitor_reset</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_monitor_reset" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_monitor_reset=[counter|module|pattern|all]</code></td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>System Variable</strong></span></td><td><span class="bold"><strong>Name</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_monitor_reset">innodb_monitor_reset</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="2">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="2">Yes</td></tr><tr><td scope="row"><span class="bold"><strong>Permitted Values</strong></span></td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">string</code></td></tr></tbody></table>
</div>
<p>
          Resets to zero the count value for one or more
          <a class="link" href="glossary.html#glos_counter" title="counter">counters</a> in the
          <a class="link" href="information-schema.html#innodb-metrics-table" title="21.31.20 The INFORMATION_SCHEMA INNODB_METRICS Table"><code class="literal">INFORMATION_SCHEMA.INNODB_METRICS</code></a>
          table. For usage information, see
          <a class="xref" href="information-schema.html#innodb-metrics-table" title="21.31.20 The INFORMATION_SCHEMA INNODB_METRICS Table">Section 21.31.20, “The INFORMATION_SCHEMA INNODB_METRICS Table”</a>.
        </p><p>
          As of MySQL 5.7.8,
          <code class="literal">innodb_monitor_reset='latch'</code> resets
          statistics reported by
          <a class="link" href="sql-syntax.html#show-engine" title="13.7.5.15 SHOW ENGINE Syntax"><code class="literal">SHOW ENGINE
          INNODB MUTEX</code></a>. For more information, see
          <a class="xref" href="sql-syntax.html#show-engine" title="13.7.5.15 SHOW ENGINE Syntax">Section 13.7.5.15, “SHOW ENGINE Syntax”</a>.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_monitor_reset_all"></a>
          <a class="indexterm" name="idm140644105529280"></a>

          <code class="literal">innodb_monitor_reset_all</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_monitor_reset_all" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_monitor_reset_all=[counter|module|pattern|all]</code></td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>System Variable</strong></span></td><td><span class="bold"><strong>Name</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_monitor_reset_all">innodb_monitor_reset_all</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="2">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="2">Yes</td></tr><tr><td scope="row"><span class="bold"><strong>Permitted Values</strong></span></td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">string</code></td></tr></tbody></table>
</div>
<p>
          Resets all values (minimum, maximum, and so on) for one or
          more <a class="link" href="glossary.html#glos_counter" title="counter">counters</a> in the
          <a class="link" href="information-schema.html#innodb-metrics-table" title="21.31.20 The INFORMATION_SCHEMA INNODB_METRICS Table"><code class="literal">INFORMATION_SCHEMA.INNODB_METRICS</code></a>
          table. For usage information, see
          <a class="xref" href="information-schema.html#innodb-metrics-table" title="21.31.20 The INFORMATION_SCHEMA INNODB_METRICS Table">Section 21.31.20, “The INFORMATION_SCHEMA INNODB_METRICS Table”</a>.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_numa_interleave"></a>
          <a class="indexterm" name="idm140644105506128"></a>

          <a class="indexterm" name="idm140644105505088"></a>

          <code class="literal">innodb_numa_interleave</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_numa_interleave" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Introduced</strong></span></td><td colspan="3">5.7.9</td></tr><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_numa_interleave=#</code></td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>System Variable</strong></span></td><td><span class="bold"><strong>Name</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_numa_interleave">innodb_numa_interleave</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="2">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="2">No</td></tr><tr><td scope="row" rowspan="2"><span class="bold"><strong>Permitted Values</strong></span></td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">boolean</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">OFF</code></td></tr></tbody></table>
</div>
<p>
          Enables the NUMA interleave memory policy for allocation of
          the <code class="literal">InnoDB</code> buffer pool. When
          <code class="literal">innodb_numa_interleave</code> is enabled, the NUMA
          memory policy is set to <code class="literal">MPOL_INTERLEAVE</code> for
          the <a class="link" href="programs.html#mysqld" title="4.3.1 mysqld — The MySQL Server"><span class="command"><strong>mysqld</strong></span></a> process. After the
          <code class="literal">InnoDB</code> buffer pool is allocated, the NUMA
          memory policy is set back to <code class="literal">MPOL_DEFAULT</code>.
          For the <code class="literal">innodb_numa_interleave</code> option to be
          available, MySQL must be compiled on a NUMA-enabled system.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_old_blocks_pct"></a>
          <a class="indexterm" name="idm140644105474512"></a>

          <a class="indexterm" name="idm140644105473456"></a>

          <code class="literal">innodb_old_blocks_pct</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_old_blocks_pct" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_old_blocks_pct=#</code></td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>System Variable</strong></span></td><td><span class="bold"><strong>Name</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_old_blocks_pct">innodb_old_blocks_pct</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="2">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="2">Yes</td></tr><tr><td scope="row" rowspan="4"><span class="bold"><strong>Permitted Values</strong></span></td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">integer</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">37</code></td></tr><tr><td scope="row"><span class="bold"><strong>Min Value</strong></span></td><td colspan="2"><code class="literal">5</code></td></tr><tr><td scope="row"><span class="bold"><strong>Max Value</strong></span></td><td colspan="2"><code class="literal">95</code></td></tr></tbody></table>
</div>
<p>
          Specifies the approximate percentage of the
          <code class="literal">InnoDB</code>
          <a class="link" href="glossary.html#glos_buffer_pool" title="buffer pool">buffer pool</a> used for
          the old block <a class="link" href="glossary.html#glos_sublist" title="sublist">sublist</a>. The
          range of values is 5 to 95. The default value is 37 (that is,
          3/8 of the pool). Often used in combination with
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_old_blocks_time"><code class="literal">innodb_old_blocks_time</code></a>. See
          <a class="xref" href="innodb-storage-engine.html#innodb-performance-midpoint_insertion" title="14.3.3.3 Making the Buffer Pool Scan Resistant">Section 14.3.3.3, “Making the Buffer Pool Scan Resistant”</a> for
          more information. See <a class="xref" href="optimization.html#innodb-buffer-pool" title="8.10.1 The InnoDB Buffer Pool">Section 8.10.1, “The InnoDB Buffer Pool”</a> for
          information about buffer pool management, such as the
          <a class="link" href="glossary.html#glos_lru" title="LRU">LRU</a> algorithm and
          <a class="link" href="glossary.html#glos_eviction" title="eviction">eviction</a> policies.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_old_blocks_time"></a>
          <a class="indexterm" name="idm140644105439056"></a>

          <a class="indexterm" name="idm140644105438016"></a>

          <code class="literal">innodb_old_blocks_time</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_old_blocks_time" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_old_blocks_time=#</code></td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>System Variable</strong></span></td><td><span class="bold"><strong>Name</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_old_blocks_time">innodb_old_blocks_time</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="2">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="2">Yes</td></tr><tr><td scope="row" rowspan="4"><span class="bold"><strong>Permitted Values</strong></span></td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">integer</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">1000</code></td></tr><tr><td scope="row"><span class="bold"><strong>Min Value</strong></span></td><td colspan="2"><code class="literal">0</code></td></tr><tr><td scope="row"><span class="bold"><strong>Max Value</strong></span></td><td colspan="2"><code class="literal">2**32-1</code></td></tr></tbody></table>
</div>
<p>
          Non-zero values protect against the
          <a class="link" href="glossary.html#glos_buffer_pool" title="buffer pool">buffer pool</a> being
          filled up by data that is referenced only for a brief period,
          such as during a <a class="link" href="glossary.html#glos_full_table_scan" title="full table scan">full
          table scan</a>. Increasing this value offers more
          protection against full table scans interfering with data
          cached in the buffer pool.
        </p><p>
          Specifies how long in milliseconds (ms) a block inserted into
          the old <a class="link" href="glossary.html#glos_sublist" title="sublist">sublist</a> must stay
          there after its first access before it can be moved to the new
          sublist. If the value is 0, a block inserted into the old
          sublist moves immediately to the new sublist the first time it
          is accessed, no matter how soon after insertion the access
          occurs. If the value is greater than 0, blocks remain in the
          old sublist until an access occurs at least that many ms after
          the first access. For example, a value of 1000 causes blocks
          to stay in the old sublist for 1 second after the first access
          before they become eligible to move to the new sublist.
        </p><p>
          The default value is 1000.
        </p><p>
          This variable is often used in combination with
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_old_blocks_pct"><code class="literal">innodb_old_blocks_pct</code></a>. See
          <a class="xref" href="innodb-storage-engine.html#innodb-performance-midpoint_insertion" title="14.3.3.3 Making the Buffer Pool Scan Resistant">Section 14.3.3.3, “Making the Buffer Pool Scan Resistant”</a> for
          more information. See <a class="xref" href="optimization.html#innodb-buffer-pool" title="8.10.1 The InnoDB Buffer Pool">Section 8.10.1, “The InnoDB Buffer Pool”</a> for
          information about buffer pool management, such as the
          <a class="link" href="glossary.html#glos_lru" title="LRU">LRU</a> algorithm and
          <a class="link" href="glossary.html#glos_eviction" title="eviction">eviction</a> policies.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_online_alter_log_max_size"></a>
          <a class="indexterm" name="idm140644105401440"></a>

          <code class="literal">innodb_online_alter_log_max_size</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_online_alter_log_max_size" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_online_alter_log_max_size=#</code></td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>System Variable</strong></span></td><td><span class="bold"><strong>Name</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_online_alter_log_max_size">innodb_online_alter_log_max_size</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="2">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="2">Yes</td></tr><tr><td scope="row" rowspan="4"><span class="bold"><strong>Permitted Values</strong></span></td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">integer</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">134217728</code></td></tr><tr><td scope="row"><span class="bold"><strong>Min Value</strong></span></td><td colspan="2"><code class="literal">65536</code></td></tr><tr><td scope="row"><span class="bold"><strong>Max Value</strong></span></td><td colspan="2"><code class="literal">2**64-1</code></td></tr></tbody></table>
</div>
<p>
          Specifies an upper limit on the size of the temporary log
          files used during <a class="link" href="glossary.html#glos_online_ddl" title="online DDL">online
          DDL</a> operations for <code class="literal">InnoDB</code> tables.
          There is one such log file for each index being created or
          table being altered. This log file stores data inserted,
          updated, or deleted in the table during the DDL operation. The
          temporary log file is extended when needed by the value of
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_sort_buffer_size"><code class="literal">innodb_sort_buffer_size</code></a>, up
          to the maximum specified by
          <code class="literal">innodb_online_alter_log_max_size</code>. If any
          temporary log file exceeds the upper size limit, the
          <a class="link" href="sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a> operation fails and
          all uncommitted concurrent DML operations are rolled back.
          Thus, a large value for this option allows more DML to happen
          during an online DDL operation, but also causes a longer
          period at the end of the DDL operation when the table is
          locked to apply the data from the log.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_open_files"></a>
          <a class="indexterm" name="idm140644105368832"></a>

          <a class="indexterm" name="idm140644105367792"></a>

          <code class="literal">innodb_open_files</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_open_files" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_open_files=#</code></td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>System Variable</strong></span></td><td><span class="bold"><strong>Name</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_open_files">innodb_open_files</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="2">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="2">No</td></tr><tr><td scope="row" rowspan="4"><span class="bold"><strong>Permitted Values</strong></span></td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">integer</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">-1 (autosized)</code></td></tr><tr><td scope="row"><span class="bold"><strong>Min Value</strong></span></td><td colspan="2"><code class="literal">10</code></td></tr><tr><td scope="row"><span class="bold"><strong>Max Value</strong></span></td><td colspan="2"><code class="literal">4294967295</code></td></tr></tbody></table>
</div>
<p>
          This variable is relevant only if you use multiple
          <code class="literal">InnoDB</code>
          <a class="link" href="glossary.html#glos_tablespace" title="tablespace">tablespaces</a>. It
          specifies the maximum number of
          <a class="link" href="glossary.html#glos_ibd_file" title=".ibd file"><code class="filename">.ibd</code>
          files</a> that MySQL can keep open at one time. The minimum
          value is 10. The default value is 300 if
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_per_table"><code class="literal">innodb_file_per_table</code></a> is not
          enabled, and the higher of 300 and
          <a class="link" href="server-administration.html#sysvar_table_open_cache"><code class="literal">table_open_cache</code></a> otherwise.
        </p><p>
          The file descriptors used for <code class="filename">.ibd</code> files
          are for <code class="literal">InnoDB</code> tables only. They are
          independent of those specified by the
          <a class="link" href="server-administration.html#option_mysqld_open-files-limit"><code class="option">--open-files-limit</code></a> server
          option, and do not affect the operation of the table cache.
          For general I/O tuning advice, see
          <a class="xref" href="optimization.html#optimizing-innodb-diskio" title="8.5.8 Optimizing InnoDB Disk I/O">Section 8.5.8, “Optimizing InnoDB Disk I/O”</a>.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_optimize_fulltext_only"></a>
          <a class="indexterm" name="idm140644105330992"></a>

          <code class="literal">innodb_optimize_fulltext_only</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_optimize_fulltext_only" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_optimize_fulltext_only=#</code></td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>System Variable</strong></span></td><td><span class="bold"><strong>Name</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_optimize_fulltext_only">innodb_optimize_fulltext_only</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="2">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="2">Yes</td></tr><tr><td scope="row" rowspan="2"><span class="bold"><strong>Permitted Values</strong></span></td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">boolean</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">OFF</code></td></tr></tbody></table>
</div>
<p>
          Changes the way the <a class="link" href="sql-syntax.html#optimize-table" title="13.7.2.4 OPTIMIZE TABLE Syntax"><code class="literal">OPTIMIZE
          TABLE</code></a> statement operates on
          <code class="literal">InnoDB</code> tables. Intended to be enabled
          temporarily, during maintenance operations for
          <code class="literal">InnoDB</code> tables with
          <code class="literal">FULLTEXT</code> indexes.
        </p><p>
          By default, <code class="literal">OPTIMIZE TABLE</code> reorganizes the
          data in the <a class="link" href="glossary.html#glos_clustered_index" title="clustered index">clustered
          index</a> of the table. When this option is enabled,
          <code class="literal">OPTIMIZE TABLE</code> skips this reorganization of
          the table data, and instead processes the newly added,
          deleted, and updated token data for a
          <code class="literal">FULLTEXT</code> index, See
          <a class="xref" href="innodb-storage-engine.html#innodb-fulltext-index" title="14.2.7.3 InnoDB FULLTEXT Indexes">Section 14.2.7.3, “InnoDB FULLTEXT Indexes”</a> for more information
          about <code class="literal">FULLTEXT</code> indexes for
          <code class="literal">InnoDB</code> tables.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_optimize_point_storage"></a>
          <a class="indexterm" name="idm140644105299216"></a>

          <a class="indexterm" name="idm140644105298112"></a>

          <code class="literal">innodb_optimize_point_storage</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_optimize_point_storage" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Introduced</strong></span></td><td colspan="3">5.7.5</td></tr><tr><td scope="row"><span class="bold"><strong>Removed</strong></span></td><td colspan="3">5.7.6</td></tr><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_optimize_point_storage=#</code></td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>System Variable</strong></span></td><td><span class="bold"><strong>Name</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_optimize_point_storage">innodb_optimize_point_storage</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="2">Session</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="2">Yes</td></tr><tr><td scope="row" rowspan="2"><span class="bold"><strong>Permitted Values</strong></span></td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">boolean</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">OFF</code></td></tr></tbody></table>
</div>
<p>
          Enable this variable before creating a column of type
          <code class="literal">POINT</code> to store the <code class="literal">POINT</code>
          data type internally as variable-length
          <code class="literal">BLOB</code> data.
        </p><p>
          This variable was removed in MySQL 5.7.6.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_page_cleaners"></a>
          <a class="indexterm" name="idm140644105268784"></a>

          <code class="literal">innodb_page_cleaners</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_page_cleaners" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Introduced</strong></span></td><td colspan="3">5.7.4</td></tr><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_page_cleaners=#</code></td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>System Variable</strong></span></td><td><span class="bold"><strong>Name</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_page_cleaners">innodb_page_cleaners</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="2">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="2">No</td></tr><tr><td scope="row" rowspan="4"><span class="bold"><strong>Permitted Values</strong></span> (&lt;= 5.7.7)</td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">integer</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">1</code></td></tr><tr><td scope="row"><span class="bold"><strong>Min Value</strong></span></td><td colspan="2"><code class="literal">1</code></td></tr><tr><td scope="row"><span class="bold"><strong>Max Value</strong></span></td><td colspan="2"><code class="literal">64</code></td></tr><tr><td scope="row" rowspan="4"><span class="bold"><strong>Permitted Values</strong></span> (&gt;= 5.7.8)</td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">integer</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">4</code></td></tr><tr><td scope="row"><span class="bold"><strong>Min Value</strong></span></td><td colspan="2"><code class="literal">1</code></td></tr><tr><td scope="row"><span class="bold"><strong>Max Value</strong></span></td><td colspan="2"><code class="literal">64</code></td></tr></tbody></table>
</div>
<p>
          The number of page cleaner threads that flush dirty pages from
          buffer pool instances. The page cleaner threads perform flush
          list and LRU flushing. A single page cleaner thread was
          introduced in MySQL 5.6.2 to offload buffer pool flushing work
          from the <code class="literal">InnoDB</code> master thread. As of MySQL
          5.7.4, <code class="literal">InnoDB</code> provides support for multiple
          page cleaner threads. A value of 1 maintains the pre-MySQL
          5.7.4 configuration in which there is a single page cleaner
          thread. When there are multiple page cleaner threads, buffer
          pool flushing tasks for each buffer pool instance are
          dispatched to idle page cleaner threads. The
          <code class="literal">innodb_page_cleaners</code> default value was
          changed from 1 to 4 in MySQL 5.7.8. If the number of page
          cleaner threads exceeds the number of buffer pool instances,
          <code class="literal">innodb_page_cleaners</code> is automatically set
          to the same value as
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_instances"><code class="literal">innodb_buffer_pool_instances</code></a>.
        </p><p>
          If your workload is write-IO bound (when flushing dirty pages
          from buffer pool instances to data files) and if your system
          hardware has available capacity, increasing the number of page
          cleaner threads may help improve write-IO throughput.
        </p><p>
          Multi-threaded page cleaner support is extended to shutdown
          and recovery phases in MySQL 5.7.5.
        </p><p>
          As of MySQL 5.7.6, the <code class="literal">setpriority()</code> system
          call is used on Linux platforms (where it is supported and
          where the <a class="link" href="programs.html#mysqld" title="4.3.1 mysqld — The MySQL Server"><span class="command"><strong>mysqld</strong></span></a> execution user is
          authorized) to give <code class="literal">page_cleaner</code> threads
          priority over other MySQL/InnoDB threads to help page flushing
          keep pace with the current workload. <a class="link" href="programs.html#mysqld" title="4.3.1 mysqld — The MySQL Server"><span class="command"><strong>mysqld</strong></span></a>
          execution user authorization can be configured in
          <code class="filename">/etc/security/limits.conf</code>. For example,
          if <a class="link" href="programs.html#mysqld" title="4.3.1 mysqld — The MySQL Server"><span class="command"><strong>mysqld</strong></span></a> is run under the
          <code class="literal">mysql</code> user, you might authorize the
          <code class="literal">mysql</code> user by adding lines similar to the
          following to <code class="filename">/etc/security/limits.conf</code>:
        </p><pre class="programlisting">mysql              hard    nice       -20
mysql              soft    nice       -20</pre><p>
          Refer to your Linux operating system documentation for more
          information.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_page_size"></a>
          <a class="indexterm" name="idm140644105213488"></a>

          <code class="literal">innodb_page_size</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_page_size" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_page_size=#k</code></td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>System Variable</strong></span></td><td><span class="bold"><strong>Name</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_page_size">innodb_page_size</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="2">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="2">No</td></tr><tr><td scope="row" rowspan="8"><span class="bold"><strong>Permitted Values</strong></span> (&lt;= 5.7.5)</td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">enumeration</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">16384</code></td></tr><tr><td scope="row" rowspan="6" valign="top"><span class="bold"><strong>Valid Values</strong></span></td><td colspan="2"><code class="literal">4k</code></td></tr><tr><td scope="row" colspan="2"><code class="literal">8k</code></td></tr><tr><td scope="row" colspan="2"><code class="literal">16k</code></td></tr><tr><td scope="row" colspan="2"><code class="literal">4096</code></td></tr><tr><td scope="row" colspan="2"><code class="literal">8192</code></td></tr><tr><td scope="row" colspan="2"><code class="literal">16384</code></td></tr><tr><td scope="row" rowspan="12"><span class="bold"><strong>Permitted Values</strong></span> (&gt;= 5.7.6)</td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">enumeration</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">16384</code></td></tr><tr><td scope="row" rowspan="10" valign="top"><span class="bold"><strong>Valid Values</strong></span></td><td colspan="2"><code class="literal">4k</code></td></tr><tr><td scope="row" colspan="2"><code class="literal">8k</code></td></tr><tr><td scope="row" colspan="2"><code class="literal">16k</code></td></tr><tr><td scope="row" colspan="2"><code class="literal">32k</code></td></tr><tr><td scope="row" colspan="2"><code class="literal">64k</code></td></tr><tr><td scope="row" colspan="2"><code class="literal">4096</code></td></tr><tr><td scope="row" colspan="2"><code class="literal">8192</code></td></tr><tr><td scope="row" colspan="2"><code class="literal">16384</code></td></tr><tr><td scope="row" colspan="2"><code class="literal">32768</code></td></tr><tr><td scope="row" colspan="2"><code class="literal">65536</code></td></tr></tbody></table>
</div>
<p>
          Specifies the <a class="link" href="glossary.html#glos_page_size" title="page size">page size</a>
          for all <code class="literal">InnoDB</code>
          <a class="link" href="glossary.html#glos_tablespace" title="tablespace">tablespaces</a> in a MySQL
          <a class="link" href="glossary.html#glos_instance" title="instance">instance</a>. This value is
          set when the instance is created and remains constant
          afterwards. You can specify page size using the values 64k,
          32k, <code class="literal">16k</code> (the default),
          <code class="literal">8k</code>, or <code class="literal">4k</code>.
          Alternatively, you can specify page size in bytes (65536,
          32768, 16384, 8192, 4096).
</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
            Support for 32k and 64k page sizes was added in MySQL 5.7.6.
            For both 32k and 64k page sizes, the maximum row length is
            about 16000 bytes. <code class="literal">ROW_FORMAT=COMPRESSED</code>
            is not supported when <code class="literal">innodb_page_size</code> is
            set to 32KB or 64KB. For
            <code class="literal">innodb_page_size=32k</code>, extent size is 2MB.
            For <code class="literal">innodb_page_size=64k</code>, extent size is
            4MB. <a class="link" href="innodb-storage-engine.html#sysvar_innodb_log_buffer_size"><code class="literal">innodb_log_buffer_size</code></a>
            should be set to at least 16M (which is the default as of
            MySQL 5.7.6) when using 32k or 64k page sizes.
</p>
</div>
<p>
          The default page size of 16KB and larger is appropriate for a
          wide range of <a class="link" href="glossary.html#glos_workload" title="workload">workloads</a>,
          particularly for queries involving table scans and DML
          operations involving bulk updates. Smaller page sizes might be
          more efficient for <a class="link" href="glossary.html#glos_oltp" title="OLTP">OLTP</a>
          workloads involving many small writes, where contention can be
          an issue when a single page contains many rows. Smaller pages
          might also be efficient with
          <a class="link" href="glossary.html#glos_ssd" title="SSD">SSD</a> storage devices, which
          typically use small block sizes. Keeping the
          <code class="literal">InnoDB</code> page size close to the storage
          device block size minimizes the amount of unchanged data that
          is rewritten to disk.
        </p><p>
          The minimum file size for the first system tablespace data
          file (<code class="literal">ibdata1</code>) differs depending on the
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_page_size"><code class="literal">innodb_page_size</code></a> value. See
          the <a class="link" href="innodb-storage-engine.html#sysvar_innodb_data_file_path"><code class="literal">innodb_data_file_path</code></a>
          option description for more information.
        </p><p>
          For general I/O tuning advice, see
          <a class="xref" href="optimization.html#optimizing-innodb-diskio" title="8.5.8 Optimizing InnoDB Disk I/O">Section 8.5.8, “Optimizing InnoDB Disk I/O”</a>.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_print_all_deadlocks"></a>
          <a class="indexterm" name="idm140644105140032"></a>

          <a class="indexterm" name="idm140644105138928"></a>

          <code class="literal">innodb_print_all_deadlocks</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_print_all_deadlocks" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_print_all_deadlocks=#</code></td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>System Variable</strong></span></td><td><span class="bold"><strong>Name</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_print_all_deadlocks">innodb_print_all_deadlocks</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="2">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="2">Yes</td></tr><tr><td scope="row" rowspan="2"><span class="bold"><strong>Permitted Values</strong></span></td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">boolean</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">OFF</code></td></tr></tbody></table>
</div>
<a class="indexterm" name="idm140644105117568"></a><p>
          When this option is enabled, information about all
          <a class="link" href="glossary.html#glos_deadlock" title="deadlock">deadlocks</a> in
          <code class="literal">InnoDB</code> user transactions is recorded in the
          <code class="literal">mysqld</code> <a class="link" href="server-administration.html#error-log" title="5.2.2 The Error Log">error
          log</a>. Otherwise, you see information about only the last
          deadlock, using the <code class="literal">SHOW ENGINE INNODB
          STATUS</code> command. An occasional
          <code class="literal">InnoDB</code> deadlock is not necessarily an
          issue, because <code class="literal">InnoDB</code> detects the condition
          immediately, and rolls back one of the transactions
          automatically. You might use this option to troubleshoot why
          deadlocks are happening if an application does not have
          appropriate error-handling logic to detect the rollback and
          retry its operation. A large number of deadlocks might
          indicate the need to restructure transactions that issue
          <a class="link" href="glossary.html#glos_dml" title="DML">DML</a> or <code class="literal">SELECT ... FOR
          UPDATE</code> statements for multiple tables, so that each
          transaction accesses the tables in the same order, thus
          avoiding the deadlock condition.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_purge_batch_size"></a>
          <a class="indexterm" name="idm140644105107360"></a>

          <a class="indexterm" name="idm140644105106320"></a>

          <code class="literal">innodb_purge_batch_size</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_purge_batch_size" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_purge_batch_size=#</code></td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>System Variable</strong></span></td><td><span class="bold"><strong>Name</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_purge_batch_size">innodb_purge_batch_size</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="2">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="2">Yes</td></tr><tr><td scope="row" rowspan="4"><span class="bold"><strong>Permitted Values</strong></span></td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">integer</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">300</code></td></tr><tr><td scope="row"><span class="bold"><strong>Min Value</strong></span></td><td colspan="2"><code class="literal">1</code></td></tr><tr><td scope="row"><span class="bold"><strong>Max Value</strong></span></td><td colspan="2"><code class="literal">5000</code></td></tr></tbody></table>
</div>
<p>
          The granularity of changes, expressed in units of
          <a class="link" href="glossary.html#glos_redo_log" title="redo log">redo log</a> records, that
          trigger a <a class="link" href="glossary.html#glos_purge" title="purge">purge</a> operation,
          flushing the changed <a class="link" href="glossary.html#glos_buffer_pool" title="buffer pool">buffer
          pool</a> blocks to disk. This option is intended for tuning
          performance in combination with the setting
          <code class="literal">innodb_purge_threads=<em class="replaceable"><code>n</code></em></code>,
          and typical users do not need to modify it.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_purge_threads"></a>
          <a class="indexterm" name="idm140644105075264"></a>

          <a class="indexterm" name="idm140644105074224"></a>

          <code class="literal">innodb_purge_threads</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_purge_threads" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_purge_threads=#</code></td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>System Variable</strong></span></td><td><span class="bold"><strong>Name</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_purge_threads">innodb_purge_threads</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="2">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="2">No</td></tr><tr><td scope="row" rowspan="4"><span class="bold"><strong>Permitted Values</strong></span> (&lt;= 5.7.7)</td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">integer</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">1</code></td></tr><tr><td scope="row"><span class="bold"><strong>Min Value</strong></span></td><td colspan="2"><code class="literal">1</code></td></tr><tr><td scope="row"><span class="bold"><strong>Max Value</strong></span></td><td colspan="2"><code class="literal">32</code></td></tr><tr><td scope="row" rowspan="4"><span class="bold"><strong>Permitted Values</strong></span> (&gt;= 5.7.8)</td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">integer</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">4</code></td></tr><tr><td scope="row"><span class="bold"><strong>Min Value</strong></span></td><td colspan="2"><code class="literal">1</code></td></tr><tr><td scope="row"><span class="bold"><strong>Max Value</strong></span></td><td colspan="2"><code class="literal">32</code></td></tr></tbody></table>
</div>
<p>
          The number of background threads devoted to the InnoDB
          <a class="link" href="glossary.html#glos_purge" title="purge">purge</a> operation. A minimum
          value of 1 signifies that the purge operation is always
          performed by background threads, never as part of the
          <a class="link" href="glossary.html#glos_master_thread" title="master thread">master thread</a>.
          Running the purge operation in one or more background threads
          helps reduce internal contention within InnoDB, improving
          scalability. Increasing the value to greater than 1 creates
          that many separate purge threads, which can improve efficiency
          on systems where <a class="link" href="glossary.html#glos_dml" title="DML">DML</a>
          operations are performed on multiple tables. The maximum is
          32.
        </p><p>
          The <code class="literal">innodb_purge_threads</code> default value was
          changed from 1 to 4 in MySQL 5.7.8.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_purge_rseg_truncate_frequency"></a>
          <a class="indexterm" name="idm140644105032336"></a>

          <a class="indexterm" name="idm140644105031296"></a>

          <code class="literal">innodb_purge_rseg_truncate_frequency</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_purge_rseg_truncate_frequency" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Introduced</strong></span></td><td colspan="3">5.7.5</td></tr><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_purge_rseg_truncate_frequency=#</code></td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>System Variable</strong></span></td><td><span class="bold"><strong>Name</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_purge_rseg_truncate_frequency">innodb_purge_rseg_truncate_frequency</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="2">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="2">Yes</td></tr><tr><td scope="row" rowspan="4"><span class="bold"><strong>Permitted Values</strong></span></td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">integer</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">128</code></td></tr><tr><td scope="row"><span class="bold"><strong>Min Value</strong></span></td><td colspan="2"><code class="literal">1</code></td></tr><tr><td scope="row"><span class="bold"><strong>Max Value</strong></span></td><td colspan="2"><code class="literal">128</code></td></tr></tbody></table>
</div>
<p>
          <code class="literal">innodb_purge_rseg_truncate_frequency</code>
          defines the frequency with which the purge system frees
          rollback segments. An undo tablespace cannot be truncated
          until its rollback segments are freed. Normally, the purge
          system frees rollback segments once every 128 times that purge
          is invoked. Reducing the
          <code class="literal">innodb_purge_rseg_truncate_frequency</code> value
          increases the frequency with which the purge thread frees
          rollback segments. The default value is 128.
        </p><p>
          <code class="literal">innodb_purge_rseg_truncate_frequency</code> is
          intended for use with
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_undo_log_truncate"><code class="literal">innodb_undo_log_truncate</code></a>. For
          more information, see
          <a class="xref" href="innodb-storage-engine.html#truncate-undo-tablespace" title="14.4.8 Truncating Undo Logs That Reside in Undo Tablespaces">Section 14.4.8, “Truncating Undo Logs That Reside in Undo Tablespaces”</a>.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_random_read_ahead"></a>
          <a class="indexterm" name="idm140644104996992"></a>

          <code class="literal">innodb_random_read_ahead</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_random_read_ahead" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_random_read_ahead=#</code></td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>System Variable</strong></span></td><td><span class="bold"><strong>Name</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_random_read_ahead">innodb_random_read_ahead</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="2">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="2">Yes</td></tr><tr><td scope="row" rowspan="2"><span class="bold"><strong>Permitted Values</strong></span></td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">boolean</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">OFF</code></td></tr></tbody></table>
</div>
<p>
          Enables the random
          <a class="link" href="glossary.html#glos_read_ahead" title="read-ahead">read-ahead</a> technique
          for optimizing <code class="literal">InnoDB</code> I/O.
        </p><p>
          See <a class="xref" href="innodb-storage-engine.html#innodb-performance-read_ahead" title="14.3.3.1 Configuring InnoDB Buffer Pool Prefetching (Read-Ahead)">Section 14.3.3.1, “Configuring InnoDB Buffer Pool Prefetching (Read-Ahead)”</a> for
          details about the performance considerations for the different
          types of read-ahead requests. For general I/O tuning advice,
          see <a class="xref" href="optimization.html#optimizing-innodb-diskio" title="8.5.8 Optimizing InnoDB Disk I/O">Section 8.5.8, “Optimizing InnoDB Disk I/O”</a>.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_read_ahead_threshold"></a>
          <a class="indexterm" name="idm140644104970992"></a>

          <a class="indexterm" name="idm140644104969888"></a>

          <code class="literal">innodb_read_ahead_threshold</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_read_ahead_threshold" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_read_ahead_threshold=#</code></td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>System Variable</strong></span></td><td><span class="bold"><strong>Name</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_read_ahead_threshold">innodb_read_ahead_threshold</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="2">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="2">Yes</td></tr><tr><td scope="row" rowspan="4"><span class="bold"><strong>Permitted Values</strong></span></td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">integer</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">56</code></td></tr><tr><td scope="row"><span class="bold"><strong>Min Value</strong></span></td><td colspan="2"><code class="literal">0</code></td></tr><tr><td scope="row"><span class="bold"><strong>Max Value</strong></span></td><td colspan="2"><code class="literal">64</code></td></tr></tbody></table>
</div>
<p>
          Controls the sensitivity of linear
          <a class="link" href="glossary.html#glos_read_ahead" title="read-ahead">read-ahead</a> that
          <code class="literal">InnoDB</code> uses to prefetch pages into the
          <a class="link" href="glossary.html#glos_buffer_pool" title="buffer pool">buffer pool</a>. If
          <code class="literal">InnoDB</code> reads at least
          <code class="literal">innodb_read_ahead_threshold</code> pages
          sequentially from an <a class="link" href="glossary.html#glos_extent" title="extent">extent</a>
          (64 pages), it initiates an asynchronous read for the entire
          following extent. The permissible range of values is 0 to 64.
          A value of 0 disables read-ahead. For the default of 56,
          <code class="literal">InnoDB</code> must read at least 56 pages
          sequentially from an extent to initiate an asynchronous read
          for the following extent.
        </p><p>
          Knowing how many pages are read through this read-ahead
          mechanism, and how many of them are evicted from the buffer
          pool without ever being accessed, can be useful to help
          fine-tune the
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_read_ahead_threshold"><code class="literal">innodb_read_ahead_threshold</code></a>
          parameter. As of MySQL 5.5,
          <a class="link" href="sql-syntax.html#show-engine" title="13.7.5.15 SHOW ENGINE Syntax"><code class="literal">SHOW ENGINE
          INNODB STATUS</code></a> output displays counter information
          from the
          <a class="link" href="server-administration.html#statvar_Innodb_buffer_pool_read_ahead"><code class="literal">Innodb_buffer_pool_read_ahead</code></a>
          and
          <a class="link" href="server-administration.html#statvar_Innodb_buffer_pool_read_ahead_evicted"><code class="literal">Innodb_buffer_pool_read_ahead_evicted</code></a>
          global status variables. These variables indicate the number
          of pages brought into the
          <a class="link" href="glossary.html#glos_buffer_pool" title="buffer pool">buffer pool</a> by
          read-ahead requests, and the number of such pages
          <a class="link" href="glossary.html#glos_eviction" title="eviction">evicted</a> from the buffer
          pool without ever being accessed respectively. These counters
          provide global values since the last server restart.
        </p><p>
          <code class="literal">SHOW ENGINE INNODB STATUS</code> also shows the
          rate at which the read-ahead pages are read in and the rate at
          which such pages are evicted without being accessed. The
          per-second averages are based on the statistics collected
          since the last invocation of <code class="literal">SHOW ENGINE INNODB
          STATUS</code> and are displayed in the <code class="literal">BUFFER POOL
          AND MEMORY</code> section of the output.
        </p><p>
          See <a class="xref" href="innodb-storage-engine.html#innodb-performance-read_ahead" title="14.3.3.1 Configuring InnoDB Buffer Pool Prefetching (Read-Ahead)">Section 14.3.3.1, “Configuring InnoDB Buffer Pool Prefetching (Read-Ahead)”</a> for more
          information. For general I/O tuning advice, see
          <a class="xref" href="optimization.html#optimizing-innodb-diskio" title="8.5.8 Optimizing InnoDB Disk I/O">Section 8.5.8, “Optimizing InnoDB Disk I/O”</a>.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_read_io_threads"></a>
          <a class="indexterm" name="idm140644104924112"></a>

          <a class="indexterm" name="idm140644104923072"></a>

          <code class="literal">innodb_read_io_threads</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_read_io_threads" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_read_io_threads=#</code></td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>System Variable</strong></span></td><td><span class="bold"><strong>Name</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_read_io_threads">innodb_read_io_threads</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="2">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="2">No</td></tr><tr><td scope="row" rowspan="4"><span class="bold"><strong>Permitted Values</strong></span></td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">integer</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">4</code></td></tr><tr><td scope="row"><span class="bold"><strong>Min Value</strong></span></td><td colspan="2"><code class="literal">1</code></td></tr><tr><td scope="row"><span class="bold"><strong>Max Value</strong></span></td><td colspan="2"><code class="literal">64</code></td></tr></tbody></table>
</div>
<p>
          The number of I/O threads for read operations in
          <code class="literal">InnoDB</code>. The default value is 4. Its
          counterpart for write threads is
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_write_io_threads"><code class="literal">innodb_write_io_threads</code></a>. See
          <a class="xref" href="innodb-storage-engine.html#innodb-performance-multiple_io_threads" title="14.3.7 Configuring the Number of Background InnoDB I/O Threads">Section 14.3.7, “Configuring the Number of Background InnoDB I/O Threads”</a> for
          more information. For general I/O tuning advice, see
          <a class="xref" href="optimization.html#optimizing-innodb-diskio" title="8.5.8 Optimizing InnoDB Disk I/O">Section 8.5.8, “Optimizing InnoDB Disk I/O”</a>.
</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
            On Linux systems, running multiple MySQL servers (typically
            more than 12) with default settings for
            <code class="literal">innodb_read_io_threads</code>,
            <a class="link" href="innodb-storage-engine.html#sysvar_innodb_write_io_threads"><code class="literal">innodb_write_io_threads</code></a>,
            and the Linux <code class="literal">aio-max-nr</code> setting can
            exceed system limits. Ideally, increase the
            <code class="literal">aio-max-nr</code> setting; as a workaround, you
            might reduce the settings for one or both of the MySQL
            configuration options.
</p>
</div>
</li><li class="listitem"><p><a name="sysvar_innodb_read_only"></a>
          <a class="indexterm" name="idm140644104887680"></a>

          <code class="literal">innodb_read_only</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_read_only" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_read_only=#</code></td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>System Variable</strong></span></td><td><span class="bold"><strong>Name</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_read_only">innodb_read_only</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="2">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="2">No</td></tr><tr><td scope="row" rowspan="2"><span class="bold"><strong>Permitted Values</strong></span></td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">boolean</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">OFF</code></td></tr></tbody></table>
</div>
<p>
          Starts the server in read-only mode. For distributing database
          applications or data sets on read-only media. Can also be used
          in data warehouses to share the same data directory between
          multiple instances. See
          <a class="xref" href="innodb-storage-engine.html#innodb-read-only-instance" title="14.3.2 Configuring InnoDB for Read-Only Operation">Section 14.3.2, “Configuring InnoDB for Read-Only Operation”</a> for usage
          instructions.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_replication_delay"></a>
          <a class="indexterm" name="idm140644104864352"></a>

          <a class="indexterm" name="idm140644104863248"></a>

          <code class="literal">innodb_replication_delay</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_replication_delay" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_replication_delay=#</code></td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>System Variable</strong></span></td><td><span class="bold"><strong>Name</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_replication_delay">innodb_replication_delay</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="2">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="2">Yes</td></tr><tr><td scope="row" rowspan="4"><span class="bold"><strong>Permitted Values</strong></span></td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">integer</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">0</code></td></tr><tr><td scope="row"><span class="bold"><strong>Min Value</strong></span></td><td colspan="2"><code class="literal">0</code></td></tr><tr><td scope="row"><span class="bold"><strong>Max Value</strong></span></td><td colspan="2"><code class="literal">4294967295</code></td></tr></tbody></table>
</div>
<p>
          The replication thread delay (in ms) on a slave server if
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_thread_concurrency"><code class="literal">innodb_thread_concurrency</code></a> is
          reached.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_rollback_on_timeout"></a>
          <a class="indexterm" name="idm140644104834544"></a>

          <a class="indexterm" name="idm140644104833440"></a>

          <code class="literal">innodb_rollback_on_timeout</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_rollback_on_timeout" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_rollback_on_timeout</code></td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>System Variable</strong></span></td><td><span class="bold"><strong>Name</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_rollback_on_timeout">innodb_rollback_on_timeout</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="2">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="2">No</td></tr><tr><td scope="row" rowspan="2"><span class="bold"><strong>Permitted Values</strong></span></td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">boolean</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">OFF</code></td></tr></tbody></table>
</div>
<p>
          In MySQL 5.7, <code class="literal">InnoDB</code>
          <a class="link" href="glossary.html#glos_rollback" title="rollback">rolls back</a> only the last
          statement on a transaction timeout by default. If
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_rollback_on_timeout"><code class="option">--innodb_rollback_on_timeout</code></a> is
          specified, a transaction timeout causes
          <code class="literal">InnoDB</code> to abort and roll back the entire
          transaction.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_rollback_segments"></a>
          <a class="indexterm" name="idm140644104807120"></a>

          <code class="literal">innodb_rollback_segments</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_rollback_segments" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_rollback_segments=#</code></td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>System Variable</strong></span></td><td><span class="bold"><strong>Name</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_rollback_segments">innodb_rollback_segments</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="2">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="2">Yes</td></tr><tr><td scope="row" rowspan="4"><span class="bold"><strong>Permitted Values</strong></span></td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">integer</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">128</code></td></tr><tr><td scope="row"><span class="bold"><strong>Min Value</strong></span></td><td colspan="2"><code class="literal">1</code></td></tr><tr><td scope="row"><span class="bold"><strong>Max Value</strong></span></td><td colspan="2"><code class="literal">128</code></td></tr></tbody></table>
</div>
<p>
          Defines how many of the
          <a class="link" href="glossary.html#glos_rollback_segment" title="rollback segment">rollback segments</a>
          in the <a class="link" href="glossary.html#glos_system_tablespace" title="system tablespace">system
          tablespace</a> are used for InnoDB
          <a class="link" href="glossary.html#glos_transaction" title="transaction">transactions</a>. This
          setting, while still valid, is replaced by
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_undo_logs"><code class="literal">innodb_undo_logs</code></a>.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_saved_page_number_debug"></a>
          <a class="indexterm" name="idm140644104776432"></a>

          <a class="indexterm" name="idm140644104775392"></a>

          <code class="literal">innodb_saved_page_number_debug</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_saved_page_number_debug" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_saved_page_number_debug=#</code></td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>System Variable</strong></span></td><td><span class="bold"><strong>Name</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_saved_page_number_debug">innodb_saved_page_number_debug</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="2">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="2">Yes</td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>Permitted Values</strong></span></td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">integer</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">0</code></td></tr><tr><td scope="row"><span class="bold"><strong>Max Value</strong></span></td><td colspan="2"><code class="literal">2**23-1</code></td></tr></tbody></table>
</div>
<p>
          Saves a page number. Setting the
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_fil_make_page_dirty_debug"><code class="literal">innodb_fil_make_page_dirty_debug</code></a>
          option dirties the page defined by
          <code class="literal">innodb_saved_page_number_debug</code>. The
          <code class="literal">innodb_saved_page_number_debug</code> option is
          only available if debugging support is compiled in using the
          <a class="link" href="installing.html#option_cmake_with_debug"><code class="option">WITH_DEBUG</code></a>
          <span class="command"><strong>CMake</strong></span> option.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_sort_buffer_size"></a>
          <a class="indexterm" name="idm140644104745632"></a>

          <code class="literal">innodb_sort_buffer_size</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_sort_buffer_size" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_sort_buffer_size=#</code></td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>System Variable</strong></span></td><td><span class="bold"><strong>Name</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_sort_buffer_size">innodb_sort_buffer_size</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="2">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="2">No</td></tr><tr><td scope="row" rowspan="4"><span class="bold"><strong>Permitted Values</strong></span></td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">integer</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">1048576</code></td></tr><tr><td scope="row"><span class="bold"><strong>Min Value</strong></span></td><td colspan="2"><code class="literal">65536</code></td></tr><tr><td scope="row"><span class="bold"><strong>Max Value</strong></span></td><td colspan="2"><code class="literal">67108864</code></td></tr></tbody></table>
</div>
<p>
          Specifies the size of sort buffers used for sorting data
          during creation of an <code class="literal">InnoDB</code> index. The
          size specified defines the amount of data filled in memory for
          an internal sort and written out to disk, which can be
          referred to as a <span class="quote">“<span class="quote">run</span>”</span>. During the merge phase,
          pairs of buffers of the specified size are <span class="quote">“<span class="quote">read
          in</span>”</span> and merged. The larger the setting, the fewer
          <span class="quote">“<span class="quote">runs</span>”</span> and merges there are, which is important
          to understand from a tuning perspective.
        </p><p>
          This sort area is only used for merge sorts during index
          creation, not during later index maintenance operations.
          Buffers are deallocated when index creation completes.
        </p><p>
          The value of this option also controls the amount by which the
          temporary log file is extended, to record concurrent DML
          during <a class="link" href="glossary.html#glos_online_ddl" title="online DDL">online DDL</a>
          operations.
        </p><p>
          Before this setting was made configurable, the size was
          hardcoded to 1048576 bytes (1MB), and that value remains the
          default.
        </p><p>
          During an <a class="link" href="sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a> or
          <a class="link" href="sql-syntax.html#create-table" title="13.1.18 CREATE TABLE Syntax"><code class="literal">CREATE TABLE</code></a> statement that
          creates an index, 3 buffers are allocated, each with a size
          defined by this option. Additionally, auxiliary pointers are
          allocated to rows in the sort buffer so that the sort can run
          on pointers (as opposed to moving rows during the sort
          operation).
        </p><p>
          For a typical sort operation, a formula such as this can be
          used to estimate memory consumption:
        </p><pre class="programlisting">
(6 /*FTS_NUM_AUX_INDEX*/ * (3*@@global.innodb_sort_buffer_size) 
+ 2 * number_of_partitions * number_of_secondary_indexes_created 
* (@@global.innodb_sort_buffer_size/dict_index_get_min_size(index)*/) 
* 8 /*64-bit sizeof *buf-&gt;tuples*/")
</pre><p>
          <span class="quote">“<span class="quote"><code class="literal">@@global.innodb_sort_buffer_size/dict_index_get_min_size(index)</code></span>”</span>
          indicates the maximum tuples held. <span class="quote">“<span class="quote"><code class="literal">2 *
          (@@global.innodb_sort_buffer_size/*dict_index_get_min_size(index)*/)
          * 8 /*64-bit size of *buf-&gt;tuples*/</code></span>”</span>
          indicates auxiliary pointers allocated.
</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
            For 32-bit, multiply by 4 instead of 8.
</p>
</div>
<p>
          For parallel sorts on a full-text index, multiply by the
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_ft_sort_pll_degree"><code class="literal">innodb_ft_sort_pll_degree</code></a>
          setting:
        </p><pre class="programlisting">
(6 /*FTS_NUM_AUX_INDEX*/ * @@global.innodb_ft_sort_pll_degree)
</pre></li><li class="listitem"><p><a name="sysvar_innodb_spin_wait_delay"></a>
          <a class="indexterm" name="idm140644104703056"></a>

          <a class="indexterm" name="idm140644104702016"></a>

          <code class="literal">innodb_spin_wait_delay</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_spin_wait_delay" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_spin_wait_delay=#</code></td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>System Variable</strong></span></td><td><span class="bold"><strong>Name</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_spin_wait_delay">innodb_spin_wait_delay</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="2">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="2">Yes</td></tr><tr><td scope="row" rowspan="4"><span class="bold"><strong>Permitted Values</strong></span></td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">integer</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">6</code></td></tr><tr><td scope="row"><span class="bold"><strong>Min Value</strong></span></td><td colspan="2"><code class="literal">0</code></td></tr><tr><td scope="row"><span class="bold"><strong>Max Value</strong></span></td><td colspan="2"><code class="literal">4294967295</code></td></tr></tbody></table>
</div>
<p>
          The maximum delay between polls for a
          <a class="link" href="glossary.html#glos_spin" title="spin">spin</a> lock. The low-level
          implementation of this mechanism varies depending on the
          combination of hardware and operating system, so the delay
          does not correspond to a fixed time interval. The default
          value is 6. See
          <a class="xref" href="innodb-storage-engine.html#innodb-performance-spin_lock_polling" title="14.3.9 Configuring Spin Lock Polling">Section 14.3.9, “Configuring Spin Lock Polling”</a> for
          more information.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_stats_auto_recalc"></a>
          <a class="indexterm" name="idm140644104672640"></a>

          <code class="literal">innodb_stats_auto_recalc</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_stats_auto_recalc" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_stats_auto_recalc=#</code></td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>System Variable</strong></span></td><td><span class="bold"><strong>Name</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_stats_auto_recalc">innodb_stats_auto_recalc</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="2">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="2">Yes</td></tr><tr><td scope="row" rowspan="2"><span class="bold"><strong>Permitted Values</strong></span></td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">boolean</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">ON</code></td></tr></tbody></table>
</div>
<p>
          Causes <code class="literal">InnoDB</code> to automatically recalculate
          <a class="link" href="glossary.html#glos_persistent_statistics" title="persistent statistics">persistent
          statistics</a> after the data in a table is changed
          substantially. The threshold value is currently 10% of the
          rows in the table. This setting applies to tables created when
          the <a class="link" href="innodb-storage-engine.html#sysvar_innodb_stats_persistent"><code class="literal">innodb_stats_persistent</code></a>
          option is enabled, or where the clause
          <code class="literal">STATS_PERSISTENT=1</code> is enabled by a
          <a class="link" href="sql-syntax.html#create-table" title="13.1.18 CREATE TABLE Syntax"><code class="literal">CREATE TABLE</code></a> or
          <a class="link" href="sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a> statement. The
          amount of data sampled to produce the statistics is controlled
          by the
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_stats_persistent_sample_pages"><code class="literal">innodb_stats_persistent_sample_pages</code></a>
          configuration option.
        </p><p>
          For additional information about
          <code class="literal">innodb_stats_auto_recalc</code>, see
          <a class="xref" href="innodb-storage-engine.html#innodb-persistent-stats" title="14.3.11.1 Configuring Persistent Optimizer Statistics Parameters">Section 14.3.11.1, “Configuring Persistent Optimizer Statistics Parameters”</a>.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_stats_method"></a>
          <a class="indexterm" name="idm140644104640528"></a>

          <a class="indexterm" name="idm140644104639488"></a>

          <code class="literal">innodb_stats_method</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_stats_method" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_stats_method=name</code></td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>System Variable</strong></span></td><td><span class="bold"><strong>Name</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_stats_method">innodb_stats_method</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="2">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="2">Yes</td></tr><tr><td scope="row" rowspan="5"><span class="bold"><strong>Permitted Values</strong></span></td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">enumeration</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">nulls_equal</code></td></tr><tr><td scope="row" rowspan="3" valign="top"><span class="bold"><strong>Valid Values</strong></span></td><td colspan="2"><code class="literal">nulls_equal</code></td></tr><tr><td scope="row" colspan="2"><code class="literal">nulls_unequal</code></td></tr><tr><td scope="row" colspan="2"><code class="literal">nulls_ignored</code></td></tr></tbody></table>
</div>
<p>
          How the server treats <code class="literal">NULL</code> values when
          collecting <a class="link" href="glossary.html#glos_statistics" title="statistics">statistics</a>
          about the distribution of index values for
          <code class="literal">InnoDB</code> tables. This variable has three
          possible values, <code class="literal">nulls_equal</code>,
          <code class="literal">nulls_unequal</code>, and
          <code class="literal">nulls_ignored</code>. For
          <code class="literal">nulls_equal</code>, all <code class="literal">NULL</code>
          index values are considered equal and form a single value
          group that has a size equal to the number of
          <code class="literal">NULL</code> values. For
          <code class="literal">nulls_unequal</code>, <code class="literal">NULL</code>
          values are considered unequal, and each
          <code class="literal">NULL</code> forms a distinct value group of size
          1. For <code class="literal">nulls_ignored</code>,
          <code class="literal">NULL</code> values are ignored.
        </p><p>
          The method that is used for generating table statistics
          influences how the optimizer chooses indexes for query
          execution, as described in <a class="xref" href="optimization.html#index-statistics" title="8.3.7 InnoDB and MyISAM Index Statistics Collection">Section 8.3.7, “InnoDB and MyISAM Index Statistics Collection”</a>.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_stats_on_metadata"></a>
          <a class="indexterm" name="idm140644104599248"></a>

          <a class="indexterm" name="idm140644104598144"></a>

          <code class="literal">innodb_stats_on_metadata</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_stats_on_metadata" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_stats_on_metadata</code></td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>System Variable</strong></span></td><td><span class="bold"><strong>Name</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_stats_on_metadata">innodb_stats_on_metadata</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="2">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="2">Yes</td></tr><tr><td scope="row" rowspan="2"><span class="bold"><strong>Permitted Values</strong></span></td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">boolean</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">OFF</code></td></tr></tbody></table>
</div>
<p>
          When this variable is enabled, <code class="literal">InnoDB</code>
          updates <a class="link" href="glossary.html#glos_statistics" title="statistics">statistics</a> when
          metadata statements such as <a class="link" href="sql-syntax.html#show-table-status" title="13.7.5.36 SHOW TABLE STATUS Syntax"><code class="literal">SHOW TABLE
          STATUS</code></a> or when accessing the
          <a class="link" href="information-schema.html#tables-table" title="21.24 The INFORMATION_SCHEMA TABLES Table"><code class="literal">INFORMATION_SCHEMA.TABLES</code></a> or
          <a class="link" href="information-schema.html#statistics-table" title="21.23 The INFORMATION_SCHEMA STATISTICS Table"><code class="literal">INFORMATION_SCHEMA.STATISTICS</code></a>
          tables. (These updates are similar to what happens for
          <a class="link" href="sql-syntax.html#analyze-table" title="13.7.2.1 ANALYZE TABLE Syntax"><code class="literal">ANALYZE TABLE</code></a>.) When disabled,
          <code class="literal">InnoDB</code> does not update statistics during
          these operations. Leaving this setting disabled can improve
          access speed for schemas that have a large number of tables or
          indexes. It can also improve the stability of
          <a class="link" href="glossary.html#glos_query_execution_plan" title="query execution plan">execution
          plans</a> for queries that involve
          <code class="literal">InnoDB</code> tables.
        </p><p>
          To change the setting, issue the statement <code class="literal">SET GLOBAL
          innodb_stats_on_metadata=<em class="replaceable"><code>mode</code></em></code>,
          where <code class="literal"><em class="replaceable"><code>mode</code></em></code> is
          either <code class="literal">ON</code> or <code class="literal">OFF</code> (or
          <code class="literal">1</code> or <code class="literal">0</code>). Changing this
          setting requires the <code class="literal">SUPER</code> privilege and
          immediately affects the operation of all connections.
        </p><p>
          This variable is disabled by default.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_stats_persistent"></a>
          <a class="indexterm" name="idm140644104559456"></a>

          <a class="indexterm" name="idm140644104558416"></a>

          <code class="literal">innodb_stats_persistent</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_stats_persistent" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_stats_persistent=setting</code></td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>System Variable</strong></span></td><td><span class="bold"><strong>Name</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_stats_persistent">innodb_stats_persistent</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="2">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="2">Yes</td></tr><tr><td scope="row" rowspan="6"><span class="bold"><strong>Permitted Values</strong></span></td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">boolean</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">ON</code></td></tr><tr><td scope="row" rowspan="4" valign="top"><span class="bold"><strong>Valid Values</strong></span></td><td colspan="2"><code class="literal">OFF</code></td></tr><tr><td scope="row" colspan="2"><code class="literal">ON</code></td></tr><tr><td scope="row" colspan="2"><code class="literal">0</code></td></tr><tr><td scope="row" colspan="2"><code class="literal">1</code></td></tr></tbody></table>
</div>
<p>
          Specifies whether <code class="literal">InnoDB</code> index statistics
          are persisted to disk. Otherwise, statistics may be
          recalculated frequently which can lead to variations in
          <a class="link" href="glossary.html#glos_query_execution_plan" title="query execution plan">query execution
          plans</a>. This setting is stored with each table when the
          table is created. You can set
          <code class="literal">innodb_stats_persistent</code> at the global level
          before creating a table, or use the
          <code class="literal">STATS_PERSISTENT</code> clause of the
          <a class="link" href="sql-syntax.html#create-table" title="13.1.18 CREATE TABLE Syntax"><code class="literal">CREATE TABLE</code></a> and
          <a class="link" href="sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a> statements to
          override the system-wide setting and configure persistent
          statistics for individual tables.
        </p><p>
          For more information about this option, see
          <a class="xref" href="innodb-storage-engine.html#innodb-persistent-stats" title="14.3.11.1 Configuring Persistent Optimizer Statistics Parameters">Section 14.3.11.1, “Configuring Persistent Optimizer Statistics Parameters”</a>.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_stats_persistent_sample_pages"></a>
          <a class="indexterm" name="idm140644104521520"></a>

          <code class="literal">innodb_stats_persistent_sample_pages</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_stats_persistent_sample_pages" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_stats_persistent_sample_pages=#</code></td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>System Variable</strong></span></td><td><span class="bold"><strong>Name</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_stats_persistent_sample_pages">innodb_stats_persistent_sample_pages</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="2">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="2">Yes</td></tr><tr><td scope="row" rowspan="2"><span class="bold"><strong>Permitted Values</strong></span></td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">integer</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">20</code></td></tr></tbody></table>
</div>
<p>
          The number of index <a class="link" href="glossary.html#glos_page" title="page">pages</a> to
          sample when estimating
          <a class="link" href="glossary.html#glos_cardinality" title="cardinality">cardinality</a> and other
          <a class="link" href="glossary.html#glos_statistics" title="statistics">statistics</a> for an
          indexed column, such as those calculated by
          <a class="link" href="sql-syntax.html#analyze-table" title="13.7.2.1 ANALYZE TABLE Syntax"><code class="literal">ANALYZE TABLE</code></a>. Increasing the
          value improves the accuracy of index statistics, which can
          improve the <a class="link" href="glossary.html#glos_query_execution_plan" title="query execution plan">query
          execution plan</a>, at the expense of increased I/O during
          the execution of <a class="link" href="sql-syntax.html#analyze-table" title="13.7.2.1 ANALYZE TABLE Syntax"><code class="literal">ANALYZE TABLE</code></a>
          for an <code class="literal">InnoDB</code> table. For additional
          information, see <a class="xref" href="innodb-storage-engine.html#innodb-persistent-stats" title="14.3.11.1 Configuring Persistent Optimizer Statistics Parameters">Section 14.3.11.1, “Configuring Persistent Optimizer Statistics Parameters”</a>.
</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
            Setting a high value for
            <code class="literal">innodb_stats_persistent_sample_pages</code>
            could result in lengthy <a class="link" href="sql-syntax.html#analyze-table" title="13.7.2.1 ANALYZE TABLE Syntax"><code class="literal">ANALYZE
            TABLE</code></a> execution time. To estimate the number of
            database pages that will be accessed, see
            <a class="xref" href="innodb-storage-engine.html#innodb-analyze-table-complexity" title="14.3.11.3 Estimating ANALYZE TABLE Complexity for InnoDB Tables">Section 14.3.11.3, “Estimating ANALYZE TABLE Complexity for InnoDB Tables”</a>.
</p>
</div>
<p>
          This option only applies when the
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_stats_persistent"><code class="literal">innodb_stats_persistent</code></a>
          setting is turned on for a table; when that option is turned
          off for a table, the
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_stats_transient_sample_pages"><code class="literal">innodb_stats_transient_sample_pages</code></a>
          setting applies instead.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_stats_sample_pages"></a>
          <a class="indexterm" name="idm140644104484672"></a>

          <a class="indexterm" name="idm140644104483568"></a>

          <code class="literal">innodb_stats_sample_pages</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_stats_sample_pages" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Deprecated</strong></span></td><td colspan="3">5.6.3</td></tr><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_stats_sample_pages=#</code></td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>System Variable</strong></span></td><td><span class="bold"><strong>Name</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_stats_sample_pages">innodb_stats_sample_pages</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="2">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="2">Yes</td></tr><tr><td scope="row" rowspan="4"><span class="bold"><strong>Permitted Values</strong></span></td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">integer</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">8</code></td></tr><tr><td scope="row"><span class="bold"><strong>Min Value</strong></span></td><td colspan="2"><code class="literal">1</code></td></tr><tr><td scope="row"><span class="bold"><strong>Max Value</strong></span></td><td colspan="2"><code class="literal">2**64-1</code></td></tr></tbody></table>
</div>
<p>
          Deprecated, use
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_stats_transient_sample_pages"><code class="literal">innodb_stats_transient_sample_pages</code></a>
          instead.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_stats_transient_sample_pages"></a>
          <a class="indexterm" name="idm140644104452992"></a>

          <code class="literal">innodb_stats_transient_sample_pages</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_stats_transient_sample_pages" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_stats_transient_sample_pages=#</code></td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>System Variable</strong></span></td><td><span class="bold"><strong>Name</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_stats_transient_sample_pages">innodb_stats_transient_sample_pages</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="2">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="2">Yes</td></tr><tr><td scope="row" rowspan="2"><span class="bold"><strong>Permitted Values</strong></span></td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">integer</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">8</code></td></tr></tbody></table>
</div>
<p>
          The number of index <a class="link" href="glossary.html#glos_page" title="page">pages</a> to
          sample when estimating
          <a class="link" href="glossary.html#glos_cardinality" title="cardinality">cardinality</a> and other
          <a class="link" href="glossary.html#glos_statistics" title="statistics">statistics</a> for an
          indexed column, such as those calculated by
          <a class="link" href="sql-syntax.html#analyze-table" title="13.7.2.1 ANALYZE TABLE Syntax"><code class="literal">ANALYZE TABLE</code></a>. The default
          value is 8. Increasing the value improves the accuracy of
          index statistics, which can improve the
          <a class="link" href="glossary.html#glos_query_execution_plan" title="query execution plan">query execution
          plan</a>, at the expense of increased I/O when opening an
          <code class="literal">InnoDB</code> table or recalculating statistics.
          For additional information, see
          <a class="xref" href="innodb-storage-engine.html#innodb-statistics-estimation" title="14.3.11.2 Configuring Non-Persistent Optimizer Statistics Parameters">Section 14.3.11.2, “Configuring Non-Persistent Optimizer Statistics Parameters”</a>.
</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
            Setting a high value for
            <code class="literal">innodb_stats_transient_sample_pages</code> could
            result in lengthy <a class="link" href="sql-syntax.html#analyze-table" title="13.7.2.1 ANALYZE TABLE Syntax"><code class="literal">ANALYZE
            TABLE</code></a> execution time. To estimate the number of
            database pages that will be accessed, see
            <a class="xref" href="innodb-storage-engine.html#innodb-analyze-table-complexity" title="14.3.11.3 Estimating ANALYZE TABLE Complexity for InnoDB Tables">Section 14.3.11.3, “Estimating ANALYZE TABLE Complexity for InnoDB Tables”</a>.
</p>
</div>
<p>
          This option only applies when the
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_stats_persistent"><code class="literal">innodb_stats_persistent</code></a>
          setting is turned off for a table; when this option is turned
          on for a table, the
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_stats_persistent_sample_pages"><code class="literal">innodb_stats_persistent_sample_pages</code></a>
          setting applies instead. Takes the place of the
          <code class="literal">innodb_stats_sample_pages</code> option. See
          <a class="xref" href="innodb-storage-engine.html#innodb-statistics-estimation" title="14.3.11.2 Configuring Non-Persistent Optimizer Statistics Parameters">Section 14.3.11.2, “Configuring Non-Persistent Optimizer Statistics Parameters”</a> for more
          information.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_status_output"></a>
          <a class="indexterm" name="idm140644104415792"></a>

          <a class="indexterm" name="idm140644104414752"></a>

          <code class="literal">innodb_status_output</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_status_output" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Introduced</strong></span></td><td colspan="3">5.7.4</td></tr><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_status_output</code></td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>System Variable</strong></span></td><td><span class="bold"><strong>Name</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_status_output">innodb_status_output</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="2">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="2">Yes</td></tr><tr><td scope="row" rowspan="2"><span class="bold"><strong>Permitted Values</strong></span></td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">boolean</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">OFF</code></td></tr></tbody></table>
</div>
<p>
          Enables or disables periodic output for the standard
          <code class="literal">InnoDB</code> Monitor. Also used in combination
          with
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_status_output_locks"><code class="literal">innodb_status_output_locks</code></a> to
          enable or disable periodic output for the
          <code class="literal">InnoDB</code> Lock Monitor. See
          <a class="xref" href="innodb-storage-engine.html#innodb-monitors" title="14.14 InnoDB Monitors">Section 14.14, “InnoDB Monitors”</a> for additional information.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_status_output_locks"></a>
          <a class="indexterm" name="idm140644104386464"></a>

          <a class="indexterm" name="idm140644104385392"></a>

          <code class="literal">innodb_status_output_locks</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_status_output_locks" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Introduced</strong></span></td><td colspan="3">5.7.4</td></tr><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_status_output_locks</code></td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>System Variable</strong></span></td><td><span class="bold"><strong>Name</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_status_output_locks">innodb_status_output_locks</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="2">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="2">Yes</td></tr><tr><td scope="row" rowspan="2"><span class="bold"><strong>Permitted Values</strong></span></td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">boolean</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">OFF</code></td></tr></tbody></table>
</div>
<p>
          Enables or disables the <code class="literal">InnoDB</code> Lock
          Monitor. When enabled, the <code class="literal">InnoDB</code> Lock
          Monitor prints additional information about locks in
          <code class="literal">SHOW ENGINE INNODB STATUS</code> output and in
          periodic output printed to the MySQL error log. Periodic
          output for the <code class="literal">InnoDB</code> Lock Monitor is
          printed as part of the standard <code class="literal">InnoDB</code>
          Monitor output. The standard <code class="literal">InnoDB</code> Monitor
          must therefore be enabled for the <code class="literal">InnoDB</code>
          Lock Monitor to print data to the MySQL error log
          periodically. See <a class="xref" href="innodb-storage-engine.html#innodb-monitors" title="14.14 InnoDB Monitors">Section 14.14, “InnoDB Monitors”</a> for more
          information.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_strict_mode"></a>
          <a class="indexterm" name="idm140644104354464"></a>

          <a class="indexterm" name="idm140644104353456"></a>

          <code class="literal">innodb_strict_mode</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_strict_mode" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_strict_mode=#</code></td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>System Variable</strong></span></td><td><span class="bold"><strong>Name</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_strict_mode">innodb_strict_mode</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="2">Global, Session</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="2">Yes</td></tr><tr><td scope="row" rowspan="2"><span class="bold"><strong>Permitted Values</strong></span> (&lt;= 5.7.6)</td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">boolean</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">OFF</code></td></tr><tr><td scope="row" rowspan="2"><span class="bold"><strong>Permitted Values</strong></span> (&gt;= 5.7.7)</td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">boolean</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">ON</code></td></tr></tbody></table>
</div>
<p>
          When <code class="literal">innodb_strict_mode</code> is
          <code class="literal">ON</code>, <code class="literal">InnoDB</code> returns
          errors rather than warnings for certain conditions. As of
          MySQL 5.7.7, the default value is <code class="literal">ON</code>.
        </p><p>
          <a class="link" href="glossary.html#glos_strict_mode" title="strict mode">Strict mode</a> helps
          guard against ignored typos and syntax errors in SQL, or other
          unintended consequences of various combinations of operational
          modes and SQL statements. When
          <code class="literal">innodb_strict_mode</code> is
          <code class="literal">ON</code>, <code class="literal">InnoDB</code> raises error
          conditions in certain cases, rather than issuing a warning and
          processing the specified statement (perhaps with unintended
          behavior). This is analogous to
          <a class="link" href="server-administration.html#sql-mode" title="5.1.7 Server SQL Modes"><code class="literal">sql_mode</code></a> in
          MySQL, which controls what SQL syntax MySQL accepts, and
          determines whether it silently ignores errors, or validates
          input syntax and data values.
        </p><p>
          The <code class="literal">innodb_strict_mode</code> setting affects the
          handling of syntax errors for <a class="link" href="sql-syntax.html#create-table" title="13.1.18 CREATE TABLE Syntax"><code class="literal">CREATE
          TABLE</code></a>, <a class="link" href="sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a>,
          <a class="link" href="sql-syntax.html#create-index" title="13.1.14 CREATE INDEX Syntax"><code class="literal">CREATE INDEX</code></a>, and
          <a class="link" href="sql-syntax.html#optimize-table" title="13.7.2.4 OPTIMIZE TABLE Syntax"><code class="literal">OPTIMIZE TABLE</code></a> statements.
          <code class="literal">innodb_strict_mode</code> also enables a record
          size check, so that an <code class="literal">INSERT</code> or
          <code class="literal">UPDATE</code> never fails due to the record being
          too large for the selected page size.
        </p><p>
          Oracle recommends enabling
          <code class="literal">innodb_strict_mode</code> when using
          <code class="literal">ROW_FORMAT</code> and
          <code class="literal">KEY_BLOCK_SIZE</code> clauses on
          <a class="link" href="sql-syntax.html#create-table" title="13.1.18 CREATE TABLE Syntax"><code class="literal">CREATE TABLE</code></a>,
          <a class="link" href="sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a>, and
          <a class="link" href="sql-syntax.html#create-index" title="13.1.14 CREATE INDEX Syntax"><code class="literal">CREATE INDEX</code></a> statements. When
          <code class="literal">innodb_strict_mode</code> is
          <code class="literal">OFF</code>, <code class="literal">InnoDB</code> ignores
          conflicting clauses and creates the table or index, with only
          a warning in the message log. The resulting table might have
          different behavior than you intended, such as having no
          compression when you tried to create a compressed table. When
          <code class="literal">innodb_strict_mode</code> is
          <code class="literal">ON</code>, such problems generate an immediate
          error and the table or index is not created, avoiding a
          troubleshooting session later.
        </p><p>
          You can turn <code class="literal">innodb_strict_mode</code>
          <code class="literal">ON</code> or <code class="literal">OFF</code> on the command
          line when you start <code class="literal">mysqld</code>, or in the
          <a class="link" href="glossary.html#glos_configuration_file" title="configuration file">configuration
          file</a> <code class="filename">my.cnf</code> or
          <code class="filename">my.ini</code>. You can also enable or disable
          <code class="literal">innodb_strict_mode</code> at runtime with the
          statement <code class="literal">SET [GLOBAL|SESSION]
          innodb_strict_mode=<em class="replaceable"><code>mode</code></em></code>,
          where <code class="literal"><em class="replaceable"><code>mode</code></em></code> is
          either <code class="literal">ON</code> or <code class="literal">OFF</code>.
          Changing the <code class="literal">GLOBAL</code> setting requires the
          <code class="literal">SUPER</code> privilege and affects the operation
          of all clients that subsequently connect. Any client can
          change the <code class="literal">SESSION</code> setting for
          <code class="literal">innodb_strict_mode</code>, and the setting affects
          only that client.
        </p><p>
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_strict_mode"><code class="literal">innodb_strict_mode</code></a> is not
          applicable to general tablespaces. Tablespace management rules
          for general tablespaces are strictly enforced independently of
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_strict_mode"><code class="literal">innodb_strict_mode</code></a>. For more
          information, see <a class="xref" href="sql-syntax.html#create-tablespace" title="13.1.19 CREATE TABLESPACE Syntax">Section 13.1.19, “CREATE TABLESPACE Syntax”</a>.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_support_xa"></a>
          <a class="indexterm" name="idm140644104281616"></a>

          <a class="indexterm" name="idm140644104280576"></a>

          <a class="indexterm" name="idm140644104279088"></a>

          <code class="literal">innodb_support_xa</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_support_xa" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Deprecated</strong></span></td><td colspan="3">5.7.10</td></tr><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_support_xa</code></td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>System Variable</strong></span></td><td><span class="bold"><strong>Name</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_support_xa">innodb_support_xa</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="2">Global, Session</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="2">Yes</td></tr><tr><td scope="row" rowspan="2"><span class="bold"><strong>Permitted Values</strong></span></td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">boolean</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">TRUE</code></td></tr></tbody></table>
</div>
<p>
          Enables <code class="literal">InnoDB</code> support for two-phase commit
          in <a class="link" href="glossary.html#glos_xa" title="XA">XA</a> transactions, causing an
          extra disk flush for transaction preparation. This setting is
          the default. The XA mechanism is used internally and is
          essential for any server that has its binary log turned on and
          is accepting changes to its data from more than one thread. If
          you turn it off, transactions can be written to the binary log
          in a different order from the one in which the live database
          is committing them. This can produce different data when the
          binary log is replayed in disaster recovery or on a
          replication slave. Do not turn it off on a replication master
          server unless you have an unusual setup where only one thread
          is able to change data.
        </p><p>
          <code class="literal">innodb_support_xa</code> is deprecated and will be
          removed in a future MySQL release. <code class="literal">InnoDB</code>
          support for two-phase commit in XA transactions is always
          enabled as of MySQL 5.7.10. Disabling
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_support_xa"><code class="literal">innodb_support_xa</code></a> is no
          longer permitted as it makes replication unsafe and prevents
          performance gains associated with binary log group commit.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_sync_array_size"></a>
          <a class="indexterm" name="idm140644104249024"></a>

          <code class="literal">innodb_sync_array_size</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_sync_array_size" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_sync_array_size=#</code></td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>System Variable</strong></span></td><td><span class="bold"><strong>Name</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_sync_array_size">innodb_sync_array_size</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="2">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="2">No</td></tr><tr><td scope="row" rowspan="4"><span class="bold"><strong>Permitted Values</strong></span></td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">integer</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">1</code></td></tr><tr><td scope="row"><span class="bold"><strong>Min Value</strong></span></td><td colspan="2"><code class="literal">1</code></td></tr><tr><td scope="row"><span class="bold"><strong>Max Value</strong></span></td><td colspan="2"><code class="literal">1024</code></td></tr></tbody></table>
</div>
<p>
          Splits an internal data structure used to coordinate threads,
          for higher concurrency in workloads with large numbers of
          waiting threads. This setting must be configured when the
          MySQL instance is starting up, and cannot be changed
          afterward. Increasing this option value is recommended for
          workloads that frequently produce a large number of waiting
          threads, typically greater than 768.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_sync_spin_loops"></a>
          <a class="indexterm" name="idm140644104221744"></a>

          <a class="indexterm" name="idm140644104220704"></a>

          <code class="literal">innodb_sync_spin_loops</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_sync_spin_loops" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_sync_spin_loops=#</code></td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>System Variable</strong></span></td><td><span class="bold"><strong>Name</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_sync_spin_loops">innodb_sync_spin_loops</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="2">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="2">Yes</td></tr><tr><td scope="row" rowspan="4"><span class="bold"><strong>Permitted Values</strong></span></td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">integer</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">30</code></td></tr><tr><td scope="row"><span class="bold"><strong>Min Value</strong></span></td><td colspan="2"><code class="literal">0</code></td></tr><tr><td scope="row"><span class="bold"><strong>Max Value</strong></span></td><td colspan="2"><code class="literal">4294967295</code></td></tr></tbody></table>
</div>
<p>
          The number of times a thread waits for an
          <code class="literal">InnoDB</code> mutex to be freed before the thread
          is suspended. The default value is 30.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_sync_debug"></a>
          <a class="indexterm" name="idm140644104192512"></a>

          <a class="indexterm" name="idm140644104191440"></a>

          <code class="literal">innodb_sync_debug</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_sync_debug" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Introduced</strong></span></td><td colspan="3">5.7.8</td></tr><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_sync_debug=#</code></td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>System Variable</strong></span></td><td><span class="bold"><strong>Name</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_sync_debug">innodb_sync_debug</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="2">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="2">No</td></tr><tr><td scope="row" rowspan="2"><span class="bold"><strong>Permitted Values</strong></span></td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">boolean</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">OFF</code></td></tr></tbody></table>
</div>
<p>
          Enables sync debug checking for the <code class="literal">InnoDB</code>
          storage engine. This option is only available if debugging
          support is compiled in using the
          <a class="link" href="installing.html#option_cmake_with_debug"><code class="option">WITH_DEBUG</code></a>
          <span class="command"><strong>CMake</strong></span> option.
        </p><p>
          Prior to MySQL 5.7.8, enabling <code class="literal">InnoDB</code> sync
          debug checking required that the Debug Sync facility be
          enabled using the
          <a class="link" href="installing.html#option_cmake_enable_debug_sync"><code class="option">ENABLE_DEBUG_SYNC</code></a>
          <span class="command"><strong>CMake</strong></span> option. This requirement was removed
          in MYSQL 5.7.8 with the introduction of the
          <code class="literal">innodb_sync_debug</code> configuration option.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_table_locks"></a>
          <a class="indexterm" name="idm140644104160496"></a>

          <a class="indexterm" name="idm140644104159456"></a>

          <code class="literal">innodb_table_locks</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_table_locks" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_table_locks</code></td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>System Variable</strong></span></td><td><span class="bold"><strong>Name</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_table_locks">innodb_table_locks</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="2">Global, Session</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="2">Yes</td></tr><tr><td scope="row" rowspan="2"><span class="bold"><strong>Permitted Values</strong></span></td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">boolean</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">TRUE</code></td></tr></tbody></table>
</div>
<p>
          If <a class="link" href="server-administration.html#sysvar_autocommit"><code class="literal">autocommit = 0</code></a>,
          <code class="literal">InnoDB</code> honors <a class="link" href="sql-syntax.html#lock-tables" title="13.3.5 LOCK TABLES and UNLOCK TABLES Syntax"><code class="literal">LOCK
          TABLES</code></a>; MySQL does not return from <code class="literal">LOCK
          TABLES ... WRITE</code> until all other threads have
          released all their locks to the table. The default value of
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_table_locks"><code class="literal">innodb_table_locks</code></a> is 1,
          which means that <a class="link" href="sql-syntax.html#lock-tables" title="13.3.5 LOCK TABLES and UNLOCK TABLES Syntax"><code class="literal">LOCK TABLES</code></a>
          causes InnoDB to lock a table internally if
          <a class="link" href="server-administration.html#sysvar_autocommit"><code class="literal">autocommit = 0</code></a>.
        </p><p>
          In MySQL 5.7,
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_table_locks"><code class="literal">innodb_table_locks = 0</code></a> has no
          effect for tables locked explicitly with
          <a class="link" href="sql-syntax.html#lock-tables" title="13.3.5 LOCK TABLES and UNLOCK TABLES Syntax"><code class="literal">LOCK TABLES ...
          WRITE</code></a>. It does have an effect for tables locked for
          read or write by
          <a class="link" href="sql-syntax.html#lock-tables" title="13.3.5 LOCK TABLES and UNLOCK TABLES Syntax"><code class="literal">LOCK TABLES ...
          WRITE</code></a> implicitly (for example, through triggers) or
          by <a class="link" href="sql-syntax.html#lock-tables" title="13.3.5 LOCK TABLES and UNLOCK TABLES Syntax"><code class="literal">LOCK TABLES
          ... READ</code></a>.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_temp_data_file_path"></a>
          <a class="indexterm" name="idm140644104123184"></a>

          <a class="indexterm" name="idm140644104122080"></a>

          <code class="literal">innodb_temp_data_file_path</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_temp_data_file_path" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Introduced</strong></span></td><td colspan="3">5.7.1</td></tr><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_temp_data_file_path=file</code></td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>System Variable</strong></span></td><td><span class="bold"><strong>Name</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_temp_data_file_path">innodb_temp_data_file_path</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="2">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="2">No</td></tr><tr><td scope="row" rowspan="2"><span class="bold"><strong>Permitted Values</strong></span></td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">string</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">ibtmp1:12M:autoextend</code></td></tr></tbody></table>
</div>
<p>
          Specifies the path, file name, and file size for
          <code class="literal">InnoDB</code> temporary table tablespace data
          files. The full directory path for a file is formed by
          concatenating
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_data_home_dir"><code class="literal">innodb_data_home_dir</code></a> to the
          path specified by
          <code class="literal">innodb_temp_data_file_path</code>. File size is
          specified in KB, MB, or GB (1024MB) by appending
          <code class="literal">K</code>, <code class="literal">M</code>, or
          <code class="literal">G</code> to the size value. The sum of the sizes
          of the files must be slightly larger than 12MB. If you do not
          specify <code class="literal">innodb_temp_data_file_path</code>, the
          default behavior is to create a single auto-extending
          temporary table tablespace data file, slightly larger than
          12MB, named <code class="filename">ibtmp1</code>. The size limit of
          individual files is determined by your operating system. You
          can set the file size to more than 4GB on operating systems
          that support big files. Use of raw disk partitions for
          temporary table tablespace data files is not supported.
        </p><p>
          The name of a <code class="literal">InnoDB</code> temporary table
          tablespace data file cannot be the same as the name of a
          <code class="literal">InnoDB</code> data file. Any inability or error
          creating a temporary table tablespace data file is treated as
          fatal and server startup will be refused. The temporary table
          tablespace has a dynamically generated space ID, which can
          change on each server restart.
        </p><p>
          The <code class="literal">InnoDB</code> temporary table tablespace is
          shared by all non-compressed <code class="literal">InnoDB</code>
          temporary tables. Compressed <code class="literal">InnoDB</code>
          temporary tables reside in per-table tablespace files, which
          are located in the temporary file directory defined by
          <a class="link" href="server-administration.html#sysvar_tmpdir"><code class="literal">tmpdir</code></a>.
        </p><p>
          Metadata about active <code class="literal">InnoDB</code> temporary
          tables if found in the
          <a class="link" href="information-schema.html#innodb-temp-table-info-table" title="21.31.27 The INFORMATION_SCHEMA INNODB_TEMP_TABLE_INFO Table"><code class="literal">INFORMATION_SCHEMA.INNODB_TEMP_TABLE_INFO</code></a>.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_tmpdir"></a>
          <a class="indexterm" name="idm140644104081552"></a>

          <a class="indexterm" name="idm140644104080544"></a>

          <code class="literal">innodb_tmpdir</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_tmpdir" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Introduced</strong></span></td><td colspan="3">5.7.11</td></tr><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_tmpdir=path</code></td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>System Variable</strong></span></td><td><span class="bold"><strong>Name</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_tmpdir">innodb_tmpdir</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="2">Session</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="2">Yes</td></tr><tr><td scope="row" rowspan="2"><span class="bold"><strong>Permitted Values</strong></span></td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">directory name</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">NULL</code></td></tr></tbody></table>
</div>
<p>
          The <code class="literal">innodb_tmpdir</code> option is used to define
          an alternate directory for temporary files that are created
          during online <a class="link" href="sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a>
          operations.
        </p><p>
          A valid value is any directory path other than the MySQL data
          directory path. If the value is NULL (the default), temporary
          files are created in the location defined by the MySQL
          <a class="link" href="server-administration.html#sysvar_tmpdir"><code class="literal">tmpdir</code></a> option. If a directory
          is specified, existence of the directory and permissions are
          only checked when the <code class="literal">innodb_tmpdir</code> setting
          is is configured using a
          <a class="link" href="sql-syntax.html#set-statement" title="13.7.4 SET Syntax"><code class="literal">SET</code></a>
          statement. If a symlink is provided in a directory string, the
          symlink is resolved and stored as an absolute path. The path
          should not exceed 512 bytes. An online
          <a class="link" href="sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a> operation reports
          an error if <code class="literal">innodb_tmpdir</code> is set to an
          invalid directory. <code class="literal">innodb_tmpdir</code> overrides
          the MySQL <a class="link" href="server-administration.html#sysvar_tmpdir"><code class="literal">tmpdir</code></a> setting but
          only for online <a class="link" href="sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a>
          operations.
        </p><p>
          The <code class="literal">FILE</code> privilege is required to configure
          <code class="literal">innodb_tmpdir</code>.
        </p><p>
          The <code class="literal">innodb_tmpdir</code> option was introduced to
          help avoid overflowing a temporary file directory located on a
          <code class="literal">tmpfs</code> file system. Such overflows could
          occur as a result of large temporary files created during
          online <a class="link" href="sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a> operations.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_thread_concurrency"></a>
          <a class="indexterm" name="idm140644104039200"></a>

          <a class="indexterm" name="idm140644104038096"></a>

          <a class="indexterm" name="idm140644104036640"></a>

          <code class="literal">innodb_thread_concurrency</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_thread_concurrency" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_thread_concurrency=#</code></td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>System Variable</strong></span></td><td><span class="bold"><strong>Name</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_thread_concurrency">innodb_thread_concurrency</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="2">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="2">Yes</td></tr><tr><td scope="row" rowspan="4"><span class="bold"><strong>Permitted Values</strong></span></td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">integer</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">0</code></td></tr><tr><td scope="row"><span class="bold"><strong>Min Value</strong></span></td><td colspan="2"><code class="literal">0</code></td></tr><tr><td scope="row"><span class="bold"><strong>Max Value</strong></span></td><td colspan="2"><code class="literal">1000</code></td></tr></tbody></table>
</div>
<p>
          <code class="literal">InnoDB</code> tries to keep the number of
          operating system threads concurrently inside
          <code class="literal">InnoDB</code> less than or equal to the limit
          given by this variable (<code class="literal">InnoDB</code> uses
          operating system threads to process user transactions). Once
          the number of threads reaches this limit, additional threads
          are placed into a wait state within a <span class="quote">“<span class="quote">First In, First
          Out</span>”</span> (FIFO) queue for execution. Threads waiting for
          locks are not counted in the number of concurrently executing
          threads.
        </p><p>
          The range of this variable is 0 to 1000. A value of 0 (the
          default) is interpreted as infinite concurrency (no
          concurrency checking). Disabling thread concurrency checking
          enables <code class="literal">InnoDB</code> to create as many threads as
          it needs. A value of 0 also disables the <code class="literal">queries
          inside InnoDB</code> and <code class="literal">queries in queue
          counters</code> in the <code class="literal">ROW OPERATIONS</code>
          section of <code class="literal">SHOW ENGINE INNODB STATUS</code>
          output.
        </p><p>
          Consider setting this variable if your MySQL instance shares
          CPU resources with other applications, or if your workload or
          number of concurrent users is growing. The correct setting
          depends on workload, computing environment, and the version of
          MySQL that you are running. You will need to test a range of
          values to determine the setting that provides the best
          performance. <code class="literal">innodb_thread_concurrency</code> is a
          dynamic variable, which allows you to experiment with
          different settings on a live test system. If a particular
          setting performs poorly, you can quickly set
          <code class="literal">innodb_thread_concurrency</code> back to 0.
        </p><p>
          Use the following guidelines to help find and maintain an
          appropriate setting:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
              If the number of concurrent user threads for a workload is
              less than 64, set
              <code class="literal">innodb_thread_concurrency=0</code>.
            </p></li><li class="listitem"><p>
              If your workload is consistently heavy or occasionally
              spikes, start by setting
              <code class="literal">innodb_thread_concurrency=128</code>, and
              lowering the value to 96, 80, 64, and so on, until you
              find the number of threads that provides the best
              performance. For example, suppose your system typically
              has 40 to 50 users, but periodically the number increases
              to 60, 70, or even 200. You find that performance is
              stable at 80 concurrent users but starts to show a
              regression above this number. In this case, you would set
              <code class="literal">innodb_thread_concurrency=80</code> to avoid
              impacting performance.
            </p></li><li class="listitem"><p>
              If you do not want <code class="literal">InnoDB</code> to use more
              than a certain number of vCPUs for user threads (20 vCPUs
              for example), set
              <code class="literal">innodb_thread_concurrency</code> to this
              number (or possibly lower, depending on performance
              results). If your goal is to isolate MySQL from other
              applications, you may consider binding the
              <code class="literal">mysqld</code> process exclusively to the
              vCPUs. Be aware, however, that exclusive binding could
              result in non-optimal hardware usage if the
              <code class="literal">mysqld</code> process is not consistently
              busy. In this case, you might bind the
              <code class="literal">mysqld</code> process to the vCPUs but also
              allow other applications to use some or all of the vCPUs.
</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
                From an operating system perspective, using a resource
                management solution (if available) to manage how CPU
                time is shared among applications may be preferable to
                binding the <code class="literal">mysqld</code> process. For
                example, you could assign 90% of vCPU time to a given
                application while other critical process <span class="emphasis"><em>are
                not</em></span> running, and scale that value back to 40%
                when other critical processes <span class="emphasis"><em>are</em></span>
                running.
</p>
</div>
</li><li class="listitem"><p>
              <code class="literal">innodb_thread_concurrency</code> values that
              are too high can cause performance regression due to
              increased contention on system internals and resources.
            </p></li><li class="listitem"><p>
              In some cases, the optimal
              <code class="literal">innodb_thread_concurrency</code> setting can
              be smaller than the number of vCPUs.
            </p></li><li class="listitem"><p>
              Monitor and analyze your system regularly. Changes to
              workload, number of users, or computing environment may
              require that you adjust the
              <code class="literal">innodb_thread_concurrency</code> setting.
</p></li></ul>
</div>
<p>
          For related information, see
          <a class="xref" href="innodb-storage-engine.html#innodb-performance-thread_concurrency" title="14.3.6 Configuring Thread Concurrency for InnoDB">Section 14.3.6, “Configuring Thread Concurrency for InnoDB”</a>.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_trx_purge_view_update_only_debug"></a>
          <a class="indexterm" name="idm140644103979808"></a>

          <a class="indexterm" name="idm140644103978768"></a>

          <code class="literal">innodb_trx_purge_view_update_only_debug</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_trx_purge_view_update_only_debug" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_trx_purge_view_update_only_debug=#</code></td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>System Variable</strong></span></td><td><span class="bold"><strong>Name</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_trx_purge_view_update_only_debug">innodb_trx_purge_view_update_only_debug</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="2">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="2">Yes</td></tr><tr><td scope="row" rowspan="2"><span class="bold"><strong>Permitted Values</strong></span></td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">boolean</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">OFF</code></td></tr></tbody></table>
</div>
<p>
          Pauses purging of delete-marked records while allowing the
          purge view to be updated. This option artificially creates a
          situation in which the purge view is updated but purges have
          not yet been performed. This option is only available if
          debugging support is compiled in using the
          <a class="link" href="installing.html#option_cmake_with_debug"><code class="option">WITH_DEBUG</code></a>
          <span class="command"><strong>CMake</strong></span> option.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_trx_rseg_n_slots_debug"></a>
          <a class="indexterm" name="idm140644103953856"></a>

          <a class="indexterm" name="idm140644103952816"></a>

          <code class="literal">innodb_trx_rseg_n_slots_debug</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_trx_rseg_n_slots_debug" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_trx_rseg_n_slots_debug=#</code></td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>System Variable</strong></span></td><td><span class="bold"><strong>Name</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_trx_rseg_n_slots_debug">innodb_trx_rseg_n_slots_debug</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="2">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="2">Yes</td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>Permitted Values</strong></span></td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">integer</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">0</code></td></tr><tr><td scope="row"><span class="bold"><strong>Max Value</strong></span></td><td colspan="2"><code class="literal">1024</code></td></tr></tbody></table>
</div>
<p>
          Sets a debug flag that limits
          <code class="literal">TRX_RSEG_N_SLOTS</code> to a given value for the
          <code class="literal">trx_rsegf_undo_find_free</code> function which
          looks for a free slot for an undo log segment. This option is
          only available if debugging support is compiled in using the
          <a class="link" href="installing.html#option_cmake_with_debug"><code class="option">WITH_DEBUG</code></a>
          <span class="command"><strong>CMake</strong></span> option.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_thread_sleep_delay"></a>
          <a class="indexterm" name="idm140644103924304"></a>

          <a class="indexterm" name="idm140644103923200"></a>

          <code class="literal">innodb_thread_sleep_delay</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_thread_sleep_delay" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_thread_sleep_delay=#</code></td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>System Variable</strong></span></td><td><span class="bold"><strong>Name</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_thread_sleep_delay">innodb_thread_sleep_delay</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="2">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="2">Yes</td></tr><tr><td scope="row" rowspan="4"><span class="bold"><strong>Permitted Values</strong></span> (&gt;= 5.7.4)</td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">integer</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">10000</code></td></tr><tr><td scope="row"><span class="bold"><strong>Min Value</strong></span></td><td colspan="2"><code class="literal">0</code></td></tr><tr><td scope="row"><span class="bold"><strong>Max Value</strong></span></td><td colspan="2"><code class="literal">1000000</code></td></tr><tr><td scope="row" rowspan="4"><span class="bold"><strong>Permitted Values</strong></span> (32-bit platforms, &lt;= 5.7.3)</td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">integer</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">10000</code></td></tr><tr><td scope="row"><span class="bold"><strong>Min Value</strong></span></td><td colspan="2"><code class="literal">0</code></td></tr><tr><td scope="row"><span class="bold"><strong>Max Value</strong></span></td><td colspan="2"><code class="literal">4294967295</code></td></tr><tr><td scope="row" rowspan="4"><span class="bold"><strong>Permitted Values</strong></span> (64-bit platforms, &lt;= 5.7.3)</td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">integer</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">10000</code></td></tr><tr><td scope="row"><span class="bold"><strong>Min Value</strong></span></td><td colspan="2"><code class="literal">0</code></td></tr><tr><td scope="row"><span class="bold"><strong>Max Value</strong></span></td><td colspan="2"><code class="literal">18446744073709551615</code></td></tr></tbody></table>
</div>
<p>
          How long <code class="literal">InnoDB</code> threads sleep before
          joining the <code class="literal">InnoDB</code> queue, in microseconds.
          The default value is 10000. A value of 0 disables sleep. In
          MySQL 5.6.3 and higher, you can set the configuration option
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_adaptive_max_sleep_delay"><code class="literal">innodb_adaptive_max_sleep_delay</code></a>
          to the highest value you would allow for
          <code class="literal">innodb_thread_sleep_delay</code>, and InnoDB
          automatically adjusts
          <code class="literal">innodb_thread_sleep_delay</code> up or down
          depending on the current thread-scheduling activity. This
          dynamic adjustment helps the thread scheduling mechanism to
          work smoothly during times when the system is lightly loaded
          and when it is operating near full capacity.
        </p><p>
          For more information, see
          <a class="xref" href="innodb-storage-engine.html#innodb-performance-thread_concurrency" title="14.3.6 Configuring Thread Concurrency for InnoDB">Section 14.3.6, “Configuring Thread Concurrency for InnoDB”</a>.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_undo_directory"></a>
          <a class="indexterm" name="idm140644103869408"></a>

          <code class="literal">innodb_undo_directory</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_undo_directory" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_undo_directory=dir_name</code></td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>System Variable</strong></span></td><td><span class="bold"><strong>Name</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_undo_directory">innodb_undo_directory</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="2">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="2">No</td></tr><tr><td scope="row" rowspan="2"><span class="bold"><strong>Permitted Values</strong></span> (&lt;= 5.7.7)</td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">directory name</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">.</code></td></tr><tr><td scope="row"><span class="bold"><strong>Permitted Values</strong></span> (&gt;= 5.7.8)</td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">directory name</code></td></tr></tbody></table>
</div>
<p>
          The path where <code class="literal">InnoDB</code> creates separate
          tablespaces for the undo logs. Typically used to place undo
          logs on a different storage device. Used in conjunction with
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_undo_logs"><code class="literal">innodb_undo_logs</code></a> and
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_undo_tablespaces"><code class="literal">innodb_undo_tablespaces</code></a>,
          which determine the disk layout of the undo logs outside the
          <a class="link" href="glossary.html#glos_system_tablespace" title="system tablespace">system
          tablespace</a>.
        </p><p>
          Prior to MySQL 5.7.8, the
          <code class="literal">innodb_undo_directory</code> default value is
          <span class="quote">“<span class="quote"><code class="filename">.</code></span>”</span>, which represents the
          same directory where <code class="literal">InnoDB</code> creates its
          other log files by default. As of MySQL 5.7.8, there is no
          default value (it is NULL). If a path is not specified, undo
          tablespaces are created in the MySQL data directory, as
          defined by <a class="link" href="server-administration.html#sysvar_datadir"><code class="literal">datadir</code></a>.
        </p><p>
          For more information about configuring separate tablespaces
          for undo logs, see <a class="xref" href="innodb-storage-engine.html#innodb-undo-tablespace" title="14.4.7 Storing InnoDB Undo Logs in Separate Tablespaces">Section 14.4.7, “Storing InnoDB Undo Logs in Separate Tablespaces”</a>.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_undo_log_truncate"></a>
          <a class="indexterm" name="idm140644103833616"></a>

          <a class="indexterm" name="idm140644103832512"></a>

          <code class="literal">innodb_undo_log_truncate</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_undo_log_truncate" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Introduced</strong></span></td><td colspan="3">5.7.5</td></tr><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_undo_log_truncate=#</code></td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>System Variable</strong></span></td><td><span class="bold"><strong>Name</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_undo_log_truncate">innodb_undo_log_truncate</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="2">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="2">Yes</td></tr><tr><td scope="row" rowspan="2"><span class="bold"><strong>Permitted Values</strong></span></td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">boolean</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">OFF</code></td></tr></tbody></table>
</div>
<p>
          When you enable <code class="literal">innodb_undo_log_truncate</code>,
          undo tablespaces that exceed the threshold value defined by
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_max_undo_log_size"><code class="literal">innodb_max_undo_log_size</code></a> are
          marked for truncation. Only undo logs that reside in undo
          tablespaces can be truncated. Truncation of undo logs that
          reside in the system tablespace is not supported. For
          truncation to occur, there must be at least two undo
          tablespaces and two redo-enabled undo logs configured to use
          the undo tablespaces. This means that
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_undo_tablespaces"><code class="literal">innodb_undo_tablespaces</code></a> must
          be set to a value equal to or greater than 2, and
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_undo_logs"><code class="literal">innodb_undo_logs</code></a> must set to
          a value equal to or greater than 35.
        </p><p>
          The
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_purge_rseg_truncate_frequency"><code class="literal">innodb_purge_rseg_truncate_frequency</code></a>
          configuration option can be used to expedite truncation of
          undo tablepaces.
        </p><p>
          For more information, see
          <a class="xref" href="innodb-storage-engine.html#truncate-undo-tablespace" title="14.4.8 Truncating Undo Logs That Reside in Undo Tablespaces">Section 14.4.8, “Truncating Undo Logs That Reside in Undo Tablespaces”</a>.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_undo_logs"></a>
          <a class="indexterm" name="idm140644103799696"></a>

          <code class="literal">innodb_undo_logs</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_undo_logs" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_undo_logs=#</code></td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>System Variable</strong></span></td><td><span class="bold"><strong>Name</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_undo_logs">innodb_undo_logs</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="2">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="2">Yes</td></tr><tr><td scope="row" rowspan="4"><span class="bold"><strong>Permitted Values</strong></span></td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">integer</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">128</code></td></tr><tr><td scope="row"><span class="bold"><strong>Min Value</strong></span></td><td colspan="2"><code class="literal">0</code></td></tr><tr><td scope="row"><span class="bold"><strong>Max Value</strong></span></td><td colspan="2"><code class="literal">128</code></td></tr></tbody></table>
</div>
<p>
          Defines the number of undo logs (otherwise referred to as
          <a class="link" href="glossary.html#glos_rollback_segment" title="rollback segment">rollback
          segments</a>) used by <code class="literal">InnoDB</code>. The
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_undo_logs"><code class="literal">innodb_undo_logs</code></a> option
          replaces
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_rollback_segments"><code class="literal">innodb_rollback_segments</code></a>.
        </p><p>
          As of MySQL 5.7.2, 32 undo logs are reserved for use by
          temporary tables and are hosted in the temporary table
          tablespace (<code class="filename">ibtmp1</code>). To allocate
          additional undo logs for data-modifying transactions that
          generate undo records, <code class="literal">innodb_undo_logs</code>
          must be set to a value greater than 32 if undo logs are stored
          in the system tablespace only. If you have configured separate
          undo tablespaces, <code class="literal">innodb_undo_logs</code> must be
          set to a value greater than 33 to allocate additional undo
          logs for data-modifying transactions. Each undo log can host
          up to a maximum of 1024 transactions.
        </p><p>
          Although you can increase or decrease the number of undo logs
          used by <code class="literal">InnoDB</code>, the number of undo logs
          physically present in the system never decreases. Thus you
          might start with a low value for this parameter and gradually
          increase it, to avoid allocating undo logs that are not
          required. If <a class="link" href="innodb-storage-engine.html#sysvar_innodb_undo_logs"><code class="literal">innodb_undo_logs</code></a>
          is not set, it defaults to the maximum value of 128. For the
          total number of available undo logs, rather than the number of
          active ones, see the
          <a class="link" href="server-administration.html#statvar_Innodb_available_undo_logs"><code class="literal">Innodb_available_undo_logs</code></a>
          status variable.
        </p><p>
          For more information about undo logs, see
          <a class="xref" href="innodb-storage-engine.html#innodb-multi-versioning" title="14.2.3 InnoDB Multi-Versioning">Section 14.2.3, “InnoDB Multi-Versioning”</a>. For information
          about configuring separate tablespaces for undo logs, see
          <a class="xref" href="innodb-storage-engine.html#innodb-undo-tablespace" title="14.4.7 Storing InnoDB Undo Logs in Separate Tablespaces">Section 14.4.7, “Storing InnoDB Undo Logs in Separate Tablespaces”</a>.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_undo_tablespaces"></a>
          <a class="indexterm" name="idm140644103759536"></a>

          <code class="literal">innodb_undo_tablespaces</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_undo_tablespaces" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_undo_tablespaces=#</code></td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>System Variable</strong></span></td><td><span class="bold"><strong>Name</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_undo_tablespaces">innodb_undo_tablespaces</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="2">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="2">No</td></tr><tr><td scope="row" rowspan="4"><span class="bold"><strong>Permitted Values</strong></span> (&lt;= 5.7.7)</td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">integer</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">0</code></td></tr><tr><td scope="row"><span class="bold"><strong>Min Value</strong></span></td><td colspan="2"><code class="literal">0</code></td></tr><tr><td scope="row"><span class="bold"><strong>Max Value</strong></span></td><td colspan="2"><code class="literal">126</code></td></tr><tr><td scope="row" rowspan="4"><span class="bold"><strong>Permitted Values</strong></span> (&gt;= 5.7.8)</td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">integer</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">0</code></td></tr><tr><td scope="row"><span class="bold"><strong>Min Value</strong></span></td><td colspan="2"><code class="literal">0</code></td></tr><tr><td scope="row"><span class="bold"><strong>Max Value</strong></span></td><td colspan="2"><code class="literal">95</code></td></tr></tbody></table>
</div>
<p>
          The number of
          <a class="link" href="glossary.html#glos_tablespace" title="tablespace">tablespace</a> files that
          the <a class="link" href="glossary.html#glos_undo_log" title="undo log">undo logs</a> are divided
          between. By default, all undo logs are part of the
          <a class="link" href="glossary.html#glos_system_tablespace" title="system tablespace">system
          tablespace</a>, and the system tablespace always contains
          one undo tablespace in addition to those configured by
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_undo_tablespaces"><code class="literal">innodb_undo_tablespaces</code></a>.
        </p><p>
          Because undo logs can become large during long-running
          transactions, having undo logs in multiple tablespaces reduces
          the maximum size of any one tablespace. The undo tablespace
          files are created in the location defined by
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_undo_directory"><code class="literal">innodb_undo_directory</code></a>, with
          names in the form of
          <code class="filename">undo<em class="replaceable"><code>N</code></em></code>, where
          <em class="replaceable"><code>N</code></em> is a sequential series of
          integers (including leading zeros). The default size of an
          undo tablespace file is 10M. The number of
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_undo_tablespaces"><code class="literal">innodb_undo_tablespaces</code></a> must
          be set prior to initializing <code class="literal">InnoDB</code>.
          Attempting to restart <code class="literal">InnoDB</code> with a greater
          number of undo tablespaces than you specified when you first
          created the MySQL instance will result in a failed start and
          an error stating that <code class="literal">InnoDB</code> did not find
          the expected number of undo tablespaces.
        </p><p>
          As MySQL 5.7.2, 32 of 128 undo logs were reserved for
          temporary tables, as described in
          <a class="xref" href="innodb-storage-engine.html#innodb-temporary-table-undo-logs" title="14.2.6 InnoDB Temporary Table Undo Logs">Section 14.2.6, “InnoDB Temporary Table Undo Logs”</a>. One undo
          log is always allocated to the system tablespace, which leaves
          95 undo logs available for undo tablepaces. This change
          effectively reduced the
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_undo_tablespaces"><code class="literal">innodb_undo_tablespaces</code></a>
          maximum limit from 126 to 95, and in MySQL 5.7.8, the
          <code class="literal">innodb_undo_tablespaces</code>
          maximum value was officially reduced to 95.
        </p><p>
          For information about configuring separate tablespaces for
          undo logs, see <a class="xref" href="innodb-storage-engine.html#innodb-undo-tablespace" title="14.4.7 Storing InnoDB Undo Logs in Separate Tablespaces">Section 14.4.7, “Storing InnoDB Undo Logs in Separate Tablespaces”</a>.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_use_native_aio"></a>
          <a class="indexterm" name="idm140644103706224"></a>

          <a class="indexterm" name="idm140644103705184"></a>

          <code class="literal">innodb_use_native_aio</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_use_native_aio" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_use_native_aio=#</code></td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>System Variable</strong></span></td><td><span class="bold"><strong>Name</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_use_native_aio">innodb_use_native_aio</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="2">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="2">No</td></tr><tr><td scope="row" rowspan="2"><span class="bold"><strong>Permitted Values</strong></span></td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">boolean</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">ON</code></td></tr></tbody></table>
</div>
<p>
          Specifies whether to use the Linux asynchronous I/O subsystem.
          This variable applies to Linux systems only, and cannot be
          changed while the server is running. Normally, you do not need
          to touch this option, because it is enabled by default.
        </p><p>
          As of MySQL 5.5, the
          <a class="link" href="glossary.html#glos_asynchronous_io" title="asynchronous I/O">asynchronous I/O</a>
          capability that <code class="literal">InnoDB</code> has on Windows
          systems is available on Linux systems. (Other Unix-like
          systems continue to use synchronous I/O calls.) This feature
          improves the scalability of heavily I/O-bound systems, which
          typically show many pending reads/writes in the output of the
          command <code class="literal">SHOW ENGINE INNODB STATUS\G</code>.
        </p><p>
          Running with a large number of <code class="literal">InnoDB</code> I/O
          threads, and especially running multiple such instances on the
          same server machine, can exceed capacity limits on Linux
          systems. In this case, you may receive the following error:
        </p><pre class="programlisting">
EAGAIN: The specified maxevents exceeds the user's limit of available events. 
</pre><p>
          You can typically address this error by writing a higher limit
          to <code class="literal">/proc/sys/fs/aio-max-nr</code>.
        </p><p>
          However, if a problem with the asynchronous I/O subsystem in
          the OS prevents <code class="literal">InnoDB</code> from starting, you
          can start the server with
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_use_native_aio"><code class="literal">innodb_use_native_aio=0</code></a>
          disabled (use
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_use_native_aio"><code class="literal">innodb_use_native_aio=0</code></a> in
          the option file). This option may also be turned off
          automatically during startup if <code class="literal">InnoDB</code>
          detects a potential problem such as a combination of
          <code class="literal">tmpdir</code> location, <code class="literal">tmpfs</code>
          filesystem, and Linux kernel that does not support AIO on
          <code class="literal">tmpfs</code>.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_use_sys_malloc"></a>
          <a class="indexterm" name="idm140644103668544"></a>

          <a class="indexterm" name="idm140644103667504"></a>

          <code class="literal">innodb_use_sys_malloc</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_use_sys_malloc" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Deprecated</strong></span></td><td colspan="3">5.6.3</td></tr><tr><td scope="row"><span class="bold"><strong>Removed</strong></span></td><td colspan="3">5.7.4</td></tr><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_use_sys_malloc=#</code></td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>System Variable</strong></span></td><td><span class="bold"><strong>Name</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_use_sys_malloc">innodb_use_sys_malloc</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="2">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="2">No</td></tr><tr><td scope="row" rowspan="2"><span class="bold"><strong>Permitted Values</strong></span></td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">boolean</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">ON</code></td></tr></tbody></table>
</div>
<p>
          Whether <code class="literal">InnoDB</code> uses the operating system
          memory allocator (<code class="literal">ON</code>) or its own
          (<code class="literal">OFF</code>). The default value is
          <code class="literal">ON</code>. See
          <a class="xref" href="innodb-storage-engine.html#innodb-performance-use_sys_malloc" title="14.3.4 Configuring the Memory Allocator for InnoDB">Section 14.3.4, “Configuring the Memory Allocator for InnoDB”</a> for more
          information.
        </p><p>
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_use_sys_malloc"><code class="literal">innodb_use_sys_malloc</code></a> was
          deprecated in MySQL 5.6.3 and removed in MySQL 5.7.4.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_version"></a>
          <a class="indexterm" name="idm140644103635632"></a>

          <a class="indexterm" name="idm140644103634624"></a>

          <code class="literal">innodb_version</code>
        </p><p>
          The <code class="literal">InnoDB</code> version number. In 5.7, the
          separate numbering for <code class="literal">InnoDB</code> does not
          apply and this value is the same as for the
          <a class="link" href="server-administration.html#sysvar_version"><code class="literal">version</code></a> variable.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_write_io_threads"></a>
          <a class="indexterm" name="idm140644103628032"></a>

          <a class="indexterm" name="idm140644103626992"></a>

          <code class="literal">innodb_write_io_threads</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_write_io_threads" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_write_io_threads=#</code></td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>System Variable</strong></span></td><td><span class="bold"><strong>Name</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_write_io_threads">innodb_write_io_threads</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="2">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="2">No</td></tr><tr><td scope="row" rowspan="4"><span class="bold"><strong>Permitted Values</strong></span></td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">integer</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">4</code></td></tr><tr><td scope="row"><span class="bold"><strong>Min Value</strong></span></td><td colspan="2"><code class="literal">1</code></td></tr><tr><td scope="row"><span class="bold"><strong>Max Value</strong></span></td><td colspan="2"><code class="literal">64</code></td></tr></tbody></table>
</div>
<p>
          The number of I/O threads for write operations in
          <code class="literal">InnoDB</code>. The default value is 4. Its
          counterpart for read threads is
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_read_io_threads"><code class="literal">innodb_read_io_threads</code></a>. See
          <a class="xref" href="innodb-storage-engine.html#innodb-performance-multiple_io_threads" title="14.3.7 Configuring the Number of Background InnoDB I/O Threads">Section 14.3.7, “Configuring the Number of Background InnoDB I/O Threads”</a> for
          more information. For general I/O tuning advice, see
          <a class="xref" href="optimization.html#optimizing-innodb-diskio" title="8.5.8 Optimizing InnoDB Disk I/O">Section 8.5.8, “Optimizing InnoDB Disk I/O”</a>.
</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
            On Linux systems, running multiple MySQL servers (typically
            more than 12) with default settings for
            <a class="link" href="innodb-storage-engine.html#sysvar_innodb_read_io_threads"><code class="literal">innodb_read_io_threads</code></a>,
            <code class="literal">innodb_write_io_threads</code>, and the Linux
            <code class="literal">aio-max-nr</code> setting can exceed system
            limits. Ideally, increase the <code class="literal">aio-max-nr</code>
            setting; as a workaround, you might reduce the settings for
            one or both of the MySQL configuration options.
</p>
</div>
<p>
          You should also take into consideration the value of
          <a class="link" href="replication.html#sysvar_sync_binlog"><code class="literal">sync_binlog</code></a>, which controls
          synchronization of the binary log to disk.
        </p><p>
          For general I/O tuning advice, see
          <a class="xref" href="optimization.html#optimizing-innodb-diskio" title="8.5.8 Optimizing InnoDB Disk I/O">Section 8.5.8, “Optimizing InnoDB Disk I/O”</a>.
</p></li></ul>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="innodb-information-schema"></a>14.12 InnoDB INFORMATION_SCHEMA Tables</h2>

</div>

</div>

</div>
<div class="toc">
<dl class="toc"><dt><span class="section"><a href="innodb-storage-engine.html#innodb-information-schema-compression-tables">14.12.1 InnoDB INFORMATION_SCHEMA Tables about Compression</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-information-schema-transactions">14.12.2 InnoDB INFORMATION_SCHEMA Transaction and Locking Tables</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-information-schema-system-tables">14.12.3 InnoDB INFORMATION_SCHEMA System Tables</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-information-schema-fulltext_index-tables">14.12.4 InnoDB INFORMATION_SCHEMA FULLTEXT Index Tables</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-information-schema-buffer-pool-tables">14.12.5 InnoDB INFORMATION_SCHEMA Buffer Pool Tables</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-information-schema-metrics-table">14.12.6 InnoDB INFORMATION_SCHEMA Metrics Table</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-information-schema-temp-table-info">14.12.7 InnoDB INFORMATION_SCHEMA Temporary Table Information Table</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-information-schema-files-table">14.12.8 Retrieving InnoDB Tablespace Metadata from INFORMATION_SCHEMA.FILES</a></span></dt></dl>
</div>
<a class="indexterm" name="idm140644103588192"></a><p>
    This section provides information and usage examples for
    <code class="literal">InnoDB</code>
    <a class="link" href="information-schema.html" title="Chapter 21 INFORMATION_SCHEMA Tables"><code class="literal">INFORMATION_SCHEMA</code></a>
    tables.
  </p><p>
    <code class="literal">InnoDB</code> <code class="literal">INFORMATION_SCHEMA</code>
    tables provide metadata, status information, and statistics about
    various aspects of the <code class="literal">InnoDB</code> storage engine. You
    can view a list of <code class="literal">InnoDB</code>
    <code class="literal">INFORMATION_SCHEMA</code> tables by issuing a
    <a class="link" href="sql-syntax.html#show-tables" title="13.7.5.37 SHOW TABLES Syntax"><code class="literal">SHOW TABLES</code></a> statement on the
    <code class="literal">INFORMATION_SCHEMA</code> database:
  </p><pre class="programlisting">mysql&gt; SHOW TABLES FROM INFORMATION_SCHEMA LIKE 'INNODB%';</pre><p>
    For table definitions, see <a class="xref" href="information-schema.html#innodb-i_s-tables" title="21.31 INFORMATION_SCHEMA Tables for InnoDB">Section 21.31, “INFORMATION_SCHEMA Tables for InnoDB”</a>. For
    general information regarding the <code class="literal">MySQL</code>
    <code class="literal">INFORMATION_SCHEMA</code> database, see
    <a class="xref" href="information-schema.html" title="Chapter 21 INFORMATION_SCHEMA Tables">Chapter 21, <i>INFORMATION_SCHEMA Tables</i></a>.
</p>
<div class="section">

<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="innodb-information-schema-compression-tables"></a>14.12.1 InnoDB INFORMATION_SCHEMA Tables about Compression</h3>

</div>

</div>

</div>

<div class="toc">
<dl class="toc"><dt><span class="section"><a href="innodb-storage-engine.html#innodb-information-schema-innodb_cmp">14.12.1.1 INNODB_CMP and INNODB_CMP_RESET</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-information-schema-innodb_cmpmem">14.12.1.2 INNODB_CMPMEM and INNODB_CMPMEM_RESET</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-information-schema-examples-compression-sect">14.12.1.3 Using the Compression Information Schema Tables</a></span></dt></dl>
</div>
<a class="indexterm" name="idm140644103573168"></a><p>
      There are two pairs of <code class="literal">InnoDB</code>
      <code class="literal">INFORMATION_SCHEMA</code> tables about compression
      that can provide insight into how well compression is working
      overall:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          <a class="link" href="information-schema.html#innodb-cmp-table" title="21.31.1 The INFORMATION_SCHEMA INNODB_CMP and INNODB_CMP_RESET Tables"><code class="literal">INNODB_CMP</code></a> and
          <a class="link" href="information-schema.html#innodb-cmp-table" title="21.31.1 The INFORMATION_SCHEMA INNODB_CMP and INNODB_CMP_RESET Tables"><code class="literal">INNODB_CMP_RESET</code></a>
          contain information about the number of compression operations
          and the amount of time spent performing compression.
        </p></li><li class="listitem"><p>
          <a class="link" href="information-schema.html#innodb-cmpmem-table" title="21.31.3 The INFORMATION_SCHEMA INNODB_CMPMEM and INNODB_CMPMEM_RESET Tables"><code class="literal">INNODB_CMPMEM</code></a> and
          <a class="link" href="information-schema.html#innodb-cmp-table" title="21.31.1 The INFORMATION_SCHEMA INNODB_CMP and INNODB_CMP_RESET Tables"><code class="literal">INNODB_CMP_RESET</code></a>
          contain information about the way memory is allocated for
          compression.
</p></li></ul>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="innodb-information-schema-innodb_cmp"></a>14.12.1.1 INNODB_CMP and INNODB_CMP_RESET</h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140644103561376"></a><a class="indexterm" name="idm140644103559888"></a><p>
        The <a class="link" href="information-schema.html#innodb-cmp-table" title="21.31.1 The INFORMATION_SCHEMA INNODB_CMP and INNODB_CMP_RESET Tables"><code class="literal">INNODB_CMP</code></a> and
        <a class="link" href="information-schema.html#innodb-cmp-table" title="21.31.1 The INFORMATION_SCHEMA INNODB_CMP and INNODB_CMP_RESET Tables"><code class="literal">INNODB_CMP_RESET</code></a>
        tables contain status information about operations related to
        compressed tables, which are described in
        <a class="xref" href="innodb-storage-engine.html#innodb-compression" title="14.6 InnoDB Table and Page Compression">Section 14.6, “InnoDB Table and Page Compression”</a>. The
        <code class="literal">PAGE_SIZE</code> column reports the compressed
        <a class="link" href="glossary.html#glos_page_size" title="page size">page size</a>.
      </p><p>
        These two tables have identical contents, but reading from
        <a class="link" href="information-schema.html#innodb-cmp-table" title="21.31.1 The INFORMATION_SCHEMA INNODB_CMP and INNODB_CMP_RESET Tables"><code class="literal">INNODB_CMP_RESET</code></a>
        resets the statistics on compression and uncompression
        operations. For example, if you archive the output of
        <a class="link" href="information-schema.html#innodb-cmp-table" title="21.31.1 The INFORMATION_SCHEMA INNODB_CMP and INNODB_CMP_RESET Tables"><code class="literal">INNODB_CMP_RESET</code></a>
        every 60 minutes, you see the statistics for each hourly period.
        If you monitor the output of
        <a class="link" href="information-schema.html#innodb-cmp-table" title="21.31.1 The INFORMATION_SCHEMA INNODB_CMP and INNODB_CMP_RESET Tables"><code class="literal">INNODB_CMP</code></a> (making sure never to
        read
        <a class="link" href="information-schema.html#innodb-cmp-table" title="21.31.1 The INFORMATION_SCHEMA INNODB_CMP and INNODB_CMP_RESET Tables"><code class="literal">INNODB_CMP_RESET</code></a>),
        you see the cumulated statistics since InnoDB was started.
      </p><p>
        For the table definition, see
        <a class="xref" href="information-schema.html#innodb-cmp-table" title="21.31.1 The INFORMATION_SCHEMA INNODB_CMP and INNODB_CMP_RESET Tables">Section 21.31.1, “The INFORMATION_SCHEMA INNODB_CMP and INNODB_CMP_RESET Tables”</a>.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="innodb-information-schema-innodb_cmpmem"></a>14.12.1.2 INNODB_CMPMEM and INNODB_CMPMEM_RESET</h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140644103545008"></a><a class="indexterm" name="idm140644103543520"></a><a class="indexterm" name="idm140644103542016"></a><p>
        The <a class="link" href="information-schema.html#innodb-cmpmem-table" title="21.31.3 The INFORMATION_SCHEMA INNODB_CMPMEM and INNODB_CMPMEM_RESET Tables"><code class="literal">INNODB_CMPMEM</code></a> and
        <a class="link" href="information-schema.html#innodb-cmpmem-table" title="21.31.3 The INFORMATION_SCHEMA INNODB_CMPMEM and INNODB_CMPMEM_RESET Tables"><code class="literal">INNODB_CMPMEM_RESET</code></a>
        tables contain status information about compressed pages that
        reside in the buffer pool. Please consult
        <a class="xref" href="innodb-storage-engine.html#innodb-compression" title="14.6 InnoDB Table and Page Compression">Section 14.6, “InnoDB Table and Page Compression”</a> for further information on
        compressed tables and the use of the buffer pool. The
        <a class="link" href="information-schema.html#innodb-cmp-table" title="21.31.1 The INFORMATION_SCHEMA INNODB_CMP and INNODB_CMP_RESET Tables"><code class="literal">INNODB_CMP</code></a> and
        <a class="link" href="information-schema.html#innodb-cmp-table" title="21.31.1 The INFORMATION_SCHEMA INNODB_CMP and INNODB_CMP_RESET Tables"><code class="literal">INNODB_CMP_RESET</code></a>
        tables should provide more useful statistics on compression.
</p>
<h5><a name="idm140644103534672"></a>Internal Details</h5>
<p>
        <code class="literal">InnoDB</code> uses a
        <a class="link" href="glossary.html#glos_buddy_allocator" title="buddy allocator">buddy allocator</a>
        system to manage memory allocated to
        <a class="link" href="glossary.html#glos_page_size" title="page size">pages of various sizes</a>,
        from 1KB to 16KB. Each row of the two tables described here
        corresponds to a single page size.
      </p><p>
        The <a class="link" href="information-schema.html#innodb-cmpmem-table" title="21.31.3 The INFORMATION_SCHEMA INNODB_CMPMEM and INNODB_CMPMEM_RESET Tables"><code class="literal">INNODB_CMPMEM</code></a> and
        <a class="link" href="information-schema.html#innodb-cmpmem-table" title="21.31.3 The INFORMATION_SCHEMA INNODB_CMPMEM and INNODB_CMPMEM_RESET Tables"><code class="literal">INNODB_CMPMEM_RESET</code></a>
        tables have identical contents, but reading from
        <a class="link" href="information-schema.html#innodb-cmpmem-table" title="21.31.3 The INFORMATION_SCHEMA INNODB_CMPMEM and INNODB_CMPMEM_RESET Tables"><code class="literal">INNODB_CMPMEM_RESET</code></a>
        resets the statistics on relocation operations. For example, if
        every 60 minutes you archived the output of
        <a class="link" href="information-schema.html#innodb-cmpmem-table" title="21.31.3 The INFORMATION_SCHEMA INNODB_CMPMEM and INNODB_CMPMEM_RESET Tables"><code class="literal">INNODB_CMPMEM_RESET</code></a>,
        it would show the hourly statistics. If you never read
        <a class="link" href="information-schema.html#innodb-cmpmem-table" title="21.31.3 The INFORMATION_SCHEMA INNODB_CMPMEM and INNODB_CMPMEM_RESET Tables"><code class="literal">INNODB_CMPMEM_RESET</code></a>
        and monitored the output of
        <a class="link" href="information-schema.html#innodb-cmpmem-table" title="21.31.3 The INFORMATION_SCHEMA INNODB_CMPMEM and INNODB_CMPMEM_RESET Tables"><code class="literal">INNODB_CMPMEM</code></a> instead, it would
        show the cumulated statistics since <code class="literal">InnoDB</code>
        was started.
      </p><p>
        For the table definition, see
        <a class="xref" href="information-schema.html#innodb-cmpmem-table" title="21.31.3 The INFORMATION_SCHEMA INNODB_CMPMEM and INNODB_CMPMEM_RESET Tables">Section 21.31.3, “The INFORMATION_SCHEMA INNODB_CMPMEM and INNODB_CMPMEM_RESET Tables”</a>.
</p>
</div>

<div class="section">

<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="innodb-information-schema-examples-compression-sect"></a>14.12.1.3 Using the Compression Information Schema Tables</h4>

</div>

</div>

</div>

<div class="example">
<a name="innodb-information-schema-examples-compression"></a><p class="title"><b>Example 14.10 Using the Compression Information Schema Tables</b></p>
<div class="example-contents">
<p>
          The following is sample output from a database that contains
          compressed tables (see <a class="xref" href="innodb-storage-engine.html#innodb-compression" title="14.6 InnoDB Table and Page Compression">Section 14.6, “InnoDB Table and Page Compression”</a>,
          <a class="link" href="information-schema.html#innodb-cmp-table" title="21.31.1 The INFORMATION_SCHEMA INNODB_CMP and INNODB_CMP_RESET Tables"><code class="literal">INNODB_CMP</code></a>,
          <a class="link" href="information-schema.html#innodb-cmp-per-index-table" title="21.31.2 The INFORMATION_SCHEMA INNODB_CMP_PER_INDEX and INNODB_CMP_PER_INDEX_RESET Tables"><code class="literal">INNODB_CMP_PER_INDEX</code></a>, and
          <a class="link" href="information-schema.html#innodb-cmpmem-table" title="21.31.3 The INFORMATION_SCHEMA INNODB_CMPMEM and INNODB_CMPMEM_RESET Tables"><code class="literal">INNODB_CMPMEM</code></a>).
        </p><p>
          The following table shows the contents of
          <a class="link" href="information-schema.html#innodb-cmp-table" title="21.31.1 The INFORMATION_SCHEMA INNODB_CMP and INNODB_CMP_RESET Tables"><code class="literal">INFORMATION_SCHEMA.INNODB_CMP</code></a>
          under a light <a class="link" href="glossary.html#glos_workload" title="workload">workload</a>.
          The only compressed page size that the buffer pool contains is
          8K. Compressing or uncompressing pages has consumed less than
          a second since the time the statistics were reset, because the
          columns <code class="literal">COMPRESS_TIME</code> and
          <code class="literal">UNCOMPRESS_TIME</code> are zero.
</p>
<div class="informaltable">
<a name="innodb-information-schema-sample-innodb_cmp"></a><table summary=" Sample data from the INFORMATION_SCHEMA.INNODB_CMP
            table, showing the internal workings of InnoDB table
compression under a light workload. " border="1"><colgroup><col><col><col><col><col><col></colgroup><thead><tr><th scope="col">page size</th><th scope="col">compress ops</th><th scope="col">compress ops ok</th><th scope="col">compress time</th><th scope="col">uncompress ops</th><th scope="col">uncompress time</th></tr></thead><tbody><tr><td scope="row">1024</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td></tr><tr><td scope="row">2048</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td></tr><tr><td scope="row">4096</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td></tr><tr><td scope="row">8192</td><td>1048</td><td>921</td><td>0</td><td>61</td><td>0</td></tr><tr><td scope="row">16384</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td></tr></tbody></table>
</div>
<p>
          According to <a class="link" href="information-schema.html#innodb-cmpmem-table" title="21.31.3 The INFORMATION_SCHEMA INNODB_CMPMEM and INNODB_CMPMEM_RESET Tables"><code class="literal">INNODB_CMPMEM</code></a>, there
          are 6169 compressed 8KB pages in the
          <a class="link" href="glossary.html#glos_buffer_pool" title="buffer pool">buffer pool</a>. The only
          other allocated block size is 64 bytes. The smallest
          <code class="literal">PAGE_SIZE</code> in
          <a class="link" href="information-schema.html#innodb-cmpmem-table" title="21.31.3 The INFORMATION_SCHEMA INNODB_CMPMEM and INNODB_CMPMEM_RESET Tables"><code class="literal">INNODB_CMPMEM</code></a> is used for block
          descriptors of those compressed pages for which no
          uncompressed page exists in the buffer pool. We see that there
          are 5910 such pages. Indirectly, we see that 259 (6169-5910)
          compressed pages also exist in the buffer pool in uncompressed
          form.
        </p><p>
          The following table shows the contents of
          <a class="link" href="information-schema.html#innodb-cmpmem-table" title="21.31.3 The INFORMATION_SCHEMA INNODB_CMPMEM and INNODB_CMPMEM_RESET Tables"><code class="literal">INFORMATION_SCHEMA.INNODB_CMPMEM</code></a>
          under a light <a class="link" href="glossary.html#glos_workload" title="workload">workload</a>.
          Some memory is unusable due to fragmentation of the memory
          allocator for compressed pages:
          <code class="literal">SUM(PAGE_SIZE*PAGES_FREE)=6784</code>. This is
          because small memory allocation requests are fulfilled by
          splitting bigger blocks, starting from the 16K blocks that are
          allocated from the main buffer pool, using the buddy
          allocation system. The fragmentation is this low because some
          allocated blocks have been relocated (copied) to form bigger
          adjacent free blocks. This copying of
          <code class="literal">SUM(PAGE_SIZE*RELOCATION_OPS)</code> bytes has
          consumed less than a second
          <code class="literal">(SUM(RELOCATION_TIME)=0)</code>.
</p>
<div class="informaltable">
<a name="innodb-information-schema-sample-innodb_cmpmem"></a><table summary=" Sample data from the
            INFORMATION_SCHEMA.INNODB_CMPMEM table, showing buffer pool
            memory operations for InnoDB table compression under a light
workload. " border="1"><colgroup><col><col><col><col><col></colgroup><thead><tr><th scope="col">page size</th><th scope="col">pages used</th><th scope="col">pages free</th><th scope="col">relocation ops</th><th scope="col">relocation time</th></tr></thead><tbody><tr><td scope="row">64</td><td>5910</td><td>0</td><td>2436</td><td>0</td></tr><tr><td scope="row">128</td><td>0</td><td>1</td><td>0</td><td>0</td></tr><tr><td scope="row">256</td><td>0</td><td>0</td><td>0</td><td>0</td></tr><tr><td scope="row">512</td><td>0</td><td>1</td><td>0</td><td>0</td></tr><tr><td scope="row">1024</td><td>0</td><td>0</td><td>0</td><td>0</td></tr><tr><td scope="row">2048</td><td>0</td><td>1</td><td>0</td><td>0</td></tr><tr><td scope="row">4096</td><td>0</td><td>1</td><td>0</td><td>0</td></tr><tr><td scope="row">8192</td><td>6169</td><td>0</td><td>5</td><td>0</td></tr><tr><td scope="row">16384</td><td>0</td><td>0</td><td>0</td><td>0</td></tr></tbody></table>
</div>

</div>

</div>
<br class="example-break">
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="innodb-information-schema-transactions"></a>14.12.2 InnoDB INFORMATION_SCHEMA Transaction and Locking Tables</h3>

</div>

</div>

</div>
<div class="toc">
<dl class="toc"><dt><span class="section"><a href="innodb-storage-engine.html#innodb-information-schema-examples">14.12.2.1 Usage Examples for InnoDB Transaction and Locking Tables</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-information-schema-understanding_innodb_locking">14.12.2.2 INNODB_LOCKS and INNODB_LOCK_WAITS Data</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-information-schema-rapidly_changing_internal_data">14.12.2.3 Data Persistence and Consistency for InnoDB Transaction and Locking
Tables</a></span></dt></dl>
</div>
<a class="indexterm" name="idm140644103442848"></a><p>
      Three <code class="literal">InnoDB</code>
      <code class="literal">INFORMATION_SCHEMA</code> tables make it easy to
      monitor transactions and diagnose possible locking problems. The
      three tables are <a class="link" href="information-schema.html#innodb-trx-table" title="21.31.4 The INFORMATION_SCHEMA INNODB_TRX Table"><code class="literal">INNODB_TRX</code></a>,
      <a class="link" href="information-schema.html#innodb-locks-table" title="21.31.5 The INFORMATION_SCHEMA INNODB_LOCKS Table"><code class="literal">INNODB_LOCKS</code></a>, and
      <a class="link" href="information-schema.html#innodb-lock-waits-table" title="21.31.6 The INFORMATION_SCHEMA INNODB_LOCK_WAITS Table"><code class="literal">INNODB_LOCK_WAITS</code></a>.
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          <a class="indexterm" name="idm140644103434704"></a>

          <a class="link" href="information-schema.html#innodb-trx-table" title="21.31.4 The INFORMATION_SCHEMA INNODB_TRX Table"><code class="literal">INNODB_TRX</code></a>: Contains information
          about every transaction currently executing inside
          <code class="literal">InnoDB</code>, including whether the transaction
          is waiting for a lock, when the transaction started, and the
          particular SQL statement the transaction is executing.
        </p></li><li class="listitem"><p>
          <a class="indexterm" name="idm140644103430256"></a>

          <a class="link" href="information-schema.html#innodb-locks-table" title="21.31.5 The INFORMATION_SCHEMA INNODB_LOCKS Table"><code class="literal">INNODB_LOCKS</code></a>: Each transaction in
          InnoDB that is waiting for another transaction to release a
          lock (<code class="literal">INNODB_TRX.TRX_STATE='LOCK WAIT'</code>) is
          blocked by exactly one <span class="quote">“<span class="quote">blocking lock request</span>”</span>.
          That blocking lock request is for a row or table lock held by
          another transaction in an incompatible mode. The waiting or
          blocked transaction cannot proceed until the other transaction
          commits or rolls back, thereby releasing the requested lock.
          For every blocked transaction,
          <a class="link" href="information-schema.html#innodb-locks-table" title="21.31.5 The INFORMATION_SCHEMA INNODB_LOCKS Table"><code class="literal">INNODB_LOCKS</code></a> contains one row
          that describes each lock the transaction has requested, and
          for which it is waiting.
          <a class="link" href="information-schema.html#innodb-locks-table" title="21.31.5 The INFORMATION_SCHEMA INNODB_LOCKS Table"><code class="literal">INNODB_LOCKS</code></a> also contains one
          row for each lock that is blocking another transaction,
          whatever the state of the transaction that holds the lock
          (<code class="literal">'RUNNING'</code>, <code class="literal">'LOCK WAIT'</code>,
          <code class="literal">'ROLLING BACK'</code> or
          <code class="literal">'COMMITTING'</code>). The lock that is blocking a
          transaction is always held in a mode (read vs. write, shared
          vs. exclusive) incompatible with the mode of requested lock.
        </p></li><li class="listitem"><p>
          <a class="indexterm" name="idm140644103419424"></a>

          <a class="link" href="information-schema.html#innodb-lock-waits-table" title="21.31.6 The INFORMATION_SCHEMA INNODB_LOCK_WAITS Table"><code class="literal">INNODB_LOCK_WAITS</code></a>: Using this
          table, you can tell which transactions are waiting for a given
          lock, or for which lock a given transaction is waiting. This
          table contains one or more rows for each
          <span class="emphasis"><em>blocked</em></span> transaction, indicating the lock
          it has requested and any locks that are blocking that request.
          The <code class="literal">REQUESTED_LOCK_ID</code> refers to the lock
          that a transaction is requesting, and the
          <code class="literal">BLOCKING_LOCK_ID</code> refers to the lock (held
          by another transaction) that is preventing the first
          transaction from proceeding. For any given blocked
          transaction, all rows in
          <a class="link" href="information-schema.html#innodb-lock-waits-table" title="21.31.6 The INFORMATION_SCHEMA INNODB_LOCK_WAITS Table"><code class="literal">INNODB_LOCK_WAITS</code></a> have the same
          value for <code class="literal">REQUESTED_LOCK_ID</code> and different
          values for <code class="literal">BLOCKING_LOCK_ID</code>.
</p></li></ul>
</div>

<div class="section">

<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="innodb-information-schema-examples"></a>14.12.2.1 Usage Examples for InnoDB Transaction and Locking Tables</h4>

</div>

</div>

</div>

<div class="example">
<a name="innodb-information-schema-examples-simple-blocking"></a><p class="title"><b>Example 14.11 Identifying Blocking Transactions</b></p>
<div class="example-contents">
<p>
          It is sometimes helpful to be able to identify which
          transaction is blocking another. You can use the
          <code class="literal">INFORMATION_SCHEMA</code> tables to find out which
          transaction is waiting for another, and which resource is
          being requested.
        </p><p>
          Suppose you have the following scenario, with three users
          running concurrently. Each user (or session) corresponds to a
          MySQL thread, and executes one transaction after another.
          Consider the state of the system when these users have issued
          the following commands, but none has yet committed its
          transaction:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              <code class="literal"> User A: </code>
            </p><pre class="programlisting">
BEGIN;
SELECT a FROM t FOR UPDATE;
SELECT SLEEP(100);
</pre></li><li class="listitem"><p>
              <code class="literal"> User B: </code>
            </p><pre class="programlisting">
SELECT b FROM t FOR UPDATE;
</pre></li><li class="listitem"><p>
              <code class="literal"> User C: </code>
            </p><pre class="programlisting">
SELECT c FROM t FOR UPDATE;
</pre></li></ul>
</div>
<p>
          In this scenario, you can use this query to see who is waiting
          for whom:
        </p><pre class="programlisting">
SELECT r.trx_id waiting_trx_id,  
       r.trx_mysql_thread_id waiting_thread,
       r.trx_query waiting_query,
       b.trx_id blocking_trx_id, 
       b.trx_mysql_thread_id blocking_thread,
       b.trx_query blocking_query
   FROM       information_schema.innodb_lock_waits w
   INNER JOIN information_schema.innodb_trx b  ON  
    b.trx_id = w.blocking_trx_id
  INNER JOIN information_schema.innodb_trx r  ON  
    r.trx_id = w.requesting_trx_id;
</pre>
<div class="informaltable">
<table summary=" This table represents the result set of a query
            against the INFORMATION_SCHEMA.INNODB_LOCK_WAITS and
            INFORMATION_SCHEMA.INNODB_TRX tables, shown in the preceding
            text, indicating which InnoDB threads are waiting for which
other threads. " border="1"><colgroup><col><col><col><col><col><col></colgroup><thead><tr><th scope="col">waiting trx id</th><th scope="col">waiting thread</th><th scope="col">waiting query</th><th scope="col">blocking trx id</th><th scope="col">blocking thread</th><th scope="col">blocking query</th></tr></thead><tbody><tr><td scope="row"><code class="literal">A4</code></td><td><code class="literal">6</code></td><td><code class="literal">SELECT b FROM t FOR UPDATE</code></td><td><code class="literal">A3</code></td><td><code class="literal">5</code></td><td><code class="literal">SELECT SLEEP(100)</code></td></tr><tr><td scope="row"><code class="literal">A5</code></td><td><code class="literal">7</code></td><td><code class="literal">SELECT c FROM t FOR UPDATE</code></td><td><code class="literal">A3</code></td><td><code class="literal">5</code></td><td><code class="literal">SELECT SLEEP(100)</code></td></tr><tr><td scope="row"><code class="literal">A5</code></td><td><code class="literal">7</code></td><td><code class="literal">SELECT c FROM t FOR UPDATE</code></td><td><code class="literal">A4</code></td><td><code class="literal">6</code></td><td><code class="literal">SELECT b FROM t FOR UPDATE</code></td></tr></tbody></table>
</div>
<p>
          In the above result, you can identify users by the
          <span class="quote">“<span class="quote">waiting query</span>”</span> or <span class="quote">“<span class="quote">blocking query</span>”</span>.
          As you can see:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              User B (trx id <code class="literal">'A4'</code>, thread
              <code class="literal">6</code>) and User C (trx id
              <code class="literal">'A5'</code>, thread <code class="literal">7</code>) are
              both waiting for User A (trx id <code class="literal">'A3'</code>,
              thread <code class="literal">5</code>).
            </p></li><li class="listitem"><p>
              User C is waiting for User B as well as User A.
</p></li></ul>
</div>
<p>
          You can see the underlying data in the tables
          <a class="link" href="innodb-storage-engine.html#innodb-information-schema-examples-simple-blocking-trx"><code class="literal">INNODB_TRX</code></a>,
          <a class="link" href="innodb-storage-engine.html#innodb-information-schema-examples-simple-blocking-locks"><code class="literal">INNODB_LOCKS</code></a>,
          and
          <a class="link" href="innodb-storage-engine.html#innodb-information-schema-examples-simple-blocking-waits"><code class="literal">INNODB_LOCK_WAITS</code></a>.
        </p><p>
          The following table shows some sample contents of
          <a class="link" href="information-schema.html#innodb-trx-table" title="21.31.4 The INFORMATION_SCHEMA INNODB_TRX Table"><code class="literal">INFORMATION_SCHEMA.INNODB_TRX</code></a>.
</p>
<div class="informaltable">
<a name="innodb-information-schema-examples-simple-blocking-trx"></a><table summary=" Sample data from the INFORMATION_SCHEMA.INNODB_TRX
            table, showing the typical types of entries for each column.
" border="1"><colgroup><col><col><col><col><col><col><col><col></colgroup><thead><tr><th scope="col">trx id</th><th scope="col">trx state</th><th scope="col">trx started</th><th scope="col">trx requested lock id</th><th scope="col">trx wait started</th><th scope="col">trx weight</th><th scope="col">trx mysql thread id</th><th scope="col">trx query</th></tr></thead><tbody><tr><td scope="row"><code class="literal">A3</code></td><td><code class="literal">RUN­NING</code></td><td><code class="literal">2008-01-15 16:44:54</code></td><td><code class="literal">NULL</code></td><td><code class="literal">NULL</code></td><td><code class="literal">2</code></td><td><code class="literal">5</code></td><td><code class="literal">SELECT SLEEP(100)</code></td></tr><tr><td scope="row"><code class="literal">A4</code></td><td><code class="literal">LOCK WAIT</code></td><td><code class="literal">2008-01-15 16:45:09</code></td><td><code class="literal">A4:1:3:2</code></td><td><code class="literal">2008-01-15 16:45:09</code></td><td><code class="literal">2</code></td><td><code class="literal">6</code></td><td><code class="literal">SELECT b FROM t FOR UPDATE</code></td></tr><tr><td scope="row"><code class="literal">A5</code></td><td><code class="literal">LOCK WAIT</code></td><td><code class="literal">2008-01-15 16:45:14</code></td><td><code class="literal">A5:1:3:2</code></td><td><code class="literal">2008-01-15 16:45:14</code></td><td><code class="literal">2</code></td><td><code class="literal">7</code></td><td><code class="literal">SELECT c FROM t FOR UPDATE</code></td></tr></tbody></table>
</div>
<p>
          The following table shows some sample contents of
          <a class="link" href="information-schema.html#innodb-locks-table" title="21.31.5 The INFORMATION_SCHEMA INNODB_LOCKS Table"><code class="literal">INFORMATION_SCHEMA.INNODB_LOCKS</code></a>.
</p>
<div class="informaltable">
<a name="innodb-information-schema-examples-simple-blocking-locks"></a><table summary=" Sample data from the
            INFORMATION_SCHEMA.INNODB_LOCKS table, showing the typical
types of entries for each column. " border="1"><colgroup><col><col><col><col><col><col><col><col><col><col></colgroup><thead><tr><th scope="col">lock id</th><th scope="col">lock trx id</th><th scope="col">lock mode</th><th scope="col">lock type</th><th scope="col">lock table</th><th scope="col">lock index</th><th scope="col">lock space</th><th scope="col">lock page</th><th scope="col">lock rec</th><th scope="col">lock data</th></tr></thead><tbody><tr><td scope="row"><code class="literal">A3:1:3:2</code></td><td><code class="literal">A3</code></td><td><code class="literal">X</code></td><td><code class="literal">RECORD</code></td><td><code class="literal">`test`.`t`</code></td><td><code class="literal">`PRIMARY`</code></td><td><code class="literal">1</code></td><td><code class="literal">3</code></td><td><code class="literal">2</code></td><td><code class="literal">0x0200</code></td></tr><tr><td scope="row"><code class="literal">A4:1:3:2</code></td><td><code class="literal">A4</code></td><td><code class="literal">X</code></td><td><code class="literal">RECORD</code></td><td><code class="literal">`test`.`t`</code></td><td><code class="literal">`PRIMARY`</code></td><td><code class="literal">1</code></td><td><code class="literal">3</code></td><td><code class="literal">2</code></td><td><code class="literal">0x0200</code></td></tr><tr><td scope="row"><code class="literal">A5:1:3:2</code></td><td><code class="literal">A5</code></td><td><code class="literal">X</code></td><td><code class="literal">RECORD</code></td><td><code class="literal">`test`.`t`</code></td><td><code class="literal">`PRIMARY`</code></td><td><code class="literal">1</code></td><td><code class="literal">3</code></td><td><code class="literal">2</code></td><td><code class="literal">0x0200</code></td></tr></tbody></table>
</div>
<p>
          The following table shows some sample contents of
          <a class="link" href="information-schema.html#innodb-lock-waits-table" title="21.31.6 The INFORMATION_SCHEMA INNODB_LOCK_WAITS Table"><code class="literal">INFORMATION_SCHEMA.INNODB_LOCK_WAITS</code></a>.
</p>
<div class="informaltable">
<a name="innodb-information-schema-examples-simple-blocking-waits"></a><table summary=" Sample data from the
            INFORMATION_SCHEMA.INNODB_LOCK_WAITS table, showing the
typical types of entries for each column. " border="1"><colgroup><col><col><col><col></colgroup><thead><tr><th scope="col">requesting trx id</th><th scope="col">requested lock id</th><th scope="col">blocking trx id</th><th scope="col">blocking lock id</th></tr></thead><tbody><tr><td scope="row"><code class="literal">A4</code></td><td><code class="literal">A4:1:3:2</code></td><td><code class="literal">A3</code></td><td><code class="literal">A3:1:3:2</code></td></tr><tr><td scope="row"><code class="literal">A5</code></td><td><code class="literal">A5:1:3:2</code></td><td><code class="literal">A3</code></td><td><code class="literal">A3:1:3:2</code></td></tr><tr><td scope="row"><code class="literal">A5</code></td><td><code class="literal">A5:1:3:2</code></td><td><code class="literal">A4</code></td><td><code class="literal">A4:1:3:2</code></td></tr></tbody></table>
</div>

</div>

</div>
<br class="example-break">
<div class="example">
<a name="innodb-information-schema-sample-locks"></a><p class="title"><b>Example 14.12 More Complex Example of Transaction Data in Information Schema Tables</b></p>
<div class="example-contents">
<p>
          Sometimes you would like to correlate the internal
          <code class="literal">InnoDB</code> locking information with
          session-level information maintained by MySQL. For example,
          you might like to know, for a given <code class="literal">InnoDB</code>
          transaction ID, the corresponding MySQL session ID and name of
          the user that may be holding a lock, and thus blocking another
          transaction.
        </p><p>
          The following output from the
          <code class="literal">INFORMATION_SCHEMA</code> tables is taken from a
          somewhat loaded system.
        </p><p>
          As can be seen in the following tables, there are several
          transactions running.
        </p><p>
          The following <code class="literal">INNODB_LOCKS</code> and
          <code class="literal">INNODB_LOCK_WAITS</code> tables shows that:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              Transaction
              <span class="color0"><code class="literal">77F</code></span>
              (executing an <code class="literal">INSERT</code>) is waiting for
              transactions
              <span class="color1"><code class="literal">77E</code></span>,
              <span class="color2"><code class="literal">77D</code></span>
              and
              <span class="color3"><code class="literal">77B</code></span>
              to commit.
            </p></li><li class="listitem"><p>
              Transaction
              <span class="color1"><code class="literal">77E</code></span>
              (executing an INSERT) is waiting for transactions
              <span class="color2"><code class="literal">77D</code></span>
              and
              <span class="color3"><code class="literal">77B</code></span>
              to commit.
            </p></li><li class="listitem"><p>
              Transaction
              <span class="color2"><code class="literal">77D</code></span>
              (executing an INSERT) is waiting for transaction
              <span class="color3"><code class="literal">77B</code></span>
              to commit.
            </p></li><li class="listitem"><p>
              Transaction
              <span class="color3"><code class="literal">77B</code></span>
              (executing an INSERT) is waiting for transaction
              <span class="color4"><code class="literal">77A</code></span>
              to commit.
            </p></li><li class="listitem"><p>
              Transaction
              <span class="color4"><code class="literal">77A</code></span>
              is running, currently executing <code class="literal">SELECT</code>.
            </p></li><li class="listitem"><p>
              Transaction
              <span class="color5"><code class="literal">E56</code></span>
              (executing an <code class="literal">INSERT</code>) is waiting for
              transaction
              <span class="color6"><code class="literal">E55</code></span>
              to commit.
            </p></li><li class="listitem"><p>
              Transaction
              <span class="color6"><code class="literal">E55</code></span>
              (executing an <code class="literal">INSERT</code>) is waiting for
              transaction
              <span class="color7"><code class="literal">19C</code></span>
              to commit.
            </p></li><li class="listitem"><p>
              Transaction
              <span class="color7"><code class="literal">19C</code></span>
              is running, currently executing an
              <code class="literal">INSERT</code>.
</p></li></ul>
</div>
<p>
          Note that there may be an inconsistency between queries shown
          in the two tables <code class="literal">INNODB_TRX.TRX_QUERY</code> and
          <code class="literal">PROCESSLIST.INFO</code>. The current transaction
          ID for a thread, and the query being executed in that
          transaction, may be different in these two tables for any
          given thread. See
          <a class="xref" href="innodb-storage-engine.html#innodb-information-schema-note_inconsistency" title="14.12.2.3.1 Potential Inconsistency with PROCESSLIST Data">Section 14.12.2.3.1, “Potential Inconsistency with PROCESSLIST Data”</a>
          for an explanation.
        </p><p>
          The following table shows the contents of
          <a class="link" href="information-schema.html#processlist-table" title="21.17 The INFORMATION_SCHEMA PROCESSLIST Table"><code class="literal">INFORMATION_SCHEMA.PROCESSLIST</code></a> in
          a system running a heavy
          <a class="link" href="glossary.html#glos_workload" title="workload">workload</a>.
</p>
<div class="informaltable">
<a name="innodb-information-schema-sample-processlist"></a><table summary=" Sample data from the INFORMATION_SCHEMA.PROCESSLIST
            table, showing the internal workings of MySQL processes
under a heavy workload. " border="1"><colgroup><col><col><col><col><col><col><col><col></colgroup><thead><tr><th scope="col">ID</th><th scope="col">USER</th><th scope="col">HOST</th><th scope="col">DB</th><th scope="col">COMMAND</th><th scope="col">TIME</th><th scope="col">STATE</th><th scope="col">INFO</th></tr></thead><tbody><tr><td scope="row"><code class="literal">384</code></td><td><code class="literal">root</code></td><td><code class="literal">localhost</code></td><td><code class="literal">test</code></td><td><code class="literal">Query</code></td><td><code class="literal">10</code></td><td><code class="literal">update</code></td><td><code class="literal">insert into t2 values …</code></td></tr><tr><td scope="row"><code class="literal">257</code></td><td><code class="literal">root</code></td><td><code class="literal">localhost</code></td><td><code class="literal">test</code></td><td><code class="literal">Query</code></td><td><code class="literal">3</code></td><td><code class="literal">update</code></td><td><code class="literal">insert into t2 values …</code></td></tr><tr><td scope="row"><code class="literal">130</code></td><td><code class="literal">root</code></td><td><code class="literal">localhost</code></td><td><code class="literal">test</code></td><td><code class="literal">Query</code></td><td><code class="literal">0</code></td><td><code class="literal">update</code></td><td><code class="literal">insert into t2 values …</code></td></tr><tr><td scope="row"><code class="literal">61</code></td><td><code class="literal">root</code></td><td><code class="literal">localhost</code></td><td><code class="literal">test</code></td><td><code class="literal">Query</code></td><td><code class="literal">1</code></td><td><code class="literal">update</code></td><td><code class="literal">insert into t2 values …</code></td></tr><tr><td scope="row"><code class="literal">8</code></td><td><code class="literal">root</code></td><td><code class="literal">localhost</code></td><td><code class="literal">test</code></td><td><code class="literal">Query</code></td><td><code class="literal">1</code></td><td><code class="literal">update</code></td><td><code class="literal">insert into t2 values …</code></td></tr><tr><td scope="row"><code class="literal">4</code></td><td><code class="literal">root</code></td><td><code class="literal">localhost</code></td><td><code class="literal">test</code></td><td><code class="literal">Query</code></td><td><code class="literal">0</code></td><td><code class="literal">preparing</code></td><td><code class="literal">SELECT * FROM processlist</code></td></tr><tr><td scope="row"><code class="literal">2</code></td><td><code class="literal">root</code></td><td><code class="literal">localhost</code></td><td><code class="literal">test</code></td><td><code class="literal">Sleep</code></td><td><code class="literal">566</code></td><td><code class="literal"></code></td><td><code class="literal">NULL</code></td></tr></tbody></table>
</div>
<p>
          The following table shows the contents of
          <a class="link" href="information-schema.html#innodb-trx-table" title="21.31.4 The INFORMATION_SCHEMA INNODB_TRX Table"><code class="literal">INFORMATION_SCHEMA.INNODB_TRX</code></a> in
          a system running a heavy
          <a class="link" href="glossary.html#glos_workload" title="workload">workload</a>.
</p>
<div class="informaltable">
<a name="innodb-information-schema-sample-innodb_trx"></a><table summary=" Sample data from the INFORMATION_SCHEMA.INNODB_TRX
            table, showing the internal workings of InnoDB transactions
under a heavy workload. " border="1"><colgroup><col><col><col><col><col><col><col><col></colgroup><thead><tr><th scope="col">trx id</th><th scope="col">trx state</th><th scope="col">trx started</th><th scope="col">trx requested lock id</th><th scope="col">trx wait started</th><th scope="col">trx weight</th><th scope="col">trx mysql thread id</th><th scope="col">trx query</th></tr></thead><tbody><tr><td scope="row"><span class="color0"><code class="literal">77F</code></span></td><td><code class="literal">LOCK WAIT</code></td><td><code class="literal">2008-01-15 13:10:16</code></td><td><span class="color0"><code class="literal">77F</code></span>:806</td><td><code class="literal">2008-01-15 13:10:16</code></td><td><code class="literal">1</code></td><td><code class="literal">876</code></td><td><code class="literal">insert into t09 (D, B, C) values …</code></td></tr><tr><td scope="row"><span class="color1"><code class="literal">77E</code></span></td><td><code class="literal">LOCK WAIT</code></td><td><code class="literal">2008-01-15 13:10:16</code></td><td><span class="color1"><code class="literal">77E</code></span>:806</td><td><code class="literal">2008-01-15 13:10:16</code></td><td><code class="literal">1</code></td><td><code class="literal">875</code></td><td><code class="literal">insert into t09 (D, B, C) values …</code></td></tr><tr><td scope="row"><span class="color2"><code class="literal">77D</code></span></td><td><code class="literal">LOCK WAIT</code></td><td><code class="literal">2008-01-15 13:10:16</code></td><td><span class="color2"><code class="literal">77D</code></span>:806</td><td><code class="literal">2008-01-15 13:10:16</code></td><td><code class="literal">1</code></td><td><code class="literal">874</code></td><td><code class="literal">insert into t09 (D, B, C) values …</code></td></tr><tr><td scope="row"><span class="color3"><code class="literal">77B</code></span></td><td><code class="literal">LOCK WAIT</code></td><td><code class="literal">2008-01-15 13:10:16</code></td><td><span class="color3"><code class="literal">77B</code></span>:733​:12:1</td><td><code class="literal">2008-01-15 13:10:16</code></td><td><code class="literal">4</code></td><td><code class="literal">873</code></td><td><code class="literal">insert into t09 (D, B, C) values …</code></td></tr><tr><td scope="row"><span class="color4"><code class="literal">77A</code></span></td><td><code class="literal">RUN­NING</code></td><td><code class="literal">2008-01-15 13:10:16</code></td><td><code class="literal">NULL</code></td><td><code class="literal">NULL</code></td><td><code class="literal">4</code></td><td><code class="literal">872</code></td><td><code class="literal">select b, c from t09 where …</code></td></tr><tr><td scope="row"><span class="color5"><code class="literal">E56</code></span></td><td><code class="literal">LOCK WAIT</code></td><td><code class="literal">2008-01-15 13:10:06</code></td><td><span class="color5"><code class="literal">E56</code></span>:743​:6:2</td><td><code class="literal">2008-01-15 13:10:06</code></td><td><code class="literal">5</code></td><td><code class="literal">384</code></td><td><code class="literal">insert into t2 values …</code></td></tr><tr><td scope="row"><span class="color6"><code class="literal">E55</code></span></td><td><code class="literal">LOCK WAIT</code></td><td><code class="literal">2008-01-15 13:10:06</code></td><td><span class="color6"><code class="literal">E55</code></span>:743​:38:2</td><td><code class="literal">2008-01-15 13:10:13</code></td><td><code class="literal">965</code></td><td><code class="literal">257</code></td><td><code class="literal">insert into t2 values …</code></td></tr><tr><td scope="row"><span class="color7"><code class="literal">19C</code></span></td><td><code class="literal">RUN­NING</code></td><td><code class="literal">2008-01-15 13:09:10</code></td><td><code class="literal">NULL</code></td><td><code class="literal">NULL</code></td><td><code class="literal">2900</code></td><td><code class="literal">130</code></td><td><code class="literal">insert into t2 values …</code></td></tr><tr><td scope="row"><span class="color8"><code class="literal">E15</code></span></td><td><code class="literal">RUN­NING</code></td><td><code class="literal">2008-01-15 13:08:59</code></td><td><code class="literal">NULL</code></td><td><code class="literal">NULL</code></td><td><code class="literal">5395</code></td><td><code class="literal">61</code></td><td><code class="literal">insert into t2 values …</code></td></tr><tr><td scope="row"><span class="color9"><code class="literal">51D</code></span></td><td><code class="literal">RUN­NING</code></td><td><code class="literal">2008-01-15 13:08:47</code></td><td><code class="literal">NULL</code></td><td><code class="literal">NULL</code></td><td><code class="literal">9807</code></td><td><code class="literal">8</code></td><td><code class="literal">insert into t2 values …</code></td></tr></tbody></table>
</div>
<p>
          The following table shows the contents of
          <a class="link" href="information-schema.html#innodb-lock-waits-table" title="21.31.6 The INFORMATION_SCHEMA INNODB_LOCK_WAITS Table"><code class="literal">INFORMATION_SCHEMA.INNODB_LOCK_WAITS</code></a>
          in a system running a heavy
          <a class="link" href="glossary.html#glos_workload" title="workload">workload</a>.
</p>
<div class="informaltable">
<a name="innodb-information-schema-sample-innodb_lock_waits"></a><table summary=" Sample data from the
            INFORMATION_SCHEMA.INNODB_LOCK_WAITS table, showing the
            internal workings of InnoDB locking under a heavy workload.
" border="1"><colgroup><col><col><col><col></colgroup><thead><tr><th scope="col">requesting trx id</th><th scope="col">requested lock id</th><th scope="col">blocking trx id</th><th scope="col">blocking lock id</th></tr></thead><tbody><tr><td scope="row"><span class="color0"><code class="literal">77F</code></span></td><td><span class="color0"><code class="literal">77F</code></span>:806</td><td><span class="color1"><code class="literal">77E</code></span></td><td><span class="color1"><code class="literal">77E</code></span>:806</td></tr><tr><td scope="row"><span class="color0"><code class="literal">77F</code></span></td><td><span class="color0"><code class="literal">77F</code></span>:806</td><td><span class="color2"><code class="literal">77D</code></span></td><td><span class="color2"><code class="literal">77D</code></span>:806</td></tr><tr><td scope="row"><span class="color0"><code class="literal">77F</code></span></td><td><span class="color0"><code class="literal">77F</code></span>:806</td><td><span class="color3"><code class="literal">77B</code></span></td><td><span class="color3"><code class="literal">77B</code></span>:806</td></tr><tr><td scope="row"><span class="color1"><code class="literal">77E</code></span></td><td><span class="color1"><code class="literal">77E</code></span>:806</td><td><span class="color2"><code class="literal">77D</code></span></td><td><span class="color2"><code class="literal">77D</code></span>:806</td></tr><tr><td scope="row"><span class="color1"><code class="literal">77E</code></span></td><td><span class="color1"><code class="literal">77E</code></span>:806</td><td><span class="color3"><code class="literal">77B</code></span></td><td><span class="color3"><code class="literal">77B</code></span>:806</td></tr><tr><td scope="row"><span class="color2"><code class="literal">77D</code></span></td><td><span class="color2"><code class="literal">77D</code></span>:806</td><td><span class="color3"><code class="literal">77B</code></span></td><td><span class="color3"><code class="literal">77B</code></span>:806</td></tr><tr><td scope="row"><span class="color3"><code class="literal">77B</code></span></td><td><span class="color3"><code class="literal">77B</code></span>:733:12:1</td><td><span class="color4"><code class="literal">77A</code></span></td><td><span class="color4"><code class="literal">77A</code></span>:733:12:1</td></tr><tr><td scope="row"><span class="color5"><code class="literal">E56</code></span></td><td><span class="color5"><code class="literal">E56</code></span>:743:6:2</td><td><span class="color6"><code class="literal">E55</code></span></td><td><span class="color6"><code class="literal">E55</code></span>:743:6:2</td></tr><tr><td scope="row"><span class="color6"><code class="literal">E55</code></span></td><td><span class="color6"><code class="literal">E55</code></span>:743:38:2</td><td><span class="color7"><code class="literal">19C</code></span></td><td><span class="color7"><code class="literal">19C</code></span>:743:38:2</td></tr></tbody></table>
</div>
<p>
          The following table shows the contents of
          <a class="link" href="information-schema.html#innodb-locks-table" title="21.31.5 The INFORMATION_SCHEMA INNODB_LOCKS Table"><code class="literal">INFORMATION_SCHEMA.INNODB_LOCKS</code></a>
          in a system running a heavy
          <a class="link" href="glossary.html#glos_workload" title="workload">workload</a>.
</p>
<div class="informaltable">
<a name="innodb-information-schema-sample-innodb_locks"></a><table summary=" Sample data from the
            INFORMATION_SCHEMA.INNODB_LOCKS table, showing the internal
workings of InnoDB locking under a heavy workload. " border="1"><colgroup><col><col><col><col><col><col><col><col><col><col></colgroup><thead><tr><th scope="col">lock id</th><th scope="col">lock trx id</th><th scope="col">lock mode</th><th scope="col">lock type</th><th scope="col">lock table</th><th scope="col">lock index</th><th scope="col">lock space</th><th scope="col">lock page</th><th scope="col">lock rec</th><th scope="col">lock data</th></tr></thead><tbody><tr><td scope="row"><span class="color0"><code class="literal">77F</code></span>:806</td><td><span class="color0"><code class="literal">77F</code></span></td><td><code class="literal">AUTO​_INC</code></td><td><code class="literal">TABLE</code></td><td><code class="literal">`test`​.`t09`</code></td><td><code class="literal">NULL</code></td><td><code class="literal">NULL</code></td><td><code class="literal">NULL</code></td><td><code class="literal">NULL</code></td><td><code class="literal">NULL</code></td></tr><tr><td scope="row"><span class="color1"><code class="literal">77E</code></span>:806</td><td><span class="color1"><code class="literal">77E</code></span></td><td><code class="literal">AUTO​_INC</code></td><td><code class="literal">TABLE</code></td><td><code class="literal">`test`​.`t09`</code></td><td><code class="literal">NULL</code></td><td><code class="literal">NULL</code></td><td><code class="literal">NULL</code></td><td><code class="literal">NULL</code></td><td><code class="literal">NULL</code></td></tr><tr><td scope="row"><span class="color2"><code class="literal">77D</code></span>:806</td><td><span class="color2"><code class="literal">77D</code></span></td><td><code class="literal">AUTO​_INC</code></td><td><code class="literal">TABLE</code></td><td><code class="literal">`test`​.`t09`</code></td><td><code class="literal">NULL</code></td><td><code class="literal">NULL</code></td><td><code class="literal">NULL</code></td><td><code class="literal">NULL</code></td><td><code class="literal">NULL</code></td></tr><tr><td scope="row"><span class="color3"><code class="literal">77B</code></span>:806</td><td><span class="color3"><code class="literal">77B</code></span></td><td><code class="literal">AUTO​_INC</code></td><td><code class="literal">TABLE</code></td><td><code class="literal">`test`​.`t09`</code></td><td><code class="literal">NULL</code></td><td><code class="literal">NULL</code></td><td><code class="literal">NULL</code></td><td><code class="literal">NULL</code></td><td><code class="literal">NULL</code></td></tr><tr><td scope="row"><span class="color3"><code class="literal">77B</code></span>:733​:12:1</td><td><span class="color3"><code class="literal">77B</code></span></td><td><code class="literal">X</code></td><td><code class="literal">RECORD</code></td><td><code class="literal">`test`​.`t09`</code></td><td><code class="literal">`PRIMARY`</code></td><td><code class="literal">733</code></td><td><code class="literal">12</code></td><td><code class="literal">1</code></td><td><code class="literal">supremum pseudo-record</code></td></tr><tr><td scope="row"><span class="color4"><code class="literal">77A</code></span>:733​:12:1</td><td><span class="color4"><code class="literal">77A</code></span></td><td><code class="literal">X</code></td><td><code class="literal">RECORD</code></td><td><code class="literal">`test`​.`t09`</code></td><td><code class="literal">`PRIMARY`</code></td><td><code class="literal">733</code></td><td><code class="literal">12</code></td><td><code class="literal">1</code></td><td><code class="literal">supremum pseudo-record</code></td></tr><tr><td scope="row"><span class="color5"><code class="literal">E56</code></span>:743​:6:2</td><td><span class="color5"><code class="literal">E56</code></span></td><td><code class="literal">S</code></td><td><code class="literal">RECORD</code></td><td><code class="literal">`test`​.`t2`</code></td><td><code class="literal">`PRIMARY`</code></td><td><code class="literal">743</code></td><td><code class="literal">6</code></td><td><code class="literal">2</code></td><td><code class="literal">0, 0</code></td></tr><tr><td scope="row"><span class="color6"><code class="literal">E55</code></span>:743​:6:2</td><td><span class="color6"><code class="literal">E55</code></span></td><td><code class="literal">X</code></td><td><code class="literal">RECORD</code></td><td><code class="literal">`test`​.`t2`</code></td><td><code class="literal">`PRIMARY`</code></td><td><code class="literal">743</code></td><td><code class="literal">6</code></td><td><code class="literal">2</code></td><td><code class="literal">0, 0</code></td></tr><tr><td scope="row"><span class="color6"><code class="literal">E55</code></span>:743​:38:2</td><td><span class="color6"><code class="literal">E55</code></span></td><td><code class="literal">S</code></td><td><code class="literal">RECORD</code></td><td><code class="literal">`test`​.`t2`</code></td><td><code class="literal">`PRIMARY`</code></td><td><code class="literal">743</code></td><td><code class="literal">38</code></td><td><code class="literal">2</code></td><td><code class="literal">1922, 1922</code></td></tr><tr><td scope="row"><span class="color7"><code class="literal">19C</code></span>:743​:38:2</td><td><span class="color7"><code class="literal">19C</code></span></td><td><code class="literal">X</code></td><td><code class="literal">RECORD</code></td><td><code class="literal">`test`​.`t2`</code></td><td><code class="literal">`PRIMARY`</code></td><td><code class="literal">743</code></td><td><code class="literal">38</code></td><td><code class="literal">2</code></td><td><code class="literal">1922, 1922</code></td></tr></tbody></table>
</div>

</div>

</div>
<br class="example-break">
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="innodb-information-schema-understanding_innodb_locking"></a>14.12.2.2 INNODB_LOCKS and INNODB_LOCK_WAITS Data</h4>

</div>

</div>

</div>
<p>
        When a transaction updates a row in a table, or locks it with
        <code class="literal">SELECT FOR UPDATE</code>, <code class="literal">InnoDB</code>
        establishes a list or queue of locks on that row. Similarly,
        <code class="literal">InnoDB</code> maintains a list of locks on a table
        for table-level locks. If a second transaction wants to update a
        row or lock a table already locked by a prior transaction in an
        incompatible mode, <code class="literal">InnoDB</code> adds a lock request
        for the row to the corresponding queue. For a lock to be
        acquired by a transaction, all incompatible lock requests
        previously entered into the lock queue for that row or table
        must be removed (the transactions holding or requesting those
        locks either commit or roll back).
      </p><p>
        A transaction may have any number of lock requests for different
        rows or tables. At any given time, a transaction may request a
        lock that is held by another transaction, in which case it is
        blocked by that other transaction. The requesting transaction
        must wait for the transaction that holds the blocking lock to
        commit or rollback. If a transaction is not waiting for a lock,
        it is in a <code class="literal">'RUNNING'</code> state. If a transaction
        is waiting for a lock, it is in a <code class="literal">'LOCK WAIT'</code>
        state.
      </p><p>
        The <a class="link" href="information-schema.html#innodb-locks-table" title="21.31.5 The INFORMATION_SCHEMA INNODB_LOCKS Table"><code class="literal">INNODB_LOCKS</code></a> table holds one or
        more rows for each <code class="literal">'LOCK WAIT'</code> transaction,
        indicating any lock requests that are preventing its progress.
        This table also contains one row describing each lock in a queue
        of locks pending for a given row or table. The
        <a class="link" href="information-schema.html#innodb-lock-waits-table" title="21.31.6 The INFORMATION_SCHEMA INNODB_LOCK_WAITS Table"><code class="literal">INNODB_LOCK_WAITS</code></a> table shows which
        locks already held by a transaction are blocking locks requested
        by other transactions.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="innodb-information-schema-rapidly_changing_internal_data"></a>14.12.2.3 Data Persistence and Consistency for InnoDB Transaction and Locking
Tables</h4>
</div>
</div>
</div>
<p>
        The data exposed by the transaction and locking tables
        (<a class="link" href="information-schema.html#innodb-trx-table" title="21.31.4 The INFORMATION_SCHEMA INNODB_TRX Table"><code class="literal">INNODB_TRX</code></a>,
        <a class="link" href="information-schema.html#innodb-locks-table" title="21.31.5 The INFORMATION_SCHEMA INNODB_LOCKS Table"><code class="literal">INNODB_LOCKS</code></a>, and
        <a class="link" href="information-schema.html#innodb-lock-waits-table" title="21.31.6 The INFORMATION_SCHEMA INNODB_LOCK_WAITS Table"><code class="literal">INNODB_LOCK_WAITS</code></a>) represent a
        glimpse into fast-changing data. This is not like other (user)
        tables, where the data changes only when application-initiated
        updates occur. The underlying data is internal system-managed
        data, and can change very quickly.
      </p><p>
        For performance reasons, and to minimize the chance of
        misleading <code class="literal">JOIN</code>s between the
        <code class="literal">InnoDB</code> transaction and locking
        <code class="literal">INFORMATION_SCHEMA</code> tables,
        <code class="literal">InnoDB</code> collects the required transaction and
        locking information into an intermediate buffer whenever a
        <code class="literal">SELECT</code> on any of the tables is issued. This
        buffer is refreshed only if more than 0.1 seconds has elapsed
        since the last time the buffer was read. The data needed to fill
        the three tables is fetched atomically and consistently and is
        saved in this global internal buffer, forming a point-in-time
        <span class="quote">“<span class="quote">snapshot</span>”</span>. If multiple table accesses occur within
        0.1 seconds (as they almost certainly do when MySQL processes a
        join among these tables), then the same snapshot is used to
        satisfy the query.
      </p><p>
        A correct result is returned when you <code class="literal">JOIN</code>
        any of these tables together in a single query, because the data
        for the three tables comes from the same snapshot. Because the
        buffer is not refreshed with every query of any of these tables,
        if you issue separate queries against these tables within a
        tenth of a second, the results are the same from query to query.
        On the other hand, two separate queries of the same or different
        tables issued more than a tenth of a second apart may see
        different results, since the data come from different snapshots.
      </p><p>
        Because <code class="literal">InnoDB</code> must temporarily stall while
        the transaction and locking data is collected, too frequent
        queries of these tables can negatively impact performance as
        seen by other users.
      </p><p>
        As these tables contain sensitive information (at least
        <code class="literal">INNODB_LOCKS.LOCK_DATA</code> and
        <code class="literal">INNODB_TRX.TRX_QUERY</code>), for security reasons,
        only the users with the <code class="literal">PROCESS</code> privilege are
        allowed to <code class="literal">SELECT</code> from them.
</p>
<div class="section">

<div class="titlepage">
<div>
<div>
<h5 class="title"><a name="innodb-information-schema-note_inconsistency"></a>14.12.2.3.1 Potential Inconsistency with PROCESSLIST Data</h5>
</div>
</div>
</div>
<a class="indexterm" name="idm140644102864224"></a><p>
          As described in
          <a class="xref" href="innodb-storage-engine.html#innodb-information-schema-rapidly_changing_internal_data" title="14.12.2.3 Data Persistence and Consistency for InnoDB Transaction and Locking Tables">Section 14.12.2.3, “Data Persistence and Consistency for InnoDB Transaction and Locking
        Tables”</a>,
          the data that fills the <code class="literal">InnoDB</code> transaction
          and locking tables (<a class="link" href="information-schema.html#innodb-trx-table" title="21.31.4 The INFORMATION_SCHEMA INNODB_TRX Table"><code class="literal">INNODB_TRX</code></a>,
          <a class="link" href="information-schema.html#innodb-locks-table" title="21.31.5 The INFORMATION_SCHEMA INNODB_LOCKS Table"><code class="literal">INNODB_LOCKS</code></a> and
          <a class="link" href="information-schema.html#innodb-lock-waits-table" title="21.31.6 The INFORMATION_SCHEMA INNODB_LOCK_WAITS Table"><code class="literal">INNODB_LOCK_WAITS</code></a>) is fetched
          automatically and saved to an intermediate buffer that
          provides a <span class="quote">“<span class="quote">point-in-time</span>”</span> snapshot. The data
          across all three tables is consistent when queried from the
          same snapshot. However, the underlying data changes so fast
          that similar glimpses at other, similarly fast-changing data,
          may not be in synchrony. Thus, you should be careful when
          comparing data in the <code class="literal">InnoDB</code> transaction
          and locking tables with data in the
          <a class="link" href="information-schema.html#processlist-table" title="21.17 The INFORMATION_SCHEMA PROCESSLIST Table"><code class="literal">PROCESSLIST</code></a> table. The data from
          the <a class="link" href="information-schema.html#processlist-table" title="21.17 The INFORMATION_SCHEMA PROCESSLIST Table"><code class="literal">PROCESSLIST</code></a> table does not
          come from the same snapshot as the data about locking and
          transactions. Even if you issue a single
          <code class="literal">SELECT</code> (joining
          <a class="link" href="information-schema.html#innodb-trx-table" title="21.31.4 The INFORMATION_SCHEMA INNODB_TRX Table"><code class="literal">INNODB_TRX</code></a> and
          <a class="link" href="information-schema.html#processlist-table" title="21.17 The INFORMATION_SCHEMA PROCESSLIST Table"><code class="literal">PROCESSLIST</code></a>, for example), the
          content of those tables is generally not consistent.
          <a class="link" href="information-schema.html#innodb-trx-table" title="21.31.4 The INFORMATION_SCHEMA INNODB_TRX Table"><code class="literal">INNODB_TRX</code></a> may reference rows
          that are not present in
          <a class="link" href="information-schema.html#processlist-table" title="21.17 The INFORMATION_SCHEMA PROCESSLIST Table"><code class="literal">PROCESSLIST</code></a> or the currently
          executing SQL query of a transaction, shown in
          <code class="literal">INNODB_TRX.TRX_QUERY</code> may differ from the
          one in <code class="literal">PROCESSLIST.INFO</code>.
</p>
</div>

</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="innodb-information-schema-system-tables"></a>14.12.3 InnoDB INFORMATION_SCHEMA System Tables</h3>

</div>

</div>

</div>
<p>
      You can extract metadata about schema objects managed by
      <code class="literal">InnoDB</code> using <code class="literal">InnoDB</code>
      <code class="literal">INFORMATION_SCHEMA</code> system tables. This
      information comes from the <code class="literal">InnoDB</code> internal
      system tables (also referred to as the <code class="literal">InnoDB</code>
      data dictionary), which cannot be queried directly like regular
      <code class="literal">InnoDB</code> tables. Traditionally, you would get
      this type of information using the techniques from
      <a class="xref" href="innodb-storage-engine.html#innodb-monitors" title="14.14 InnoDB Monitors">Section 14.14, “InnoDB Monitors”</a>, setting up
      <code class="literal">InnoDB</code> monitors and parsing the output from the
      <a class="link" href="sql-syntax.html#show-engine" title="13.7.5.15 SHOW ENGINE Syntax"><code class="literal">SHOW ENGINE INNODB
      STATUS</code></a> command. The <code class="literal">InnoDB</code>
      <code class="literal">INFORMATION_SCHEMA</code> table interface allows you
      to query this data using SQL.
    </p><p>
      With the exception of
      <a class="link" href="information-schema.html#innodb-sys-tablestats-table" title="21.31.13 The INFORMATION_SCHEMA INNODB_SYS_TABLESTATS View"><code class="literal">INNODB_SYS_TABLESTATS</code></a>, for which
      there is no corresponding internal system table,
      <code class="literal">InnoDB</code> <code class="literal">INFORMATION_SCHEMA</code>
      system tables are populated with data read directly from internal
      <code class="literal">InnoDB</code> system tables rather than from metadata
      that is cached in memory.
    </p><p>
      <code class="literal">InnoDB</code> <code class="literal">INFORMATION_SCHEMA</code>
      system tables include the tables listed below.
      <a class="link" href="information-schema.html#innodb-sys-datafiles-table" title="21.31.14 The INFORMATION_SCHEMA INNODB_SYS_DATAFILES Table"><code class="literal">INNODB_SYS_DATAFILES</code></a> and
      <a class="link" href="information-schema.html#innodb-sys-tablespaces-table" title="21.31.15 The INFORMATION_SCHEMA INNODB_SYS_TABLESPACES Table"><code class="literal">INNODB_SYS_TABLESPACES</code></a> were added in
      MySQL 5.6.6 with the introduction of support for the <code class="literal">DATA
      DIRECTORY='<em class="replaceable"><code>directory</code></em>'</code> clause
      of the <a class="link" href="sql-syntax.html#create-table" title="13.1.18 CREATE TABLE Syntax"><code class="literal">CREATE TABLE</code></a> statement,
      which allows <code class="literal">InnoDB</code>
      <a class="link" href="glossary.html#glos_file_per_table" title="file-per-table">file-per-table</a>
      tablespaces (<code class="literal">.ibd</code> files) to be created in a
      location outside the MySQL data directory.
    </p><pre class="programlisting">mysql&gt; SHOW TABLES FROM INFORMATION_SCHEMA LIKE 'INNODB_SYS%';
+--------------------------------------------+
| Tables_in_information_schema (INNODB_SYS%) |
+--------------------------------------------+
| INNODB_SYS_DATAFILES                       |
| INNODB_SYS_TABLESTATS                      |
| INNODB_SYS_FOREIGN                         |
| INNODB_SYS_COLUMNS                         |
| INNODB_SYS_INDEXES                         |
| INNODB_SYS_FIELDS                          |
| INNODB_SYS_TABLESPACES                     |
| INNODB_SYS_FOREIGN_COLS                    |
| INNODB_SYS_TABLES                          |
+--------------------------------------------+</pre><p>
      The table names are indicative of the type of data provided:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          <a class="link" href="information-schema.html#innodb-sys-tables-table" title="21.31.7 The INFORMATION_SCHEMA INNODB_SYS_TABLES Table"><code class="literal">INNODB_SYS_TABLES</code></a> provides
          metadata about <code class="literal">InnoDB</code> tables, equivalent to
          the information in the <code class="literal">SYS_TABLES</code> table in
          the <code class="literal">InnoDB</code> data dictionary.
        </p></li><li class="listitem"><p>
          <a class="link" href="information-schema.html#innodb-sys-columns-table" title="21.31.9 The INFORMATION_SCHEMA INNODB_SYS_COLUMNS Table"><code class="literal">INNODB_SYS_COLUMNS</code></a> provides
          metadata about <code class="literal">InnoDB</code> table columns,
          equivalent to the information in the
          <code class="literal">SYS_COLUMNS</code> table in the
          <code class="literal">InnoDB</code> data dictionary.
        </p></li><li class="listitem"><p>
          <a class="link" href="information-schema.html#innodb-sys-indexes-table" title="21.31.8 The INFORMATION_SCHEMA INNODB_SYS_INDEXES Table"><code class="literal">INNODB_SYS_INDEXES</code></a> provides
          metadata about <code class="literal">InnoDB</code> indexes, equivalent
          to the information in the <code class="literal">SYS_INDEXES</code> table
          in the <code class="literal">InnoDB</code> data dictionary.
        </p></li><li class="listitem"><p>
          <a class="link" href="information-schema.html#innodb-sys-fields-table" title="21.31.10 The INFORMATION_SCHEMA INNODB_SYS_FIELDS Table"><code class="literal">INNODB_SYS_FIELDS</code></a> provides
          metadata about the key columns (fields) of
          <code class="literal">InnoDB</code> indexes, equivalent to the
          information in the <code class="literal">SYS_FIELDS</code> table in the
          <code class="literal">InnoDB</code> data dictionary.
        </p></li><li class="listitem"><p>
          <a class="link" href="information-schema.html#innodb-sys-tablestats-table" title="21.31.13 The INFORMATION_SCHEMA INNODB_SYS_TABLESTATS View"><code class="literal">INNODB_SYS_TABLESTATS</code></a> provides a
          view of low-level status information about
          <code class="literal">InnoDB</code> tables that is derived from
          in-memory data structures. There is no corresponding internal
          <code class="literal">InnoDB</code> system table.
        </p></li><li class="listitem"><p>
          <a class="link" href="information-schema.html#innodb-sys-datafiles-table" title="21.31.14 The INFORMATION_SCHEMA INNODB_SYS_DATAFILES Table"><code class="literal">INNODB_SYS_DATAFILES</code></a> provides
          data file path information for <code class="literal">InnoDB</code>
          file-per-table and general tablespaces, equivalent to
          information in the <code class="literal">SYS_DATAFILES</code> table in
          the <code class="literal">InnoDB</code> data dictionary.
        </p></li><li class="listitem"><p>
          <a class="link" href="information-schema.html#innodb-sys-tablespaces-table" title="21.31.15 The INFORMATION_SCHEMA INNODB_SYS_TABLESPACES Table"><code class="literal">INNODB_SYS_TABLESPACES</code></a> provides
          metadata about <code class="literal">InnoDB</code> file-per-table and
          general tablespaces, equivalent to the information in the
          <code class="literal">SYS_TABLESPACES</code> table in the
          <code class="literal">InnoDB</code> data dictionary.
        </p></li><li class="listitem"><p>
          <a class="link" href="information-schema.html#innodb-sys-foreign-table" title="21.31.11 The INFORMATION_SCHEMA INNODB_SYS_FOREIGN Table"><code class="literal">INNODB_SYS_FOREIGN</code></a> provides
          metadata about foreign keys defined on
          <code class="literal">InnoDB</code> tables, equivalent to the
          information in the <code class="literal">SYS_FOREIGN</code> table in the
          <code class="literal">InnoDB</code> data dictionary.
        </p></li><li class="listitem"><p>
          <a class="link" href="information-schema.html#innodb-sys-foreign-cols-table" title="21.31.12 The INFORMATION_SCHEMA INNODB_SYS_FOREIGN_COLS Table"><code class="literal">INNODB_SYS_FOREIGN_COLS</code></a> provides
          metadata about the columns of foreign keys that are defined on
          <code class="literal">InnoDB</code> tables, equivalent to the
          information in the <code class="literal">SYS_FOREIGN_COLS</code> table
          in the <code class="literal">InnoDB</code> data dictionary.
</p></li></ul>
</div>
<p>
      <code class="literal">InnoDB</code> <code class="literal">INFORMATION_SCHEMA</code>
      system tables can be joined together through fields such as
      <code class="literal">TABLE_ID</code>, <code class="literal">INDEX_ID</code>, and
      <code class="literal">SPACE</code>, allowing you to easily retrieve all
      available data for an object you want to study or monitor.
    </p><p>
      Refer to the <code class="literal">InnoDB</code>
      <a class="link" href="information-schema.html#innodb-i_s-tables" title="21.31 INFORMATION_SCHEMA Tables for InnoDB">INFORMATION_SCHEMA</a>
      documentation for information about the columns of each table.
</p>
<div class="example">
<a name="innodb-information-schema-system-tables-example"></a><p class="title"><b>Example 14.13 InnoDB INFORMATION_SCHEMA System Tables</b></p>
<div class="example-contents">
<p>
        This example uses a simple table (<code class="literal">t1</code>) with a
        single index (<code class="literal">i1</code>) to demonstrate the type of
        metadata found in the <code class="literal">InnoDB</code>
        <code class="literal">INFORMATION_SCHEMA</code> system tables.
</p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p>
            Create a test database and table <code class="literal">t1</code>:
          </p><pre class="programlisting">mysql&gt; CREATE DATABASE test;

mysql&gt; USE test;

mysql&gt; CREATE TABLE t1 (
col1 INT, 
col2 CHAR(10), 
col3 VARCHAR(10))
ENGINE = InnoDB;

mysql&gt; CREATE INDEX i1 ON t1(col1);</pre></li><li class="listitem"><p>
            After creating the table <code class="literal">t1</code>, query
            <a class="link" href="information-schema.html#innodb-sys-tables-table" title="21.31.7 The INFORMATION_SCHEMA INNODB_SYS_TABLES Table"><code class="literal">INNODB_SYS_TABLES</code></a> to locate the
            metadata for <code class="literal">test/t1</code>:
          </p><pre class="programlisting">mysql&gt; SELECT * FROM INFORMATION_SCHEMA.INNODB_SYS_TABLES WHERE NAME='test/t1' \G

*************************** 1. row ***************************
     TABLE_ID: 71
         NAME: test/t1
         FLAG: 1
       N_COLS: 6
        SPACE: 57
  FILE_FORMAT: Antelope
   ROW_FORMAT: Compact
ZIP_PAGE_SIZE: 0
...</pre><p>
            Table <code class="literal">t1</code> has a
            <code class="literal">TABLE_ID</code> of 71. The
            <code class="literal">FLAG</code> field provides bit level information
            about table format and storage characteristics. There are
            six columns, three of which are hidden columns created by
            <code class="literal">InnoDB</code> (<code class="literal">DB_ROW_ID</code>,
            <code class="literal">DB_TRX_ID</code>, and
            <code class="literal">DB_ROLL_PTR</code>). The ID of the table's
            <code class="literal">SPACE</code> is 57 (a value of 0 would indicate
            that the table resides in the system tablespace). The
            <code class="literal">FILE_FORMAT</code> is Antelope, and the
            <code class="literal">ROW_FORMAT</code> is Compact.
            <code class="literal">ZIP_PAGE_SIZE</code> only applies to tables with
            a <code class="literal">Compressed</code> row format.
          </p></li><li class="listitem"><p>
            Using the <code class="literal">TABLE_ID</code> information from
            <a class="link" href="information-schema.html#innodb-sys-tables-table" title="21.31.7 The INFORMATION_SCHEMA INNODB_SYS_TABLES Table"><code class="literal">INNODB_SYS_TABLES</code></a>, query the
            <a class="link" href="information-schema.html#innodb-sys-columns-table" title="21.31.9 The INFORMATION_SCHEMA INNODB_SYS_COLUMNS Table"><code class="literal">INNODB_SYS_COLUMNS</code></a> table for
            information about the table's columns.
          </p><pre class="programlisting">mysql&gt; SELECT * FROM INFORMATION_SCHEMA.INNODB_SYS_COLUMNS where TABLE_ID = 71 \G 
*************************** 1. row ***************************
TABLE_ID: 71
    NAME: col1
     POS: 0
   MTYPE: 6
  PRTYPE: 1027
     LEN: 4
*************************** 2. row ***************************
TABLE_ID: 71
    NAME: col2
     POS: 1
   MTYPE: 2
  PRTYPE: 524542
     LEN: 10
*************************** 3. row ***************************
TABLE_ID: 71
    NAME: col3
     POS: 2
   MTYPE: 1
  PRTYPE: 524303
     LEN: 10</pre><p>
            In addition to the <code class="literal">TABLE_ID</code> and column
            <code class="literal">NAME</code>,
            <a class="link" href="information-schema.html#innodb-sys-columns-table" title="21.31.9 The INFORMATION_SCHEMA INNODB_SYS_COLUMNS Table"><code class="literal">INNODB_SYS_COLUMNS</code></a> provides the
            ordinal position (<code class="literal">POS</code>) of each column
            (starting from 0 and incrementing sequentially), the column
            <code class="literal">MTYPE</code> or <span class="quote">“<span class="quote">main type</span>”</span> (6 =
            INT, 2 = CHAR, 1 = VARCHAR), the <code class="literal">PRTYPE</code>
            or <span class="quote">“<span class="quote">precise type</span>”</span> (a binary value with bits
            that represent the MySQL data type, character set code, and
            nullability), and the column length
            (<code class="literal">LEN</code>).
          </p></li><li class="listitem"><p>
            Using the <code class="literal">TABLE_ID</code> information from
            <a class="link" href="information-schema.html#innodb-sys-tables-table" title="21.31.7 The INFORMATION_SCHEMA INNODB_SYS_TABLES Table"><code class="literal">INNODB_SYS_TABLES</code></a> once again,
            query <a class="link" href="information-schema.html#innodb-sys-indexes-table" title="21.31.8 The INFORMATION_SCHEMA INNODB_SYS_INDEXES Table"><code class="literal">INNODB_SYS_INDEXES</code></a> for
            information about the indexes associated with table
            <code class="literal">t1</code>.
          </p><pre class="programlisting">mysql&gt; SELECT * FROM INFORMATION_SCHEMA.INNODB_SYS_INDEXES WHERE TABLE_ID = 71 \G
*************************** 1. row ***************************
       INDEX_ID: 111
           NAME: GEN_CLUST_INDEX
       TABLE_ID: 71
           TYPE: 1
       N_FIELDS: 0
        PAGE_NO: 3
          SPACE: 57
MERGE_THRESHOLD: 50
*************************** 2. row ***************************
       INDEX_ID: 112
           NAME: i1
       TABLE_ID: 71
           TYPE: 0
       N_FIELDS: 1
        PAGE_NO: 4
          SPACE: 57
MERGE_THRESHOLD: 50</pre><p>
            <a class="link" href="information-schema.html#innodb-sys-indexes-table" title="21.31.8 The INFORMATION_SCHEMA INNODB_SYS_INDEXES Table"><code class="literal">INNODB_SYS_INDEXES</code></a> returns data
            for two indexes. The first index is
            <code class="literal">GEN_CLUST_INDEX</code>, which is a clustered
            index created by <code class="literal">InnoDB</code> if the table does
            not have a user-defined clustered index. The second index
            (<code class="literal">i1</code>) is the user-defined secondary index.
          </p><p>
            The <code class="literal">INDEX_ID</code> is an identifier for the
            index that is unique across all databases in an instance.
            The <code class="literal">TABLE_ID</code> identifies the table that
            the index is associated with. The index
            <code class="literal">TYPE</code> value indicates the type of index (1
            = Clustered Index, 0 = Secondary index). The
            <code class="literal">N_FILEDS</code> value is the number of fields
            that comprise the index. <code class="literal">PAGE_NO</code> is the
            root page number of the index B-tree, and
            <code class="literal">SPACE</code> is the ID of the tablespace where
            the index resides. A non-zero value indicates that the index
            does not reside in the system tablespace.
            <code class="literal">MERGE_THRESHOLD</code> defines a percentage
            threshold value for the amount of data in an index page. If
            the amount of data in an index page falls below the this
            value (the default is 50%) when a row is deleted or when a
            row is shortened by an update operation,
            <code class="literal">InnoDB</code> attempts to merge the index page
            with a neighboring index page.
          </p></li><li class="listitem"><p>
            Using the <code class="literal">INDEX_ID</code> information from
            <a class="link" href="information-schema.html#innodb-sys-indexes-table" title="21.31.8 The INFORMATION_SCHEMA INNODB_SYS_INDEXES Table"><code class="literal">INNODB_SYS_INDEXES</code></a>, query
            <a class="link" href="information-schema.html#innodb-sys-fields-table" title="21.31.10 The INFORMATION_SCHEMA INNODB_SYS_FIELDS Table"><code class="literal">INNODB_SYS_FIELDS</code></a> for
            information about the fields of index <code class="literal">i1</code>.
          </p><pre class="programlisting">mysql&gt; SELECT * FROM INFORMATION_SCHEMA.INNODB_SYS_FIELDS where INDEX_ID = 112 \G
*************************** 1. row ***************************
INDEX_ID: 112
    NAME: col1
     POS: 0</pre><p>
            <a class="link" href="information-schema.html#innodb-sys-fields-table" title="21.31.10 The INFORMATION_SCHEMA INNODB_SYS_FIELDS Table"><code class="literal">INNODB_SYS_FIELDS</code></a> provides the
            <code class="literal">NAME</code> of the indexed field and its ordinal
            position within the index. If the index (i1) had been
            defined on multiple fields,
            <a class="link" href="information-schema.html#innodb-sys-fields-table" title="21.31.10 The INFORMATION_SCHEMA INNODB_SYS_FIELDS Table"><code class="literal">INNODB_SYS_FIELDS</code></a> would provide
            metadata for each of the indexed fields.
          </p></li><li class="listitem"><p>
            Using the <code class="literal">SPACE</code> information from
            <a class="link" href="information-schema.html#innodb-sys-tables-table" title="21.31.7 The INFORMATION_SCHEMA INNODB_SYS_TABLES Table"><code class="literal">INNODB_SYS_TABLES</code></a>, query
            <a class="link" href="information-schema.html#innodb-sys-tablespaces-table" title="21.31.15 The INFORMATION_SCHEMA INNODB_SYS_TABLESPACES Table"><code class="literal">INNODB_SYS_TABLESPACES</code></a> table
            for information about the table's tablespace.
          </p><pre class="programlisting">mysql&gt; SELECT * FROM INFORMATION_SCHEMA.INNODB_SYS_TABLESPACES WHERE SPACE = 57 \G
*************************** 1. row ***************************
        SPACE: 57
         NAME: test/t1
         FLAG: 0
  FILE_FORMAT: Antelope
   ROW_FORMAT: Compact or Redundant
    PAGE_SIZE: 16384
ZIP_PAGE_SIZE: 0</pre><p>
            In addition to the <code class="literal">SPACE</code> ID of the
            tablespace and the <code class="literal">NAME</code> of the associated
            table, <a class="link" href="information-schema.html#innodb-sys-tablespaces-table" title="21.31.15 The INFORMATION_SCHEMA INNODB_SYS_TABLESPACES Table"><code class="literal">INNODB_SYS_TABLESPACES</code></a>
            provides tablespace <code class="literal">FLAG</code> data, which is
            bit level information about tablespace format and storage
            characteristics. Also provided are tablespace
            <code class="literal">FILE_FORMAT</code>,
            <code class="literal">ROW_FORMAT</code>, <code class="literal">PAGE_SIZE</code>,
            and <code class="literal">ZIP_PAGE_SIZE</code> data
            (<code class="literal">ZIP_PAGE_SIZE</code> is applicable to
            tablespaces with a <code class="literal">Compressed</code> row
            format).
          </p></li><li class="listitem"><p>
            Using the <code class="literal">SPACE</code> information from
            <a class="link" href="information-schema.html#innodb-sys-tables-table" title="21.31.7 The INFORMATION_SCHEMA INNODB_SYS_TABLES Table"><code class="literal">INNODB_SYS_TABLES</code></a> once again,
            query <a class="link" href="information-schema.html#innodb-sys-datafiles-table" title="21.31.14 The INFORMATION_SCHEMA INNODB_SYS_DATAFILES Table"><code class="literal">INNODB_SYS_DATAFILES</code></a> for
            the location of the tablespace data file.
          </p><pre class="programlisting">mysql&gt; SELECT * FROM INFORMATION_SCHEMA.INNODB_SYS_DATAFILES WHERE SPACE = 57 \G 
*************************** 1. row ***************************
SPACE: 57
 PATH: ./test/t1.ibd</pre><p>
            The datafile is located in the <code class="literal">test</code>
            directory under MySQL's <code class="literal">data</code> directory.
            If a
            <a class="link" href="glossary.html#glos_file_per_table" title="file-per-table">file-per-table</a>
            tablespace were created in a location outside the MySQL data
            directory using the <code class="literal">DATA DIRECTORY</code> clause
            of the <a class="link" href="sql-syntax.html#create-table" title="13.1.18 CREATE TABLE Syntax"><code class="literal">CREATE TABLE</code></a>
            statement, the tablespace <code class="literal">PATH</code> would be a
            fully qualified directory path.
          </p></li><li class="listitem"><p>
            As a final step, insert a row into table
            <code class="literal">t1</code> (<code class="literal">TABLE_ID = 71</code>) and
            view the data in the
            <a class="link" href="information-schema.html#innodb-sys-tablestats-table" title="21.31.13 The INFORMATION_SCHEMA INNODB_SYS_TABLESTATS View"><code class="literal">INNODB_SYS_TABLESTATS</code></a> table.
            The data in this table is used by the MySQL optimizer to
            calculate which index to use when querying an
            <code class="literal">InnoDB</code> table. This information is derived
            from in-memory data structures. There is no corresponding
            internal <code class="literal">InnoDB</code> system table.
          </p><pre class="programlisting">mysql&gt; INSERT INTO t1 VALUES(5, 'abc', 'def');
Query OK, 1 row affected (0.06 sec)

mysql&gt; SELECT * FROM INFORMATION_SCHEMA.INNODB_SYS_TABLESTATS where TABLE_ID = 71 \G
*************************** 1. row ***************************
         TABLE_ID: 71
             NAME: test/t1
STATS_INITIALIZED: Initialized
         NUM_ROWS: 1
 CLUST_INDEX_SIZE: 1
 OTHER_INDEX_SIZE: 0
 MODIFIED_COUNTER: 1
          AUTOINC: 0
        REF_COUNT: 1</pre><p>
            The <code class="literal">STATS_INITIALIZED</code> field indicates
            whether or not statistics have been collected for the table.
            <code class="literal">NUM_ROWS</code> is the current estimated number
            of rows in the table. The
            <code class="literal">CLUST_INDEX_SIZE</code> and
            <code class="literal">OTHER_INDEX_SIZE</code> fields report the number
            of pages on disk that store clustered and secondary indexes
            for the table, respectively. The
            <code class="literal">MODIFIED_COUNTER</code> value shows the number
            of rows modified by DML operations and cascade operations
            from foreign keys. The <code class="literal">AUTOINC</code> value is
            the next number to be issued for any autoincrement-based
            operation. There are no autoincrement columns defined on
            table <code class="literal">t1</code>, so the value is 0. The
            <code class="literal">REF_COUNT</code> value is a counter. When the
            counter reaches 0, it signifies that the table metadata can
            be evicted from the table cache.
</p></li></ol>
</div>

</div>

</div>
<br class="example-break">
<div class="example">
<a name="innodb-information-schema-fk-system-tables-example"></a><p class="title"><b>Example 14.14 Foreign Key INFORMATION_SCHEMA System Tables</b></p>
<div class="example-contents">
<p>
        The <a class="link" href="information-schema.html#innodb-sys-foreign-table" title="21.31.11 The INFORMATION_SCHEMA INNODB_SYS_FOREIGN Table"><code class="literal">INNODB_SYS_FOREIGN</code></a> and
        <a class="link" href="information-schema.html#innodb-sys-foreign-cols-table" title="21.31.12 The INFORMATION_SCHEMA INNODB_SYS_FOREIGN_COLS Table"><code class="literal">INNODB_SYS_FOREIGN_COLS</code></a> tables
        provide data about foreign key relationships. This example uses
        a parent table and child table with a foreign key relationship
        to demonstrate the data found in the
        <a class="link" href="information-schema.html#innodb-sys-foreign-table" title="21.31.11 The INFORMATION_SCHEMA INNODB_SYS_FOREIGN Table"><code class="literal">INNODB_SYS_FOREIGN</code></a> and
        <a class="link" href="information-schema.html#innodb-sys-foreign-cols-table" title="21.31.12 The INFORMATION_SCHEMA INNODB_SYS_FOREIGN_COLS Table"><code class="literal">INNODB_SYS_FOREIGN_COLS</code></a> tables.
</p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p>
            Create the test database with parent and child tables:
          </p><pre class="programlisting">mysql&gt; CREATE DATABASE test;

mysql&gt; USE test;

mysql&gt; CREATE TABLE parent (id INT NOT NULL,
    -&gt; PRIMARY KEY (id)) ENGINE=INNODB;

mysql&gt; CREATE TABLE child (id INT, parent_id INT,
    -&gt; INDEX par_ind (parent_id),
    -&gt; CONSTRAINT fk1
    -&gt; FOREIGN KEY (parent_id) REFERENCES parent(id)
    -&gt; ON DELETE CASCADE) ENGINE=INNODB;</pre></li><li class="listitem"><p>
            After the parent and child tables are created, query
            <a class="link" href="information-schema.html#innodb-sys-foreign-table" title="21.31.11 The INFORMATION_SCHEMA INNODB_SYS_FOREIGN Table"><code class="literal">INNODB_SYS_FOREIGN</code></a> and locate
            the foreign key data for the <code class="literal">test/child</code>
            and <code class="literal">test/parent</code> foreign key relationship:
          </p><pre class="programlisting">mysql&gt; SELECT * FROM INFORMATION_SCHEMA.INNODB_SYS_FOREIGN \G
*************************** 1. row ***************************
      ID: test/fk1
FOR_NAME: test/child
REF_NAME: test/parent
  N_COLS: 1
    TYPE: 1</pre><p>
            Metadata includes the foreign key <code class="literal">ID</code>
            (<code class="literal">fk1</code>), which is named for the
            <code class="literal">CONSTRAINT</code> that was defined on the child
            table. The <code class="literal">FOR_NAME</code> is the name of the
            child table where the foreign key is defined.
            <code class="literal">REF_NAME</code> is the name of the parent table
            (the <span class="quote">“<span class="quote">referenced</span>”</span> table).
            <code class="literal">N_COLS</code> is the number of columns in the
            foreign key index. <code class="literal">TYPE</code> is a numerical
            value representing bit flags that provide additional
            information about the foreign key column. In this case, the
            <code class="literal">TYPE</code> value is 1, which indicates that the
            <code class="literal">ON DELETE CASCADE</code> option was specified
            for the foreign key. See the
            <a class="link" href="information-schema.html#innodb-sys-foreign-table" title="21.31.11 The INFORMATION_SCHEMA INNODB_SYS_FOREIGN Table"><code class="literal">INNODB_SYS_FOREIGN</code></a> table
            definition for more information about
            <code class="literal">TYPE</code> values.
          </p></li><li class="listitem"><p>
            Using the foreign key <code class="literal">ID</code>, query
            <a class="link" href="information-schema.html#innodb-sys-foreign-cols-table" title="21.31.12 The INFORMATION_SCHEMA INNODB_SYS_FOREIGN_COLS Table"><code class="literal">INNODB_SYS_FOREIGN_COLS</code></a> to view
            data about the columns of the foreign key.
          </p><pre class="programlisting">mysql&gt; SELECT * FROM INFORMATION_SCHEMA.INNODB_SYS_FOREIGN_COLS WHERE ID = 'test/fk1' \G
*************************** 1. row ***************************
          ID: test/fk1
FOR_COL_NAME: parent_id
REF_COL_NAME: id
         POS: 0</pre><p>
            <code class="literal">FOR_COL_NAME</code> is the name of the foreign
            key column in the child table, and
            <code class="literal">REF_COL_NAME</code> is the name of the
            referenced column in the parent table. The
            <code class="literal">POS</code> value is the ordinal position of the
            key field within the foreign key index, starting at zero.
</p></li></ol>
</div>

</div>

</div>
<br class="example-break">
<div class="example">
<a name="innodb-information-schema-system-tables-join-example"></a><p class="title"><b>Example 14.15 Joining InnoDB INFORMATION_SCHEMA System Tables</b></p>
<div class="example-contents">
<p>
        This example demonstrates joining three
        <code class="literal">InnoDB</code> <code class="literal">INFORMATION_SCHEMA</code>
        system tables (<a class="link" href="information-schema.html#innodb-sys-tables-table" title="21.31.7 The INFORMATION_SCHEMA INNODB_SYS_TABLES Table"><code class="literal">INNODB_SYS_TABLES</code></a>,
        <a class="link" href="information-schema.html#innodb-sys-tablespaces-table" title="21.31.15 The INFORMATION_SCHEMA INNODB_SYS_TABLESPACES Table"><code class="literal">INNODB_SYS_TABLESPACES</code></a>, and
        <a class="link" href="information-schema.html#innodb-sys-tablestats-table" title="21.31.13 The INFORMATION_SCHEMA INNODB_SYS_TABLESTATS View"><code class="literal">INNODB_SYS_TABLESTATS</code></a>) to gather
        file format, row format, page size, and index size information
        about tables in the employees sample database.
      </p><p>
        The following table name aliases are used to shorten the query
        string:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <a class="link" href="information-schema.html#innodb-sys-tables-table" title="21.31.7 The INFORMATION_SCHEMA INNODB_SYS_TABLES Table"><code class="literal">INFORMATION_SCHEMA.INNODB_SYS_TABLES</code></a>:
            a
          </p></li><li class="listitem"><p>
            <a class="link" href="information-schema.html#innodb-sys-tablespaces-table" title="21.31.15 The INFORMATION_SCHEMA INNODB_SYS_TABLESPACES Table"><code class="literal">INFORMATION_SCHEMA.INNODB_SYS_TABLESPACES</code></a>:
            b
          </p></li><li class="listitem"><p>
            <a class="link" href="information-schema.html#innodb-sys-tablestats-table" title="21.31.13 The INFORMATION_SCHEMA INNODB_SYS_TABLESTATS View"><code class="literal">INFORMATION_SCHEMA.INNODB_SYS_TABLESTATS</code></a>:
            c
</p></li></ul>
</div>
<p>
        An <a class="link" href="functions.html#function_if"><code class="literal">IF()</code></a> control flow function is
        used to account for compressed tables. If a table is compressed,
        the index size is calculated using
        <code class="literal">ZIP_PAGE_SIZE</code> rather than
        <code class="literal">PAGE_SIZE</code>.
        <code class="literal">CLUST_INDEX_SIZE</code> and
        <code class="literal">OTHER_INDEX_SIZE</code>, which are reported in
        bytes, are divided by <code class="literal">1024*1024</code> to provide
        index sizes in megabytes (MBs). MB values are rounded to zero
        decimal spaces using the <a class="link" href="functions.html#function_round"><code class="literal">ROUND()</code></a>
        function.
      </p><pre class="programlisting">mysql&gt; SELECT a.NAME, a.FILE_FORMAT, a.ROW_FORMAT,
 @page_size :=
  IF(a.ROW_FORMAT='Compressed',
   b.ZIP_PAGE_SIZE, b.PAGE_SIZE)
   AS page_size,
  ROUND((@page_size * c.CLUST_INDEX_SIZE)
   /(1024*1024)) AS pk_mb,
  ROUND((@page_size * c.OTHER_INDEX_SIZE)
   /(1024*1024)) AS secidx_mb
FROM INFORMATION_SCHEMA.INNODB_SYS_TABLES a
INNER JOIN INFORMATION_SCHEMA.INNODB_SYS_TABLESPACES b on a.NAME = b.NAME
INNER JOIN INFORMATION_SCHEMA.INNODB_SYS_TABLESTATS c on b.NAME = c.NAME 
WHERE a.NAME LIKE 'employees/%'
ORDER BY a.NAME DESC;
+------------------------+-------------+------------+-----------+-------+-----------+
| NAME                   | FILE_FORMAT | ROW_FORMAT | page_size | pk_mb | secidx_mb |
+------------------------+-------------+------------+-----------+-------+-----------+
| employees/titles       | Antelope    | Compact    |     16384 |    20 |        11 |
| employees/salaries     | Antelope    | Compact    |     16384 |    91 |        33 |
| employees/employees    | Antelope    | Compact    |     16384 |    15 |         0 |
| employees/dept_manager | Antelope    | Compact    |     16384 |     0 |         0 |
| employees/dept_emp     | Antelope    | Compact    |     16384 |    12 |        10 |
| employees/departments  | Antelope    | Compact    |     16384 |     0 |         0 |
+------------------------+-------------+------------+-----------+-------+-----------+</pre>
</div>

</div>
<br class="example-break">
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="innodb-information-schema-fulltext_index-tables"></a>14.12.4 InnoDB INFORMATION_SCHEMA FULLTEXT Index Tables</h3>

</div>

</div>

</div>
<p>
      With the introduction of <code class="literal">FULLTEXT</code> index support
      for <code class="literal">InnoDB</code> tables in MySQL 5.6.4, the following
      tables were added to the <code class="literal">INFORMATION_SCHEMA</code>
      database:
    </p><pre class="programlisting">mysql&gt; SHOW TABLES FROM INFORMATION_SCHEMA LIKE 'INNODB_FT%';
+-------------------------------------------+
| Tables_in_INFORMATION_SCHEMA (INNODB_FT%) |
+-------------------------------------------+
| INNODB_FT_CONFIG                          |
| INNODB_FT_BEING_DELETED                   |
| INNODB_FT_DELETED                         |
| INNODB_FT_DEFAULT_STOPWORD                |
| INNODB_FT_INDEX_TABLE                     |
| INNODB_FT_INDEX_CACHE                     |
+-------------------------------------------+</pre>
<div class="itemizedlist">
<h4><a name="idm140644102611216"></a>Table Overview</h4>
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          <a class="link" href="information-schema.html#innodb-ft-config-table" title="21.31.21 The INFORMATION_SCHEMA INNODB_FT_CONFIG Table"><code class="literal">INNODB_FT_CONFIG</code></a>: Displays
          metadata about the <code class="literal">FULLTEXT</code> index and
          associated processing for an <code class="literal">InnoDB</code> table.
        </p></li><li class="listitem"><p>
          <a class="link" href="information-schema.html#innodb-ft-being-deleted-table" title="21.31.26 The INFORMATION_SCHEMA INNODB_FT_BEING_DELETED Table"><code class="literal">INNODB_FT_BEING_DELETED</code></a>: Provides
          a snapshot of the
          <a class="link" href="information-schema.html#innodb-ft-deleted-table" title="21.31.25 The INFORMATION_SCHEMA INNODB_FT_DELETED Table"><code class="literal">INNODB_FT_DELETED</code></a> table that is
          only used during an <a class="link" href="sql-syntax.html#optimize-table" title="13.7.2.4 OPTIMIZE TABLE Syntax"><code class="literal">OPTIMIZE
          TABLE</code></a> maintenance operation. When
          <a class="link" href="sql-syntax.html#optimize-table" title="13.7.2.4 OPTIMIZE TABLE Syntax"><code class="literal">OPTIMIZE TABLE</code></a> is run, the
          <a class="link" href="information-schema.html#innodb-ft-being-deleted-table" title="21.31.26 The INFORMATION_SCHEMA INNODB_FT_BEING_DELETED Table"><code class="literal">INNODB_FT_BEING_DELETED</code></a> table is
          emptied, and DOC_IDs are removed from the
          <a class="link" href="information-schema.html#innodb-ft-deleted-table" title="21.31.25 The INFORMATION_SCHEMA INNODB_FT_DELETED Table"><code class="literal">INNODB_FT_DELETED</code></a> table. Because
          the contents of
          <a class="link" href="information-schema.html#innodb-ft-being-deleted-table" title="21.31.26 The INFORMATION_SCHEMA INNODB_FT_BEING_DELETED Table"><code class="literal">INNODB_FT_BEING_DELETED</code></a> typically
          have a short lifetime, this table has limited utility for
          monitoring or debugging. For information about running
          <a class="link" href="sql-syntax.html#optimize-table" title="13.7.2.4 OPTIMIZE TABLE Syntax"><code class="literal">OPTIMIZE TABLE</code></a> on tables with
          <code class="literal">FULLTEXT</code> indexes, see
          <a class="xref" href="functions.html#fulltext-fine-tuning" title="12.9.6 Fine-Tuning MySQL Full-Text Search">Section 12.9.6, “Fine-Tuning MySQL Full-Text Search”</a>.
        </p></li><li class="listitem"><p>
          <a class="link" href="information-schema.html#innodb-ft-deleted-table" title="21.31.25 The INFORMATION_SCHEMA INNODB_FT_DELETED Table"><code class="literal">INNODB_FT_DELETED</code></a>: Records rows
          that are deleted from the <code class="literal">FULLTEXT</code> index
          for an <code class="literal">InnoDB</code> table. To avoid expensive
          index reorganization during DML operations for an
          <code class="literal">InnoDB</code> <code class="literal">FULLTEXT</code> index,
          the information about newly deleted words is stored
          separately, filtered out of search results when you perform a
          text search, and removed from the main search index only when
          you run <a class="link" href="sql-syntax.html#optimize-table" title="13.7.2.4 OPTIMIZE TABLE Syntax"><code class="literal">OPTIMIZE TABLE</code></a>.
        </p></li><li class="listitem"><p>
          <a class="link" href="information-schema.html#innodb-ft-default-stopword-table" title="21.31.22 The INFORMATION_SCHEMA INNODB_FT_DEFAULT_STOPWORD Table"><code class="literal">INNODB_FT_DEFAULT_STOPWORD</code></a>: Holds
          a list of <a class="link" href="glossary.html#glos_stopword" title="stopword">stopwords</a> that
          are used by default when creating a
          <code class="literal">FULLTEXT</code> index.
        </p><p>
          For information about the
          <a class="link" href="information-schema.html#innodb-ft-default-stopword-table" title="21.31.22 The INFORMATION_SCHEMA INNODB_FT_DEFAULT_STOPWORD Table"><code class="literal">INNODB_FT_DEFAULT_STOPWORD</code></a> table,
          see <a class="xref" href="functions.html#fulltext-stopwords" title="12.9.4 Full-Text Stopwords">Section 12.9.4, “Full-Text Stopwords”</a>.
        </p></li><li class="listitem"><p>
          <a class="link" href="information-schema.html#innodb-ft-index-table-table" title="21.31.23 The INFORMATION_SCHEMA INNODB_FT_INDEX_TABLE Table"><code class="literal">INNODB_FT_INDEX_TABLE</code></a>: Contains
          data about the inverted index used to process text searches
          against the <code class="literal">FULLTEXT</code> index.
        </p></li><li class="listitem"><p>
          <a class="link" href="information-schema.html#innodb-ft-index-cache-table" title="21.31.24 The INFORMATION_SCHEMA INNODB_FT_INDEX_CACHE Table"><code class="literal">INNODB_FT_INDEX_CACHE</code></a>: Contains
          token information about newly inserted rows in a
          <code class="literal">FULLTEXT</code> index. To avoid expensive index
          reorganization during DML operations, the information about
          newly indexed words is stored separately, and combined with
          the main search index only when <a class="link" href="sql-syntax.html#optimize-table" title="13.7.2.4 OPTIMIZE TABLE Syntax"><code class="literal">OPTIMIZE
          TABLE</code></a> is run, when the server is shut down, or when
          the cache size exceeds a limit defined by
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_ft_cache_size"><code class="literal">innodb_ft_cache_size</code></a> or
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_ft_total_cache_size"><code class="literal">innodb_ft_total_cache_size</code></a>.
</p></li></ul>
</div>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">
<div class="admon-title">
Note
</div>
<p>
        With the exception of the
        <a class="link" href="information-schema.html#innodb-ft-default-stopword-table" title="21.31.22 The INFORMATION_SCHEMA INNODB_FT_DEFAULT_STOPWORD Table"><code class="literal">INNODB_FT_DEFAULT_STOPWORD</code></a> table,
        you must set the
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_ft_aux_table"><code class="literal">innodb_ft_aux_table</code></a>
        configuration variable to the name of the table
        (<em class="replaceable"><code>database_name</code></em>/<em class="replaceable"><code>table_name</code></em>)
        that contains the <code class="literal">FULLTEXT</code> index. Otherwise,
        the <code class="literal">InnoDB</code> <code class="literal">FULLTEXT</code> index
        <code class="literal">INFORMATION_SCHEMA</code> tables appear empty.
</p>
</div>

<div class="example">
<a name="innodb-information-schema-fulltext-tables-example"></a><p class="title"><b>Example 14.16 InnoDB FULLTEXT Index INFORMATION_SCHEMA Tables</b></p>
<div class="example-contents">
<p>
        This example uses a table with a <code class="literal">FULLTEXT</code>
        index to demonstrate the data contained in the
        <code class="literal">FULLTEXT</code> index
        <code class="literal">INFORMATION_SCHEMA</code> tables.
</p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p>
            Create a table with a <code class="literal">FULLTEXT</code> index and
            insert some data:
          </p><pre class="programlisting">mysql&gt; CREATE TABLE articles (
      id INT UNSIGNED AUTO_INCREMENT NOT NULL PRIMARY KEY,
      title VARCHAR(200),
      body TEXT,
      FULLTEXT (title,body)
     ) ENGINE=InnoDB;

INSERT INTO articles (title,body) VALUES
    ('MySQL Tutorial','DBMS stands for DataBase ...'),
    ('How To Use MySQL Well','After you went through a ...'),
    ('Optimizing MySQL','In this tutorial we will show ...'),
    ('1001 MySQL Tricks','1. Never run mysqld as root. 2. ...'),
    ('MySQL vs. YourSQL','In the following database comparison ...'),
    ('MySQL Security','When configured properly, MySQL ...');</pre></li><li class="listitem"><p>
            Set the <a class="link" href="innodb-storage-engine.html#sysvar_innodb_ft_aux_table"><code class="literal">innodb_ft_aux_table</code></a>
            variable to the name of the table with the
            <code class="literal">FULLTEXT</code> index. If this variable is not
            set, the <code class="literal">InnoDB</code>
            <code class="literal">FULLTEXT</code>
            <code class="literal">INFORMATION_SCHEMA</code> tables appear empty,
            with the exception of the
            <a class="link" href="information-schema.html#innodb-ft-default-stopword-table" title="21.31.22 The INFORMATION_SCHEMA INNODB_FT_DEFAULT_STOPWORD Table"><code class="literal">INNODB_FT_DEFAULT_STOPWORD</code></a>
            table.
          </p><pre class="programlisting">SET GLOBAL innodb_ft_aux_table = 'test/articles';</pre></li><li class="listitem"><p>
            Query the <a class="link" href="information-schema.html#innodb-ft-index-cache-table" title="21.31.24 The INFORMATION_SCHEMA INNODB_FT_INDEX_CACHE Table"><code class="literal">INNODB_FT_INDEX_CACHE</code></a>
            table, which shows information about newly inserted rows in
            a <code class="literal">FULLTEXT</code> index. To avoid expensive
            index reorganization during DML operations, data for newly
            inserted rows remains in the <code class="literal">FULLTEXT</code>
            index cache until <a class="link" href="sql-syntax.html#optimize-table" title="13.7.2.4 OPTIMIZE TABLE Syntax"><code class="literal">OPTIMIZE
            TABLE</code></a> is run (or until the server is shutdown or
            cache limits are exceeded).
          </p><pre class="programlisting">mysql&gt; SELECT * FROM INFORMATION_SCHEMA.INNODB_FT_INDEX_CACHE LIMIT 5;
+------------+--------------+-------------+-----------+--------+----------+
| WORD       | FIRST_DOC_ID | LAST_DOC_ID | DOC_COUNT | DOC_ID | POSITION |
+------------+--------------+-------------+-----------+--------+----------+
| 1001       |            5 |           5 |         1 |      5 |        0 |
| after      |            3 |           3 |         1 |      3 |       22 |
| comparison |            6 |           6 |         1 |      6 |       44 |
| configured |            7 |           7 |         1 |      7 |       20 |
| database   |            2 |           6 |         2 |      2 |       31 |
+------------+--------------+-------------+-----------+--------+----------+</pre></li><li class="listitem"><p>
            Enable
            <a class="link" href="innodb-storage-engine.html#sysvar_innodb_optimize_fulltext_only"><code class="literal">innodb_optimize_fulltext_only</code></a>
            and run <a class="link" href="sql-syntax.html#optimize-table" title="13.7.2.4 OPTIMIZE TABLE Syntax"><code class="literal">OPTIMIZE TABLE</code></a> on the
            table that contains the <code class="literal">FULLTEXT</code> index.
            This operation flushes the contents of the
            <code class="literal">FULLTEXT</code> index cache to the main
            <code class="literal">FULLTEXT</code> index.
            <a class="link" href="innodb-storage-engine.html#sysvar_innodb_optimize_fulltext_only"><code class="literal">innodb_optimize_fulltext_only</code></a>
            changes the way the <a class="link" href="sql-syntax.html#optimize-table" title="13.7.2.4 OPTIMIZE TABLE Syntax"><code class="literal">OPTIMIZE
            TABLE</code></a> statement operates on
            <code class="literal">InnoDB</code> tables, and is intended to be
            enabled temporarily, during maintenance operations on
            <code class="literal">InnoDB</code> tables with
            <code class="literal">FULLTEXT</code> indexes.
          </p><pre class="programlisting">mysql&gt; SET GLOBAL innodb_optimize_fulltext_only=ON;
Query OK, 0 rows affected (0.00 sec)

mysql&gt; OPTIMIZE TABLE articles;
+---------------+----------+----------+----------+
| Table         | Op       | Msg_type | Msg_text |
+---------------+----------+----------+----------+
| test.articles | optimize | status   | OK       |
+---------------+----------+----------+----------+</pre></li><li class="listitem"><p>
            Query the <a class="link" href="information-schema.html#innodb-ft-index-table-table" title="21.31.23 The INFORMATION_SCHEMA INNODB_FT_INDEX_TABLE Table"><code class="literal">INNODB_FT_INDEX_TABLE</code></a>
            table to view information about data in the main
            <code class="literal">FULLTEXT</code> index, including information
            about the data that was just flushed from the
            <code class="literal">FULLTEXT</code> index cache.
          </p><pre class="programlisting">mysql&gt; SELECT * FROM INFORMATION_SCHEMA.INNODB_FT_INDEX_TABLE LIMIT 5;
+------------+--------------+-------------+-----------+--------+----------+
| WORD       | FIRST_DOC_ID | LAST_DOC_ID | DOC_COUNT | DOC_ID | POSITION |
+------------+--------------+-------------+-----------+--------+----------+
| 1001       |            5 |           5 |         1 |      5 |        0 |
| after      |            3 |           3 |         1 |      3 |       22 |
| comparison |            6 |           6 |         1 |      6 |       44 |
| configured |            7 |           7 |         1 |      7 |       20 |
| database   |            2 |           6 |         2 |      2 |       31 |
+------------+--------------+-------------+-----------+--------+----------+</pre><p>
            The <a class="link" href="information-schema.html#innodb-ft-index-cache-table" title="21.31.24 The INFORMATION_SCHEMA INNODB_FT_INDEX_CACHE Table"><code class="literal">INNODB_FT_INDEX_CACHE</code></a> table
            is now empty since the <a class="link" href="sql-syntax.html#optimize-table" title="13.7.2.4 OPTIMIZE TABLE Syntax"><code class="literal">OPTIMIZE
            TABLE</code></a> operation flushed the
            <code class="literal">FULLTEXT</code> index cache.
          </p><pre class="programlisting">mysql&gt; SELECT * FROM INFORMATION_SCHEMA.INNODB_FT_INDEX_CACHE LIMIT 5;
Empty set (0.00 sec)</pre></li><li class="listitem"><p>
            Delete some records from the
            <code class="literal">test/articles</code> table.
          </p><pre class="programlisting">mysql&gt; DELETE FROM test.articles WHERE id &lt; 4;
Query OK, 3 rows affected (0.11 sec)</pre></li><li class="listitem"><p>
            Query the <a class="link" href="information-schema.html#innodb-ft-deleted-table" title="21.31.25 The INFORMATION_SCHEMA INNODB_FT_DELETED Table"><code class="literal">INNODB_FT_DELETED</code></a>
            table. This table records rows that are deleted from the
            <code class="literal">FULLTEXT</code> index. To avoid expensive index
            reorganization during DML operations, information about
            newly deleted records is stored separately, filtered out of
            search results when you do a text search, and removed from
            the main search index when you run
            <a class="link" href="sql-syntax.html#optimize-table" title="13.7.2.4 OPTIMIZE TABLE Syntax"><code class="literal">OPTIMIZE TABLE</code></a>.
          </p><pre class="programlisting">mysql&gt; SELECT * FROM INFORMATION_SCHEMA.INNODB_FT_DELETED;
+--------+
| DOC_ID |
+--------+
|      2 |
|      3 |
|      4 |
+--------+</pre></li><li class="listitem"><p>
            Run <a class="link" href="sql-syntax.html#optimize-table" title="13.7.2.4 OPTIMIZE TABLE Syntax"><code class="literal">OPTIMIZE TABLE</code></a> to remove
            the deleted records.
          </p><pre class="programlisting">mysql&gt; OPTIMIZE TABLE articles;
+---------------+----------+----------+----------+
| Table         | Op       | Msg_type | Msg_text |
+---------------+----------+----------+----------+
| test.articles | optimize | status   | OK       |
+---------------+----------+----------+----------+</pre><p>
            The <a class="link" href="information-schema.html#innodb-ft-deleted-table" title="21.31.25 The INFORMATION_SCHEMA INNODB_FT_DELETED Table"><code class="literal">INNODB_FT_DELETED</code></a> table
            should now appear empty.
          </p><pre class="programlisting">mysql&gt; SELECT * FROM INFORMATION_SCHEMA.INNODB_FT_DELETED;
Empty set (0.00 sec)</pre></li><li class="listitem"><p>
            Query the <a class="link" href="information-schema.html#innodb-ft-config-table" title="21.31.21 The INFORMATION_SCHEMA INNODB_FT_CONFIG Table"><code class="literal">INNODB_FT_CONFIG</code></a>
            table. This table contains metadata about the
            <code class="literal">FULLTEXT</code> index and related processing:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
                <code class="literal">optimize_checkpoint_limit</code> is the
                number of seconds after which an
                <a class="link" href="sql-syntax.html#optimize-table" title="13.7.2.4 OPTIMIZE TABLE Syntax"><code class="literal">OPTIMIZE TABLE</code></a> run will
                stop.
              </p></li><li class="listitem"><p>
                <code class="literal">synced_doc_id</code> is the next
                <code class="literal">DOC_ID</code> to be issued.
              </p></li><li class="listitem"><p>
                <code class="literal">stopword_table_name</code> is the
                <em class="replaceable"><code>database/table</code></em> name for a
                user-defined stopword table. This field appears empty if
                there is no user-defined stopword table.
              </p></li><li class="listitem"><p>
                <code class="literal">use_stopword</code> indicates whether or not
                a stopword table is used, which is defined when the
                <code class="literal">FULLTEXT</code> index is created.
</p></li></ul>
</div>
<pre class="programlisting">mysql&gt; SELECT * FROM INFORMATION_SCHEMA.INNODB_FT_CONFIG;
+---------------------------+-------+
| KEY                       | VALUE |
+---------------------------+-------+
| optimize_checkpoint_limit | 180   |
| synced_doc_id             | 8     |
| stopword_table_name       |       |
| use_stopword              | 1     |
+---------------------------+-------+</pre></li></ol>
</div>

</div>

</div>
<br class="example-break">
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="innodb-information-schema-buffer-pool-tables"></a>14.12.5 InnoDB INFORMATION_SCHEMA Buffer Pool Tables</h3>

</div>

</div>

</div>
<p>
      The <code class="literal">InnoDB</code>
      <code class="literal">INFORMATION_SCHEMA</code> buffer pool tables provide
      buffer pool status information and metadata about the pages within
      the <code class="literal">InnoDB</code> buffer pool. The tables were
      introduced in MySQL 5.6.2 and later backported to MySQL 5.5 (in
      MySQL 5.5.28) and MySQL 5.1 (in MySQL 5.1.66).
    </p><p>
      The <code class="literal">InnoDB</code>
      <code class="literal">INFORMATION_SCHEMA</code> buffer pool tables include
      those listed below:
    </p><pre class="programlisting">mysql&gt; SHOW TABLES FROM INFORMATION_SCHEMA LIKE 'INNODB_BUFFER%';
+-----------------------------------------------+
| Tables_in_INFORMATION_SCHEMA (INNODB_BUFFER%) |
+-----------------------------------------------+
| INNODB_BUFFER_PAGE_LRU                        |
| INNODB_BUFFER_PAGE                            |
| INNODB_BUFFER_POOL_STATS                      |
+-----------------------------------------------+</pre>
<h4><a name="idm140644102484752"></a>Table Overview</h4>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          <a class="link" href="information-schema.html#innodb-buffer-page-table" title="21.31.17 The INFORMATION_SCHEMA INNODB_BUFFER_PAGE Table"><code class="literal">INNODB_BUFFER_PAGE</code></a>: Holds
          information about each page in the <code class="literal">InnoDB</code>
          buffer pool.
        </p></li><li class="listitem"><p>
          <a class="link" href="information-schema.html#innodb-buffer-page-lru-table" title="21.31.18 The INFORMATION_SCHEMA INNODB_BUFFER_PAGE_LRU Table"><code class="literal">INNODB_BUFFER_PAGE_LRU</code></a>: Holds
          information about the pages in the <code class="literal">InnoDB</code>
          buffer pool, in particular how they are ordered in the LRU
          list that determines which pages to evict from the buffer pool
          when it becomes full. The
          <a class="link" href="information-schema.html#innodb-buffer-page-lru-table" title="21.31.18 The INFORMATION_SCHEMA INNODB_BUFFER_PAGE_LRU Table"><code class="literal">INNODB_BUFFER_PAGE_LRU</code></a> table has
          the same columns as the
          <a class="link" href="information-schema.html#innodb-buffer-page-table" title="21.31.17 The INFORMATION_SCHEMA INNODB_BUFFER_PAGE Table"><code class="literal">INNODB_BUFFER_PAGE</code></a> table, except
          that the <a class="link" href="information-schema.html#innodb-buffer-page-lru-table" title="21.31.18 The INFORMATION_SCHEMA INNODB_BUFFER_PAGE_LRU Table"><code class="literal">INNODB_BUFFER_PAGE_LRU</code></a>
          table has an <code class="literal">LRU_POSITION</code> column instead of
          a <code class="literal">BLOCK_ID</code> column.
        </p></li><li class="listitem"><p>
          <a class="link" href="information-schema.html#innodb-buffer-pool-stats-table" title="21.31.19 The INFORMATION_SCHEMA INNODB_BUFFER_POOL_STATS Table"><code class="literal">INNODB_BUFFER_POOL_STATS</code></a>:
          Provides buffer pool status information. Much of the same
          information is provided by
          <a class="link" href="sql-syntax.html#show-engine" title="13.7.5.15 SHOW ENGINE Syntax"><code class="literal">SHOW ENGINE
          INNODB STATUS</code></a> output, or may be obtained using
          <code class="literal">InnoDB</code> buffer pool server status variables.
</p></li></ul>
</div>
<div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;">
<div class="admon-title">
Warning
</div>
<p>
        Querying the <a class="link" href="information-schema.html#innodb-buffer-page-table" title="21.31.17 The INFORMATION_SCHEMA INNODB_BUFFER_PAGE Table"><code class="literal">INNODB_BUFFER_PAGE</code></a>
        table or <a class="link" href="information-schema.html#innodb-buffer-page-lru-table" title="21.31.18 The INFORMATION_SCHEMA INNODB_BUFFER_PAGE_LRU Table"><code class="literal">INNODB_BUFFER_PAGE_LRU</code></a>
        table can introduce significant performance overhead. Do not
        query these tables on a production system unless you are aware
        of the performance impact that your query may have, and have
        determined it to be acceptable. To avoid impacting performance,
        reproduce the issue you want to investigate on a test instance
        and run your queries on the test instance.
</p>
</div>

<div class="example">
<a name="innodb-information-schema-buffer-pool-system-data-example"></a><p class="title"><b>Example 14.17 Querying System Data in the INNODB_BUFFER_PAGE Table</b></p>
<div class="example-contents">
<p>
        This query provides an approximate count of pages that contain
        system data by excluding pages where the
        <code class="literal">TABLE_NAME</code> value is either
        <code class="literal">NULL</code> or includes a slash
        <span class="quote">“<span class="quote"><code class="literal">/</code></span>”</span> or period
        <span class="quote">“<span class="quote"><code class="literal">.</code></span>”</span> in the table name, which
        indicates a user-defined table.
      </p><pre class="programlisting">SELECT COUNT(*) FROM INFORMATION_SCHEMA.INNODB_BUFFER_PAGE 
WHERE TABLE_NAME IS NULL OR (INSTR(TABLE_NAME, '/') = 0 AND INSTR(TABLE_NAME, '.') = 0);
+----------+
| COUNT(*) |
+----------+
|     1516 |
+----------+</pre><p>
        This query returns the approximate number of pages that contain
        system data, the total number of buffer pool pages, and an
        approximate percentage of pages that contain system data.
      </p><pre class="programlisting">SELECT  
(SELECT COUNT(*) FROM INFORMATION_SCHEMA.INNODB_BUFFER_PAGE 
WHERE TABLE_NAME IS NULL OR (INSTR(TABLE_NAME, '/') = 0 AND INSTR(TABLE_NAME, '.') = 0)
) AS system_pages,
(
SELECT COUNT(*)
FROM INFORMATION_SCHEMA.INNODB_BUFFER_PAGE
) AS total_pages,
(
SELECT ROUND((system_pages/total_pages) * 100)
) AS system_page_percentage;
+--------------+-------------+------------------------+
| system_pages | total_pages | system_page_percentage |
+--------------+-------------+------------------------+
|          295 |        8192 |                      4 |
+--------------+-------------+------------------------+</pre><p>
        The type of system data in the buffer pool can be determined by
        querying the <code class="literal">PAGE_TYPE</code> value. For example,
        the following query returns eight distinct
        <code class="literal">PAGE_TYPE</code> values among the pages that contain
        system data:
      </p><pre class="programlisting">mysql&gt; SELECT DISTINCT PAGE_TYPE FROM INFORMATION_SCHEMA.INNODB_BUFFER_PAGE 
WHERE TABLE_NAME IS NULL OR (INSTR(TABLE_NAME, '/') = 0 AND INSTR(TABLE_NAME, '.') = 0);
+-------------------+
| PAGE_TYPE         |
+-------------------+
| SYSTEM            |
| IBUF_BITMAP       |
| UNKNOWN           |
| FILE_SPACE_HEADER |
| INODE             |
| UNDO_LOG          |
| ALLOCATED         |
+-------------------+</pre>
</div>

</div>
<br class="example-break">
<div class="example">
<a name="innodb-information-schema-buffer-pool-user-data-example"></a><p class="title"><b>Example 14.18 Querying User Data in the INNODB_BUFFER_PAGE Table</b></p>
<div class="example-contents">
<p>
        This query provides an approximate count of pages containing
        user data by counting pages where the
        <code class="literal">TABLE_NAME</code> value is <code class="literal">NOT
        NULL</code> and <code class="literal">NOT LIKE
        '%INNODB_SYS_TABLES%'</code>.
      </p><pre class="programlisting">mysql&gt; SELECT COUNT(*) FROM INFORMATION_SCHEMA.INNODB_BUFFER_PAGE 
WHERE TABLE_NAME IS NOT NULL AND TABLE_NAME NOT LIKE '%INNODB_SYS_TABLES%';
+----------+
| COUNT(*) |
+----------+
|     7897 |
+----------+</pre><p>
        This query returns the approximate number of pages that contain
        user data, the total number of buffer pool pages, and an
        approximate percentage of pages that contain user data.
      </p><pre class="programlisting">mysql&gt; SELECT  
(SELECT COUNT(*) FROM INFORMATION_SCHEMA.INNODB_BUFFER_PAGE 
WHERE TABLE_NAME IS NOT NULL AND (INSTR(TABLE_NAME, '/') &gt; 0 OR INSTR(TABLE_NAME, '.') &gt; 0)
) AS user_pages,
(
SELECT COUNT(*)
FROM information_schema.INNODB_BUFFER_PAGE
) AS total_pages,
(
SELECT ROUND((user_pages/total_pages) * 100)
) AS user_page_percentage;
+------------+-------------+----------------------+
| user_pages | total_pages | user_page_percentage |
+------------+-------------+----------------------+
|       7897 |        8192 |                   96 |
+------------+-------------+----------------------+</pre><p>
        This query identifies user-defined tables with pages in the
        buffer pool:
      </p><pre class="programlisting">mysql&gt; SELECT DISTINCT TABLE_NAME FROM INFORMATION_SCHEMA.INNODB_BUFFER_PAGE 
WHERE TABLE_NAME IS NOT NULL AND (INSTR(TABLE_NAME, '/') &gt; 0 OR INSTR(TABLE_NAME, '.') &gt; 0) 
AND TABLE_NAME NOT LIKE '`mysql`.`innodb_%';
+-------------------------+
| TABLE_NAME              |
+-------------------------+
| `employees`.`salaries`  |
| `employees`.`employees` |
+-------------------------+</pre>
</div>

</div>
<br class="example-break">
<div class="example">
<a name="innodb-information-schema-buffer-pool-index-data-example"></a><p class="title"><b>Example 14.19 Querying Index Data in the INNODB_BUFFER_PAGE Table</b></p>
<div class="example-contents">
<p>
        For information about index pages, query the
        <code class="literal">INDEX_NAME</code> column using the name of the
        index. For example, the following query returns the number of
        pages and total data size of pages for the
        <code class="literal">emp_no</code> index that is defined on the
        <code class="literal">employees.salaries</code> table:
      </p><pre class="programlisting">mysql&gt; SELECT INDEX_NAME, COUNT(*) AS Pages, 
ROUND(SUM(IF(COMPRESSED_SIZE = 0, @@global.innodb_page_size, COMPRESSED_SIZE))/1024/1024) 
AS 'Total Data (MB)' 
FROM INFORMATION_SCHEMA.INNODB_BUFFER_PAGE 
WHERE INDEX_NAME='emp_no' AND TABLE_NAME = '`employees`.`salaries`';
+------------+-------+-----------------+
| INDEX_NAME | Pages | Total Data (MB) |
+------------+-------+-----------------+
| emp_no     |  1609 |              25 |
+------------+-------+-----------------+</pre><p>
        This query returns the number of pages and total data size of
        pages for all indexes defined on the
        <code class="literal">employees.salaries</code> table:
      </p><pre class="programlisting">mysql&gt; SELECT INDEX_NAME, COUNT(*) AS Pages,
ROUND(SUM(IF(COMPRESSED_SIZE = 0, @@global.innodb_page_size, COMPRESSED_SIZE))/1024/1024) 
AS 'Total Data (MB)'
FROM INFORMATION_SCHEMA.INNODB_BUFFER_PAGE
WHERE TABLE_NAME = '`employees`.`salaries`'
GROUP BY INDEX_NAME;
+------------+-------+-----------------+
| INDEX_NAME | Pages | Total Data (MB) |
+------------+-------+-----------------+
| emp_no     |  1608 |              25 |
| PRIMARY    |  6086 |              95 |
+------------+-------+-----------------+</pre>
</div>

</div>
<br class="example-break">
<div class="example">
<a name="innodb-information-schema-buffer-pool-lru-position-example"></a><p class="title"><b>Example 14.20 Querying LRU_POSITION Data in the INNODB_BUFFER_PAGE_LRU Table</b></p>
<div class="example-contents">
<p>
        The <a class="link" href="information-schema.html#innodb-buffer-page-lru-table" title="21.31.18 The INFORMATION_SCHEMA INNODB_BUFFER_PAGE_LRU Table"><code class="literal">INNODB_BUFFER_PAGE_LRU</code></a> table
        holds information about the pages in the
        <code class="literal">InnoDB</code> buffer pool, in particular how they
        are ordered that determines which pages to evict from the buffer
        pool when it becomes full. The definition for this page is the
        same as for <a class="link" href="information-schema.html#innodb-buffer-page-table" title="21.31.17 The INFORMATION_SCHEMA INNODB_BUFFER_PAGE Table"><code class="literal">INNODB_BUFFER_PAGE</code></a>,
        except this table has an <code class="literal">LRU_POSITION</code> column
        instead of a <code class="literal">BLOCK_ID</code> column.
      </p><p>
        This query counts the number of positions at a specific location
        in the LRU list occupied by pages of the
        <code class="literal">employees.employees</code> table.
      </p><pre class="programlisting">mysql&gt; SELECT COUNT(LRU_POSITION) FROM INFORMATION_SCHEMA.INNODB_BUFFER_PAGE_LRU 
WHERE TABLE_NAME='`employees`.`employees`' AND LRU_POSITION &lt; 3072;
+---------------------+
| COUNT(LRU_POSITION) |
+---------------------+
|                 548 |
+---------------------+</pre>
</div>

</div>
<br class="example-break">
<div class="example">
<a name="innodb-information-schema-buffer-pool-stats-example"></a><p class="title"><b>Example 14.21 Querying the INNODB_BUFFER_POOL_STATS Table</b></p>
<div class="example-contents">
<p>
        The <a class="link" href="information-schema.html#innodb-buffer-pool-stats-table" title="21.31.19 The INFORMATION_SCHEMA INNODB_BUFFER_POOL_STATS Table"><code class="literal">INNODB_BUFFER_POOL_STATS</code></a> table
        provides information similar to
        <a class="link" href="sql-syntax.html#show-engine" title="13.7.5.15 SHOW ENGINE Syntax"><code class="literal">SHOW ENGINE INNODB
        STATUS</code></a> and <code class="literal">InnoDB</code> buffer pool
        status variables.
      </p><pre class="programlisting">mysql&gt; SELECT * FROM information_schema.INNODB_BUFFER_POOL_STATS \G
*************************** 1. row ***************************
                         POOL_ID: 0
                       POOL_SIZE: 8192
                    FREE_BUFFERS: 1
                  DATABASE_PAGES: 8173
              OLD_DATABASE_PAGES: 3014
         MODIFIED_DATABASE_PAGES: 0
              PENDING_DECOMPRESS: 0
                   PENDING_READS: 0
               PENDING_FLUSH_LRU: 0
              PENDING_FLUSH_LIST: 0
                PAGES_MADE_YOUNG: 15907
            PAGES_NOT_MADE_YOUNG: 3803101
           PAGES_MADE_YOUNG_RATE: 0
       PAGES_MADE_NOT_YOUNG_RATE: 0
               NUMBER_PAGES_READ: 3270
            NUMBER_PAGES_CREATED: 13176
            NUMBER_PAGES_WRITTEN: 15109
                 PAGES_READ_RATE: 0
               PAGES_CREATE_RATE: 0
              PAGES_WRITTEN_RATE: 0
                NUMBER_PAGES_GET: 33069332
                        HIT_RATE: 0
    YOUNG_MAKE_PER_THOUSAND_GETS: 0
NOT_YOUNG_MAKE_PER_THOUSAND_GETS: 0
         NUMBER_PAGES_READ_AHEAD: 2713
       NUMBER_READ_AHEAD_EVICTED: 0
                 READ_AHEAD_RATE: 0
         READ_AHEAD_EVICTED_RATE: 0
                    LRU_IO_TOTAL: 0
                  LRU_IO_CURRENT: 0
                UNCOMPRESS_TOTAL: 0
              UNCOMPRESS_CURRENT: 0</pre><p>
        For comparison,
        <a class="link" href="sql-syntax.html#show-engine" title="13.7.5.15 SHOW ENGINE Syntax"><code class="literal">SHOW ENGINE INNODB
        STATUS</code></a> output and <code class="literal">InnoDB</code> buffer
        pool status variable output is shown below, based on the same
        data set.
      </p><p>
        For more information about
        <a class="link" href="sql-syntax.html#show-engine" title="13.7.5.15 SHOW ENGINE Syntax"><code class="literal">SHOW ENGINE INNODB
        STATUS</code></a> output, see
        <a class="xref" href="innodb-storage-engine.html#innodb-standard-monitor" title="14.14.3 InnoDB Standard Monitor and Lock Monitor Output">Section 14.14.3, “InnoDB Standard Monitor and Lock Monitor Output”</a>.
      </p><pre class="programlisting">mysql&gt; SHOW ENGINE INNODB STATUS \G
...
----------------------
BUFFER POOL AND MEMORY
----------------------
Total large memory allocated 137428992 
Dictionary memory allocated 579084
Buffer pool size   8192
Free buffers       1
Database pages     8173
Old database pages 3014
Modified db pages  0
Pending reads 0
Pending writes: LRU 0, flush list 0, single page 0
Pages made young 15907, not young 3803101
0.00 youngs/s, 0.00 non-youngs/s
Pages read 3270, created 13176, written 15109
0.00 reads/s, 0.00 creates/s, 0.00 writes/s
No buffer pool page gets since the last printout
Pages read ahead 0.00/s, evicted without access 0.00/s, Random read ahead 0.00/s
LRU len: 8173, unzip_LRU len: 0
I/O sum[0]:cur[0], unzip sum[0]:cur[0]
...</pre><p>
        For status variable descriptions, see
        <a class="xref" href="server-administration.html#server-status-variables" title="5.1.6 Server Status Variables">Section 5.1.6, “Server Status Variables”</a>.
      </p><pre class="programlisting">mysql&gt; SHOW STATUS LIKE 'Innodb_buffer%';
+---------------------------------------+-------------+
| Variable_name                         | Value       |
+---------------------------------------+-------------+
| Innodb_buffer_pool_dump_status        | not started |
| Innodb_buffer_pool_load_status        | not started |
| Innodb_buffer_pool_resize_status      | not started |
| Innodb_buffer_pool_pages_data         | 8173        |
| Innodb_buffer_pool_bytes_data         | 133906432   |
| Innodb_buffer_pool_pages_dirty        | 0           |
| Innodb_buffer_pool_bytes_dirty        | 0           |
| Innodb_buffer_pool_pages_flushed      | 15109       |
| Innodb_buffer_pool_pages_free         | 1           |
| Innodb_buffer_pool_pages_misc         | 18          |
| Innodb_buffer_pool_pages_total        | 8192        |
| Innodb_buffer_pool_read_ahead_rnd     | 0           |
| Innodb_buffer_pool_read_ahead         | 2713        |
| Innodb_buffer_pool_read_ahead_evicted | 0           |
| Innodb_buffer_pool_read_requests      | 33069332    |
| Innodb_buffer_pool_reads              | 558         |
| Innodb_buffer_pool_wait_free          | 0           |
| Innodb_buffer_pool_write_requests     | 11985961    |
+---------------------------------------+-------------+</pre>
</div>

</div>
<br class="example-break">
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="innodb-information-schema-metrics-table"></a>14.12.6 InnoDB INFORMATION_SCHEMA Metrics Table</h3>

</div>

</div>

</div>
<p>
      The <a class="link" href="information-schema.html#innodb-metrics-table" title="21.31.20 The INFORMATION_SCHEMA INNODB_METRICS Table"><code class="literal">INNODB_METRICS</code></a> table, introduced
      in MySQL 5.6.2, consolidates all <code class="literal">InnoDB</code>
      performance and resource-related counters into a single
      <code class="literal">INFORMATION_SCHEMA</code> table.
    </p><p>
      The columns of the <a class="link" href="information-schema.html#innodb-metrics-table" title="21.31.20 The INFORMATION_SCHEMA INNODB_METRICS Table"><code class="literal">INNODB_METRICS</code></a>
      table are shown in the following example. For a description of
      each column, see <a class="xref" href="information-schema.html#innodb-metrics-table" title="21.31.20 The INFORMATION_SCHEMA INNODB_METRICS Table">Section 21.31.20, “The INFORMATION_SCHEMA INNODB_METRICS Table”</a>.
    </p><pre class="programlisting">mysql&gt; SELECT * FROM INFORMATION_SCHEMA.INNODB_METRICS WHERE NAME="dml_inserts" \G
*************************** 1. row ***************************
           NAME: dml_inserts
      SUBSYSTEM: dml
          COUNT: 46273
      MAX_COUNT: 46273
      MIN_COUNT: NULL
      AVG_COUNT: 492.2659574468085
    COUNT_RESET: 46273
MAX_COUNT_RESET: 46273
MIN_COUNT_RESET: NULL
AVG_COUNT_RESET: NULL
   TIME_ENABLED: 2014-11-28 16:07:53
  TIME_DISABLED: NULL
   TIME_ELAPSED: 94
     TIME_RESET: NULL
         STATUS: enabled
           TYPE: status_counter
COMMENT: Number of rows inserted</pre>
<h4><a name="idm140644102396976"></a>Enabling, Disabling, and Resetting Counters</h4>
<p>
      You can enable, disable, and reset counters using the following
      configuration options:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_monitor_enable"><code class="literal">innodb_monitor_enable</code></a>:
          Enables one or more counters.
        </p><pre class="programlisting">SET GLOBAL innodb_monitor_enable = [counter-name|module_name|pattern|all];</pre></li><li class="listitem"><p>
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_monitor_disable"><code class="literal">innodb_monitor_disable</code></a>:
          Disables one or more counters.
        </p><pre class="programlisting">SET GLOBAL innodb_monitor_disable = [counter-name|module_name|pattern|all];</pre></li><li class="listitem"><p>
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_monitor_reset"><code class="literal">innodb_monitor_reset</code></a>: Resets
          the count value for one or more counters to zero.
        </p><pre class="programlisting">SET GLOBAL innodb_monitor_reset = [counter-name|module_name|pattern|all];</pre></li><li class="listitem"><p>
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_monitor_reset_all"><code class="literal">innodb_monitor_reset_all</code></a>:
          Resets all values for one or more counters. A counter must be
          disabled before using
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_monitor_reset_all"><code class="literal">innodb_monitor_reset_all</code></a>.
</p><pre class="programlisting">SET GLOBAL innodb_monitor_reset_all = [counter-name|module_name|pattern|all];</pre></li></ul>
</div>
<p>
      You can also enable counters and counter modules at startup using
      the MySQL server configuration file. For example, to enable the
      <code class="literal">log</code> module,
      <code class="literal">metadata_table_handles_opened</code> and
      <code class="literal">metadata_table_handles_closed</code> counters, enter
      the following line in the <code class="literal">[mysqld]</code> section of
      your <code class="filename">my.cnf</code> configuration file.
    </p><pre class="programlisting">[mysqld]
innodb_monitor_enable = module_recovery,metadata_table_handles_opened,metadata_table_handles_closed</pre><p>
      When enabling multiple counters or modules in your configuration
      file, you must specify the
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_monitor_enable"><code class="literal">innodb_monitor_enable</code></a>
      configuration option followed by counter and module names
      separated by a comma, as shown in the example above. Only the
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_monitor_enable"><code class="literal">innodb_monitor_enable</code></a> option can
      be used in your configuration file. The disable and reset
      configuration options are only supported on the command line.
</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
        Because each counter imposes some degree of runtime overhead on
        the server, typically you enable more counters on test and
        development servers during experimentation and benchmarking, and
        only enable counters on production servers to diagnose known
        issues or monitor aspects that are likely to be bottlenecks for
        a particular server and workload.
</p>
</div>
<h4><a name="idm140644102373168"></a>Counters</h4>
<p>
      The counters represented in the
      <a class="link" href="information-schema.html#innodb-metrics-table" title="21.31.20 The INFORMATION_SCHEMA INNODB_METRICS Table"><code class="literal">INNODB_METRICS</code></a> table are subject to
      change, so for the most up-to-date list, query a running MySQL
      server. The list below shows counters that are available as of
      MySQL 5.7.6.
    </p><p>
      Counters that are enabled by default correspond to those used by
      <a class="link" href="sql-syntax.html#show-engine" title="13.7.5.15 SHOW ENGINE Syntax"><code class="literal">SHOW ENGINE INNODB
      STATUS</code></a>. Counters used by
      <a class="link" href="sql-syntax.html#show-engine" title="13.7.5.15 SHOW ENGINE Syntax"><code class="literal">SHOW ENGINE INNODB
      STATUS</code></a> are always <span class="quote">“<span class="quote">on</span>”</span> at a system level
      but you can disable these counters for the
      <a class="link" href="information-schema.html#innodb-metrics-table" title="21.31.20 The INFORMATION_SCHEMA INNODB_METRICS Table"><code class="literal">INNODB_METRICS</code></a> table, as required.
      Also, counter status is not persistent. Unless specified
      otherwise, counters revert to their default enabled or disabled
      status when the server is restarted.
    </p><p>
      If you run programs that would be affected by additions or changes
      to the <a class="link" href="information-schema.html#innodb-metrics-table" title="21.31.20 The INFORMATION_SCHEMA INNODB_METRICS Table"><code class="literal">INNODB_METRICS</code></a> table, it is
      recommended that you review releases notes and query the
      <a class="link" href="information-schema.html#innodb-metrics-table" title="21.31.20 The INFORMATION_SCHEMA INNODB_METRICS Table"><code class="literal">INNODB_METRICS</code></a> table for the new
      release prior to upgrading.
    </p><pre class="programlisting">mysql&gt; SELECT name, subsystem, status FROM INFORMATION_SCHEMA.INNODB_METRICS ORDER BY NAME;
+------------------------------------------+---------------------+----------+
| name                                     | subsystem           | status   |
+------------------------------------------+---------------------+----------+
| adaptive_hash_pages_added                | adaptive_hash_index | disabled |
| adaptive_hash_pages_removed              | adaptive_hash_index | disabled |
| adaptive_hash_rows_added                 | adaptive_hash_index | disabled |
| adaptive_hash_rows_deleted_no_hash_entry | adaptive_hash_index | disabled |
| adaptive_hash_rows_removed               | adaptive_hash_index | disabled |
| adaptive_hash_rows_updated               | adaptive_hash_index | disabled |
| adaptive_hash_searches                   | adaptive_hash_index | enabled  |
| adaptive_hash_searches_btree             | adaptive_hash_index | enabled  |
| buffer_data_reads                        | buffer              | enabled  |
| buffer_data_written                      | buffer              | enabled  |
| buffer_flush_adaptive                    | buffer              | disabled |
| buffer_flush_adaptive_avg_pass           | buffer              | disabled |
| buffer_flush_adaptive_avg_time_est       | buffer              | disabled |
| buffer_flush_adaptive_avg_time_slot      | buffer              | disabled |
| buffer_flush_adaptive_avg_time_thread    | buffer              | disabled |
| buffer_flush_adaptive_pages              | buffer              | disabled |
| buffer_flush_adaptive_total_pages        | buffer              | disabled |
| buffer_flush_avg_page_rate               | buffer              | disabled |
| buffer_flush_avg_pass                    | buffer              | disabled |
| buffer_flush_avg_time                    | buffer              | disabled |
| buffer_flush_background                  | buffer              | disabled |
| buffer_flush_background_pages            | buffer              | disabled |
| buffer_flush_background_total_pages      | buffer              | disabled |
| buffer_flush_batches                     | buffer              | disabled |
| buffer_flush_batch_num_scan              | buffer              | disabled |
| buffer_flush_batch_pages                 | buffer              | disabled |
| buffer_flush_batch_scanned               | buffer              | disabled |
| buffer_flush_batch_scanned_per_call      | buffer              | disabled |
| buffer_flush_batch_total_pages           | buffer              | disabled |
| buffer_flush_lsn_avg_rate                | buffer              | disabled |
| buffer_flush_neighbor                    | buffer              | disabled |
| buffer_flush_neighbor_pages              | buffer              | disabled |
| buffer_flush_neighbor_total_pages        | buffer              | disabled |
| buffer_flush_n_to_flush_by_age           | buffer              | disabled |
| buffer_flush_n_to_flush_requested        | buffer              | disabled |
| buffer_flush_pct_for_dirty               | buffer              | disabled |
| buffer_flush_pct_for_lsn                 | buffer              | disabled |
| buffer_flush_sync                        | buffer              | disabled |
| buffer_flush_sync_pages                  | buffer              | disabled |
| buffer_flush_sync_total_pages            | buffer              | disabled |
| buffer_flush_sync_waits                  | buffer              | disabled |
| buffer_LRU_batches_evict                 | buffer              | disabled |
| buffer_LRU_batches_flush                 | buffer              | disabled |
| buffer_LRU_batch_evict_pages             | buffer              | disabled |
| buffer_LRU_batch_evict_total_pages       | buffer              | disabled |
| buffer_LRU_batch_flush_avg_pass          | buffer              | disabled |
| buffer_LRU_batch_flush_avg_time_est      | buffer              | disabled |
| buffer_LRU_batch_flush_avg_time_slot     | buffer              | disabled |
| buffer_LRU_batch_flush_avg_time_thread   | buffer              | disabled |
| buffer_LRU_batch_flush_pages             | buffer              | disabled |
| buffer_LRU_batch_flush_total_pages       | buffer              | disabled |
| buffer_LRU_batch_num_scan                | buffer              | disabled |
| buffer_LRU_batch_scanned                 | buffer              | disabled |
| buffer_LRU_batch_scanned_per_call        | buffer              | disabled |
| buffer_LRU_get_free_loops                | buffer              | disabled |
| buffer_LRU_get_free_search               | Buffer              | disabled |
| buffer_LRU_get_free_waits                | buffer              | disabled |
| buffer_LRU_search_num_scan               | buffer              | disabled |
| buffer_LRU_search_scanned                | buffer              | disabled |
| buffer_LRU_search_scanned_per_call       | buffer              | disabled |
| buffer_LRU_single_flush_failure_count    | Buffer              | disabled |
| buffer_LRU_single_flush_num_scan         | buffer              | disabled |
| buffer_LRU_single_flush_scanned          | buffer              | disabled |
| buffer_LRU_single_flush_scanned_per_call | buffer              | disabled |
| buffer_LRU_unzip_search_num_scan         | buffer              | disabled |
| buffer_LRU_unzip_search_scanned          | buffer              | disabled |
| buffer_LRU_unzip_search_scanned_per_call | buffer              | disabled |
| buffer_pages_created                     | buffer              | enabled  |
| buffer_pages_read                        | buffer              | enabled  |
| buffer_pages_written                     | buffer              | enabled  |
| buffer_page_read_blob                    | buffer_page_io      | disabled |
| buffer_page_read_fsp_hdr                 | buffer_page_io      | disabled |
| buffer_page_read_ibuf_bitmap             | buffer_page_io      | disabled |
| buffer_page_read_ibuf_free_list          | buffer_page_io      | disabled |
| buffer_page_read_index_ibuf_leaf         | buffer_page_io      | disabled |
| buffer_page_read_index_ibuf_non_leaf     | buffer_page_io      | disabled |
| buffer_page_read_index_inode             | buffer_page_io      | disabled |
| buffer_page_read_index_leaf              | buffer_page_io      | disabled |
| buffer_page_read_index_non_leaf          | buffer_page_io      | disabled |
| buffer_page_read_other                   | buffer_page_io      | disabled |
| buffer_page_read_system_page             | buffer_page_io      | disabled |
| buffer_page_read_trx_system              | buffer_page_io      | disabled |
| buffer_page_read_undo_log                | buffer_page_io      | disabled |
| buffer_page_read_xdes                    | buffer_page_io      | disabled |
| buffer_page_read_zblob                   | buffer_page_io      | disabled |
| buffer_page_read_zblob2                  | buffer_page_io      | disabled |
| buffer_page_written_blob                 | buffer_page_io      | disabled |
| buffer_page_written_fsp_hdr              | buffer_page_io      | disabled |
| buffer_page_written_ibuf_bitmap          | buffer_page_io      | disabled |
| buffer_page_written_ibuf_free_list       | buffer_page_io      | disabled |
| buffer_page_written_index_ibuf_leaf      | buffer_page_io      | disabled |
| buffer_page_written_index_ibuf_non_leaf  | buffer_page_io      | disabled |
| buffer_page_written_index_inode          | buffer_page_io      | disabled |
| buffer_page_written_index_leaf           | buffer_page_io      | disabled |
| buffer_page_written_index_non_leaf       | buffer_page_io      | disabled |
| buffer_page_written_other                | buffer_page_io      | disabled |
| buffer_page_written_system_page          | buffer_page_io      | disabled |
| buffer_page_written_trx_system           | buffer_page_io      | disabled |
| buffer_page_written_undo_log             | buffer_page_io      | disabled |
| buffer_page_written_xdes                 | buffer_page_io      | disabled |
| buffer_page_written_zblob                | buffer_page_io      | disabled |
| buffer_page_written_zblob2               | buffer_page_io      | disabled |
| buffer_pool_bytes_data                   | buffer              | enabled  |
| buffer_pool_bytes_dirty                  | buffer              | enabled  |
| buffer_pool_pages_data                   | buffer              | enabled  |
| buffer_pool_pages_dirty                  | buffer              | enabled  |
| buffer_pool_pages_free                   | buffer              | enabled  |
| buffer_pool_pages_misc                   | buffer              | enabled  |
| buffer_pool_pages_total                  | buffer              | enabled  |
| buffer_pool_reads                        | buffer              | enabled  |
| buffer_pool_read_ahead                   | buffer              | enabled  |
| buffer_pool_read_ahead_evicted           | buffer              | enabled  |
| buffer_pool_read_requests                | buffer              | enabled  |
| buffer_pool_size                         | server              | enabled  |
| buffer_pool_wait_free                    | buffer              | enabled  |
| buffer_pool_write_requests               | buffer              | enabled  |
| compression_pad_decrements               | compression         | disabled |
| compression_pad_increments               | compression         | disabled |
| compress_pages_compressed                | compression         | disabled |
| compress_pages_decompressed              | compression         | disabled |
| ddl_background_drop_indexes              | ddl                 | disabled |
| ddl_background_drop_tables               | ddl                 | disabled |
| ddl_log_file_alter_table                 | ddl                 | disabled |
| ddl_online_create_index                  | ddl                 | disabled |
| ddl_pending_alter_table                  | ddl                 | disabled |
| ddl_sort_file_alter_table                | ddl                 | disabled |
| dml_deletes                              | dml                 | enabled  |
| dml_inserts                              | dml                 | enabled  |
| dml_reads                                | dml                 | disabled |
| dml_updates                              | dml                 | enabled  |
| file_num_open_files                      | file_system         | enabled  |
| ibuf_merges                              | change_buffer       | enabled  |
| ibuf_merges_delete                       | change_buffer       | enabled  |
| ibuf_merges_delete_mark                  | change_buffer       | enabled  |
| ibuf_merges_discard_delete               | change_buffer       | enabled  |
| ibuf_merges_discard_delete_mark          | change_buffer       | enabled  |
| ibuf_merges_discard_insert               | change_buffer       | enabled  |
| ibuf_merges_insert                       | change_buffer       | enabled  |
| ibuf_size                                | change_buffer       | enabled  |
| icp_attempts                             | icp                 | disabled |
| icp_match                                | icp                 | disabled |
| icp_no_match                             | icp                 | disabled |
| icp_out_of_range                         | icp                 | disabled |
| index_page_discards                      | index               | disabled |
| index_page_merge_attempts                | index               | disabled |
| index_page_merge_successful              | index               | disabled |
| index_page_reorg_attempts                | index               | disabled |
| index_page_reorg_successful              | index               | disabled |
| index_page_splits                        | index               | disabled |
| innodb_activity_count                    | server              | enabled  |
| innodb_background_drop_table_usec        | server              | disabled |
| innodb_checkpoint_usec                   | server              | disabled |
| innodb_dblwr_pages_written               | server              | enabled  |
| innodb_dblwr_writes                      | server              | enabled  |
| innodb_dict_lru_count                    | server              | disabled |
| innodb_dict_lru_usec                     | server              | disabled |
| innodb_ibuf_merge_usec                   | server              | disabled |
| innodb_log_flush_usec                    | server              | disabled |
| innodb_master_active_loops               | server              | disabled |
| innodb_master_idle_loops                 | server              | disabled |
| innodb_master_purge_usec                 | server              | disabled |
| innodb_master_thread_sleeps              | server              | disabled |
| innodb_mem_validate_usec                 | server              | disabled |
| innodb_page_size                         | server              | enabled  |
| innodb_rwlock_sx_os_waits                | server              | enabled  |
| innodb_rwlock_sx_spin_rounds             | server              | enabled  |
| innodb_rwlock_sx_spin_waits              | server              | enabled  |
| innodb_rwlock_s_os_waits                 | server              | enabled  |
| innodb_rwlock_s_spin_rounds              | server              | enabled  |
| innodb_rwlock_s_spin_waits               | server              | enabled  |
| innodb_rwlock_x_os_waits                 | server              | enabled  |
| innodb_rwlock_x_spin_rounds              | server              | enabled  |
| innodb_rwlock_x_spin_waits               | server              | enabled  |
| lock_deadlocks                           | lock                | enabled  |
| lock_rec_locks                           | lock                | disabled |
| lock_rec_lock_created                    | lock                | disabled |
| lock_rec_lock_removed                    | lock                | disabled |
| lock_rec_lock_requests                   | lock                | disabled |
| lock_rec_lock_waits                      | lock                | disabled |
| lock_row_lock_current_waits              | lock                | enabled  |
| lock_row_lock_time                       | lock                | enabled  |
| lock_row_lock_time_avg                   | lock                | enabled  |
| lock_row_lock_time_max                   | lock                | enabled  |
| lock_row_lock_waits                      | lock                | enabled  |
| lock_table_locks                         | lock                | disabled |
| lock_table_lock_created                  | lock                | disabled |
| lock_table_lock_removed                  | lock                | disabled |
| lock_table_lock_waits                    | lock                | disabled |
| lock_timeouts                            | lock                | enabled  |
| log_checkpoints                          | recovery            | disabled |
| log_lsn_buf_pool_oldest                  | recovery            | disabled |
| log_lsn_checkpoint_age                   | recovery            | disabled |
| log_lsn_current                          | recovery            | disabled |
| log_lsn_last_checkpoint                  | recovery            | disabled |
| log_lsn_last_flush                       | recovery            | disabled |
| log_max_modified_age_async               | recovery            | disabled |
| log_max_modified_age_sync                | recovery            | disabled |
| log_num_log_io                           | recovery            | disabled |
| log_padded                               | recovery            | enabled  |
| log_pending_checkpoint_writes            | recovery            | disabled |
| log_pending_log_flushes                  | recovery            | disabled |
| log_waits                                | recovery            | enabled  |
| log_writes                               | recovery            | enabled  |
| log_write_requests                       | recovery            | enabled  |
| metadata_table_handles_closed            | metadata            | disabled |
| metadata_table_handles_opened            | metadata            | disabled |
| metadata_table_reference_count           | metadata            | disabled |
| os_data_fsyncs                           | os                  | enabled  |
| os_data_reads                            | os                  | enabled  |
| os_data_writes                           | os                  | enabled  |
| os_log_bytes_written                     | os                  | enabled  |
| os_log_fsyncs                            | os                  | enabled  |
| os_log_pending_fsyncs                    | os                  | enabled  |
| os_log_pending_writes                    | os                  | enabled  |
| os_pending_reads                         | os                  | disabled |
| os_pending_writes                        | os                  | disabled |
| purge_del_mark_records                   | purge               | disabled |
| purge_dml_delay_usec                     | purge               | disabled |
| purge_invoked                            | purge               | disabled |
| purge_resume_count                       | purge               | disabled |
| purge_stop_count                         | purge               | disabled |
| purge_undo_log_pages                     | purge               | disabled |
| purge_upd_exist_or_extern_records        | purge               | disabled |
| trx_active_transactions                  | transaction         | disabled |
| trx_commits_insert_update                | transaction         | disabled |
| trx_nl_ro_commits                        | transaction         | disabled |
| trx_rollbacks                            | transaction         | disabled |
| trx_rollbacks_savepoint                  | transaction         | disabled |
| trx_rollback_active                      | transaction         | disabled |
| trx_ro_commits                           | transaction         | disabled |
| trx_rseg_current_size                    | transaction         | disabled |
| trx_rseg_history_len                     | transaction         | enabled  |
| trx_rw_commits                           | transaction         | disabled |
| trx_undo_slots_cached                    | transaction         | disabled |
| trx_undo_slots_used                      | transaction         | disabled |
+------------------------------------------+---------------------+----------+
235 rows in set (0.01 sec)</pre>
<h4><a name="idm140644102334864"></a>Counter Modules</h4>
<p>
      The module names correspond to, but are not identical to, the
      values from the <code class="literal">SUBSYSTEM</code> column of the
      <a class="link" href="information-schema.html#innodb-metrics-table" title="21.31.20 The INFORMATION_SCHEMA INNODB_METRICS Table"><code class="literal">INNODB_METRICS</code></a> table. Rather
      enabling, disabling, or resetting counters individually, you can
      use module names to quickly enable, disable, or reset all counters
      for a particular subsystem. For example, use
      <code class="literal">module_dml</code> to enable all counters associated
      with the <code class="literal">dml</code> subsystem.
    </p><pre class="programlisting">mysql&gt; SET GLOBAL innodb_monitor_enable = module_dml;
      
mysql&gt; SELECT name, subsystem, status FROM INFORMATION_SCHEMA.INNODB_METRICS 
WHERE subsystem ='dml';
+-------------+-----------+---------+
| name        | subsystem | status  |
+-------------+-----------+---------+
| dml_reads   | dml       | enabled |
| dml_inserts | dml       | enabled |
| dml_deletes | dml       | enabled |
| dml_updates | dml       | enabled |
+-------------+-----------+---------+</pre><p>
      Here are the values you can use for
      <em class="replaceable"><code>module_name</code></em> with the
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_monitor_enable"><code class="literal">innodb_monitor_enable</code></a> and related
      configuration options, along with the corresponding
      <code class="literal">SUBSYSTEM</code> names:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          <code class="literal">module_metadata</code> (subsystem =
          <code class="literal">metadata</code>)
        </p></li><li class="listitem"><p>
          <code class="literal">module_lock</code> (subsystem =
          <code class="literal">lock</code>)
        </p></li><li class="listitem"><p>
          <code class="literal">module_buffer</code> (subsystem =
          <code class="literal">buffer</code>)
        </p></li><li class="listitem"><p>
          <code class="literal">module_buf_page</code> (subsystem =
          <code class="literal">buffer_page_io</code>)
        </p></li><li class="listitem"><p>
          <code class="literal">module_os</code> (subsystem =
          <code class="literal">os</code>)
        </p></li><li class="listitem"><p>
          <code class="literal">module_trx</code> (subsystem =
          <code class="literal">transaction</code>)
        </p></li><li class="listitem"><p>
          <code class="literal">module_purge</code> (subsystem =
          <code class="literal">purge</code>)
        </p></li><li class="listitem"><p>
          <code class="literal">module_compress</code> (subsystem =
          <code class="literal">compression</code>)
        </p></li><li class="listitem"><p>
          <code class="literal">module_file</code> (subsystem =
          <code class="literal">file_system</code>)
        </p></li><li class="listitem"><p>
          <code class="literal">module_index</code> (subsystem =
          <code class="literal">index</code>)
        </p></li><li class="listitem"><p>
          <code class="literal">module_adaptive_hash</code> (subsystem =
          <code class="literal">adaptive_hash_index</code>)
        </p></li><li class="listitem"><p>
          <code class="literal">module_ibuf_system</code> (subsystem =
          <code class="literal">change_buffer</code>)
        </p></li><li class="listitem"><p>
          <code class="literal">module_srv</code> (subsystem =
          <code class="literal">server</code>)
        </p></li><li class="listitem"><p>
          <code class="literal">module_ddl</code> (subsystem =
          <code class="literal">ddl</code>)
        </p></li><li class="listitem"><p>
          <code class="literal">module_dml</code> (subsystem =
          <code class="literal">dml</code>)
        </p></li><li class="listitem"><p>
          <code class="literal">module_log</code> (subsystem =
          <code class="literal">recovery</code>)
        </p></li><li class="listitem"><p>
          <code class="literal">module_icp</code> (subsystem =
          <code class="literal">icp</code>)
</p></li></ul>
</div>

<div class="example">
<a name="innodb-information-schema-metrics-table-example"></a><p class="title"><b>Example 14.22 Working with INNODB_METRICS Table Counters</b></p>
<div class="example-contents">
<p>
        This example demonstrates enabling, disabling, and resetting a
        counter, and querying counter data in the
        <a class="link" href="information-schema.html#innodb-metrics-table" title="21.31.20 The INFORMATION_SCHEMA INNODB_METRICS Table"><code class="literal">INNODB_METRICS</code></a> table.
</p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p>
            Create a simple <code class="literal">InnoDB</code> table:
          </p><pre class="programlisting">mysql&gt; USE test;
Database changed

mysql&gt; CREATE TABLE t1 (c1 INT) ENGINE=INNODB;
Query OK, 0 rows affected (0.02 sec)</pre></li><li class="listitem"><p>
            Enable the <code class="literal">dml_inserts</code> counter.
          </p><pre class="programlisting">mysql&gt; SET GLOBAL innodb_monitor_enable = dml_inserts;
Query OK, 0 rows affected (0.01 sec)</pre><p>
            A description of the <code class="literal">dml_inserts</code> counter
            can be found in the <code class="literal">COMMENT</code> column of the
            <code class="literal">INNODB_METRICS</code> table:
          </p><pre class="programlisting">mysql&gt; SELECT NAME, COMMENT FROM INFORMATION_SCHEMA.INNODB_METRICS WHERE NAME="dml_inserts";
+-------------+-------------------------+
| NAME        | COMMENT                 |
+-------------+-------------------------+
| dml_inserts | Number of rows inserted |
+-------------+-------------------------+</pre></li><li class="listitem"><p>
            Query the <a class="link" href="information-schema.html#innodb-metrics-table" title="21.31.20 The INFORMATION_SCHEMA INNODB_METRICS Table"><code class="literal">INNODB_METRICS</code></a> table
            for the <code class="literal">dml_inserts</code> counter data. Because
            no DML operations have been performed, the counter values
            are zero or NULL. The <code class="literal">TIME_ENABLED</code> and
            <code class="literal">TIME_ELAPSED</code> values indicate when the
            counter was last enabled and how many seconds have elapsed
            since this time.
          </p><pre class="programlisting">mysql&gt;  SELECT * FROM INFORMATION_SCHEMA.INNODB_METRICS WHERE NAME="dml_inserts" \G
*************************** 1. row ***************************
           NAME: dml_inserts
      SUBSYSTEM: dml
          COUNT: 0
      MAX_COUNT: 0
      MIN_COUNT: NULL
      AVG_COUNT: 0
    COUNT_RESET: 0
MAX_COUNT_RESET: 0
MIN_COUNT_RESET: NULL
AVG_COUNT_RESET: NULL
   TIME_ENABLED: 2014-12-04 14:18:28
  TIME_DISABLED: NULL
   TIME_ELAPSED: 28
     TIME_RESET: NULL
         STATUS: enabled
           TYPE: status_counter
        COMMENT: Number of rows inserted</pre></li><li class="listitem"><p>
            Insert three rows of data into the table.
          </p><pre class="programlisting">mysql&gt; INSERT INTO t1 values(1);
Query OK, 1 row affected (0.00 sec)

mysql&gt; INSERT INTO t1 values(2);
Query OK, 1 row affected (0.00 sec)

mysql&gt; INSERT INTO t1 values(3);
Query OK, 1 row affected (0.00 sec)</pre></li><li class="listitem"><p>
            Query the <a class="link" href="information-schema.html#innodb-metrics-table" title="21.31.20 The INFORMATION_SCHEMA INNODB_METRICS Table"><code class="literal">INNODB_METRICS</code></a> table
            again for the <code class="literal">dml_inserts</code> counter data. A
            number of counter values have now incremented including
            <code class="literal">COUNT</code>, <code class="literal">MAX_COUNT</code>,
            <code class="literal">AVG_COUNT</code>, and
            <code class="literal">COUNT_RESET</code>. Refer to the
            <a class="link" href="information-schema.html#innodb-metrics-table" title="21.31.20 The INFORMATION_SCHEMA INNODB_METRICS Table"><code class="literal">INNODB_METRICS</code></a> table definition
            for descriptions of these values.
          </p><pre class="programlisting">mysql&gt;  SELECT * FROM INFORMATION_SCHEMA.INNODB_METRICS WHERE NAME="dml_inserts"\G
*************************** 1. row ***************************
           NAME: dml_inserts
      SUBSYSTEM: dml
          COUNT: 3
      MAX_COUNT: 3
      MIN_COUNT: NULL
      AVG_COUNT: 0.046153846153846156
    COUNT_RESET: 3
MAX_COUNT_RESET: 3
MIN_COUNT_RESET: NULL
AVG_COUNT_RESET: NULL
   TIME_ENABLED: 2014-12-04 14:18:28
  TIME_DISABLED: NULL
   TIME_ELAPSED: 65
     TIME_RESET: NULL
         STATUS: enabled
           TYPE: status_counter
        COMMENT: Number of rows inserted</pre></li><li class="listitem"><p>
            Reset the <code class="literal">dml_inserts</code> counter, and query
            the <a class="link" href="information-schema.html#innodb-metrics-table" title="21.31.20 The INFORMATION_SCHEMA INNODB_METRICS Table"><code class="literal">INNODB_METRICS</code></a> table again
            for the <code class="literal">dml_inserts</code> counter data. The
            <span class="quote">“<span class="quote"><code class="literal">%_RESET</code></span>”</span> values that were
            reported previously, such as <code class="literal">COUNT_RESET</code>
            and <code class="literal">MAX_RESET</code>, are set back to zero.
            Values such as <code class="literal">COUNT</code>,
            <code class="literal">MAX_COUNT</code>, and
            <code class="literal">AVG_COUNT</code>, which cumulatively collect
            data from the time the counter is enabled, are unaffected by
            the reset.
          </p><pre class="programlisting">mysql&gt; SET GLOBAL innodb_monitor_reset = dml_inserts;
Query OK, 0 rows affected (0.00 sec)

mysql&gt; SELECT * FROM INFORMATION_SCHEMA.INNODB_METRICS WHERE NAME="dml_inserts"\G
*************************** 1. row ***************************
           NAME: dml_inserts
      SUBSYSTEM: dml
          COUNT: 3
      MAX_COUNT: 3
      MIN_COUNT: NULL
      AVG_COUNT: 0.03529411764705882
    COUNT_RESET: 0
MAX_COUNT_RESET: 0
MIN_COUNT_RESET: NULL
AVG_COUNT_RESET: 0
   TIME_ENABLED: 2014-12-04 14:18:28
  TIME_DISABLED: NULL
   TIME_ELAPSED: 85
     TIME_RESET: 2014-12-04 14:19:44
         STATUS: enabled
           TYPE: status_counter
        COMMENT: Number of rows inserted</pre></li><li class="listitem"><p>
            To reset all counter values, you must first disable the
            counter. Disabling the counter sets the
            <code class="literal">STATUS</code> value to
            <code class="literal">disbaled</code>.
          </p><pre class="programlisting">mysql&gt; SET GLOBAL innodb_monitor_disable = dml_inserts;
Query OK, 0 rows affected (0.00 sec)
          
mysql&gt; SELECT * FROM INFORMATION_SCHEMA.INNODB_METRICS WHERE NAME="dml_inserts"\G
*************************** 1. row ***************************
           NAME: dml_inserts
      SUBSYSTEM: dml
          COUNT: 3
      MAX_COUNT: 3
      MIN_COUNT: NULL
      AVG_COUNT: 0.030612244897959183
    COUNT_RESET: 0
MAX_COUNT_RESET: 0
MIN_COUNT_RESET: NULL
AVG_COUNT_RESET: 0
   TIME_ENABLED: 2014-12-04 14:18:28
  TIME_DISABLED: 2014-12-04 14:20:06
   TIME_ELAPSED: 98
     TIME_RESET: NULL
         STATUS: disabled
           TYPE: status_counter
COMMENT: Number of rows inserted</pre>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
              Wildcard match is supported for counter and module names.
              For example, instead of specifying the full
              <code class="literal">dml_inserts</code> counter name, you can
              specify <span class="quote">“<span class="quote"><code class="literal">dml_i%</code></span>”</span>. You can
              also enable, disable, or reset multiple counters or
              modules at once using a wildcard match. For example,
              specify <span class="quote">“<span class="quote"><code class="literal">dml_%</code></span>”</span> to enable,
              disable, or reset all counters that begin with
              <span class="quote">“<span class="quote"><code class="literal">dml_%</code>.</span>”</span>
</p>
</div>
</li><li class="listitem"><p>
            After the counter is disabled, you can reset all counter
            values using the
            <a class="link" href="innodb-storage-engine.html#sysvar_innodb_monitor_reset_all"><code class="literal">innodb_monitor_reset_all</code></a>
            option. All values are set to zero or NULL.
          </p><pre class="programlisting">mysql&gt; SET GLOBAL innodb_monitor_reset_all = dml_inserts;
Query OK, 0 rows affected (0.00 sec) 
          
mysql&gt; SELECT * FROM INFORMATION_SCHEMA.INNODB_METRICS WHERE NAME="dml_inserts"\G
*************************** 1. row ***************************
           NAME: dml_inserts
      SUBSYSTEM: dml
          COUNT: 0
      MAX_COUNT: NULL
      MIN_COUNT: NULL
      AVG_COUNT: NULL
    COUNT_RESET: 0
MAX_COUNT_RESET: NULL
MIN_COUNT_RESET: NULL
AVG_COUNT_RESET: NULL
   TIME_ENABLED: NULL
  TIME_DISABLED: NULL
   TIME_ELAPSED: NULL
     TIME_RESET: NULL
         STATUS: disabled
           TYPE: status_counter
COMMENT: Number of rows inserted</pre></li></ol>
</div>

</div>

</div>
<br class="example-break">
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="innodb-information-schema-temp-table-info"></a>14.12.7 InnoDB INFORMATION_SCHEMA Temporary Table Information Table</h3>

</div>

</div>

</div>
<p>
      The <a class="link" href="information-schema.html#innodb-temp-table-info-table" title="21.31.27 The INFORMATION_SCHEMA INNODB_TEMP_TABLE_INFO Table"><code class="literal">INNODB_TEMP_TABLE_INFO</code></a> table,
      introduced in MySQL 5.7.1, provides users with a snapshot of
      active <code class="literal">InnoDB</code> temporary tables. The table
      contains metadata about all user and system-created temporary
      tables that are active within a given <code class="literal">InnoDB</code>
      instance with the exception of optimized temporary tables that are
      used internally by <code class="literal">InnoDB</code>.
    </p><pre class="programlisting">mysql&gt; SHOW TABLES FROM INFORMATION_SCHEMA LIKE 'INNODB_TEMP%';
+---------------------------------------------+
| Tables_in_INFORMATION_SCHEMA (INNODB_TEMP%) |
+---------------------------------------------+
| INNODB_TEMP_TABLE_INFO                      |
+---------------------------------------------+</pre><p>
      For the table definition, see
      <a class="xref" href="information-schema.html#innodb-temp-table-info-table" title="21.31.27 The INFORMATION_SCHEMA INNODB_TEMP_TABLE_INFO Table">Section 21.31.27, “The INFORMATION_SCHEMA INNODB_TEMP_TABLE_INFO Table”</a>.
</p>
<div class="example">
<a name="innodb-information-schema-temp-table-info-example"></a><p class="title"><b>Example 14.23 INNODB_TEMP_TABLE_INFO</b></p>
<div class="example-contents">
<p>
        This example demonstrates characteristics of the
        <a class="link" href="information-schema.html#innodb-temp-table-info-table" title="21.31.27 The INFORMATION_SCHEMA INNODB_TEMP_TABLE_INFO Table"><code class="literal">INNODB_TEMP_TABLE_INFO</code></a> table.
</p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p>
            Create a simple <code class="literal">InnoDB</code> temporary table
            with a single column:
          </p><pre class="programlisting">mysql&gt; CREATE TEMPORARY TABLE t1 (c1 INT PRIMARY KEY) ENGINE=INNODB;
Query OK, 0 rows affected (0.00 sec)</pre></li><li class="listitem"><p>
            Query the
            <a class="link" href="information-schema.html#innodb-temp-table-info-table" title="21.31.27 The INFORMATION_SCHEMA INNODB_TEMP_TABLE_INFO Table"><code class="literal">INNODB_TEMP_TABLE_INFO</code></a> table to
            view the temporary table's metadata.
          </p><pre class="programlisting">mysql&gt; SELECT * FROM INFORMATION_SCHEMA.INNODB_TEMP_TABLE_INFO\G
*************************** 1. row ***************************
            TABLE_ID: 194
                NAME: #sql7a79_1_0
              N_COLS: 4
               SPACE: 182
PER_TABLE_TABLESPACE: FALSE
       IS_COMPRESSED: FALSE</pre><p>
            The <code class="literal">TABLE_ID </code> is a unique identifier for
            the temporary table. The <code class="literal">NAME</code> column
            displays the system-generated name for the temporary table,
            which is prefixed with <span class="quote">“<span class="quote">#sql</span>”</span>. The number of
            columns (<code class="literal">N_COLS</code>) is 4 rather than 1
            because <code class="literal">InnoDB</code> always creates three
            hidden table columns (<code class="literal">DB_ROW_ID</code>,
            <code class="literal">DB_TRX_ID</code>, and
            <code class="literal">DB_ROLL_PTR</code>).
            <code class="literal">PER_TABLE_TABLESPACE</code> and
            <code class="literal">IS_COMPRESSED</code> only report
            <code class="literal">TRUE</code> for compressed temporary tables.
          </p></li><li class="listitem"><p>
            Create a compressed temporary table. Before you do so,
            ensure that
            <a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_format"><code class="literal">innodb_file_format</code></a> is set
            to <code class="literal">Barracuda</code>, which is required to create
            tables with a compressed row format.
          </p><pre class="programlisting">mysql&gt; SET GLOBAL innodb_file_format="Barracuda";
Query OK, 0 rows affected (0.00 sec)

mysql&gt; CREATE TEMPORARY TABLE t2 (c1 INT) ROW_FORMAT=COMPRESSED ENGINE=INNODB;
Query OK, 0 rows affected (0.01 sec)</pre></li><li class="listitem"><p>
            Query the
            <a class="link" href="information-schema.html#innodb-temp-table-info-table" title="21.31.27 The INFORMATION_SCHEMA INNODB_TEMP_TABLE_INFO Table"><code class="literal">INNODB_TEMP_TABLE_INFO</code></a> table
            again.
          </p><pre class="programlisting">mysql&gt; CREATE TEMPORARY TABLE t2 (c1 INT) ROW_FORMAT=COMPRESSED ENGINE=INNODB;
Query OK, 0 rows affected (0.01 sec) 

mysql&gt; SELECT * FROM INFORMATION_SCHEMA.INNODB_TEMP_TABLE_INFO\G
*************************** 1. row ***************************
            TABLE_ID: 195
                NAME: #sql7a79_1_1
              N_COLS: 4
               SPACE: 183
PER_TABLE_TABLESPACE: TRUE
       IS_COMPRESSED: TRUE
*************************** 2. row ***************************
            TABLE_ID: 194
                NAME: #sql7a79_1_0
              N_COLS: 4
               SPACE: 182
PER_TABLE_TABLESPACE: FALSE
       IS_COMPRESSED: FALSE</pre><p>
            <code class="literal">PER_TABLE_TABLESPACE</code> and
            <code class="literal">IS_COMPRESSED</code> report
            <code class="literal">TRUE</code> for the compressed temporary table.
            The <code class="literal">SPACE</code> ID for the compressed temporary
            table is different because compressed temporary tables are
            created in separate per-table tablespaces. Non-compressed
            temporary tables share a single tablespace
            (<code class="filename">ibtmp1</code>, by default) and report the
            same <code class="literal">SPACE</code> ID.
          </p></li><li class="listitem"><p>
            Restart MySQL and query the
            <a class="link" href="information-schema.html#innodb-temp-table-info-table" title="21.31.27 The INFORMATION_SCHEMA INNODB_TEMP_TABLE_INFO Table"><code class="literal">INNODB_TEMP_TABLE_INFO</code></a> table.
          </p><pre class="programlisting">mysql&gt; SELECT * FROM INFORMATION_SCHEMA.INNODB_TEMP_TABLE_INFO\G
Empty set (0.00 sec)
</pre><p>
            An empty set is returned because the
            <a class="link" href="information-schema.html#innodb-temp-table-info-table" title="21.31.27 The INFORMATION_SCHEMA INNODB_TEMP_TABLE_INFO Table"><code class="literal">INNODB_TEMP_TABLE_INFO</code></a> table
            and the data within it are not persisted to disk on server
            shutdown.
          </p></li><li class="listitem"><p>
            Create a new temporary table.
          </p><pre class="programlisting">mysql&gt; CREATE TEMPORARY TABLE t1 (c1 INT PRIMARY KEY) ENGINE=INNODB;
Query OK, 0 rows affected (0.00 sec)</pre></li><li class="listitem"><p>
            Query the
            <a class="link" href="information-schema.html#innodb-temp-table-info-table" title="21.31.27 The INFORMATION_SCHEMA INNODB_TEMP_TABLE_INFO Table"><code class="literal">INNODB_TEMP_TABLE_INFO</code></a> table to
            view the temporary table's metadata.
          </p><pre class="programlisting">mysql&gt; SELECT * FROM INFORMATION_SCHEMA.INNODB_TEMP_TABLE_INFO\G
*************************** 1. row ***************************
            TABLE_ID: 196
                NAME: #sql7b0e_1_0
              N_COLS: 4
               SPACE: 184
PER_TABLE_TABLESPACE: FALSE
       IS_COMPRESSED: FALSE</pre><p>
            The <code class="literal">SPACE</code> ID is new because it is
            dynamically generated on server restart.
</p></li></ol>
</div>

</div>

</div>
<br class="example-break">
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="innodb-information-schema-files-table"></a>14.12.8 Retrieving InnoDB Tablespace Metadata from INFORMATION_SCHEMA.FILES</h3>

</div>

</div>

</div>
<p>
      As of MySQL 5.7.8, the
      <a class="link" href="information-schema.html#files-table" title="21.8 The INFORMATION_SCHEMA FILES Table"><code class="literal">INFORMATION_SCHEMA.FILES</code></a> table
      provides metadata about all <code class="literal">InnoDB</code> tablespace
      types including <a class="link" href="glossary.html#glos_file_per_table" title="file-per-table">file-per-table
      tablespaces</a>,
      <a class="link" href="glossary.html#glos_general_tablespace" title="general tablespace">general
      tablespaces</a>, the
      <a class="link" href="glossary.html#glos_system_tablespace" title="system tablespace">system tablespace</a>,
      <a class="link" href="glossary.html#glos_temporary_tablespace" title="temporary tablespace">temporary table
      tablespaces</a>, and <a class="link" href="glossary.html#glos_undo_tablespace" title="undo tablespace">undo
      tablespaces</a> (if present).
    </p><p>
      This section provides <code class="literal">InnoDB</code>-specific usage
      examples. For more information about data provided by the
      <a class="link" href="information-schema.html#files-table" title="21.8 The INFORMATION_SCHEMA FILES Table"><code class="literal">INFORMATION_SCHEMA.FILES</code></a> table, see
      <a class="xref" href="information-schema.html#files-table" title="21.8 The INFORMATION_SCHEMA FILES Table">Section 21.8, “The INFORMATION_SCHEMA FILES Table”</a>.
</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
        The <a class="link" href="information-schema.html#innodb-sys-tablespaces-table" title="21.31.15 The INFORMATION_SCHEMA INNODB_SYS_TABLESPACES Table"><code class="literal">INNODB_SYS_TABLESPACES</code></a> and
        <a class="link" href="information-schema.html#innodb-sys-datafiles-table" title="21.31.14 The INFORMATION_SCHEMA INNODB_SYS_DATAFILES Table"><code class="literal">INNODB_SYS_DATAFILES</code></a> tables also
        provide metadata about <code class="literal">InnoDB</code> tablespaces,
        but data is limited to file-per-table and general tablespaces.
</p>
</div>
<p>
      This query retrieves metadata about the <code class="literal">InnoDB</code>
      system tablespace from fields of the
      <a class="link" href="information-schema.html#files-table" title="21.8 The INFORMATION_SCHEMA FILES Table"><code class="literal">INFORMATION_SCHEMA.FILES</code></a> table that
      are pertinent to <code class="literal">InnoDB</code> tablespaces.
      <a class="link" href="information-schema.html#files-table" title="21.8 The INFORMATION_SCHEMA FILES Table"><code class="literal">INFORMATION_SCHEMA.FILES</code></a> fields that
      are not relevant to <code class="literal">InnoDB</code> always return NULL,
      and are excluded from the query.
    </p><pre class="programlisting">mysql&gt; SELECT FILE_ID, FILE_NAME, FILE_TYPE, TABLESPACE_NAME, FREE_EXTENTS, 
TOTAL_EXTENTS,  EXTENT_SIZE, INITIAL_SIZE, MAXIMUM_SIZE, AUTOEXTEND_SIZE, DATA_FREE, STATUS ENGINE  
FROM INFORMATION_SCHEMA.FILES WHERE TABLESPACE_NAME LIKE 'innodb_system' \G
*************************** 1. row ***************************
        FILE_ID: 0
      FILE_NAME: ./ibdata1
      FILE_TYPE: TABLESPACE
TABLESPACE_NAME: innodb_system
   FREE_EXTENTS: 0
  TOTAL_EXTENTS: 12
    EXTENT_SIZE: 1048576
   INITIAL_SIZE: 12582912
   MAXIMUM_SIZE: NULL
AUTOEXTEND_SIZE: 67108864
      DATA_FREE: 4194304
         ENGINE: NORMAL</pre><p>
      This query retrieves the <code class="literal">FILE_ID</code> (equivalent to
      the space ID) and the <code class="literal">FILE_NAME</code> (which includes
      path information) for <code class="literal">InnoDB</code> file-per-table and
      general tablespaces. File-per-table and general tablespaces have a
      <code class="filename">.ibd</code> file extension.
    </p><pre class="programlisting">mysql&gt; SELECT FILE_ID, FILE_NAME FROM INFORMATION_SCHEMA.FILES 
WHERE FILE_NAME LIKE '%.ibd%' ORDER BY FILE_ID;
    +---------+---------------------------------------+
    | FILE_ID | FILE_NAME                             |
    +---------+---------------------------------------+
    |       2 | ./mysql/plugin.ibd                    |
    |       3 | ./mysql/servers.ibd                   |
    |       4 | ./mysql/help_topic.ibd                |
    |       5 | ./mysql/help_category.ibd             |
    |       6 | ./mysql/help_relation.ibd             |
    |       7 | ./mysql/help_keyword.ibd              |
    |       8 | ./mysql/time_zone_name.ibd            |
    |       9 | ./mysql/time_zone.ibd                 |
    |      10 | ./mysql/time_zone_transition.ibd      |
    |      11 | ./mysql/time_zone_transition_type.ibd |
    |      12 | ./mysql/time_zone_leap_second.ibd     |
    |      13 | ./mysql/innodb_table_stats.ibd        |
    |      14 | ./mysql/innodb_index_stats.ibd        |
    |      15 | ./mysql/slave_relay_log_info.ibd      |
    |      16 | ./mysql/slave_master_info.ibd         |
    |      17 | ./mysql/slave_worker_info.ibd         |
    |      18 | ./mysql/gtid_executed.ibd             |
    |      19 | ./mysql/server_cost.ibd               |
    |      20 | ./mysql/engine_cost.ibd               |
    |      21 | ./sys/sys_config.ibd                  |
    |      23 | ./test/t1.ibd                         |
    |      26 | /home/user/test/test/t2.ibd           |
    +---------+---------------------------------------+</pre><p>
      This query retrieves the <code class="literal">FILE_ID</code> and
      <code class="literal">FILE_NAME</code> for <code class="literal">InnoDB</code>
      temporary table tablespaces. Temporary table tablespace file names
      are prefixed by <code class="literal">ibtmp</code>.
    </p><pre class="programlisting">mysql&gt; SELECT FILE_ID, FILE_NAME FROM INFORMATION_SCHEMA.FILES 
WHERE FILE_NAME LIKE '%ibtmp%';
+---------+-----------+
| FILE_ID | FILE_NAME |
+---------+-----------+
|      22 | ./ibtmp1  |
+---------+-----------+</pre><p>
      Similarly, <code class="literal">InnoDB</code> undo tablespace file names
      are prefixed by <code class="literal">undo</code>. The following query
      returns the <code class="literal">FILE_ID</code> and
      <code class="literal">FILE_NAME</code> for <code class="literal">InnoDB</code> undo
      tablespaces, if separate undo tablespaces are configured.
    </p><pre class="programlisting">mysql&gt; SELECT FILE_ID, FILE_NAME FROM INFORMATION_SCHEMA.FILES 
WHERE FILE_NAME LIKE '%undo%';</pre>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="innodb-performance-schema"></a>14.13 InnoDB Integration with MySQL Performance Schema</h2>

</div>

</div>

</div>
<div class="toc">
<dl class="toc"><dt><span class="section"><a href="innodb-storage-engine.html#monitor-alter-table-performance-schema">14.13.1 Monitoring ALTER TABLE Progress for InnoDB Tables Using Performance
Schema</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#monitor-innodb-mutex-waits-performance-schema">14.13.2 Monitoring InnoDB Mutex Waits Using Performance Schema</a></span></dt></dl>
</div>
<a class="indexterm" name="idm140644102140080"></a><p>
    This section provides a brief introduction to
    <code class="literal">InnoDB</code> integration with Performance Schema. For
    comprehensive Performance Schema documentation, see
    <a class="xref" href="performance-schema.html" title="Chapter 22 MySQL Performance Schema">Chapter 22, <i>MySQL Performance Schema</i></a>.
  </p><p>
    You can profile certain internal <code class="literal">InnoDB</code>
    operations using the MySQL
    <a class="link" href="performance-schema.html" title="Chapter 22 MySQL Performance Schema">Performance Schema
    feature</a>. This type of tuning is primarily for expert users
    who evaluate optimization strategies to overcome performance
    bottlenecks. DBAs can also use this feature for capacity planning,
    to see whether their typical workload encounters any performance
    bottlenecks with a particular combination of CPU, RAM, and disk
    storage; and if so, to judge whether performance can be improved by
    increasing the capacity of some part of the system.
  </p><p>
    To use this feature to examine <code class="literal">InnoDB</code>
    performance:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
        You must be generally familiar with how to use the
        <a class="link" href="performance-schema.html" title="Chapter 22 MySQL Performance Schema">Performance Schema
        feature</a>. For example, you should know how enable
        instruments and consumers, and how to query
        <code class="literal">performance_schema</code> tables to retrieve data.
        For an introductory overview, see
        <a class="xref" href="performance-schema.html#performance-schema-quick-start" title="22.1 Performance Schema Quick Start">Section 22.1, “Performance Schema Quick Start”</a>.
      </p></li><li class="listitem"><p>
        You should be familiar with Performance Schema instruments that
        are available for <code class="literal">InnoDB</code>. To view
        <code class="literal">InnoDB</code>-related instruments, you can query the
        <a class="link" href="performance-schema.html#setup-instruments-table" title="22.9.2.3 The setup_instruments Table"><code class="literal">setup_instruments</code></a> table for
        instrument names that contain '<code class="literal">innodb</code>'.
      </p><pre class="programlisting">mysql&gt; SELECT * FROM setup_instruments WHERE NAME LIKE '%innodb%';
+-------------------------------------------------------+---------+-------+
| NAME                                                  | ENABLED | TIMED |
+-------------------------------------------------------+---------+-------+
| wait/synch/mutex/innodb/commit_cond_mutex             | NO      | NO    |
| wait/synch/mutex/innodb/innobase_share_mutex          | NO      | NO    |
| wait/synch/mutex/innodb/autoinc_mutex                 | NO      | NO    |
| wait/synch/mutex/innodb/buf_pool_mutex                | NO      | NO    |
| wait/synch/mutex/innodb/buf_pool_zip_mutex            | NO      | NO    |
| wait/synch/mutex/innodb/cache_last_read_mutex         | NO      | NO    |
| wait/synch/mutex/innodb/dict_foreign_err_mutex        | NO      | NO    |
| wait/synch/mutex/innodb/dict_sys_mutex                | NO      | NO    |
| wait/synch/mutex/innodb/recalc_pool_mutex             | NO      | NO    |
| wait/synch/mutex/innodb/file_format_max_mutex         | NO      | NO    |
...
| wait/io/file/innodb/innodb_data_file                  | YES     | YES   |
| wait/io/file/innodb/innodb_log_file                   | YES     | YES   |
| wait/io/file/innodb/innodb_temp_file                  | YES     | YES   |
| stage/innodb/alter table (end)                        | YES     | YES   |
| stage/innodb/alter table (flush)                      | YES     | YES   |
| stage/innodb/alter table (insert)                     | YES     | YES   |
| stage/innodb/alter table (log apply index)            | YES     | YES   |
| stage/innodb/alter table (log apply table)            | YES     | YES   |
| stage/innodb/alter table (merge sort)                 | YES     | YES   |
| stage/innodb/alter table (read PK and internal sort)  | YES     | YES   |
| stage/innodb/buffer pool load                         | YES     | YES   |
| memory/innodb/buf_buf_pool                            | NO      | NO    |
| memory/innodb/dict_stats_bg_recalc_pool_t             | NO      | NO    |
| memory/innodb/dict_stats_index_map_t                  | NO      | NO    |
| memory/innodb/dict_stats_n_diff_on_level              | NO      | NO    |
| memory/innodb/other                                   | NO      | NO    |
| memory/innodb/row_log_buf                             | NO      | NO    |
| memory/innodb/row_merge_sort                          | NO      | NO    |
| memory/innodb/std                                     | NO      | NO    |
| memory/innodb/sync_debug_latches                      | NO      | NO    |
| memory/innodb/trx_sys_t::rw_trx_ids                   | NO      | NO    |
...
+-------------------------------------------------------+---------+-------+
155 rows in set (0.00 sec)</pre><p>
        For additional information about the instrumented
        <code class="literal">InnoDB</code> objects, you can query Performance
        Schema
        <a class="link" href="performance-schema.html#performance-schema-instance-tables" title="22.9.3 Performance Schema Instance Tables">instances
        tables</a>, which provide additional information about
        instrumented objects. Instance tables relevant to
        <code class="literal">InnoDB</code> include:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
            The <a class="link" href="performance-schema.html#mutex-instances-table" title="22.9.3.3 The mutex_instances Table"><code class="literal">mutex_instances</code></a> table
          </p></li><li class="listitem"><p>
            The <a class="link" href="performance-schema.html#rwlock-instances-table" title="22.9.3.4 The rwlock_instances Table"><code class="literal">rwlock_instances</code></a> table
          </p></li><li class="listitem"><p>
            The <a class="link" href="performance-schema.html#cond-instances-table" title="22.9.3.1 The cond_instances Table"><code class="literal">cond_instances</code></a> table
          </p></li><li class="listitem"><p>
            The <a class="link" href="performance-schema.html#file-instances-table" title="22.9.3.2 The file_instances Table"><code class="literal">file_instances</code></a> table
</p></li></ul>
</div>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">
<div class="admon-title">
Note
</div>
<p>
          Mutexes and RW-locks related to the <code class="literal">InnoDB</code>
          buffer pool are not included in this coverage; the same
          applies to the output of the <code class="literal">SHOW ENGINE INNODB
          MUTEX</code> command.
</p>
</div>
<p>
        For example, to view information about instrumented
        <code class="literal">InnoDB</code> file objects seen by the Performance
        Schema when executing file I/O instrumentation, you might issue
        the following query:
      </p><pre class="programlisting">mysql&gt; SELECT * FROM file_instances WHERE EVENT_NAME LIKE '%innodb%'\G
*************************** 1. row ***************************
 FILE_NAME: /path/to/mysql-5.7/data/ibdata1
EVENT_NAME: wait/io/file/innodb/innodb_data_file
OPEN_COUNT: 3
*************************** 2. row ***************************
 FILE_NAME: /path/to/mysql-5.7/data/ib_logfile0
EVENT_NAME: wait/io/file/innodb/innodb_log_file
OPEN_COUNT: 2
*************************** 3. row ***************************
 FILE_NAME: /path/to/mysql-5.7/data/ib_logfile1
EVENT_NAME: wait/io/file/innodb/innodb_log_file
OPEN_COUNT: 2
*************************** 4. row ***************************
 FILE_NAME: /path/to/mysql-5.7/data/mysql/engine_cost.ibd
EVENT_NAME: wait/io/file/innodb/innodb_data_file
OPEN_COUNT: 3
...</pre></li><li class="listitem"><p>
        You should be familiar with
        <code class="literal">performance_schema</code> tables that store
        <code class="literal">InnoDB</code> event data. Tables relevant to
        <code class="literal">InnoDB</code>-related events include:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
            The <a class="link" href="performance-schema.html#performance-schema-wait-tables" title="22.9.4 Performance Schema Wait Event Tables">Wait
            Event</a> tables, which store wait events.
          </p></li><li class="listitem"><p>
            The
            <a class="link" href="performance-schema.html#performance-schema-summary-tables" title="22.9.14 Performance Schema Summary Tables">Summary</a>
            tables, which provide aggregated information for terminated
            events over time. Summary tables include
            <a class="link" href="performance-schema.html#file-summary-tables" title="22.9.14.6 File I/O Summary Tables">file I/O summary
            tables</a>, which aggregate information about I/O
            operations.
          </p></li><li class="listitem"><p>
            <a class="link" href="performance-schema.html#performance-schema-stage-tables" title="22.9.5 Performance Schema Stage Event Tables">Stage
            Event</a> tables, which store event data for
            <code class="literal">InnoDB</code> <a class="link" href="sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE Syntax"><code class="literal">ALTER
            TABLE</code></a> and buffer pool load operations. For more
            information, see
            <a class="xref" href="innodb-storage-engine.html#monitor-alter-table-performance-schema" title="14.13.1 Monitoring ALTER TABLE Progress for InnoDB Tables Using Performance Schema">Section 14.13.1, “Monitoring ALTER TABLE Progress for InnoDB Tables Using Performance
      Schema”</a>,
            and
            <a class="xref" href="innodb-storage-engine.html#monitor-buffer-pool-load-performance-schema" title="14.3.3.5.1 Monitoring Buffer Pool Load Progress Using Performance Schema">Section 14.3.3.5.1, “Monitoring Buffer Pool Load Progress Using Performance Schema”</a>.
</p></li></ul>
</div>
<p>
        If you are only interested in <code class="literal">InnoDB</code>-related
        objects, use the clause <code class="literal">WHERE EVENT_NAME LIKE
        '%innodb%'</code> or <code class="literal">WHERE NAME LIKE
        '%innodb%'</code> (as required) when querying these tables.
</p></li></ul>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="monitor-alter-table-performance-schema"></a>14.13.1 Monitoring ALTER TABLE Progress for InnoDB Tables Using Performance
Schema</h3>
</div>
</div>
</div>
<p>
      As of MySQL 5.7.6, you can monitor <a class="link" href="sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE Syntax"><code class="literal">ALTER
      TABLE</code></a> progress for <code class="literal">InnoDB</code> tables
      using <a class="link" href="performance-schema.html" title="Chapter 22 MySQL Performance Schema">Performance
      Schema</a>.
    </p><p>
      There are seven stage events that represent different phases of
      <a class="link" href="sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a>. Each stage event
      reports a running total of <code class="literal">WORK_COMPLETED</code> and
      <code class="literal">WORK_ESTIMATED</code> for the overall
      <a class="link" href="sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a> operation as it
      progresses through its different phases.
      <code class="literal">WORK_ESTIMATED</code> is calculated using a formula
      that takes into account all of the work that
      <a class="link" href="sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a> performs, and may be
      revised during <a class="link" href="sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a>
      processing. <code class="literal">WORK_COMPLETED</code> and
      <code class="literal">WORK_ESTIMATED</code> values are an abstract
      representation of all of the work performed by
      <a class="link" href="sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a>.
    </p><p>
      In order of occurrence, <a class="link" href="sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a>
      stage events include:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          <code class="literal">stage/innodb/alter table (read PK and internal
          sort)</code>: This stage is active when
          <a class="link" href="sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a> is in the
          reading-primary-key phase. It starts with
          <code class="literal">WORK_COMPLETED=0</code> and
          <code class="literal">WORK_ESTIMATED</code> set to the estimated number
          of pages in the primary key. When the stage is completed,
          <code class="literal">WORK_ESTIMATED</code> is updated to the actual
          number of pages in the primary key.
        </p></li><li class="listitem"><p>
          <code class="literal">stage/innodb/alter table (merge sort)</code>: This
          stage is repeated for each index added by the
          <a class="link" href="sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a> operation.
        </p></li><li class="listitem"><p>
          <code class="literal">stage/innodb/alter table (insert)</code>: This
          stage is repeated for each index added by the
          <a class="link" href="sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a> operation.
        </p></li><li class="listitem"><p>
          <code class="literal">stage/innodb/alter table (log apply index)</code>:
          This stage includes the application of DML log generated while
          <a class="link" href="sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a> was running.
        </p></li><li class="listitem"><p>
          <code class="literal">stage/innodb/alter table (flush)</code>: Before
          this stage begins, <code class="literal">WORK_ESTIMATED</code> is
          updated with a more accurate estimate, based on the length of
          the flush list.
        </p></li><li class="listitem"><p>
          <code class="literal">stage/innodb/alter table (log apply table)</code>:
          This stage includes the application of concurrent DML log
          generated while <a class="link" href="sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a> was
          running. The duration of this phase depends on the extent of
          table changes. This phase is instant if no concurrent DML was
          run on the table.
        </p></li><li class="listitem"><p>
          <code class="literal">stage/innodb/alter table (end)</code>: Includes
          any remaining work that appeared after the flush phase, such
          as reapplying DML that was executed on the table while
          <a class="link" href="sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a> was running.
</p></li></ul>
</div>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">
<div class="admon-title">
Note
</div>
<p>
        <code class="literal">InnoDB</code> <a class="link" href="sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE Syntax"><code class="literal">ALTER
        TABLE</code></a> stage events do not currently account for the
        addition of spatial indexes.
</p>
</div>
<h4><a name="idm140644102043408"></a>ALTER TABLE Monitoring Example Using Performance Schema</h4>
<p>
      The following example demonstrates how to enable the
      <code class="literal">stage/innodb/alter table%</code> stage event
      instruments and related consumer tables to monitor
      <a class="link" href="sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a> progress. For
      information about Performance Schema stage event instruments and
      related consumers, see
      <a class="xref" href="performance-schema.html#performance-schema-stage-tables" title="22.9.5 Performance Schema Stage Event Tables">Section 22.9.5, “Performance Schema Stage Event Tables”</a>.
</p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p>
          Enable the <code class="literal">stage/innodb/alter%</code> instruments:
        </p><pre class="programlisting">mysql&gt; UPDATE setup_instruments SET ENABLED = 'YES' WHERE NAME LIKE 'stage/innodb/alter%';
Query OK, 7 rows affected (0.00 sec)
Rows matched: 7  Changed: 7  Warnings: 0</pre></li><li class="listitem"><p>
          Enable the stage event consumer tables, which include
          <a class="link" href="performance-schema.html#events-stages-current-table" title="22.9.5.1 The events_stages_current Table"><code class="literal">events_stages_current</code></a>,
          <a class="link" href="performance-schema.html#events-stages-history-table" title="22.9.5.2 The events_stages_history Table"><code class="literal">events_stages_history</code></a>, and
          <a class="link" href="performance-schema.html#events-stages-history-long-table" title="22.9.5.3 The events_stages_history_long Table"><code class="literal">events_stages_history_long</code></a>.
        </p><pre class="programlisting">mysql&gt; UPDATE setup_consumers SET ENABLED = 'YES' WHERE NAME LIKE '%stages%';
Query OK, 3 rows affected (0.00 sec)
Rows matched: 3  Changed: 3  Warnings: 0</pre></li><li class="listitem"><p>
          Run an <a class="link" href="sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a> operation.
          In this example, a <code class="literal">middle_name</code> column is
          added to the employees table of the employees sample database.
        </p><pre class="programlisting">mysql&gt; ALTER TABLE employees.employees ADD COLUMN middle_name varchar(14) AFTER first_name; 
Query OK, 0 rows affected (9.27 sec)
Records: 0  Duplicates: 0  Warnings: 0</pre></li><li class="listitem"><p>
          Check the progress of the <a class="link" href="sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE Syntax"><code class="literal">ALTER
          TABLE</code></a> operation by querying the Performance Schema
          <a class="link" href="performance-schema.html#events-stages-current-table" title="22.9.5.1 The events_stages_current Table"><code class="literal">events_stages_current</code></a> table. The
          stage event shown differs depending on which
          <a class="link" href="sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a> phase is currently
          in progress. The <code class="literal">WORK_COMPLETED</code> column
          shows the work completed. The
          <code class="literal">WORK_ESTIMATED</code> column provides an estimate
          of the remaining work.
        </p><pre class="programlisting">mysql&gt; SELECT EVENT_NAME, WORK_COMPLETED, WORK_ESTIMATED FROM events_stages_current;
+------------------------------------------------------+----------------+----------------+
| EVENT_NAME                                           | WORK_COMPLETED | WORK_ESTIMATED |
+------------------------------------------------------+----------------+----------------+
| stage/innodb/alter table (read PK and internal sort) |            280 |           1245 |
+------------------------------------------------------+----------------+----------------+
1 row in set (0.01 sec)</pre><p>
          The <a class="link" href="performance-schema.html#events-stages-current-table" title="22.9.5.1 The events_stages_current Table"><code class="literal">events_stages_current</code></a> table
          returns an empty set if the <a class="link" href="sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE Syntax"><code class="literal">ALTER
          TABLE</code></a> operation has completed. In this case, you can
          check the <a class="link" href="performance-schema.html#events-stages-history-table" title="22.9.5.2 The events_stages_history Table"><code class="literal">events_stages_history</code></a>
          table to view event data for the completed operation. For
          example:
        </p><pre class="programlisting">mysql&gt; SELECT EVENT_NAME, WORK_COMPLETED, WORK_ESTIMATED FROM events_stages_history;
+------------------------------------------------------+----------------+----------------+
| EVENT_NAME                                           | WORK_COMPLETED | WORK_ESTIMATED |
+------------------------------------------------------+----------------+----------------+
| stage/innodb/alter table (read PK and internal sort) |            886 |           1213 |
| stage/innodb/alter table (flush)                     |           1213 |           1213 |
| stage/innodb/alter table (log apply table)           |           1597 |           1597 |
| stage/innodb/alter table (end)                       |           1597 |           1597 |
| stage/innodb/alter table (log apply table)           |           1981 |           1981 |
+------------------------------------------------------+----------------+----------------+
5 rows in set (0.00 sec)</pre><p>
          As shown above, the <code class="literal">WORK_ESTIMATED</code> value
          was revised during <code class="literal">ALTER TABLE</code> processing.
          The estimated work after completion of the initial stage is
          1213. When <code class="literal">ALTER TABLE</code> processing
          completed, <code class="literal">WORK_ESTIMATED</code> was set to the
          actual value, which is 1981.
</p></li></ol>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="monitor-innodb-mutex-waits-performance-schema"></a>14.13.2 Monitoring InnoDB Mutex Waits Using Performance Schema</h3>

</div>

</div>

</div>
<p>
      A mutex is a synchronization mechanism used in the code to enforce
      that only one thread at a given time can have access to a common
      resource. When two or more threads executing in the server need to
      access the same resource, the threads compete against each other.
      The first thread to obtain a lock on the mutex causes the other
      threads to wait until the lock is released.
    </p><p>
      For <code class="literal">InnoDB</code> mutexes that are instrumented, mutex
      waits can be monitored using
      <a class="link" href="performance-schema.html" title="Chapter 22 MySQL Performance Schema">Performance Schema</a>. Wait
      event data collected in Performance Schema tables can help
      identify mutexes with the most waits or the greatest total wait
      time, for example.
    </p><p>
      The following example demonstrates how to enable
      <code class="literal">InnoDB</code> mutex wait instruments, how to enable
      associated consumers, and how to query wait event data.
</p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p>
          To view available <code class="literal">InnoDB</code> mutex wait
          instruments, query the Performance Schema
          <a class="link" href="performance-schema.html#setup-instruments-table" title="22.9.2.3 The setup_instruments Table"><code class="literal">setup_instruments</code></a> table, as shown
          below. All <code class="literal">InnoDB</code> mutex wait instruments
          are disabled by default.
        </p><pre class="programlisting">mysql&gt; SELECT * FROM performance_schema.setup_instruments 
WHERE NAME LIKE '%wait/synch/mutex/innodb%';
+-------------------------------------------------------+---------+-------+
| NAME                                                  | ENABLED | TIMED |
+-------------------------------------------------------+---------+-------+
| wait/synch/mutex/innodb/commit_cond_mutex             | NO      | NO    |
| wait/synch/mutex/innodb/innobase_share_mutex          | NO      | NO    |
| wait/synch/mutex/innodb/autoinc_mutex                 | NO      | NO    |
| wait/synch/mutex/innodb/buf_pool_mutex                | NO      | NO    |
| wait/synch/mutex/innodb/buf_pool_zip_mutex            | NO      | NO    |
| wait/synch/mutex/innodb/cache_last_read_mutex         | NO      | NO    |
| wait/synch/mutex/innodb/dict_foreign_err_mutex        | NO      | NO    |
| wait/synch/mutex/innodb/dict_sys_mutex                | NO      | NO    |
| wait/synch/mutex/innodb/recalc_pool_mutex             | NO      | NO    |
| wait/synch/mutex/innodb/file_format_max_mutex         | NO      | NO    |
| wait/synch/mutex/innodb/fil_system_mutex              | NO      | NO    |
| wait/synch/mutex/innodb/flush_list_mutex              | NO      | NO    |
| wait/synch/mutex/innodb/fts_bg_threads_mutex          | NO      | NO    |
| wait/synch/mutex/innodb/fts_delete_mutex              | NO      | NO    |
| wait/synch/mutex/innodb/fts_optimize_mutex            | NO      | NO    |
| wait/synch/mutex/innodb/fts_doc_id_mutex              | NO      | NO    |
| wait/synch/mutex/innodb/log_flush_order_mutex         | NO      | NO    |
| wait/synch/mutex/innodb/hash_table_mutex              | NO      | NO    |
| wait/synch/mutex/innodb/ibuf_bitmap_mutex             | NO      | NO    |
| wait/synch/mutex/innodb/ibuf_mutex                    | NO      | NO    |
| wait/synch/mutex/innodb/ibuf_pessimistic_insert_mutex | NO      | NO    |
| wait/synch/mutex/innodb/log_sys_mutex                 | NO      | NO    |
| wait/synch/mutex/innodb/page_zip_stat_per_index_mutex | NO      | NO    |
| wait/synch/mutex/innodb/purge_sys_pq_mutex            | NO      | NO    |
| wait/synch/mutex/innodb/recv_sys_mutex                | NO      | NO    |
| wait/synch/mutex/innodb/recv_writer_mutex             | NO      | NO    |
| wait/synch/mutex/innodb/redo_rseg_mutex               | NO      | NO    |
| wait/synch/mutex/innodb/noredo_rseg_mutex             | NO      | NO    |
| wait/synch/mutex/innodb/rw_lock_list_mutex            | NO      | NO    |
| wait/synch/mutex/innodb/rw_lock_mutex                 | NO      | NO    |
| wait/synch/mutex/innodb/srv_dict_tmpfile_mutex        | NO      | NO    |
| wait/synch/mutex/innodb/srv_innodb_monitor_mutex      | NO      | NO    |
| wait/synch/mutex/innodb/srv_misc_tmpfile_mutex        | NO      | NO    |
| wait/synch/mutex/innodb/srv_monitor_file_mutex        | NO      | NO    |
| wait/synch/mutex/innodb/buf_dblwr_mutex               | NO      | NO    |
| wait/synch/mutex/innodb/trx_undo_mutex                | NO      | NO    |
| wait/synch/mutex/innodb/trx_pool_mutex                | NO      | NO    |
| wait/synch/mutex/innodb/trx_pool_manager_mutex        | NO      | NO    |
| wait/synch/mutex/innodb/srv_sys_mutex                 | NO      | NO    |
| wait/synch/mutex/innodb/lock_mutex                    | NO      | NO    |
| wait/synch/mutex/innodb/lock_wait_mutex               | NO      | NO    |
| wait/synch/mutex/innodb/trx_mutex                     | NO      | NO    |
| wait/synch/mutex/innodb/srv_threads_mutex             | NO      | NO    |
| wait/synch/mutex/innodb/rtr_active_mutex              | NO      | NO    |
| wait/synch/mutex/innodb/rtr_match_mutex               | NO      | NO    |
| wait/synch/mutex/innodb/rtr_path_mutex                | NO      | NO    |
| wait/synch/mutex/innodb/rtr_ssn_mutex                 | NO      | NO    |
| wait/synch/mutex/innodb/trx_sys_mutex                 | NO      | NO    |
| wait/synch/mutex/innodb/zip_pad_mutex                 | NO      | NO    |
+-------------------------------------------------------+---------+-------+
49 rows in set (0.02 sec)</pre></li><li class="listitem"><p>
          Some <code class="literal">InnoDB</code> mutex instances are created at
          server startup and are only instrumented if the associated
          instrument is also enabled at server startup. To ensure that
          all <code class="literal">InnoDB</code> mutex instances are instrumented
          and enabled, add the following
          <code class="literal">performance-schema-instrument</code> rule to your
          MySQL configuration file:
        </p><pre class="programlisting">performance-schema-instrument='wait/synch/mutex/innodb/%=ON'</pre><p>
          If you do not require wait event data for all
          <code class="literal">InnoDB</code> mutexes, you can disable specific
          instruments by adding additional
          <code class="literal">performance-schema-instrument</code> rules to your
          MySQL configuration file. For example, to disable
          <code class="literal">InnoDB</code> mutex wait event instruments related
          to full-text search, add the following rule:
</p><pre class="programlisting">performance-schema-instrument='wait/synch/mutex/innodb/fts%=OFF'</pre>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
            Rules with a longer prefix such as
            <code class="literal">wait/synch/mutex/innodb/fts%</code> take
            precedence over rules with shorter prefixes such as
            <code class="literal">wait/synch/mutex/innodb/%</code>.
</p>
</div>
<p>
          After adding the
          <code class="literal">performance-schema-instrument</code> rules to your
          configuration file, restart the server. All the
          <code class="literal">InnoDB</code> mutexes except for those related to
          full text search are enabled. To verify, query the
          <a class="link" href="performance-schema.html#setup-instruments-table" title="22.9.2.3 The setup_instruments Table"><code class="literal">setup_instruments</code></a> table. The
          <code class="literal">ENABLED</code> and <code class="literal">TIMED</code>
          columns should be set to <code class="literal">YES</code> for the
          instruments that you enabled.
        </p><pre class="programlisting">mysql&gt; SELECT * FROM performance_schema.setup_instruments 
WHERE NAME LIKE '%wait/synch/mutex/innodb%';
+-------------------------------------------------------+---------+-------+
| NAME                                                  | ENABLED | TIMED |
+-------------------------------------------------------+---------+-------+
| wait/synch/mutex/innodb/commit_cond_mutex             | YES     | YES   |
| wait/synch/mutex/innodb/innobase_share_mutex          | YES     | YES   |
| wait/synch/mutex/innodb/autoinc_mutex                 | YES     | YES   |
...
| wait/synch/mutex/innodb/zip_pad_mutex                 | YES     | YES   |
+-------------------------------------------------------+---------+-------+
49 rows in set (0.00 sec)</pre></li><li class="listitem"><p>
          Enable wait event consumers by updating the
          <a class="link" href="performance-schema.html#setup-consumers-table" title="22.9.2.2 The setup_consumers Table"><code class="literal">setup_consumers</code></a> table. Wait event
          consumers are disabled by default.
        </p><pre class="programlisting">mysql&gt; UPDATE performance_schema.setup_consumers SET enabled = 'YES' 
WHERE name like 'events_waits%';
Query OK, 3 rows affected (0.00 sec)
Rows matched: 3  Changed: 3  Warnings: 0</pre><p>
          You can verify that wait event consumers are enabled by
          querying the <a class="link" href="performance-schema.html#setup-consumers-table" title="22.9.2.2 The setup_consumers Table"><code class="literal">setup_consumers</code></a>
          table. The <a class="link" href="performance-schema.html#events-waits-current-table" title="22.9.4.1 The events_waits_current Table"><code class="literal">events_waits_current</code></a>,
          <a class="link" href="performance-schema.html#events-waits-history-table" title="22.9.4.2 The events_waits_history Table"><code class="literal">events_waits_history</code></a>, and
          <a class="link" href="performance-schema.html#events-waits-history-long-table" title="22.9.4.3 The events_waits_history_long Table"><code class="literal">events_waits_history_long</code></a>
          consumers should be enabled.
        </p><pre class="programlisting">mysql&gt; SELECT * FROM performance_schema.setup_consumers;
+----------------------------------+---------+
| NAME                             | ENABLED |
+----------------------------------+---------+
| events_stages_current            | NO      |
| events_stages_history            | NO      |
| events_stages_history_long       | NO      |
| events_statements_current        | YES     |
| events_statements_history        | YES     |
| events_statements_history_long   | NO      |
| events_transactions_current      | YES     |
| events_transactions_history      | YES     |
| events_transactions_history_long | NO      |
| events_waits_current             | YES     |
| events_waits_history             | YES     |
| events_waits_history_long        | YES     |
| global_instrumentation           | YES     |
| thread_instrumentation           | YES     |
| statements_digest                | YES     |
+----------------------------------+---------+
15 rows in set (0.00 sec)</pre></li><li class="listitem"><p>
          Once instruments and consumers are enabled, run the workload
          that you want to monitor. In this example, the
          <a class="link" href="programs.html#mysqlslap" title="4.5.8 mysqlslap — Load Emulation Client"><span class="command"><strong>mysqlslap</strong></span></a> load emulation client is used to
          simulate a workload.
        </p><pre class="programlisting">shell&gt; ./mysqlslap --auto-generate-sql --concurrency=100 --iterations=10 --number-of-queries=1000 
--number-char-cols=6 --number-int-cols=6;</pre></li><li class="listitem"><p>
          Query the wait event data. In this example, wait event data is
          queried from the
          <a class="link" href="performance-schema.html#wait-summary-tables" title="22.9.14.1 Event Wait Summary Tables"><code class="literal">events_waits_summary_global_by_event_name</code></a>
          table which aggregates data found in the
          <a class="link" href="performance-schema.html#events-waits-current-table" title="22.9.4.1 The events_waits_current Table"><code class="literal">events_waits_current</code></a>,
          <a class="link" href="performance-schema.html#events-waits-history-table" title="22.9.4.2 The events_waits_history Table"><code class="literal">events_waits_history</code></a>, and
          <a class="link" href="performance-schema.html#events-waits-history-long-table" title="22.9.4.3 The events_waits_history_long Table"><code class="literal">events_waits_history_long</code></a> tables.
          Data is summarized by event name
          (<code class="literal">EVENT_NAME</code>), which is the name of the
          instrument that produced the event. Summarized data includes:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              <code class="literal">COUNT_STAR</code>
            </p><p>
              The number of summarized wait events.
            </p></li><li class="listitem"><p>
              <code class="literal">SUM_TIMER_WAIT</code>
            </p><p>
              The total wait time of the summarized timed wait events.
            </p></li><li class="listitem"><p>
              <code class="literal">MIN_TIMER_WAIT</code>
            </p><p>
              The minimum wait time of the summarized timed wait events.
            </p></li><li class="listitem"><p>
              <code class="literal">AVG_TIMER_WAIT</code>
            </p><p>
              The average wait time of the summarized timed wait events.
            </p></li><li class="listitem"><p>
              <code class="literal">MAX_TIMER_WAIT</code>
            </p><p>
              The maximum wait time of the summarized timed wait events.
</p></li></ul>
</div>
<p>
          The following query returns the instrument name
          (<code class="literal">EVENT_NAME</code>), the number of wait events
          (<code class="literal">COUNT_STAR</code>), and the total wait time for
          the events for that instrument
          (<code class="literal">SUM_TIMER_WAIT</code>). Because waits are timed
          in picoseconds (trillionths of a second) by default, wait
          times are divided by 1000000000 to show wait times in
          milliseconds. Data is presented in descending order, by the
          number of summarized wait events
          (<code class="literal">COUNT_STAR</code>). You can adjust the
          <code class="literal">ORDER BY</code> clause to order the data by total
          wait time.
        </p><pre class="programlisting">mysql&gt; SELECT EVENT_NAME, COUNT_STAR, SUM_TIMER_WAIT/1000000000 SUM_TIMER_WAIT_MS 
FROM performance_schema.events_waits_summary_global_by_event_name 
WHERE SUM_TIMER_WAIT &gt; 0 AND EVENT_NAME LIKE 'wait/synch/mutex/innodb/%' 
ORDER BY COUNT_STAR DESC;
+--------------------------------------------------+------------+-------------------+
| EVENT_NAME                                       | COUNT_STAR | SUM_TIMER_WAIT_MS |
+--------------------------------------------------+------------+-------------------+
| wait/synch/mutex/innodb/os_mutex                 |      78831 |           10.3283 |
| wait/synch/mutex/innodb/log_sys_mutex            |      41488 |         6510.3233 |
| wait/synch/mutex/innodb/trx_sys_mutex            |      29770 |         1107.9687 |
| wait/synch/mutex/innodb/lock_mutex               |      24212 |          104.0724 |
| wait/synch/mutex/innodb/trx_mutex                |      22756 |            1.9421 |
| wait/synch/mutex/innodb/rseg_mutex               |      20333 |            3.6220 |
| wait/synch/mutex/innodb/dict_sys_mutex           |      13422 |            2.2284 |
| wait/synch/mutex/innodb/mutex_list_mutex         |      12694 |          344.1164 |
| wait/synch/mutex/innodb/fil_system_mutex         |       9208 |            0.9542 |
| wait/synch/mutex/innodb/rw_lock_list_mutex       |       8304 |            0.1794 |
| wait/synch/mutex/innodb/trx_undo_mutex           |       6190 |            0.6801 |
| wait/synch/mutex/innodb/buf_pool_mutex           |       2869 |           29.4623 |
| wait/synch/mutex/innodb/innobase_share_mutex     |       2005 |            0.1349 |
| wait/synch/mutex/innodb/flush_list_mutex         |       1274 |            0.1300 |
| wait/synch/mutex/innodb/file_format_max_mutex    |       1016 |            0.0469 |
| wait/synch/mutex/innodb/purge_sys_bh_mutex       |       1004 |            0.0326 |
| wait/synch/mutex/innodb/buf_dblwr_mutex          |        640 |            0.0437 |
| wait/synch/mutex/innodb/log_flush_order_mutex    |        437 |            0.0510 |
| wait/synch/mutex/innodb/recv_sys_mutex           |        394 |            0.0202 |
| wait/synch/mutex/innodb/srv_sys_mutex            |        169 |            0.5259 |
| wait/synch/mutex/innodb/lock_wait_mutex          |        154 |            0.1172 |
| wait/synch/mutex/innodb/ibuf_mutex               |          9 |            0.0027 |
| wait/synch/mutex/innodb/srv_innodb_monitor_mutex |          2 |            0.0009 |
| wait/synch/mutex/innodb/ut_list_mutex            |          1 |            0.0001 |
| wait/synch/mutex/innodb/recv_writer_mutex        |          1 |            0.0005 |
+--------------------------------------------------+------------+-------------------+
25 rows in set (0.01 sec)</pre>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
            The preceding result set includes wait event data produced
            during the startup process. To exclude this data, you can
            truncate the
            <a class="link" href="performance-schema.html#wait-summary-tables" title="22.9.14.1 Event Wait Summary Tables"><code class="literal">events_waits_summary_global_by_event_name</code></a>
            table immediately after startup and before running your
            workload. However, the truncate operation itself may produce
            a negligible amount wait event data.
</p><pre class="programlisting">mysql&gt; TRUNCATE performance_schema.events_waits_summary_global_by_event_name;</pre>
</div>
</li></ol>
</div>

</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="innodb-monitors"></a>14.14 InnoDB Monitors</h2>

</div>

</div>

</div>
<div class="toc">
<dl class="toc"><dt><span class="section"><a href="innodb-storage-engine.html#innodb-monitor-types">14.14.1 InnoDB Monitor Types</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-enabling-monitors">14.14.2 Enabling InnoDB Monitors</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-standard-monitor">14.14.3 InnoDB Standard Monitor and Lock Monitor Output</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-tablespace-monitor">14.14.4 InnoDB Tablespace Monitor Output</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-table-monitor">14.14.5 InnoDB Table Monitor Output</a></span></dt></dl>
</div>
<a class="indexterm" name="idm140644101923536"></a><a class="indexterm" name="idm140644101922048"></a><a class="indexterm" name="idm140644101920560"></a><a class="indexterm" name="idm140644101919072"></a><a class="indexterm" name="idm140644101917584"></a><a class="indexterm" name="idm140644101916096"></a><p>
    <code class="literal">InnoDB</code> monitors provide information about the
    <code class="literal">InnoDB</code> internal state. This information is useful
    for performance tuning.
</p>
<div class="section">

<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="innodb-monitor-types"></a>14.14.1 InnoDB Monitor Types</h3>
</div>
</div>
</div>
<p>
      There are four types of <code class="literal">InnoDB</code> monitors:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          The standard <code class="literal">InnoDB</code> Monitor displays the
          following types of information:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
              Table and record locks held by each active transaction.
            </p></li><li class="listitem"><p>
              Lock waits of a transaction.
            </p></li><li class="listitem"><p>
              Semaphore waits of threads.
            </p></li><li class="listitem"><p>
              Pending file I/O requests.
            </p></li><li class="listitem"><p>
              Buffer pool statistics.
            </p></li><li class="listitem"><p>
              Purge and change buffer merge activity of the main
              <code class="literal">InnoDB</code> thread.
</p></li></ul>
</div>
</li><li class="listitem"><p>
          The <code class="literal">InnoDB</code> Lock Monitor prints additional
          lock information as part of the standard
          <code class="literal">InnoDB</code> Monitor output.
        </p></li><li class="listitem"><p>
          The <code class="literal">InnoDB</code> Tablespace Monitor prints a list
          of file segments in the shared tablespace and validates the
          tablespace allocation data structures.
        </p></li><li class="listitem"><p>
          The <code class="literal">InnoDB</code> Table Monitor prints the
          contents of the <code class="literal">InnoDB</code> internal data
          dictionary.
</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
            The Tablespace Monitor and Table Monitor were deprecated in
            MySQL 5.6.3 and have been removed in MySQL 5.7.4. For the
            Tablespace Monitor, equivalent functionality will be
            introduced before the GA release of MySQL 5.7. For the Table
            Monitor, equivalent information can be obtained from
            <code class="literal">InnoDB</code>
            <code class="literal">INFORMATION_SCHEMA</code> tables.
</p>
</div>
</li></ul>
</div>
<p>
      For additional information about <code class="literal">InnoDB</code>
      monitors, see:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          Mark Leith:
          <a class="ulink" href="http://www.markleith.co.uk/?p=25" target="_top">InnoDB Table and
          Tablespace Monitors</a>
</p></li></ul>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="innodb-enabling-monitors"></a>14.14.2 Enabling InnoDB Monitors</h3>

</div>

</div>

</div>
<p>
      When you enable <code class="literal">InnoDB</code> monitors for periodic
      output, <code class="literal">InnoDB</code> writes their output to the
      <a class="link" href="programs.html#mysqld" title="4.3.1 mysqld — The MySQL Server"><span class="command"><strong>mysqld</strong></span></a> server standard error output
      (<code class="literal">stderr</code>). In this case, no output is sent to
      clients. When switched on, <code class="literal">InnoDB</code> monitors
      print data about every 15 seconds. Server output usually is
      directed to the error log (see <a class="xref" href="server-administration.html#error-log" title="5.2.2 The Error Log">Section 5.2.2, “The Error Log”</a>). This
      data is useful in performance tuning. On Windows, start the server
      from a command prompt in a console window with the
      <a class="link" href="server-administration.html#option_mysqld_console"><code class="option">--console</code></a> option if you want to
      direct the output to the window rather than to the error log.
    </p><p>
      <code class="literal">InnoDB</code> sends diagnostic output to
      <code class="literal">stderr</code> or to files rather than to
      <code class="literal">stdout</code> or fixed-size memory buffers, to avoid
      potential buffer overflows. As a side effect, the output of
      <a class="link" href="sql-syntax.html#show-engine" title="13.7.5.15 SHOW ENGINE Syntax"><code class="literal">SHOW ENGINE INNODB
      STATUS</code></a> is written to a status file in the MySQL data
      directory every fifteen seconds. The name of the file is
      <code class="filename">innodb_status.<em class="replaceable"><code>pid</code></em></code>,
      where <em class="replaceable"><code>pid</code></em> is the server process ID.
      <code class="literal">InnoDB</code> removes the file for a normal shutdown.
      If abnormal shutdowns have occurred, instances of these status
      files may be present and must be removed manually. Before removing
      them, you might want to examine them to see whether they contain
      useful information about the cause of abnormal shutdowns. The
      <code class="filename">innodb_status.<em class="replaceable"><code>pid</code></em></code>
      file is created only if the configuration option
      <a class="link" href="innodb-storage-engine.html#option_mysqld_innodb-status-file"><code class="option">innodb-status-file=1</code></a> is set.
    </p><p>
      <code class="literal">InnoDB</code> monitors should be enabled only when you
      actually want to see monitor information because output generation
      does result in some performance decrement. Also, if you enable
      monitor output, your error log may become quite large if you
      forget to disable it later.
</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
        To assist with troubleshooting, <code class="literal">InnoDB</code>
        temporarily enables standard <code class="literal">InnoDB</code> Monitor
        output under certain conditions. For more information, see
        <a class="xref" href="innodb-storage-engine.html#innodb-troubleshooting" title="14.18 InnoDB Troubleshooting">Section 14.18, “InnoDB Troubleshooting”</a>.
</p>
</div>
<p>
      Each monitor begins with a header containing a timestamp and the
      monitor name. For example:
    </p><pre class="programlisting">
=====================================
2014-10-16 18:37:29 0x7fc2a95c1700 INNODB MONITOR OUTPUT
=====================================
</pre><p>
      The header for the standard <code class="literal">InnoDB</code> Monitor
      (<code class="literal">INNODB MONITOR OUTPUT</code>) is also used for the
      Lock Monitor because the latter produces the same output with the
      addition of extra lock information.
    </p><p>
      Enabling an <code class="literal">InnoDB</code> monitor for periodic output
      involves using a <code class="literal">CREATE TABLE</code> statement to
      create a specially named <code class="literal">InnoDB</code> table that is
      associated with the monitor. For example, to enable the standard
      <code class="literal">InnoDB</code> Monitor, you would create an
      <code class="literal">InnoDB</code> table named
      <code class="literal">innodb_monitor</code>.
    </p><p>
      Using <a class="link" href="sql-syntax.html#create-table" title="13.1.18 CREATE TABLE Syntax"><code class="literal">CREATE TABLE</code></a> syntax is just a
      way to pass a command to the <code class="literal">InnoDB</code> engine
      through MySQL's SQL parser. The only things that matter are the
      table name and that it be an <code class="literal">InnoDB</code> table. The
      structure of the table is not relevant. If you shut down the
      server, the monitor does not restart automatically when you
      restart the server. Drop the monitor table and issue a new
      <a class="link" href="sql-syntax.html#create-table" title="13.1.18 CREATE TABLE Syntax"><code class="literal">CREATE TABLE</code></a> statement to start the
      monitor.
</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
        The <a class="link" href="sql-syntax.html#create-table" title="13.1.18 CREATE TABLE Syntax"><code class="literal">CREATE TABLE</code></a> method of
        enabling <code class="literal">InnoDB</code> monitors was removed in MySQL
        5.7.4. Use the
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_status_output"><code class="literal">innodb_status_output</code></a> and
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_status_output_locks"><code class="literal">innodb_status_output_locks</code></a>
        system variables to enable the standard
        <code class="literal">InnoDB</code> Monitor and <code class="literal">InnoDB</code>
        Lock Monitor.
</p>
</div>
<p>
      The <a class="link" href="security.html#priv_process"><code class="literal">PROCESS</code></a> privilege is required
      to enable and disable <code class="literal">InnoDB</code> Monitors.
</p>
<h4><a name="idm140644101847312"></a>Enabling the Standard InnoDB Monitor</h4>
<p>
      Prior to MySQL 5.7.4, enable the standard
      <code class="literal">InnoDB</code> Monitor for periodic output by creating
      the <code class="literal">innodb_monitor</code> table:
    </p><pre class="programlisting">
CREATE TABLE innodb_monitor (a INT) ENGINE=INNODB;
</pre><p>
      To disable the standard <code class="literal">InnoDB</code> Monitor, drop
      the table:
    </p><pre class="programlisting">
DROP TABLE innodb_monitor;
</pre><p>
      As of MySQL 5.7.4, enable the standard <code class="literal">InnoDB</code>
      Monitor by setting the
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_status_output"><code class="literal">innodb_status_output</code></a> system
      variable to <code class="literal">ON</code>.
    </p><pre class="programlisting">
set GLOBAL innodb_status_output=ON;
</pre><p>
      To disable the standard <code class="literal">InnoDB</code> Monitor, set
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_status_output"><code class="literal">innodb_status_output</code></a> to
      <code class="literal">OFF</code>.
    </p><p>
      When you shut down the server, the
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_status_output"><code class="literal">innodb_status_output</code></a> variable is
      set to the default <code class="literal">OFF</code> value.
</p>
<h4><a name="idm140644101832704"></a>Obtaining Standard InnoDB Monitor Output On Demand</h4>
<p>
      As an alternative to enabling the standard
      <code class="literal">InnoDB</code> Monitor for periodic output, you can
      obtain standard <code class="literal">InnoDB</code> Monitor output on demand
      using the <a class="link" href="sql-syntax.html#show-engine" title="13.7.5.15 SHOW ENGINE Syntax"><code class="literal">SHOW ENGINE
      INNODB STATUS</code></a> SQL statement, which fetches the output to
      your client program. If you are using the <a class="link" href="programs.html#mysql" title="4.5.1 mysql — The MySQL Command-Line Tool"><span class="command"><strong>mysql</strong></span></a>
      interactive client, the output is more readable if you replace the
      usual semicolon statement terminator with <code class="literal">\G</code>:
    </p><pre class="programlisting">
mysql&gt; <strong class="userinput"><code>SHOW ENGINE INNODB STATUS\G</code></strong>
</pre><p>
      <a class="link" href="sql-syntax.html#show-engine" title="13.7.5.15 SHOW ENGINE Syntax"><code class="literal">SHOW ENGINE INNODB
      STATUS</code></a> output also includes <code class="literal">InnoDB</code>
      Lock Monitor data if the <code class="literal">InnoDB</code> Lock Monitor is
      enabled.
</p>
<h4><a name="idm140644101822112"></a>Enabling the InnoDB Lock Monitor</h4>
<p>
      Prior to MySQL 5.7.4, enable the <code class="literal">InnoDB</code> Lock
      Monitor for periodic output by creating the
      <code class="literal">innodb_lock_monitor</code> table:
    </p><pre class="programlisting">
CREATE TABLE innodb_lock_monitor (a INT) ENGINE=INNODB;
</pre><p>
      To disable the <code class="literal">InnoDB</code> Lock Monitor, drop the
      table:
    </p><pre class="programlisting">
DROP TABLE innodb_lock_monitor;
</pre><p>
      <code class="literal">InnoDB</code>Lock Monitor data is printed with the
      standard <code class="literal">InnoDB</code> Monitor output. Both the
      <code class="literal">InnoDB</code> standard Monitor and
      <code class="literal">InnoDB</code> Lock Monitor must be enabled to have
      <code class="literal">InnoDB</code>Lock Monitor data printed periodically.
    </p><p>
      As of MySQL 5.7.4, you can also enable the
      <code class="literal">InnoDB</code> Lock Monitor by setting the
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_status_output_locks"><code class="literal">innodb_status_output_locks</code></a> system
      variable to <code class="literal">ON</code>. As with the
      <a class="link" href="sql-syntax.html#create-table" title="13.1.18 CREATE TABLE Syntax"><code class="literal">CREATE TABLE</code></a> method for enabling
      <code class="literal">InnoDB</code> Monitors, both the
      <code class="literal">InnoDB</code> standard Monitor and
      <code class="literal">InnoDB</code> Lock Monitor must be enabled to have
      <code class="literal">InnoDB</code>Lock Monitor data printed periodically:
    </p><pre class="programlisting">
set GLOBAL innodb_status_output=ON;
set GLOBAL innodb_status_output_locks=ON;
</pre><p>
      When you shut down the server, the
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_status_output"><code class="literal">innodb_status_output</code></a> and
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_status_output_locks"><code class="literal">innodb_status_output_locks</code></a>
      variables are set to the default <code class="literal">OFF</code> value.
    </p><p>
      To disable the <code class="literal">InnoDB</code> Lock Monitor, set
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_status_output_locks"><code class="literal">innodb_status_output_locks</code></a> to
      <code class="literal">OFF</code>. Set
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_status_output"><code class="literal">innodb_status_output</code></a> to OFF to
      also disable the standard <code class="literal">InnoDB</code> Monitor.
</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
        To enable the <code class="literal">InnoDB</code> Lock Monitor for
        <a class="link" href="sql-syntax.html#show-engine" title="13.7.5.15 SHOW ENGINE Syntax"><code class="literal">SHOW ENGINE INNODB
        STATUS</code></a> output, you are only required to enable
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_status_output_locks"><code class="literal">innodb_status_output_locks</code></a>.
</p>
</div>
<h4><a name="idm140644101791632"></a>Enabling the InnoDB Tablespace Monitor</h4>
<p>
      To enable the <code class="literal">InnoDB</code> Tablespace Monitor for
      periodic output, create the
      <code class="literal">innodb_tablespace_monitor</code> table:
    </p><pre class="programlisting">
CREATE TABLE innodb_tablespace_monitor (a INT) ENGINE=INNODB;
</pre><p>
      To disable the standard <code class="literal">InnoDB</code> Tablespace
      Monitor, drop the table:
    </p><pre class="programlisting">
DROP TABLE innodb_tablespace_monitor;
</pre>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
        The Tablespace Monitor was removed in MySQL 5.7.4. InnoDB
        tablespace metadata can be obtained from
        <code class="literal">INFORMATION_SCHEMA</code> tables.
</p>
</div>
<h4><a name="idm140644101784736"></a>Enabling the InnoDB Table Monitor</h4>
<p>
      To enable the <code class="literal">InnoDB</code> Table Monitor for periodic
      output, create the <code class="literal">innodb_table_monitor</code> table:
    </p><pre class="programlisting">
CREATE TABLE innodb_table_monitor (a INT) ENGINE=INNODB;
</pre><p>
      To disable the <code class="literal">InnoDB</code> Table Monitor, drop the
      table:
    </p><pre class="programlisting">
DROP TABLE innodb_table_monitor;
</pre>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
        The Tablespace Monitor was removed in MySQL 5.7.4. InnoDB
        tablespace metadata can be obtained from
        <code class="literal">INFORMATION_SCHEMA</code> tables.
</p>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="innodb-standard-monitor"></a>14.14.3 InnoDB Standard Monitor and Lock Monitor Output</h3>

</div>

</div>

</div>
<p>
      The Lock Monitor is the same as the standard Monitor except that
      it includes additional lock information. Enabling either monitor
      for periodic output turns on the same output stream, but the
      stream includes extra information if the Lock Monitor is enabled.
      For example, if you enable the standard <code class="literal">InnoDB</code>
      Monitor and <code class="literal">InnoDB</code> Lock Monitor, that turns on
      a single output stream. The stream includes extra lock information
      until you disable the Lock Monitor.
    </p><p>
      Example InnoDB Monitor output (as of MySQL 5.7.6):
    </p><pre class="programlisting">
mysql&gt; <strong class="userinput"><code>SHOW ENGINE INNODB STATUS\G</code></strong>
*************************** 1. row ***************************
  Type: InnoDB
  Name: 
Status: 
=====================================
2014-10-16 18:37:29 0x7fc2a95c1700 INNODB MONITOR OUTPUT
=====================================
Per second averages calculated from the last 20 seconds
-----------------
BACKGROUND THREAD
-----------------
srv_master_thread loops: 38 srv_active, 0 srv_shutdown, 252 srv_idle
srv_master_thread log flush and writes: 290
----------
SEMAPHORES
----------
OS WAIT ARRAY INFO: reservation count 119
OS WAIT ARRAY INFO: signal count 103
Mutex spin waits 0, rounds 0, OS waits 0
RW-shared spins 38, rounds 76, OS waits 38
RW-excl spins 2, rounds 9383715, OS waits 3
RW-sx spins 0, rounds 0, OS waits 0
Spin rounds per wait: 0.00 mutex, 2.00 RW-shared, 4691857.50 RW-excl, 
0.00 RW-sx
------------------------
LATEST FOREIGN KEY ERROR
------------------------
2014-10-16 18:35:18 0x7fc2a95c1700 Transaction:
TRANSACTION 1814, ACTIVE 0 sec inserting
mysql tables in use 1, locked 1
4 lock struct(s), heap size 1136, 3 row lock(s), undo log entries 3
MySQL thread id 2, OS thread handle 140474041767680, query id 74 localhost 
root update
INSERT INTO child VALUES
    (NULL, 1)
    , (NULL, 2)
    , (NULL, 3)
    , (NULL, 4)
    , (NULL, 5)
    , (NULL, 6)
Foreign key constraint fails for table `mysql`.`child`:
,
  CONSTRAINT `child_ibfk_1` FOREIGN KEY (`parent_id`) REFERENCES `parent`
  (`id`) ON DELETE CASCADE ON UPDATE CASCADE
Trying to add in child table, in index par_ind tuple:
DATA TUPLE: 2 fields;
 0: len 4; hex 80000003; asc     ;;
 1: len 4; hex 80000003; asc     ;;

But in parent table `mysql`.`parent`, in index PRIMARY,
the closest match we can find is record:
PHYSICAL RECORD: n_fields 3; compact format; info bits 0
 0: len 4; hex 80000004; asc     ;;
 1: len 6; hex 00000000070a; asc       ;;
 2: len 7; hex aa0000011d0134; asc       4;;

------------------------
LATEST DETECTED DEADLOCK
------------------------
2014-10-16 18:36:30 0x7fc2a95c1700
*** (1) TRANSACTION:
TRANSACTION 1824, ACTIVE 9 sec starting index read
mysql tables in use 1, locked 1
LOCK WAIT 2 lock struct(s), heap size 1136, 1 row lock(s)
MySQL thread id 3, OS thread handle 140474041501440, query id 80 localhost 
root updating
DELETE FROM t WHERE i = 1
*** (1) WAITING FOR THIS LOCK TO BE GRANTED:
RECORD LOCKS space id 35 page no 3 n bits 72 index GEN_CLUST_INDEX of table
`mysql`.`t` trx id 1824 lock_mode X waiting
Record lock, heap no 2 PHYSICAL RECORD: n_fields 4; compact format; info 
bits 0
 0: len 6; hex 000000000200; asc       ;;
 1: len 6; hex 00000000071f; asc       ;;
 2: len 7; hex b80000012b0110; asc     +  ;;
 3: len 4; hex 80000001; asc     ;;

*** (2) TRANSACTION:
TRANSACTION 1825, ACTIVE 29 sec starting index read
mysql tables in use 1, locked 1
4 lock struct(s), heap size 1136, 3 row lock(s)
MySQL thread id 2, OS thread handle 140474041767680, query id 81 localhost
root updating
DELETE FROM t WHERE i = 1
*** (2) HOLDS THE LOCK(S):
RECORD LOCKS space id 35 page no 3 n bits 72 index GEN_CLUST_INDEX of table
`mysql`.`t` trx id 1825 lock mode S
Record lock, heap no 1 PHYSICAL RECORD: n_fields 1; compact format; info 
bits 0
 0: len 8; hex 73757072656d756d; asc supremum;;

Record lock, heap no 2 PHYSICAL RECORD: n_fields 4; compact format; info bits 0
 0: len 6; hex 000000000200; asc       ;;
 1: len 6; hex 00000000071f; asc       ;;
 2: len 7; hex b80000012b0110; asc     +  ;;
 3: len 4; hex 80000001; asc     ;;

*** (2) WAITING FOR THIS LOCK TO BE GRANTED:
RECORD LOCKS space id 35 page no 3 n bits 72 index GEN_CLUST_INDEX of table 
`mysql`.`t` trx id 1825 lock_mode X waiting
Record lock, heap no 2 PHYSICAL RECORD: n_fields 4; compact format; info 
bits 0
 0: len 6; hex 000000000200; asc       ;;
 1: len 6; hex 00000000071f; asc       ;;
 2: len 7; hex b80000012b0110; asc     +  ;;
 3: len 4; hex 80000001; asc     ;;

*** WE ROLL BACK TRANSACTION (1)
------------
TRANSACTIONS
------------
Trx id counter 1950
Purge done for trx's n:o &lt; 1933 undo n:o &lt; 0 state: running but idle
History list length 23
LIST OF TRANSACTIONS FOR EACH SESSION:
---TRANSACTION 421949033065200, not started
0 lock struct(s), heap size 1136, 0 row lock(s)
---TRANSACTION 421949033064280, not started
0 lock struct(s), heap size 1136, 0 row lock(s)
---TRANSACTION 1949, ACTIVE 0 sec inserting
mysql tables in use 1, locked 1
8 lock struct(s), heap size 1136, 1850 row lock(s), undo log entries 17415
MySQL thread id 4, OS thread handle 140474041235200, query id 176 localhost 
root update
INSERT INTO `salaries` VALUES (55723,39746,'1997-02-25','1998-02-25'),
(55723,40758,'1998-02-25','1999-02-25'),(55723,44559,'1999-02-25','2000-02-25'),
(55723,44081,'2000-02-25','2001-02-24'),(55723,44112,'2001-02-24','2001-08-16'),
(55724,46461,'1996-12-06','1997-12-06'),(55724,48916,'1997-12-06','1998-12-06'),
(55724,51269,'1998-12-06','1999-12-06'),(55724,51932,'1999-12-06','2000-12-05'),
(55724,52617,'2000-12-05','2001-12-05'),(55724,56658,'2001-12-05','9999-01-01'),
(55725,40000,'1993-01-30','1994-01-30'),(55725,41472,'1994-01-30','1995-01-30'),
(55725,45293,'1995-01-30','1996-01-30'),(55725,473
--------
FILE I/O
--------
I/O thread 0 state: waiting for completed aio requests (insert buffer thread)
I/O thread 1 state: waiting for completed aio requests (log thread)
I/O thread 2 state: waiting for completed aio requests (read thread)
I/O thread 3 state: waiting for completed aio requests (read thread)
I/O thread 4 state: waiting for completed aio requests (read thread)
I/O thread 5 state: waiting for completed aio requests (read thread)
I/O thread 6 state: waiting for completed aio requests (write thread)
I/O thread 7 state: waiting for completed aio requests (write thread)
I/O thread 8 state: waiting for completed aio requests (write thread)
I/O thread 9 state: waiting for completed aio requests (write thread)
Pending normal aio reads: 0 [0, 0, 0, 0] , aio writes: 0 [0, 0, 0, 0] ,
 ibuf aio reads: 0, log i/o's: 0, sync i/o's: 0
Pending flushes (fsync) log: 0; buffer pool: 0
224 OS file reads, 5770 OS file writes, 803 OS fsyncs
0.00 reads/s, 0 avg bytes/read, 264.84 writes/s, 23.05 fsyncs/s
-------------------------------------
INSERT BUFFER AND ADAPTIVE HASH INDEX
-------------------------------------
Ibuf: size 1, free list len 0, seg size 2, 0 merges
merged operations:
 insert 0, delete mark 0, delete 0
discarded operations:
 insert 0, delete mark 0, delete 0
Hash table size 4425293, node heap has 444 buffer(s)
68015.25 hash searches/s, 106259.24 non-hash searches/s
---
LOG
---
Log sequence number 165913808
Log flushed up to   164814979
Pages flushed up to 141544038
Last checkpoint at  130503656
0 pending log flushes, 0 pending chkp writes
258 log i/o's done, 6.65 log i/o's/second
----------------------
BUFFER POOL AND MEMORY
----------------------
Total large memory allocated 2198863872
Dictionary memory allocated 776332
Buffer pool size   131072
Free buffers       124908
Database pages     5720
Old database pages 2071
Modified db pages  910
Pending reads 0
Pending writes: LRU 0, flush list 0, single page 0
Pages made young 4, not young 0
0.10 youngs/s, 0.00 non-youngs/s
Pages read 197, created 5523, written 5060
0.00 reads/s, 190.89 creates/s, 244.94 writes/s
Buffer pool hit rate 1000 / 1000, young-making rate 0 / 1000 not 
0 / 1000
Pages read ahead 0.00/s, evicted without access 0.00/s, Random read 
ahead 0.00/s
LRU len: 5720, unzip_LRU len: 0
I/O sum[0]:cur[0], unzip sum[0]:cur[0]
----------------------
INDIVIDUAL BUFFER POOL INFO
----------------------
---BUFFER POOL 0
Buffer pool size   65536
Free buffers       62412
Database pages     2899
Old database pages 1050
Modified db pages  449
Pending reads 0
Pending writes: LRU 0, flush list 0, single page 0
Pages made young 3, not young 0
0.05 youngs/s, 0.00 non-youngs/s
Pages read 107, created 2792, written 2586
0.00 reads/s, 92.65 creates/s, 122.89 writes/s
Buffer pool hit rate 1000 / 1000, young-making rate 0 / 1000 not 0 / 1000
Pages read ahead 0.00/s, evicted without access 0.00/s, Random read ahead 
0.00/s
LRU len: 2899, unzip_LRU len: 0
I/O sum[0]:cur[0], unzip sum[0]:cur[0]
---BUFFER POOL 1
Buffer pool size   65536
Free buffers       62496
Database pages     2821
Old database pages 1021
Modified db pages  461
Pending reads 0
Pending writes: LRU 0, flush list 0, single page 0
Pages made young 1, not young 0
0.05 youngs/s, 0.00 non-youngs/s
Pages read 90, created 2731, written 2474
0.00 reads/s, 98.25 creates/s, 122.04 writes/s
Buffer pool hit rate 1000 / 1000, young-making rate 0 / 1000 not 0 / 1000
Pages read ahead 0.00/s, evicted without access 0.00/s, Random read ahead 
0.00/s
LRU len: 2821, unzip_LRU len: 0
I/O sum[0]:cur[0], unzip sum[0]:cur[0]
--------------
ROW OPERATIONS
--------------
0 queries inside InnoDB, 0 queries in queue
0 read views open inside InnoDB
Process ID=35909, Main thread ID=140471692396288, state: sleeping
Number of rows inserted 1526363, updated 0, deleted 3, read 11
52671.72 inserts/s, 0.00 updates/s, 0.00 deletes/s, 0.00 reads/s
----------------------------
END OF INNODB MONITOR OUTPUT
============================
</pre><p>
      Standard <code class="literal">InnoDB</code> Monitor output is limited to
      1MB when produced using the
      <a class="link" href="sql-syntax.html#show-engine" title="13.7.5.15 SHOW ENGINE Syntax"><code class="literal">SHOW ENGINE INNODB
      STATUS</code></a> statement. This limit does not apply to output
      written to the server's error output.
    </p><p>
      Some notes on the output sections:
    </p><p>
      <span class="bold"><strong><code class="literal">Status</code></strong></span>
    </p><p>
      This section shows the timestamp, the monitor name, and the number
      of seconds that per-second averages are based on. The number of
      seconds is the elapsed time between the current time and the last
      time <code class="literal">InnoDB</code> Monitor output was printed.
    </p><p>
      <span class="bold"><strong><code class="literal">BACKGROUND
      THREAD</code></strong></span>
    </p><p>
      The <code class="literal">srv_master_thread</code> lines shows work done by
      the main background thread.
    </p><p>
      <span class="bold"><strong><code class="literal">SEMAPHORES</code></strong></span>
    </p><p>
      This section reports threads waiting for a semaphore and
      statistics on how many times threads have needed a spin or a wait
      on a mutex or a rw-lock semaphore. A large number of threads
      waiting for semaphores may be a result of disk I/O, or contention
      problems inside <code class="literal">InnoDB</code>. Contention can be due
      to heavy parallelism of queries or problems in operating system
      thread scheduling. Setting the
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_thread_concurrency"><code class="literal">innodb_thread_concurrency</code></a> system
      variable smaller than the default value might help in such
      situations. The <code class="literal">Spin rounds per wait</code> line shows
      the number of spinlock rounds per OS wait for a mutex.
    </p><p>
      The line that reports mutex spin waits, rounds, and OS waits
      information was removed from
      <a class="link" href="sql-syntax.html#show-engine" title="13.7.5.15 SHOW ENGINE Syntax"><code class="literal">SHOW ENGINE INNODB
      STATUS</code></a> output in MySQL 5.7.8. Mutex metrics are reported
      by <a class="link" href="sql-syntax.html#show-engine" title="13.7.5.15 SHOW ENGINE Syntax"><code class="literal">SHOW ENGINE INNODB
      MUTEX</code></a>.
    </p><p>
      <span class="bold"><strong><code class="literal">LATEST FOREIGN KEY
      ERROR</code></strong></span>
    </p><p>
      This section provides information about the most recent foreign
      key constraint error. It is not present if no such error has
      occurred. The contents include the statement that failed as well
      as information about the constraint that failed and the referenced
      and referencing tables.
    </p><p>
      <span class="bold"><strong><code class="literal">LATEST DETECTED
      DEADLOCK</code></strong></span>
    </p><p>
      This section provides information about the most recent deadlock.
      It is not present if no deadlock has occurred. The contents show
      which transactions are involved, the statement each was attempting
      to execute, the locks they have and need, and which transaction
      <code class="literal">InnoDB</code> decided to roll back to break the
      deadlock. The lock modes reported in this section are explained in
      <a class="xref" href="innodb-storage-engine.html#innodb-lock-modes" title="14.2.2.1 InnoDB Lock Modes">Section 14.2.2.1, “InnoDB Lock Modes”</a>.
    </p><p>
      <span class="bold"><strong><code class="literal">TRANSACTIONS</code></strong></span>
    </p><p>
      If this section reports lock waits, your applications might have
      lock contention. The output can also help to trace the reasons for
      transaction deadlocks.
    </p><p>
      <span class="bold"><strong><code class="literal">FILE I/O</code></strong></span>
    </p><p>
      This section provides information about threads that
      <code class="literal">InnoDB</code> uses to perform various types of I/O.
      The first few of these are dedicated to general
      <code class="literal">InnoDB</code> processing. The contents also display
      information for pending I/O operations and statistics for I/O
      performance.
    </p><p>
      The number of these threads are controlled by the
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_read_io_threads"><code class="literal">innodb_read_io_threads</code></a> and
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_write_io_threads"><code class="literal">innodb_write_io_threads</code></a>
      parameters. See <a class="xref" href="innodb-storage-engine.html#innodb-parameters" title="14.11 InnoDB Startup Options and System Variables">Section 14.11, “InnoDB Startup Options and System Variables”</a>.
    </p><p>
      <span class="bold"><strong><code class="literal">INSERT BUFFER AND ADAPTIVE HASH
      INDEX</code></strong></span>
    </p><p>
      This section shows the status of the <code class="literal">InnoDB</code>
      insert buffer (also referred to as the
      <a class="link" href="glossary.html#glos_change_buffer" title="change buffer">change buffer</a>) and the
      adaptive hash index.
    </p><p>
      Change buffer status information includes:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          <code class="literal">size</code>: The number of pages used within the
          change buffer. Change buffer size is equal to <code class="literal">seg
          size - (1 + free list len)</code>. The <code class="literal">1
          +</code> value represents the change buffer header page.
        </p></li><li class="listitem"><p>
          <code class="literal">free list len</code>: The number of pages free
          within the change buffer.
        </p></li><li class="listitem"><p>
          <code class="literal">seg size</code>: The size of the change buffer, in
          pages.
        </p></li><li class="listitem"><p>
          <code class="literal">merges</code>: The total number of change buffer
          merges.
        </p></li><li class="listitem"><p>
          <code class="literal">merged operations - insert</code>: The number of
          inserted records merged.
        </p></li><li class="listitem"><p>
          <code class="literal">merged operations - delete mark</code>: The number
          of deleted records merged.
        </p></li><li class="listitem"><p>
          <code class="literal">merged operations - delete</code>: The number of
          purge records merged.
        </p></li><li class="listitem"><p>
          <code class="literal">discarded operations - insert</code>: The number
          of insert merge operations discarded.
        </p></li><li class="listitem"><p>
          <code class="literal">discarded operations - delete mark</code>: The
          number of delete merge operations discarded.
        </p></li><li class="listitem"><p>
          <code class="literal">discarded operations - delete</code>: The number
          of purge merge operations discarded.
</p></li></ul>
</div>
<p>
      For related information, see
      <a class="xref" href="innodb-storage-engine.html#innodb-insert-buffering" title="14.2.7.5 Change Buffer">Section 14.2.7.5, “Change Buffer”</a>.
    </p><p>
      Adaptive hash index status information includes:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          <code class="literal">Hash table size</code>: The total number of array
          cells allocated to the adaptive hash index.
        </p></li><li class="listitem"><p>
          <code class="literal">node heap has <em class="replaceable"><code>#</code></em>
          buffer(s)</code>: The total number of pages allocated to
          the adaptive hash index.
        </p></li><li class="listitem"><p>
          <code class="literal">hash searches/s</code>: The per second average of
          searches satisfied by the adaptive hash index.
        </p></li><li class="listitem"><p>
          <code class="literal">non-hash searches/s</code>: The per second average
          of searches not satisfied by the adaptive hash index.
</p></li></ul>
</div>
<p>
      For related information, see
      <a class="xref" href="innodb-storage-engine.html#innodb-adaptive-hash" title="14.2.7.6 Adaptive Hash Indexes">Section 14.2.7.6, “Adaptive Hash Indexes”</a>.
    </p><p>
      <span class="bold"><strong><code class="literal">LOG</code></strong></span>
    </p><p>
      This section displays information about the
      <code class="literal">InnoDB</code> log. The contents include the current
      log sequence number, how far the log has been flushed to disk, and
      the position at which <code class="literal">InnoDB</code> last took a
      checkpoint. (See <a class="xref" href="innodb-storage-engine.html#innodb-checkpoints" title="14.9.3 InnoDB Checkpoints">Section 14.9.3, “InnoDB Checkpoints”</a>.) The
      section also displays information about pending writes and write
      performance statistics.
    </p><p>
      <span class="bold"><strong><code class="literal">BUFFER POOL AND
      MEMORY</code></strong></span>
    </p><p>
      This section gives you statistics on pages read and written. You
      can calculate from these numbers how many data file I/O operations
      your queries currently are doing.
    </p><p>
      For additional information about the operation of the buffer pool,
      see <a class="xref" href="optimization.html#innodb-buffer-pool" title="8.10.1 The InnoDB Buffer Pool">Section 8.10.1, “The InnoDB Buffer Pool”</a>.
    </p><p>
      <span class="bold"><strong><code class="literal">ROW OPERATIONS</code></strong></span>
    </p><p>
      This section shows what the main thread is doing, including the
      number and performance rate for each type of row operation.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="innodb-tablespace-monitor"></a>14.14.4 InnoDB Tablespace Monitor Output</h3>

</div>

</div>

</div>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">
<div class="admon-title">
Note
</div>
<p>
        The Tablespace Monitor was removed in MySQL 5.7.4. InnoDB
        tablespace metadata can be obtained from
        <code class="literal">INFORMATION_SCHEMA</code> tables.
</p>
</div>
<p>
      The <code class="literal">InnoDB</code> Tablespace Monitor prints
      information about the file segments in the shared tablespace and
      validates the tablespace allocation data structures. The
      Tablespace Monitor does not describe file-per-table tablespaces
      created with the
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_per_table"><code class="literal">innodb_file_per_table</code></a> option.
    </p><p>
      Example <code class="literal">InnoDB</code> Tablespace Monitor output:
    </p><pre class="programlisting">
================================================
090408 21:28:09 INNODB TABLESPACE MONITOR OUTPUT
================================================
FILE SPACE INFO: id 0
size 13440, free limit 3136, free extents 28
not full frag extents 2: used pages 78, full frag extents 3
first seg id not used 0 23845
SEGMENT id 0 1 space 0; page 2; res 96 used 46; full ext 0
fragm pages 32; free extents 0; not full extents 1: pages 14
SEGMENT id 0 2 space 0; page 2; res 1 used 1; full ext 0
fragm pages 1; free extents 0; not full extents 0: pages 0
SEGMENT id 0 3 space 0; page 2; res 1 used 1; full ext 0
fragm pages 1; free extents 0; not full extents 0: pages 0
...
SEGMENT id 0 15 space 0; page 2; res 160 used 160; full ext 2
fragm pages 32; free extents 0; not full extents 0: pages 0
SEGMENT id 0 488 space 0; page 2; res 1 used 1; full ext 0
fragm pages 1; free extents 0; not full extents 0: pages 0
SEGMENT id 0 17 space 0; page 2; res 1 used 1; full ext 0
fragm pages 1; free extents 0; not full extents 0: pages 0
...
SEGMENT id 0 171 space 0; page 2; res 592 used 481; full ext 7
fragm pages 16; free extents 0; not full extents 2: pages 17
SEGMENT id 0 172 space 0; page 2; res 1 used 1; full ext 0
fragm pages 1; free extents 0; not full extents 0: pages 0
SEGMENT id 0 173 space 0; page 2; res 96 used 44; full ext 0
fragm pages 32; free extents 0; not full extents 1: pages 12
...
SEGMENT id 0 601 space 0; page 2; res 1 used 1; full ext 0
fragm pages 1; free extents 0; not full extents 0: pages 0
NUMBER of file segments: 73
Validating tablespace
Validation ok
---------------------------------------
END OF INNODB TABLESPACE MONITOR OUTPUT
=======================================
</pre><p>
      The Tablespace Monitor output includes information about the
      shared tablespace as a whole, followed by a list containing a
      breakdown for each segment within the tablespace.
    </p><p>
      In this example using the default
      <a class="link" href="glossary.html#glos_page_size" title="page size">page size</a>, the tablespace
      consists of database pages that are 16KB each. The pages are
      grouped into <a class="link" href="glossary.html#glos_extent" title="extent">extents</a> of size
      1MB (64 consecutive pages).
    </p><p>
      The initial part of the output that displays overall tablespace
      information has this format:
    </p><pre class="programlisting">
FILE SPACE INFO: id 0
size 13440, free limit 3136, free extents 28
not full frag extents 2: used pages 78, full frag extents 3
first seg id not used 0 23845
</pre><p>
      Overall tablespace information includes these values:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          <code class="literal">id</code>: The tablespace ID. A value of 0 refers
          to the shared tablespace.
        </p></li><li class="listitem"><p>
          <code class="literal">size</code>: The current tablespace size in pages.
        </p></li><li class="listitem"><p>
          <code class="literal">free limit</code>: The minimum page number for
          which the free list has not been initialized. Pages at or
          above this limit are free.
        </p></li><li class="listitem"><p>
          <code class="literal">free extents</code>: The number of free extents.
        </p></li><li class="listitem"><p>
          <code class="literal">not full frag extents</code>, <code class="literal">used
          pages</code>: The number of fragment extents that are not
          completely filled, and the number of pages in those extents
          that have been allocated.
        </p></li><li class="listitem"><p>
          <code class="literal">full frag extents</code>: The number of completely
          full fragment extents.
        </p></li><li class="listitem"><p>
          <code class="literal">first seg id not used</code>: The first unused
          segment ID.
</p></li></ul>
</div>
<p>
      Individual segment information has this format:
    </p><pre class="programlisting">
SEGMENT id 0 15 space 0; page 2; res 160 used 160; full ext 2
fragm pages 32; free extents 0; not full extents 0: pages 0
</pre><p>
      Segment information includes these values:
    </p><p>
      <code class="literal">id</code>: The segment ID.
    </p><p>
      <code class="literal">space</code>, <code class="literal">page</code>: The tablespace
      number and page within the tablespace where the segment
      <span class="quote">“<span class="quote">inode</span>”</span> is located. A tablespace number of 0
      indicates the shared tablespace. <code class="literal">InnoDB</code> uses
      inodes to keep track of segments in the tablespace. The other
      fields displayed for a segment (<code class="literal">id</code>,
      <code class="literal">res</code>, and so forth) are derived from information
      in the inode.
    </p><p>
      <code class="literal">res</code>: The number of pages allocated (reserved)
      for the segment.
    </p><p>
      <code class="literal">used</code>: The number of allocated pages in use by
      the segment.
    </p><p>
      <code class="literal">full ext</code>: The number of extents allocated for
      the segment that are completely used.
    </p><p>
      <code class="literal">fragm pages</code>: The number of initial pages that
      have been allocated to the segment.
    </p><p>
      <code class="literal">free extents</code>: The number of extents allocated
      for the segment that are completely unused.
    </p><p>
      <code class="literal">not full extents</code>: The number of extents
      allocated for the segment that are partially used.
    </p><p>
      <code class="literal">pages</code>: The number of pages used within the
      not-full extents.
    </p><p>
      When a segment grows, it starts as a single page, and
      <code class="literal">InnoDB</code> allocates the first pages for it one at
      a time, up to 32 pages (this is the <code class="literal">fragm pages</code>
      value). After that, <code class="literal">InnoDB</code> allocates complete
      extents. <code class="literal">InnoDB</code> can add up to 4 extents at a
      time to a large segment to ensure good sequentiality of data.
    </p><p>
      For the example segment shown earlier, it has 32 fragment pages,
      plus 2 full extents (64 pages each), for a total of 160 pages used
      out of 160 pages allocated. The following segment has 32 fragment
      pages and one partially full extent using 14 pages for a total of
      46 pages used out of 96 pages allocated:
    </p><pre class="programlisting">
SEGMENT id 0 1 space 0; page 2; res 96 used 46; full ext 0
fragm pages 32; free extents 0; not full extents 1: pages 14
</pre><p>
      It is possible for a segment that has extents allocated to it to
      have a <code class="literal">fragm pages</code> value less than 32 if some
      of the individual pages have been deallocated subsequent to extent
      allocation.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="innodb-table-monitor"></a>14.14.5 InnoDB Table Monitor Output</h3>

</div>

</div>

</div>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">
<div class="admon-title">
Note
</div>
<p>
        The <code class="literal">InnoDB</code> Table Monitor was removed in MySQL
        5.7.4. Equivalent information can be obtained from
        <code class="literal">InnoDB</code> <code class="literal">INFORMATION_SCHEMA</code>
        tables. See <a class="xref" href="information-schema.html#innodb-i_s-tables" title="21.31 INFORMATION_SCHEMA Tables for InnoDB">Section 21.31, “INFORMATION_SCHEMA Tables for InnoDB”</a>.
</p>
</div>
<p>
      The <code class="literal">InnoDB</code> Table Monitor prints the contents of
      the <code class="literal">InnoDB</code> internal data dictionary.
    </p><p>
      The output contains one section per table. The
      <code class="literal">SYS_FOREIGN</code> and
      <code class="literal">SYS_FOREIGN_COLS</code> sections are for internal data
      dictionary tables that maintain information about foreign keys.
      There are also sections for the Table Monitor table and each
      user-created <code class="literal">InnoDB</code> table. Suppose that the
      following two tables have been created in the
      <code class="literal">test</code> database:
    </p><pre class="programlisting">
CREATE TABLE parent
(
  par_id    INT NOT NULL,
  fname      CHAR(20),
  lname      CHAR(20),
  PRIMARY KEY (par_id),
  UNIQUE INDEX (lname, fname)
) ENGINE = INNODB;

CREATE TABLE child
(
  par_id      INT NOT NULL,
  child_id    INT NOT NULL,
  name        VARCHAR(40),
  birth       DATE,
  weight      DECIMAL(10,2),
  misc_info   VARCHAR(255),
  last_update TIMESTAMP,
  PRIMARY KEY (par_id, child_id),
  INDEX (name),
  FOREIGN KEY (par_id) REFERENCES parent (par_id)
    ON DELETE CASCADE
    ON UPDATE CASCADE
) ENGINE = INNODB;
</pre><p>
      Then the Table Monitor output will look something like this
      (reformatted slightly):
    </p><pre class="programlisting">
===========================================
090420 12:09:32 INNODB TABLE MONITOR OUTPUT
===========================================
--------------------------------------
TABLE: name SYS_FOREIGN, id 0 11, columns 7, indexes 3, appr.rows 1
  COLUMNS: ID: DATA_VARCHAR DATA_ENGLISH len 0;
           FOR_NAME: DATA_VARCHAR DATA_ENGLISH len 0;
           REF_NAME: DATA_VARCHAR DATA_ENGLISH len 0;
           N_COLS: DATA_INT len 4;
           DB_ROW_ID: DATA_SYS prtype 256 len 6;
           DB_TRX_ID: DATA_SYS prtype 257 len 6;
  INDEX: name ID_IND, id 0 11, fields 1/6, uniq 1, type 3
   root page 46, appr.key vals 1, leaf pages 1, size pages 1
   FIELDS:  ID DB_TRX_ID DB_ROLL_PTR FOR_NAME REF_NAME N_COLS
  INDEX: name FOR_IND, id 0 12, fields 1/2, uniq 2, type 0
   root page 47, appr.key vals 1, leaf pages 1, size pages 1
   FIELDS:  FOR_NAME ID
  INDEX: name REF_IND, id 0 13, fields 1/2, uniq 2, type 0
   root page 48, appr.key vals 1, leaf pages 1, size pages 1
   FIELDS:  REF_NAME ID
--------------------------------------
TABLE: name SYS_FOREIGN_COLS, id 0 12, columns 7, indexes 1, appr.rows 1
  COLUMNS: ID: DATA_VARCHAR DATA_ENGLISH len 0;
           POS: DATA_INT len 4;
           FOR_COL_NAME: DATA_VARCHAR DATA_ENGLISH len 0;
           REF_COL_NAME: DATA_VARCHAR DATA_ENGLISH len 0;
           DB_ROW_ID: DATA_SYS prtype 256 len 6;
           DB_TRX_ID: DATA_SYS prtype 257 len 6;
  INDEX: name ID_IND, id 0 14, fields 2/6, uniq 2, type 3
   root page 49, appr.key vals 1, leaf pages 1, size pages 1
   FIELDS:  ID POS DB_TRX_ID DB_ROLL_PTR FOR_COL_NAME REF_COL_NAME
--------------------------------------
TABLE: name test/child, id 0 14, columns 10, indexes 2, appr.rows 201
  COLUMNS: par_id: DATA_INT DATA_BINARY_TYPE DATA_NOT_NULL len 4;
           child_id: DATA_INT DATA_BINARY_TYPE DATA_NOT_NULL len 4;
           name: DATA_VARCHAR prtype 524303 len 40;
           birth: DATA_INT DATA_BINARY_TYPE len 3;
           weight: DATA_FIXBINARY DATA_BINARY_TYPE len 5;
           misc_info: DATA_VARCHAR prtype 524303 len 255;
           last_update: DATA_INT DATA_UNSIGNED DATA_BINARY_TYPE DATA_NOT_NULL len 4;
           DB_ROW_ID: DATA_SYS prtype 256 len 6;
           DB_TRX_ID: DATA_SYS prtype 257 len 6;
  INDEX: name PRIMARY, id 0 17, fields 2/9, uniq 2, type 3
   root page 52, appr.key vals 201, leaf pages 5, size pages 6
   FIELDS:  par_id child_id DB_TRX_ID DB_ROLL_PTR name birth weight misc_info last_update
  INDEX: name name, id 0 18, fields 1/3, uniq 3, type 0
   root page 53, appr.key vals 210, leaf pages 1, size pages 1
   FIELDS:  name par_id child_id
  FOREIGN KEY CONSTRAINT test/child_ibfk_1: test/child ( par_id )
             REFERENCES test/parent ( par_id )
--------------------------------------
TABLE: name test/innodb_table_monitor, id 0 15, columns 4, indexes 1, appr.rows 0
  COLUMNS: i: DATA_INT DATA_BINARY_TYPE len 4;
           DB_ROW_ID: DATA_SYS prtype 256 len 6;
           DB_TRX_ID: DATA_SYS prtype 257 len 6;
  INDEX: name GEN_CLUST_INDEX, id 0 19, fields 0/4, uniq 1, type 1
   root page 193, appr.key vals 0, leaf pages 1, size pages 1
   FIELDS:  DB_ROW_ID DB_TRX_ID DB_ROLL_PTR i
--------------------------------------
TABLE: name test/parent, id 0 13, columns 6, indexes 2, appr.rows 299
  COLUMNS: par_id: DATA_INT DATA_BINARY_TYPE DATA_NOT_NULL len 4;
           fname: DATA_CHAR prtype 524542 len 20;
           lname: DATA_CHAR prtype 524542 len 20;
           DB_ROW_ID: DATA_SYS prtype 256 len 6;
           DB_TRX_ID: DATA_SYS prtype 257 len 6;
  INDEX: name PRIMARY, id 0 15, fields 1/5, uniq 1, type 3
   root page 50, appr.key vals 299, leaf pages 2, size pages 3
   FIELDS:  par_id DB_TRX_ID DB_ROLL_PTR fname lname
  INDEX: name lname, id 0 16, fields 2/3, uniq 2, type 2
   root page 51, appr.key vals 300, leaf pages 1, size pages 1
   FIELDS:  lname fname par_id
  FOREIGN KEY CONSTRAINT test/child_ibfk_1: test/child ( par_id )
             REFERENCES test/parent ( par_id )
-----------------------------------
END OF INNODB TABLE MONITOR OUTPUT
==================================
</pre><p>
      For each table, Table Monitor output contains a section that
      displays general information about the table and specific
      information about its columns, indexes, and foreign keys.
    </p><p>
      The general information for each table includes the table name (in
      <code class="literal"><em class="replaceable"><code>db_name</code></em>/<em class="replaceable"><code>tbl_name</code></em></code>
      format except for internal tables), its ID, the number of columns
      and indexes, and an approximate row count.
    </p><p>
      The <code class="literal">COLUMNS</code> part of a table section lists each
      column in the table. Information for each column indicates its
      name and data type characteristics. Some internal columns are
      added by <code class="literal">InnoDB</code>, such as
      <code class="literal">DB_ROW_ID</code> (row ID),
      <code class="literal">DB_TRX_ID</code> (transaction ID), and
      <code class="literal">DB_ROLL_PTR</code> (a pointer to the rollback/undo
      data).
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          <code class="literal">DATA_<em class="replaceable"><code>xxx</code></em></code>: These
          symbols indicate the data type. There may be multiple
          <code class="literal">DATA_<em class="replaceable"><code>xxx</code></em></code> symbols
          for a given column.
        </p></li><li class="listitem"><p>
          <code class="literal">prtype</code>: The column's <span class="quote">“<span class="quote">precise</span>”</span>
          type. This field includes information such as the column data
          type, character set code, nullability, signedness, and whether
          it is a binary string. This field is described in the
          <code class="filename">innobase/include/data0type.h</code> source file.
        </p></li><li class="listitem"><p>
          <code class="literal">len</code>: The column length in bytes.
</p></li></ul>
</div>
<p>
      Each <code class="literal">INDEX</code> part of the table section provides
      the name and characteristics of one table index:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          <code class="literal">name</code>: The index name. If the name is
          <code class="literal">PRIMARY</code>, the index is a primary key. If the
          name is <code class="literal">GEN_CLUST_INDEX</code>, the index is the
          clustered index that is created automatically if the table
          definition doesn't include a primary key or
          non-<code class="literal">NULL</code> unique index. See
          <a class="xref" href="innodb-storage-engine.html#innodb-index-types" title="14.2.7.2 Clustered and Secondary Indexes">Section 14.2.7.2, “Clustered and Secondary Indexes”</a>.
        </p></li><li class="listitem"><p>
          <code class="literal">id</code>: The index ID.
        </p></li><li class="listitem"><p>
          <code class="literal">fields</code>: The number of fields in the index,
          as a value in
          <code class="literal"><em class="replaceable"><code>m</code></em>/<em class="replaceable"><code>n</code></em></code>
          format:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
              <em class="replaceable"><code>m</code></em> is the number of user-defined
              columns; that is, the number of columns you would see in
              the index definition in a <code class="literal">CREATE TABLE</code>
              statement.
            </p></li><li class="listitem"><p>
              <em class="replaceable"><code>n</code></em> is the total number of index
              columns, including those added internally. For the
              clustered index, the total includes the other columns in
              the table definition, plus any columns added internally.
              For a secondary index, the total includes the columns from
              the primary key that are not part of the secondary index.
</p></li></ul>
</div>
</li><li class="listitem"><p>
          <code class="literal">uniq</code>: The number of leading fields that are
          enough to determine index values uniquely.
        </p></li><li class="listitem"><p>
          <code class="literal">type</code>: The index type. This is a bit field.
          For example, 1 indicates a clustered index and 2 indicates a
          unique index, so a clustered index (which always contains
          unique values), will have a <code class="literal">type</code> value of
          3. An index with a <code class="literal">type</code> value of 0 is
          neither clustered nor unique. The flag values are defined in
          the <code class="filename">innobase/include/dict0mem.h</code> source
          file.
        </p></li><li class="listitem"><p>
          <code class="literal">root page</code>: The index root page number.
        </p></li><li class="listitem"><p>
          <code class="literal">appr. key vals</code>: The approximate index
          cardinality.
        </p></li><li class="listitem"><p>
          <code class="literal">leaf pages</code>: The approximate number of leaf
          pages in the index.
        </p></li><li class="listitem"><p>
          <code class="literal">size pages</code>: The approximate total number of
          pages in the index.
        </p></li><li class="listitem"><p>
          <code class="literal">FIELDS</code>: The names of the fields in the
          index. For a clustered index that was generated automatically,
          the field list begins with the internal
          <code class="literal">DB_ROW_ID</code> (row ID) field.
          <code class="literal">DB_TRX_ID</code> and
          <code class="literal">DB_ROLL_PTR</code> are always added internally to
          the clustered index, following the fields that comprise the
          primary key. For a secondary index, the final fields are those
          from the primary key that are not part of the secondary index.
</p></li></ul>
</div>
<p>
      The end of the table section lists the <code class="literal">FOREIGN
      KEY</code> definitions that apply to the table. This
      information appears whether the table is a referencing or
      referenced table.
</p>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="innodb-backup"></a>14.15 InnoDB Backup and Recovery</h2>

</div>

</div>

</div>
<div class="toc">
<dl class="toc"><dt><span class="section"><a href="innodb-storage-engine.html#innodb-recovery">14.15.1 The InnoDB Recovery Process</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-recovery-tablespace-discovery">14.15.2 Tablespace Discovery During Crash Recovery</a></span></dt></dl>
</div>
<a class="indexterm" name="idm140644101558752"></a><a class="indexterm" name="idm140644101557296"></a><p>
    The key to safe database management is making regular backups.
    Depending on your data volume, number of MySQL servers, and database
    workload, you can use these techniques, alone or in combination:
    <a class="link" href="glossary.html#glos_hot_backup" title="hot backup">hot backup</a> with MySQL
    Enterprise Backup; <a class="link" href="glossary.html#glos_cold_backup" title="cold backup">cold
    backup</a> by copying files while the MySQL server is shut down;
    <a class="link" href="glossary.html#glos_physical_backup" title="physical backup">physical backup</a> for fast
    operation (especially for restore);
    <a class="link" href="glossary.html#glos_logical_backup" title="logical backup">logical backup</a> with
    <a class="link" href="programs.html#mysqldump" title="4.5.4 mysqldump — A Database Backup Program"><span class="command"><strong>mysqldump</strong></span></a> for smaller data volumes or to record
    the structure of schema objects.
</p>
<h3><a name="idm140644101550304"></a>Hot Backups</h3>
<p>
    The <span class="command"><strong>mysqlbackup</strong></span> command, part of the MySQL
    Enterprise Backup component, lets you back up a running MySQL
    instance, including <code class="literal">InnoDB</code> and
    <a class="link" href="storage-engines.html#myisam-storage-engine" title="15.2 The MyISAM Storage Engine"><code class="literal">MyISAM</code></a> tables, with minimal disruption
    to operations while producing a consistent snapshot of the database.
    When <span class="command"><strong>mysqlbackup</strong></span> is copying
    <code class="literal">InnoDB</code> tables, reads and writes to both
    <code class="literal">InnoDB</code> and <code class="literal">MyISAM</code> tables can
    continue. During the copying of <code class="literal">MyISAM</code> tables,
    reads (but not writes) to those tables are permitted. MySQL
    Enterprise Backup can also create compressed backup files, and back
    up subsets of tables and databases. In conjunction with MySQL’s
    binary log, users can perform point-in-time recovery. MySQL
    Enterprise Backup is part of the MySQL Enterprise subscription. For
    more details, see <a class="xref" href="mysql-enterprise.html#mysql-enterprise-backup" title="26.2 MySQL Enterprise Backup Overview">Section 26.2, “MySQL Enterprise Backup Overview”</a>.
</p>
<h3><a name="idm140644101541280"></a>Cold Backups</h3>
<p>
    If you can shut down your MySQL server, you can make a binary backup
    that consists of all files used by <code class="literal">InnoDB</code> to
    manage its tables. Use the following procedure:
</p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p>
        Do a <a class="link" href="glossary.html#glos_slow_shutdown" title="slow shutdown">slow shutdown</a> of
        the MySQL server and make sure that it stops without errors.
      </p></li><li class="listitem"><p>
        Copy all <code class="literal">InnoDB</code> data files
        (<code class="filename">ibdata</code> files and <code class="filename">.ibd</code>
        files) into a safe place.
      </p></li><li class="listitem"><p>
        Copy all the <code class="filename">.frm</code> files for
        <code class="literal">InnoDB</code> tables to a safe place.
      </p></li><li class="listitem"><p>
        Copy all <code class="literal">InnoDB</code> log files
        (<code class="filename">ib_logfile</code> files) to a safe place.
      </p></li><li class="listitem"><p>
        Copy your <code class="filename">my.cnf</code> configuration file or
        files to a safe place.
</p></li></ol>
</div>
<h3><a name="idm140644101527616"></a>Alternative Backup Types</h3>
<p>
    In addition to making binary backups as just described, regularly
    make dumps of your tables with <a class="link" href="programs.html#mysqldump" title="4.5.4 mysqldump — A Database Backup Program"><span class="command"><strong>mysqldump</strong></span></a>. A
    binary file might be corrupted without you noticing it. Dumped
    tables are stored into text files that are human-readable, so
    spotting table corruption becomes easier. Also, because the format
    is simpler, the chance for serious data corruption is smaller.
    <a class="link" href="programs.html#mysqldump" title="4.5.4 mysqldump — A Database Backup Program"><span class="command"><strong>mysqldump</strong></span></a> also has a
    <a class="link" href="programs.html#option_mysqldump_single-transaction"><code class="option">--single-transaction</code></a> option for
    making a consistent snapshot without locking out other clients. See
    <a class="xref" href="backup-and-recovery.html#backup-policy" title="7.3.1 Establishing a Backup Policy">Section 7.3.1, “Establishing a Backup Policy”</a>.
  </p><p>
    Replication works with <a class="link" href="innodb-storage-engine.html" title="Chapter 14 The InnoDB Storage Engine"><code class="literal">InnoDB</code></a> tables,
    so you can use MySQL replication capabilities to keep a copy of your
    database at database sites requiring high availability.
</p>
<h3><a name="idm140644101520128"></a>Performing Recovery</h3>
<p>
    To recover your <code class="literal">InnoDB</code> database to the present
    from the time at which the binary backup was made, you must run your
    MySQL server with binary logging turned on, even before taking the
    backup. To achieve point-in-time recovery after restoring a backup,
    you can apply changes from the binary log that occurred after the
    backup was made. See <a class="xref" href="backup-and-recovery.html#point-in-time-recovery" title="7.5 Point-in-Time (Incremental) Recovery Using the Binary Log">Section 7.5, “Point-in-Time (Incremental) Recovery Using the Binary Log”</a>.
  </p><p>
    To recover from a crash of your MySQL server, the only requirement
    is to restart it. <code class="literal">InnoDB</code> automatically checks the
    logs and performs a roll-forward of the database to the present.
    <code class="literal">InnoDB</code> automatically rolls back uncommitted
    transactions that were present at the time of the crash. During
    recovery, <a class="link" href="programs.html#mysqld" title="4.3.1 mysqld — The MySQL Server"><span class="command"><strong>mysqld</strong></span></a> displays output something like
    this:
  </p><pre class="programlisting">
InnoDB: Database was not shut down normally.
InnoDB: Starting recovery from log files...
InnoDB: Starting log scan based on checkpoint at
InnoDB: log sequence number 0 13674004
InnoDB: Doing recovery: scanned up to log sequence number 0 13739520
InnoDB: Doing recovery: scanned up to log sequence number 0 13805056
InnoDB: Doing recovery: scanned up to log sequence number 0 13870592
InnoDB: Doing recovery: scanned up to log sequence number 0 13936128
...
InnoDB: Doing recovery: scanned up to log sequence number 0 20555264
InnoDB: Doing recovery: scanned up to log sequence number 0 20620800
InnoDB: Doing recovery: scanned up to log sequence number 0 20664692
InnoDB: 1 uncommitted transaction(s) which must be rolled back
InnoDB: Starting rollback of uncommitted transactions
InnoDB: Rolling back trx no 16745
InnoDB: Rolling back of trx no 16745 completed
InnoDB: Rollback of uncommitted transactions completed
InnoDB: Starting an apply batch of log records to the database...
InnoDB: Apply batch completed
InnoDB: Started
mysqld: ready for connections
</pre><p>
    If your database becomes corrupted or disk failure occurs, you must
    perform the recovery using a backup. In the case of corruption,
    first find a backup that is not corrupted. After restoring the base
    backup, do a point-in-time recovery from the binary log files using
    <a class="link" href="programs.html#mysqlbinlog" title="4.6.7 mysqlbinlog — Utility for Processing Binary Log Files"><span class="command"><strong>mysqlbinlog</strong></span></a> and <a class="link" href="programs.html#mysql" title="4.5.1 mysql — The MySQL Command-Line Tool"><span class="command"><strong>mysql</strong></span></a> to
    restore the changes that occurred after the backup was made.
  </p><a class="indexterm" name="idm140644101508992"></a><a class="indexterm" name="idm140644101507504"></a><a class="indexterm" name="idm140644101506016"></a><p>
    In some cases of database corruption, it is enough just to dump,
    drop, and re-create one or a few corrupt tables. You can use the
    <a class="link" href="sql-syntax.html#check-table" title="13.7.2.2 CHECK TABLE Syntax"><code class="literal">CHECK TABLE</code></a> SQL statement to check
    whether a table is corrupt, although <a class="link" href="sql-syntax.html#check-table" title="13.7.2.2 CHECK TABLE Syntax"><code class="literal">CHECK
    TABLE</code></a> naturally cannot detect every possible kind of
    corruption. You can use the Tablespace Monitor to check the
    integrity of the file space management inside the tablespace files.
  </p><p>
    In some cases, apparent database page corruption is actually due to
    the operating system corrupting its own file cache, and the data on
    disk may be okay. It is best first to try restarting your computer.
    Doing so may eliminate errors that appeared to be database page
    corruption. If MySQL still has trouble starting because of
    <code class="literal">InnoDB</code> consistency problems, see
    <a class="xref" href="innodb-storage-engine.html#forcing-innodb-recovery" title="14.18.2 Forcing InnoDB Recovery">Section 14.18.2, “Forcing InnoDB Recovery”</a> for steps to start the
    instance in a diagnostic mode where you can dump the data.
</p>
<div class="section">

<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="innodb-recovery"></a>14.15.1 The InnoDB Recovery Process</h3>
</div>
</div>
</div>
<a class="indexterm" name="idm140644101497904"></a><p>
      <code class="literal">InnoDB</code>
      <a class="link" href="glossary.html#glos_crash_recovery" title="crash recovery">crash recovery</a> consists
      of several steps:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          Applying the <a class="link" href="glossary.html#glos_redo_log" title="redo log">redo log</a>:
          Redo log application is the first step and is performed during
          initialization, before accepting any connections. If all
          changes were flushed from the
          <a class="link" href="glossary.html#glos_buffer_pool" title="buffer pool">buffer pool</a> to the
          <a class="link" href="glossary.html#glos_tablespace" title="tablespace">tablespaces</a>
          (<code class="filename">ibdata*</code> and <code class="filename">*.ibd</code>
          files) at the time of the shutdown or crash, the redo log
          application can be skipped. If the redo log files are missing
          at startup, <code class="literal">InnoDB</code> skips the redo log
          application.
        </p><p>
          Removing redo logs to speed up the recovery process is not
          recommended, even if some data loss is acceptable. Removing
          redo logs should only be considered an option after a clean
          shutdown is performed, with
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_fast_shutdown"><code class="literal">innodb_fast_shutdown</code></a> set to
          <code class="literal">0</code> or <code class="literal">1</code>.
        </p></li><li class="listitem"><p>
          <a class="link" href="glossary.html#glos_rollback" title="rollback">Rolling back</a> incomplete
          <a class="link" href="glossary.html#glos_transaction" title="transaction">transactions</a>: Any
          transactions that were active at the time of crash or
          <a class="link" href="glossary.html#glos_fast_shutdown" title="fast shutdown">fast shutdown</a>. The
          time it takes to roll back an incomplete transaction can be
          three or four times the amount of time a transaction is active
          before it is interrupted, depending on server load.
        </p><p>
          You cannot cancel transactions that are in the process of
          being rolled back. In extreme cases, when rolling back
          transactions is expected to take an exceptionally long time,
          it may be faster to start <code class="literal">InnoDB</code> with an
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_force_recovery"><code class="literal">innodb_force_recovery</code></a> setting
          of <code class="literal">3</code> or greater. See
          <a class="xref" href="innodb-storage-engine.html#forcing-innodb-recovery" title="14.18.2 Forcing InnoDB Recovery">Section 14.18.2, “Forcing InnoDB Recovery”</a> for more
          information.
        </p></li><li class="listitem"><p>
          <a class="link" href="glossary.html#glos_change_buffer" title="change buffer">Change buffer</a> merge:
          Applying changes from the change buffer (part of the
          <a class="link" href="glossary.html#glos_system_tablespace" title="system tablespace">system
          tablespace</a>) to leaf pages of secondary indexes, as the
          index pages are read to the buffer pool.
        </p></li><li class="listitem"><p>
          <a class="link" href="glossary.html#glos_purge" title="purge">Purge</a>: Deleting
          delete-marked records that are no longer visible for any
          active transaction.
</p></li></ul>
</div>
<p>
      The steps that follow redo log application do not depend on the
      redo log (other than for logging the writes) and are performed in
      parallel with normal processing. Of these, only rollback of
      incomplete transactions is special to crash recovery. The insert
      buffer merge and the purge are performed during normal processing.
    </p><p>
      After redo log application, <code class="literal">InnoDB</code> attempts to
      accept connections as early as possible, to reduce downtime. As
      part of crash recovery, <code class="literal">InnoDB</code> rolls back any
      transactions that were not committed or in <code class="literal">XA
      PREPARE</code> state when the server crashed. The rollback is
      performed by a background thread, executed in parallel with
      transactions from new connections. Until the rollback operation is
      completed, new connections may encounter locking conflicts with
      recovered transactions.
    </p><p>
      In most situations, even if the MySQL server was killed
      unexpectedly in the middle of heavy activity, the recovery process
      happens automatically and no action is needed from the DBA. If a
      hardware failure or severe system error corrupted
      <code class="literal">InnoDB</code> data, MySQL might refuse to start. In
      that case, see <a class="xref" href="innodb-storage-engine.html#forcing-innodb-recovery" title="14.18.2 Forcing InnoDB Recovery">Section 14.18.2, “Forcing InnoDB Recovery”</a> for the
      steps to troubleshoot such an issue.
    </p><p>
      For information about the binary log and <code class="literal">InnoDB</code>
      crash recovery, see <a class="xref" href="server-administration.html#binary-log" title="5.2.4 The Binary Log">Section 5.2.4, “The Binary Log”</a>.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="innodb-recovery-tablespace-discovery"></a>14.15.2 Tablespace Discovery During Crash Recovery</h3>

</div>

</div>

</div>
<p>
      If, during crash recovery, <code class="literal">InnoDB</code> encounters
      redo logs written since the last checkpoint, the redo logs must be
      applied to the affected tablespaces. The process that identifies
      affected tablespaces is referred to as <span class="emphasis"><em>tablespace
      discovery</em></span>.
    </p><p>
      Prior to MySQL 5.7.5, tablespace files were referenced in redo
      logs by a <code class="literal">space_id</code>, which is a numeric
      identifier. In the file system, however,
      <a class="link" href="glossary.html#glos_file_per_table" title="file-per-table">file-per-table</a>
      tablespaces are known by a <code class="filename">*.ibd</code> file name,
      which required that <code class="literal">InnoDB</code> construct a
      <span class="quote">“<span class="quote">space_id-file name</span>”</span> map in order to apply redo logs.
      To construct the map, <code class="literal">InnoDB</code> traversed the data
      directory, reading the first page of each <code class="literal">*.ibd</code>
      file. This process could result in unnecessary downtime for MySQL
      instances with numerous <code class="filename">*.ibd</code> files.
    </p><p>
      In MySQL 5.6.6, the introduction of support for the
      <a class="link" href="sql-syntax.html#create-table" title="13.1.18 CREATE TABLE Syntax"><code class="literal">CREATE TABLE</code></a> <code class="literal">DATA
      DIRECTORY</code> clause for
      <a class="link" href="glossary.html#glos_file_per_table" title="file-per-table">file-per-table</a>
      tablespaces further complicated tablespace discovery. The
      <code class="literal">DATA DIRECTORY</code> enhancement introduced
      <code class="filename">.isl</code> files as placeholders that point to the
      location of <code class="filename">*.ibd </code> files stored outside of
      the MySQL data directory.
    </p><p>
      In MySQL 5.7.5, instead of reading the first page of all
      <code class="filename">$datadir/*/*.ibd</code> files and checking the
      contents of <code class="filename">$datadir/*/*.isl</code> files before
      applying redo logs, InnoDB uses a new redo log record type to
      identify the file-per-table tablespaces that have been modified
      since the last checkpoint. An <code class="literal">MLOG_FILE_NAME</code>
      record, which contains the tablespace <code class="literal">space_id</code>
      and file name, is written to the redo log when a tablespace page
      is modified. The benefits of <code class="literal">MLOG_FILE_NAME</code>
      redo log records include:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          Elimination of file system scans prior to redo log
          application. The <code class="literal">MLOG_FILE_NAME</code> redo log
          record provides the information necessary to identify and
          locate tablespaces that have changed since the last
          checkpoint.
        </p></li><li class="listitem"><p>
          Only <code class="filename">*.ibd</code> files modified since the last
          checkpoint are accessed.
        </p></li><li class="listitem"><p>
          <code class="filename">*.ibd</code> files that are not attached to the
          <code class="literal">InnoDB</code> instance are ignored when redo logs
          are applied.
        </p></li><li class="listitem"><p>
          <code class="literal">InnoDB</code> no longer silently discards redo log
          records for missing <code class="filename">*.ibd</code> files unless
          there is an <code class="literal">MLOG_FILE_DELETE</code> record in the
          redo log. For example, if a file rename fails, resulting in a
          <span class="quote">“<span class="quote">missing</span>”</span> <code class="filename">*.ibd</code> file, you
          can manually rename the file and restart crash recovery.
          Missing <code class="filename">*.ibd</code> files are ignored in
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_force_recovery"><code class="literal">innodb_force_recovery</code></a> mode.
        </p></li><li class="listitem"><p>
          During recovery, the redo log is read from the last checkpoint
          to the detected logical end of the log. If tablespace files
          that are referenced in the scanned portion of the redo log are
          missing, startup is refused.
        </p></li><li class="listitem"><p>
          Failure scenarios related to inconsistent
          <code class="filename">*.isl</code> files are eliminated.
          <code class="filename">*.isl</code> files are now only used after redo
          log apply, when opening tables.
</p></li></ul>
</div>
<p>
      In MySQL 5.7.6, two tablespace discovery searches were added with
      the introduction of <code class="literal">InnoDB</code> general tablespaces.
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          The first search traverses <code class="literal">SYS_TABLESPACES</code>
          and related entries in <code class="literal">SYS_DATAFILES</code>, in
          the internal data dictionary. All previously created general
          tablespaces are opened, including general tablespaces that are
          empty.
        </p></li><li class="listitem"><p>
          The second search traverses <code class="literal">SYS_TABLES</code>, in
          the internal data dictionary. For tables with a SPACE ID
          greater than 0, the SPACE ID is looked up in
          <code class="literal">SYS_DATAFILES</code> to ensure that the tablespace
          is opened.
</p></li></ul>
</div>

</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="innodb-and-mysql-replication"></a>14.16 InnoDB and MySQL Replication</h2>

</div>

</div>

</div>
<a class="indexterm" name="idm140644101422368"></a><p>
    MySQL replication works for <code class="literal">InnoDB</code> tables as it
    does for <code class="literal">MyISAM</code> tables. It is also possible to
    use replication in a way where the storage engine on the slave is
    not the same as the original storage engine on the master. For
    example, you can replicate modifications to an
    <code class="literal">InnoDB</code> table on the master to a
    <code class="literal">MyISAM</code> table on the slave.
  </p><p>
    To set up a new slave for a master, make a copy of the
    <code class="literal">InnoDB</code> tablespace and the log files, as well as
    the <code class="filename">.frm</code> files of the <code class="literal">InnoDB</code>
    tables, and move the copies to the slave. If the
    <a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_per_table"><code class="literal">innodb_file_per_table</code></a> option is
    enabled, copy the <code class="filename">.ibd</code> files as well. For the
    proper procedure to do this, see <a class="xref" href="innodb-storage-engine.html#innodb-backup" title="14.15 InnoDB Backup and Recovery">Section 14.15, “InnoDB Backup and Recovery”</a>.
  </p><p>
    To make a new slave without taking down the master or an existing
    slave, use the <a class="link" href="mysql-enterprise.html#mysql-enterprise-backup" title="26.2 MySQL Enterprise Backup Overview">MySQL
    Enterprise Backup</a> product. If you can shut down the master or
    an existing slave, take a <a class="link" href="glossary.html#glos_cold_backup" title="cold backup">cold
    backup</a> of the <code class="literal">InnoDB</code> tablespaces and log
    files and use that to set up a slave.
  </p><p>
    Transactions that fail on the master do not affect replication at
    all. MySQL replication is based on the binary log where MySQL writes
    SQL statements that modify data. A transaction that fails (for
    example, because of a foreign key violation, or because it is rolled
    back) is not written to the binary log, so it is not sent to slaves.
    See <a class="xref" href="sql-syntax.html#commit" title="13.3.1 START TRANSACTION, COMMIT, and ROLLBACK Syntax">Section 13.3.1, “START TRANSACTION, COMMIT, and ROLLBACK Syntax”</a>.
  </p><p><b>Replication and CASCADE. </b>
      Cascading actions for <code class="literal">InnoDB</code> tables on the
      master are replicated on the slave <span class="emphasis"><em>only</em></span> if
      the tables sharing the foreign key relation use
      <code class="literal">InnoDB</code> on both the master and slave. This is
      true whether you are using statement-based or row-based
      replication. Suppose that you have started replication, and then
      create two tables on the master using the following
      <a class="link" href="sql-syntax.html#create-table" title="13.1.18 CREATE TABLE Syntax"><code class="literal">CREATE TABLE</code></a> statements:
    </p><pre class="programlisting">
CREATE TABLE fc1 (
    i INT PRIMARY KEY,
    j INT
) ENGINE = InnoDB;

CREATE TABLE fc2 (
    m INT PRIMARY KEY,
    n INT,
    FOREIGN KEY ni (n) REFERENCES fc1 (i)
        ON DELETE CASCADE
) ENGINE = InnoDB;
</pre><p>
    Suppose that the slave does not have <code class="literal">InnoDB</code>
    support enabled. If this is the case, then the tables on the slave
    are created, but they use the <code class="literal">MyISAM</code> storage
    engine, and the <code class="literal">FOREIGN KEY</code> option is ignored.
    Now we insert some rows into the tables on the master:
  </p><pre class="programlisting">
master&gt; <strong class="userinput"><code>INSERT INTO fc1 VALUES (1, 1), (2, 2);</code></strong>
Query OK, 2 rows affected (0.09 sec)
Records: 2  Duplicates: 0  Warnings: 0

master&gt; <strong class="userinput"><code>INSERT INTO fc2 VALUES (1, 1), (2, 2), (3, 1);</code></strong>
Query OK, 3 rows affected (0.19 sec)
Records: 3  Duplicates: 0  Warnings: 0
</pre><p>
    At this point, on both the master and the slave, table
    <code class="literal">fc1</code> contains 2 rows, and table
    <code class="literal">fc2</code> contains 3 rows, as shown here:
  </p><pre class="programlisting">
master&gt; <strong class="userinput"><code>SELECT * FROM fc1;</code></strong>
+---+------+
| i | j    |
+---+------+
| 1 |    1 |
| 2 |    2 |
+---+------+
2 rows in set (0.00 sec)

master&gt; <strong class="userinput"><code>SELECT * FROM fc2;</code></strong>
+---+------+
| m | n    |
+---+------+
| 1 |    1 |
| 2 |    2 |
| 3 |    1 |
+---+------+
3 rows in set (0.00 sec)

slave&gt; <strong class="userinput"><code>SELECT * FROM fc1;</code></strong>
+---+------+
| i | j    |
+---+------+
| 1 |    1 |
| 2 |    2 |
+---+------+
2 rows in set (0.00 sec)

slave&gt; <strong class="userinput"><code>SELECT * FROM fc2;</code></strong>
+---+------+
| m | n    |
+---+------+
| 1 |    1 |
| 2 |    2 |
| 3 |    1 |
+---+------+
3 rows in set (0.00 sec)
</pre><p>
    Now suppose that you perform the following
    <a class="link" href="sql-syntax.html#delete" title="13.2.2 DELETE Syntax"><code class="literal">DELETE</code></a> statement on the master:
  </p><pre class="programlisting">
master&gt; <strong class="userinput"><code>DELETE FROM fc1 WHERE i=1;</code></strong>
Query OK, 1 row affected (0.09 sec)
</pre><p>
    Due to the cascade, table <code class="literal">fc2</code> on the master now
    contains only 1 row:
  </p><pre class="programlisting">
master&gt; <strong class="userinput"><code>SELECT * FROM fc2;</code></strong>
+---+---+
| m | n |
+---+---+
| 2 | 2 |
+---+---+
1 row in set (0.00 sec)
</pre><p>
    However, the cascade does not propagate on the slave because on the
    slave the <a class="link" href="sql-syntax.html#delete" title="13.2.2 DELETE Syntax"><code class="literal">DELETE</code></a> for
    <code class="literal">fc1</code> deletes no rows from <code class="literal">fc2</code>.
    The slave's copy of <code class="literal">fc2</code> still contains all of the
    rows that were originally inserted:
  </p><pre class="programlisting">
slave&gt; <strong class="userinput"><code>SELECT * FROM fc2;</code></strong>
+---+---+
| m | n |
+---+---+
| 1 | 1 |
| 3 | 1 |
| 2 | 2 |
+---+---+
3 rows in set (0.00 sec)
</pre><p>
    This difference is due to the fact that the cascading deletes are
    handled internally by the <code class="literal">InnoDB</code> storage engine,
    which means that none of the changes are logged.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="innodb-memcached"></a>14.17 InnoDB memcached Plugin</h2>

</div>

</div>

</div>
<div class="toc">
<dl class="toc"><dt><span class="section"><a href="innodb-storage-engine.html#innodb-memcached-benefits">14.17.1 Benefits of the InnoDB memcached Plugin</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-memcached-intro">14.17.2 InnoDB memcached Architecture</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-memcached-setup">14.17.3 Setting Up the InnoDB memcached Plugin</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-memcached-security">14.17.4 Security Considerations for the InnoDB memcached Plugin</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-memcached-developing">14.17.5 Writing Applications for the InnoDB memcached Plugin</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-memcached-replication">14.17.6 The InnoDB memcached Plugin and Replication</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-memcached-internals">14.17.7 InnoDB memcached Plugin Internals</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-memcached-troubleshoot">14.17.8 Troubleshooting the InnoDB memcached Plugin</a></span></dt></dl>
</div>
<a class="indexterm" name="idm140644101376944"></a><p>
    The <code class="literal">InnoDB</code> <span class="command"><strong>memcached</strong></span> plugin
    (<code class="literal">daemon_memcached</code>) provides an integrated
    <span class="command"><strong>memcached</strong></span> daemon that automatically stores and
    retrieves data from <code class="literal">InnoDB</code> tables, turning the
    MySQL server into a fast <span class="quote">“<span class="quote">key-value store</span>”</span>. Instead of
    formulating queries in SQL, you can use simple
    <code class="literal">get</code>, <code class="literal">set</code>, and
    <code class="literal">incr</code> operations that avoid the performance
    overhead associated with SQL parsing and constructing a query
    optimization plan. You can also access the same
    <code class="literal">InnoDB</code> tables through SQL for convenience,
    complex queries, bulk operations, and other strengths of traditional
    database software.
  </p><p>
    This <span class="quote">“<span class="quote">NoSQL-style</span>”</span> interface uses the
    <span class="command"><strong>memcached</strong></span> API to speed up database operations,
    letting <code class="literal">InnoDB</code> handle memory caching using its
    <a class="link" href="glossary.html#glos_buffer_pool" title="buffer pool">buffer pool</a> mechanism. Data
    modified through <span class="command"><strong>memcached</strong></span> operations such as
    <code class="literal">add</code>, <code class="literal">set</code>, and
    <code class="literal">incr</code> are stored to disk, in
    <code class="literal">InnoDB</code> tables. The combination of
    <span class="command"><strong>memcached</strong></span> simplicity and
    <code class="literal">InnoDB</code> reliability and consistency provides users
    with the best of both worlds, as explained in
    <a class="xref" href="innodb-storage-engine.html#innodb-memcached-benefits" title="14.17.1 Benefits of the InnoDB memcached Plugin">Section 14.17.1, “Benefits of the InnoDB memcached Plugin”</a>. For an architectural
    overview, see <a class="xref" href="innodb-storage-engine.html#innodb-memcached-intro" title="14.17.2 InnoDB memcached Architecture">Section 14.17.2, “InnoDB memcached Architecture”</a>.
</p>
<div class="section">

<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="innodb-memcached-benefits"></a>14.17.1 Benefits of the InnoDB memcached Plugin</h3>
</div>
</div>
</div>
<p>
      This section outlines advantages the
      <code class="literal">daemon_memcached</code> plugin. The combination of
      <code class="literal">InnoDB</code> tables and <span class="command"><strong>memcached</strong></span>
      offers advantages over using either by themselves.
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          Direct access to the <code class="literal">InnoDB</code> storage engine
          avoids the parsing and planning overhead of SQL.
        </p></li><li class="listitem"><p>
          Running <span class="command"><strong>memcached</strong></span> in the same process space
          as the MySQL server avoids the network overhead of passing
          requests back and forth.
        </p></li><li class="listitem"><p>
          Data written using the <span class="command"><strong>memcached</strong></span> protocol
          is transparently written to an <code class="literal">InnoDB</code>
          table, without going through the MySQL SQL layer. You can
          control frequency of writes to achieve higher raw performance
          when updating non-critical data.
        </p></li><li class="listitem"><p>
          Data requested through the <span class="command"><strong>memcached</strong></span>
          protocol is transparently queried from an
          <code class="literal">InnoDB</code> table, without going through the
          MySQL SQL layer.
        </p></li><li class="listitem"><p>
          Subsequent requests for the same data is served from the
          <code class="literal">InnoDB</code> buffer pool. The buffer pool handles
          the in-memory caching. You can tune performance of
          data-intensive operations using <code class="literal">InnoDB</code>
          configuration options.
        </p></li><li class="listitem"><p>
          Data can be unstructured or structured, depending on the type
          of application. You can create a new table for data, or use
          existing tables.
        </p></li><li class="listitem"><p>
          <code class="literal">InnoDB</code> can handle composing and decomposing
          multiple column values into a single
          <span class="command"><strong>memcached</strong></span> item value, reducing the amount
          of string parsing and concatenation required in your
          application. For example, you can store the string value
          <code class="literal">2|4|6|8</code> in the <span class="command"><strong>memcached</strong></span>
          cache, and have <code class="literal">InnoDB</code> split the value
          based on a separator character, then store the result in four
          numeric columns.
        </p></li><li class="listitem"><p>
          The transfer between memory and disk is handled automatically,
          simplifying application logic.
        </p></li><li class="listitem"><p>
          Data is stored in a MySQL database to protect against crashes,
          outages, and corruption.
        </p></li><li class="listitem"><p>
          You can access the underlying <code class="literal">InnoDB</code> table
          through SQL for reporting, analysis, ad hoc queries, bulk
          loading, multi-step transactional computations, set operations
          such as union and intersection, and other operations suited to
          the expressiveness and flexibility of SQL.
        </p></li><li class="listitem"><p>
          You can ensure high availability by using the
          <code class="literal">daemon_memcached</code> plugin on a
          <a class="link" href="glossary.html#glos_master_server" title="master server">master server</a> in
          combination with MySQL replication.
</p></li></ul>
</div>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          The integration of <span class="command"><strong>memcached</strong></span> with MySQL
          provides a way to make in-memory data persistent, so you can
          use it for more significant kinds of data. You can use more
          <code class="literal">add</code>, <code class="literal">incr</code>, and similar
          write operations in your application without concern that data
          could be lost. You can stop and start the
          <span class="command"><strong>memcached</strong></span> server without losing updates
          made to cached data. To guard against unexpected outages, you
          can take advantage of <code class="literal">InnoDB</code> crash
          recovery, replication, and backup capabilities.
        </p></li><li class="listitem"><p>
          The way <code class="literal">InnoDB</code> does fast
          <a class="link" href="glossary.html#glos_primary_key" title="primary key">primary key</a> lookups is
          a natural fit for <span class="command"><strong>memcached</strong></span> single-item
          queries. The direct, low-level database access path used by
          the <code class="literal">daemon_memcached</code> plugin is much more
          efficient for key-value lookups than equivalent SQL queries.
        </p></li><li class="listitem"><p>
          The serialization features of <span class="command"><strong>memcached</strong></span>,
          which can turn complex data structures, binary files, or even
          code blocks into storeable strings, offer a simple way to get
          such objects into a database.
        </p></li><li class="listitem"><p>
          Because you can access the underlying data through SQL, you
          can produce reports, search or update across multiple keys,
          and call functions such as <code class="literal">AVG()</code> and
          <code class="literal">MAX()</code> on <span class="command"><strong>memcached</strong></span> data.
          All of these operations are expensive or complicated using
          <span class="command"><strong>memcached</strong></span> by itself.
        </p></li><li class="listitem"><p>
          You do not need to manually load data into
          <span class="command"><strong>memcached</strong></span> at startup. As particular keys
          are requested by an application, values are retrieved from the
          database automatically, and cached in memory using the
          <code class="literal">InnoDB</code>
          <a class="link" href="glossary.html#glos_buffer_pool" title="buffer pool">buffer pool</a>.
        </p></li><li class="listitem"><p>
          Because <span class="command"><strong>memcached</strong></span> consumes relatively
          little CPU, and its memory footprint is easy to control, it
          can run comfortably alongside a MySQL instance on the same
          system.
        </p></li><li class="listitem"><p>
          Because data consistency is enforced by mechanisms used for
          regular <code class="literal">InnoDB</code> tables, you do not have to
          worry about stale <span class="command"><strong>memcached</strong></span> data or
          fallback logic to query the database in the case of a missing
          key.
</p></li></ul>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="innodb-memcached-intro"></a>14.17.2 InnoDB memcached Architecture</h3>

</div>

</div>

</div>
<a class="indexterm" name="idm140644101308032"></a><p>
      The <code class="literal">InnoDB</code> <span class="command"><strong>memcached</strong></span> plugin
      implements <span class="command"><strong>memcached</strong></span> as a MySQL plugin daemon
      that accesses the <code class="literal">InnoDB</code> storage engine
      directly, bypassing the MySQL SQL layer.
    </p><p>
      The following diagram illustrates how an application accesses data
      through the <code class="literal">daemon_memcached</code> plugin, compared
      with SQL.
</p>
<div class="mediaobject">
<img src="images/innodb_memcached2.jpg" width="554" height="414" alt="Architecture Diagram for MySQL Server with Integrated memcached Server">
</div>
<p>
      Features of the <code class="literal">daemon_memcached</code> plugin:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          <span class="command"><strong>memcached</strong></span> as a daemon plugin of
          <a class="link" href="programs.html#mysqld" title="4.3.1 mysqld — The MySQL Server"><span class="command"><strong>mysqld</strong></span></a>. Both <a class="link" href="programs.html#mysqld" title="4.3.1 mysqld — The MySQL Server"><span class="command"><strong>mysqld</strong></span></a> and
          <span class="command"><strong>memcached</strong></span> run in the same process space,
          with very low latency access to data.
        </p></li><li class="listitem"><p>
          Direct access to <code class="literal">InnoDB</code> tables, bypassing
          the SQL parser, the optimizer, and even the Handler API layer.
        </p></li><li class="listitem"><p>
          Standard <span class="command"><strong>memcached</strong></span> protocols, including the
          text-based protocol and the binary protocol. The
          <code class="literal">daemon_memcached</code> plugin passes all 55
          compatibility tests of the <span class="command"><strong>memcapable</strong></span>
          command.
        </p></li><li class="listitem"><p>
          Multi-column support. You can map multiple columns into the
          <span class="quote">“<span class="quote">value</span>”</span> part of the key/value store, with column
          values delimited by a user-specified separator character.
        </p></li><li class="listitem"><p>
          By default, the <span class="command"><strong>memcached</strong></span> protocol is used
          to read and write data directly to <code class="literal">InnoDB</code>,
          letting MySQL manage in-memory caching using the
          <code class="literal">InnoDB</code>
          <a class="link" href="glossary.html#glos_buffer_pool" title="buffer pool">buffer pool</a>. The
          default settings represent a combination of high reliability
          and the fewest surprises for database applications. For
          example, default settings avoid uncommitted data on the
          database side, or stale data returned for
          <span class="command"><strong>memcached</strong></span> <code class="literal">get</code> requests.
        </p></li><li class="listitem"><p>
          Advanced users can configure the system as a traditional
          <span class="command"><strong>memcached</strong></span> server, with all data cached only
          in the <span class="command"><strong>memcached</strong></span> engine (memory caching),
          or use a combination of the
          <span class="quote">“<span class="quote"><span class="command"><strong>memcached</strong></span> engine</span>”</span> (memory
          caching) and the <code class="literal">InnoDB</code>
          <span class="command"><strong>memcached</strong></span> engine (<code class="literal">InnoDB</code>
          as backend persistent storage).
</p></li></ul>
</div>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          Control over how often data is passed back and forth between
          <code class="literal">InnoDB</code> and <span class="command"><strong>memcached</strong></span>
          operations through the
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_api_bk_commit_interval"><code class="literal">innodb_api_bk_commit_interval</code></a>,
          <a class="link" href="innodb-storage-engine.html#sysvar_daemon_memcached_r_batch_size"><code class="literal">daemon_memcached_r_batch_size</code></a>,
          and
          <a class="link" href="innodb-storage-engine.html#sysvar_daemon_memcached_w_batch_size"><code class="literal">daemon_memcached_w_batch_size</code></a>
          configuration options. Batch size options default to a value
          of 1 for maximum reliability.
        </p></li><li class="listitem"><p>
          The ability to specify <span class="command"><strong>memcached</strong></span> options
          through the
          <a class="link" href="innodb-storage-engine.html#sysvar_daemon_memcached_option"><code class="literal">daemon_memcached_option</code></a>
          configuration parameter. For example, you can change the port
          that <span class="command"><strong>memcached</strong></span> listens on, reduce the
          maximum number of simultaneous connections, change the maximum
          memory size for a key/value pair, or enable debugging messages
          for the error log.
        </p></li><li class="listitem"><p>
          The <a class="link" href="innodb-storage-engine.html#sysvar_innodb_api_trx_level"><code class="literal">innodb_api_trx_level</code></a>
          configuration option controls the transaction
          <a class="link" href="glossary.html#glos_isolation_level" title="isolation level">isolation level</a> on
          queries processed by <span class="command"><strong>memcached</strong></span>. Although
          <span class="command"><strong>memcached</strong></span> has no concept of
          <a class="link" href="glossary.html#glos_transaction" title="transaction">transactions</a>, you can
          use this option to control how soon
          <span class="command"><strong>memcached</strong></span> sees changes caused by SQL
          statements issued on the table used by the
          <span class="command"><strong>daemon_memcached</strong></span> plugin. By default,
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_api_trx_level"><code class="literal">innodb_api_trx_level</code></a> is set
          to <a class="link" href="sql-syntax.html#isolevel_read-uncommitted"><code class="literal">READ UNCOMMITTED</code></a>.
        </p></li><li class="listitem"><p>
          The <a class="link" href="innodb-storage-engine.html#sysvar_innodb_api_enable_mdl"><code class="literal">innodb_api_enable_mdl</code></a>
          option can be used to lock the table at the MySQL level, so
          that the mapped table cannot be dropped or altered by
          <a class="link" href="glossary.html#glos_ddl" title="DDL">DDL</a> through the SQL interface.
          Without the lock, the table can be dropped from the MySQL
          layer, but kept in <code class="literal">InnoDB</code> storage until
          <span class="command"><strong>memcached</strong></span> or some other user stops using
          it. <span class="quote">“<span class="quote">MDL</span>”</span> stands for <span class="quote">“<span class="quote">metadata
          locking</span>”</span>.
</p></li></ul>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h4 class="title"><a name="innodb-memcached-compare-contrast"></a>Differences Between InnoDB memcached and Traditional memcached</h4>

</div>

</div>

</div>
<p>
        You may already be familiar with using
        <span class="command"><strong>memcached</strong></span> with MySQL, as described in
        <a class="xref" href="ha-overview.html#ha-memcached" title="16.3 Using MySQL with memcached">Section 16.3, “Using MySQL with <span class="command"><strong>memcached</strong></span>”</a>. This section describes how
        features of the integrated <code class="literal">InnoDB</code>
        <span class="command"><strong>memcached</strong></span> plugin differ from traditional
        <code class="literal">memcached</code>.
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            Installation: The <span class="command"><strong>memcached</strong></span> library comes
            with the MySQL server, making installation and setup
            relatively easy. Installation involves running the
            <code class="filename">innodb_memcached_config.sql</code> script to
            create a <code class="literal">demo_test</code> table for
            <span class="command"><strong>memcached</strong></span> to use, issuing an
            <a class="link" href="sql-syntax.html#install-plugin" title="13.7.3.3 INSTALL PLUGIN Syntax"><code class="literal">INSTALL PLUGIN</code></a> statement to
            enable the <code class="literal">daemon_memcached</code> plugin, and
            adding desired <span class="command"><strong>memcached</strong></span> options to a
            MySQL configuration file or startup script. You might still
            install the traditional <span class="command"><strong>memcached</strong></span>
            distribution for additional utilities such as
            <span class="command"><strong>memcp</strong></span>, <span class="command"><strong>memcat</strong></span>, and
            <span class="command"><strong>memcapable</strong></span>.
          </p><p>
            For comparison with traditional
            <span class="command"><strong>memcached</strong></span>, see
            <a class="xref" href="ha-overview.html#ha-memcached-install" title="16.3.1 Installing memcached">Section 16.3.1, “Installing <span class="command"><strong>memcached</strong></span>”</a>.
          </p></li><li class="listitem"><p>
            Deployment: With traditional <span class="command"><strong>memcached</strong></span>,
            it is typical to run large numbers of low-capacity
            <span class="command"><strong>memcached</strong></span> servers. A typical deployment
            of the <code class="literal">daemon_memcached</code> plugin, however,
            involves a smaller number of moderate or high-powered
            servers that are already running MySQL. The benefit of this
            configuration is in improving efficiency of individual
            database servers rather than exploiting unused memory or
            distributing lookups across large numbers of servers. In the
            default configuration, very little memory is used for
            <span class="command"><strong>memcached</strong></span>, and in-memory lookups are
            served from the <code class="literal">InnoDB</code>
            <a class="link" href="glossary.html#glos_buffer_pool" title="buffer pool">buffer pool</a>, which
            automatically caches the most recently and frequently used
            data. As with a traditional MySQL server instance, keep the
            value of the
            <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_size"><code class="literal">innodb_buffer_pool_size</code></a>
            configuration option as high as practical (without causing
            paging at the OS level), so that as much work as possible is
            performed in memory.
          </p><p>
            For comparison with traditional
            <span class="command"><strong>memcached</strong></span>, see
            <a class="xref" href="ha-overview.html#ha-memcached-using-deployment" title="16.3.2.1 memcached Deployment">Section 16.3.2.1, “<span class="command"><strong>memcached</strong></span> Deployment”</a>.
          </p></li><li class="listitem"><p>
            Expiry: By default (that is, using the
            <code class="literal">innodb_only</code> caching policy), the latest
            data from the <code class="literal">InnoDB</code> table is always
            returned, so the expiry options have no practical effect. If
            you change the caching policy to <code class="literal">caching</code>
            or <code class="literal">cache-only</code>, the expiry options work as
            usual, but requested data might be stale if it is updated in
            the underlying table before it expires from the memory
            cache.
          </p><p>
            For comparison with traditional
            <span class="command"><strong>memcached</strong></span>, see
            <a class="xref" href="ha-overview.html#ha-memcached-using-expiry" title="16.3.2.3 Data Expiry">Section 16.3.2.3, “Data Expiry”</a>.
          </p></li><li class="listitem"><p>
            Namespaces: <span class="command"><strong>memcached</strong></span> is like a large
            directory where you give files elaborate names with prefixes
            and suffixes to keep the files from conflicting. The
            <code class="literal">daemon_memcached</code> plugin lets you use
            similar naming conventions for keys, with one addition. Key
            names in the format
            <code class="literal">@@<em class="replaceable"><code>table_id</code></em>.<em class="replaceable"><code>key</code></em></code>.<em class="replaceable"><code>table_id</code></em>
            are decoded to reference a specific a table, using mapping
            data from the <code class="literal">innodb_memcache.containers</code>
            table. The <em class="replaceable"><code>key</code></em> is looked up in or
            written to the specified table.
          </p><p>
            The <code class="literal">@@</code> notation only works for individual
            calls to <code class="literal">get</code>, <code class="literal">add</code>, and
            <code class="literal">set</code> functions, but not others such as
            <code class="literal">incr</code> or <code class="literal">delete</code>. To
            designate a default table for subsequent
            <span class="command"><strong>memcached</strong></span> operations within a session,
            perform a <code class="literal">get</code> request using the
            <code class="literal">@@</code> notation with a
            <code class="literal"><em class="replaceable"><code>table_id</code></em></code>, but
            without the key portion. For example:
          </p><pre class="programlisting">get @@<em class="replaceable"><code>table_id</code></em></pre><p>
            Subsequent <code class="literal">get</code>, <code class="literal">set</code>,
            <code class="literal">incr</code>, <code class="literal">delete</code>, and
            other operations use the table designated by
            <code class="literal"><em class="replaceable"><code>table_id</code></em></code> in
            the <code class="literal">innodb_memcache.containers.name</code>
            column.
          </p><p>
            For comparison with traditional
            <span class="command"><strong>memcached</strong></span>, see
            <a class="xref" href="ha-overview.html#ha-memcached-using-namespaces" title="16.3.2.2 Using Namespaces">Section 16.3.2.2, “Using Namespaces”</a>.
          </p></li><li class="listitem"><p>
            Hashing and distribution: The default configuration, which
            uses the <code class="literal">innodb_only</code> caching policy, is
            suitable for a traditional deployment configuration where
            all data is available on all servers, such as a set of
            replication slave servers.
          </p><p>
            If you physically divide data, as in a sharded
            configuration, you can split data across several machines
            running the <code class="literal">daemon_memcached</code> plugin, and
            use the traditional <span class="command"><strong>memcached</strong></span> hashing
            mechanism to route requests to a particular machine. On the
            MySQL side, you would typically let all data be inserted by
            <code class="literal">add</code> requests to
            <span class="command"><strong>memcached</strong></span> so that appropriate values are
            stored in the database on the appropriate server.
          </p><p>
            For comparison with traditional
            <span class="command"><strong>memcached</strong></span>, see
            <a class="xref" href="ha-overview.html#ha-memcached-using-hashtypes" title="16.3.2.4 memcached Hashing/Distribution Types">Section 16.3.2.4, “<span class="command"><strong>memcached</strong></span> Hashing/Distribution Types”</a>.
          </p></li><li class="listitem"><p>
            Memory usage: By default (with the
            <code class="literal">innodb_only</code> caching policy), the
            <span class="command"><strong>memcached</strong></span> protocol passes information
            back and forth with <code class="literal">InnoDB</code> tables, and
            the <code class="literal">InnoDB</code> buffer pool handles in-memory
            lookups instead of <span class="command"><strong>memcached</strong></span> memory usage
            growing and shrinking. Relatively little memory is used on
            the <span class="command"><strong>memcached</strong></span> side.
          </p><p>
            If you switch the caching policy to
            <code class="literal">caching</code> or <code class="literal">cache-only</code>,
            the normal rules of <span class="command"><strong>memcached</strong></span> memory
            usage apply. Memory for <span class="command"><strong>memcached</strong></span> data
            values is allocated in terms of <span class="quote">“<span class="quote">slabs</span>”</span>. You
            can control slab size and maximum memory used for
            <span class="command"><strong>memcached</strong></span>.
          </p><p>
            Either way, you can monitor and troubleshoot the
            <code class="literal">daemon_memcached</code> plugin using the
            familiar
            <a class="link" href="ha-overview.html#ha-memcached-stats" title="16.3.4 Getting memcached Statistics">statistics</a> system,
            accessed through the standard protocol, over a
            <span class="command"><strong>telnet</strong></span> session, for example. Extra
            utilities are not included with the
            <code class="literal">daemon_memcached</code> plugin. You can use the
            <a class="link" href="ha-overview.html#ha-memcached-stats-memcached-tool" title="16.3.4.6 Using memcached-tool"><code class="literal">memcached-tool</code>
            script</a> to install a full <span class="command"><strong>memcached</strong></span>
            distribution.
          </p><p>
            For comparison with traditional
            <span class="command"><strong>memcached</strong></span>, see
            <a class="xref" href="ha-overview.html#ha-memcached-using-memory" title="16.3.2.6 Memory Allocation within memcached">Section 16.3.2.6, “Memory Allocation within <span class="command"><strong>memcached</strong></span>”</a>.
          </p></li><li class="listitem"><p>
            Thread usage: MySQL threads and <span class="command"><strong>memcached</strong></span>
            threads co-exist on the same server. Limits imposed on
            threads by the operating system apply to the total number of
            threads.
          </p><p>
            For comparison with traditional
            <span class="command"><strong>memcached</strong></span>, see
            <a class="xref" href="ha-overview.html#ha-memcached-using-threads" title="16.3.2.7 memcached Thread Support">Section 16.3.2.7, “<span class="command"><strong>memcached</strong></span> Thread Support”</a>.
          </p></li><li class="listitem"><p>
            Log usage: Because the <span class="command"><strong>memcached</strong></span> daemon
            is run alongside the MySQL server and writes to
            <code class="literal">stderr</code>, the <code class="literal">-v</code>,
            <code class="literal">-vv</code>, and <code class="literal">-vvv</code> options
            for logging write output to the MySQL
            <a class="link" href="glossary.html#glos_error_log" title="error log">error log</a>.
          </p><p>
            For comparison with traditional
            <span class="command"><strong>memcached</strong></span>, see
            <a class="xref" href="ha-overview.html#ha-memcached-using-logs" title="16.3.2.8 memcached Logs">Section 16.3.2.8, “<span class="command"><strong>memcached</strong></span> Logs”</a>.
          </p></li><li class="listitem"><p>
            <span class="command"><strong>memcached</strong></span> operations: Familiar
            <span class="command"><strong>memcached</strong></span> operations such as
            <code class="literal">get</code>, <code class="literal">set</code>,
            <code class="literal">add</code>, and <code class="literal">delete</code> are
            available. Serialization (that is, the exact string format
            representing complex data structures) depends on the
            language interface.
          </p><p>
            For comparison with traditional
            <span class="command"><strong>memcached</strong></span>, see
            <a class="xref" href="ha-overview.html#ha-memcached-operations" title="16.3.3.1 Basic memcached Operations">Section 16.3.3.1, “Basic <span class="command"><strong>memcached</strong></span> Operations”</a>.
          </p></li><li class="listitem"><p>
            Using <span class="command"><strong>memcached</strong></span> as a MySQL front end:
            This is the primary purpose of the <code class="literal">InnoDB</code>
            <span class="command"><strong>memcached</strong></span> plugin. An integrated
            <span class="command"><strong>memcached</strong></span> daemon improves application
            performance, and having <code class="literal">InnoDB</code> handle
            data transfers between memory and disk simplifies
            application logic.
          </p><p>
            For comparison with traditional
            <span class="command"><strong>memcached</strong></span>, see
            <a class="xref" href="ha-overview.html#ha-memcached-mysql-frontend" title="16.3.3.2 Using memcached as a MySQL Caching Layer">Section 16.3.3.2, “Using <span class="command"><strong>memcached</strong></span> as a MySQL Caching Layer”</a>.
          </p></li><li class="listitem"><p>
            Utilities: The MySQL server includes the
            <code class="literal">libmemcached</code> library but not additional
            command-line utilities. To use commands such as
            <span class="command"><strong>memcp</strong></span>, <span class="command"><strong>memcat</strong></span>, and
            <span class="command"><strong>memcapable</strong></span> commands, install a full
            <span class="command"><strong>memcached</strong></span> distribution. When
            <span class="command"><strong>memrm</strong></span> and <span class="command"><strong>memflush</strong></span>
            remove items from the cache, the items are also removed from
            the underlying <code class="literal">InnoDB</code> table.
          </p><p>
            For comparison with traditional
            <span class="command"><strong>memcached</strong></span>, see
            <a class="xref" href="ha-overview.html#ha-memcached-interfaces-libmemcached-utilities" title="16.3.3.3.6 libmemcached Command-Line Utilities">Section 16.3.3.3.6, “<span class="command"><strong>libmemcached</strong></span> Command-Line Utilities”</a>.
          </p></li><li class="listitem"><p>
            Programming interfaces: You can access the MySQL server
            through the <code class="literal">daemon_memcached</code> plugin using
            all supported languages:
            <a class="link" href="ha-overview.html#ha-memcached-interfaces-libmemcached" title="16.3.3.3 Using libmemcached with C and C++">C and
            C++</a>,
            <a class="link" href="ha-overview.html#ha-memcached-interfaces-java" title="16.3.3.8 Using MySQL and memcached with Java">Java</a>,
            <a class="link" href="ha-overview.html#ha-memcached-interfaces-perl" title="16.3.3.4 Using MySQL and memcached with Perl">Perl</a>,
            <a class="link" href="ha-overview.html#ha-memcached-interfaces-python" title="16.3.3.5 Using MySQL and memcached with Python">Python</a>,
            <a class="link" href="ha-overview.html#ha-memcached-interfaces-php" title="16.3.3.6 Using MySQL and memcached with PHP">PHP</a>, and
            <a class="link" href="ha-overview.html#ha-memcached-interfaces-ruby" title="16.3.3.7 Using MySQL and memcached with Ruby">Ruby</a>.
            Specify the server hostname and port as with a traditional
            <span class="command"><strong>memcached</strong></span> server. By default, the
            <code class="literal">daemon_memcached</code> plugin listens on port
            <code class="literal">11211</code>. You can use both the
            <a class="link" href="ha-overview.html#ha-memcached-interfaces-protocol" title="16.3.3.9 Using the memcached TCP Text Protocol">text and
            binary protocols</a>. You can customize the
            <a class="link" href="ha-overview.html#ha-memcached-interfaces-libmemcached-behaviors" title="16.3.3.3.5 Controlling libmemcached Behaviors">behavior</a>
            of <span class="command"><strong>memcached</strong></span> functions at runtime.
            Serialization (that is, the exact string format representing
            complex data structures) depends on the language interface.
          </p><p>
            For comparison with traditional
            <span class="command"><strong>memcached</strong></span>, see
            <a class="xref" href="ha-overview.html#ha-memcached-interfaces" title="16.3.3 Developing a memcached Application">Section 16.3.3, “Developing a <span class="command"><strong>memcached</strong></span> Application”</a>.
          </p></li><li class="listitem"><p>
            Frequently asked questions: MySQL has an extensive FAQ for
            traditional <span class="command"><strong>memcached</strong></span>. The FAQ is mostly
            applicable, except that using <code class="literal">InnoDB</code>
            tables as a storage medium for <span class="command"><strong>memcached</strong></span>
            data means that you can use <span class="command"><strong>memcached</strong></span> for
            more write-intensive applications than before, rather than
            as a read-only cache.
          </p><p>
            See <a class="xref" href="ha-overview.html#ha-memcached-faq" title="16.3.5 memcached FAQ">Section 16.3.5, “<span class="command"><strong>memcached</strong></span> FAQ”</a>.
</p></li></ul>
</div>

</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="innodb-memcached-setup"></a>14.17.3 Setting Up the InnoDB memcached Plugin</h3>

</div>

</div>

</div>
<p>
      This section describes how to set up the
      <code class="literal">daemon_memcached</code> plugin on a MySQL server.
      Because the <span class="command"><strong>memcached</strong></span> daemon is tightly
      integrated with the MySQL server to avoid network traffic and
      minimize latency, you perform this process on each MySQL instance
      that uses this feature.
</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
        Before setting up the <code class="literal">daemon_memcached</code>
        plugin, consult <a class="xref" href="innodb-storage-engine.html#innodb-memcached-security" title="14.17.4 Security Considerations for the InnoDB memcached Plugin">Section 14.17.4, “Security Considerations for the InnoDB memcached Plugin”</a> to
        understand the security procedures required to prevent
        unauthorized access.
</p>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h4 class="title"><a name="innodb-memcached-prereqs"></a>Prerequisites</h4>

</div>

</div>

</div>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            The <code class="literal">daemon_memcached</code> plugin is only
            supported on Linux, Solaris, and OS X platforms. Other
            operating systems are not supported.
          </p></li><li class="listitem"><p>
            When building MySQL from source, you must build with
            <a class="link" href="installing.html#option_cmake_with_innodb_memcached"><code class="option">-DWITH_INNODB_MEMCACHED=ON</code></a>.
            This build option generates two shared libraries in the
            MySQL plugin directory
            (<a class="link" href="server-administration.html#sysvar_plugin_dir"><code class="literal">plugin_dir</code></a>) that are
            required to run the <code class="literal">daemon_memcached</code>
            plugin:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                <code class="filename">libmemcached.so</code>: the
                <span class="command"><strong>memcached</strong></span> daemon plugin to MySQL.
              </p></li><li class="listitem"><p>
                <code class="filename">innodb_engine.so</code>: an
                <code class="literal">InnoDB</code> API plugin to
                <span class="command"><strong>memcached</strong></span>.
</p></li></ul>
</div>
</li><li class="listitem"><p>
            <code class="literal">libevent</code> must be installed.
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                If you did not build MySQL from source, the
                <code class="literal">libevent</code> library is not included in
                your installation. Use the installation method for your
                operating system to install <code class="literal">libevent</code>
                1.4.12 or later. For example, depending on the operating
                system, you might use <code class="literal">apt-get</code>,
                <code class="literal">yum</code>, or <code class="literal">port
                install</code>. For example, on Ubuntu Linux, use:
              </p><pre class="programlisting">sudo apt-get install libevent-dev</pre></li><li class="listitem"><p>
                If you installed MySQL from a source code release,
                <code class="literal">libevent</code> 1.4.12 is bundled with the
                package and is located at the top level of the MySQL
                source code directory. If you use the bundled version of
                <code class="literal">libevent</code>, no action is required. If
                you want to use a local system version of
                <code class="literal">libevent</code>, you must build MySQL with
                the <a class="link" href="installing.html#option_cmake_with_libevent"><code class="option">-DWITH_LIBEVENT</code></a> build
                option set to <code class="literal">system</code> or
                <code class="literal">yes</code>.
</p></li></ul>
</div>
</li></ul>
</div>

</div>

<div class="simplesect">

<div class="titlepage">
<div>

<div class="simple">
<h4 class="title"><a name="innodb-memcached-installing"></a>Installing and Configuring the InnoDB memcached Plugin</h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140644101080320"></a><a class="indexterm" name="idm140644101079280"></a><a class="indexterm" name="idm140644101078208"></a>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p>
            Configure the <code class="literal">daemon_memcached</code> plugin so
            it can interact with <code class="literal">InnoDB</code> tables by
            running the <code class="filename">innodb_memcached_config.sql</code>
            configuration script, which is located in
            <code class="filename"><em class="replaceable"><code>MYSQL_HOME</code></em>/share</code>.
            This script installs the <code class="literal">innodb_memcache</code>
            database with three required tables
            (<code class="literal">cache_policies</code>,
            <code class="literal">config_options</code>, and
            <code class="literal">containers</code>). It also installs the
            <code class="literal">demo_test</code> sample table in the
            <code class="literal">test</code> database.
          </p><pre class="programlisting">
mysql&gt; <strong class="userinput"><code>source <em class="replaceable"><code>MYSQL_HOME</code></em>/share/innodb_memcached_config.sql</code></strong>
</pre><p>
            Running the <code class="filename">innodb_memcached_config.sql</code>
            script is a one-time operation. The tables remain in place
            if you later uninstall and re-install the
            <code class="literal">daemon_memcached</code> plugin.
          </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>USE innodb_memcache;</code></strong>
mysql&gt; <strong class="userinput"><code>SHOW TABLES;</code></strong>
+---------------------------+
| Tables_in_innodb_memcache |
+---------------------------+
| cache_policies            |
| config_options            |
| containers                |
+---------------------------+

mysql&gt; <strong class="userinput"><code>USE test;</code></strong>
mysql&gt; <strong class="userinput"><code>SHOW TABLES;</code></strong>
+----------------+
| Tables_in_test |
+----------------+
| demo_test      |
+----------------+</pre><p>
            Of these tables, the
            <code class="literal">innodb_memcache.containers</code> table is the
            most important. Entries in the <code class="literal">containers</code>
            table provide a mapping to <code class="literal">InnoDB</code> table
            columns. Each <code class="literal">InnoDB</code> table used with the
            <code class="literal">daemon_memcached</code> plugin requires an entry
            in the <code class="literal">containers</code> table.
          </p><p>
            The <code class="filename">innodb_memcached_config.sql</code> script
            inserts a single entry in the <code class="literal">containers</code>
            table that provides a mapping for the
            <code class="literal">demo_test</code> table. It also inserts a single
            row of data into the <code class="literal">demo_test</code> table.
            This data allows you to immediately verify the installation
            after the setup is completed.
          </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT * FROM innodb_memcache.containers\G</code></strong>
*************************** 1. row ***************************
                  name: aaa
             db_schema: test
              db_table: demo_test
           key_columns: c1
         value_columns: c2
                 flags: c3
            cas_column: c4
    expire_time_column: c5
unique_idx_name_on_key: PRIMARY

mysql&gt; <strong class="userinput"><code>SELECT * FROM test.demo_test;</code></strong>
+----+------------------+------+------+------+
| c1 | c2               | c3   | c4   | c5   |
+----+------------------+------+------+------+
| AA | HELLO, HELLO     |    8 |    0 |    0 |
+----+------------------+------+------+------+
</pre><p>
            For more information about
            <code class="literal">innodb_memcache</code> tables and the
            <code class="literal">demo_test</code> sample table, see
            <a class="xref" href="innodb-storage-engine.html#innodb-memcached-internals" title="14.17.7 InnoDB memcached Plugin Internals">Section 14.17.7, “InnoDB memcached Plugin Internals”</a>.
          </p></li><li class="listitem"><p>
            Activate the <code class="literal">daemon_memcached</code> plugin by
            running the <a class="link" href="sql-syntax.html#install-plugin" title="13.7.3.3 INSTALL PLUGIN Syntax"><code class="literal">INSTALL PLUGIN</code></a>
            statement:
          </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>INSTALL PLUGIN daemon_memcached soname "libmemcached.so";</code></strong>
</pre><p>
            Once the plugin is installed, it is automatically activated
            each time the MySQL server is restarted.
</p></li></ol>
</div>

</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h4 class="title"><a name="innodb-memcached-snifftest"></a>Verifying the InnoDB and memcached Setup</h4>

</div>

</div>

</div>
<p>
        To verify the <code class="literal">daemon_memcached</code> plugin setup,
        use a <span class="command"><strong>telnet</strong></span> session to issue
        <span class="command"><strong>memcached</strong></span> commands. By default, the
        <span class="command"><strong>memcached</strong></span> daemon listens on port 11211.
</p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p>
            Retrieve data from the <code class="literal">test.demo_test</code>
            table. The single row of data in the
            <code class="literal">demo_test</code> table has a key value of
            <code class="literal">AA</code>.
          </p><pre class="programlisting">
<strong class="userinput"><code>telnet localhost 11211</code></strong>
Trying 127.0.0.1...
Connected to localhost.
Escape character is '^]'.
<strong class="userinput"><code>get AA</code></strong>
VALUE AA 8 12
HELLO, HELLO
END
</pre></li><li class="listitem"><p>
            Insert data using a <code class="literal">set</code> command.
          </p><pre class="programlisting">
<strong class="userinput"><code>set BB 10 0 16</code></strong>
<strong class="userinput"><code>GOODBYE, GOODBYE</code></strong>
STORED
</pre><p>
            where:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
                <code class="literal">set</code> is the command to store a value
              </p></li><li class="listitem"><p>
                <code class="literal">BB</code> is the key
              </p></li><li class="listitem"><p>
                <code class="literal">10</code> is a flag for the operation;
                ignored by <span class="command"><strong>memcached</strong></span> but may be used
                by the client to indicate any type of information;
                specify <code class="literal">0</code> if unused
              </p></li><li class="listitem"><p>
                <code class="literal">0</code> is the expiration time (TTL);
                specify <code class="literal">0</code> if unused
              </p></li><li class="listitem"><p>
                <code class="literal">16</code> is the length of the supplied
                value block in bytes
              </p></li><li class="listitem"><p>
                <code class="literal">GOODBYE, GOODBYE</code> is the value that is
                stored
</p></li></ul>
</div>
</li><li class="listitem"><p>
            Verify that the data inserted is stored in MySQL by
            connecting to the MySQL server and querying the
            <code class="literal">test.demo_test</code> table.
          </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT * FROM test.demo_test;</code></strong>
+----+------------------+------+------+------+
| c1 | c2               | c3   | c4   | c5   |
+----+------------------+------+------+------+
| AA | HELLO, HELLO     |    8 |    0 |    0 |
| BB | GOODBYE, GOODBYE |   10 |    1 |    0 |
+----+------------------+------+------+------+
</pre></li><li class="listitem"><p>
            Return to the telnet session and retrieve the data that you
            inserted earlier using key <code class="literal">BB</code>.
          </p><pre class="programlisting">
<strong class="userinput"><code>get BB</code></strong>
VALUE BB 10 16
GOODBYE, GOODBYE
END
<strong class="userinput"><code>quit</code></strong>
</pre></li></ol>
</div>
<p>
        If you shut down the MySQL server, which also shuts off the
        integrated <span class="command"><strong>memcached</strong></span> server, further attempts
        to access the <span class="command"><strong>memcached</strong></span> data will fail with a
        connection error. Normally, the <span class="command"><strong>memcached</strong></span>
        data also disappears at this point, and you would require
        application logic to load the data back into memory when
        <span class="command"><strong>memcached</strong></span> is restarted. However, the
        <code class="literal">InnoDB</code> <span class="command"><strong>memcached</strong></span> plugin
        automates this process for you.
      </p><p>
        When you restart MySQL, <code class="literal">get</code> operations once
        again return the key/value pairs you stored in the earlier
        <span class="command"><strong>memcached</strong></span> session. When a key is requested
        and the associated value is not already in the memory cache, the
        value is automatically queried from the MySQL
        <code class="literal">test.demo_test</code> table.
</p>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h4 class="title"><a name="innodb-memcached-new-table-setup"></a>Creating a New Table and Column Mapping</h4>

</div>

</div>

</div>
<p>
        This example shows how to setup your own
        <code class="literal">InnoDB</code> table with the
        <code class="literal">daemon_memcached</code> plugin.
</p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p>
            Create an <code class="literal">InnoDB</code> table. The table must
            have a key column with a unique index. The key column of the
            city table is <code class="literal">city_id</code>, which is defined
            as the primary key. The table must also include columns for
            <code class="literal">flags</code>, <code class="literal">cas</code>, and
            <code class="literal">expiry</code> values. There may be one or more
            value columns. The <code class="literal">city</code> table has three
            value columns (<code class="literal">name</code>,
            <code class="literal">state</code>, <code class="literal">country</code>).
</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
              There is no special requirement with respect to column
              names as along as a valid mapping is added to the
              <code class="literal">innodb_memcache.containers</code> table.
</p>
</div>
<pre class="programlisting">mysql&gt; <strong class="userinput"><code>CREATE TABLE city (</code></strong>
    -&gt; <strong class="userinput"><code>city_id VARCHAR(32),</code></strong>
    -&gt; <strong class="userinput"><code>name VARCHAR(1024),</code></strong>
    -&gt; <strong class="userinput"><code>state VARCHAR(1024),</code></strong>
    -&gt; <strong class="userinput"><code>country VARCHAR(1024),</code></strong>
    -&gt; <strong class="userinput"><code>flags INT,</code></strong> 
    -&gt; <strong class="userinput"><code>cas BIGINT UNSIGNED, </code></strong>
    -&gt; <strong class="userinput"><code>expiry INT,</code></strong> 
    -&gt; <strong class="userinput"><code>primary key(city_id)</code></strong>
    -&gt; ) <strong class="userinput"><code>ENGINE=InnoDB;</code></strong></pre></li><li class="listitem"><p>
            Add an entry to the
            <code class="literal">innodb_memcache.containers</code> table so that
            the <code class="literal">daemon_memcached</code> plugin knows how to
            access the <code class="literal">InnoDB</code> table. The entry must
            satisfy the <code class="literal">innodb_memcache.containers</code>
            table definition. For a description of each field, see
            <a class="xref" href="innodb-storage-engine.html#innodb-memcached-internals" title="14.17.7 InnoDB memcached Plugin Internals">Section 14.17.7, “InnoDB memcached Plugin Internals”</a>.
          </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>DESCRIBE innodb_memcache.containers;</code></strong>
+------------------------+--------------+------+-----+---------+-------+
| Field                  | Type         | Null | Key | Default | Extra |
+------------------------+--------------+------+-----+---------+-------+
| name                   | varchar(50)  | NO   | PRI | NULL    |       |
| db_schema              | varchar(250) | NO   |     | NULL    |       |
| db_table               | varchar(250) | NO   |     | NULL    |       |
| key_columns            | varchar(250) | NO   |     | NULL    |       |
| value_columns          | varchar(250) | YES  |     | NULL    |       |
| flags                  | varchar(250) | NO   |     | 0       |       |
| cas_column             | varchar(250) | YES  |     | NULL    |       |
| expire_time_column     | varchar(250) | YES  |     | NULL    |       |
| unique_idx_name_on_key | varchar(250) | NO   |     | NULL    |       |
+------------------------+--------------+------+-----+---------+-------+</pre><p>
            The <code class="literal">innodb_memcache.containers</code> table
            entry for the city table is defined as:
          </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>INSERT INTO `innodb_memcache`.`containers` (</code></strong>
    -&gt; <strong class="userinput"><code>`name`, `db_schema`, `db_table`, `key_columns`, `value_columns`,</code></strong>
    -&gt; <strong class="userinput"><code>`flags`, `cas_column`, `expire_time_column`, `unique_idx_name_on_key`)</code></strong>
    -&gt; <strong class="userinput"><code>VALUES ('default', 'test', 'city', 'city_id', 'name|state|country', </code></strong>
-&gt; <strong class="userinput"><code>'flags','cas','expiry','PRIMARY');</code></strong></pre>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
                <code class="literal">default</code> is specified for the
                <code class="literal">containers.name</code> column to configure
                the <code class="literal">city</code> table as the default
                <code class="literal">InnoDB</code> table to be used with the
                <code class="literal">daemon_memcached</code> plugin.
              </p></li><li class="listitem"><p>
                Multiple <code class="literal">InnoDB</code> table columns
                (<code class="literal">name</code>, <code class="literal">state</code>,
                <code class="literal">country</code>) are mapped to
                <code class="literal">containers.value_columns</code> using a
                <span class="quote">“<span class="quote">|</span>”</span> delimiter.
              </p></li><li class="listitem"><p>
                The <code class="literal">flags</code>,
                <code class="literal">cas_column</code>, and
                <code class="literal">expire_time_column</code> fields of the
                <code class="literal">innodb_memcache.containers</code> table are
                typically not significant in applications using the
                <code class="literal">daemon_memcached</code> plugin. However, a
                designated <code class="literal">InnoDB</code> table column is
                required for each. When inserting data, specify
                <code class="literal">0</code> for these columns if they are
                unused.
</p></li></ul>
</div>
</li><li class="listitem"><p>
            After updating the
            <code class="literal">innodb_memcache.containers</code> table, restart
            the <code class="literal">daemon_memcache</code> plugin to apply the
            changes.
          </p><pre class="programlisting">
mysql&gt; <strong class="userinput"><code>UNINSTALL PLUGIN daemon_memcached;</code></strong>

mysql&gt; <strong class="userinput"><code>INSTALL PLUGIN daemon_memcached soname "libmemcached.so";</code></strong>
</pre></li><li class="listitem"><p>
            Using telnet, insert data into the <code class="literal">city</code>
            table using a <span class="command"><strong>memcached</strong></span>
            <code class="literal">set</code> command.
          </p><pre class="programlisting">
<strong class="userinput"><code>telnet localhost 11211</code></strong>
Trying 127.0.0.1...
Connected to localhost.
Escape character is '^]'.
<strong class="userinput"><code>set B 0 0 22</code></strong>
<strong class="userinput"><code>BANGALORE|BANGALORE|IN</code></strong>
STORED
</pre></li><li class="listitem"><p>
            Using MySQL, query the <code class="literal">test.city</code> table to
            verify that the data you inserted was stored.
          </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT * FROM test.city;</code></strong>
+---------+-----------+-----------+---------+-------+------+--------+
| city_id | name      | state     | country | flags | cas  | expiry |
+---------+-----------+-----------+---------+-------+------+--------+
| B       | BANGALORE | BANGALORE | IN      |     0 |    3 |      0 |
+---------+-----------+-----------+---------+-------+------+--------+
</pre></li><li class="listitem"><p>
            Using MySQL, insert additional data into the
            <code class="literal">test.city</code> table.
          </p><pre class="programlisting">
mysql&gt; <strong class="userinput"><code>INSERT INTO city VALUES ('C','CHENNAI','TAMIL NADU','IN', 0, 0 ,0);</code></strong>
mysql&gt; <strong class="userinput"><code>INSERT INTO city VALUES ('D','DELHI','DELHI','IN', 0, 0, 0);</code></strong>
mysql&gt; <strong class="userinput"><code>INSERT INTO city VALUES ('H','HYDERABAD','TELANGANA','IN', 0, 0, 0);</code></strong>
mysql&gt; <strong class="userinput"><code>INSERT INTO city VALUES ('M','MUMBAI','MAHARASHTRA','IN', 0, 0, 0);</code></strong></pre>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
              It is recommended that you specify a value of
              <code class="literal">0</code> for the <code class="literal">flags</code>,
              <code class="literal">cas_column</code>, and
              <code class="literal">expire_time_column</code> fields if they are
              unused.
</p>
</div>
</li><li class="listitem"><p>
            Using telnet, issue a <span class="command"><strong>memcached</strong></span>
            <code class="literal">get</code> command to retrieve data you inserted
            using MySQL.
          </p><pre class="programlisting">
<strong class="userinput"><code>get H</code></strong>
VALUE H 0 22
HYDERABAD|TELANGANA|IN
END</pre></li></ol>
</div>

</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h4 class="title"><a name="innodb-memcached-configuration"></a>Configuring the InnoDB memcached Plugin</h4>

</div>

</div>

</div>
<p>
        Traditional <code class="literal">memcached</code> configuration options
        may be specified in a MySQL configuration file or a
        <a class="link" href="programs.html#mysqld" title="4.3.1 mysqld — The MySQL Server"><span class="command"><strong>mysqld</strong></span></a> startup string, encoded in the
        argument of the
        <a class="link" href="innodb-storage-engine.html#sysvar_daemon_memcached_option"><code class="literal">daemon_memcached_option</code></a>
        configuration parameter. <code class="literal">memcached</code>
        configuration options take effect when the plugin is loaded,
        which occurs each time the MySQL server is started.
      </p><p>
        For example, to make <span class="command"><strong>memcached</strong></span> listen on port
        11222 instead of the default port 11211, specify
        <code class="literal">-p11222</code> as an argument of the
        <a class="link" href="innodb-storage-engine.html#sysvar_daemon_memcached_option"><code class="literal">daemon_memcached_option</code></a>
        configuration option:
      </p><pre class="programlisting">
mysqld .... --daemon_memcached_option="-p11222"
</pre><p>
        Other <span class="command"><strong>memcached</strong></span> options can be encoded in the
        <a class="link" href="innodb-storage-engine.html#sysvar_daemon_memcached_option"><code class="literal">daemon_memcached_option</code></a> string.
        For example, you can specify options to reduce the maximum
        number of simultaneous connections, change the maximum memory
        size for a key/value pair, or enable debugging messages for the
        error log, and so on.
      </p><p>
        There are also configuration options specific to the
        <code class="literal">daemon_memcached</code> plugin. These include:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <a class="link" href="innodb-storage-engine.html#sysvar_daemon_memcached_engine_lib_name"><code class="literal">daemon_memcached_engine_lib_name</code></a>:
            Specifies the shared library that implements the
            <code class="literal">InnoDB</code> <span class="command"><strong>memcached</strong></span>
            plugin. The default setting is
            <code class="filename">innodb_engine.so</code>.
          </p></li><li class="listitem"><p>
            <a class="link" href="innodb-storage-engine.html#sysvar_daemon_memcached_engine_lib_path"><code class="literal">daemon_memcached_engine_lib_path</code></a>:
            The path of the directory containing the shared library that
            implements the <code class="literal">InnoDB</code>
            <span class="command"><strong>memcached</strong></span> plugin. The default is NULL,
            representing the plugin directory.
          </p></li><li class="listitem"><p>
            <a class="link" href="innodb-storage-engine.html#sysvar_daemon_memcached_r_batch_size"><code class="literal">daemon_memcached_r_batch_size</code></a>:
            Defines the batch commit size for read operations
            (<code class="literal">get</code>). It specifies the number of
            <span class="command"><strong>memcached</strong></span> read operations after which a
            <a class="link" href="glossary.html#glos_commit" title="commit">commit</a> occurs.
            <a class="link" href="innodb-storage-engine.html#sysvar_daemon_memcached_r_batch_size"><code class="literal">daemon_memcached_r_batch_size</code></a>
            is set to 1 by default so that every <code class="literal">get</code>
            request accesses the most recently committed data in the
            <code class="literal">InnoDB</code> table, whether the data was
            updated through <span class="command"><strong>memcached</strong></span> or by SQL. When
            the value is greater than 1, the counter for read operations
            is incremented with each <code class="literal">get</code> call. A
            <code class="literal">flush_all</code> call resets both read and write
            counters.
          </p></li><li class="listitem"><p>
            <a class="link" href="innodb-storage-engine.html#sysvar_daemon_memcached_w_batch_size"><code class="literal">daemon_memcached_w_batch_size</code></a>:
            Defines the batch commit size for write operations
            (<code class="literal">set</code>, <code class="literal">replace</code>,
            <code class="literal">append</code>, <code class="literal">prepend</code>,
            <code class="literal">incr</code>, <code class="literal">decr</code>, and so
            on).
            <a class="link" href="innodb-storage-engine.html#sysvar_daemon_memcached_w_batch_size"><code class="literal">daemon_memcached_w_batch_size</code></a>
            is set to 1 by default so that no uncommitted data is lost
            in case of an outage, and so that SQL queries on the
            underlying table access the most recent data. When the value
            is greater than 1, the counter for write operations is
            incremented for each <code class="literal">add</code>,
            <code class="literal">set</code>, <code class="literal">incr</code>,
            <code class="literal">decr</code>, and <code class="literal">delete</code> call.
            A <code class="literal">flush_all</code> call resets both read and
            write counters.
</p></li></ul>
</div>
<p>
        By default, you do not need to modify
        <a class="link" href="innodb-storage-engine.html#sysvar_daemon_memcached_engine_lib_name"><code class="literal">daemon_memcached_engine_lib_name</code></a>
        or
        <a class="link" href="innodb-storage-engine.html#sysvar_daemon_memcached_engine_lib_path"><code class="literal">daemon_memcached_engine_lib_path</code></a>.
        You might configure these options if, for example, you want to
        use a different storage engine for <span class="command"><strong>memcached</strong></span>
        (such as the NDB <span class="command"><strong>memcached</strong></span> engine).
      </p><p>
        <code class="literal">daemon_memcached</code> plugin configuration
        parameters may be specified in the MySQL configuration file or
        in a <a class="link" href="programs.html#mysqld" title="4.3.1 mysqld — The MySQL Server"><span class="command"><strong>mysqld</strong></span></a> startup string. They take effect
        when you load the <code class="literal">daemon_memcached</code> plugin.
      </p><p>
        When making changes to <code class="literal">daemon_memcached</code>
        plugin configuration, reload the plugin to apply the changes. To
        do so, issue the following statements:
      </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>UNINSTALL PLUGIN daemon_memcached;</code></strong>
  
mysql&gt; <strong class="userinput"><code>INSTALL PLUGIN daemon_memcached soname "libmemcached.so";</code></strong>
</pre><p>
        Configuration settings, required tables, and data are preserved
        when the plugin is restarted.
      </p><p>
        For additional information about enabling and disabling plugins,
        see <a class="xref" href="server-administration.html#server-plugin-loading" title="5.1.8.1 Installing and Uninstalling Plugins">Section 5.1.8.1, “Installing and Uninstalling Plugins”</a>.
</p>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="innodb-memcached-security"></a>14.17.4 Security Considerations for the InnoDB memcached Plugin</h3>

</div>

</div>

</div>
<div class="caution" style="margin-left: 0.5in; margin-right: 0.5in;">
<div class="admon-title">
Caution
</div>
<p>
        Consult this section before deploying the
        <code class="literal">daemon_memcached</code> plugin on a production
        server, or even on a test server if the MySQL instance contains
        sensitive data.
</p>
</div>
<p>
      Because <span class="command"><strong>memcached</strong></span> does not use an
      authentication mechanism by default, and the optional SASL
      authentication is not as strong as traditional DBMS security
      measures, only keep non-sensitive data in the MySQL instance that
      uses the <code class="literal">daemon_memcached</code> plugin, and wall off
      any servers that use this configuration from potential intruders.
      Do not allow <span class="command"><strong>memcached</strong></span> access to these servers
      from the Internet; only allow access from within a firewalled
      intranet, ideally from a subnet whose membership you can restrict.
</p>
<div class="simplesect">

<div class="titlepage">
<div>

<div class="simple">
<h4 class="title"><a name="innodb-memcached-sasl"></a>Password-Protecting memcached Using SASL</h4>
</div>
</div>
</div>
<a class="indexterm" name="idm140644100859872"></a><a class="indexterm" name="idm140644100858832"></a><a class="indexterm" name="idm140644100857728"></a><a class="indexterm" name="idm140644100856224"></a><a class="indexterm" name="idm140644100854720"></a><p>
        SASL support provides the capability to protect your MySQL
        database from unauthenticated access through
        <span class="command"><strong>memcached</strong></span> clients. This section explains how
        to enable SASL with the <code class="literal">daemon_memcached</code>
        plugin. The steps are almost identical to those performed to
        enabled SASL for a traditional <span class="command"><strong>memcached</strong></span>
        server.
      </p><p>
        SASL stands for <span class="quote">“<span class="quote">Simple Authentication and Security
        Layer</span>”</span>, a standard for adding authentication support to
        connection-based protocols. <span class="command"><strong>memcached</strong></span> added
        SASL support in version 1.4.3.
      </p><p>
        SASL authentication is only supported with the binary protocol.
      </p><p>
        <span class="command"><strong>memcached</strong></span> clients are only able to access
        <code class="literal">InnoDB</code> tables that are registered in the
        <code class="literal">innodb_memcache.containers</code> table. Even
        though a DBA can place access restrictions on such tables,
        access through <span class="command"><strong>memcached</strong></span> applications cannot
        be controlled. For this reason, SASL support is provided to
        control access to <code class="literal">InnoDB</code> tables associated
        with the <code class="literal">daemon_memcached</code> plugin.
      </p><p>
        The following section shows how to build, enable, and test an
        SASL-enabled <code class="literal">daemon_memcached</code> plugin.
</p>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h4 class="title"><a name="innodb-memcached-sasl-enabling"></a>Building and Enabling SASL with the InnoDB memcached Plugin</h4>

</div>

</div>

</div>
<p>
        By default, an SASL-enabled <code class="literal">daemon_memcached</code>
        plugin is not included in MySQL release packages, since an
        SASL-enabled <code class="literal">daemon_memcached</code> plugin requires
        building <span class="command"><strong>memcached</strong></span> with SASL libraries. To
        enable SASL support, download the MySQL source and rebuild the
        <code class="literal">daemon_memcached</code> plugin after downloading the
        SASL libraries:
</p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p>
            Install the SASL development and utility libraries. For
            example, on Ubuntu, use <span class="command"><strong>apt-get</strong></span> to obtain
            the libraries:
          </p><pre class="programlisting">
sudo apt-get -f install libsasl2-2 sasl2-bin libsasl2-2 libsasl2-dev libsasl2-modules
</pre></li><li class="listitem"><p>
            Build the <code class="literal">daemon_memcached</code> plugin shared
            libraries with SASL capability by adding
            <code class="literal">ENABLE_MEMCACHED_SASL=1</code> to your
            <span class="command"><strong>cmake</strong></span> options.
            <span class="command"><strong>memcached</strong></span> also provides <span class="emphasis"><em>simple
            cleartext password support</em></span>, which facilitates
            testing. To enable simple cleartext password support,
            specify the <code class="literal">ENABLE_MEMCACHED_SASL_PWDB=1</code>
            <span class="command"><strong>cmake</strong></span> option.
          </p><p>
            In summary, add following three <span class="command"><strong>cmake</strong></span>
            options:
          </p><pre class="programlisting">
cmake ... -DWITH_INNODB_MEMCACHED=1 -DENABLE_MEMCACHED_SASL=1 -DENABLE_MEMCACHED_SASL_PWDB=1
</pre></li><li class="listitem"><p>
            Install the <code class="literal">daemon_memcached</code> plugin, as
            described in <a class="xref" href="innodb-storage-engine.html#innodb-memcached-setup" title="14.17.3 Setting Up the InnoDB memcached Plugin">Section 14.17.3, “Setting Up the InnoDB memcached Plugin”</a>.
          </p></li><li class="listitem"><p>
            Configure a user name and password file. (This example uses
            <span class="command"><strong>memcached</strong></span> simple cleartext password
            support.)
</p>
<div class="orderedlist">
<ol class="orderedlist" type="a"><li class="listitem"><p>
                In a file, create a user named
                <code class="literal">testname</code> and define the password as
                <code class="literal">testpasswd</code>:
              </p><pre class="programlisting">
echo "testname:testpasswd:::::::" &gt;/home/jy/memcached-sasl-db
</pre></li><li class="listitem"><p>
                Configure the <code class="literal">MEMCACHED_SASL_PWDB</code>
                environment variable to inform
                <code class="literal">memcached</code> of the user name and
                password file:
              </p><pre class="programlisting">
export MEMCACHED_SASL_PWDB=/home/jy/memcached-sasl-db
</pre></li><li class="listitem"><p>
                Inform <code class="literal">memcached</code> that a cleartext
                password is used:
              </p><pre class="programlisting">
echo "mech_list: plain" &gt; /home/jy/work2/msasl/clients/memcached.conf
export SASL_CONF_PATH=/home/jy/work2/msasl/clients
</pre></li></ol>
</div>
</li><li class="listitem"><p>
            Enable SASL by restarting the MySQL server with the
            <span class="command"><strong>memcached</strong></span> <code class="literal">-S</code> option
            encoded in the
            <a class="link" href="innodb-storage-engine.html#sysvar_daemon_memcached_option"><code class="literal">daemon_memcached_option</code></a>
            configuration parameter:
          </p><pre class="programlisting">
mysqld ... --daemon_memcached_option="-S"
</pre></li><li class="listitem"><p>
            To test the setup, use an SASL-enabled client such as
            <a class="ulink" href="https://code.launchpad.net/~trond-norbye/libmemcached/sasl" target="_top">SASL-enabled
            libmemcached</a>.
          </p><pre class="programlisting">
memcp --servers=localhost:11211 --binary  --username=testname
  --password=testpasswd myfile.txt

memcat --servers=localhost:11211 --binary --username=testname
  --password=testpasswd myfile.txt
</pre><p>
            If you specify an incorrect user name or password, the
            operation is rejected with a <code class="literal">memcache error
            AUTHENTICATION FAILURE</code> message. In this case,
            examine the cleartext password set in the
            <code class="filename">memcached-sasl-db</code> file to verify that
            the credentials you supplied are correct.
</p></li></ol>
</div>
<p>
        There are other methods to test SASL authentication with
        <span class="command"><strong>memcached</strong></span>, but the method described above is
        the most straightforward.
</p>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="innodb-memcached-developing"></a>14.17.5 Writing Applications for the InnoDB memcached Plugin</h3>

</div>

</div>

</div>
<div class="toc">
<dl class="toc"><dt><span class="section"><a href="innodb-storage-engine.html#innodb-memcached-porting-mysql">14.17.5.1 Adapting an Existing MySQL Schema for the InnoDB memcached Plugin</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-memcached-porting-memcached">14.17.5.2 Adapting a memcached Application for the InnoDB memcached Plugin</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-memcached-tuning">14.17.5.3 Tuning InnoDB memcached Plugin Performance</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-memcached-txn">14.17.5.4 Controlling Transactional Behavior of the InnoDB memcached Plugin</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-memcached-dml">14.17.5.5 Adapting DML Statements to memcached Operations</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-memcached-ddl">14.17.5.6 Performing DML and DDL Statements on the Underlying InnoDB Table</a></span></dt></dl>
</div>
<p>
      Typically, writing an application for the
      <code class="literal">InnoDB</code> <span class="command"><strong>memcached</strong></span> plugin
      involves some degree of rewriting or adapting existing code that
      uses MySQL or the <span class="command"><strong>memcached</strong></span> API.
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          With the <code class="literal">daemon_memcached</code> plugin, instead
          of many traditional <span class="command"><strong>memcached</strong></span> servers
          running on low-powered machines, you will have the same number
          of <span class="command"><strong>memcached</strong></span> servers as MySQL servers,
          running on relatively high-powered machines with substantial
          disk storage and memory. You might reuse some existing code
          that works with the <span class="command"><strong>memcached</strong></span> API, but
          adaptation is likely required due to the different server
          configuration.
        </p></li><li class="listitem"><p>
          The data stored through the
          <code class="literal">daemon_memcached</code> plugin goes into
          <a class="link" href="data-types.html#char" title="11.4.1 The CHAR and VARCHAR Types"><code class="literal">VARCHAR</code></a>,
          <a class="link" href="data-types.html#blob" title="11.4.3 The BLOB and TEXT Types"><code class="literal">TEXT</code></a>, or
          <a class="link" href="data-types.html#blob" title="11.4.3 The BLOB and TEXT Types"><code class="literal">BLOB</code></a> columns, and must be
          converted to do numeric operations. You can perform the
          conversion on the application side, or by using the
          <code class="literal">CAST()</code> function in queries.
        </p></li><li class="listitem"><p>
          Coming from a database background, you might be used to
          general-purpose SQL tables with many columns. The tables
          accessed by <span class="command"><strong>memcached</strong></span> code likely have only
          a few or even a single column holding data values.
        </p></li><li class="listitem"><p>
          You might adapt parts of your application that perform
          single-row queries, inserts, updates, or deletes, to improve
          performance in critical sections of code. Both
          <a class="link" href="glossary.html#glos_query" title="query">queries</a> (read) and
          <a class="link" href="glossary.html#glos_dml" title="DML">DML</a> (write) operations can be
          substantially faster when performed through the
          <code class="literal">InnoDB</code> <span class="command"><strong>memcached</strong></span>
          interface. The performance improvement for writes is typically
          greater than the performance improvement for reads, so you
          might focus on adapting code that performs logging or records
          interactive choices on a web site.
</p></li></ul>
</div>
<p>
      The following sections explore these points in more detail.
</p>
<div class="section">

<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="innodb-memcached-porting-mysql"></a>14.17.5.1 Adapting an Existing MySQL Schema for the InnoDB memcached Plugin</h4>
</div>
</div>
</div>
<p>
        Consider these aspects of <span class="command"><strong>memcached</strong></span>
        applications when adapting an existing MySQL schema or
        application to use the <code class="literal">daemon_memcached</code>
        plugin:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <span class="command"><strong>memcached</strong></span> keys cannot contain spaces or
            newlines, because these characters are used as separators in
            the ASCII protocol. If you are using lookup values that
            contain spaces, transform or hash them into values without
            spaces before using them as keys in calls to
            <code class="literal">add()</code>, <code class="literal">set()</code>,
            <code class="literal">get()</code>, and so on. Although theoretically
            these characters are allowed in keys in programs that use
            the binary protocol, you should restrict the characters used
            in keys to ensure compatibility with a broad range of
            clients.
          </p></li><li class="listitem"><p>
            If there is a short numeric
            <a class="link" href="glossary.html#glos_primary_key" title="primary key">primary key</a> column
            in an <code class="literal">InnoDB</code> table, use it as the unique
            lookup key for <span class="command"><strong>memcached</strong></span> by converting
            the integer to a string value. If the
            <span class="command"><strong>memcached</strong></span> server is used for multiple
            applications, or with more than one
            <code class="literal">InnoDB</code> table, consider modifying the name
            to ensure that it is unique. For example, prepend the table
            name, or the database name and the table name, before the
            numeric value.
</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
              The <code class="literal">daemon_memcached</code> plugin supports
              inserts and reads on mapped <code class="literal">InnoDB</code>
              tables that have an <code class="literal">INTEGER</code> defined as
              the primary key.
</p>
</div>
</li><li class="listitem"><p>
            You cannot use a partitioned table for data queried or
            stored using <span class="command"><strong>memcached</strong></span>.
          </p></li><li class="listitem"><p>
            The <span class="command"><strong>memcached</strong></span> protocol passes numeric
            values around as strings. To store numeric values in the
            underlying <code class="literal">InnoDB</code> table, to implement
            counters that can be used in SQL functions such as
            <code class="literal">SUM()</code> or <code class="literal">AVG()</code>, for
            example:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                Use <a class="link" href="data-types.html#char" title="11.4.1 The CHAR and VARCHAR Types"><code class="literal">VARCHAR</code></a> columns with
                enough characters to hold all the digits of the largest
                expected number (and additional characters if
                appropriate for the negative sign, decimal point, or
                both).
              </p></li><li class="listitem"><p>
                In any query that performs arithmetic using column
                values, use the <code class="literal">CAST()</code> function to
                convert the values from string to integer, or to some
                other numeric type. For example:
              </p><pre class="programlisting">
-- Alphabetic entries are returned as zero.
select cast(c2 as unsigned integer) from demo_test;
-- Since there could be numeric values of 0, can't disqualify them.
-- Test the string values to find the ones that are integers, and average only those.
select avg(cast(c2 as unsigned integer)) from demo_test
  where c2 between '0' and '9999999999';
-- Views let you hide the complexity of queries. The results are already converted;
-- no need to repeat conversion functions and WHERE clauses each time.
create view numbers as select c1 key, cast(c2 as unsigned integer) val
  from demo_test where c2 between '0' and '9999999999';
select sum(val) from numbers;
</pre>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
                  Any alphabetic values in the result set are converted
                  into 0 by the call to <code class="literal">CAST()</code>. When
                  using functions such as <code class="literal">AVG()</code>,
                  which depend on the number of rows in the result set,
                  include <code class="literal">WHERE</code> clauses to filter out
                  non-numeric values.
</p>
</div>
</li></ul>
</div>
</li><li class="listitem"><p>
            If the <code class="literal">InnoDB</code> column used as a key could
            have values longer than 250 bytes, hash the value to less
            than 250 bytes.
          </p></li><li class="listitem"><p>
            To use an existing table with the
            <code class="literal">daemon_memcached</code> plugin, define an entry
            for it in the <code class="literal">innodb_memcache.containers</code>
            table. To make that table the default for all
            <span class="command"><strong>memcached</strong></span> requests, specify a value of
            <code class="literal">default</code> in the <code class="literal">name</code>
            column, then restart the MySQL server to make the change
            take effect. If you use multiple tables for different
            classes of <span class="command"><strong>memcached</strong></span> data, set up
            multiple entries in the
            <code class="literal">innodb_memcache.containers</code> table with
            <code class="literal">name</code> values of your choice, then issue a
            <span class="command"><strong>memcached</strong></span> request in the form of
            <code class="literal">get @@<em class="replaceable"><code>name</code></em></code> or
            <code class="literal">set @@<em class="replaceable"><code>name</code></em></code>
            within the application to specify the table to be used for
            subsequent <span class="command"><strong>memcached</strong></span> requests.
          </p><p>
            For an example of using a table other than the predefined
            <code class="literal">test.demo_test</code> table, see
            <a class="xref" href="innodb-storage-engine.html#innodb-memcached-tutorial-python" title="Example 14.24 Using Your Own Table with an InnoDB memcached Application">Example 14.24, “Using Your Own Table with an InnoDB memcached Application”</a>. For the
            required table layout, see
            <a class="xref" href="innodb-storage-engine.html#innodb-memcached-internals" title="14.17.7 InnoDB memcached Plugin Internals">Section 14.17.7, “InnoDB memcached Plugin Internals”</a>.
          </p></li><li class="listitem"><p>
            To use multiple <code class="literal">InnoDB</code> table column
            values with <span class="command"><strong>memcached</strong></span> key/value pairs,
            specify column names separated by comma, semicolon, space,
            or pipe characters in the <code class="literal">value_columns</code>
            field of the <code class="literal">innodb_memcache.containers</code>
            entry for the <code class="literal">InnoDB</code> table. For example,
            specify <code class="literal">col1,col2,col3</code> or
            <code class="literal">col1|col2|col3</code> in the
            <code class="literal">value_columns</code> field.
          </p><p>
            Concatenate the column values into a single string using the
            pipe character as a separator before passing the string to
            <span class="command"><strong>memcached</strong></span> <code class="literal">add</code> or
            <code class="literal">set</code> calls. The string is unpacked
            automatically into the correct column. Each
            <code class="literal">get</code> call returns a single string
            containing the column values that is also delimited by the
            pipe character. You can unpack the values using the
            appropriate application language syntax.
</p></li></ul>
</div>

<div class="example">
<a name="innodb-memcached-tutorial-python"></a><p class="title"><b>Example 14.24 Using Your Own Table with an InnoDB memcached Application</b></p>
<div class="example-contents">
<p>
          This example shows how to use your own table with a sample
          Python application that uses <code class="literal">memcached</code> for
          data manipulation.
        </p><p>
          The example assumes that the
          <code class="literal">daemon_memcached</code> plugin is installed as
          described in <a class="xref" href="innodb-storage-engine.html#innodb-memcached-setup" title="14.17.3 Setting Up the InnoDB memcached Plugin">Section 14.17.3, “Setting Up the InnoDB memcached Plugin”</a>. It also
          assumes that your system is configured to run a Python script
          that uses the <code class="literal">python-memcache</code> module.
</p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p>
              Create the <code class="literal">multicol</code> table which stores
              country information including population, area, and driver
              side data (<code class="literal">'R'</code> for right and
              <code class="literal">'L'</code> for left).
            </p><pre class="programlisting">
mysql&gt; <strong class="userinput"><code>USE test;</code></strong>

mysql&gt; <strong class="userinput"><code>CREATE TABLE `multicol` (</code></strong>
    -&gt;  <strong class="userinput"><code>`country` varchar(128) NOT NULL DEFAULT '',</code></strong>
    -&gt;  <strong class="userinput"><code>`population` varchar(10) DEFAULT NULL,</code></strong>
    -&gt; <strong class="userinput"><code> `area_sq_km` varchar(9) DEFAULT NULL,</code></strong>
    -&gt;  <strong class="userinput"><code>`drive_side` varchar(1) DEFAULT NULL,</code></strong>
    -&gt;  <strong class="userinput"><code>`c3` int(11) DEFAULT NULL,</code></strong>
    -&gt;  <strong class="userinput"><code>`c4` bigint(20) unsigned DEFAULT NULL,</code></strong>
    -&gt;  <strong class="userinput"><code>`c5` int(11) DEFAULT NULL,</code></strong>
    -&gt;  <strong class="userinput"><code>PRIMARY KEY (`country`)</code></strong>
    -&gt;<strong class="userinput"><code>  ) ENGINE=InnoDB DEFAULT CHARSET=latin1;</code></strong>
</pre></li><li class="listitem"><p>
              Insert a record into the
              <code class="literal">innodb_memcache.containers</code> table so
              that the <code class="literal">daemon_memcached</code> plugin can
              access the <code class="literal">multicol</code> table.
            </p><pre class="programlisting">
mysql&gt; <strong class="userinput"><code>INSERT INTO innodb_memcache.containers</code></strong>
    -&gt;  <strong class="userinput"><code>(name,db_schema,db_table,key_columns,value_columns,flags,cas_column,</code></strong>
    -&gt;   <strong class="userinput"><code>expire_time_column,unique_idx_name_on_key)</code></strong>
    -&gt; <strong class="userinput"><code>VALUES</code></strong>
    -&gt;  <strong class="userinput"><code>('bbb','test','multicol','country','population,area_sq_km,drive_side',</code></strong>
    -&gt;   <strong class="userinput"><code>'c3','c4','c5','PRIMARY');</code></strong>

mysql&gt; <strong class="userinput"><code>COMMIT;</code></strong>
</pre>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
                  The <code class="literal">innodb_memcache.containers</code>
                  record for the <code class="literal">multicol</code> table
                  specifies a <code class="literal">name</code> value of
                  <code class="literal">'bbb'</code>, which is the table
                  identifier.
</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
                    If a single <code class="literal">InnoDB</code> table is used
                    for all <span class="command"><strong>memcached</strong></span> applications,
                    the <code class="literal">name</code> value can be set to
                    <code class="literal">default</code> to avoid using
                    <code class="literal">@@</code> notation to switch tables.
</p>
</div>
</li><li class="listitem"><p>
                  The <code class="literal">db_schema</code> column is set to
                  <code class="literal">test</code>, which is the name of the
                  database where the <code class="literal">multicol</code> table
                  resides.
                </p></li><li class="listitem"><p>
                  The <code class="literal">db_table</code> column is set to
                  <code class="literal">multicol</code>, which is the name of the
                  <code class="literal">InnoDB</code> table.
                </p></li><li class="listitem"><p>
                  <code class="literal">key_columns</code> is set to the unique
                  <code class="literal">country</code> column. The
                  <code class="literal">country</code> column is defined as the
                  primary key in the <code class="literal">multicol</code> table
                  definition.
                </p></li><li class="listitem"><p>
                  Rather than a single <code class="literal">InnoDB</code> table
                  column to hold a composite data value, data is divided
                  among three table columns
                  (<code class="literal">population</code>,
                  <code class="literal">area_sq_km</code>, and
                  <code class="literal">drive_side</code>). To accommodate
                  multiple value columns, a comma-separated list of
                  columns is specified in the
                  <code class="literal">value_columns</code> field. The columns
                  defined in the <code class="literal">value_columns</code> field
                  are the columns used when storing or retrieving
                  values.
                </p></li><li class="listitem"><p>
                  Values for the <code class="literal">flags</code>,
                  <code class="literal">expire_time</code>, and
                  <code class="literal">cas_column</code> fields are based on
                  values used in the <code class="literal">demo.test</code> sample
                  table. These fields are typically not significant in
                  applications that use the
                  <code class="literal">daemon_memcached</code> plugin because
                  MySQL keeps data synchronized, and there is no need to
                  worry about data expiring or becoming stale.
                </p></li><li class="listitem"><p>
                  The <code class="literal">unique_idx_name_on_key</code> field is
                  set to <code class="literal">PRIMARY</code>, which refers to the
                  primary index defined on the unique
                  <code class="literal">country</code> column in the
                  <code class="literal">multicol</code> table.
</p></li></ul>
</div>
</li><li class="listitem"><p>
              Copy the sample Python application into a file. In this
              example, the sample script is copied to a file named
              <code class="filename">multicol.py</code>.
            </p><p>
              The sample Python application inserts data into the
              <code class="literal">multicol</code> table and retrieves data for
              all keys, demonstrating how to access an
              <code class="literal">InnoDB</code> table through the
              <code class="literal">daemon_memcached</code> plugin.
            </p><pre class="programlisting">
import sys, os
import memcache

def connect_to_memcached():
  memc = memcache.Client(['127.0.0.1:11211'], debug=0);
  print "Connected to memcached."
  return memc

def banner(message):
  print
  print "=" * len(message)
  print message
  print "=" * len(message)

country_data = [
("Canada","34820000","9984670","R"),
("USA","314242000","9826675","R"),
("Ireland","6399152","84421","L"),
("UK","62262000","243610","L"),
("Mexico","113910608","1972550","R"),
("Denmark","5543453","43094","R"),
("Norway","5002942","385252","R"),
("UAE","8264070","83600","R"),
("India","1210193422","3287263","L"),
("China","1347350000","9640821","R"),
]

def switch_table(memc,table):
  key = "@@" + table
  print "Switching default table to '" + table + "' by issuing GET for '" + key + "'."
  result = memc.get(key)

def insert_country_data(memc):
  banner("Inserting initial data via memcached interface")
  for item in country_data:
    country = item[0]
    population = item[1]
    area = item[2]
    drive_side = item[3]

    key = country
    value = "|".join([population,area,drive_side])
    print "Key = " + key
    print "Value = " + value

    if memc.add(key,value):
      print "Added new key, value pair."
    else:
      print "Updating value for existing key."
      memc.set(key,value)

def query_country_data(memc):
  banner("Retrieving data for all keys (country names)")
  for item in country_data:
    key = item[0]
    result = memc.get(key)
    print "Here is the result retrieved from the database for key " + key + ":"
    print result
    (m_population, m_area, m_drive_side) = result.split("|")
    print "Unpacked population value: " + m_population
    print "Unpacked area value      : " + m_area
    print "Unpacked drive side value: " + m_drive_side

if __name__ == '__main__':

  memc = connect_to_memcached()
  switch_table(memc,"bbb")
  insert_country_data(memc)
  query_country_data(memc)

  sys.exit(0)
</pre><p>
              Sample Python application notes:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
                  No database authorization is required to run the
                  application, since data manipulation is performed
                  through the <span class="command"><strong>memcached</strong></span> interface.
                  The only required information is the port number on
                  the local system where the
                  <span class="command"><strong>memcached</strong></span> daemon listens.
                </p></li><li class="listitem"><p>
                  To make sure the application uses the
                  <code class="literal">multicol</code> table, the
                  <code class="literal">switch_table()</code> function is called,
                  which performs a dummy <code class="literal">get</code> or
                  <code class="literal">set</code> request using
                  <code class="literal">@@</code> notation. The
                  <code class="literal">name</code> value in the request is
                  <code class="literal">bbb</code>, which is the
                  <code class="literal">multicol</code> table identifier defined
                  in the
                  <code class="literal">innodb_memcache.containers.name</code>
                  field.
                </p><p>
                  A more descriptive <code class="literal">name</code> value might
                  be used in a real-world application. This example
                  simply illustrates that a table identifier is
                  specified rather than the table name in <code class="literal">get
                  @@...</code> requests.
                </p></li><li class="listitem"><p>
                  The utility functions used to insert and query data
                  demonstrate how to turn a Python data structure into
                  pipe-separated values for sending data to MySQL with
                  <code class="literal">add</code> or <code class="literal">set</code>
                  requests, and how to unpack the pipe-separated values
                  returned by <code class="literal">get</code> requests. This
                  extra processing is only required when mapping a
                  single <span class="command"><strong>memcached</strong></span> value to multiple
                  MySQL table columns.
</p></li></ul>
</div>
</li><li class="listitem"><p>
              Run the sample Python application.
            </p><pre class="programlisting">shell&gt; <strong class="userinput"><code>python multicol.py</code></strong></pre><p>
              If successful, the sample application returns this output:
            </p><pre class="programlisting">Connected to memcached.
Switching default table to 'bbb' by issuing GET for '@@bbb'.

==============================================
Inserting initial data via memcached interface
==============================================
Key = Canada
Value = 34820000|9984670|R
Added new key, value pair.
Key = USA
Value = 314242000|9826675|R
Added new key, value pair.
Key = Ireland
Value = 6399152|84421|L
Added new key, value pair.
Key = UK
Value = 62262000|243610|L
Added new key, value pair.
Key = Mexico
Value = 113910608|1972550|R
Added new key, value pair.
Key = Denmark
Value = 5543453|43094|R
Added new key, value pair.
Key = Norway
Value = 5002942|385252|R
Added new key, value pair.
Key = UAE
Value = 8264070|83600|R
Added new key, value pair.
Key = India
Value = 1210193422|3287263|L
Added new key, value pair.
Key = China
Value = 1347350000|9640821|R
Added new key, value pair.

============================================
Retrieving data for all keys (country names)
============================================
Here is the result retrieved from the database for key Canada:
34820000|9984670|R
Unpacked population value: 34820000
Unpacked area value      : 9984670
Unpacked drive side value: R
Here is the result retrieved from the database for key USA:
314242000|9826675|R
Unpacked population value: 314242000
Unpacked area value      : 9826675
Unpacked drive side value: R
Here is the result retrieved from the database for key Ireland:
6399152|84421|L
Unpacked population value: 6399152
Unpacked area value      : 84421
Unpacked drive side value: L
Here is the result retrieved from the database for key UK:
62262000|243610|L
Unpacked population value: 62262000
Unpacked area value      : 243610
Unpacked drive side value: L
Here is the result retrieved from the database for key Mexico:
113910608|1972550|R
Unpacked population value: 113910608
Unpacked area value      : 1972550
Unpacked drive side value: R
Here is the result retrieved from the database for key Denmark:
5543453|43094|R
Unpacked population value: 5543453
Unpacked area value      : 43094
Unpacked drive side value: R
Here is the result retrieved from the database for key Norway:
5002942|385252|R
Unpacked population value: 5002942
Unpacked area value      : 385252
Unpacked drive side value: R
Here is the result retrieved from the database for key UAE:
8264070|83600|R
Unpacked population value: 8264070
Unpacked area value      : 83600
Unpacked drive side value: R
Here is the result retrieved from the database for key India:
1210193422|3287263|L
Unpacked population value: 1210193422
Unpacked area value      : 3287263
Unpacked drive side value: L
Here is the result retrieved from the database for key China:
1347350000|9640821|R
Unpacked population value: 1347350000
Unpacked area value      : 9640821
Unpacked drive side value: R
dtprice@ubuntu:~$</pre></li><li class="listitem"><p>
              Query the <code class="literal">innodb_memcache.containers</code>
              table to view the record you inserted earlier for the
              <code class="literal">multicol</code> table. The first record is the
              sample entry for the <code class="literal">demo_test</code> table
              that is created during the initial
              <code class="literal">daemon_memcached</code> plugin setup. The
              second record is the entry you inserted for the
              <code class="literal">multicol</code> table.
            </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT * FROM innodb_memcache.containers\G</code></strong>
*************************** 1. row ***************************
                  name: aaa
             db_schema: test
              db_table: demo_test
           key_columns: c1
         value_columns: c2
                 flags: c3
            cas_column: c4
    expire_time_column: c5
unique_idx_name_on_key: PRIMARY
*************************** 2. row ***************************
                  name: bbb
             db_schema: test
              db_table: multicol
           key_columns: country
         value_columns: population,area_sq_km,drive_side
                 flags: c3
            cas_column: c4
    expire_time_column: c5
unique_idx_name_on_key: PRIMARY</pre></li><li class="listitem"><p>
              Query the <code class="literal">multicol</code> table to view data
              inserted by the sample Python application. The data is
              available for MySQL
              <a class="link" href="glossary.html#glos_query" title="query">queries</a>, which
              demonstrates how the same data can be accessed using SQL
              or through applications (using the appropriate
              <a class="link" href="connectors-apis.html" title="Chapter 24 Connectors and APIs">MySQL Connector or
              API</a>).
            </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT * FROM test.multicol;</code></strong>
+---------+------------+------------+------------+------+------+------+
| country | population | area_sq_km | drive_side | c3   | c4   | c5   |
+---------+------------+------------+------------+------+------+------+
| Canada  | 34820000   | 9984670    | R          |    0 |   11 |    0 |
| China   | 1347350000 | 9640821    | R          |    0 |   20 |    0 |
| Denmark | 5543453    | 43094      | R          |    0 |   16 |    0 |
| India   | 1210193422 | 3287263    | L          |    0 |   19 |    0 |
| Ireland | 6399152    | 84421      | L          |    0 |   13 |    0 |
| Mexico  | 113910608  | 1972550    | R          |    0 |   15 |    0 |
| Norway  | 5002942    | 385252     | R          |    0 |   17 |    0 |
| UAE     | 8264070    | 83600      | R          |    0 |   18 |    0 |
| UK      | 62262000   | 243610     | L          |    0 |   14 |    0 |
| USA     | 314242000  | 9826675    | R          |    0 |   12 |    0 |
+---------+------------+------------+------------+------+------+------+</pre>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
                Always allow sufficient size to hold necessary digits,
                decimal points, sign characters, leading zeros, and so
                on when defining the length for columns that are treated
                as numbers. Too-long values in a string column such as a
                <code class="literal">VARCHAR</code> are truncated by removing
                some characters, which could produce nonsensical numeric
                values.
</p>
</div>
</li><li class="listitem"><p>
              Optionally, run report-type queries on the
              <code class="literal">InnoDB</code> table that stores the
              <span class="command"><strong>memcached</strong></span> data.
            </p><p>
              You can produce reports through SQL queries, performing
              calculations and tests across any columns, not just the
              <code class="literal">country</code> key column. (Because the
              following examples use data from only a few countries, the
              numbers are for illustration purposes only.) The following
              queries return the average population of countries where
              people drive on the right, and the average size of
              countries whose names start with <span class="quote">“<span class="quote">U</span>”</span>:
            </p><pre class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT AVG(population) FROM multicol WHERE drive_side = 'R';</code></strong>
+-------------------+
| avg(population)   |
+-------------------+
| 261304724.7142857 |
+-------------------+

mysql&gt; <strong class="userinput"><code>SELECT SUM(area_sq_km) FROM multicol WHERE country LIKE 'U%';</code></strong>
+-----------------+
| sum(area_sq_km) |
+-----------------+
|        10153885 |
+-----------------+
</pre><p>
              Because the <code class="literal">population</code> and
              <code class="literal">area_sq_km</code> columns store character data
              rather than strongly typed numeric data, functions such as
              <code class="literal">AVG()</code> and <code class="literal">SUM()</code> work
              by converting each value to a number first. This approach
              <span class="emphasis"><em>does not work</em></span> for operators such as
              <code class="literal">&lt;</code> or <code class="literal">&gt;</code>, for
              example, when comparing character-based values, <code class="literal">9
              &gt; 1000</code>, which is not expected from a clause
              such as <code class="literal">ORDER BY population DESC</code>. For
              the most accurate type treatment, perform queries against
              views that cast numeric columns to the appropriate types.
              This technique lets you issue simple <code class="literal">SELECT
              *</code> queries from database applications, while
              ensuring that casting, filtering, and ordering is correct.
              The following example shows a view that can be queried to
              find the top three countries in descending order of
              population, with the results reflecting the latest data in
              the <code class="literal">multicol</code> table, and with population
              and area figures treated as numbers:
            </p><pre class="programlisting">
mysql&gt; <strong class="userinput"><code>CREATE VIEW populous_countries AS</code></strong>
    -&gt; <strong class="userinput"><code>SELECT</code></strong>
    -&gt;    <strong class="userinput"><code>country,</code></strong>
    -&gt;    <strong class="userinput"><code>cast(population as unsigned integer) population,</code></strong>
    -&gt;    <strong class="userinput"><code>cast(area_sq_km as unsigned integer) area_sq_km,</code></strong>
    -&gt;    <strong class="userinput"><code>drive_side FROM multicol</code></strong>
    -&gt;  <strong class="userinput"><code>ORDER BY CAST(population as unsigned integer) DESC</code></strong>
    -&gt;  <strong class="userinput"><code>LIMIT 3;</code></strong>

mysql&gt; <strong class="userinput"><code>SELECT * FROM populous_countries;</code></strong>
+---------+------------+------------+------------+
| country | population | area_sq_km | drive_side |
+---------+------------+------------+------------+
| China   | 1347350000 |    9640821 | R          |
| India   | 1210193422 |    3287263 | L          |
| USA     |  314242000 |    9826675 | R          |
+---------+------------+------------+------------+

mysql&gt; <strong class="userinput"><code>DESC populous_countries;</code></strong>
+------------+---------------------+------+-----+---------+-------+
| Field      | Type                | Null | Key | Default | Extra |
+------------+---------------------+------+-----+---------+-------+
| country    | varchar(128)        | NO   |     |         |       |
| population | bigint(10) unsigned | YES  |     | NULL    |       |
| area_sq_km | int(9) unsigned     | YES  |     | NULL    |       |
| drive_side | varchar(1)          | YES  |     | NULL    |       |
+------------+---------------------+------+-----+---------+-------+
</pre></li></ol>
</div>

</div>

</div>
<br class="example-break">
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="innodb-memcached-porting-memcached"></a>14.17.5.2 Adapting a memcached Application for the InnoDB memcached Plugin</h4>

</div>

</div>

</div>
<p>
        Consider these aspects of MySQL and <code class="literal">InnoDB</code>
        tables when adapting existing <span class="command"><strong>memcached</strong></span>
        applications to use the <code class="literal">daemon_memcached</code>
        plugin:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            If there are key values longer than a few bytes, it may be
            more efficient to use a numeric auto-increment column as the
            <a class="link" href="glossary.html#glos_primary_key" title="primary key">primary key</a> of the
            <code class="literal">InnoDB</code> table, and to create a unique
            <a class="link" href="glossary.html#glos_secondary_index" title="secondary index">secondary index</a>
            on the column that contains the <span class="command"><strong>memcached</strong></span>
            key values. This is because <code class="literal">InnoDB</code>
            performs best for large-scale insertions if primary key
            values are added in sorted order (as they are with
            auto-increment values). Primary key values are included in
            secondary indexes, which takes up unnecessary space if the
            primary key is a long string value.
          </p></li><li class="listitem"><p>
            If you store several different classes of information using
            <span class="command"><strong>memcached</strong></span>, consider setting up a separate
            <code class="literal">InnoDB</code> table for each type of data.
            Define additional table identifiers in the
            <code class="literal">innodb_memcache.containers</code> table, and use
            the
            <code class="literal">@@<em class="replaceable"><code>table_id</code></em>.<em class="replaceable"><code>key</code></em></code>
            notation to store and retrieve items from different tables.
            Physically dividing different types of information allows
            you tune the characteristics of each table for optimum space
            utilization, performance, and reliability. For example, you
            might enable
            <a class="link" href="glossary.html#glos_compression" title="compression">compression</a> for a
            table that holds blog posts, but not for a table that holds
            thumbnail images. You might back up one table more
            frequently than another because it holds critical data. You
            might create additional
            <a class="link" href="glossary.html#glos_secondary_index" title="secondary index">secondary
            indexes</a> on tables that are frequently used to
            generate reports using SQL.
          </p></li><li class="listitem"><p>
            Preferably, configure a stable set of table definitions for
            use with the <span class="command"><strong>daemon_memcached</strong></span> plugin, and
            leave the tables in place permanently. Changes to the
            <code class="literal">innodb_memcache.containers</code> table take
            effect the next time the
            <code class="literal">innodb_memcache.containers</code> table is
            queried. Entries in the containers table are processed at
            startup, and are consulted whenever an unrecognized table
            identifier (as defined by
            <code class="literal">containers.name</code>) is requested using
            <code class="literal">@@</code> notation. Thus, new entries are
            visible as soon as you use the associated table identifier,
            but changes to existing entries require a server restart
            before they take effect.
          </p></li><li class="listitem"><p>
            When you use the default <code class="literal">innodb_only</code>
            caching policy, calls to <code class="literal">add()</code>,
            <code class="literal">set()</code>, <code class="literal">incr()</code>, and so
            on can succeed but still trigger debugging messages such as
            <code class="literal">while expecting 'STORED', got unexpected response
            'NOT_STORED</code>. Debug messages occur because new and
            updated values are sent directly to the
            <code class="literal">InnoDB</code> table without being saved in the
            memory cache, due to the <code class="literal">innodb_only</code>
            caching policy.
</p></li></ul>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="innodb-memcached-tuning"></a>14.17.5.3 Tuning InnoDB memcached Plugin Performance</h4>

</div>

</div>

</div>
<p>
        Because using <code class="literal">InnoDB</code> in combination with
        <span class="command"><strong>memcached</strong></span> involves writing all data to disk,
        whether immediately or sometime later, raw performance is
        expected to be somewhat slower than using
        <span class="command"><strong>memcached</strong></span> by itself. When using the
        <code class="literal">InnoDB</code> <span class="command"><strong>memcached</strong></span> plugin,
        focus tuning goals for <span class="command"><strong>memcached</strong></span> operations
        on achieving better performance than equivalent SQL operations.
      </p><p>
        Benchmarks suggest that queries and
        <a class="link" href="glossary.html#glos_dml" title="DML">DML</a> operations (inserts,
        updates, and deletes) that use the <span class="command"><strong>memcached</strong></span>
        interface are faster than traditional SQL. DML operations
        typically see a larger improvements. Therefore, consider
        adapting write-intensive applications to use the
        <span class="command"><strong>memcached</strong></span> interface first. Also consider
        prioritizing adaptation of write-intensive applications that use
        fast, lightweight mechanisms that lack reliability.
</p>
<h5><a name="idm140644100553792"></a>Adapting SQL Queries</h5>
<p>
        The types of queries that are most suited to simple
        <code class="literal">GET</code> requests are those with a single clause
        or a set of <code class="literal">AND</code> conditions in the
        <code class="literal">WHERE</code> clause:
      </p><pre class="programlisting">
SQL:
SELECT col FROM tbl WHERE key = 'key_value';

memcached:
GET key_value

SQL:
SELECT col FROM tbl WHERE col1 = val1 and col2 = val2 and col3 = val3;

memcached:
# Since you must always know these 3 values to look up the key,
# combine them into a unique string and use that as the key
# for all ADD, SET, and GET operations.
key_value = val1 + ":" + val2 + ":" + val3
GET key_value

SQL:
SELECT 'key exists!' FROM tbl
  WHERE EXISTS (SELECT col1 FROM tbl WHERE KEY = 'key_value') LIMIT 1;

memcached:
# Test for existence of key by asking for its value and checking if the call succeeds,
# ignoring the value itself. For existence checking, you typically only store a very
# short value such as "1".
GET key_value

</pre>
<h5><a name="idm140644100549088"></a>Using System Memory</h5>
<p>
        For best performance, deploy the
        <code class="literal">daemon_memcached</code> plugin on machines that are
        configured as typical database servers, where the majority of
        system RAM is devoted to the <code class="literal">InnoDB</code>
        <a class="link" href="glossary.html#glos_buffer_pool" title="buffer pool">buffer pool</a>, through the
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_size"><code class="literal">innodb_buffer_pool_size</code></a>
        configuration option. For systems with multi-gigabyte buffer
        pools, consider raising the value of
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_instances"><code class="literal">innodb_buffer_pool_instances</code></a>
        for maximum throughput when most operations involve data that is
        already cached in memory.
</p>
<h5><a name="idm140644100542832"></a>Reducing Redundant I/O</h5>
<p>
        <code class="literal">InnoDB</code> has a number of settings that let you
        choose the balance between high reliability, in case of a crash,
        and the amount of I/O overhead during high write workloads. For
        example, consider setting the
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_doublewrite"><code class="literal">innodb_doublewrite</code></a> to
        <code class="literal">0</code> and
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_flush_log_at_trx_commit"><code class="literal">innodb_flush_log_at_trx_commit</code></a>
        to <code class="literal">2</code>. Measure performance with different
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_flush_method"><code class="literal">innodb_flush_method</code></a> settings.
</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_support_xa"><code class="literal">innodb_support_xa</code></a> is
          deprecated and will be removed in a future release. As of
          MySQL 5.7.10, <code class="literal">InnoDB</code> support for two-phase
          commit in XA transactions is always enabled and disabling
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_support_xa"><code class="literal">innodb_support_xa</code></a> is no
          longer permitted.
</p>
</div>
<p>
        For other ways to reduce or tune I/O for table operations, see
        <a class="xref" href="optimization.html#optimizing-innodb-diskio" title="8.5.8 Optimizing InnoDB Disk I/O">Section 8.5.8, “Optimizing InnoDB Disk I/O”</a>.
</p>
<h5><a name="idm140644100530176"></a>Reducing Transactional Overhead</h5>
<p>
        A default value of 1 for
        <a class="link" href="innodb-storage-engine.html#sysvar_daemon_memcached_r_batch_size"><code class="literal">daemon_memcached_r_batch_size</code></a>
        and
        <a class="link" href="innodb-storage-engine.html#sysvar_daemon_memcached_w_batch_size"><code class="literal">daemon_memcached_w_batch_size</code></a>
        is intended for maximum reliability of results and safety of
        stored or updated data.
      </p><p>
        Depending on the type of application, you might increase one or
        both of these settings to reduce the overhead of frequent
        <a class="link" href="glossary.html#glos_commit" title="commit">commit</a> operations. On a busy
        system, you might increase
        <a class="link" href="innodb-storage-engine.html#sysvar_daemon_memcached_r_batch_size"><code class="literal">daemon_memcached_r_batch_size</code></a>,
        knowing that changes to data made through SQL may not become
        visible to <span class="command"><strong>memcached</strong></span> immediately (that is,
        until <em class="replaceable"><code>N</code></em> more <code class="literal">get</code>
        operations are processed). When processing data where every
        write operation must be reliably stored, leave
        <a class="link" href="innodb-storage-engine.html#sysvar_daemon_memcached_w_batch_size"><code class="literal">daemon_memcached_w_batch_size</code></a>
        set to <code class="literal">1</code>. Increase the setting when
        processing large numbers of updates intended only for
        statistical analysis, where losing the last
        <em class="replaceable"><code>N</code></em> updates in a crash is an acceptable
        risk.
      </p><p>
        For example, imagine a system that monitors traffic crossing a
        busy bridge, recording data for approximately 100,000 vehicles
        each day. If the application counts different types of vehicles
        to analyze traffic patterns, changing
        <a class="link" href="innodb-storage-engine.html#sysvar_daemon_memcached_w_batch_size"><code class="literal">daemon_memcached_w_batch_size</code></a>
        from <code class="literal">1</code> to <code class="literal">100</code> reduces I/O
        overhead for commit operations by 99%. In case of an outage, a
        maximum of 100 records are lost, which may be an acceptable
        margin of error. If instead the application performed automated
        toll collection for each car, you would set
        <a class="link" href="innodb-storage-engine.html#sysvar_daemon_memcached_w_batch_size"><code class="literal">daemon_memcached_w_batch_size</code></a>
        to <code class="literal">1</code> to ensure that each toll record is
        immediately saved to disk.
      </p><p>
        Because of the way <code class="literal">InnoDB</code> organizes
        <span class="command"><strong>memcached</strong></span> key values on disk, if you have a
        large number of keys to create, it may be faster to sort the
        data items by key value in the application and
        <code class="literal">add</code> them in sorted order, rather than create
        keys in arbitrary order.
      </p><p>
        The <span class="command"><strong>memslap</strong></span> command, which is part of the
        regular <span class="command"><strong>memcached</strong></span> distribution but not
        included with the <code class="literal">daemon_memcached</code> plugin,
        can be useful for benchmarking different configurations. It can
        also be used to generate sample key/value pairs to use in your
        own benchmarks. See
        <a class="xref" href="ha-overview.html#ha-memcached-interfaces-libmemcached-utilities" title="16.3.3.3.6 libmemcached Command-Line Utilities">Section 16.3.3.3.6, “<span class="command"><strong>libmemcached</strong></span> Command-Line Utilities”</a>
        for details.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="innodb-memcached-txn"></a>14.17.5.4 Controlling Transactional Behavior of the InnoDB memcached Plugin</h4>

</div>

</div>

</div>
<p>
        Unlike traditional <span class="command"><strong>memcached</strong></span>, the
        <code class="literal">daemon_memcached</code> plugin allows you to control
        durability of data values produced through calls to
        <code class="literal">add</code>, <code class="literal">set</code>,
        <code class="literal">incr</code>, and so on. By default, data written
        through the <span class="command"><strong>memcached</strong></span> interface is stored to
        disk, and calls to <code class="literal">get</code> return the most recent
        value from disk. Although the default behavior does not offer
        the best possible raw performance, it is still fast compared to
        the SQL interface for <code class="literal">InnoDB</code> tables.
      </p><p>
        As you gain experience using the
        <code class="literal">daemon_memcached</code> plugin, you can consider
        relaxing durability settings for non-critical classes of data,
        at the risk of losing some updated values in the event of an
        outage, or returning data that is slightly out-of-date.
</p>
<h5><a name="idm140644100498016"></a>Frequency of Commits</h5>
<p>
        One tradeoff between durability and raw performance is how
        frequently new and changed data is
        <a class="link" href="glossary.html#glos_commit" title="commit">committed</a>. If data is
        critical, is should be committed immediately so that it is safe
        in case of a crash or outage. If data is less critical, such as
        counters that are reset after a crash or logging data that you
        can afford to lose, you might prefer higher raw throughput that
        is available with less frequent commits.
      </p><p>
        When a <span class="command"><strong>memcached</strong></span> operation inserts, updates,
        or deletes data in the underlying <code class="literal">InnoDB</code>
        table, the change might be committed to the
        <code class="literal">InnoDB</code> table instantly (if
        <a class="link" href="innodb-storage-engine.html#sysvar_daemon_memcached_w_batch_size"><code class="literal">daemon_memcached_w_batch_size=1</code></a>)
        or some time later (if the
        <a class="link" href="innodb-storage-engine.html#sysvar_daemon_memcached_w_batch_size"><code class="literal">daemon_memcached_w_batch_size</code></a>
        value is greater than 1). In either case, the change cannot be
        rolled back. If you increase the value of
        <a class="link" href="innodb-storage-engine.html#sysvar_daemon_memcached_w_batch_size"><code class="literal">daemon_memcached_w_batch_size</code></a>
        to avoid high I/O overhead during busy times, commits could
        become infrequent when the workload decreases. As a safety
        measure, a background thread automatically commits changes made
        through the <span class="command"><strong>memcached</strong></span> API at regular
        intervals. The interval is controlled by the
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_api_bk_commit_interval"><code class="literal">innodb_api_bk_commit_interval</code></a>
        configuration option, which has a default setting of
        <code class="literal">5</code> seconds.
      </p><p>
        When a <span class="command"><strong>memcached</strong></span> operation inserts or updates
        data in the underlying <code class="literal">InnoDB</code> table, the
        changed data is immediately visible to other
        <span class="command"><strong>memcached</strong></span> requests because the new value
        remains in the memory cache, even if it is not yet committed on
        the MySQL side.
</p>
<h5><a name="idm140644100483168"></a>Transaction Isolation</h5>
<p>
        When a <span class="command"><strong>memcached</strong></span> operation such as
        <code class="literal">get</code> or <code class="literal">incr</code> causes a query
        or DML operation on the underlying <code class="literal">InnoDB</code>
        table, you can control whether the operation sees the very
        latest data written to the table, only data that has been
        committed, or other variations of transaction
        <a class="link" href="glossary.html#glos_isolation_level" title="isolation level">isolation level</a>. Use
        the <a class="link" href="innodb-storage-engine.html#sysvar_innodb_api_trx_level"><code class="literal">innodb_api_trx_level</code></a>
        configuration option to control this feature. The numeric values
        specified for this option correspond to isolation levels such as
        <a class="link" href="sql-syntax.html#isolevel_repeatable-read"><code class="literal">REPEATABLE READ</code></a>. See the
        description of the
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_api_trx_level"><code class="literal">innodb_api_trx_level</code></a> option for
        information about other settings.
      </p><p>
        A strict isolation level ensures that data you retrieve is not
        rolled back or changed suddenly causing subsequent queries to
        return different values. However, strict isolation levels
        require greater <a class="link" href="glossary.html#glos_locking" title="locking">locking</a>
        overhead, which can cause waits. For a NoSQL-style application
        that does not use long-running transactions, you can typically
        use the default isolation level or switch to a less strict
        isolation level.
</p>
<h5><a name="idm140644100472432"></a>Disabling Row Locks for memcached DML Operations</h5>
<p>
        The <a class="link" href="innodb-storage-engine.html#sysvar_innodb_api_disable_rowlock"><code class="literal">innodb_api_disable_rowlock</code></a>
        option can be used to disable row locks when
        <span class="command"><strong>memcached</strong></span> requests through the
        <code class="literal">daemon_memcached</code> plugin cause DML operations.
        By default, <code class="literal">innodb_api_disable_rowlock</code> is set
        to <code class="literal">OFF</code> which means that
        <span class="command"><strong>memcached</strong></span> requests row locks for
        <code class="literal">get</code> and <code class="literal">set</code> operations.
        When <code class="literal">innodb_api_disable_rowlock</code> is set to
        <code class="literal">ON</code>, <span class="command"><strong>memcached</strong></span> requests a
        table lock instead of row locks.
      </p><p>
        The <code class="literal">innodb_api_disable_rowlock</code> option is not
        dynamic. It must be specified at startup on the
        <a class="link" href="programs.html#mysqld" title="4.3.1 mysqld — The MySQL Server"><span class="command"><strong>mysqld</strong></span></a> command line or entered in a MySQL
        configuration file.
</p>
<h5><a name="idm140644100460224"></a>Allowing or Disallowing DDL</h5>
<p>
        By default, you can perform <a class="link" href="glossary.html#glos_ddl" title="DDL">DDL</a>
        operations such as <a class="link" href="sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a> on
        tables used by the <code class="literal">daemon_memcached</code> plugin.
        To avoid potential slowdowns when these tables are used for
        high-throughput applications, disable DDL operations on these
        tables by enabling
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_api_enable_mdl"><code class="literal">innodb_api_enable_mdl</code></a> at
        startup. This option is less appropriate when accessing the same
        tables through both <span class="command"><strong>memcached</strong></span> and SQL,
        because it blocks <a class="link" href="sql-syntax.html#create-index" title="13.1.14 CREATE INDEX Syntax"><code class="literal">CREATE INDEX</code></a>
        statements on the tables, which could be important for running
        reporting queries.
</p>
<h5><a name="idm140644100452704"></a>Storing Data on Disk, in Memory, or Both</h5>
<p>
        The <code class="literal">innodb_memcache.cache_policies</code> table
        specifies whether to store data written through the
        <span class="command"><strong>memcached</strong></span> interface to disk
        (<code class="literal">innodb_only</code>, the default); in memory only,
        as with traditional <span class="command"><strong>memcached</strong></span>
        (<code class="literal">cache-only</code>); or both
        (<code class="literal">caching</code>).
      </p><p>
        With the <code class="literal">caching</code> setting, if
        <span class="command"><strong>memcached</strong></span> cannot find a key in memory, it
        searches for the value in an <code class="literal">InnoDB</code> table.
        Values returned from <code class="literal">get</code> calls under the
        <code class="literal">caching</code> setting could be out-of-date if the
        values were updated on disk in the <code class="literal">InnoDB</code>
        table but are not yet expired from the memory cache.
      </p><p>
        The caching policy can be set independently for
        <code class="literal">get</code>, <code class="literal">set</code> (including
        <code class="literal">incr</code> and <code class="literal">decr</code>),
        <code class="literal">delete</code>, and <code class="literal">flush</code>
        operations.
      </p><p>
        For example, you might allow <code class="literal">get</code> and
        <code class="literal">set</code> operations to query or update a table and
        the <span class="command"><strong>memcached</strong></span> memory cache at the same time
        (using the <code class="literal">caching</code> setting), while making
        <code class="literal">delete</code>, <code class="literal">flush</code>, or both
        operate only on the in-memory copy (using the
        <code class="literal">cache_only</code> setting). That way, deleting or
        flushing an item only expires the item from the cache, and the
        latest value is returned from the <code class="literal">InnoDB</code>
        table the next time the item is requested.
      </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT * FROM innodb_memcache.cache_policies;</code></strong>
+--------------+-------------+-------------+---------------+--------------+
| policy_name  | get_policy  | set_policy  | delete_policy | flush_policy |
+--------------+-------------+-------------+---------------+--------------+
| cache_policy | innodb_only | innodb_only | innodb_only   | innodb_only  |
+--------------+-------------+-------------+---------------+--------------+

mysql&gt; <strong class="userinput"><code>UPDATE innodb_memcache.cache_policies SET set_policy = 'caching'</code></strong>
    -&gt; <strong class="userinput"><code>WHERE policy_name = 'cache_policy';</code></strong>
</pre><p>
        <code class="literal">innodb_memcache.cache_policies</code> values are
        only read at startup. After changing values in this table,
        uninstall and reinstall the <code class="literal">daemon_memcached</code>
        plugin to ensure that changes take effect.
      </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>UNINSTALL PLUGIN daemon_memcached;</code></strong>

mysql&gt; <strong class="userinput"><code>INSTALL PLUGIN daemon_memcached soname "libmemcached.so";</code></strong></pre>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="innodb-memcached-dml"></a>14.17.5.5 Adapting DML Statements to memcached Operations</h4>

</div>

</div>

</div>
<p>
        Benchmarks suggest that the <code class="literal">daemon_memcached</code>
        plugin speeds up <a class="link" href="glossary.html#glos_dml" title="DML">DML</a> operations
        (inserts, updates, and deletes) more than it speeds up queries.
        Therefore, consider focussing initial development efforts on
        write-intensive applications that are I/O-bound, and look for
        opportunities to use MySQL with the
        <code class="literal">daemon_memcached</code> plugin for new
        write-intensive applications.
      </p><p>
        Single-row DML statements are the easiest types of statements to
        turn into <code class="literal">memcached</code> operations.
        <code class="literal">INSERT</code> becomes <code class="literal">add</code>,
        <code class="literal">UPDATE</code> becomes <code class="literal">set</code>,
        <code class="literal">incr</code> or <code class="literal">decr</code>, and
        <code class="literal">DELETE</code> becomes <code class="literal">delete</code>.
        These operations are guaranteed to only affect one row when
        issued through the <span class="command"><strong>memcached</strong></span> interface,
        because the <em class="replaceable"><code>key</code></em> is unique within the
        table.
      </p><p>
        In the following SQL examples, <code class="literal">t1</code> refers to
        the table used for <span class="command"><strong>memcached</strong></span> operations,
        based on the configuration in the
        <code class="literal">innodb_memcache.containers</code> table.
        <code class="literal">key</code> refers to the column listed under
        <code class="literal">key_columns</code>, and <code class="literal">val</code>
        refers to the column listed under
        <code class="literal">value_columns</code>.

</p><pre class="programlisting">
INSERT INTO t1 (key,val) VALUES (<em class="replaceable"><code>some_key</code></em>,<em class="replaceable"><code>some_value</code></em>);
SELECT val FROM t1 WHERE key = <em class="replaceable"><code>some_key</code></em>;
UPDATE t1 SET val = <em class="replaceable"><code>new_value</code></em> WHERE key = <em class="replaceable"><code>some_key</code></em>;
UPDATE t1 SET val = val + x WHERE key = <em class="replaceable"><code>some_key</code></em>;
DELETE FROM t1 WHERE key = <em class="replaceable"><code>some_key</code></em>;
</pre><p>
      </p><p>
        The following <a class="link" href="sql-syntax.html#truncate-table" title="13.1.34 TRUNCATE TABLE Syntax"><code class="literal">TRUNCATE TABLE</code></a> and
        <a class="link" href="sql-syntax.html#delete" title="13.2.2 DELETE Syntax"><code class="literal">DELETE</code></a> statements, which remove
        all rows from the table, correspond to the
        <code class="literal">flush_all</code> operation, where
        <code class="literal">t1</code> is configured as the table for
        <span class="command"><strong>memcached</strong></span> operations, as in the previous
        example.
      </p><pre class="programlisting">TRUNCATE TABLE t1;
DELETE FROM t1;</pre>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="innodb-memcached-ddl"></a>14.17.5.6 Performing DML and DDL Statements on the Underlying InnoDB Table</h4>

</div>

</div>

</div>
<p>
        You can access the underlying <code class="literal">InnoDB</code> table
        (which is <code class="literal">test.demo_test</code> by default) through
        standard SQL interfaces. However, there are some restrictions:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            When querying a table that is also accessed through the
            <span class="command"><strong>memcached</strong></span> interface, remember that
            <span class="command"><strong>memcached</strong></span> operations can be configured to
            be committed periodically rather than after every write
            operation. This behavior is controlled by the
            <a class="link" href="innodb-storage-engine.html#sysvar_daemon_memcached_w_batch_size"><code class="literal">daemon_memcached_w_batch_size</code></a>
            option. If this option is set to a value greater than
            <code class="literal">1</code>, use <a class="link" href="sql-syntax.html#isolevel_read-uncommitted"><code class="literal">READ
            UNCOMMITTED</code></a> queries to find rows that were just
            inserted.
          </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SET SESSSION TRANSACTION ISOLATION LEVEL READ UNCOMMITTED;</code></strong>

mysql&gt; <strong class="userinput"><code>SELECT * FROM demo_test;</code></strong>
+------+------+------+------+-----------+------+------+------+------+------+------+
| cx   | cy   | c1   | cz   | c2        | ca   | CB   | c3   | cu   | c4   | C5   |
+------+------+------+------+-----------+------+------+------+------+------+------+
| NULL | NULL | a11  | NULL | 123456789 | NULL | NULL |   10 | NULL |    3 | NULL |
+------+------+------+------+-----------+------+------+------+------+------+------+
</pre></li><li class="listitem"><p>
            When modifying a table using SQL that is also accessed
            through the <span class="command"><strong>memcached</strong></span> interface, you can
            configure <span class="command"><strong>memcached</strong></span> operations to start a
            new transaction periodically rather than for every read
            operation. This behavior is controlled by the
            <a class="link" href="innodb-storage-engine.html#sysvar_daemon_memcached_r_batch_size"><code class="literal">daemon_memcached_r_batch_size</code></a>
            option. If this option is set to a value greater than
            <code class="literal">1</code>, changes made to the table using SQL
            are not immediately visible to <span class="command"><strong>memcached</strong></span>
            operations.
          </p></li><li class="listitem"><p>
            The <code class="literal">InnoDB</code> table is either IS (intention
            shared) or IX (intention exclusive) locked for all
            operations in a transaction. If you increase
            <a class="link" href="innodb-storage-engine.html#sysvar_daemon_memcached_r_batch_size"><code class="literal">daemon_memcached_r_batch_size</code></a>
            and
            <a class="link" href="innodb-storage-engine.html#sysvar_daemon_memcached_w_batch_size"><code class="literal">daemon_memcached_w_batch_size</code></a>
            substantially from their default value of
            <code class="literal">1</code>, the table is most likely locked
            between each operation, preventing
            <a class="link" href="glossary.html#glos_ddl" title="DDL">DDL</a> statements on the table.
</p></li></ul>
</div>

</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="innodb-memcached-replication"></a>14.17.6 The InnoDB memcached Plugin and Replication</h3>

</div>

</div>

</div>
<p>
      Because the <code class="literal">daemon_memcached</code> plugin supports
      the MySQL <a class="link" href="glossary.html#glos_binary_log" title="binary log">binary log</a>,
      updates made on a <a class="link" href="glossary.html#glos_master_server" title="master server">master
      server</a> through the <span class="command"><strong>memcached</strong></span> interface
      can be replicated for backup, balancing intensive read workloads,
      and high availability. All <span class="command"><strong>memcached</strong></span> commands
      are supported with binary logging.
    </p><p>
      You do not need to set up the <code class="literal">daemon_memcached</code>
      plugin on <a class="link" href="glossary.html#glos_slave_server" title="slave server">slave servers</a>.
      The primary advantage of this configuration is increased write
      throughput on the master. The speed of the replication mechanism
      is not affected.
    </p><p>
      The following sections show how to use the binary log capability
      when using the <code class="literal">daemon_memcached</code> plugin with
      MySQL replication. It is assumed that you have completed the setup
      described in <a class="xref" href="innodb-storage-engine.html#innodb-memcached-setup" title="14.17.3 Setting Up the InnoDB memcached Plugin">Section 14.17.3, “Setting Up the InnoDB memcached Plugin”</a>.
</p>
<div class="simplesect">

<div class="titlepage">
<div>

<div class="simple">
<h4 class="title"><a name="innodb-memcached-replication-enable-binlog"></a>Enabling the InnoDB memcached Binary Log</h4>
</div>
</div>
</div>

<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p>
            To use the <code class="literal">daemon_memcached</code> plugin with
            the MySQL <a class="link" href="glossary.html#glos_binary_log" title="binary log">binary log</a>,
            enable the
            <a class="link" href="innodb-storage-engine.html#sysvar_innodb_api_enable_binlog"><code class="literal">innodb_api_enable_binlog</code></a>
            configuration option on the
            <a class="link" href="glossary.html#glos_master_server" title="master server">master server</a>.
            This option can only be set at server startup. You must also
            enable the MySQL binary log on the master server using the
            <a class="link" href="replication.html#sysvar_log_bin"><code class="literal">--log-bin</code></a> option. You can
            add these options to the MySQL configuration file, or on the
            <a class="link" href="programs.html#mysqld" title="4.3.1 mysqld — The MySQL Server"><span class="command"><strong>mysqld</strong></span></a> command line.
          </p><pre class="programlisting">
mysqld ... --log-bin -–innodb_api_enable_binlog=1
</pre></li><li class="listitem"><p>
            Configure the master and slave server, as described in
            <a class="xref" href="replication.html#replication-howto" title="17.1.2 Setting Up Binary Log File Position Based Replication">Section 17.1.2, “Setting Up Binary Log File Position Based Replication”</a>.
          </p></li><li class="listitem"><p>
            Use <a class="link" href="programs.html#mysqldump" title="4.5.4 mysqldump — A Database Backup Program"><span class="command"><strong>mysqldump</strong></span></a> to create a master data
            snapshot, and sync the snapshot to the slave server.
          </p><pre class="programlisting">
master shell&gt; <strong class="userinput"><code>mysqldump --all-databases --lock-all-tables &gt; dbdump.db</code></strong>
slave shell&gt; <strong class="userinput"><code>mysql &lt; dbdump.db</code></strong>
</pre></li><li class="listitem"><p>
            On the master server, issue <a class="link" href="sql-syntax.html#show-master-status" title="13.7.5.23 SHOW MASTER STATUS Syntax"><code class="literal">SHOW MASTER
            STATUS</code></a> to obtain the master binary log
            coordinates.
          </p><pre class="programlisting">
mysql&gt; <strong class="userinput"><code>SHOW MASTER STATUS;</code></strong>
</pre></li><li class="listitem"><p>
            On the slave server, use a <a class="link" href="sql-syntax.html#change-master-to" title="13.4.2.1 CHANGE MASTER TO Syntax"><code class="literal">CHANGE
            MASTER TO</code></a> statement to set up a slave server using
            the master binary log coordinates.
          </p><pre class="programlisting">
mysql&gt; <strong class="userinput"><code>CHANGE MASTER TO</code></strong>
       <strong class="userinput"><code>MASTER_HOST='localhost',</code></strong>
       <strong class="userinput"><code>MASTER_USER='root',</code></strong>
       <strong class="userinput"><code>MASTER_PASSWORD='',</code></strong>
       <strong class="userinput"><code>MASTER_PORT = 13000,</code></strong>
       <strong class="userinput"><code>MASTER_LOG_FILE='0.000001,</code></strong>
       <strong class="userinput"><code>MASTER_LOG_POS=114;</code></strong>
</pre></li><li class="listitem"><p>
            Start the slave.
          </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>START SLAVE;</code></strong></pre><p>
            If the error log prints output similar to the following, the
            slave is ready for replication.
          </p><pre class="programlisting">
2013-09-24T13:04:38.639684Z 49 [Note] Slave I/O thread: connected to
master 'root@localhost:13000', replication started in log '0.000001'
at position 114
</pre></li></ol>
</div>

</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h4 class="title"><a name="innodb-memcached-replication-testing"></a>Testing the InnoDB memcached Replication Configuration</h4>

</div>

</div>

</div>
<p>
        This example demonstrates how to test the
        <code class="literal">InnoDB</code> <span class="command"><strong>memcached</strong></span>
        replication configuration using the <span class="command"><strong>memcached</strong></span>
        and telnet to insert, update, and delete data. A MySQL client is
        used to verify results on the master and slave servers.
      </p><p>
        The example uses the <code class="literal">demo_test</code> table, which
        was created by the
        <code class="filename">innodb_memcached_config.sql</code> configuration
        script during the initial setup of the
        <code class="literal">daemon_memcached</code> plugin. The
        <code class="literal">demo_test</code> table contains a single example
        record.
</p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p>
            Use the <code class="literal">set</code> command to insert a record
            with a key of <code class="literal">test1</code>, a flag value of
            <code class="literal">10</code>, an expiration value of
            <code class="literal">0</code>, a cas value of 1, and a value of
            <code class="literal">t1</code>.
          </p><pre class="programlisting">
<strong class="userinput"><code>telnet 127.0.0.1 11211</code></strong> 
Trying 127.0.0.1...
Connected to 127.0.0.1.
Escape character is '^]'.
<strong class="userinput"><code>set test1 10 0 1</code></strong>
<strong class="userinput"><code>t1</code></strong>
STORED</pre></li><li class="listitem"><p>
            On the master server, check that the record was inserted
            into the <code class="literal">demo_test</code> table. Assuming the
            <code class="literal">demo_test</code> table was not previously
            modified, there should be two records. The example record
            with a key of <code class="literal">AA</code>, and the record you just
            inserted, with a key of <code class="literal">test1</code>. The
            <code class="literal">c1</code> column maps to the key, the
            <code class="literal">c2</code> column to the value, the
            <code class="literal">c3</code> column to the flag value, the
            <code class="literal">c4</code> column to the cas value, and the
            <code class="literal">c5</code> column to the expiration time. The
            expiration time was set to 0, since it is unused.
          </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT * FROM test.demo_test;</code></strong>
+-------+--------------+------+------+------+
| c1    | c2           | c3   | c4   | c5   |
+-------+--------------+------+------+------+
| AA    | HELLO, HELLO |    8 |    0 |    0 |
| test1 | t1           |   10 |    1 |    0 |
+-------+--------------+------+------+------+</pre></li><li class="listitem"><p>
            Check to verify that the same record was replicated to the
            slave server.
          </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT * FROM test.demo_test;</code></strong>
+-------+--------------+------+------+------+
| c1    | c2           | c3   | c4   | c5   |
+-------+--------------+------+------+------+
| AA    | HELLO, HELLO |    8 |    0 |    0 |
| test1 | t1           |   10 |    1 |    0 |
+-------+--------------+------+------+------+</pre></li><li class="listitem"><p>
            Use the <code class="literal">set</code> command to update the key to
            a value of <code class="literal">new</code>.
          </p><pre class="programlisting">
<strong class="userinput"><code>telnet 127.0.0.1 11211</code></strong>
Trying 127.0.0.1...
Connected to 127.0.0.1.
Escape character is '^]'.
<strong class="userinput"><code>set test1 10 0 2</code></strong>
<strong class="userinput"><code>new</code></strong>
STORED
</pre><p>
            The update is replicated to the slave server (notice that
            the <code class="literal">cas</code> value is also updated).
          </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT * FROM test.demo_test;</code></strong>
+-------+--------------+------+------+------+
| c1    | c2           | c3   | c4   | c5   |
+-------+--------------+------+------+------+
| AA    | HELLO, HELLO |    8 |    0 |    0 |
| test1 | new          |   10 |    2 |    0 |
+-------+--------------+------+------+------+</pre></li><li class="listitem"><p>
            Delete the <code class="literal">test1</code> record using a
            <code class="literal">delete</code> command.
          </p><pre class="programlisting">
<strong class="userinput"><code>telnet 127.0.0.1 11211</code></strong>
Trying 127.0.0.1...
Connected to 127.0.0.1.
Escape character is '^]'.
<strong class="userinput"><code>delete test1</code></strong>
DELETED</pre><p>
            When the <code class="literal">delete</code> operation is replicated
            to the slave, the <code class="literal">test1</code> record on the
            slave is also deleted.
          </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT * FROM test.demo_test;</code></strong>
+----+--------------+------+------+------+
| c1 | c2           | c3   | c4   | c5   |
+----+--------------+------+------+------+
| AA | HELLO, HELLO |    8 |    0 |    0 |
+----+--------------+------+------+------+</pre></li><li class="listitem"><p>
            Remove all rows from the table using the
            <code class="literal">flush_all</code> command.
          </p><pre class="programlisting">
<strong class="userinput"><code>telnet 127.0.0.1 11211</code></strong> 
Trying 127.0.0.1...
Connected to 127.0.0.1.
Escape character is '^]'.
<strong class="userinput"><code>flush_all</code></strong>
OK</pre><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT * FROM test.demo_test;</code></strong>
Empty set (0.00 sec)</pre></li><li class="listitem"><p>
            Telnet to the master server and enter two new records.
          </p><pre class="programlisting">
<strong class="userinput"><code>telnet 127.0.0.1 11211</code></strong> 
Trying 127.0.0.1...
Connected to 127.0.0.1.
Escape character is '^]'
<strong class="userinput"><code>set test2 10 0 4</code></strong>
<strong class="userinput"><code>again</code></strong>
STORED
<strong class="userinput"><code>set test3 10 0 5</code></strong>
<strong class="userinput"><code>again1</code></strong>
STORED</pre></li><li class="listitem"><p>
            Confirm that the two records were replicated to the slave
            server.
          </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT * FROM test.demo_test;</code></strong>
+-------+--------------+------+------+------+
| c1    | c2           | c3   | c4   | c5   |
+-------+--------------+------+------+------+
| test2 | again        |   10 |    4 |    0 |
| test3 | again1       |   10 |    5 |    0 |
+-------+--------------+------+------+------+</pre></li><li class="listitem"><p>
            Remove all rows from the table using the
            <code class="literal">flush_all</code> command.
          </p><pre class="programlisting">
<strong class="userinput"><code>telnet 127.0.0.1 11211</code></strong>
Trying 127.0.0.1...
Connected to 127.0.0.1.
Escape character is '^]'.
<strong class="userinput"><code>flush_all</code></strong>
OK</pre></li><li class="listitem"><p>
            Check to ensure that the <code class="literal">flush_all</code>
            operation was replicated on the slave server.
          </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT * FROM test.demo_test;</code></strong>
Empty set (0.00 sec)</pre></li></ol>
</div>

</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h4 class="title"><a name="innodb-memcached-binlog-notes"></a>InnoDB memcached Binary Log Notes</h4>

</div>

</div>

</div>
<p>
        Binary Log Format:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            Most <span class="command"><strong>memcached</strong></span> operations are mapped to
            <a class="link" href="glossary.html#glos_dml" title="DML">DML</a> statements (analogous to
            insert, delete, update). Since there is no actual SQL
            statement being processed by the MySQL server, all
            <span class="command"><strong>memcached</strong></span> commands (except for
            <code class="literal">flush_all</code>) use Row-Based Replication
            (RBR) logging, which is independent of any server
            <a class="link" href="replication.html#sysvar_binlog_format"><code class="literal">binlog_format</code></a> setting.
          </p></li><li class="listitem"><p>
            The <span class="command"><strong>memcached</strong></span>
            <code class="literal">flush_all</code> command is mapped to the
            <a class="link" href="sql-syntax.html#truncate-table" title="13.1.34 TRUNCATE TABLE Syntax"><code class="literal">TRUNCATE TABLE</code></a> command. Since
            <a class="link" href="glossary.html#glos_ddl" title="DDL">DDL</a> commands can only use
            statement-based logging, the <code class="literal">flush_all</code>
            command is replicated by sending a
            <a class="link" href="sql-syntax.html#truncate-table" title="13.1.34 TRUNCATE TABLE Syntax"><code class="literal">TRUNCATE TABLE</code></a> statement.
</p></li></ul>
</div>
<p>
        Transactions:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            The concept of
            <a class="link" href="glossary.html#glos_transaction" title="transaction">transactions</a> has not
            typically been part of <span class="command"><strong>memcached</strong></span>
            applications. For performance considerations,
            <a class="link" href="innodb-storage-engine.html#sysvar_daemon_memcached_r_batch_size"><code class="literal">daemon_memcached_r_batch_size</code></a>
            and
            <a class="link" href="innodb-storage-engine.html#sysvar_daemon_memcached_w_batch_size"><code class="literal">daemon_memcached_w_batch_size</code></a>
            are used to control the batch size for read and write
            transactions. These settings do not affect replication. Each
            SQL operation on the underlying <code class="literal">InnoDB</code>
            table is replicated after successful completion.
          </p></li><li class="listitem"><p>
            The default value of
            <a class="link" href="innodb-storage-engine.html#sysvar_daemon_memcached_w_batch_size"><code class="literal">daemon_memcached_w_batch_size</code></a>
            is <code class="literal">1</code>, which means that each
            <span class="command"><strong>memcached</strong></span> write operation is committed
            immediately. This default setting incurs a certain amount of
            performance overhead to avoid inconsistencies in the data
            that is visible on the master and slave servers. The
            replicated records are always available immediately on the
            slave server. If you set
            <a class="link" href="innodb-storage-engine.html#sysvar_daemon_memcached_w_batch_size"><code class="literal">daemon_memcached_w_batch_size</code></a>
            to a value greater than <code class="literal">1</code>, records
            inserted or updated through <span class="command"><strong>memcached</strong></span> are
            not immediately visible on the master server; to view the
            records on the master server before they are committed,
            issue <a class="link" href="sql-syntax.html#set-transaction" title="13.3.6 SET TRANSACTION Syntax"><code class="literal">SET
            TRANSACTION ISOLATION LEVEL READ UNCOMMITTED</code></a>.
</p></li></ul>
</div>

</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="innodb-memcached-internals"></a>14.17.7 InnoDB memcached Plugin Internals</h3>

</div>

</div>

</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h4 class="title"><a name="innodb-memcached-api"></a>InnoDB API for the InnoDB memcached Plugin</h4>

</div>

</div>

</div>
<p>
        The <code class="literal">InnoDB</code> <span class="command"><strong>memcached</strong></span>
        engine accesses <code class="literal">InnoDB</code> through
        <code class="literal">InnoDB</code> APIs, most of which are directly
        adopted from embedded <code class="literal">InnoDB</code>.
        <code class="literal">InnoDB</code> API functions are passed to the
        <code class="literal">InnoDB</code> <span class="command"><strong>memcached</strong></span> engine as
        callback functions. <code class="literal">InnoDB</code> API functions
        access the <code class="literal">InnoDB</code> tables directly, and are
        mostly DML operations with the exception of
        <a class="link" href="sql-syntax.html#truncate-table" title="13.1.34 TRUNCATE TABLE Syntax"><code class="literal">TRUNCATE TABLE</code></a>.
      </p><p>
        <span class="command"><strong>memcached</strong></span> commands are implemented through
        the <code class="literal">InnoDB</code> <span class="command"><strong>memcached</strong></span> API.
        The following table outlines how <span class="command"><strong>memcached</strong></span>
        commands are mapped to DML or DDL operations.
</p>
<div class="table">
<a name="idm140644100224752"></a><p class="title"><b>Table 14.13 memcached Commands and Associated DML or DDL Operations</b></p>
<div class="table-contents">
<table summary="memcached Commands and Associated DML or DDL Operations" border="1"><colgroup><col class="c1"><col class="c2"></colgroup><thead><tr><th scope="col">memcached Command</th><th scope="col">DML or DDL Operations</th></tr></thead><tbody><tr><td scope="row"><code class="literal">get</code></td><td>a read/fetch command</td></tr><tr><td scope="row"><code class="literal">set</code></td><td>a search followed by an <code class="literal">INSERT</code> or
                <code class="literal">UPDATE</code> (depending on whether or not a
                key exists)</td></tr><tr><td scope="row"><code class="literal">add</code></td><td>a search followed by an <code class="literal">INSERT</code> or
                <code class="literal">UPDATE</code></td></tr><tr><td scope="row"><code class="literal">replace</code></td><td>a search followed by an <code class="literal">UPDATE</code></td></tr><tr><td scope="row"><code class="literal">append</code></td><td>a search followed by an <code class="literal">UPDATE</code> (appends data to the
                result before <code class="literal">UPDATE</code>)</td></tr><tr><td scope="row"><code class="literal">prepend</code></td><td>a search followed by an <code class="literal">UPDATE</code> (prepends data to the
result before <code class="literal">UPDATE</code>)</td></tr><tr><td scope="row"><code class="literal">incr</code></td><td>a search followed by an <code class="literal">UPDATE</code></td></tr><tr><td scope="row"><code class="literal">decr</code></td><td>a search followed by an <code class="literal">UPDATE</code></td></tr><tr><td scope="row"><code class="literal">delete</code></td><td>a search followed by a <code class="literal">DELETE</code></td></tr><tr><td scope="row"><code class="literal">flush_all</code></td><td><code class="literal">TRUNCATE TABLE</code> (DDL)</td></tr></tbody></table>
</div>

</div>
<br class="table-break">
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h4 class="title"><a name="innodb-memcached-config-tables"></a>InnoDB memcached Plugin Configuration Tables</h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140644100193120"></a><a class="indexterm" name="idm140644100192080"></a><a class="indexterm" name="idm140644100191008"></a><a class="indexterm" name="idm140644100189936"></a><p>
        This section describes configuration tables used by the
        <code class="literal">daemon_memcached</code> plugin. The
        <code class="literal">cache_policies</code> table,
        <code class="literal">config_options</code> table, and
        <code class="literal">containers</code> table are created by the
        <code class="filename">innodb_memcached_config.sql</code> configuration
        script in the <code class="literal">innodb_memcache</code> database.
      </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>USE innodb_memcache;</code></strong>
Database changed
mysql&gt; <strong class="userinput"><code>SHOW TABLES;</code></strong>
+---------------------------+
| Tables_in_innodb_memcache |
+---------------------------+
| cache_policies            |
| config_options            |
| containers                |
+---------------------------+
</pre>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h4 class="title"><a name="innodb-memcached-cache-policies-table"></a>cache_policies Table</h4>

</div>

</div>

</div>
<p>
        The <code class="literal">cache_policies</code> table defines a cache
        policy for the <code class="literal">InnoDB</code>
        <code class="literal">memcached</code> installation. You can specify
        individual policies for <code class="literal">get</code>,
        <code class="literal">set</code>, <code class="literal">delete</code>, and
        <code class="literal">flush</code> operations, within a single cache
        policy. The default setting for all operations is
        <code class="literal">innodb_only</code>.
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <code class="literal">innodb_only</code>: Use
            <code class="literal">InnoDB</code> as the data store.
          </p></li><li class="listitem"><p>
            <code class="literal">cache-only</code>: Use the
            <span class="command"><strong>memcached</strong></span> engine as the data store.
          </p></li><li class="listitem"><p>
            <code class="literal">caching</code>: Use both
            <code class="literal">InnoDB</code> and the
            <span class="command"><strong>memcached</strong></span> engine as data stores. In this
            case, if <span class="command"><strong>memcached</strong></span> cannot find a key in
            memory, it searches for the value in an
            <code class="literal">InnoDB</code> table.
          </p></li><li class="listitem"><p>
            <code class="literal">disable</code>: Disable caching.
</p></li></ul>
</div>

<div class="table">
<a name="idm140644100163392"></a><p class="title"><b>Table 14.14 cache_policies Columns</b></p>
<div class="table-contents">
<table summary="cache_policies Columns" border="1"><colgroup><col class="c1"><col class="c2"></colgroup><thead><tr><th scope="col">Column</th><th scope="col">Description</th></tr></thead><tbody><tr><td scope="row"><code class="literal">policy_name</code></td><td>Name of the cache policy. The default cache policy name is
                <code class="literal">cache_policy</code>.</td></tr><tr><td scope="row"><code class="literal">get_policy</code></td><td>The cache policy for get operations. Valid values are
                <code class="literal">innodb_only</code>,
                <code class="literal">cache-only</code>,
                <code class="literal">caching</code>, or
                <code class="literal">disabled</code>. The default setting is
                <code class="literal">innodb_only</code>.</td></tr><tr><td scope="row"><code class="literal">set_policy</code></td><td>The cache policy for set operations. Valid values are
                <code class="literal">innodb_only</code>,
                <code class="literal">cache-only</code>,
                <code class="literal">caching</code>, or
                <code class="literal">disabled</code>. The default setting is
                <code class="literal">innodb_only</code>.</td></tr><tr><td scope="row"><code class="literal">delete_policy</code></td><td>The cache policy for delete operations. Valid values are
                <code class="literal">innodb_only</code>,
                <code class="literal">cache-only</code>,
                <code class="literal">caching</code>, or
                <code class="literal">disabled</code>. The default setting is
                <code class="literal">innodb_only</code>.</td></tr><tr><td scope="row"><code class="literal">flush_policy</code></td><td>The cache policy for flush operations. Valid values are
                <code class="literal">innodb_only</code>,
                <code class="literal">cache-only</code>,
                <code class="literal">caching</code>, or
                <code class="literal">disabled</code>. The default setting is
<code class="literal">innodb_only</code>.</td></tr></tbody></table>
</div>

</div>
<br class="table-break">
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h4 class="title"><a name="innodb-memcached-config-options-table"></a>config_options Table</h4>

</div>

</div>

</div>
<p>
        The <code class="literal">config_options</code> table stores
        <span class="command"><strong>memcached</strong></span>-related settings that can be
        changed at runtime using SQL. Supported configuration options
        are <code class="literal">separator</code> and
        <code class="literal">table_map_delimiter</code>.

</p>
<div class="table">
<a name="idm140644100129648"></a><p class="title"><b>Table 14.15 config_options Columns</b></p>
<div class="table-contents">
<table summary="config_options Columns" border="1"><colgroup><col class="c1"><col class="c2"></colgroup><thead><tr><th scope="col">Column</th><th scope="col">Description</th></tr></thead><tbody><tr><td scope="row"><code class="literal">Name</code></td><td>Name of the <span class="command"><strong>memcached</strong></span>-related configuration option.
                  The following configuration options are supported by
                  the <code class="literal">config_options</code> table:

<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
                        <code class="literal">separator</code>: Used to separate
                        values of a long string into separate values
                        when there are multiple
                        <code class="literal">value_columns</code> defined. By
                        default, the <code class="literal">separator</code> is a
                        <code class="literal">|</code> character. For example, if
                        you define <code class="literal">col1, col2</code> as
                        value columns, and you define
                        <code class="literal">|</code> as the separator, you can
                        issue the following <span class="command"><strong>memcached</strong></span>
                        command to insert values into
                        <code class="literal">col1</code> and
                        <code class="literal">col2</code>, respectively:
                      </p><pre class="programlisting">set keyx 10 0 19
valuecolx|valuecoly</pre><p>
                        <code class="literal">valuecol1x</code> is stored in
                        <code class="literal">col1</code> and
                        <code class="literal">valuecoly</code> is stored in
                        <code class="literal">col2</code>.
                      </p></li><li class="listitem"><p>
                        <code class="literal">table_map_delimiter</code>: The
                        character separating the schema name and the
                        table name when you use the
                        <code class="literal">@@</code> notation in a key name to
                        access a key in a specific table. For example,
                        <code class="literal">@@t1.some_key</code> and
                        <code class="literal">@@t2.some_key</code> have the same
                        key value, but are stored in different tables.
</p></li></ul>
</div>
</td></tr><tr><td scope="row"><code class="literal">Value</code></td><td>The value assigned to the <span class="command"><strong>memcached</strong></span>-related
configuration option.</td></tr></tbody></table>
</div>

</div>
<p><br class="table-break">
</p>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h4 class="title"><a name="innodb-memcached-containers-table"></a>containers Table</h4>

</div>

</div>

</div>
<p>
        The <code class="literal">containers</code> table is the most important of
        the three configuration tables. Each <code class="literal">InnoDB</code>
        table that is used to store <span class="command"><strong>memcached</strong></span> values
        must have an entry in the <code class="literal">containers</code> table.
        The entry provides a mapping between <code class="literal">InnoDB</code>
        table columns and container table columns, which is required for
        <code class="literal">memcached</code> to work with
        <code class="literal">InnoDB</code> tables.
      </p><p>
        The <code class="literal">containers</code> table contains a default entry
        for the <code class="literal">test.demo_test</code> table, which is
        created by the <code class="filename">innodb_memcached_config.sql</code>
        configuration script. To use the
        <code class="literal">daemon_memcached</code> plugin with your own
        <code class="literal">InnoDB</code> table, you must create an entry in the
        <code class="literal">containers</code> table.
</p>
<div class="table">
<a name="idm140644100090576"></a><p class="title"><b>Table 14.16 containers Columns</b></p>
<div class="table-contents">
<table summary="containers Columns" border="1"><colgroup><col class="c1"><col class="c2"></colgroup><thead><tr><th scope="col">Column</th><th scope="col">Description</th></tr></thead><tbody><tr><td scope="row"><code class="literal">name</code></td><td>The name given to the container. If an <code class="literal">InnoDB</code> table
                is not requested by name using <code class="literal">@@</code>
                notation, the <code class="literal">daemon_memcached</code> plugin
                uses the <code class="literal">InnoDB</code> table with a
                <code class="literal">containers.name</code> value of
                <code class="literal">default</code>. If there is no such entry,
                the first entry in the <code class="literal">containers</code>
                table, ordered alphabetically by <code class="literal">name</code>
                (ascending), determines the default
                <code class="literal">InnoDB</code> table.</td></tr><tr><td scope="row"><code class="literal">db_schema</code></td><td>The name of the database where the <code class="literal">InnoDB</code> table
                resides. This is a required value.</td></tr><tr><td scope="row"><code class="literal">db_table</code></td><td>The name of the <code class="literal">InnoDB</code> table that stores
                <span class="command"><strong>memcached</strong></span> values. This is a required
                value.</td></tr><tr><td scope="row"><code class="literal">key_columns</code></td><td>The column in the <code class="literal">InnoDB</code> table that contains lookup
                key values for <span class="command"><strong>memcached</strong></span> operations.
                This is a required value.</td></tr><tr><td scope="row"><code class="literal">value_columns</code></td><td>The <code class="literal">InnoDB</code> table columns (one or more) that store
                <code class="literal">memcached</code> data. Multiple columns can
                be specified using the separator character specified in
                the <code class="literal">innodb_memcached.config_options</code>
                table. By default, the separator is a pipe character
                (<span class="quote">“<span class="quote">|</span>”</span>). To specify multiple columns,
                separate them with the defined separator character. For
                example: <code class="literal">col1|col2|col3</code>. This is a
                required value.</td></tr><tr><td scope="row"><code class="literal">flags</code></td><td>The <code class="literal">InnoDB</code> table columns that are used as flags (a
                user-defined numeric value that is stored and retrieved
                along with the main value) for
                <span class="command"><strong>memcached</strong></span>. A flag value can be used
                as a column specifier for some operations (such as
                <code class="literal">incr</code>, <code class="literal">prepend</code>) if
                a <span class="command"><strong>memcached</strong></span> value is mapped to
                multiple columns, so that an operation is performed on a
                specified column. For example, if you have mapped a
                <code class="literal">value_columns</code> to three
                <code class="literal">InnoDB</code> table columns, and only want
                the increment operation performed on one columns, use
                the <code class="literal">flags</code> column to specify the
                column. If you do not use the <code class="literal">flags</code>
                column, set a value of <code class="literal">0</code> to indicate
                that it is unused.</td></tr><tr><td scope="row"><code class="literal">cas_column</code></td><td>The <code class="literal">InnoDB</code> table column that stores compare-and-swap
                (cas) values. The <code class="literal">cas_column</code> value is
                related to the way <span class="command"><strong>memcached</strong></span> hashes
                requests to different servers and caches data in memory.
                Because the <code class="literal">InnoDB</code>
                <span class="command"><strong>memcached</strong></span> plugin is tightly
                integrated with a single <span class="command"><strong>memcached</strong></span>
                daemon, and the in-memory caching mechanism is handled
                by MySQL and the <a class="link" href="glossary.html#glos_buffer_pool" title="buffer pool">InnoDB
                buffer pool</a>, this column is rarely needed. If you
                do not use this column, set a value of
                <code class="literal">0</code> to indicate that it is unused.</td></tr><tr><td scope="row"><code class="literal">expire_time_column</code></td><td>The <code class="literal">InnoDB</code> table column that stores expiration
                values. The <code class="literal">expire_time_column</code> value
                is related to the way <span class="command"><strong>memcached</strong></span>
                hashes requests to different servers and caches data in
                memory. Because the <code class="literal">InnoDB</code>
                <span class="command"><strong>memcached</strong></span> plugin is tightly
                integrated with a single <span class="command"><strong>memcached</strong></span>
                daemon, and the in-memory caching mechanism is handled
                by MySQL and the <a class="link" href="glossary.html#glos_buffer_pool" title="buffer pool">InnoDB
                buffer pool</a>, this column is rarely needed. If you
                do not use this column, set a value of
                <code class="literal">0</code> to indicate that the column is
                unused. As of MySQL 5.7.8, maximum expire time is
                defined as <code class="literal">INT_MAX32</code> or 2147483647
                seconds (approximately 68 years).</td></tr><tr><td scope="row"><code class="literal">unique_idx_name_on_key</code></td><td>The name of the index on the key column. It must be a unique index. It
                can be the <a class="link" href="glossary.html#glos_primary_key" title="primary key">primary
                key</a> or a
                <a class="link" href="glossary.html#glos_secondary_index" title="secondary index">secondary
                index</a>. Preferably, use the primary key of the
                <code class="literal">InnoDB</code> table. Using the primary key
                avoids a lookup that is performed when using a secondary
                index. You cannot make a
                <a class="link" href="glossary.html#glos_covering_index" title="covering index">covering
                index</a> for <span class="command"><strong>memcached</strong></span> lookups;
                <code class="literal">InnoDB</code> returns an error if you try to
                define a composite secondary index over both the key and
value columns.</td></tr></tbody></table>
</div>

</div>
<br class="table-break">
<h5><a name="idm140644100029952"></a>containers Table Column Constraints</h5>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            You must supply a value for <code class="literal">db_schema</code>,
            <code class="literal">db_name</code>, <code class="literal">key_columns</code>,
            <code class="literal">value_columns</code> and
            <code class="literal">unique_idx_name_on_key</code>. Specify
            <code class="literal">0</code> for <code class="literal">flags</code>,
            <code class="literal">cas_column</code>, and
            <code class="literal">expire_time_column</code> if they are unused.
            Failing to do so could cause your setup to fail.
          </p></li><li class="listitem"><p>
            <code class="literal">key_columns</code>: The maximum limit for a
            <span class="command"><strong>memcached</strong></span> key is 250 characters, which is
            enforced by <span class="command"><strong>memcached</strong></span>. The mapped key
            must be a non-Null <a class="link" href="data-types.html#char" title="11.4.1 The CHAR and VARCHAR Types"><code class="literal">CHAR</code></a> or
            <a class="link" href="data-types.html#char" title="11.4.1 The CHAR and VARCHAR Types"><code class="literal">VARCHAR</code></a> type.
          </p></li><li class="listitem"><p>
            <code class="literal">value_columns</code>: Must be mapped to a
            <a class="link" href="data-types.html#char" title="11.4.1 The CHAR and VARCHAR Types"><code class="literal">CHAR</code></a>,
            <a class="link" href="data-types.html#char" title="11.4.1 The CHAR and VARCHAR Types"><code class="literal">VARCHAR</code></a>, or
            <a class="link" href="data-types.html#blob" title="11.4.3 The BLOB and TEXT Types"><code class="literal">BLOB</code></a> column. There is no
            length restriction and the value can be NULL.
          </p></li><li class="listitem"><p>
            <code class="literal">cas_column</code>: The <code class="literal">cas</code>
            value is a 64 bit integer. It must be mapped to a
            <a class="link" href="data-types.html#integer-types" title="11.2.1 Integer Types (Exact Value) - INTEGER, INT, SMALLINT, TINYINT, MEDIUMINT, BIGINT"><code class="literal">BIGINT</code></a> of at least 8 bytes.
            If you do not use this column, set a value of
            <code class="literal">0</code> to indicate that it is unused.
          </p></li><li class="listitem"><p>
            <code class="literal">expiration_time_column</code>: Must mapped to an
            <a class="link" href="data-types.html#integer-types" title="11.2.1 Integer Types (Exact Value) - INTEGER, INT, SMALLINT, TINYINT, MEDIUMINT, BIGINT"><code class="literal">INTEGER</code></a> of at least 4 bytes.
            Expiration time is defined as a 32-bit integer for Unix time
            (the number of seconds since January 1, 1970, as a 32-bit
            value), or the number of seconds starting from the current
            time. For the latter, the number of seconds may not exceed
            60*60*24*30 (the number of seconds in 30 days). If the
            number sent by a client is larger, the server considers it
            to be a real Unix time value rather than an offset from the
            current time. If you do not use this column, set a value of
            <code class="literal">0</code> to indicate that it is unused.
          </p></li><li class="listitem"><p>
            <code class="literal">flags</code>: Must be mapped to an
            <a class="link" href="data-types.html#integer-types" title="11.2.1 Integer Types (Exact Value) - INTEGER, INT, SMALLINT, TINYINT, MEDIUMINT, BIGINT"><code class="literal">INTEGER</code></a> of at least 32-bits
            and can be NULL. If you do not use this column, set a value
            of <code class="literal">0</code> to indicate that it is unused.
</p></li></ul>
</div>
<p>
        A pre-check is performed at plugin load time to enforce column
        constraints. If mismatches are found, the plugin will not load.
</p>
<h5><a name="idm140644099998336"></a>Multiple Value Column Mapping</h5>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            During plugin initialization, when <code class="literal">InnoDB</code>
            <span class="command"><strong>memcached</strong></span> is configured with information
            defined in the <code class="literal">containers</code> table, each
            mapped column defined in
            <code class="literal">containers.value_columns</code> is verified
            against the mapped <code class="literal">InnoDB</code> table. If
            multiple <code class="literal">InnoDB</code> table columns are mapped,
            there is a check to ensure that each column exists and is
            the right type.
          </p></li><li class="listitem"><p>
            At run-time, for <code class="literal">memcached</code> insert
            operations, if there are more delimited values than the
            number of mapped columns, only the number of mapped values
            are taken. For example, if there are six mapped columns, and
            seven delimited values are provided, only the first six
            delimited values are taken. The seventh delimited value is
            ignored.
          </p></li><li class="listitem"><p>
            If there are fewer delimited values than mapped columns,
            unfilled columns are set to NULL. If an unfilled column
            cannot be set to NULL, insert operations will fail.
          </p></li><li class="listitem"><p>
            If a table has more columns than mapped values, the extra
            columns do not affect results.
</p></li></ul>
</div>

</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h4 class="title"><a name="innodb-memcached-demo-test-table"></a>The demo_test Example Table</h4>

</div>

</div>

</div>
<p>
        The <code class="filename">innodb_memcached_config.sql</code>
        configuration script creates a <code class="literal">demo_test</code>
        table in the <code class="literal">test</code> database, which can be used
        to verify <code class="literal">InnoDB</code> <span class="command"><strong>memcached</strong></span>
        plugin installation immediately after setup.
      </p><p>
        The <code class="filename">innodb_memcached_config.sql</code>
        configuration script also creates an entry for the
        <code class="literal">demo_test</code> table in the
        <code class="literal">innodb_memcache.containers</code> table.
      </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT * FROM innodb_memcache.containers\G</code></strong>
*************************** 1. row ***************************
                  name: aaa
             db_schema: test
              db_table: demo_test
           key_columns: c1
         value_columns: c2
                 flags: c3
            cas_column: c4
    expire_time_column: c5
unique_idx_name_on_key: PRIMARY

mysql&gt; <strong class="userinput"><code>SELECT * FROM test.demo_test;</code></strong>
+----+------------------+------+------+------+
| c1 | c2               | c3   | c4   | c5   |
+----+------------------+------+------+------+
| AA | HELLO, HELLO     |    8 |    0 |    0 |
+----+------------------+------+------+------+
</pre>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="innodb-memcached-troubleshoot"></a>14.17.8 Troubleshooting the InnoDB memcached Plugin</h3>

</div>

</div>

</div>
<p>
      This section describes issues that you may encounter when using
      the <code class="literal">InnoDB</code> <span class="command"><strong>memcached</strong></span> plugin.
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          If you encounter the following error in the MySQL error log,
          the server might fail to start:
        </p><p>
          <span class="errortext">failed to set rlimit for open files. Try running as
          root or requesting smaller maxconns value.</span>
        </p><p>
          The error message is from the <span class="command"><strong>memcached</strong></span>
          daemon. One solution is to raise the OS limit for the number
          of open files. The commands for checking and increasing the
          open file limit varies by operating system. This example shows
          commands for Linux and OS X:
        </p><pre class="programlisting">
# Linux
$ ulimit -n
1024
ulimit -n 4096
$ ulimit -n
4096

# OS X Lion (10.6)
$ ulimit -n
256
ulimit -n 4096
$ ulimit -n
4096
</pre><p>
          The other solution is to reduce the number of concurrent
          connections permitted for the <span class="command"><strong>memcached</strong></span>
          daemon. To do so, encode the <code class="literal">-c</code>
          <span class="command"><strong>memcached</strong></span> option in the
          <a class="link" href="innodb-storage-engine.html#sysvar_daemon_memcached_option"><code class="literal">daemon_memcached_option</code></a>
          configuration parameter in the MySQL configuration file. The
          <code class="literal">-c</code> option has a default value of 1024.
        </p><pre class="programlisting">
[mysqld]
...
loose-daemon_memcached_option='-c 64'
</pre></li><li class="listitem"><p>
          To troubleshoot problems where the
          <span class="command"><strong>memcached</strong></span> daemon is unable to store or
          retrieve <code class="literal">InnoDB</code> table data, encode the
          <code class="literal">-vvv</code> <span class="command"><strong>memcached</strong></span> option in
          the <a class="link" href="innodb-storage-engine.html#sysvar_daemon_memcached_option"><code class="literal">daemon_memcached_option</code></a>
          configuration parameter in the MySQL configuration file.
          Examine the MySQL error log for debug output related to
          <span class="command"><strong>memcached</strong></span> operations.
        </p><pre class="programlisting">
[mysqld]
...
loose-daemon_memcached_option='-vvv'
</pre></li><li class="listitem"><p>
          If columns specified to hold <span class="command"><strong>memcached</strong></span>
          values are the wrong data type, such as a numeric type instead
          of a string type, attempts to store key/value pairs will fail
          with no specific error code or message.
        </p></li><li class="listitem"><p>
          If the <code class="literal">daemon_memcached</code> plugin causes MySQL
          server startup issues, you can temporarily disable the
          <code class="literal">daemon_memcached</code> plugin while
          troubleshooting by adding this line under the
          <code class="literal">[mysqld]</code> group in the MySQL configuration
          file:
        </p><pre class="programlisting">
daemon_memcached=OFF
</pre><p>
          For example, if you run the <a class="link" href="sql-syntax.html#install-plugin" title="13.7.3.3 INSTALL PLUGIN Syntax"><code class="literal">INSTALL
          PLUGIN</code></a> statement before running the
          <code class="filename">innodb_memcached_config.sql</code> configuration
          script to set up the necessary database and tables, the server
          might crash and fail to start. The server could also fail to
          start if you incorrectly configure an entry in the
          <code class="literal">innodb_memcache.containers</code> table.
        </p><p>
          To uninstall the <span class="command"><strong>memcached</strong></span> plugin for a
          MySQL instance, issue the following command:
        </p><pre class="programlisting">
mysql&gt; <strong class="userinput"><code>uninstall plugin daemon_memcached;</code></strong>
</pre></li><li class="listitem"><p>
          If you run more than one instance of MySQL on the same machine
          with the <code class="literal">daemon_memcached</code> plugin enabled in
          each instance, use the
          <a class="link" href="innodb-storage-engine.html#sysvar_daemon_memcached_option"><code class="literal">daemon_memcached_option</code></a>
          configuration parameter to specify a unique
          <span class="command"><strong>memcached</strong></span> port for each
          <code class="literal">daemon_memcached</code> plugin.
        </p></li><li class="listitem"><p>
          If an SQL statement cannot find the <code class="literal">InnoDB</code>
          table or finds no data in the table, but
          <span class="command"><strong>memcached</strong></span> API calls retrieve the expected
          data, you may be missing an entry for the
          <code class="literal">InnoDB</code> table to the
          <code class="literal">innodb_memcache.containers</code> table, or you
          may have not switched to the correct <code class="literal">InnoDB</code>
          table by issuing a <code class="literal">get</code> or
          <code class="literal">set</code> request using
          <code class="literal">@@<em class="replaceable"><code>table_id</code></em></code>
          notation. This problem could also occur if you make a change
          to an existing entry in the
          <code class="literal">innodb_memcache.containers</code> table without
          restarting the MySQL server afterward. The free-form storage
          mechanism is flexible enough that your requests to store or
          retrieve a multi-column value like
          <code class="literal">col1|col2|col3</code> may still work, even if the
          daemon is using the <code class="literal">test.demo_test</code> table
          which stores values in a single column.
        </p></li><li class="listitem"><p>
          When defining your own <code class="literal">InnoDB</code> table for use
          with the <code class="literal">daemon_memcached</code> plugin, and
          columns in the table are defined as NOT NULL, ensure that
          values are supplied for the NOT NULL columns when inserting a
          record for the table into the
          <code class="literal">innodb_memcache.containers</code> table. If the
          <a class="link" href="sql-syntax.html#insert" title="13.2.5 INSERT Syntax"><code class="literal">INSERT</code></a> statement for the
          <code class="literal">innodb_memcache.containers</code> record contains
          fewer delimited values than there are mapped columns, unfilled
          columns are set to NULL. Attempting to insert a NULL value
          into a NOT NULL column causes the
          <a class="link" href="sql-syntax.html#insert" title="13.2.5 INSERT Syntax"><code class="literal">INSERT</code></a> to fail, which may only
          become evident after you reinitialize the
          <code class="literal">daemon_memcached</code> plugin to apply changes to
          the <code class="literal">innodb_memcache.containers</code> table.
        </p></li><li class="listitem"><p>
          If <code class="literal">cas_column</code> and
          <code class="literal">expire_time_column</code> fields of the
          <code class="literal">innodb_memcached.containers</code> table are set
          to NULL, the following error will be returned when attempting
          to load the <span class="command"><strong>memcached</strong></span> plugin:
        </p><pre class="programlisting">
InnoDB_Memcached: column 6 in the entry for config table 'containers' in
database 'innodb_memcache' has an invalid NULL value.</pre><p>
          The <span class="command"><strong>memcached</strong></span> plugin rejects usage of NULL
          in the <code class="literal">cas_column</code> and
          <code class="literal">expire_time_column</code> columns. Set the value
          of these columns to <code class="literal">0</code> when the columns are
          unused.
        </p></li><li class="listitem"><p>
          As the length of the <span class="command"><strong>memcached</strong></span> key and
          values increase, you might encounter size and length limits.
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
              When the key exceeds 250 bytes,
              <span class="command"><strong>memcached</strong></span> operations return an error.
              This is currently a fixed limit within
              <span class="command"><strong>memcached</strong></span>.
            </p></li><li class="listitem"><p>
              <code class="literal">InnoDB</code> table limits may be encountered
              if values exceed 768 bytes in size, 3072 bytes in size, or
              half of the
              <a class="link" href="innodb-storage-engine.html#sysvar_innodb_page_size"><code class="literal">innodb_page_size</code></a> value.
              These limits primarily apply if you intend to create an
              index on a value column to run report-generating queries
              on that column using SQL. See
              <a class="xref" href="innodb-storage-engine.html#innodb-restrictions" title="14.5.7 Limits on InnoDB Tables">Section 14.5.7, “Limits on InnoDB Tables”</a> for details.
            </p></li><li class="listitem"><p>
              The maximum size for the key-value combination is 1 MB.
</p></li></ul>
</div>
</li><li class="listitem"><p>
          If you share configuration files across MySQL servers of
          different versions, using the latest configuration options for
          the <code class="literal">daemon_memcached</code> plugin could cause
          startup errors on older MySQL versions. To avoid compatibility
          problems, use the <code class="literal">loose</code> prefix with option
          names. For example, use
          <code class="literal">loose-daemon_memcached_option='-c 64'</code>
          instead of <code class="literal">daemon_memcached_option='-c 64'</code>.
        </p></li><li class="listitem"><p>
          There is no restriction or check in place to validate
          character set settings. <span class="command"><strong>memcached</strong></span> stores
          and retrieves keys and values in bytes and is therefore not
          character set sensitive. However, you must ensure that the
          <span class="command"><strong>memcached</strong></span> client and the MySQL table use
          the same character set.
        </p></li><li class="listitem"><p>
          <span class="command"><strong>memcached</strong></span> connections are blocked from
          accessing tables that contain an indexed virtual column.
          Accessing an indexed virtual column requires a callback to the
          server, but a <span class="command"><strong>memcached</strong></span> connection does not
          have access to the server code.
</p></li></ul>
</div>

</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="innodb-troubleshooting"></a>14.18 InnoDB Troubleshooting</h2>

</div>

</div>

</div>
<div class="toc">
<dl class="toc"><dt><span class="section"><a href="innodb-storage-engine.html#error-creating-innodb">14.18.1 Troubleshooting InnoDB I/O Problems</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#forcing-innodb-recovery">14.18.2 Forcing InnoDB Recovery</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-troubleshooting-datadict">14.18.3 Troubleshooting InnoDB Data Dictionary Operations</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-error-handling">14.18.4 InnoDB Error Handling</a></span></dt></dl>
</div>
<a class="indexterm" name="idm140644099896080"></a><p>
    The following general guidelines apply to troubleshooting
    <code class="literal">InnoDB</code> problems:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
        When an operation fails or you suspect a bug, look at the MySQL
        server error log (see <a class="xref" href="server-administration.html#error-log" title="5.2.2 The Error Log">Section 5.2.2, “The Error Log”</a>).
        <a class="xref" href="error-handling.html#error-messages-server" title="B.3 Server Error Codes and Messages">Section B.3, “Server Error Codes and Messages”</a> provides troubleshooting
        information for some of the common
        <code class="literal">InnoDB</code>-specific errors that you may
        encounter.
      </p></li><li class="listitem"><p>
        If the failure is related to a
        <a class="link" href="glossary.html#glos_deadlock" title="deadlock">deadlock</a>, run with the
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_print_all_deadlocks"><code class="literal">innodb_print_all_deadlocks</code></a>
        option enabled so that details about each
        <code class="literal">InnoDB</code> deadlock are printed to the MySQL
        server error log.
      </p></li><li class="listitem"><p>
        Issues relating to the <code class="literal">InnoDB</code> data dictionary
        include failed <a class="link" href="sql-syntax.html#create-table" title="13.1.18 CREATE TABLE Syntax"><code class="literal">CREATE TABLE</code></a>
        statements (orphan table files), inability to open
        <code class="filename">.InnoDB</code> files, and <span class="errortext">system cannot
        find the path specified</span> errors. For information
        about these sorts of problems and errors, see
        <a class="xref" href="innodb-storage-engine.html#innodb-troubleshooting-datadict" title="14.18.3 Troubleshooting InnoDB Data Dictionary Operations">Section 14.18.3, “Troubleshooting InnoDB Data Dictionary Operations”</a>.
      </p></li><li class="listitem"><p>
        When troubleshooting, it is usually best to run the MySQL server
        from the command prompt, rather than through
        <a class="link" href="programs.html#mysqld-safe" title="4.3.2 mysqld_safe — MySQL Server Startup Script"><span class="command"><strong>mysqld_safe</strong></span></a> or as a Windows service. You can
        then see what <a class="link" href="programs.html#mysqld" title="4.3.1 mysqld — The MySQL Server"><span class="command"><strong>mysqld</strong></span></a> prints to the console,
        and so have a better grasp of what is going on. On Windows,
        start <a class="link" href="programs.html#mysqld" title="4.3.1 mysqld — The MySQL Server"><span class="command"><strong>mysqld</strong></span></a> with the
        <a class="link" href="server-administration.html#option_mysqld_console"><code class="option">--console</code></a> option to direct the
        output to the console window.
      </p></li><li class="listitem"><p>
        <a class="indexterm" name="idm140644099875264"></a>

        <a class="indexterm" name="idm140644099873776"></a>

        Enable the <code class="literal">InnoDB</code> Monitors to obtain
        information about a problem (see
        <a class="xref" href="innodb-storage-engine.html#innodb-monitors" title="14.14 InnoDB Monitors">Section 14.14, “InnoDB Monitors”</a>). If the problem is
        performance-related, or your server appears to be hung, you
        should enable the standard Monitor to print information about
        the internal state of <code class="literal">InnoDB</code>. If the problem
        is with locks, enable the Lock Monitor. If the problem is with
        table creation, tablespaces, or data dictionary operations,
        refer to the
        <a class="link" href="innodb-storage-engine.html#innodb-information-schema-system-tables" title="14.12.3 InnoDB INFORMATION_SCHEMA System Tables">InnoDB
        Information Schema system tables</a> to examine contents of
        the <code class="literal">InnoDB</code> internal data dictionary.
      </p><p>
        <code class="literal">InnoDB</code> temporarily enables standard
        <code class="literal">InnoDB</code> Monitor output under the following
        conditions:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
            A long semaphore wait
          </p></li><li class="listitem"><p>
            <code class="literal">InnoDB</code> cannot find free blocks in the
            buffer pool
          </p></li><li class="listitem"><p>
            Over 67% of the buffer pool is occupied by lock heaps or the
            adaptive hash index
</p></li></ul>
</div>
</li><li class="listitem"><p>
        If you suspect that a table is corrupt, run
        <a class="link" href="sql-syntax.html#check-table" title="13.7.2.2 CHECK TABLE Syntax"><code class="literal">CHECK TABLE</code></a> on that table.
</p></li></ul>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="error-creating-innodb"></a>14.18.1 Troubleshooting InnoDB I/O Problems</h3>

</div>

</div>

</div>
<a class="indexterm" name="idm140644099858832"></a><p>
      The troubleshooting steps for <code class="literal">InnoDB</code> I/O
      problems depend on when the problem occurs: during startup of the
      MySQL server, or during normal operations when a DML or DDL
      statement fails due to problems at the file system level.
</p>
<h4><a name="idm140644099855616"></a>Initialization Problems</h4>
<p>
      If something goes wrong when <code class="literal">InnoDB</code> attempts to
      initialize its tablespace or its log files, delete all files
      created by <code class="literal">InnoDB</code>: all
      <code class="filename">ibdata</code> files and all
      <code class="filename">ib_logfile</code> files. If you already created some
      <code class="literal">InnoDB</code> tables, also delete the corresponding
      <code class="filename">.frm</code> files for these tables, and any
      <code class="filename">.ibd</code> files if you are using multiple
      tablespaces, from the MySQL database directories. Then try the
      <code class="literal">InnoDB</code> database creation again. For easiest
      troubleshooting, start the MySQL server from a command prompt so
      that you see what is happening.
</p>
<h4><a name="idm140644099848352"></a>Runtime Problems</h4>
<p>
      If <code class="literal">InnoDB</code> prints an operating system error
      during a file operation, usually the problem has one of the
      following solutions:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          Make sure the <code class="literal">InnoDB</code> data file directory
          and the <code class="literal">InnoDB</code> log directory exist.
        </p></li><li class="listitem"><p>
          Make sure <a class="link" href="programs.html#mysqld" title="4.3.1 mysqld — The MySQL Server"><span class="command"><strong>mysqld</strong></span></a> has access rights to
          create files in those directories.
        </p></li><li class="listitem"><p>
          Make sure <a class="link" href="programs.html#mysqld" title="4.3.1 mysqld — The MySQL Server"><span class="command"><strong>mysqld</strong></span></a> can read the proper
          <code class="filename">my.cnf</code> or <code class="filename">my.ini</code>
          option file, so that it starts with the options that you
          specified.
        </p></li><li class="listitem"><p>
          Make sure the disk is not full and you are not exceeding any
          disk quota.
        </p></li><li class="listitem"><p>
          Make sure that the names you specify for subdirectories and
          data files do not clash.
        </p></li><li class="listitem"><p>
          Doublecheck the syntax of the
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_data_home_dir"><code class="literal">innodb_data_home_dir</code></a> and
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_data_file_path"><code class="literal">innodb_data_file_path</code></a> values.
          In particular, any <code class="literal">MAX</code> value in the
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_data_file_path"><code class="literal">innodb_data_file_path</code></a> option
          is a hard limit, and exceeding that limit causes a fatal
          error.
</p></li></ul>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="forcing-innodb-recovery"></a>14.18.2 Forcing InnoDB Recovery</h3>

</div>

</div>

</div>
<a class="indexterm" name="idm140644099829664"></a><a class="indexterm" name="idm140644099827760"></a><a class="indexterm" name="idm140644099826304"></a><p>
      To investigate database page corruption, you might dump your
      tables from the database with
      <a class="link" href="sql-syntax.html#select-into" title="13.2.9.1 SELECT ... INTO Syntax"><code class="literal">SELECT ... INTO
      OUTFILE</code></a>. Usually, most of the data obtained in this way
      is intact. Serious corruption might cause <code class="literal">SELECT * FROM
      <em class="replaceable"><code>tbl_name</code></em></code> statements or
      <code class="literal">InnoDB</code> background operations to crash or
      assert, or even cause <code class="literal">InnoDB</code> roll-forward
      recovery to crash. In such cases, you can use the
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_force_recovery"><code class="literal">innodb_force_recovery</code></a> option to
      force the <code class="literal">InnoDB</code> storage engine to start up
      while preventing background operations from running, so that you
      can dump your tables. For example, you can add the following line
      to the <code class="literal">[mysqld]</code> section of your option file
      before restarting the server:
    </p><pre class="programlisting">
[mysqld]
innodb_force_recovery = 1
</pre>
<div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Warning
</div>
<p>
        Only set <a class="link" href="innodb-storage-engine.html#sysvar_innodb_force_recovery"><code class="literal">innodb_force_recovery</code></a>
        to a value greater than 0 in an emergency situation, so that you
        can start <code class="literal">InnoDB</code> and dump your tables. Before
        doing so, ensure that you have a backup copy of your database in
        case you need to recreate it. Values of 4 or greater can
        permanently corrupt data files. Only use an
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_force_recovery"><code class="literal">innodb_force_recovery</code></a> setting
        of 4 or greater on a production server instance after you have
        successfully tested the setting on separate physical copy of
        your database. When forcing <code class="literal">InnoDB</code> recovery,
        you should always start with
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_force_recovery"><code class="literal">innodb_force_recovery=1</code></a> and
        only increase the value incrementally, as necessary.
</p>
</div>
<p>
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_force_recovery"><code class="literal">innodb_force_recovery</code></a> is 0 by
      default (normal startup without forced recovery). The permissible
      nonzero values for
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_force_recovery"><code class="literal">innodb_force_recovery</code></a> are 1 to 6.
      A larger value includes the functionality of lesser values. For
      example, a value of 3 includes all of the functionality of values
      1 and 2.
    </p><p>
      If you are able to dump your tables with an
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_force_recovery"><code class="literal">innodb_force_recovery</code></a> value of 3
      or less, then you are relatively safe that only some data on
      corrupt individual pages is lost. A value of 4 or greater is
      considered dangerous because data files can be permanently
      corrupted. A value of 6 is considered drastic because database
      pages are left in an obsolete state, which in turn may introduce
      more corruption into <a class="link" href="glossary.html#glos_b_tree" title="B-tree">B-trees</a>
      and other database structures.
    </p><p>
      As a safety measure, <code class="literal">InnoDB</code> prevents
      <a class="link" href="sql-syntax.html#insert" title="13.2.5 INSERT Syntax"><code class="literal">INSERT</code></a>,
      <a class="link" href="sql-syntax.html#update" title="13.2.11 UPDATE Syntax"><code class="literal">UPDATE</code></a>, or
      <a class="link" href="sql-syntax.html#delete" title="13.2.2 DELETE Syntax"><code class="literal">DELETE</code></a> operations when
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_force_recovery"><code class="literal">innodb_force_recovery</code></a> is greater
      than 0. As of MySQL 5.7.3, an
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_force_recovery"><code class="literal">innodb_force_recovery</code></a> setting of
      4 or greater places <code class="literal">InnoDB</code> in read-only mode.
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          <code class="literal">1</code>
          (<code class="literal">SRV_FORCE_IGNORE_CORRUPT</code>)
        </p><p>
          Lets the server run even if it detects a corrupt
          <a class="link" href="glossary.html#glos_page" title="page">page</a>. Tries to make
          <code class="literal">SELECT * FROM
          <em class="replaceable"><code>tbl_name</code></em></code> jump over
          corrupt index records and pages, which helps in dumping
          tables.
        </p></li><li class="listitem"><p>
          <code class="literal">2</code>
          (<code class="literal">SRV_FORCE_NO_BACKGROUND</code>)
        </p><p>
          Prevents the <a class="link" href="glossary.html#glos_master_thread" title="master thread">master
          thread</a> and any <a class="link" href="glossary.html#glos_purge_thread" title="purge thread">purge
          threads</a> from running. If a crash would occur during the
          <a class="link" href="glossary.html#glos_purge" title="purge">purge</a> operation, this
          recovery value prevents it.
        </p></li><li class="listitem"><p>
          <code class="literal">3</code>
          (<code class="literal">SRV_FORCE_NO_TRX_UNDO</code>)
        </p><p>
          Does not run transaction
          <a class="link" href="glossary.html#glos_rollback" title="rollback">rollbacks</a> after
          <a class="link" href="glossary.html#glos_crash_recovery" title="crash recovery">crash recovery</a>.
        </p></li><li class="listitem"><p>
          <code class="literal">4</code>
          (<code class="literal">SRV_FORCE_NO_IBUF_MERGE</code>)
        </p><p>
          Prevents <a class="link" href="glossary.html#glos_insert_buffer" title="insert buffer">insert
          buffer</a> merge operations. If they would cause a crash,
          does not do them. Does not calculate table
          <a class="link" href="glossary.html#glos_statistics" title="statistics">statistics</a>. This value
          can permanently corrupt data files. After using this value, be
          prepared to drop and recreate all secondary indexes. As of
          MySQL 5.7.3, sets <code class="literal">InnoDB</code> to read-only.
        </p></li><li class="listitem"><p>
          <code class="literal">5</code>
          (<code class="literal">SRV_FORCE_NO_UNDO_LOG_SCAN</code>)
        </p><p>
          Does not look at <a class="link" href="glossary.html#glos_undo_log" title="undo log">undo
          logs</a> when starting the database:
          <code class="literal">InnoDB</code> treats even incomplete transactions
          as committed. This value can permanently corrupt data files.
          As of MySQL 5.7.3, sets <code class="literal">InnoDB</code> to
          read-only.
        </p></li><li class="listitem"><p>
          <code class="literal">6</code>
          (<code class="literal">SRV_FORCE_NO_LOG_REDO</code>)
        </p><p>
          Does not do the <a class="link" href="glossary.html#glos_redo_log" title="redo log">redo log</a>
          roll-forward in connection with recovery. This value can
          permanently corrupt data files. Leaves database pages in an
          obsolete state, which in turn may introduce more corruption
          into B-trees and other database structures. As of MySQL 5.7.3,
          sets <code class="literal">InnoDB</code> to read-only.
</p></li></ul>
</div>
<p>
      You can <a class="link" href="sql-syntax.html#select" title="13.2.9 SELECT Syntax"><code class="literal">SELECT</code></a> from tables to dump
      them. With an
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_force_recovery"><code class="literal">innodb_force_recovery</code></a> value of 3
      or less you can <code class="literal">DROP</code> or
      <code class="literal">CREATE</code> tables. As of MySQL 5.7.9,
      <a class="link" href="sql-syntax.html#drop-table" title="13.1.29 DROP TABLE Syntax"><code class="literal">DROP TABLE</code></a> is also supported with
      an <a class="link" href="innodb-storage-engine.html#sysvar_innodb_force_recovery"><code class="literal">innodb_force_recovery</code></a> value
      greater than 3.
    </p><p>
      If you know that a given table is causing a crash on rollback, you
      can drop it. If you encounter a runaway rollback caused by a
      failing mass import or <a class="link" href="sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a>,
      you can kill the <a class="link" href="programs.html#mysqld" title="4.3.1 mysqld — The MySQL Server"><span class="command"><strong>mysqld</strong></span></a> process and set
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_force_recovery"><code class="literal">innodb_force_recovery</code></a> to
      <code class="literal">3</code> to bring the database up without the
      rollback, and then <code class="literal">DROP</code> the table that is
      causing the runaway rollback.
    </p><p>
      If corruption within the table data prevents you from dumping the
      entire table contents, a query with an <code class="literal">ORDER BY
      <em class="replaceable"><code>primary_key</code></em> DESC</code> clause might
      be able to dump the portion of the table after the corrupted part.
    </p><p>
      If a high <a class="link" href="innodb-storage-engine.html#sysvar_innodb_force_recovery"><code class="literal">innodb_force_recovery</code></a>
      value is required to start <code class="literal">InnoDB</code>, there may be
      corrupted data structures that could cause complex queries
      (queries containing <code class="literal">WHERE</code>, <code class="literal">ORDER
      BY</code>, or other clauses) to fail. In this case, you may
      only be able to run basic <code class="literal">SELECT * FROM t</code>
      queries.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="innodb-troubleshooting-datadict"></a>14.18.3 Troubleshooting InnoDB Data Dictionary Operations</h3>

</div>

</div>

</div>
<a class="indexterm" name="idm140644099746256"></a><p>
      Information about table definitions is stored both in the
      <code class="literal">.frm</code> files, and in the InnoDB
      <a class="link" href="glossary.html#glos_data_dictionary" title="data dictionary">data dictionary</a>. If
      you move <code class="filename">.frm</code> files around, or if the server
      crashes in the middle of a data dictionary operation, these
      sources of information can become inconsistent.
    </p><p>
      If a data dictionary corruption or consistency issue prevents you
      from starting <code class="literal">InnoDB</code>, see
      <a class="xref" href="innodb-storage-engine.html#forcing-innodb-recovery" title="14.18.2 Forcing InnoDB Recovery">Section 14.18.2, “Forcing InnoDB Recovery”</a> for information about
      manual recovery.
</p>
<div class="simplesect">

<div class="titlepage">
<div>

<div class="simple">
<h4 class="title"><a name="innodb-create-table-faulure"></a>CREATE TABLE Failure Due to Orphan Table</h4>
</div>
</div>
</div>
<a class="indexterm" name="idm140644099738272"></a><p>
        A symptom of an out-of-sync data dictionary is that a
        <a class="link" href="sql-syntax.html#create-table" title="13.1.18 CREATE TABLE Syntax"><code class="literal">CREATE TABLE</code></a> statement fails. If
        this occurs, look in the server's error log. If the log says
        that the table already exists inside the
        <code class="literal">InnoDB</code> internal data dictionary, you have an
        orphan table inside the <code class="literal">InnoDB</code> tablespace
        files that has no corresponding <code class="filename">.frm</code> file.
        The error message looks like this:
      </p><pre class="programlisting">
InnoDB: Error: table test/parent already exists in InnoDB internal
InnoDB: data dictionary. Have you deleted the .frm file
InnoDB: and not used DROP TABLE? Have you used DROP DATABASE
InnoDB: for InnoDB tables in MySQL version &lt;= 3.23.43?
InnoDB: See the Restrictions section of the InnoDB manual.
InnoDB: You can drop the orphaned table inside InnoDB by
InnoDB: creating an InnoDB table with the same name in another
InnoDB: database and moving the .frm file to the current database.
InnoDB: Then MySQL thinks the table exists, and DROP TABLE will
InnoDB: succeed.
</pre><p>
        You can drop the orphan table by following the instructions
        given in the error message. If you are still unable to use
        <a class="link" href="sql-syntax.html#drop-table" title="13.1.29 DROP TABLE Syntax"><code class="literal">DROP TABLE</code></a> successfully, the
        problem may be due to name completion in the
        <a class="link" href="programs.html#mysql" title="4.5.1 mysql — The MySQL Command-Line Tool"><span class="command"><strong>mysql</strong></span></a> client. To work around this problem,
        start the <a class="link" href="programs.html#mysql" title="4.5.1 mysql — The MySQL Command-Line Tool"><span class="command"><strong>mysql</strong></span></a> client with the
        <a class="link" href="programs.html#option_mysql_auto-rehash"><code class="option">--skip-auto-rehash</code></a>
        option and try <a class="link" href="sql-syntax.html#drop-table" title="13.1.29 DROP TABLE Syntax"><code class="literal">DROP TABLE</code></a> again.
        (With name completion on, <a class="link" href="programs.html#mysql" title="4.5.1 mysql — The MySQL Command-Line Tool"><span class="command"><strong>mysql</strong></span></a> tries to
        construct a list of table names, which fails when a problem such
        as just described exists.)
</p>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h4 class="title"><a name="innodb-cannot-open-file-error"></a>Cannot Open File Error</h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140644099720720"></a><p>
        Another symptom of an out-of-sync data dictionary is that MySQL
        prints an error that it cannot open an
        <code class="filename">InnoDB</code> file:
      </p><pre class="programlisting">
ERROR 1016: Can't open file: 'child2.ibd'. (errno: 1)
</pre><p>
        In the error log you can find a message like this:
      </p><pre class="programlisting">
InnoDB: Cannot find table test/child2 from the internal data dictionary
InnoDB: of InnoDB though the .frm file for the table exists. Maybe you
InnoDB: have deleted and recreated InnoDB data files but have forgotten
InnoDB: to delete the corresponding .frm files of InnoDB tables?
</pre><p>
        This means that there is an orphan <code class="filename">.frm</code>
        file without a corresponding table inside
        <code class="literal">InnoDB</code>. You can drop the orphan
        <code class="filename">.frm</code> file by deleting it manually.
</p>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h4 class="title"><a name="innodb-orphan-intermediate-tables"></a>Orphan Intermediate Tables</h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140644099711520"></a><p>
        If MySQL exits in the middle of an in-place
        <a class="link" href="sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a> operation
        (<code class="literal">ALGORITHM=INPLACE</code>), you may be left with an
        orphan intermediate table that takes up space on your system.
        Also, an orphan intermediate table in an otherwise empty
        <a class="link" href="glossary.html#glos_general_tablespace" title="general tablespace">general
        tablespace</a> will prevent you from dropping the general
        tablepace. This section describes how to identify and remove
        orphan intermediate tables.
      </p><p>
        Intermediate table names begin with an
        <code class="filename">#sql-ib</code> prefix (e.g.,
        <code class="filename">#sql-ib87-856498050</code>). The accompanying
        <code class="literal">.frm</code> file has an <code class="filename">#sql-*</code>
        prefix and is named differently (e.g.,
        <code class="filename">#sql-36ab_2.frm</code>).
      </p><p>
        To identify orphan intermediate tables on your system, you can
        query
        <a class="link" href="information-schema.html#innodb-sys-tables-table" title="21.31.7 The INFORMATION_SCHEMA INNODB_SYS_TABLES Table"><code class="literal">INFORMATION_SCHEMA.INNODB_SYS_TABLES</code></a>.
        Look for table names that begin with <code class="filename">#sql</code>.
        If the original table resides in a
        <a class="link" href="glossary.html#glos_file_per_table" title="file-per-table">file-per-table</a>
        tablespace, the tablespace file (the
        <code class="filename">#sql-*.ibd</code> file) for the orphan
        intermediate table should be visible in the database directory.
      </p><pre class="programlisting">
SELECT * FROM INFORMATION_SCHEMA.INNODB_SYS_TABLES WHERE NAME LIKE '%#sql%';
</pre><p>
        To remove an orphan intermediate table, perform the following
        steps:
</p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p>
            In the database directory, rename the
            <code class="filename">#sql-*.frm</code> file to match the base name
            of the orphan intermediate table:
</p><pre class="programlisting">shell&gt; mv #sql-36ab_2.frm #sql-ib87-856498050.frm</pre>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
              If there is no <code class="literal">.frm</code> file, you can
              recreate it. The <code class="filename">.frm</code> file must have
              the same table schema as the orphan intermediate table (it
              must have the same columns and indexes) and must be placed
              in the database directory of the orphan intermediate
              table.
</p>
</div>
</li><li class="listitem"><p>
            Drop the orphan intermediate table by issuing a
            <a class="link" href="sql-syntax.html#drop-table" title="13.1.29 DROP TABLE Syntax"><code class="literal">DROP TABLE</code></a> statement,
            prefixing the name of the table with
            <code class="literal">#mysql50#</code> and enclosing the table name in
            backticks. For example:
          </p><pre class="programlisting">mysql&gt; DROP TABLE `#mysql50##sql-ib87-856498050`;</pre><p>
            The <code class="literal">#mysql50#</code> prefix tells MySQL to
            ignore <code class="literal">file name safe encoding</code> introduced
            in MySQL 5.1. Enclosing the table name in backticks is
            required to perform SQL statements on table names with
            special characters such as <span class="quote">“<span class="quote">#</span>”</span>.
</p></li></ol>
</div>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">
<div class="admon-title">
Note
</div>
<p>
          If a crash occurs during an in-place
          <a class="link" href="sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a> operation that was
          moving a table to a different tablespace, the recovery process
          restores the table to its original location but leaves an
          orphan intermediate table in the destination tablespace.
</p>
</div>

</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h4 class="title"><a name="innodb-orphan-temporary-tables"></a>Orphan Temporary Tables</h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140644099680784"></a><p>
        If MySQL exits in the middle of a table-copying
        <a class="link" href="sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a> operation
        (<code class="literal">ALGORITHM=COPY</code>), you may be left with an
        orphan temporary table that takes up space on your system. Also,
        an orphan temporary table in an otherwise empty
        <a class="link" href="glossary.html#glos_general_tablespace" title="general tablespace">general
        tablespace</a> will prevent you from dropping the general
        tablepace. This section describes how to identify and remove
        orphan temporary tables.
      </p><p>
        Orphan temporary table names begin with an
        <code class="filename">#sql-</code> prefix (e.g.,
        <code class="filename">#sql-540_3</code>). The accompanying
        <code class="filename">.frm</code> file has the same base name as the
        orphan temporary table.
</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
          If there is no <code class="literal">.frm</code> file, you can recreate
          it. The <code class="filename">.frm</code> file must have the same
          table schema as the orphan temporary table (it must have the
          same columns and indexes) and must be placed in the database
          directory of the orphan temporary table.
</p>
</div>
<p>
        To identify orphan temporary tables on your system, you can
        query
        <a class="link" href="information-schema.html#innodb-sys-tables-table" title="21.31.7 The INFORMATION_SCHEMA INNODB_SYS_TABLES Table"><code class="literal">INFORMATION_SCHEMA.INNODB_SYS_TABLES</code></a>.
        Look for table names that begin with <code class="filename">#sql</code>.
        If the original table resides in a
        <a class="link" href="glossary.html#glos_file_per_table" title="file-per-table">file-per-table</a>
        tablespace, the tablespace file (the
        <code class="filename">#sql-*.ibd</code> file) for the orphan temporary
        table should be visible in the database directory.
      </p><pre class="programlisting">
SELECT * FROM INFORMATION_SCHEMA.INNODB_SYS_TABLES WHERE NAME LIKE '%#sql%';
</pre><p>
        To remove an orphan temporary table, drop the table by issuing a
        <a class="link" href="sql-syntax.html#drop-table" title="13.1.29 DROP TABLE Syntax"><code class="literal">DROP TABLE</code></a> statement, prefixing
        the name of the table with <code class="literal">#mysql50#</code> and
        enclosing the table name in backticks. For example:
      </p><pre class="programlisting">mysql&gt; DROP TABLE `#mysql50##sql-540_3`;</pre><p>
        The <code class="literal">#mysql50#</code> prefix tells MySQL to ignore
        <code class="literal">file name safe encoding</code> introduced in MySQL
        5.1. Enclosing the table name in backticks is required to
        perform SQL statements on table names with special characters
        such as <span class="quote">“<span class="quote">#</span>”</span>.
</p>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h4 class="title"><a name="innodb-tablespace-does-not-exist"></a>Tablespace Does Not Exist</h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140644099658160"></a><p>
        With <a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_per_table"><code class="literal">innodb_file_per_table</code></a>
        enabled, the following message might occur if the
        <code class="literal">.frm</code> or <code class="literal">.ibd</code> files (or
        both) are missing:
      </p><pre class="programlisting">
InnoDB: in InnoDB data dictionary has tablespace id <em class="replaceable"><code>N</code></em>,
InnoDB: but tablespace with that id or name does not exist. Have
InnoDB: you deleted or moved .ibd files?
InnoDB: This may also be a table created with CREATE TEMPORARY TABLE
InnoDB: whose .ibd and .frm files MySQL automatically removed, but the
InnoDB: table still exists in the InnoDB internal data dictionary.
</pre><p>
        If this occurs, try the following procedure to resolve the
        problem:
</p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p>
            Create a matching <code class="filename">.frm</code> file in some
            other database directory and copy it to the database
            directory where the orphan table is located.
          </p></li><li class="listitem"><p>
            Issue <a class="link" href="sql-syntax.html#drop-table" title="13.1.29 DROP TABLE Syntax"><code class="literal">DROP TABLE</code></a> for the
            original table. That should successfully drop the table and
            <code class="literal">InnoDB</code> should print a warning to the
            error log that the <code class="filename">.ibd</code> file was
            missing.
</p></li></ol>
</div>

</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h4 class="title"><a name="restoring-orphaned-idb-files"></a>Restoring Orphan File-Per-Table ibd Files</h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140644099643552"></a><p>
        This procedure describes how to restore orphan
        <a class="link" href="glossary.html#glos_file_per_table" title="file-per-table">file-per-table</a>
        <code class="filename">.ibd</code> files to another MySQL instance. You
        might use this procedure if the system tablespace is lost or
        unrecoverable and you want to restore <code class="filename">.idb</code>
        file backups on a new MySQL instance.
      </p><p>
        The procedure is not supported for
        <a class="link" href="glossary.html#glos_general_tablespace" title="general tablespace">general
        tablespace</a> <code class="filename">.ibd</code> files.
      </p><p>
        The procedure assumes that you only have
        <code class="filename">.ibd</code> file backups, you are recovering to
        the same version of MySQL that initially created the orphan
        <code class="filename">.idb</code> files, and that
        <code class="filename">.idb</code> file backups are clean. See
        <a class="xref" href="innodb-storage-engine.html#innodb-migration" title="14.5.2 Moving or Copying InnoDB Tables to Another Machine">Section 14.5.2, “Moving or Copying InnoDB Tables to Another Machine”</a> for information about
        creating clean backups.
      </p><p>
        Tablespace copying limitations outlined in
        <a class="xref" href="innodb-storage-engine.html#tablespace-copying" title="14.4.6 Copying File-Per-Table Tablespaces to Another Server">Section 14.4.6, “Copying File-Per-Table Tablespaces to Another Server”</a> are applicable to this
        procedure.
</p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p>
            On the new MySQL instance, recreate the table in a database
            of the same name.
          </p><pre class="programlisting">mysql&gt; CREATE DATABASE sakila;

mysql&gt; USE sakila;

mysql&gt; CREATE TABLE actor (
    -&gt;    actor_id SMALLINT UNSIGNED NOT NULL AUTO_INCREMENT,
    -&gt;    first_name VARCHAR(45) NOT NULL,
    -&gt;    last_name VARCHAR(45) NOT NULL,
    -&gt;    last_update TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    -&gt;    PRIMARY KEY  (actor_id),
    -&gt;    KEY idx_actor_last_name (last_name)
    -&gt; )ENGINE=InnoDB DEFAULT CHARSET=utf8;</pre></li><li class="listitem"><p>
            Discard the tablespace of the newly created table.
          </p><pre class="programlisting">mysql&gt; ALTER TABLE sakila.actor DISCARD TABLESPACE;</pre></li><li class="listitem"><p>
            Copy the orphan <code class="literal">.idb</code> file from your
            backup directory to the new database directory.
          </p><pre class="programlisting">shell&gt; cp /<code class="literal">backup_directory</code>/actor.ibd <em class="replaceable"><code>path/to/mysql-5.7/data</code></em>/sakila/</pre></li><li class="listitem"><p>
            Ensure that the <code class="filename">.ibd</code> file has the
            necessary file permissions.
          </p></li><li class="listitem"><p>
            Import the orphan <code class="literal">.ibd</code> file. A warning is
            issued indicating that <code class="literal">InnoDB</code> will
            attempt to import the file without schema verification.
          </p><pre class="programlisting">mysql&gt; ALTER TABLE sakila.actor IMPORT TABLESPACE; SHOW WARNINGS;      
Query OK, 0 rows affected, 1 warning (0.15 sec)

Warning | 1810 | InnoDB: IO Read error: (2, No such file or directory) 
Error opening './sakila/actor.cfg', will attempt to import 
without schema verification</pre></li><li class="listitem"><p>
            Query the table to verify that the <code class="literal">.ibd</code>
            file was successfully restored.
          </p><pre class="programlisting">mysql&gt; SELECT COUNT(*) FROM sakila.actor;
+----------+
| count(*) |
+----------+
|      200 |
+----------+</pre></li></ol>
</div>

</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="innodb-error-handling"></a>14.18.4 InnoDB Error Handling</h3>

</div>

</div>

</div>
<a class="indexterm" name="idm140644099614752"></a><a class="indexterm" name="idm140644099612848"></a><p>
      The following items describe how <code class="literal">InnoDB</code>
      performs error handling. <code class="literal">InnoDB</code> sometimes rolls
      back only the statement that failed, other times it rolls back the
      entire transaction.
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          If you run out of file space in a
          <a class="link" href="glossary.html#glos_tablespace" title="tablespace">tablespace</a>, a MySQL
          <code class="literal">Table is full</code> error occurs and
          <code class="literal">InnoDB</code> rolls back the SQL statement.
        </p></li><li class="listitem"><p>
          A transaction <a class="link" href="glossary.html#glos_deadlock" title="deadlock">deadlock</a>
          causes <code class="literal">InnoDB</code> to
          <a class="link" href="glossary.html#glos_rollback" title="rollback">roll back</a> the entire
          <a class="link" href="glossary.html#glos_transaction" title="transaction">transaction</a>. Retry the
          whole transaction when this happens.
        </p><p>
          A lock wait timeout causes <code class="literal">InnoDB</code> to roll
          back only the single statement that was waiting for the lock
          and encountered the timeout. (To have the entire transaction
          roll back, start the server with the
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_rollback_on_timeout"><code class="option">--innodb_rollback_on_timeout</code></a>
          option.) Retry the statement if using the current behavior, or
          the entire transaction if using
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_rollback_on_timeout"><code class="option">--innodb_rollback_on_timeout</code></a>.
        </p><p>
          Both deadlocks and lock wait timeouts are normal on busy
          servers and it is necessary for applications to be aware that
          they may happen and handle them by retrying. You can make them
          less likely by doing as little work as possible between the
          first change to data during a transaction and the commit, so
          the locks are held for the shortest possible time and for the
          smallest possible number of rows. Sometimes splitting work
          between different transactions may be practical and helpful.
        </p><p>
          When a transaction rollback occurs due to a deadlock or lock
          wait timeout, it cancels the effect of the statements within
          the transaction. But if the start-transaction statement was
          <a class="link" href="sql-syntax.html#commit" title="13.3.1 START TRANSACTION, COMMIT, and ROLLBACK Syntax"><code class="literal">START
          TRANSACTION</code></a> or
          <a class="link" href="sql-syntax.html#commit" title="13.3.1 START TRANSACTION, COMMIT, and ROLLBACK Syntax"><code class="literal">BEGIN</code></a>
          statement, rollback does not cancel that statement. Further
          SQL statements become part of the transaction until the
          occurrence of <a class="link" href="sql-syntax.html#commit" title="13.3.1 START TRANSACTION, COMMIT, and ROLLBACK Syntax"><code class="literal">COMMIT</code></a>,
          <a class="link" href="sql-syntax.html#commit" title="13.3.1 START TRANSACTION, COMMIT, and ROLLBACK Syntax"><code class="literal">ROLLBACK</code></a>, or
          some SQL statement that causes an implicit commit.
        </p></li><li class="listitem"><p>
          A duplicate-key error rolls back the SQL statement, if you
          have not specified the <code class="literal">IGNORE</code> option in
          your statement.
        </p></li><li class="listitem"><p>
          A <code class="literal">row too long error</code> rolls back the SQL
          statement.
        </p></li><li class="listitem"><p>
          Other errors are mostly detected by the MySQL layer of code
          (above the <code class="literal">InnoDB</code> storage engine level),
          and they roll back the corresponding SQL statement. Locks are
          not released in a rollback of a single SQL statement.
</p></li></ul>
</div>
<p>
      During implicit rollbacks, as well as during the execution of an
      explicit
      <a class="link" href="sql-syntax.html#commit" title="13.3.1 START TRANSACTION, COMMIT, and ROLLBACK Syntax"><code class="literal">ROLLBACK</code></a> SQL
      statement, <a class="link" href="sql-syntax.html#show-processlist" title="13.7.5.29 SHOW PROCESSLIST Syntax"><code class="literal">SHOW PROCESSLIST</code></a>
      displays <code class="literal">Rolling back</code> in the
      <code class="literal">State</code> column for the relevant connection.
</p>
</div>

</div>

</div>
<div class="copyright-footer">

</div>
<div class="navfooter">
<hr>
<table width="100%" summary="Navigation footer">
<tr>
<td width="40%" align="left"><a accesskey="p" href="sql-syntax.html">Prev</a></td>
<td width="20%" align="center"><a accesskey="u" href="">Up</a></td>
<td width="40%" align="right"> <a accesskey="n" href="storage-engines.html">Next</a></td>
</tr>
<tr>
<td width="40%" align="left" valign="top">Chapter 13 SQL Statement Syntax</td>
<td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td>
<td width="40%" align="right" valign="top">Chapter 15 Alternative Storage Engines</td>
</tr>
</table>
</div>
</body>
</html>
